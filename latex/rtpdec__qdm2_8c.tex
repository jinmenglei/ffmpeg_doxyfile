\hypertarget{rtpdec__qdm2_8c}{}\doxysection{E\+:/github/ffmpeg/libavformat/rtpdec\+\_\+qdm2.c File Reference}
\label{rtpdec__qdm2_8c}\index{E:/github/ffmpeg/libavformat/rtpdec\_qdm2.c@{E:/github/ffmpeg/libavformat/rtpdec\_qdm2.c}}


R\+TP support for the Q\+D\+M2 payload (todo\+: wiki)  


{\ttfamily \#include $<$string.\+h$>$}\newline
{\ttfamily \#include \char`\"{}libavutil/avassert.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}libavutil/intreadwrite.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}libavcodec/avcodec.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}internal.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}rtp.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}rtpdec.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}rtpdec\+\_\+formats.\+h\char`\"{}}\newline
Include dependency graph for rtpdec\+\_\+qdm2.\+c\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{rtpdec__qdm2_8c__incl}
\end{center}
\end{figure}
\doxysubsection*{Classes}
\begin{DoxyCompactItemize}
\item 
struct \mbox{\hyperlink{struct_payload_context}{Payload\+Context}}
\end{DoxyCompactItemize}
\doxysubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
static \mbox{\hyperlink{ffmpeg__filter_8c_a61569f2965b7a369eb10b6d75d410d11}{int}} \mbox{\hyperlink{rtpdec__qdm2_8c_aa3b2496af5a4047bb3ec0e205af78313}{qdm2\+\_\+parse\+\_\+config}} (\mbox{\hyperlink{struct_payload_context}{Payload\+Context}} $\ast$qdm, \mbox{\hyperlink{struct_a_v_stream}{A\+V\+Stream}} $\ast$st, const \mbox{\hyperlink{audio__convert_8c_ae1affc9ca37cfb624959c866a73f83c2}{uint8\+\_\+t}} $\ast$buf, const \mbox{\hyperlink{audio__convert_8c_ae1affc9ca37cfb624959c866a73f83c2}{uint8\+\_\+t}} $\ast$\mbox{\hyperlink{avrndec_8c_a13191ba45577b1d4f9b37d64df91eb55}{end}})
\item 
static \mbox{\hyperlink{ffmpeg__filter_8c_a61569f2965b7a369eb10b6d75d410d11}{int}} \mbox{\hyperlink{rtpdec__qdm2_8c_a8fba9abf2dc669327b14d66e72cd56a7}{qdm2\+\_\+parse\+\_\+subpacket}} (\mbox{\hyperlink{struct_payload_context}{Payload\+Context}} $\ast$qdm, \mbox{\hyperlink{struct_a_v_stream}{A\+V\+Stream}} $\ast$st, const \mbox{\hyperlink{audio__convert_8c_ae1affc9ca37cfb624959c866a73f83c2}{uint8\+\_\+t}} $\ast$buf, const \mbox{\hyperlink{audio__convert_8c_ae1affc9ca37cfb624959c866a73f83c2}{uint8\+\_\+t}} $\ast$\mbox{\hyperlink{avrndec_8c_a13191ba45577b1d4f9b37d64df91eb55}{end}})
\item 
static \mbox{\hyperlink{ffmpeg__filter_8c_a61569f2965b7a369eb10b6d75d410d11}{int}} \mbox{\hyperlink{rtpdec__qdm2_8c_aa3f9047bdc43be3690396c63940ee2b8}{qdm2\+\_\+restore\+\_\+block}} (\mbox{\hyperlink{struct_payload_context}{Payload\+Context}} $\ast$qdm, \mbox{\hyperlink{struct_a_v_stream}{A\+V\+Stream}} $\ast$st, \mbox{\hyperlink{struct_a_v_packet}{A\+V\+Packet}} $\ast$\mbox{\hyperlink{demuxing__decoding_8c_a3d4c6562f0b27cf0cacbbea5c038c090}{pkt}})
\item 
static \mbox{\hyperlink{ffmpeg__filter_8c_a61569f2965b7a369eb10b6d75d410d11}{int}} \mbox{\hyperlink{rtpdec__qdm2_8c_a1112ce935acbb4665a412a1202f4ef50}{qdm2\+\_\+parse\+\_\+packet}} (\mbox{\hyperlink{struct_a_v_format_context}{A\+V\+Format\+Context}} $\ast$\mbox{\hyperlink{sw__rgb_8c_a517a4433fe5466cc6af1c80c538b0881}{s}}, \mbox{\hyperlink{struct_payload_context}{Payload\+Context}} $\ast$qdm, \mbox{\hyperlink{struct_a_v_stream}{A\+V\+Stream}} $\ast$st, \mbox{\hyperlink{struct_a_v_packet}{A\+V\+Packet}} $\ast$\mbox{\hyperlink{demuxing__decoding_8c_a3d4c6562f0b27cf0cacbbea5c038c090}{pkt}}, uint32\+\_\+t $\ast$timestamp, const \mbox{\hyperlink{audio__convert_8c_ae1affc9ca37cfb624959c866a73f83c2}{uint8\+\_\+t}} $\ast$buf, \mbox{\hyperlink{ffmpeg__filter_8c_a61569f2965b7a369eb10b6d75d410d11}{int}} \mbox{\hyperlink{spdifenc_8c_a77124bd5f7e31e6fffc19f335da0c23f}{len}}, uint16\+\_\+t seq, \mbox{\hyperlink{ffmpeg__filter_8c_a61569f2965b7a369eb10b6d75d410d11}{int}} \mbox{\hyperlink{log_8c_ac8bf36fe0577cba66bccda3a6f7e80a4}{flags}})
\end{DoxyCompactItemize}
\doxysubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
const \mbox{\hyperlink{struct_r_t_p_dynamic_protocol_handler}{R\+T\+P\+Dynamic\+Protocol\+Handler}} \mbox{\hyperlink{rtpdec__qdm2_8c_a1e3193772c0cf587954c65ccc7e5b9c3}{ff\+\_\+qdm2\+\_\+dynamic\+\_\+handler}}
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
R\+TP support for the Q\+D\+M2 payload (todo\+: wiki) 

\begin{DoxyAuthor}{Author}
Ronald S. Bultje \href{mailto:rbultje@ronald.bitfreak.net}{\texttt{ rbultje@ronald.\+bitfreak.\+net}} 
\end{DoxyAuthor}


\doxysubsection{Function Documentation}
\mbox{\Hypertarget{rtpdec__qdm2_8c_aa3b2496af5a4047bb3ec0e205af78313}\label{rtpdec__qdm2_8c_aa3b2496af5a4047bb3ec0e205af78313}} 
\index{rtpdec\_qdm2.c@{rtpdec\_qdm2.c}!qdm2\_parse\_config@{qdm2\_parse\_config}}
\index{qdm2\_parse\_config@{qdm2\_parse\_config}!rtpdec\_qdm2.c@{rtpdec\_qdm2.c}}
\doxysubsubsection{\texorpdfstring{qdm2\_parse\_config()}{qdm2\_parse\_config()}}
{\footnotesize\ttfamily static \mbox{\hyperlink{ffmpeg__filter_8c_a61569f2965b7a369eb10b6d75d410d11}{int}} qdm2\+\_\+parse\+\_\+config (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{struct_payload_context}{Payload\+Context}} $\ast$}]{qdm,  }\item[{\mbox{\hyperlink{struct_a_v_stream}{A\+V\+Stream}} $\ast$}]{st,  }\item[{const \mbox{\hyperlink{audio__convert_8c_ae1affc9ca37cfb624959c866a73f83c2}{uint8\+\_\+t}} $\ast$}]{buf,  }\item[{const \mbox{\hyperlink{audio__convert_8c_ae1affc9ca37cfb624959c866a73f83c2}{uint8\+\_\+t}} $\ast$}]{end }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}

Parse configuration (basically the codec-\/specific extradata) from an R\+TP config subpacket (starts with 0xff).

Layout of the config subpacket (in bytes)\+: 1\+: 0x\+FF $<$-\/ config ID then an array \{ 1\+: size $<$-\/ of the current item 1\+: item type $<$-\/ 0 .. 4 size-\/2\+: data $<$-\/ data depends on the item type \}

Item 0 implies the end of the config subpacket, and has no data. Item 1 implies a stream configuration without extradata. Item 2 max. nr. of subpackets per superblock Item 3 superblock type for the stream Item 4 implies a stream configuration with extradata (size $>$= 0x1c).

\begin{DoxyReturn}{Returns}
$<$0 on error, otherwise the number of bytes parsed from the input buffer. 
\end{DoxyReturn}
$<$ subpackets per block

Definition at line 77 of file rtpdec\+\_\+qdm2.\+c.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{rtpdec__qdm2_8c_aa3b2496af5a4047bb3ec0e205af78313_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=321pt]{rtpdec__qdm2_8c_aa3b2496af5a4047bb3ec0e205af78313_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{rtpdec__qdm2_8c_a1112ce935acbb4665a412a1202f4ef50}\label{rtpdec__qdm2_8c_a1112ce935acbb4665a412a1202f4ef50}} 
\index{rtpdec\_qdm2.c@{rtpdec\_qdm2.c}!qdm2\_parse\_packet@{qdm2\_parse\_packet}}
\index{qdm2\_parse\_packet@{qdm2\_parse\_packet}!rtpdec\_qdm2.c@{rtpdec\_qdm2.c}}
\doxysubsubsection{\texorpdfstring{qdm2\_parse\_packet()}{qdm2\_parse\_packet()}}
{\footnotesize\ttfamily static \mbox{\hyperlink{ffmpeg__filter_8c_a61569f2965b7a369eb10b6d75d410d11}{int}} qdm2\+\_\+parse\+\_\+packet (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{struct_a_v_format_context}{A\+V\+Format\+Context}} $\ast$}]{s,  }\item[{\mbox{\hyperlink{struct_payload_context}{Payload\+Context}} $\ast$}]{qdm,  }\item[{\mbox{\hyperlink{struct_a_v_stream}{A\+V\+Stream}} $\ast$}]{st,  }\item[{\mbox{\hyperlink{struct_a_v_packet}{A\+V\+Packet}} $\ast$}]{pkt,  }\item[{uint32\+\_\+t $\ast$}]{timestamp,  }\item[{const \mbox{\hyperlink{audio__convert_8c_ae1affc9ca37cfb624959c866a73f83c2}{uint8\+\_\+t}} $\ast$}]{buf,  }\item[{\mbox{\hyperlink{ffmpeg__filter_8c_a61569f2965b7a369eb10b6d75d410d11}{int}}}]{len,  }\item[{uint16\+\_\+t}]{seq,  }\item[{\mbox{\hyperlink{ffmpeg__filter_8c_a61569f2965b7a369eb10b6d75d410d11}{int}}}]{flags }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}

return 0 on packet, no more left, 1 on packet, -\/1 on partial packet... 

Definition at line 239 of file rtpdec\+\_\+qdm2.\+c.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{rtpdec__qdm2_8c_a1112ce935acbb4665a412a1202f4ef50_cgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{rtpdec__qdm2_8c_a8fba9abf2dc669327b14d66e72cd56a7}\label{rtpdec__qdm2_8c_a8fba9abf2dc669327b14d66e72cd56a7}} 
\index{rtpdec\_qdm2.c@{rtpdec\_qdm2.c}!qdm2\_parse\_subpacket@{qdm2\_parse\_subpacket}}
\index{qdm2\_parse\_subpacket@{qdm2\_parse\_subpacket}!rtpdec\_qdm2.c@{rtpdec\_qdm2.c}}
\doxysubsubsection{\texorpdfstring{qdm2\_parse\_subpacket()}{qdm2\_parse\_subpacket()}}
{\footnotesize\ttfamily static \mbox{\hyperlink{ffmpeg__filter_8c_a61569f2965b7a369eb10b6d75d410d11}{int}} qdm2\+\_\+parse\+\_\+subpacket (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{struct_payload_context}{Payload\+Context}} $\ast$}]{qdm,  }\item[{\mbox{\hyperlink{struct_a_v_stream}{A\+V\+Stream}} $\ast$}]{st,  }\item[{const \mbox{\hyperlink{audio__convert_8c_ae1affc9ca37cfb624959c866a73f83c2}{uint8\+\_\+t}} $\ast$}]{buf,  }\item[{const \mbox{\hyperlink{audio__convert_8c_ae1affc9ca37cfb624959c866a73f83c2}{uint8\+\_\+t}} $\ast$}]{end }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}

Parse a single subpacket. We store this subpacket in an intermediate buffer (position depends on the ID (byte\mbox{[}0\mbox{]}). When called, at least 4 bytes are available for reading (see \mbox{\hyperlink{rtpdec__qdm2_8c_a1112ce935acbb4665a412a1202f4ef50}{qdm2\+\_\+parse\+\_\+packet()}}).

Layout of a single subpacket (R\+TP packets commonly contain multiple such subpackets) -\/ length in bytes\+: 1\+: ordering ID $<$-\/ 0 .. 0x7F 1\+: subpacket type $<$-\/ 0 .. 0x7F; value \& 0x80 means subpacket length = 2 bytes, else 1 byte 1/2\+: subpacket length $<$-\/ length of the data following the flags/length fields if (subpacket type \& 0x7F) == 0x7F 1\+: subpacket type, higher bits size\+: subpacket data

The subpackets come in randomly, and should be encapsulated into 1 or more superblocks (containing qdm-\/$>$subpkts\+\_\+per\+\_\+block subpackets each) per R\+TP packet, in order of ascending \char`\"{}ordering I\+D\char`\"{}, see \mbox{\hyperlink{rtpdec__qdm2_8c_aa3f9047bdc43be3690396c63940ee2b8}{qdm2\+\_\+restore\+\_\+block()}}.

\begin{DoxyReturn}{Returns}
$<$0 on error, otherwise the number of bytes parsed from the input buffer. 
\end{DoxyReturn}


Definition at line 154 of file rtpdec\+\_\+qdm2.\+c.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{rtpdec__qdm2_8c_a8fba9abf2dc669327b14d66e72cd56a7_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=340pt]{rtpdec__qdm2_8c_a8fba9abf2dc669327b14d66e72cd56a7_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{rtpdec__qdm2_8c_aa3f9047bdc43be3690396c63940ee2b8}\label{rtpdec__qdm2_8c_aa3f9047bdc43be3690396c63940ee2b8}} 
\index{rtpdec\_qdm2.c@{rtpdec\_qdm2.c}!qdm2\_restore\_block@{qdm2\_restore\_block}}
\index{qdm2\_restore\_block@{qdm2\_restore\_block}!rtpdec\_qdm2.c@{rtpdec\_qdm2.c}}
\doxysubsubsection{\texorpdfstring{qdm2\_restore\_block()}{qdm2\_restore\_block()}}
{\footnotesize\ttfamily static \mbox{\hyperlink{ffmpeg__filter_8c_a61569f2965b7a369eb10b6d75d410d11}{int}} qdm2\+\_\+restore\+\_\+block (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{struct_payload_context}{Payload\+Context}} $\ast$}]{qdm,  }\item[{\mbox{\hyperlink{struct_a_v_stream}{A\+V\+Stream}} $\ast$}]{st,  }\item[{\mbox{\hyperlink{struct_a_v_packet}{A\+V\+Packet}} $\ast$}]{pkt }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}

Add a superblock header around a set of subpackets.

\begin{DoxyReturn}{Returns}
$<$0 on error, else 0. 
\end{DoxyReturn}


Definition at line 188 of file rtpdec\+\_\+qdm2.\+c.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{rtpdec__qdm2_8c_aa3f9047bdc43be3690396c63940ee2b8_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=324pt]{rtpdec__qdm2_8c_aa3f9047bdc43be3690396c63940ee2b8_icgraph}
\end{center}
\end{figure}


\doxysubsection{Variable Documentation}
\mbox{\Hypertarget{rtpdec__qdm2_8c_a1e3193772c0cf587954c65ccc7e5b9c3}\label{rtpdec__qdm2_8c_a1e3193772c0cf587954c65ccc7e5b9c3}} 
\index{rtpdec\_qdm2.c@{rtpdec\_qdm2.c}!ff\_qdm2\_dynamic\_handler@{ff\_qdm2\_dynamic\_handler}}
\index{ff\_qdm2\_dynamic\_handler@{ff\_qdm2\_dynamic\_handler}!rtpdec\_qdm2.c@{rtpdec\_qdm2.c}}
\doxysubsubsection{\texorpdfstring{ff\_qdm2\_dynamic\_handler}{ff\_qdm2\_dynamic\_handler}}
{\footnotesize\ttfamily const \mbox{\hyperlink{struct_r_t_p_dynamic_protocol_handler}{R\+T\+P\+Dynamic\+Protocol\+Handler}} ff\+\_\+qdm2\+\_\+dynamic\+\_\+handler}

{\bfseries Initial value\+:}
\begin{DoxyCode}{0}
\DoxyCodeLine{= \{}
\DoxyCodeLine{    .enc\_name         = \textcolor{stringliteral}{"{}X-\/QDM"{}},}
\DoxyCodeLine{    .codec\_type       = \mbox{\hyperlink{group__lavu__misc_gga9a84bba4713dfced21a1a56163be1f48a7b4e33b8f30ac94d34ce8d9f7c33927a}{AVMEDIA\_TYPE\_AUDIO}},}
\DoxyCodeLine{    .codec\_id         = \mbox{\hyperlink{group__lavc__core_ggaadca229ad2c20e060a14fec08a5cc7cea48761c50b102343e2648c3e28a94e7ab}{AV\_CODEC\_ID\_NONE}},}
\DoxyCodeLine{    .priv\_data\_size   = \textcolor{keyword}{sizeof}(\mbox{\hyperlink{rtpdec_8h_abf62099f8349c32cb901fecd81b381e6}{PayloadContext}}),}
\DoxyCodeLine{    .\mbox{\hyperlink{libavformat_2utils_8c_ae6ee9e509cc26da6cd7f4eb9f158f47e}{parse\_packet}}     = \mbox{\hyperlink{rtpdec__qdm2_8c_a1112ce935acbb4665a412a1202f4ef50}{qdm2\_parse\_packet}},}
\DoxyCodeLine{\}}

\end{DoxyCode}


Definition at line 303 of file rtpdec\+\_\+qdm2.\+c.

