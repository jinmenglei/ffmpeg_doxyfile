<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>My Project: E:/github/ffmpeg/libavcodec/rpzaenc.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">My Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_737c44b861ba7ee498141742fb455fa8.html">ffmpeg</a></li><li class="navelem"><a class="el" href="dir_56ad1dd09ca1ce410b5ba2c46dd71e4b.html">libavcodec</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">rpzaenc.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="rpzaenc_8c.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> * QuickTime RPZA Video Encoder</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> * This file is part of FFmpeg.</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> * FFmpeg is free software; you can redistribute it and/or</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> * modify it under the terms of the GNU Lesser General Public</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> * License as published by the Free Software Foundation; either</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> * version 2.1 of the License, or (at your option) any later version.</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> * FFmpeg is distributed in the hope that it will be useful,</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"> * Lesser General Public License for more details.</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"> * You should have received a copy of the GNU Lesser General Public</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"> * License along with FFmpeg; if not, write to the Free Software</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"> * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160; </div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="avassert_8h.html">libavutil/avassert.h</a>&quot;</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="common_8h.html">libavutil/common.h</a>&quot;</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="opt_8h.html">libavutil/opt.h</a>&quot;</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160; </div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="avcodec_8h.html">avcodec.h</a>&quot;</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="libavutil_2internal_8h.html">internal.h</a>&quot;</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="put__bits_8h.html">put_bits.h</a>&quot;</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160; </div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="struct_rpza_context.html">RpzaContext</a> {</div>
<div class="line"><a name="l00035"></a><span class="lineno"><a class="line" href="struct_rpza_context.html#a00d31105a997be3e14af43317dba9085">   35</a></span>&#160;    <a class="code" href="struct_a_v_class.html">AVClass</a> *<a class="code" href="struct_rpza_context.html#a00d31105a997be3e14af43317dba9085">avclass</a>;</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160; </div>
<div class="line"><a name="l00037"></a><span class="lineno"><a class="line" href="struct_rpza_context.html#ab87ae74d871f21e9924555aa2129338c">   37</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="struct_rpza_context.html#ab87ae74d871f21e9924555aa2129338c">skip_frame_thresh</a>;</div>
<div class="line"><a name="l00038"></a><span class="lineno"><a class="line" href="struct_rpza_context.html#afdbdea5f80dcedf13d3e0b9d895496cb">   38</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="struct_rpza_context.html#afdbdea5f80dcedf13d3e0b9d895496cb">start_one_color_thresh</a>;</div>
<div class="line"><a name="l00039"></a><span class="lineno"><a class="line" href="struct_rpza_context.html#a736bd01af070145991d2cb0ae7658c94">   39</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="struct_rpza_context.html#a736bd01af070145991d2cb0ae7658c94">continue_one_color_thresh</a>;</div>
<div class="line"><a name="l00040"></a><span class="lineno"><a class="line" href="struct_rpza_context.html#ad72eb520a29ea00746e252a88652a2a1">   40</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="struct_rpza_context.html#ad72eb520a29ea00746e252a88652a2a1">sixteen_color_thresh</a>;</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160; </div>
<div class="line"><a name="l00042"></a><span class="lineno"><a class="line" href="struct_rpza_context.html#a1e2acc29a3643deffb5fff5b5ff91564">   42</a></span>&#160;    <a class="code" href="struct_a_v_frame.html">AVFrame</a> *<a class="code" href="struct_rpza_context.html#a1e2acc29a3643deffb5fff5b5ff91564">prev_frame</a>;    <span class="comment">// buffer for previous source frame</span></div>
<div class="line"><a name="l00043"></a><span class="lineno"><a class="line" href="struct_rpza_context.html#a5d1a3dc4f67e1e118311980ee122e6a8">   43</a></span>&#160;    <a class="code" href="struct_put_bit_context.html">PutBitContext</a> <a class="code" href="struct_rpza_context.html#a5d1a3dc4f67e1e118311980ee122e6a8">pb</a>;       <span class="comment">// buffer for encoded frame data.</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160; </div>
<div class="line"><a name="l00045"></a><span class="lineno"><a class="line" href="struct_rpza_context.html#a2a749b23b079d5e88bbc93ff3e27ad96">   45</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="struct_rpza_context.html#a2a749b23b079d5e88bbc93ff3e27ad96">frame_width</a>;        <span class="comment">// width in pixels of source frame</span></div>
<div class="line"><a name="l00046"></a><span class="lineno"><a class="line" href="struct_rpza_context.html#abe1f8209f09a8d2a9b0e541b3deb86b4">   46</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="struct_rpza_context.html#abe1f8209f09a8d2a9b0e541b3deb86b4">frame_height</a>;       <span class="comment">// height in pixesl of source frame</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160; </div>
<div class="line"><a name="l00048"></a><span class="lineno"><a class="line" href="struct_rpza_context.html#ac22ceb8218b7084b5572ebd65961e1c9">   48</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="struct_rpza_context.html#ac22ceb8218b7084b5572ebd65961e1c9">first_frame</a>;        <span class="comment">// flag set to one when the first frame is being processed</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;                            <span class="comment">// so that comparisons with previous frame data in not attempted</span></div>
<div class="line"><a name="l00050"></a><span class="lineno"><a class="line" href="rpzaenc_8c.html#a5a89bc6c6789d83f2bcced05841af59c">   50</a></span>&#160;} <a class="code" href="rpzaenc_8c.html#a5a89bc6c6789d83f2bcced05841af59c">RpzaContext</a>;</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160; </div>
<div class="line"><a name="l00052"></a><span class="lineno"><a class="line" href="rpzaenc_8c.html#a2ad296b3defe6bf8739eb9198dc29848">   52</a></span>&#160;<span class="keyword">typedef</span> <span class="keyword">enum</span> <a class="code" href="rpzaenc_8c.html#a2ad296b3defe6bf8739eb9198dc29848">channel_offset</a> {</div>
<div class="line"><a name="l00053"></a><span class="lineno"><a class="line" href="rpzaenc_8c.html#a2ad296b3defe6bf8739eb9198dc29848af80f9a890089d211842d59625e561f88">   53</a></span>&#160;    <a class="code" href="rpzaenc_8c.html#a2ad296b3defe6bf8739eb9198dc29848af80f9a890089d211842d59625e561f88">RED</a> = 2,</div>
<div class="line"><a name="l00054"></a><span class="lineno"><a class="line" href="rpzaenc_8c.html#a2ad296b3defe6bf8739eb9198dc29848aa60bd322f93178d68184e30e162571ca">   54</a></span>&#160;    <a class="code" href="rpzaenc_8c.html#a2ad296b3defe6bf8739eb9198dc29848aa60bd322f93178d68184e30e162571ca">GREEN</a> = 1,</div>
<div class="line"><a name="l00055"></a><span class="lineno"><a class="line" href="rpzaenc_8c.html#a2ad296b3defe6bf8739eb9198dc29848a35d6719cb4d7577c031b3d79057a1b79">   55</a></span>&#160;    <a class="code" href="rpzaenc_8c.html#a2ad296b3defe6bf8739eb9198dc29848a35d6719cb4d7577c031b3d79057a1b79">BLUE</a> = 0,</div>
<div class="line"><a name="l00056"></a><span class="lineno"><a class="line" href="rpzaenc_8c.html#a24ad99b46e1f7913e0a520c864286be8">   56</a></span>&#160;} <a class="code" href="rpzaenc_8c.html#a2ad296b3defe6bf8739eb9198dc29848">channel_offset</a>;</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160; </div>
<div class="line"><a name="l00058"></a><span class="lineno"><a class="line" href="structrgb.html">   58</a></span>&#160;<span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structrgb.html">rgb</a> {</div>
<div class="line"><a name="l00059"></a><span class="lineno"><a class="line" href="structrgb.html#afd9a3feaf22de2f96ba25d19494235a6">   59</a></span>&#160;    <a class="code" href="audio__convert_8c.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> <a class="code" href="structrgb.html#afd9a3feaf22de2f96ba25d19494235a6">r</a>;</div>
<div class="line"><a name="l00060"></a><span class="lineno"><a class="line" href="structrgb.html#a644713f43fbcf5e9f070fa1843aee55f">   60</a></span>&#160;    <a class="code" href="audio__convert_8c.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> <a class="code" href="structrgb.html#a644713f43fbcf5e9f070fa1843aee55f">g</a>;</div>
<div class="line"><a name="l00061"></a><span class="lineno"><a class="line" href="structrgb.html#a5ff4e0f515919a82c3f401afa8555da4">   61</a></span>&#160;    <a class="code" href="audio__convert_8c.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> <a class="code" href="structrgb.html#a5ff4e0f515919a82c3f401afa8555da4">b</a>;</div>
<div class="line"><a name="l00062"></a><span class="lineno"><a class="line" href="rpzaenc_8c.html#a7b8da94fb39e743a39c3835b2751d2ac">   62</a></span>&#160;} <a class="code" href="rpzaenc_8c.html#a7b8da94fb39e743a39c3835b2751d2ac">rgb</a>;</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160; </div>
<div class="line"><a name="l00064"></a><span class="lineno"><a class="line" href="rpzaenc_8c.html#aa7866fa5e4e0ee9b034e9dab6599a9cc">   64</a></span>&#160;<span class="preprocessor">#define SQR(x) ((x) * (x))</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160; </div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="comment">/* 15 bit components */</span></div>
<div class="line"><a name="l00067"></a><span class="lineno"><a class="line" href="rpzaenc_8c.html#ad7f25e97333df3583e8b6f9210b3c8ac">   67</a></span>&#160;<span class="preprocessor">#define GET_CHAN(color, chan) (((color) &gt;&gt; ((chan) * 5) &amp; 0x1F) * 8)</span></div>
<div class="line"><a name="l00068"></a><span class="lineno"><a class="line" href="rpzaenc_8c.html#ade8726343ca32cab0df4d619b18bf083">   68</a></span>&#160;<span class="preprocessor">#define R(color) GET_CHAN(color, RED)</span></div>
<div class="line"><a name="l00069"></a><span class="lineno"><a class="line" href="rpzaenc_8c.html#a7721ca941dbab8a1a0704d4bd60e513f">   69</a></span>&#160;<span class="preprocessor">#define G(color) GET_CHAN(color, GREEN)</span></div>
<div class="line"><a name="l00070"></a><span class="lineno"><a class="line" href="rpzaenc_8c.html#a934a37224d883fbf98cc009c755bd712">   70</a></span>&#160;<span class="preprocessor">#define B(color) GET_CHAN(color, BLUE)</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160; </div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="struct_block_info.html">BlockInfo</a> {</div>
<div class="line"><a name="l00073"></a><span class="lineno"><a class="line" href="struct_block_info.html#a85c923b58da3ac2f805e9a94c4e05a07">   73</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="struct_block_info.html#a85c923b58da3ac2f805e9a94c4e05a07">row</a>;</div>
<div class="line"><a name="l00074"></a><span class="lineno"><a class="line" href="struct_block_info.html#a035cd9d345ac386a03d437f62d267ab4">   74</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="struct_block_info.html#a035cd9d345ac386a03d437f62d267ab4">col</a>;</div>
<div class="line"><a name="l00075"></a><span class="lineno"><a class="line" href="struct_block_info.html#a58c12055ec745fa9afd52de0edd3a448">   75</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="struct_block_info.html#a58c12055ec745fa9afd52de0edd3a448">block_width</a>;</div>
<div class="line"><a name="l00076"></a><span class="lineno"><a class="line" href="struct_block_info.html#abe0f811ac0f0ff103d20b3e12a665dc5">   76</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="struct_block_info.html#abe0f811ac0f0ff103d20b3e12a665dc5">block_height</a>;</div>
<div class="line"><a name="l00077"></a><span class="lineno"><a class="line" href="struct_block_info.html#a39dbb3661c12346f3c73717d92344b0e">   77</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="struct_block_info.html#a39dbb3661c12346f3c73717d92344b0e">image_width</a>;</div>
<div class="line"><a name="l00078"></a><span class="lineno"><a class="line" href="struct_block_info.html#ab09b46083586081c17a1ac9ae62c05c4">   78</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="struct_block_info.html#ab09b46083586081c17a1ac9ae62c05c4">image_height</a>;</div>
<div class="line"><a name="l00079"></a><span class="lineno"><a class="line" href="struct_block_info.html#a7fda32c68236a78f7679f82a25b40212">   79</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="struct_block_info.html#a7fda32c68236a78f7679f82a25b40212">block_index</a>;</div>
<div class="line"><a name="l00080"></a><span class="lineno"><a class="line" href="struct_block_info.html#ad735c2b9940d3c557bb930075e4cd32f">   80</a></span>&#160;    uint16_t <a class="code" href="struct_block_info.html#ad735c2b9940d3c557bb930075e4cd32f">start</a>;</div>
<div class="line"><a name="l00081"></a><span class="lineno"><a class="line" href="struct_block_info.html#a04dcdd042d19bf1452dbbfc9aa580f65">   81</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="struct_block_info.html#a04dcdd042d19bf1452dbbfc9aa580f65">rowstride</a>;</div>
<div class="line"><a name="l00082"></a><span class="lineno"><a class="line" href="struct_block_info.html#ae69e376b474d2c9139b559c705d8b061">   82</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="struct_block_info.html#ae69e376b474d2c9139b559c705d8b061">blocks_per_row</a>;</div>
<div class="line"><a name="l00083"></a><span class="lineno"><a class="line" href="struct_block_info.html#ab1d9dc0124b778246522a68111b25661">   83</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="struct_block_info.html#ab1d9dc0124b778246522a68111b25661">total_blocks</a>;</div>
<div class="line"><a name="l00084"></a><span class="lineno"><a class="line" href="rpzaenc_8c.html#a10506cde2082afe0da80f03b36268036">   84</a></span>&#160;} <a class="code" href="rpzaenc_8c.html#a10506cde2082afe0da80f03b36268036">BlockInfo</a>;</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160; </div>
<div class="line"><a name="l00086"></a><span class="lineno"><a class="line" href="rpzaenc_8c.html#afc2496dfa0c1f410e6770d69c4c530ce">   86</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="rpzaenc_8c.html#afc2496dfa0c1f410e6770d69c4c530ce">get_colors</a>(<a class="code" href="audio__convert_8c.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> *<a class="code" href="vorbis__enc__data_8h.html#ad2e88d75f808e6d4e78d48bceb10c336">min</a>, <a class="code" href="audio__convert_8c.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> *<a class="code" href="cuda__runtime_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>, <a class="code" href="audio__convert_8c.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> color4[4][3])</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;{</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    <a class="code" href="audio__convert_8c.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> <a class="code" href="rate__distortion_8txt.html#a0e018beb061c7ac6d1f9121683a6f2c2">step</a>;</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160; </div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    color4[0][0] = <a class="code" href="vorbis__enc__data_8h.html#ad2e88d75f808e6d4e78d48bceb10c336">min</a>[0];</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    color4[0][1] = <a class="code" href="vorbis__enc__data_8h.html#ad2e88d75f808e6d4e78d48bceb10c336">min</a>[1];</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    color4[0][2] = <a class="code" href="vorbis__enc__data_8h.html#ad2e88d75f808e6d4e78d48bceb10c336">min</a>[2];</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160; </div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    color4[3][0] = <a class="code" href="cuda__runtime_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>[0];</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    color4[3][1] = <a class="code" href="cuda__runtime_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>[1];</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    color4[3][2] = <a class="code" href="cuda__runtime_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>[2];</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160; </div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    <span class="comment">// red components</span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    <a class="code" href="rate__distortion_8txt.html#a0e018beb061c7ac6d1f9121683a6f2c2">step</a> = (color4[3][0] - color4[0][0] + 1) / 3;</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    color4[1][0] = color4[0][0] + <a class="code" href="rate__distortion_8txt.html#a0e018beb061c7ac6d1f9121683a6f2c2">step</a>;</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    color4[2][0] = color4[3][0] - <a class="code" href="rate__distortion_8txt.html#a0e018beb061c7ac6d1f9121683a6f2c2">step</a>;</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160; </div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    <span class="comment">// green components</span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    <a class="code" href="rate__distortion_8txt.html#a0e018beb061c7ac6d1f9121683a6f2c2">step</a> = (color4[3][1] - color4[0][1] + 1) / 3;</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    color4[1][1] = color4[0][1] + <a class="code" href="rate__distortion_8txt.html#a0e018beb061c7ac6d1f9121683a6f2c2">step</a>;</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    color4[2][1] = color4[3][1] - <a class="code" href="rate__distortion_8txt.html#a0e018beb061c7ac6d1f9121683a6f2c2">step</a>;</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160; </div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    <span class="comment">// blue components</span></div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    <a class="code" href="rate__distortion_8txt.html#a0e018beb061c7ac6d1f9121683a6f2c2">step</a> = (color4[3][2] - color4[0][2] + 1) / 3;</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    color4[1][2] = color4[0][2] + <a class="code" href="rate__distortion_8txt.html#a0e018beb061c7ac6d1f9121683a6f2c2">step</a>;</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    color4[2][2] = color4[3][2] - <a class="code" href="rate__distortion_8txt.html#a0e018beb061c7ac6d1f9121683a6f2c2">step</a>;</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;}</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160; </div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="comment">/* Fill BlockInfo struct with information about a 4x4 block of the image */</span></div>
<div class="line"><a name="l00115"></a><span class="lineno"><a class="line" href="rpzaenc_8c.html#a6797c5a614c0d81c5031b80901282e55">  115</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="rpzaenc_8c.html#a6797c5a614c0d81c5031b80901282e55">get_block_info</a>(<a class="code" href="struct_block_info.html">BlockInfo</a> *bi, <span class="keywordtype">int</span> <a class="code" href="filter__design_8txt.html#a17afa58b2bc574dedcd1cc02e1fdf165">block</a>)</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;{</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    bi-&gt;<a class="code" href="struct_block_info.html#a85c923b58da3ac2f805e9a94c4e05a07">row</a> = <a class="code" href="filter__design_8txt.html#a17afa58b2bc574dedcd1cc02e1fdf165">block</a> / bi-&gt;<a class="code" href="struct_block_info.html#ae69e376b474d2c9139b559c705d8b061">blocks_per_row</a>;</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    bi-&gt;<a class="code" href="struct_block_info.html#a035cd9d345ac386a03d437f62d267ab4">col</a> = <a class="code" href="filter__design_8txt.html#a17afa58b2bc574dedcd1cc02e1fdf165">block</a> % bi-&gt;<a class="code" href="struct_block_info.html#ae69e376b474d2c9139b559c705d8b061">blocks_per_row</a>;</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160; </div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    <span class="comment">// test for right edge block</span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    <span class="keywordflow">if</span> (bi-&gt;<a class="code" href="struct_block_info.html#a035cd9d345ac386a03d437f62d267ab4">col</a> == bi-&gt;<a class="code" href="struct_block_info.html#ae69e376b474d2c9139b559c705d8b061">blocks_per_row</a> - 1 &amp;&amp; (bi-&gt;<a class="code" href="struct_block_info.html#a39dbb3661c12346f3c73717d92344b0e">image_width</a> % 4) != 0) {</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;        bi-&gt;<a class="code" href="struct_block_info.html#a58c12055ec745fa9afd52de0edd3a448">block_width</a> = bi-&gt;<a class="code" href="struct_block_info.html#a39dbb3661c12346f3c73717d92344b0e">image_width</a> % 4;</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;        bi-&gt;<a class="code" href="struct_block_info.html#a58c12055ec745fa9afd52de0edd3a448">block_width</a> = 4;</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    }</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160; </div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    <span class="comment">// test for bottom edge block</span></div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    <span class="keywordflow">if</span> (bi-&gt;<a class="code" href="struct_block_info.html#a85c923b58da3ac2f805e9a94c4e05a07">row</a> == (bi-&gt;<a class="code" href="struct_block_info.html#ab09b46083586081c17a1ac9ae62c05c4">image_height</a> / 4) &amp;&amp; (bi-&gt;<a class="code" href="struct_block_info.html#ab09b46083586081c17a1ac9ae62c05c4">image_height</a> % 4) != 0) {</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;        bi-&gt;<a class="code" href="struct_block_info.html#abe0f811ac0f0ff103d20b3e12a665dc5">block_height</a> = bi-&gt;<a class="code" href="struct_block_info.html#ab09b46083586081c17a1ac9ae62c05c4">image_height</a> % 4;</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;        bi-&gt;<a class="code" href="struct_block_info.html#abe0f811ac0f0ff103d20b3e12a665dc5">block_height</a> = 4;</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    }</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160; </div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#a17afa58b2bc574dedcd1cc02e1fdf165">block</a> ? (bi-&gt;<a class="code" href="struct_block_info.html#a035cd9d345ac386a03d437f62d267ab4">col</a> * 4) + (bi-&gt;<a class="code" href="struct_block_info.html#a85c923b58da3ac2f805e9a94c4e05a07">row</a> * bi-&gt;<a class="code" href="struct_block_info.html#a04dcdd042d19bf1452dbbfc9aa580f65">rowstride</a> * 4) : 0;</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;}</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160; </div>
<div class="line"><a name="l00137"></a><span class="lineno"><a class="line" href="rpzaenc_8c.html#ab6c31af54a7b8ae8e20957fb3cd97f10">  137</a></span>&#160;<span class="keyword">static</span> uint16_t <a class="code" href="rpzaenc_8c.html#ab6c31af54a7b8ae8e20957fb3cd97f10">rgb24_to_rgb555</a>(<a class="code" href="audio__convert_8c.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> *rgb24)</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;{</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    uint16_t rgb555 = 0;</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    uint32_t <a class="code" href="vf__curves_8c.html#a33ac7b8ce37a3a60855883424fcf8b62">r</a>, <a class="code" href="vf__curves_8c.html#a1b5e77b92dea40e646b2e7e196e0b322">g</a>, <a class="code" href="input_8c.html#ad6cdb6a14abe3eab42eaaadc93409aec">b</a>;</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160; </div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    <a class="code" href="vf__curves_8c.html#a33ac7b8ce37a3a60855883424fcf8b62">r</a> = rgb24[0] &gt;&gt; 3;</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    <a class="code" href="vf__curves_8c.html#a1b5e77b92dea40e646b2e7e196e0b322">g</a> = rgb24[1] &gt;&gt; 3;</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    <a class="code" href="input_8c.html#ad6cdb6a14abe3eab42eaaadc93409aec">b</a> = rgb24[2] &gt;&gt; 3;</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160; </div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    rgb555 |= (<a class="code" href="vf__curves_8c.html#a33ac7b8ce37a3a60855883424fcf8b62">r</a> &lt;&lt; 10);</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    rgb555 |= (<a class="code" href="vf__curves_8c.html#a1b5e77b92dea40e646b2e7e196e0b322">g</a> &lt;&lt; 5);</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    rgb555 |= (<a class="code" href="input_8c.html#ad6cdb6a14abe3eab42eaaadc93409aec">b</a> &lt;&lt; 0);</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160; </div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    <span class="keywordflow">return</span> rgb555;</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;}</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160; </div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="comment"> * Returns the total difference between two 24 bit color values</span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00156"></a><span class="lineno"><a class="line" href="rpzaenc_8c.html#a7fb1cb42a3c0a283e5f267363fcb647a">  156</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="rpzaenc_8c.html#a7fb1cb42a3c0a283e5f267363fcb647a">diff_colors</a>(<a class="code" href="audio__convert_8c.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> *colorA, <a class="code" href="audio__convert_8c.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> *colorB)</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;{</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    <span class="keywordtype">int</span> tot;</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160; </div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    tot  = <a class="code" href="rpzaenc_8c.html#aa7866fa5e4e0ee9b034e9dab6599a9cc">SQR</a>(colorA[0] - colorB[0]);</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    tot += <a class="code" href="rpzaenc_8c.html#aa7866fa5e4e0ee9b034e9dab6599a9cc">SQR</a>(colorA[1] - colorB[1]);</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    tot += <a class="code" href="rpzaenc_8c.html#aa7866fa5e4e0ee9b034e9dab6599a9cc">SQR</a>(colorA[2] - colorB[2]);</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160; </div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    <span class="keywordflow">return</span> tot;</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;}</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160; </div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;<span class="comment"> * Returns the maximum channel difference</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00170"></a><span class="lineno"><a class="line" href="rpzaenc_8c.html#a711276ee24330e7c2608f21b73c7568f">  170</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="rpzaenc_8c.html#a711276ee24330e7c2608f21b73c7568f">max_component_diff</a>(uint16_t *colorA, uint16_t *colorB)</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;{</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="vf__palettegen_8c.html#a0fa5abf62b01f8a592bca729cb14390b">diff</a>, <a class="code" href="cuda__runtime_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a> = 0;</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160; </div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    <a class="code" href="vf__palettegen_8c.html#a0fa5abf62b01f8a592bca729cb14390b">diff</a> = <a class="code" href="common_8h.html#ad6d88940cfc29c13a3e51ded211fc242">FFABS</a>(<a class="code" href="rpzaenc_8c.html#ade8726343ca32cab0df4d619b18bf083">R</a>(colorA[0]) - <a class="code" href="rpzaenc_8c.html#ade8726343ca32cab0df4d619b18bf083">R</a>(colorB[0]));</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="vf__palettegen_8c.html#a0fa5abf62b01f8a592bca729cb14390b">diff</a> &gt; <a class="code" href="cuda__runtime_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>) {</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;        <a class="code" href="cuda__runtime_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a> = <a class="code" href="vf__palettegen_8c.html#a0fa5abf62b01f8a592bca729cb14390b">diff</a>;</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    }</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    <a class="code" href="vf__palettegen_8c.html#a0fa5abf62b01f8a592bca729cb14390b">diff</a> = <a class="code" href="common_8h.html#ad6d88940cfc29c13a3e51ded211fc242">FFABS</a>(<a class="code" href="rpzaenc_8c.html#a7721ca941dbab8a1a0704d4bd60e513f">G</a>(colorA[0]) - <a class="code" href="rpzaenc_8c.html#a7721ca941dbab8a1a0704d4bd60e513f">G</a>(colorB[0]));</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="vf__palettegen_8c.html#a0fa5abf62b01f8a592bca729cb14390b">diff</a> &gt; <a class="code" href="cuda__runtime_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>) {</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;        <a class="code" href="cuda__runtime_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a> = <a class="code" href="vf__palettegen_8c.html#a0fa5abf62b01f8a592bca729cb14390b">diff</a>;</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    }</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    <a class="code" href="vf__palettegen_8c.html#a0fa5abf62b01f8a592bca729cb14390b">diff</a> = <a class="code" href="common_8h.html#ad6d88940cfc29c13a3e51ded211fc242">FFABS</a>(<a class="code" href="rpzaenc_8c.html#a934a37224d883fbf98cc009c755bd712">B</a>(colorA[0]) - <a class="code" href="rpzaenc_8c.html#a934a37224d883fbf98cc009c755bd712">B</a>(colorB[0]));</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="vf__palettegen_8c.html#a0fa5abf62b01f8a592bca729cb14390b">diff</a> &gt; <a class="code" href="cuda__runtime_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>) {</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;        <a class="code" href="cuda__runtime_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a> = <a class="code" href="vf__palettegen_8c.html#a0fa5abf62b01f8a592bca729cb14390b">diff</a>;</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    }</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="cuda__runtime_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a> * 8;</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;}</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160; </div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;<span class="comment"> * Find the channel that has the largest difference between minimum and maximum</span></div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;<span class="comment"> * color values. Put the minimum value in min, maximum in max and the channel</span></div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;<span class="comment"> * in chan.</span></div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00194"></a><span class="lineno"><a class="line" href="rpzaenc_8c.html#a011934ef56f31ee369d5376b3c597fcc">  194</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="rpzaenc_8c.html#a011934ef56f31ee369d5376b3c597fcc">get_max_component_diff</a>(<a class="code" href="struct_block_info.html">BlockInfo</a> *bi, uint16_t *block_ptr,</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;                                   <a class="code" href="audio__convert_8c.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> *<a class="code" href="vorbis__enc__data_8h.html#ad2e88d75f808e6d4e78d48bceb10c336">min</a>, <a class="code" href="audio__convert_8c.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> *<a class="code" href="cuda__runtime_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>, <a class="code" href="rpzaenc_8c.html#a2ad296b3defe6bf8739eb9198dc29848">channel_offset</a> *chan)</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;{</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    <span class="keywordtype">int</span> x, y;</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    <a class="code" href="audio__convert_8c.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> min_r, max_r, min_g, max_g, min_b, max_b;</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    <a class="code" href="audio__convert_8c.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> <a class="code" href="vf__curves_8c.html#a33ac7b8ce37a3a60855883424fcf8b62">r</a>, <a class="code" href="vf__curves_8c.html#a1b5e77b92dea40e646b2e7e196e0b322">g</a>, <a class="code" href="input_8c.html#ad6cdb6a14abe3eab42eaaadc93409aec">b</a>;</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160; </div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    <span class="comment">// fix warning about uninitialized vars</span></div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    min_r = min_g = min_b = UINT8_MAX;</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    max_r = max_g = max_b = 0;</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160; </div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    <span class="comment">// loop thru and compare pixels</span></div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    <span class="keywordflow">for</span> (y = 0; y &lt; bi-&gt;<a class="code" href="struct_block_info.html#abe0f811ac0f0ff103d20b3e12a665dc5">block_height</a>; y++) {</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;        <span class="keywordflow">for</span> (x = 0; x &lt; bi-&gt;<a class="code" href="struct_block_info.html#a58c12055ec745fa9afd52de0edd3a448">block_width</a>; x++){</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;            <span class="comment">// TODO:  optimize</span></div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;            min_r = <a class="code" href="common_8h.html#a0f84cbd7fd810cd678157c98cbfad4b0">FFMIN</a>(<a class="code" href="rpzaenc_8c.html#ade8726343ca32cab0df4d619b18bf083">R</a>(block_ptr[x]), min_r);</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;            min_g = <a class="code" href="common_8h.html#a0f84cbd7fd810cd678157c98cbfad4b0">FFMIN</a>(<a class="code" href="rpzaenc_8c.html#a7721ca941dbab8a1a0704d4bd60e513f">G</a>(block_ptr[x]), min_g);</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;            min_b = <a class="code" href="common_8h.html#a0f84cbd7fd810cd678157c98cbfad4b0">FFMIN</a>(<a class="code" href="rpzaenc_8c.html#a934a37224d883fbf98cc009c755bd712">B</a>(block_ptr[x]), min_b);</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160; </div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;            max_r = <a class="code" href="common_8h.html#a9960bd6780a9b16a216a57be1ee04359">FFMAX</a>(<a class="code" href="rpzaenc_8c.html#ade8726343ca32cab0df4d619b18bf083">R</a>(block_ptr[x]), max_r);</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;            max_g = <a class="code" href="common_8h.html#a9960bd6780a9b16a216a57be1ee04359">FFMAX</a>(<a class="code" href="rpzaenc_8c.html#a7721ca941dbab8a1a0704d4bd60e513f">G</a>(block_ptr[x]), max_g);</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;            max_b = <a class="code" href="common_8h.html#a9960bd6780a9b16a216a57be1ee04359">FFMAX</a>(<a class="code" href="rpzaenc_8c.html#a934a37224d883fbf98cc009c755bd712">B</a>(block_ptr[x]), max_b);</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;        }</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;        block_ptr += bi-&gt;<a class="code" href="struct_block_info.html#a04dcdd042d19bf1452dbbfc9aa580f65">rowstride</a>;</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    }</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160; </div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    <a class="code" href="vf__curves_8c.html#a33ac7b8ce37a3a60855883424fcf8b62">r</a> = max_r - min_r;</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    <a class="code" href="vf__curves_8c.html#a1b5e77b92dea40e646b2e7e196e0b322">g</a> = max_g - min_g;</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    <a class="code" href="input_8c.html#ad6cdb6a14abe3eab42eaaadc93409aec">b</a> = max_b - min_b;</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160; </div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="vf__curves_8c.html#a33ac7b8ce37a3a60855883424fcf8b62">r</a> &gt; <a class="code" href="vf__curves_8c.html#a1b5e77b92dea40e646b2e7e196e0b322">g</a> &amp;&amp; <a class="code" href="vf__curves_8c.html#a33ac7b8ce37a3a60855883424fcf8b62">r</a> &gt; <a class="code" href="input_8c.html#ad6cdb6a14abe3eab42eaaadc93409aec">b</a>) {</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;        *<a class="code" href="cuda__runtime_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a> = max_r;</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;        *<a class="code" href="vorbis__enc__data_8h.html#ad2e88d75f808e6d4e78d48bceb10c336">min</a> = min_r;</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;        *chan = <a class="code" href="rpzaenc_8c.html#a2ad296b3defe6bf8739eb9198dc29848af80f9a890089d211842d59625e561f88">RED</a>;</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="vf__curves_8c.html#a1b5e77b92dea40e646b2e7e196e0b322">g</a> &gt; <a class="code" href="input_8c.html#ad6cdb6a14abe3eab42eaaadc93409aec">b</a> &amp;&amp; <a class="code" href="vf__curves_8c.html#a1b5e77b92dea40e646b2e7e196e0b322">g</a> &gt;= <a class="code" href="vf__curves_8c.html#a33ac7b8ce37a3a60855883424fcf8b62">r</a>) {</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;        *<a class="code" href="cuda__runtime_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a> = max_g;</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;        *<a class="code" href="vorbis__enc__data_8h.html#ad2e88d75f808e6d4e78d48bceb10c336">min</a> = min_g;</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;        *chan = <a class="code" href="rpzaenc_8c.html#a2ad296b3defe6bf8739eb9198dc29848aa60bd322f93178d68184e30e162571ca">GREEN</a>;</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;        *<a class="code" href="cuda__runtime_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a> = max_b;</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;        *<a class="code" href="vorbis__enc__data_8h.html#ad2e88d75f808e6d4e78d48bceb10c336">min</a> = min_b;</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;        *chan = <a class="code" href="rpzaenc_8c.html#a2ad296b3defe6bf8739eb9198dc29848a35d6719cb4d7577c031b3d79057a1b79">BLUE</a>;</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    }</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;}</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160; </div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;<span class="comment"> * Compare two 4x4 blocks to determine if the total difference between the</span></div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;<span class="comment"> * blocks is greater than the thresh parameter. Returns -1 if difference</span></div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;<span class="comment"> * exceeds threshold or zero otherwise.</span></div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00244"></a><span class="lineno"><a class="line" href="rpzaenc_8c.html#a8bb03d53e86036fc6dbc7948a10c7a3c">  244</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="rpzaenc_8c.html#a8bb03d53e86036fc6dbc7948a10c7a3c">compare_blocks</a>(uint16_t *block1, uint16_t *block2, <a class="code" href="struct_block_info.html">BlockInfo</a> *bi, <span class="keywordtype">int</span> thresh)</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;{</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    <span class="keywordtype">int</span> x, y, <a class="code" href="vf__palettegen_8c.html#a0fa5abf62b01f8a592bca729cb14390b">diff</a> = 0;</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    <span class="keywordflow">for</span> (y = 0; y &lt; bi-&gt;<a class="code" href="struct_block_info.html#abe0f811ac0f0ff103d20b3e12a665dc5">block_height</a>; y++) {</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;        <span class="keywordflow">for</span> (x = 0; x &lt; bi-&gt;<a class="code" href="struct_block_info.html#a58c12055ec745fa9afd52de0edd3a448">block_width</a>; x++) {</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;            <a class="code" href="vf__palettegen_8c.html#a0fa5abf62b01f8a592bca729cb14390b">diff</a> = <a class="code" href="rpzaenc_8c.html#a711276ee24330e7c2608f21b73c7568f">max_component_diff</a>(&amp;block1[x], &amp;block2[x]);</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="vf__palettegen_8c.html#a0fa5abf62b01f8a592bca729cb14390b">diff</a> &gt;= thresh) {</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;                <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;            }</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;        }</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;        block1 += bi-&gt;<a class="code" href="struct_block_info.html#a04dcdd042d19bf1452dbbfc9aa580f65">rowstride</a>;</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;        block2 += bi-&gt;<a class="code" href="struct_block_info.html#a04dcdd042d19bf1452dbbfc9aa580f65">rowstride</a>;</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    }</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;}</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160; </div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;<span class="comment"> * Determine the fit of one channel to another within a 4x4 block. This</span></div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;<span class="comment"> * is used to determine the best palette choices for 4-color encoding.</span></div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00264"></a><span class="lineno"><a class="line" href="rpzaenc_8c.html#ae6a544dddf9c76654d304d3567c78e65">  264</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="rpzaenc_8c.html#ae6a544dddf9c76654d304d3567c78e65">leastsquares</a>(uint16_t *block_ptr, <a class="code" href="struct_block_info.html">BlockInfo</a> *bi,</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;                        <a class="code" href="rpzaenc_8c.html#a2ad296b3defe6bf8739eb9198dc29848">channel_offset</a> xchannel, <a class="code" href="rpzaenc_8c.html#a2ad296b3defe6bf8739eb9198dc29848">channel_offset</a> ychannel,</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;                        <span class="keywordtype">double</span> *slope, <span class="keywordtype">double</span> *y_intercept, <span class="keywordtype">double</span> *correlation_coef)</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;{</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    <span class="keywordtype">double</span> sumx = 0, sumy = 0, sumx2 = 0, sumy2 = 0, sumxy = 0,</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;           sumx_sq = 0, sumy_sq = 0, tmp, tmp2;</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>, j, count;</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    <a class="code" href="audio__convert_8c.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> x, y;</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160; </div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    count = bi-&gt;<a class="code" href="struct_block_info.html#abe0f811ac0f0ff103d20b3e12a665dc5">block_height</a> * bi-&gt;<a class="code" href="struct_block_info.html#a58c12055ec745fa9afd52de0edd3a448">block_width</a>;</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160; </div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    <span class="keywordflow">if</span> (count &lt; 2)</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;        <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160; </div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; bi-&gt;<a class="code" href="struct_block_info.html#abe0f811ac0f0ff103d20b3e12a665dc5">block_height</a>; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;        <span class="keywordflow">for</span> (j = 0; j &lt; bi-&gt;<a class="code" href="struct_block_info.html#a58c12055ec745fa9afd52de0edd3a448">block_width</a>; j++){</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;            x = <a class="code" href="rpzaenc_8c.html#ad7f25e97333df3583e8b6f9210b3c8ac">GET_CHAN</a>(block_ptr[j], xchannel);</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;            y = <a class="code" href="rpzaenc_8c.html#ad7f25e97333df3583e8b6f9210b3c8ac">GET_CHAN</a>(block_ptr[j], ychannel);</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;            sumx += x;</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;            sumy += y;</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;            sumx2 += x * x;</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;            sumy2 += y * y;</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;            sumxy += x * y;</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;        }</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;        block_ptr += bi-&gt;<a class="code" href="struct_block_info.html#a04dcdd042d19bf1452dbbfc9aa580f65">rowstride</a>;</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    }</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160; </div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    sumx_sq = sumx * sumx;</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    tmp = (count * sumx2 - sumx_sq);</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160; </div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    <span class="comment">// guard against div/0</span></div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    <span class="keywordflow">if</span> (tmp == 0)</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;        <span class="keywordflow">return</span> -2;</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160; </div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    sumy_sq = sumy * sumy;</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160; </div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    *slope = (sumx * sumy - sumxy) / tmp;</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    *y_intercept = (sumy - (*slope) * sumx) / count;</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160; </div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    tmp2 = count * sumy2 - sumy_sq;</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    <span class="keywordflow">if</span> (tmp2 == 0) {</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;        *correlation_coef = 0.0;</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;        *correlation_coef = (count * sumxy - sumx * sumy) /</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;            sqrt(tmp * tmp2);</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    }</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160; </div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    <span class="keywordflow">return</span> 0; <span class="comment">// success</span></div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;}</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160; </div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;<span class="comment"> * Determine the amount of error in the leastsquares fit.</span></div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00317"></a><span class="lineno"><a class="line" href="rpzaenc_8c.html#a03535304966cd4b7dfd78c6f7b2819fe">  317</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="rpzaenc_8c.html#a03535304966cd4b7dfd78c6f7b2819fe">calc_lsq_max_fit_error</a>(uint16_t *block_ptr, <a class="code" href="struct_block_info.html">BlockInfo</a> *bi,</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;                                  <span class="keywordtype">int</span> <a class="code" href="vorbis__enc__data_8h.html#ad2e88d75f808e6d4e78d48bceb10c336">min</a>, <span class="keywordtype">int</span> <a class="code" href="cuda__runtime_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>, <span class="keywordtype">int</span> tmp_min, <span class="keywordtype">int</span> tmp_max,</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;                                  <a class="code" href="rpzaenc_8c.html#a2ad296b3defe6bf8739eb9198dc29848">channel_offset</a> xchannel, <a class="code" href="rpzaenc_8c.html#a2ad296b3defe6bf8739eb9198dc29848">channel_offset</a> ychannel)</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;{</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>, j, x, y;</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    <span class="keywordtype">int</span> err;</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    <span class="keywordtype">int</span> max_err = 0;</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160; </div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; bi-&gt;<a class="code" href="struct_block_info.html#abe0f811ac0f0ff103d20b3e12a665dc5">block_height</a>; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;        <span class="keywordflow">for</span> (j = 0; j &lt; bi-&gt;<a class="code" href="struct_block_info.html#a58c12055ec745fa9afd52de0edd3a448">block_width</a>; j++){</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;            <span class="keywordtype">int</span> x_inc, lin_y, lin_x;</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;            x = <a class="code" href="rpzaenc_8c.html#ad7f25e97333df3583e8b6f9210b3c8ac">GET_CHAN</a>(block_ptr[j], xchannel);</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;            y = <a class="code" href="rpzaenc_8c.html#ad7f25e97333df3583e8b6f9210b3c8ac">GET_CHAN</a>(block_ptr[j], ychannel);</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160; </div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;            <span class="comment">/* calculate x_inc as the 4-color index (0..3) */</span></div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;            x_inc = <a class="code" href="cuda__runtime_8h.html#ab49e3b691545ec566bbf71491e06504c">floor</a>( (x - <a class="code" href="vorbis__enc__data_8h.html#ad2e88d75f808e6d4e78d48bceb10c336">min</a>) * 3.0 / (<a class="code" href="cuda__runtime_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a> - <a class="code" href="vorbis__enc__data_8h.html#ad2e88d75f808e6d4e78d48bceb10c336">min</a>) + 0.5);</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;            x_inc = <a class="code" href="common_8h.html#a9960bd6780a9b16a216a57be1ee04359">FFMAX</a>(<a class="code" href="common_8h.html#a0f84cbd7fd810cd678157c98cbfad4b0">FFMIN</a>(3, x_inc), 0);</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160; </div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;            <span class="comment">/* calculate lin_y corresponding to x_inc */</span></div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;            lin_y = (<a class="code" href="ffmpeg__filter_8c.html#a61569f2965b7a369eb10b6d75d410d11">int</a>)(tmp_min + (tmp_max - tmp_min) * x_inc / 3.0 + 0.5);</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160; </div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;            err = <a class="code" href="common_8h.html#ad6d88940cfc29c13a3e51ded211fc242">FFABS</a>(lin_y - y);</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;            <span class="keywordflow">if</span> (err &gt; max_err)</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;                max_err = err;</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160; </div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;            <span class="comment">/* calculate lin_x corresponding to x_inc */</span></div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;            lin_x = (<a class="code" href="ffmpeg__filter_8c.html#a61569f2965b7a369eb10b6d75d410d11">int</a>)(<a class="code" href="vorbis__enc__data_8h.html#ad2e88d75f808e6d4e78d48bceb10c336">min</a> + (<a class="code" href="cuda__runtime_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a> - <a class="code" href="vorbis__enc__data_8h.html#ad2e88d75f808e6d4e78d48bceb10c336">min</a>) * x_inc / 3.0 + 0.5);</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160; </div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;            err = <a class="code" href="common_8h.html#ad6d88940cfc29c13a3e51ded211fc242">FFABS</a>(lin_x - x);</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;            <span class="keywordflow">if</span> (err &gt; max_err)</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;                max_err += err;</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;        }</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;        block_ptr += bi-&gt;<a class="code" href="struct_block_info.html#a04dcdd042d19bf1452dbbfc9aa580f65">rowstride</a>;</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    }</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160; </div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    <span class="keywordflow">return</span> max_err;</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;}</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160; </div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;<span class="comment"> * Find the closest match to a color within the 4-color palette</span></div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00358"></a><span class="lineno"><a class="line" href="rpzaenc_8c.html#a8814f46d12fa3078f121b7912e83face">  358</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="rpzaenc_8c.html#a8814f46d12fa3078f121b7912e83face">match_color</a>(uint16_t *<a class="code" href="structcolor.html">color</a>, <a class="code" href="audio__convert_8c.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> colors[4][3])</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;{</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = 0;</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    <span class="keywordtype">int</span> smallest_variance = INT_MAX;</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    <a class="code" href="audio__convert_8c.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> dithered_color[3];</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160; </div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="ebur128_8h.html#af4463779bb9b119822c94419a10d31c0">channel</a> = 0; <a class="code" href="ebur128_8h.html#af4463779bb9b119822c94419a10d31c0">channel</a> &lt; 3; <a class="code" href="ebur128_8h.html#af4463779bb9b119822c94419a10d31c0">channel</a>++) {</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;        dithered_color[<a class="code" href="ebur128_8h.html#af4463779bb9b119822c94419a10d31c0">channel</a>] = <a class="code" href="rpzaenc_8c.html#ad7f25e97333df3583e8b6f9210b3c8ac">GET_CHAN</a>(<a class="code" href="structcolor.html">color</a>[0], <a class="code" href="ebur128_8h.html#af4463779bb9b119822c94419a10d31c0">channel</a>);</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;    }</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160; </div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> palette_entry = 0; palette_entry &lt; 4; palette_entry++) {</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;        <span class="keywordtype">int</span> variance = <a class="code" href="rpzaenc_8c.html#a7fb1cb42a3c0a283e5f267363fcb647a">diff_colors</a>(dithered_color, colors[palette_entry]);</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160; </div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;        <span class="keywordflow">if</span> (variance &lt; smallest_variance) {</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;            smallest_variance = variance;</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;            <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = palette_entry;</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;        }</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    }</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160; </div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>;</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;}</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160; </div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;<span class="comment"> * Encode a block using the 4-color opcode and palette. return number of</span></div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;<span class="comment"> * blocks encoded (until we implement multi-block 4 color runs this will</span></div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;<span class="comment"> * always be 1)</span></div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00385"></a><span class="lineno"><a class="line" href="rpzaenc_8c.html#ad6d3e8316b2ce25d894b8c58a1fbcdaf">  385</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="rpzaenc_8c.html#ad6d3e8316b2ce25d894b8c58a1fbcdaf">encode_four_color_block</a>(<a class="code" href="audio__convert_8c.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> *min_color, <a class="code" href="audio__convert_8c.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> *max_color,</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;                                   <a class="code" href="struct_put_bit_context.html">PutBitContext</a> *pb, uint16_t *block_ptr, <a class="code" href="struct_block_info.html">BlockInfo</a> *bi)</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;{</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;    <span class="keywordtype">int</span> x, y, idx;</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;    <a class="code" href="audio__convert_8c.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> color4[4][3];</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    uint16_t rounded_max, rounded_min;</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160; </div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    <span class="comment">// round min and max wider</span></div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    rounded_min = <a class="code" href="rpzaenc_8c.html#ab6c31af54a7b8ae8e20957fb3cd97f10">rgb24_to_rgb555</a>(min_color);</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    rounded_max = <a class="code" href="rpzaenc_8c.html#ab6c31af54a7b8ae8e20957fb3cd97f10">rgb24_to_rgb555</a>(max_color);</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160; </div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    <span class="comment">// put a and b colors</span></div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    <span class="comment">// encode 4 colors = first 16 bit color with MSB zeroed and...</span></div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    <a class="code" href="j2kenc_8c.html#aafc5fd946cab2b9d67be29d48099f703">put_bits</a>(pb, 16, rounded_max &amp; ~0x8000);</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    <span class="comment">// ...second 16 bit color with MSB on.</span></div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    <a class="code" href="j2kenc_8c.html#aafc5fd946cab2b9d67be29d48099f703">put_bits</a>(pb, 16, rounded_min | 0x8000);</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160; </div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    <a class="code" href="rpzaenc_8c.html#afc2496dfa0c1f410e6770d69c4c530ce">get_colors</a>(min_color, max_color, color4);</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160; </div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    <span class="keywordflow">for</span> (y = 0; y &lt; 4; y++) {</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;        <span class="keywordflow">for</span> (x = 0; x &lt; 4; x++) {</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;            idx = <a class="code" href="rpzaenc_8c.html#a8814f46d12fa3078f121b7912e83face">match_color</a>(&amp;block_ptr[x], color4);</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;            <a class="code" href="j2kenc_8c.html#aafc5fd946cab2b9d67be29d48099f703">put_bits</a>(pb, 2, idx);</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;        }</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;        block_ptr += bi-&gt;<a class="code" href="struct_block_info.html#a04dcdd042d19bf1452dbbfc9aa580f65">rowstride</a>;</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    }</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    <span class="keywordflow">return</span> 1; <span class="comment">// num blocks encoded</span></div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;}</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160; </div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;<span class="comment"> * Copy a 4x4 block from the current frame buffer to the previous frame buffer.</span></div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00417"></a><span class="lineno"><a class="line" href="rpzaenc_8c.html#a7dd0564d2f1c8ce1b1fb900ac265a03b">  417</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="rpzaenc_8c.html#a7dd0564d2f1c8ce1b1fb900ac265a03b">update_block_in_prev_frame</a>(<span class="keyword">const</span> uint16_t *src_pixels,</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;                                       uint16_t *dest_pixels,</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;                                       <span class="keyword">const</span> <a class="code" href="struct_block_info.html">BlockInfo</a> *bi, <span class="keywordtype">int</span> block_counter)</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;{</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> y = 0; y &lt; 4; y++) {</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;        memcpy(dest_pixels, src_pixels, 8);</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;        dest_pixels += bi-&gt;<a class="code" href="struct_block_info.html#a04dcdd042d19bf1452dbbfc9aa580f65">rowstride</a>;</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;        src_pixels += bi-&gt;<a class="code" href="struct_block_info.html#a04dcdd042d19bf1452dbbfc9aa580f65">rowstride</a>;</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    }</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;}</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160; </div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;<span class="comment"> * update statistics for the specified block. If first_block,</span></div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;<span class="comment"> * it initializes the statistics.  Otherwise it updates the statistics IF THIS</span></div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;<span class="comment"> * BLOCK IS SUITABLE TO CONTINUE A 1-COLOR RUN. That is, it checks whether</span></div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;<span class="comment"> * the range of colors (since the routine was called first_block != 0) are</span></div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;<span class="comment"> * all close enough intensities to be represented by a single color.</span></div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;<span class="comment"> * The routine returns 0 if this block is too different to be part of</span></div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;<span class="comment"> * the same run of 1-color blocks. The routine returns 1 if this</span></div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;<span class="comment"> * block can be part of the same 1-color block run.</span></div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;<span class="comment"> * If the routine returns 1, it also updates its arguments to include</span></div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;<span class="comment"> * the statistics of this block. Otherwise, the stats are unchanged</span></div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;<span class="comment"> * and don&#39;t include the current block.</span></div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00443"></a><span class="lineno"><a class="line" href="rpzaenc_8c.html#acf0ec3c727fd0f0c4654ce4f1db61b57">  443</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="rpzaenc_8c.html#acf0ec3c727fd0f0c4654ce4f1db61b57">update_block_stats</a>(<a class="code" href="struct_rpza_context.html">RpzaContext</a> *<a class="code" href="cbs__vp9_8c.html#a5950eda76c8ffc67651de936cd8c79ec">s</a>, <a class="code" href="struct_block_info.html">BlockInfo</a> *bi, uint16_t *<a class="code" href="filter__design_8txt.html#a17afa58b2bc574dedcd1cc02e1fdf165">block</a>,</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;                              <a class="code" href="audio__convert_8c.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> min_color[3], <a class="code" href="audio__convert_8c.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> max_color[3],</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;                              <span class="keywordtype">int</span> *total_rgb, <span class="keywordtype">int</span> *total_pixels,</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;                              <a class="code" href="audio__convert_8c.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> avg_color[3], <span class="keywordtype">int</span> first_block)</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;{</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    <span class="keywordtype">int</span> x, y;</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    <span class="keywordtype">int</span> is_in_range;</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    <span class="keywordtype">int</span> total_pixels_blk;</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    <span class="keywordtype">int</span> threshold;</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160; </div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    <a class="code" href="audio__convert_8c.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> min_color_blk[3], max_color_blk[3];</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;    <span class="keywordtype">int</span> total_rgb_blk[3];</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    <a class="code" href="audio__convert_8c.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> avg_color_blk[3];</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160; </div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;    <span class="keywordflow">if</span> (first_block) {</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;        min_color[0] = UINT8_MAX;</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;        min_color[1] = UINT8_MAX;</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;        min_color[2] = UINT8_MAX;</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;        max_color[0] = 0;</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;        max_color[1] = 0;</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;        max_color[2] = 0;</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;        total_rgb[0] = 0;</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;        total_rgb[1] = 0;</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;        total_rgb[2] = 0;</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;        *total_pixels = 0;</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;        threshold = <a class="code" href="cbs__vp9_8c.html#a5950eda76c8ffc67651de936cd8c79ec">s</a>-&gt;start_one_color_thresh;</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;        threshold = <a class="code" href="cbs__vp9_8c.html#a5950eda76c8ffc67651de936cd8c79ec">s</a>-&gt;continue_one_color_thresh;</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    }</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160; </div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;<span class="comment">       The *_blk variables will include the current block.</span></div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;<span class="comment">       Initialize them based on the blocks so far.</span></div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    min_color_blk[0] = min_color[0];</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    min_color_blk[1] = min_color[1];</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    min_color_blk[2] = min_color[2];</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;    max_color_blk[0] = max_color[0];</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;    max_color_blk[1] = max_color[1];</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;    max_color_blk[2] = max_color[2];</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;    total_rgb_blk[0] = total_rgb[0];</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;    total_rgb_blk[1] = total_rgb[1];</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;    total_rgb_blk[2] = total_rgb[2];</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;    total_pixels_blk = *total_pixels + bi-&gt;<a class="code" href="struct_block_info.html#abe0f811ac0f0ff103d20b3e12a665dc5">block_height</a> * bi-&gt;<a class="code" href="struct_block_info.html#a58c12055ec745fa9afd52de0edd3a448">block_width</a>;</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160; </div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;<span class="comment">       Update stats for this block&#39;s pixels</span></div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;    <span class="keywordflow">for</span> (y = 0; y &lt; bi-&gt;<a class="code" href="struct_block_info.html#abe0f811ac0f0ff103d20b3e12a665dc5">block_height</a>; y++) {</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;        <span class="keywordflow">for</span> (x = 0; x &lt; bi-&gt;<a class="code" href="struct_block_info.html#a58c12055ec745fa9afd52de0edd3a448">block_width</a>; x++) {</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;            total_rgb_blk[0] += <a class="code" href="rpzaenc_8c.html#ade8726343ca32cab0df4d619b18bf083">R</a>(<a class="code" href="filter__design_8txt.html#a17afa58b2bc574dedcd1cc02e1fdf165">block</a>[x]);</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;            total_rgb_blk[1] += <a class="code" href="rpzaenc_8c.html#a7721ca941dbab8a1a0704d4bd60e513f">G</a>(<a class="code" href="filter__design_8txt.html#a17afa58b2bc574dedcd1cc02e1fdf165">block</a>[x]);</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;            total_rgb_blk[2] += <a class="code" href="rpzaenc_8c.html#a934a37224d883fbf98cc009c755bd712">B</a>(<a class="code" href="filter__design_8txt.html#a17afa58b2bc574dedcd1cc02e1fdf165">block</a>[x]);</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160; </div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;            min_color_blk[0] = <a class="code" href="common_8h.html#a0f84cbd7fd810cd678157c98cbfad4b0">FFMIN</a>(<a class="code" href="rpzaenc_8c.html#ade8726343ca32cab0df4d619b18bf083">R</a>(<a class="code" href="filter__design_8txt.html#a17afa58b2bc574dedcd1cc02e1fdf165">block</a>[x]), min_color_blk[0]);</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;            min_color_blk[1] = <a class="code" href="common_8h.html#a0f84cbd7fd810cd678157c98cbfad4b0">FFMIN</a>(<a class="code" href="rpzaenc_8c.html#a7721ca941dbab8a1a0704d4bd60e513f">G</a>(<a class="code" href="filter__design_8txt.html#a17afa58b2bc574dedcd1cc02e1fdf165">block</a>[x]), min_color_blk[1]);</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;            min_color_blk[2] = <a class="code" href="common_8h.html#a0f84cbd7fd810cd678157c98cbfad4b0">FFMIN</a>(<a class="code" href="rpzaenc_8c.html#a934a37224d883fbf98cc009c755bd712">B</a>(<a class="code" href="filter__design_8txt.html#a17afa58b2bc574dedcd1cc02e1fdf165">block</a>[x]), min_color_blk[2]);</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160; </div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;            max_color_blk[0] = <a class="code" href="common_8h.html#a9960bd6780a9b16a216a57be1ee04359">FFMAX</a>(<a class="code" href="rpzaenc_8c.html#ade8726343ca32cab0df4d619b18bf083">R</a>(<a class="code" href="filter__design_8txt.html#a17afa58b2bc574dedcd1cc02e1fdf165">block</a>[x]), max_color_blk[0]);</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;            max_color_blk[1] = <a class="code" href="common_8h.html#a9960bd6780a9b16a216a57be1ee04359">FFMAX</a>(<a class="code" href="rpzaenc_8c.html#a7721ca941dbab8a1a0704d4bd60e513f">G</a>(<a class="code" href="filter__design_8txt.html#a17afa58b2bc574dedcd1cc02e1fdf165">block</a>[x]), max_color_blk[1]);</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;            max_color_blk[2] = <a class="code" href="common_8h.html#a9960bd6780a9b16a216a57be1ee04359">FFMAX</a>(<a class="code" href="rpzaenc_8c.html#a934a37224d883fbf98cc009c755bd712">B</a>(<a class="code" href="filter__design_8txt.html#a17afa58b2bc574dedcd1cc02e1fdf165">block</a>[x]), max_color_blk[2]);</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;        }</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;        <a class="code" href="filter__design_8txt.html#a17afa58b2bc574dedcd1cc02e1fdf165">block</a> += bi-&gt;<a class="code" href="struct_block_info.html#a04dcdd042d19bf1452dbbfc9aa580f65">rowstride</a>;</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;    }</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160; </div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;<span class="comment">       Calculate average color including current block.</span></div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;    avg_color_blk[0] = total_rgb_blk[0] / total_pixels_blk;</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;    avg_color_blk[1] = total_rgb_blk[1] / total_pixels_blk;</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;    avg_color_blk[2] = total_rgb_blk[2] / total_pixels_blk;</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160; </div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;<span class="comment">       Are all the pixels within threshold of the average color?</span></div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;    is_in_range = (max_color_blk[0] - avg_color_blk[0] &lt;= threshold &amp;&amp;</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;                   max_color_blk[1] - avg_color_blk[1] &lt;= threshold &amp;&amp;</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;                   max_color_blk[2] - avg_color_blk[2] &lt;= threshold &amp;&amp;</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;                   avg_color_blk[0] - min_color_blk[0] &lt;= threshold &amp;&amp;</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;                   avg_color_blk[1] - min_color_blk[1] &lt;= threshold &amp;&amp;</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;                   avg_color_blk[2] - min_color_blk[2] &lt;= threshold);</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160; </div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;    <span class="keywordflow">if</span> (is_in_range) {</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;<span class="comment">           Set the output variables to include this block.</span></div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;        min_color[0] = min_color_blk[0];</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;        min_color[1] = min_color_blk[1];</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;        min_color[2] = min_color_blk[2];</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;        max_color[0] = max_color_blk[0];</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;        max_color[1] = max_color_blk[1];</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;        max_color[2] = max_color_blk[2];</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;        total_rgb[0] = total_rgb_blk[0];</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;        total_rgb[1] = total_rgb_blk[1];</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;        total_rgb[2] = total_rgb_blk[2];</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;        *total_pixels = total_pixels_blk;</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;        avg_color[0] = avg_color_blk[0];</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;        avg_color[1] = avg_color_blk[1];</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;        avg_color[2] = avg_color_blk[2];</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;    }</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160; </div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;    <span class="keywordflow">return</span> is_in_range;</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;}</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160; </div>
<div class="line"><a name="l00547"></a><span class="lineno"><a class="line" href="rpzaenc_8c.html#aae67f52f25c39daf698c21b9493a4670">  547</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="rpzaenc_8c.html#aae67f52f25c39daf698c21b9493a4670">rpza_encode_stream</a>(<a class="code" href="struct_rpza_context.html">RpzaContext</a> *<a class="code" href="cbs__vp9_8c.html#a5950eda76c8ffc67651de936cd8c79ec">s</a>, <span class="keyword">const</span> <a class="code" href="struct_a_v_frame.html">AVFrame</a> *pict)</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;{</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;    <a class="code" href="struct_block_info.html">BlockInfo</a> bi;</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;    <span class="keywordtype">int</span> block_counter = 0;</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;    <span class="keywordtype">int</span> n_blocks;</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;    <span class="keywordtype">int</span> total_blocks;</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;    <span class="keywordtype">int</span> prev_block_offset;</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;    <span class="keywordtype">int</span> block_offset = 0;</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;    <a class="code" href="audio__convert_8c.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> <a class="code" href="vorbis__enc__data_8h.html#ad2e88d75f808e6d4e78d48bceb10c336">min</a> = 0, <a class="code" href="cuda__runtime_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a> = 0;</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;    <a class="code" href="rpzaenc_8c.html#a2ad296b3defe6bf8739eb9198dc29848">channel_offset</a> chan;</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;    <span class="keywordtype">int</span> tmp_min, tmp_max;</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;    <span class="keywordtype">int</span> total_rgb[3];</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;    <a class="code" href="audio__convert_8c.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> avg_color[3];</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;    <span class="keywordtype">int</span> pixel_count;</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;    <a class="code" href="audio__convert_8c.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> min_color[3], max_color[3];</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;    <span class="keywordtype">double</span> slope, y_intercept, correlation_coef;</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;    uint16_t *src_pixels = (uint16_t *)pict-&gt;<a class="code" href="struct_a_v_frame.html#a1d0f65014a8d1bf78cec8cbed2304992">data</a>[0];</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;    uint16_t *prev_pixels = (uint16_t *)<a class="code" href="cbs__vp9_8c.html#a5950eda76c8ffc67651de936cd8c79ec">s</a>-&gt;prev_frame-&gt;data[0];</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160; </div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;    <span class="comment">/* Number of 4x4 blocks in frame. */</span></div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;    total_blocks = ((<a class="code" href="cbs__vp9_8c.html#a5950eda76c8ffc67651de936cd8c79ec">s</a>-&gt;frame_width + 3) / 4) * ((<a class="code" href="cbs__vp9_8c.html#a5950eda76c8ffc67651de936cd8c79ec">s</a>-&gt;frame_height + 3) / 4);</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160; </div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;    bi.<a class="code" href="struct_block_info.html#a39dbb3661c12346f3c73717d92344b0e">image_width</a> = <a class="code" href="cbs__vp9_8c.html#a5950eda76c8ffc67651de936cd8c79ec">s</a>-&gt;frame_width;</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;    bi.<a class="code" href="struct_block_info.html#ab09b46083586081c17a1ac9ae62c05c4">image_height</a> = <a class="code" href="cbs__vp9_8c.html#a5950eda76c8ffc67651de936cd8c79ec">s</a>-&gt;frame_height;</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;    bi.<a class="code" href="struct_block_info.html#a04dcdd042d19bf1452dbbfc9aa580f65">rowstride</a> = pict-&gt;<a class="code" href="struct_a_v_frame.html#aa52bfc6605f6a3059a0c3226cc0f6567">linesize</a>[0] / 2;</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160; </div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;    bi.<a class="code" href="struct_block_info.html#ae69e376b474d2c9139b559c705d8b061">blocks_per_row</a> = (<a class="code" href="cbs__vp9_8c.html#a5950eda76c8ffc67651de936cd8c79ec">s</a>-&gt;frame_width + 3) / 4;</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160; </div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;    <span class="keywordflow">while</span> (block_counter &lt; total_blocks) {</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;        <span class="comment">// SKIP CHECK</span></div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;        <span class="comment">// make sure we have a valid previous frame and we&#39;re not writing</span></div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;        <span class="comment">// a key frame</span></div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="cbs__vp9_8c.html#a5950eda76c8ffc67651de936cd8c79ec">s</a>-&gt;first_frame) {</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;            n_blocks = 0;</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;            prev_block_offset = 0;</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160; </div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;            <span class="keywordflow">while</span> (n_blocks &lt; 32 &amp;&amp; block_counter + n_blocks &lt; total_blocks) {</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160; </div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;                block_offset = <a class="code" href="rpzaenc_8c.html#a6797c5a614c0d81c5031b80901282e55">get_block_info</a>(&amp;bi, block_counter + n_blocks);</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160; </div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;                <span class="comment">// multi-block opcodes cannot span multiple rows.</span></div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;                <span class="comment">// If we&#39;re starting a new row, break out and write the opcode</span></div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;                <span class="comment">/* TODO: Should eventually use bi.row here to determine when a</span></div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;<span class="comment">                   row break occurs, but that is currently breaking the</span></div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;<span class="comment">                   quicktime player. This is probably due to a bug in the</span></div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;<span class="comment">                   way I&#39;m calculating the current row.</span></div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;<span class="comment">                 */</span></div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;                <span class="keywordflow">if</span> (prev_block_offset &amp;&amp; block_offset - prev_block_offset &gt; 12) {</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;                }</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160; </div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;                prev_block_offset = block_offset;</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160; </div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="rpzaenc_8c.html#a8bb03d53e86036fc6dbc7948a10c7a3c">compare_blocks</a>(&amp;prev_pixels[block_offset],</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;                                   &amp;src_pixels[block_offset], &amp;bi, <a class="code" href="cbs__vp9_8c.html#a5950eda76c8ffc67651de936cd8c79ec">s</a>-&gt;skip_frame_thresh) != 0) {</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;                    <span class="comment">// write out skipable blocks</span></div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;                    <span class="keywordflow">if</span> (n_blocks) {</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160; </div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;                        <span class="comment">// write skip opcode</span></div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;                        <a class="code" href="j2kenc_8c.html#aafc5fd946cab2b9d67be29d48099f703">put_bits</a>(&amp;<a class="code" href="cbs__vp9_8c.html#a5950eda76c8ffc67651de936cd8c79ec">s</a>-&gt;pb, 8, 0x80 | (n_blocks - 1));</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;                        block_counter += n_blocks;</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160; </div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;                        <span class="keywordflow">goto</span> post_skip;</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;                    }</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;                }</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160; </div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;                <span class="comment">/*</span></div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;<span class="comment">                 * NOTE: we don&#39;t update skipped blocks in the previous frame buffer</span></div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;<span class="comment">                 * since skipped needs always to be compared against the first skipped</span></div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;<span class="comment">                 * block to avoid artifacts during gradual fade in/outs.</span></div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;<span class="comment">                 */</span></div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160; </div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;                <span class="comment">// update_block_in_prev_frame(&amp;src_pixels[block_offset],</span></div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;                <span class="comment">//   &amp;prev_pixels[block_offset], &amp;bi, block_counter + n_blocks);</span></div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160; </div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;                n_blocks++;</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;            }</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160; </div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;            <span class="comment">// we&#39;re either at the end of the frame or we&#39;ve reached the maximum</span></div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;            <span class="comment">// of 32 blocks in a run. Write out the run.</span></div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;            <span class="keywordflow">if</span> (n_blocks) {</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;                <span class="comment">// write skip opcode</span></div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;                <a class="code" href="j2kenc_8c.html#aafc5fd946cab2b9d67be29d48099f703">put_bits</a>(&amp;<a class="code" href="cbs__vp9_8c.html#a5950eda76c8ffc67651de936cd8c79ec">s</a>-&gt;pb, 8, 0x80 | (n_blocks - 1));</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;                block_counter += n_blocks;</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160; </div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;            }</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160; </div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;            block_offset = <a class="code" href="rpzaenc_8c.html#a6797c5a614c0d81c5031b80901282e55">get_block_info</a>(&amp;bi, block_counter);</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;        }</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;post_skip :</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160; </div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;        <span class="comment">// ONE COLOR CHECK</span></div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="rpzaenc_8c.html#acf0ec3c727fd0f0c4654ce4f1db61b57">update_block_stats</a>(<a class="code" href="cbs__vp9_8c.html#a5950eda76c8ffc67651de936cd8c79ec">s</a>, &amp;bi, &amp;src_pixels[block_offset],</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;                               min_color, max_color,</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;                               total_rgb, &amp;pixel_count, avg_color, 1)) {</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;            prev_block_offset = block_offset;</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160; </div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;            n_blocks = 1;</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160; </div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;            <span class="comment">/* update this block in the previous frame buffer */</span></div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;            <a class="code" href="rpzaenc_8c.html#a7dd0564d2f1c8ce1b1fb900ac265a03b">update_block_in_prev_frame</a>(&amp;src_pixels[block_offset],</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;                                       &amp;prev_pixels[block_offset], &amp;bi, block_counter + n_blocks);</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160; </div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;            <span class="comment">// check for subsequent blocks with the same color</span></div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;            <span class="keywordflow">while</span> (n_blocks &lt; 32 &amp;&amp; block_counter + n_blocks &lt; total_blocks) {</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;                block_offset = <a class="code" href="rpzaenc_8c.html#a6797c5a614c0d81c5031b80901282e55">get_block_info</a>(&amp;bi, block_counter + n_blocks);</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160; </div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;                <span class="comment">// multi-block opcodes cannot span multiple rows.</span></div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;                <span class="comment">// If we&#39;ve hit end of a row, break out and write the opcode</span></div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;                <span class="keywordflow">if</span> (block_offset - prev_block_offset &gt; 12) {</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;                }</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160; </div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;                <span class="keywordflow">if</span> (!<a class="code" href="rpzaenc_8c.html#acf0ec3c727fd0f0c4654ce4f1db61b57">update_block_stats</a>(<a class="code" href="cbs__vp9_8c.html#a5950eda76c8ffc67651de936cd8c79ec">s</a>, &amp;bi, &amp;src_pixels[block_offset],</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;                                        min_color, max_color,</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;                                        total_rgb, &amp;pixel_count, avg_color, 0)) {</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;                }</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160; </div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;                prev_block_offset = block_offset;</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160; </div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;                <span class="comment">/* update this block in the previous frame buffer */</span></div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;                <a class="code" href="rpzaenc_8c.html#a7dd0564d2f1c8ce1b1fb900ac265a03b">update_block_in_prev_frame</a>(&amp;src_pixels[block_offset],</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;                                           &amp;prev_pixels[block_offset], &amp;bi, block_counter + n_blocks);</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160; </div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;                n_blocks++;</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;            }</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160; </div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;            <span class="comment">// write one color opcode.</span></div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;            <a class="code" href="j2kenc_8c.html#aafc5fd946cab2b9d67be29d48099f703">put_bits</a>(&amp;<a class="code" href="cbs__vp9_8c.html#a5950eda76c8ffc67651de936cd8c79ec">s</a>-&gt;pb, 8, 0xa0 | (n_blocks - 1));</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;            <span class="comment">// write color to encode.</span></div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;            <a class="code" href="j2kenc_8c.html#aafc5fd946cab2b9d67be29d48099f703">put_bits</a>(&amp;<a class="code" href="cbs__vp9_8c.html#a5950eda76c8ffc67651de936cd8c79ec">s</a>-&gt;pb, 16, <a class="code" href="rpzaenc_8c.html#ab6c31af54a7b8ae8e20957fb3cd97f10">rgb24_to_rgb555</a>(avg_color));</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;            <span class="comment">// skip past the blocks we&#39;ve just encoded.</span></div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;            block_counter += n_blocks;</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;        } <span class="keywordflow">else</span> { <span class="comment">// FOUR COLOR CHECK</span></div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;            <span class="keywordtype">int</span> err = 0;</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160; </div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;            <span class="comment">// get max component diff for block</span></div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;            <a class="code" href="rpzaenc_8c.html#a011934ef56f31ee369d5376b3c597fcc">get_max_component_diff</a>(&amp;bi, &amp;src_pixels[block_offset], &amp;<a class="code" href="vorbis__enc__data_8h.html#ad2e88d75f808e6d4e78d48bceb10c336">min</a>, &amp;<a class="code" href="cuda__runtime_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>, &amp;chan);</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160; </div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;            min_color[0] = 0;</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;            max_color[0] = 0;</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;            min_color[1] = 0;</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;            max_color[1] = 0;</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;            min_color[2] = 0;</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;            max_color[2] = 0;</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160; </div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;            <span class="comment">// run least squares against other two components</span></div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;            <span class="keywordflow">for</span> (<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; 3; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> == chan) {</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;                    min_color[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code" href="vorbis__enc__data_8h.html#ad2e88d75f808e6d4e78d48bceb10c336">min</a>;</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;                    max_color[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code" href="cuda__runtime_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>;</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;                    <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;                }</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160; </div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;                slope = y_intercept = correlation_coef = 0;</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160; </div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="rpzaenc_8c.html#ae6a544dddf9c76654d304d3567c78e65">leastsquares</a>(&amp;src_pixels[block_offset], &amp;bi, chan, <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>,</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;                                 &amp;slope, &amp;y_intercept, &amp;correlation_coef)) {</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;                    min_color[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code" href="rpzaenc_8c.html#ad7f25e97333df3583e8b6f9210b3c8ac">GET_CHAN</a>(src_pixels[block_offset], <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;                    max_color[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code" href="rpzaenc_8c.html#ad7f25e97333df3583e8b6f9210b3c8ac">GET_CHAN</a>(src_pixels[block_offset], <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;                    tmp_min = (<a class="code" href="ffmpeg__filter_8c.html#a61569f2965b7a369eb10b6d75d410d11">int</a>)(0.5 + <a class="code" href="vorbis__enc__data_8h.html#ad2e88d75f808e6d4e78d48bceb10c336">min</a> * slope + y_intercept);</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;                    tmp_max = (<a class="code" href="ffmpeg__filter_8c.html#a61569f2965b7a369eb10b6d75d410d11">int</a>)(0.5 + <a class="code" href="cuda__runtime_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a> * slope + y_intercept);</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160; </div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;                    <a class="code" href="avassert_8h.html#aae204192396f78cc8c5cd7ad5c57c23f">av_assert0</a>(tmp_min &lt;= tmp_max);</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;                    <span class="comment">// clamp min and max color values</span></div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;                    tmp_min = av_clip_uint8(tmp_min);</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;                    tmp_max = av_clip_uint8(tmp_max);</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160; </div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;                    err = <a class="code" href="common_8h.html#a9960bd6780a9b16a216a57be1ee04359">FFMAX</a>(<a class="code" href="rpzaenc_8c.html#a03535304966cd4b7dfd78c6f7b2819fe">calc_lsq_max_fit_error</a>(&amp;src_pixels[block_offset], &amp;bi,</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;                                                       <a class="code" href="vorbis__enc__data_8h.html#ad2e88d75f808e6d4e78d48bceb10c336">min</a>, <a class="code" href="cuda__runtime_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>, tmp_min, tmp_max, chan, <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>), err);</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160; </div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;                    min_color[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>] = tmp_min;</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;                    max_color[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>] = tmp_max;</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;                }</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;            }</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160; </div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;            <span class="keywordflow">if</span> (err &gt; <a class="code" href="cbs__vp9_8c.html#a5950eda76c8ffc67651de936cd8c79ec">s</a>-&gt;sixteen_color_thresh) { <span class="comment">// DO SIXTEEN COLOR BLOCK</span></div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;                uint16_t *row_ptr;</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;                <span class="keywordtype">int</span> rgb555;</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160; </div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;                block_offset = <a class="code" href="rpzaenc_8c.html#a6797c5a614c0d81c5031b80901282e55">get_block_info</a>(&amp;bi, block_counter);</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160; </div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;                row_ptr = &amp;src_pixels[block_offset];</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160; </div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> y = 0; y &lt; 4; y++) {</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;                    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> x = 0; x &lt; 4; x++){</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;                        rgb555 = row_ptr[x] &amp; ~0x8000;</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160; </div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;                        <a class="code" href="j2kenc_8c.html#aafc5fd946cab2b9d67be29d48099f703">put_bits</a>(&amp;<a class="code" href="cbs__vp9_8c.html#a5950eda76c8ffc67651de936cd8c79ec">s</a>-&gt;pb, 16, rgb555);</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;                    }</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;                    row_ptr += bi.<a class="code" href="struct_block_info.html#a04dcdd042d19bf1452dbbfc9aa580f65">rowstride</a>;</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;                }</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160; </div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;                block_counter++;</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;            } <span class="keywordflow">else</span> { <span class="comment">// FOUR COLOR BLOCK</span></div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;                block_counter += <a class="code" href="rpzaenc_8c.html#ad6d3e8316b2ce25d894b8c58a1fbcdaf">encode_four_color_block</a>(min_color, max_color,</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;                                                         &amp;<a class="code" href="cbs__vp9_8c.html#a5950eda76c8ffc67651de936cd8c79ec">s</a>-&gt;pb, &amp;src_pixels[block_offset], &amp;bi);</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;            }</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160; </div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;            <span class="comment">/* update this block in the previous frame buffer */</span></div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;            <a class="code" href="rpzaenc_8c.html#a7dd0564d2f1c8ce1b1fb900ac265a03b">update_block_in_prev_frame</a>(&amp;src_pixels[block_offset],</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;                                       &amp;prev_pixels[block_offset], &amp;bi, block_counter);</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;        }</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;    }</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;}</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160; </div>
<div class="line"><a name="l00759"></a><span class="lineno"><a class="line" href="rpzaenc_8c.html#a4a297167bbd0837b8295648e5b5a740c">  759</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="rpzaenc_8c.html#a4a297167bbd0837b8295648e5b5a740c">rpza_encode_init</a>(<a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a> *avctx)</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;{</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;    <a class="code" href="struct_rpza_context.html">RpzaContext</a> *<a class="code" href="cbs__vp9_8c.html#a5950eda76c8ffc67651de936cd8c79ec">s</a> = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#af3379123060ad8cc9c321c29af4f8360">priv_data</a>;</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160; </div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;    <a class="code" href="cbs__vp9_8c.html#a5950eda76c8ffc67651de936cd8c79ec">s</a>-&gt;frame_width = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a0d8f46461754e8abea0847dcbc41b956">width</a>;</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;    <a class="code" href="cbs__vp9_8c.html#a5950eda76c8ffc67651de936cd8c79ec">s</a>-&gt;frame_height = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a0449afd803eb107bd4dbc8b5ea22e363">height</a>;</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160; </div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;    <a class="code" href="cbs__vp9_8c.html#a5950eda76c8ffc67651de936cd8c79ec">s</a>-&gt;prev_frame = <a class="code" href="group__lavu__frame.html#gac700017c5270c79c1e1befdeeb008b2f">av_frame_alloc</a>();</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="cbs__vp9_8c.html#a5950eda76c8ffc67651de936cd8c79ec">s</a>-&gt;prev_frame)</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160; </div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;}</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160; </div>
<div class="line"><a name="l00773"></a><span class="lineno"><a class="line" href="rpzaenc_8c.html#a16c8a1cbca001b0d85014be30fe1be1b">  773</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="rpzaenc_8c.html#a16c8a1cbca001b0d85014be30fe1be1b">rpza_encode_frame</a>(<a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a> *avctx, <a class="code" href="struct_a_v_packet.html">AVPacket</a> *<a class="code" href="demuxing__decoding_8c.html#a3d4c6562f0b27cf0cacbbea5c038c090">pkt</a>,</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;                                <span class="keyword">const</span> <a class="code" href="struct_a_v_frame.html">AVFrame</a> *<a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>, <span class="keywordtype">int</span> *got_packet)</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;{</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;    <a class="code" href="struct_rpza_context.html">RpzaContext</a> *<a class="code" href="cbs__vp9_8c.html#a5950eda76c8ffc67651de936cd8c79ec">s</a> = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#af3379123060ad8cc9c321c29af4f8360">priv_data</a>;</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;    <span class="keyword">const</span> <a class="code" href="struct_a_v_frame.html">AVFrame</a> *pict = <a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>;</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;    <a class="code" href="audio__convert_8c.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> *buf;</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>;</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160; </div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;    <span class="keywordflow">if</span> ((<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = <a class="code" href="encode_8c.html#a699df1216e8d9d57959f99508e9aadf6">ff_alloc_packet2</a>(avctx, <a class="code" href="demuxing__decoding_8c.html#a3d4c6562f0b27cf0cacbbea5c038c090">pkt</a>, 6LL * avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a0449afd803eb107bd4dbc8b5ea22e363">height</a> * avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a0d8f46461754e8abea0847dcbc41b956">width</a>, 0)) &lt; 0)</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>;</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160; </div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;    <a class="code" href="put__bits_8h.html#a0bcd3e73d6c48e50b9c8fe99a51d2c91">init_put_bits</a>(&amp;<a class="code" href="cbs__vp9_8c.html#a5950eda76c8ffc67651de936cd8c79ec">s</a>-&gt;pb, <a class="code" href="demuxing__decoding_8c.html#a3d4c6562f0b27cf0cacbbea5c038c090">pkt</a>-&gt;<a class="code" href="struct_a_v_packet.html#aaf4fe58dfcc7c232c1f2268b539d8367">data</a>, <a class="code" href="demuxing__decoding_8c.html#a3d4c6562f0b27cf0cacbbea5c038c090">pkt</a>-&gt;<a class="code" href="struct_a_v_packet.html#a4d1ea19f63eb107111fd650ca514d1f4">size</a>);</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160; </div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;    <span class="comment">// skip 4 byte header, write it later once the size of the chunk is known</span></div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;    <a class="code" href="put__bits_8h.html#a2658957c36dc9dd971e3957d72faf7a3">put_bits32</a>(&amp;<a class="code" href="cbs__vp9_8c.html#a5950eda76c8ffc67651de936cd8c79ec">s</a>-&gt;pb, 0x00);</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160; </div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="cbs__vp9_8c.html#a5950eda76c8ffc67651de936cd8c79ec">s</a>-&gt;prev_frame-&gt;data[0]) {</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;        <a class="code" href="cbs__vp9_8c.html#a5950eda76c8ffc67651de936cd8c79ec">s</a>-&gt;first_frame = 1;</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;        <a class="code" href="cbs__vp9_8c.html#a5950eda76c8ffc67651de936cd8c79ec">s</a>-&gt;prev_frame-&gt;format = pict-&gt;<a class="code" href="struct_a_v_frame.html#aed14fa772ce46881020fd1545c86432c">format</a>;</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;        <a class="code" href="cbs__vp9_8c.html#a5950eda76c8ffc67651de936cd8c79ec">s</a>-&gt;prev_frame-&gt;width = pict-&gt;<a class="code" href="struct_a_v_frame.html#a1e71ce60cedd5f3b6811714a9f7f9e0a">width</a>;</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;        <a class="code" href="cbs__vp9_8c.html#a5950eda76c8ffc67651de936cd8c79ec">s</a>-&gt;prev_frame-&gt;height = pict-&gt;<a class="code" href="struct_a_v_frame.html#a3f89733f429c98ba5bc64373fb0a3f13">height</a>;</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;        <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = <a class="code" href="group__lavu__frame.html#ga6b1acbfa82c79bf7fd78d868572f0ceb">av_frame_get_buffer</a>(<a class="code" href="cbs__vp9_8c.html#a5950eda76c8ffc67651de936cd8c79ec">s</a>-&gt;prev_frame, 0);</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> &lt; 0)</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>;</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;        <a class="code" href="cbs__vp9_8c.html#a5950eda76c8ffc67651de936cd8c79ec">s</a>-&gt;first_frame = 0;</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;    }</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160; </div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;    <a class="code" href="rpzaenc_8c.html#aae67f52f25c39daf698c21b9493a4670">rpza_encode_stream</a>(<a class="code" href="cbs__vp9_8c.html#a5950eda76c8ffc67651de936cd8c79ec">s</a>, pict);</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160; </div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;    <a class="code" href="put__bits_8h.html#a6f7bba5ea37c63f99b266928759fe6f6">flush_put_bits</a>(&amp;<a class="code" href="cbs__vp9_8c.html#a5950eda76c8ffc67651de936cd8c79ec">s</a>-&gt;pb);</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160; </div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;    <a class="code" href="group__lavc__packet.html#gaceba1c21e5718f87abdf61cf21500485">av_shrink_packet</a>(<a class="code" href="demuxing__decoding_8c.html#a3d4c6562f0b27cf0cacbbea5c038c090">pkt</a>, <a class="code" href="put__bits_8h.html#a57c57e21dbbc8777ed8a0a78ba89fc7d">put_bits_count</a>(&amp;<a class="code" href="cbs__vp9_8c.html#a5950eda76c8ffc67651de936cd8c79ec">s</a>-&gt;pb) &gt;&gt; 3);</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;    buf = <a class="code" href="demuxing__decoding_8c.html#a3d4c6562f0b27cf0cacbbea5c038c090">pkt</a>-&gt;<a class="code" href="struct_a_v_packet.html#aaf4fe58dfcc7c232c1f2268b539d8367">data</a>;</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160; </div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;    <span class="comment">// write header opcode</span></div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;    buf[0] = 0xe1; <span class="comment">// chunk opcode</span></div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160; </div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;    <span class="comment">// write chunk length</span></div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;    <a class="code" href="intreadwrite_8h.html#a0c2470fe15d4c1895742db2c9993f56a">AV_WB24</a>(buf + 1, <a class="code" href="demuxing__decoding_8c.html#a3d4c6562f0b27cf0cacbbea5c038c090">pkt</a>-&gt;<a class="code" href="struct_a_v_packet.html#a4d1ea19f63eb107111fd650ca514d1f4">size</a>);</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160; </div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;    *got_packet = 1;</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160; </div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;}</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160; </div>
<div class="line"><a name="l00819"></a><span class="lineno"><a class="line" href="rpzaenc_8c.html#a2164c76089190bf04d189eaf28ab24bb">  819</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="rpzaenc_8c.html#a2164c76089190bf04d189eaf28ab24bb">rpza_encode_end</a>(<a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a> *avctx)</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;{</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;    <a class="code" href="struct_rpza_context.html">RpzaContext</a> *<a class="code" href="cbs__vp9_8c.html#a5950eda76c8ffc67651de936cd8c79ec">s</a> = (<a class="code" href="struct_rpza_context.html">RpzaContext</a> *)avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#af3379123060ad8cc9c321c29af4f8360">priv_data</a>;</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160; </div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;    <a class="code" href="group__lavu__frame.html#ga979d73f3228814aee56aeca0636e37cc">av_frame_free</a>(&amp;<a class="code" href="cbs__vp9_8c.html#a5950eda76c8ffc67651de936cd8c79ec">s</a>-&gt;prev_frame);</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160; </div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;}</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160; </div>
<div class="line"><a name="l00828"></a><span class="lineno"><a class="line" href="rpzaenc_8c.html#ad12dce0a7bf9d908b172a28155b3d261">  828</a></span>&#160;<span class="preprocessor">#define OFFSET(x) offsetof(RpzaContext, x)</span></div>
<div class="line"><a name="l00829"></a><span class="lineno"><a class="line" href="rpzaenc_8c.html#a3dcf4acb9f7d9c57f43802a9a1ac4ee6">  829</a></span>&#160;<span class="preprocessor">#define VE AV_OPT_FLAG_VIDEO_PARAM | AV_OPT_FLAG_ENCODING_PARAM</span></div>
<div class="line"><a name="l00830"></a><span class="lineno"><a class="line" href="rpzaenc_8c.html#a384ff94b5139f441c282c9b4c7b985e6">  830</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="struct_a_v_option.html">AVOption</a> <a class="code" href="rpzaenc_8c.html#a384ff94b5139f441c282c9b4c7b985e6">options</a>[] = {</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;    { <span class="stringliteral">&quot;skip_frame_thresh&quot;</span>, <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="rpzaenc_8c.html#ad12dce0a7bf9d908b172a28155b3d261">OFFSET</a>(skip_frame_thresh), <a class="code" href="group__avoptions.html#ggabd75aa30eb8ad6387672df9a1fa79444ac068b8f6afeeb293a13aeabb5d702411">AV_OPT_TYPE_INT</a>, {.i64=1}, 0, 24, <a class="code" href="rpzaenc_8c.html#a3dcf4acb9f7d9c57f43802a9a1ac4ee6">VE</a>},</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;    { <span class="stringliteral">&quot;start_one_color_thresh&quot;</span>, <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="rpzaenc_8c.html#ad12dce0a7bf9d908b172a28155b3d261">OFFSET</a>(start_one_color_thresh), <a class="code" href="group__avoptions.html#ggabd75aa30eb8ad6387672df9a1fa79444ac068b8f6afeeb293a13aeabb5d702411">AV_OPT_TYPE_INT</a>, {.i64=1}, 0, 24, <a class="code" href="rpzaenc_8c.html#a3dcf4acb9f7d9c57f43802a9a1ac4ee6">VE</a>},</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;    { <span class="stringliteral">&quot;continue_one_color_thresh&quot;</span>, <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="rpzaenc_8c.html#ad12dce0a7bf9d908b172a28155b3d261">OFFSET</a>(continue_one_color_thresh), <a class="code" href="group__avoptions.html#ggabd75aa30eb8ad6387672df9a1fa79444ac068b8f6afeeb293a13aeabb5d702411">AV_OPT_TYPE_INT</a>, {.i64=0}, 0, 24, <a class="code" href="rpzaenc_8c.html#a3dcf4acb9f7d9c57f43802a9a1ac4ee6">VE</a>},</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;    { <span class="stringliteral">&quot;sixteen_color_thresh&quot;</span>, <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="rpzaenc_8c.html#ad12dce0a7bf9d908b172a28155b3d261">OFFSET</a>(sixteen_color_thresh), <a class="code" href="group__avoptions.html#ggabd75aa30eb8ad6387672df9a1fa79444ac068b8f6afeeb293a13aeabb5d702411">AV_OPT_TYPE_INT</a>, {.i64=1}, 0, 24, <a class="code" href="rpzaenc_8c.html#a3dcf4acb9f7d9c57f43802a9a1ac4ee6">VE</a>},</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;    { <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> },</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;};</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160; </div>
<div class="line"><a name="l00838"></a><span class="lineno"><a class="line" href="rpzaenc_8c.html#a6a4b9d8f1957f594f942c7eebd7f4723">  838</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="struct_a_v_class.html">AVClass</a> <a class="code" href="rpzaenc_8c.html#a6a4b9d8f1957f594f942c7eebd7f4723">rpza_class</a> = {</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;    .<a class="code" href="struct_a_v_class.html#aa8883e113a3f2965abd008f7667db7eb">class_name</a> = <span class="stringliteral">&quot;rpza&quot;</span>,</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;    .item_name  = <a class="code" href="group__lavu__log.html#ga791fcd0dba1d19fe0c3677509344328e">av_default_item_name</a>,</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;    .option     = <a class="code" href="rpzaenc_8c.html#a384ff94b5139f441c282c9b4c7b985e6">options</a>,</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;    .version    = <a class="code" href="group__lavu__ver.html#ga36e17e3fc9bcbe5c55820a8ac8b47e3c">LIBAVUTIL_VERSION_INT</a>,</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;};</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160; </div>
<div class="line"><a name="l00845"></a><span class="lineno"><a class="line" href="rpzaenc_8c.html#a87ccebb8eebb33dd9b6442f1015b3064">  845</a></span>&#160;<a class="code" href="struct_a_v_codec.html">AVCodec</a> <a class="code" href="rpzaenc_8c.html#a87ccebb8eebb33dd9b6442f1015b3064">ff_rpza_encoder</a> = {</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;    .<a class="code" href="struct_a_v_codec.html#ad3daa3e729850b573c139a83be8938ca">name</a>           = <span class="stringliteral">&quot;rpza&quot;</span>,</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;    .long_name      = <a class="code" href="libavutil_2internal_8h.html#a3c0fa12fafe59c44d4b16e60d8385637">NULL_IF_CONFIG_SMALL</a>(<span class="stringliteral">&quot;QuickTime video (RPZA)&quot;</span>),</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;    .type           = <a class="code" href="group__lavu__misc.html#gga9a84bba4713dfced21a1a56163be1f48ac1a46f59be5c6c2d3412ab172d6b8cf5">AVMEDIA_TYPE_VIDEO</a>,</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;    .id             = <a class="code" href="group__lavc__core.html#ggaadca229ad2c20e060a14fec08a5cc7cea2e83b6080158a68a1e2486e342d2c36d">AV_CODEC_ID_RPZA</a>,</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;    .priv_data_size = <span class="keyword">sizeof</span>(<a class="code" href="rpzaenc_8c.html#a5a89bc6c6789d83f2bcced05841af59c">RpzaContext</a>),</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;    .priv_class     = &amp;<a class="code" href="rpzaenc_8c.html#a6a4b9d8f1957f594f942c7eebd7f4723">rpza_class</a>,</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;    .<a class="code" href="avrndec_8c.html#a41c0c9c8aa8e1fd12d65b18dd6948b09">init</a>           = <a class="code" href="rpzaenc_8c.html#a4a297167bbd0837b8295648e5b5a740c">rpza_encode_init</a>,</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;    .encode2        = <a class="code" href="rpzaenc_8c.html#a16c8a1cbca001b0d85014be30fe1be1b">rpza_encode_frame</a>,</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;    .close          = <a class="code" href="rpzaenc_8c.html#a2164c76089190bf04d189eaf28ab24bb">rpza_encode_end</a>,</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;    .caps_internal  = <a class="code" href="libavcodec_2internal_8h.html#a93962007020d71a3541778040d30413f">FF_CODEC_CAP_INIT_THREADSAFE</a>,</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;    .<a class="code" href="libkvazaar_8c.html#aa1219ee396a270ba57fd4f2306b64c6e">pix_fmts</a>       = (<span class="keyword">const</span> <span class="keyword">enum</span> <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5">AVPixelFormat</a>[]) { <a class="code" href="pixfmt_8h.html#afd53c0e6c6f6225fa90f1edff9f9ec55">AV_PIX_FMT_RGB555</a>,</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;                                                     <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a0e08f8a5d0fa21c3e258816a9dcce7c3">AV_PIX_FMT_NONE</a>},</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;};</div>
</div><!-- fragment --></div><!-- contents -->
<div class="ttc" id="astruct_rpza_context_html_a00d31105a997be3e14af43317dba9085"><div class="ttname"><a href="struct_rpza_context.html#a00d31105a997be3e14af43317dba9085">RpzaContext::avclass</a></div><div class="ttdeci">AVClass * avclass</div><div class="ttdef"><b>Definition:</b> <a href="rpzaenc_8c_source.html#l00035">rpzaenc.c:35</a></div></div>
<div class="ttc" id="arpzaenc_8c_html_ad12dce0a7bf9d908b172a28155b3d261"><div class="ttname"><a href="rpzaenc_8c.html#ad12dce0a7bf9d908b172a28155b3d261">OFFSET</a></div><div class="ttdeci">#define OFFSET(x)</div><div class="ttdef"><b>Definition:</b> <a href="rpzaenc_8c_source.html#l00828">rpzaenc.c:828</a></div></div>
<div class="ttc" id="astructrgb_html_a5ff4e0f515919a82c3f401afa8555da4"><div class="ttname"><a href="structrgb.html#a5ff4e0f515919a82c3f401afa8555da4">rgb::b</a></div><div class="ttdeci">uint8_t b</div><div class="ttdef"><b>Definition:</b> <a href="rpzaenc_8c_source.html#l00061">rpzaenc.c:61</a></div></div>
<div class="ttc" id="astruct_a_v_codec_context_html"><div class="ttname"><a href="struct_a_v_codec_context.html">AVCodecContext</a></div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l00526">avcodec.h:526</a></div></div>
<div class="ttc" id="alibavcodec_2internal_8h_html_a93962007020d71a3541778040d30413f"><div class="ttname"><a href="libavcodec_2internal_8h.html#a93962007020d71a3541778040d30413f">FF_CODEC_CAP_INIT_THREADSAFE</a></div><div class="ttdeci">#define FF_CODEC_CAP_INIT_THREADSAFE</div><div class="ttdef"><b>Definition:</b> <a href="libavcodec_2internal_8h_source.html#l00040">internal.h:40</a></div></div>
<div class="ttc" id="apixfmt_8h_html_a9a8e335cf3be472042bc9f0cf80cd4c5"><div class="ttname"><a href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5">AVPixelFormat</a></div><div class="ttdeci">AVPixelFormat</div><div class="ttdef"><b>Definition:</b> <a href="pixfmt_8h_source.html#l00064">pixfmt.h:64</a></div></div>
<div class="ttc" id="astruct_block_info_html_abe0f811ac0f0ff103d20b3e12a665dc5"><div class="ttname"><a href="struct_block_info.html#abe0f811ac0f0ff103d20b3e12a665dc5">BlockInfo::block_height</a></div><div class="ttdeci">int block_height</div><div class="ttdef"><b>Definition:</b> <a href="rpzaenc_8c_source.html#l00076">rpzaenc.c:76</a></div></div>
<div class="ttc" id="arpzaenc_8c_html_a2ad296b3defe6bf8739eb9198dc29848af80f9a890089d211842d59625e561f88"><div class="ttname"><a href="rpzaenc_8c.html#a2ad296b3defe6bf8739eb9198dc29848af80f9a890089d211842d59625e561f88">RED</a></div><div class="ttdeci">@ RED</div><div class="ttdef"><b>Definition:</b> <a href="rpzaenc_8c_source.html#l00053">rpzaenc.c:53</a></div></div>
<div class="ttc" id="aavrndec_8c_html_a41c0c9c8aa8e1fd12d65b18dd6948b09"><div class="ttname"><a href="avrndec_8c.html#a41c0c9c8aa8e1fd12d65b18dd6948b09">init</a></div><div class="ttdeci">static av_cold int init(AVCodecContext *avctx)</div><div class="ttdef"><b>Definition:</b> <a href="avrndec_8c_source.html#l00035">avrndec.c:35</a></div></div>
<div class="ttc" id="avf__curves_8c_html_a33ac7b8ce37a3a60855883424fcf8b62"><div class="ttname"><a href="vf__curves_8c.html#a33ac7b8ce37a3a60855883424fcf8b62">r</a></div><div class="ttdeci">const char * r</div><div class="ttdef"><b>Definition:</b> <a href="vf__curves_8c_source.html#l00114">vf_curves.c:114</a></div></div>
<div class="ttc" id="afilter__design_8txt_html_adf2fb515710d47541f7150ecd2950e76"><div class="ttname"><a href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a></div><div class="ttdeci">Filter the word frame indicates either a video frame or a group of audio as stored in an AVFrame structure Format for each input and each output the list of supported formats For video that means pixel format For audio that means channel sample they are references to shared objects When the negotiation mechanism computes the intersection of the formats supported at each end of a all references to both lists are replaced with a reference to the intersection And when a single format is eventually chosen for a link amongst the remaining all references to the list are updated That means that if a filter requires that its input and output have the same format amongst a supported all it has to do is use a reference to the same list of formats query_formats can leave some formats unset and return AVERROR(EAGAIN) to cause the negotiation mechanism toagain later. That can be used by filters with complex requirements to use the format negotiated on one link to set the formats supported on another. Frame references ownership and permissions</div></div>
<div class="ttc" id="aopt_8h_html"><div class="ttname"><a href="opt_8h.html">opt.h</a></div></div>
<div class="ttc" id="aput__bits_8h_html_a2658957c36dc9dd971e3957d72faf7a3"><div class="ttname"><a href="put__bits_8h.html#a2658957c36dc9dd971e3957d72faf7a3">put_bits32</a></div><div class="ttdeci">static void av_unused put_bits32(PutBitContext *s, uint32_t value)</div><div class="ttdef"><b>Definition:</b> <a href="put__bits_8h_source.html#l00270">put_bits.h:270</a></div></div>
<div class="ttc" id="astruct_a_v_codec_context_html_a0449afd803eb107bd4dbc8b5ea22e363"><div class="ttname"><a href="struct_a_v_codec_context.html#a0449afd803eb107bd4dbc8b5ea22e363">AVCodecContext::height</a></div><div class="ttdeci">int height</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l00699">avcodec.h:699</a></div></div>
<div class="ttc" id="astruct_rpza_context_html_a1e2acc29a3643deffb5fff5b5ff91564"><div class="ttname"><a href="struct_rpza_context.html#a1e2acc29a3643deffb5fff5b5ff91564">RpzaContext::prev_frame</a></div><div class="ttdeci">AVFrame * prev_frame</div><div class="ttdef"><b>Definition:</b> <a href="rpzaenc_8c_source.html#l00042">rpzaenc.c:42</a></div></div>
<div class="ttc" id="astruct_a_v_codec_context_html_af3379123060ad8cc9c321c29af4f8360"><div class="ttname"><a href="struct_a_v_codec_context.html#af3379123060ad8cc9c321c29af4f8360">AVCodecContext::priv_data</a></div><div class="ttdeci">void * priv_data</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l00553">avcodec.h:553</a></div></div>
<div class="ttc" id="agroup__lavu__frame_html_ga6b1acbfa82c79bf7fd78d868572f0ceb"><div class="ttname"><a href="group__lavu__frame.html#ga6b1acbfa82c79bf7fd78d868572f0ceb">av_frame_get_buffer</a></div><div class="ttdeci">int av_frame_get_buffer(AVFrame *frame, int align)</div><div class="ttdef"><b>Definition:</b> <a href="frame_8c_source.html#l00337">frame.c:337</a></div></div>
<div class="ttc" id="astructcolor_html"><div class="ttname"><a href="structcolor.html">color</a></div><div class="ttdef"><b>Definition:</b> <a href="vf__paletteuse_8c_source.html#l00582">vf_paletteuse.c:582</a></div></div>
<div class="ttc" id="astruct_rpza_context_html_a2a749b23b079d5e88bbc93ff3e27ad96"><div class="ttname"><a href="struct_rpza_context.html#a2a749b23b079d5e88bbc93ff3e27ad96">RpzaContext::frame_width</a></div><div class="ttdeci">int frame_width</div><div class="ttdef"><b>Definition:</b> <a href="rpzaenc_8c_source.html#l00045">rpzaenc.c:45</a></div></div>
<div class="ttc" id="aput__bits_8h_html_a0bcd3e73d6c48e50b9c8fe99a51d2c91"><div class="ttname"><a href="put__bits_8h.html#a0bcd3e73d6c48e50b9c8fe99a51d2c91">init_put_bits</a></div><div class="ttdeci">static void init_put_bits(PutBitContext *s, uint8_t *buffer, int buffer_size)</div><div class="ttdef"><b>Definition:</b> <a href="put__bits_8h_source.html#l00064">put_bits.h:64</a></div></div>
<div class="ttc" id="agroup__lavu__frame_html_ga979d73f3228814aee56aeca0636e37cc"><div class="ttname"><a href="group__lavu__frame.html#ga979d73f3228814aee56aeca0636e37cc">av_frame_free</a></div><div class="ttdeci">void av_frame_free(AVFrame **frame)</div><div class="ttdef"><b>Definition:</b> <a href="frame_8c_source.html#l00203">frame.c:203</a></div></div>
<div class="ttc" id="aj2kenc_8c_html_aafc5fd946cab2b9d67be29d48099f703"><div class="ttname"><a href="j2kenc_8c.html#aafc5fd946cab2b9d67be29d48099f703">put_bits</a></div><div class="ttdeci">static void put_bits(Jpeg2000EncoderContext *s, int val, int n)</div><div class="ttdef"><b>Definition:</b> <a href="j2kenc_8c_source.html#l00218">j2kenc.c:218</a></div></div>
<div class="ttc" id="arate__distortion_8txt_html_a0e018beb061c7ac6d1f9121683a6f2c2"><div class="ttname"><a href="rate__distortion_8txt.html#a0e018beb061c7ac6d1f9121683a6f2c2">step</a></div><div class="ttdeci">trying all byte sequences megabyte in length and selecting the best looking sequence will yield cases to try But a word about which is also called distortion Distortion can be quantified by almost any quality measurement one chooses the sum of squared differences is used but more complex methods that consider psychovisual effects can be used as well It makes no difference in this discussion First step</div><div class="ttdef"><b>Definition:</b> <a href="rate__distortion_8txt_source.html#l00019">rate_distortion.txt:58</a></div></div>
<div class="ttc" id="ainput_8c_html_ad6cdb6a14abe3eab42eaaadc93409aec"><div class="ttname"><a href="input_8c.html#ad6cdb6a14abe3eab42eaaadc93409aec">b</a></div><div class="ttdeci">#define b</div><div class="ttdef"><b>Definition:</b> <a href="input_8c_source.html#l00041">input.c:41</a></div></div>
<div class="ttc" id="arpzaenc_8c_html_a934a37224d883fbf98cc009c755bd712"><div class="ttname"><a href="rpzaenc_8c.html#a934a37224d883fbf98cc009c755bd712">B</a></div><div class="ttdeci">#define B(color)</div><div class="ttdef"><b>Definition:</b> <a href="rpzaenc_8c_source.html#l00070">rpzaenc.c:70</a></div></div>
<div class="ttc" id="acuda__runtime_8h_html_affe776513b24d84b39af8ab0930fef7f"><div class="ttname"><a href="cuda__runtime_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a></div><div class="ttdeci">#define max(a, b)</div><div class="ttdef"><b>Definition:</b> <a href="cuda__runtime_8h_source.html#l00033">cuda_runtime.h:33</a></div></div>
<div class="ttc" id="arpzaenc_8c_html_aa7866fa5e4e0ee9b034e9dab6599a9cc"><div class="ttname"><a href="rpzaenc_8c.html#aa7866fa5e4e0ee9b034e9dab6599a9cc">SQR</a></div><div class="ttdeci">#define SQR(x)</div><div class="ttdef"><b>Definition:</b> <a href="rpzaenc_8c_source.html#l00064">rpzaenc.c:64</a></div></div>
<div class="ttc" id="astruct_rpza_context_html_a5d1a3dc4f67e1e118311980ee122e6a8"><div class="ttname"><a href="struct_rpza_context.html#a5d1a3dc4f67e1e118311980ee122e6a8">RpzaContext::pb</a></div><div class="ttdeci">PutBitContext pb</div><div class="ttdef"><b>Definition:</b> <a href="rpzaenc_8c_source.html#l00043">rpzaenc.c:43</a></div></div>
<div class="ttc" id="arpzaenc_8c_html_a2ad296b3defe6bf8739eb9198dc29848aa60bd322f93178d68184e30e162571ca"><div class="ttname"><a href="rpzaenc_8c.html#a2ad296b3defe6bf8739eb9198dc29848aa60bd322f93178d68184e30e162571ca">GREEN</a></div><div class="ttdeci">@ GREEN</div><div class="ttdef"><b>Definition:</b> <a href="rpzaenc_8c_source.html#l00054">rpzaenc.c:54</a></div></div>
<div class="ttc" id="astruct_rpza_context_html_ab87ae74d871f21e9924555aa2129338c"><div class="ttname"><a href="struct_rpza_context.html#ab87ae74d871f21e9924555aa2129338c">RpzaContext::skip_frame_thresh</a></div><div class="ttdeci">int skip_frame_thresh</div><div class="ttdef"><b>Definition:</b> <a href="rpzaenc_8c_source.html#l00037">rpzaenc.c:37</a></div></div>
<div class="ttc" id="astruct_block_info_html_a39dbb3661c12346f3c73717d92344b0e"><div class="ttname"><a href="struct_block_info.html#a39dbb3661c12346f3c73717d92344b0e">BlockInfo::image_width</a></div><div class="ttdeci">int image_width</div><div class="ttdef"><b>Definition:</b> <a href="rpzaenc_8c_source.html#l00077">rpzaenc.c:77</a></div></div>
<div class="ttc" id="astruct_a_v_packet_html_aaf4fe58dfcc7c232c1f2268b539d8367"><div class="ttname"><a href="struct_a_v_packet.html#aaf4fe58dfcc7c232c1f2268b539d8367">AVPacket::data</a></div><div class="ttdeci">uint8_t * data</div><div class="ttdef"><b>Definition:</b> <a href="packet_8h_source.html#l00363">packet.h:363</a></div></div>
<div class="ttc" id="astructrgb_html"><div class="ttname"><a href="structrgb.html">rgb</a></div><div class="ttdef"><b>Definition:</b> <a href="rpzaenc_8c_source.html#l00058">rpzaenc.c:58</a></div></div>
<div class="ttc" id="agroup__lavc__packet_html_gaceba1c21e5718f87abdf61cf21500485"><div class="ttname"><a href="group__lavc__packet.html#gaceba1c21e5718f87abdf61cf21500485">av_shrink_packet</a></div><div class="ttdeci">void av_shrink_packet(AVPacket *pkt, int size)</div><div class="ttdef"><b>Definition:</b> <a href="avpacket_8c_source.html#l00103">avpacket.c:103</a></div></div>
<div class="ttc" id="arpzaenc_8c_html_afc2496dfa0c1f410e6770d69c4c530ce"><div class="ttname"><a href="rpzaenc_8c.html#afc2496dfa0c1f410e6770d69c4c530ce">get_colors</a></div><div class="ttdeci">static void get_colors(uint8_t *min, uint8_t *max, uint8_t color4[4][3])</div><div class="ttdef"><b>Definition:</b> <a href="rpzaenc_8c_source.html#l00086">rpzaenc.c:86</a></div></div>
<div class="ttc" id="arpzaenc_8c_html_a87ccebb8eebb33dd9b6442f1015b3064"><div class="ttname"><a href="rpzaenc_8c.html#a87ccebb8eebb33dd9b6442f1015b3064">ff_rpza_encoder</a></div><div class="ttdeci">AVCodec ff_rpza_encoder</div><div class="ttdef"><b>Definition:</b> <a href="rpzaenc_8c_source.html#l00845">rpzaenc.c:845</a></div></div>
<div class="ttc" id="arpzaenc_8c_html_a6797c5a614c0d81c5031b80901282e55"><div class="ttname"><a href="rpzaenc_8c.html#a6797c5a614c0d81c5031b80901282e55">get_block_info</a></div><div class="ttdeci">static int get_block_info(BlockInfo *bi, int block)</div><div class="ttdef"><b>Definition:</b> <a href="rpzaenc_8c_source.html#l00115">rpzaenc.c:115</a></div></div>
<div class="ttc" id="agroup__lavu__frame_html_gac700017c5270c79c1e1befdeeb008b2f"><div class="ttname"><a href="group__lavu__frame.html#gac700017c5270c79c1e1befdeeb008b2f">av_frame_alloc</a></div><div class="ttdeci">AVFrame * av_frame_alloc(void)</div><div class="ttdef"><b>Definition:</b> <a href="frame_8c_source.html#l00190">frame.c:190</a></div></div>
<div class="ttc" id="arpzaenc_8c_html_a7dd0564d2f1c8ce1b1fb900ac265a03b"><div class="ttname"><a href="rpzaenc_8c.html#a7dd0564d2f1c8ce1b1fb900ac265a03b">update_block_in_prev_frame</a></div><div class="ttdeci">static void update_block_in_prev_frame(const uint16_t *src_pixels, uint16_t *dest_pixels, const BlockInfo *bi, int block_counter)</div><div class="ttdef"><b>Definition:</b> <a href="rpzaenc_8c_source.html#l00417">rpzaenc.c:417</a></div></div>
<div class="ttc" id="aavassert_8h_html"><div class="ttname"><a href="avassert_8h.html">avassert.h</a></div></div>
<div class="ttc" id="astruct_block_info_html_a04dcdd042d19bf1452dbbfc9aa580f65"><div class="ttname"><a href="struct_block_info.html#a04dcdd042d19bf1452dbbfc9aa580f65">BlockInfo::rowstride</a></div><div class="ttdeci">int rowstride</div><div class="ttdef"><b>Definition:</b> <a href="rpzaenc_8c_source.html#l00081">rpzaenc.c:81</a></div></div>
<div class="ttc" id="arpzaenc_8c_html_a8bb03d53e86036fc6dbc7948a10c7a3c"><div class="ttname"><a href="rpzaenc_8c.html#a8bb03d53e86036fc6dbc7948a10c7a3c">compare_blocks</a></div><div class="ttdeci">static int compare_blocks(uint16_t *block1, uint16_t *block2, BlockInfo *bi, int thresh)</div><div class="ttdef"><b>Definition:</b> <a href="rpzaenc_8c_source.html#l00244">rpzaenc.c:244</a></div></div>
<div class="ttc" id="acbs__vp9_8c_html_a5950eda76c8ffc67651de936cd8c79ec"><div class="ttname"><a href="cbs__vp9_8c.html#a5950eda76c8ffc67651de936cd8c79ec">s</a></div><div class="ttdeci">#define s(width, name)</div><div class="ttdef"><b>Definition:</b> <a href="cbs__vp9_8c_source.html#l00257">cbs_vp9.c:257</a></div></div>
<div class="ttc" id="arpzaenc_8c_html_ad6d3e8316b2ce25d894b8c58a1fbcdaf"><div class="ttname"><a href="rpzaenc_8c.html#ad6d3e8316b2ce25d894b8c58a1fbcdaf">encode_four_color_block</a></div><div class="ttdeci">static int encode_four_color_block(uint8_t *min_color, uint8_t *max_color, PutBitContext *pb, uint16_t *block_ptr, BlockInfo *bi)</div><div class="ttdef"><b>Definition:</b> <a href="rpzaenc_8c_source.html#l00385">rpzaenc.c:385</a></div></div>
<div class="ttc" id="acuda__runtime_8h_html_ab49e3b691545ec566bbf71491e06504c"><div class="ttname"><a href="cuda__runtime_8h.html#ab49e3b691545ec566bbf71491e06504c">floor</a></div><div class="ttdeci">static __device__ float floor(float a)</div><div class="ttdef"><b>Definition:</b> <a href="cuda__runtime_8h_source.html#l00173">cuda_runtime.h:173</a></div></div>
<div class="ttc" id="avf__curves_8c_html_a1b5e77b92dea40e646b2e7e196e0b322"><div class="ttname"><a href="vf__curves_8c.html#a1b5e77b92dea40e646b2e7e196e0b322">g</a></div><div class="ttdeci">const char * g</div><div class="ttdef"><b>Definition:</b> <a href="vf__curves_8c_source.html#l00115">vf_curves.c:115</a></div></div>
<div class="ttc" id="arpzaenc_8c_html_a2164c76089190bf04d189eaf28ab24bb"><div class="ttname"><a href="rpzaenc_8c.html#a2164c76089190bf04d189eaf28ab24bb">rpza_encode_end</a></div><div class="ttdeci">static int rpza_encode_end(AVCodecContext *avctx)</div><div class="ttdef"><b>Definition:</b> <a href="rpzaenc_8c_source.html#l00819">rpzaenc.c:819</a></div></div>
<div class="ttc" id="arpzaenc_8c_html_a4a297167bbd0837b8295648e5b5a740c"><div class="ttname"><a href="rpzaenc_8c.html#a4a297167bbd0837b8295648e5b5a740c">rpza_encode_init</a></div><div class="ttdeci">static int rpza_encode_init(AVCodecContext *avctx)</div><div class="ttdef"><b>Definition:</b> <a href="rpzaenc_8c_source.html#l00759">rpzaenc.c:759</a></div></div>
<div class="ttc" id="aavassert_8h_html_aae204192396f78cc8c5cd7ad5c57c23f"><div class="ttname"><a href="avassert_8h.html#aae204192396f78cc8c5cd7ad5c57c23f">av_assert0</a></div><div class="ttdeci">#define av_assert0(cond)</div><div class="ttdef"><b>Definition:</b> <a href="avassert_8h_source.html#l00037">avassert.h:37</a></div></div>
<div class="ttc" id="alibkvazaar_8c_html_aa1219ee396a270ba57fd4f2306b64c6e"><div class="ttname"><a href="libkvazaar_8c.html#aa1219ee396a270ba57fd4f2306b64c6e">pix_fmts</a></div><div class="ttdeci">static enum AVPixelFormat pix_fmts[]</div><div class="ttdef"><b>Definition:</b> <a href="libkvazaar_8c_source.html#l00162">libkvazaar.c:300</a></div></div>
<div class="ttc" id="astruct_a_v_option_html"><div class="ttname"><a href="struct_a_v_option.html">AVOption</a></div><div class="ttdef"><b>Definition:</b> <a href="opt_8h_source.html#l00248">opt.h:248</a></div></div>
<div class="ttc" id="arpzaenc_8c_html_a7721ca941dbab8a1a0704d4bd60e513f"><div class="ttname"><a href="rpzaenc_8c.html#a7721ca941dbab8a1a0704d4bd60e513f">G</a></div><div class="ttdeci">#define G(color)</div><div class="ttdef"><b>Definition:</b> <a href="rpzaenc_8c_source.html#l00069">rpzaenc.c:69</a></div></div>
<div class="ttc" id="astruct_block_info_html_a7fda32c68236a78f7679f82a25b40212"><div class="ttname"><a href="struct_block_info.html#a7fda32c68236a78f7679f82a25b40212">BlockInfo::block_index</a></div><div class="ttdeci">int block_index</div><div class="ttdef"><b>Definition:</b> <a href="rpzaenc_8c_source.html#l00079">rpzaenc.c:79</a></div></div>
<div class="ttc" id="astruct_block_info_html_ab1d9dc0124b778246522a68111b25661"><div class="ttname"><a href="struct_block_info.html#ab1d9dc0124b778246522a68111b25661">BlockInfo::total_blocks</a></div><div class="ttdeci">int total_blocks</div><div class="ttdef"><b>Definition:</b> <a href="rpzaenc_8c_source.html#l00083">rpzaenc.c:83</a></div></div>
<div class="ttc" id="astruct_a_v_class_html_aa8883e113a3f2965abd008f7667db7eb"><div class="ttname"><a href="struct_a_v_class.html#aa8883e113a3f2965abd008f7667db7eb">AVClass::class_name</a></div><div class="ttdeci">const char * class_name</div><div class="ttdef"><b>Definition:</b> <a href="log_8h_source.html#l00072">log.h:72</a></div></div>
<div class="ttc" id="acommon_8h_html_ad6d88940cfc29c13a3e51ded211fc242"><div class="ttname"><a href="common_8h.html#ad6d88940cfc29c13a3e51ded211fc242">FFABS</a></div><div class="ttdeci">#define FFABS(a)</div><div class="ttdef"><b>Definition:</b> <a href="common_8h_source.html#l00072">common.h:72</a></div></div>
<div class="ttc" id="astruct_rpza_context_html"><div class="ttname"><a href="struct_rpza_context.html">RpzaContext</a></div><div class="ttdef"><b>Definition:</b> <a href="rpza_8c_source.html#l00047">rpza.c:47</a></div></div>
<div class="ttc" id="arpzaenc_8c_html_a2ad296b3defe6bf8739eb9198dc29848a35d6719cb4d7577c031b3d79057a1b79"><div class="ttname"><a href="rpzaenc_8c.html#a2ad296b3defe6bf8739eb9198dc29848a35d6719cb4d7577c031b3d79057a1b79">BLUE</a></div><div class="ttdeci">@ BLUE</div><div class="ttdef"><b>Definition:</b> <a href="rpzaenc_8c_source.html#l00055">rpzaenc.c:55</a></div></div>
<div class="ttc" id="astruct_rpza_context_html_abe1f8209f09a8d2a9b0e541b3deb86b4"><div class="ttname"><a href="struct_rpza_context.html#abe1f8209f09a8d2a9b0e541b3deb86b4">RpzaContext::frame_height</a></div><div class="ttdeci">int frame_height</div><div class="ttdef"><b>Definition:</b> <a href="rpzaenc_8c_source.html#l00046">rpzaenc.c:46</a></div></div>
<div class="ttc" id="agroup__lavu__ver_html_ga36e17e3fc9bcbe5c55820a8ac8b47e3c"><div class="ttname"><a href="group__lavu__ver.html#ga36e17e3fc9bcbe5c55820a8ac8b47e3c">LIBAVUTIL_VERSION_INT</a></div><div class="ttdeci">#define LIBAVUTIL_VERSION_INT</div><div class="ttdef"><b>Definition:</b> <a href="libavutil_2version_8h_source.html#l00085">version.h:85</a></div></div>
<div class="ttc" id="acoverity_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="coverity_8c_source.html#l00032">coverity.c:32</a></div></div>
<div class="ttc" id="arpzaenc_8c_html_a6a4b9d8f1957f594f942c7eebd7f4723"><div class="ttname"><a href="rpzaenc_8c.html#a6a4b9d8f1957f594f942c7eebd7f4723">rpza_class</a></div><div class="ttdeci">static const AVClass rpza_class</div><div class="ttdef"><b>Definition:</b> <a href="rpzaenc_8c_source.html#l00838">rpzaenc.c:838</a></div></div>
<div class="ttc" id="agroup__lavu__log_html_ga791fcd0dba1d19fe0c3677509344328e"><div class="ttname"><a href="group__lavu__log.html#ga791fcd0dba1d19fe0c3677509344328e">av_default_item_name</a></div><div class="ttdeci">const char * av_default_item_name(void *ptr)</div><div class="ttdef"><b>Definition:</b> <a href="log_8c_source.html#l00235">log.c:235</a></div></div>
<div class="ttc" id="arpzaenc_8c_html_a3dcf4acb9f7d9c57f43802a9a1ac4ee6"><div class="ttname"><a href="rpzaenc_8c.html#a3dcf4acb9f7d9c57f43802a9a1ac4ee6">VE</a></div><div class="ttdeci">#define VE</div><div class="ttdef"><b>Definition:</b> <a href="rpzaenc_8c_source.html#l00829">rpzaenc.c:829</a></div></div>
<div class="ttc" id="astruct_a_v_frame_html_a3f89733f429c98ba5bc64373fb0a3f13"><div class="ttname"><a href="struct_a_v_frame.html#a3f89733f429c98ba5bc64373fb0a3f13">AVFrame::height</a></div><div class="ttdeci">int height</div><div class="ttdef"><b>Definition:</b> <a href="frame_8h_source.html#l00366">frame.h:366</a></div></div>
<div class="ttc" id="arpzaenc_8c_html_a5a89bc6c6789d83f2bcced05841af59c"><div class="ttname"><a href="rpzaenc_8c.html#a5a89bc6c6789d83f2bcced05841af59c">RpzaContext</a></div><div class="ttdeci">struct RpzaContext RpzaContext</div></div>
<div class="ttc" id="astruct_block_info_html"><div class="ttname"><a href="struct_block_info.html">BlockInfo</a></div><div class="ttdef"><b>Definition:</b> <a href="dvdec_8c_source.html#l00053">dvdec.c:53</a></div></div>
<div class="ttc" id="arpzaenc_8c_html_ae6a544dddf9c76654d304d3567c78e65"><div class="ttname"><a href="rpzaenc_8c.html#ae6a544dddf9c76654d304d3567c78e65">leastsquares</a></div><div class="ttdeci">static int leastsquares(uint16_t *block_ptr, BlockInfo *bi, channel_offset xchannel, channel_offset ychannel, double *slope, double *y_intercept, double *correlation_coef)</div><div class="ttdef"><b>Definition:</b> <a href="rpzaenc_8c_source.html#l00264">rpzaenc.c:264</a></div></div>
<div class="ttc" id="astruct_block_info_html_a85c923b58da3ac2f805e9a94c4e05a07"><div class="ttname"><a href="struct_block_info.html#a85c923b58da3ac2f805e9a94c4e05a07">BlockInfo::row</a></div><div class="ttdeci">int row</div><div class="ttdef"><b>Definition:</b> <a href="rpzaenc_8c_source.html#l00073">rpzaenc.c:73</a></div></div>
<div class="ttc" id="alibavutil_2internal_8h_html_a3c0fa12fafe59c44d4b16e60d8385637"><div class="ttname"><a href="libavutil_2internal_8h.html#a3c0fa12fafe59c44d4b16e60d8385637">NULL_IF_CONFIG_SMALL</a></div><div class="ttdeci">#define NULL_IF_CONFIG_SMALL(x)</div><div class="ttdef"><b>Definition:</b> <a href="libavutil_2internal_8h_source.html#l00153">internal.h:153</a></div></div>
<div class="ttc" id="acommon_8h_html_a9960bd6780a9b16a216a57be1ee04359"><div class="ttname"><a href="common_8h.html#a9960bd6780a9b16a216a57be1ee04359">FFMAX</a></div><div class="ttdeci">#define FFMAX(a, b)</div><div class="ttdef"><b>Definition:</b> <a href="common_8h_source.html#l00094">common.h:94</a></div></div>
<div class="ttc" id="astruct_a_v_codec_context_html_a0d8f46461754e8abea0847dcbc41b956"><div class="ttname"><a href="struct_a_v_codec_context.html#a0d8f46461754e8abea0847dcbc41b956">AVCodecContext::width</a></div><div class="ttdeci">int width</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l00699">avcodec.h:699</a></div></div>
<div class="ttc" id="aintreadwrite_8h_html_a0c2470fe15d4c1895742db2c9993f56a"><div class="ttname"><a href="intreadwrite_8h.html#a0c2470fe15d4c1895742db2c9993f56a">AV_WB24</a></div><div class="ttdeci">#define AV_WB24(p, d)</div><div class="ttdef"><b>Definition:</b> <a href="intreadwrite_8h_source.html#l00450">intreadwrite.h:450</a></div></div>
<div class="ttc" id="arpzaenc_8c_html_a03535304966cd4b7dfd78c6f7b2819fe"><div class="ttname"><a href="rpzaenc_8c.html#a03535304966cd4b7dfd78c6f7b2819fe">calc_lsq_max_fit_error</a></div><div class="ttdeci">static int calc_lsq_max_fit_error(uint16_t *block_ptr, BlockInfo *bi, int min, int max, int tmp_min, int tmp_max, channel_offset xchannel, channel_offset ychannel)</div><div class="ttdef"><b>Definition:</b> <a href="rpzaenc_8c_source.html#l00317">rpzaenc.c:317</a></div></div>
<div class="ttc" id="astruct_a_v_class_html"><div class="ttname"><a href="struct_a_v_class.html">AVClass</a></div><div class="ttdef"><b>Definition:</b> <a href="log_8h_source.html#l00067">log.h:67</a></div></div>
<div class="ttc" id="acommon_8h_html_a0f84cbd7fd810cd678157c98cbfad4b0"><div class="ttname"><a href="common_8h.html#a0f84cbd7fd810cd678157c98cbfad4b0">FFMIN</a></div><div class="ttdeci">#define FFMIN(a, b)</div><div class="ttdef"><b>Definition:</b> <a href="common_8h_source.html#l00096">common.h:96</a></div></div>
<div class="ttc" id="astruct_rpza_context_html_a736bd01af070145991d2cb0ae7658c94"><div class="ttname"><a href="struct_rpza_context.html#a736bd01af070145991d2cb0ae7658c94">RpzaContext::continue_one_color_thresh</a></div><div class="ttdeci">int continue_one_color_thresh</div><div class="ttdef"><b>Definition:</b> <a href="rpzaenc_8c_source.html#l00039">rpzaenc.c:39</a></div></div>
<div class="ttc" id="astructrgb_html_a644713f43fbcf5e9f070fa1843aee55f"><div class="ttname"><a href="structrgb.html#a644713f43fbcf5e9f070fa1843aee55f">rgb::g</a></div><div class="ttdeci">uint8_t g</div><div class="ttdef"><b>Definition:</b> <a href="rpzaenc_8c_source.html#l00060">rpzaenc.c:60</a></div></div>
<div class="ttc" id="astruct_block_info_html_a035cd9d345ac386a03d437f62d267ab4"><div class="ttname"><a href="struct_block_info.html#a035cd9d345ac386a03d437f62d267ab4">BlockInfo::col</a></div><div class="ttdeci">int col</div><div class="ttdef"><b>Definition:</b> <a href="rpzaenc_8c_source.html#l00074">rpzaenc.c:74</a></div></div>
<div class="ttc" id="astruct_a_v_frame_html_aa52bfc6605f6a3059a0c3226cc0f6567"><div class="ttname"><a href="struct_a_v_frame.html#aa52bfc6605f6a3059a0c3226cc0f6567">AVFrame::linesize</a></div><div class="ttdeci">int linesize[AV_NUM_DATA_POINTERS]</div><div class="ttdef"><b>Definition:</b> <a href="frame_8h_source.html#l00339">frame.h:339</a></div></div>
<div class="ttc" id="astruct_rpza_context_html_ad72eb520a29ea00746e252a88652a2a1"><div class="ttname"><a href="struct_rpza_context.html#ad72eb520a29ea00746e252a88652a2a1">RpzaContext::sixteen_color_thresh</a></div><div class="ttdeci">int sixteen_color_thresh</div><div class="ttdef"><b>Definition:</b> <a href="rpzaenc_8c_source.html#l00040">rpzaenc.c:40</a></div></div>
<div class="ttc" id="astruct_rpza_context_html_ac22ceb8218b7084b5572ebd65961e1c9"><div class="ttname"><a href="struct_rpza_context.html#ac22ceb8218b7084b5572ebd65961e1c9">RpzaContext::first_frame</a></div><div class="ttdeci">int first_frame</div><div class="ttdef"><b>Definition:</b> <a href="rpzaenc_8c_source.html#l00048">rpzaenc.c:48</a></div></div>
<div class="ttc" id="astruct_a_v_frame_html_a1e71ce60cedd5f3b6811714a9f7f9e0a"><div class="ttname"><a href="struct_a_v_frame.html#a1e71ce60cedd5f3b6811714a9f7f9e0a">AVFrame::width</a></div><div class="ttdeci">int width</div><div class="ttdef"><b>Definition:</b> <a href="frame_8h_source.html#l00366">frame.h:366</a></div></div>
<div class="ttc" id="arpzaenc_8c_html_a2ad296b3defe6bf8739eb9198dc29848"><div class="ttname"><a href="rpzaenc_8c.html#a2ad296b3defe6bf8739eb9198dc29848">channel_offset</a></div><div class="ttdeci">channel_offset</div><div class="ttdef"><b>Definition:</b> <a href="rpzaenc_8c_source.html#l00052">rpzaenc.c:52</a></div></div>
<div class="ttc" id="astruct_block_info_html_a58c12055ec745fa9afd52de0edd3a448"><div class="ttname"><a href="struct_block_info.html#a58c12055ec745fa9afd52de0edd3a448">BlockInfo::block_width</a></div><div class="ttdeci">int block_width</div><div class="ttdef"><b>Definition:</b> <a href="rpzaenc_8c_source.html#l00075">rpzaenc.c:75</a></div></div>
<div class="ttc" id="ainput_8c_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="input_8c_source.html#l00407">input.c:407</a></div></div>
<div class="ttc" id="aput__bits_8h_html_a57c57e21dbbc8777ed8a0a78ba89fc7d"><div class="ttname"><a href="put__bits_8h.html#a57c57e21dbbc8777ed8a0a78ba89fc7d">put_bits_count</a></div><div class="ttdeci">static int put_bits_count(PutBitContext *s)</div><div class="ttdef"><b>Definition:</b> <a href="put__bits_8h_source.html#l00083">put_bits.h:83</a></div></div>
<div class="ttc" id="alibavutil_2internal_8h_html"><div class="ttname"><a href="libavutil_2internal_8h.html">internal.h</a></div></div>
<div class="ttc" id="acommon_8h_html"><div class="ttname"><a href="common_8h.html">common.h</a></div></div>
<div class="ttc" id="apixfmt_8h_html_afd53c0e6c6f6225fa90f1edff9f9ec55"><div class="ttname"><a href="pixfmt_8h.html#afd53c0e6c6f6225fa90f1edff9f9ec55">AV_PIX_FMT_RGB555</a></div><div class="ttdeci">#define AV_PIX_FMT_RGB555</div><div class="ttdef"><b>Definition:</b> <a href="pixfmt_8h_source.html#l00387">pixfmt.h:387</a></div></div>
<div class="ttc" id="aaudio__convert_8c_html_ae1affc9ca37cfb624959c866a73f83c2"><div class="ttname"><a href="audio__convert_8c.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a></div><div class="ttdeci">uint8_t</div><div class="ttdef"><b>Definition:</b> <a href="audio__convert_8c_source.html#l00194">audio_convert.c:194</a></div></div>
<div class="ttc" id="astructrgb_html_afd9a3feaf22de2f96ba25d19494235a6"><div class="ttname"><a href="structrgb.html#afd9a3feaf22de2f96ba25d19494235a6">rgb::r</a></div><div class="ttdeci">uint8_t r</div><div class="ttdef"><b>Definition:</b> <a href="rpzaenc_8c_source.html#l00059">rpzaenc.c:59</a></div></div>
<div class="ttc" id="astruct_put_bit_context_html"><div class="ttname"><a href="struct_put_bit_context.html">PutBitContext</a></div><div class="ttdef"><b>Definition:</b> <a href="put__bits_8h_source.html#l00051">put_bits.h:51</a></div></div>
<div class="ttc" id="astruct_a_v_codec_html_ad3daa3e729850b573c139a83be8938ca"><div class="ttname"><a href="struct_a_v_codec.html#ad3daa3e729850b573c139a83be8938ca">AVCodec::name</a></div><div class="ttdeci">const char * name</div><div class="ttdef"><b>Definition:</b> <a href="codec_8h_source.html#l00197">codec.h:197</a></div></div>
<div class="ttc" id="arpzaenc_8c_html_a011934ef56f31ee369d5376b3c597fcc"><div class="ttname"><a href="rpzaenc_8c.html#a011934ef56f31ee369d5376b3c597fcc">get_max_component_diff</a></div><div class="ttdeci">static void get_max_component_diff(BlockInfo *bi, uint16_t *block_ptr, uint8_t *min, uint8_t *max, channel_offset *chan)</div><div class="ttdef"><b>Definition:</b> <a href="rpzaenc_8c_source.html#l00194">rpzaenc.c:194</a></div></div>
<div class="ttc" id="aavcodec_8h_html"><div class="ttname"><a href="avcodec_8h.html">avcodec.h</a></div></div>
<div class="ttc" id="astruct_block_info_html_ad735c2b9940d3c557bb930075e4cd32f"><div class="ttname"><a href="struct_block_info.html#ad735c2b9940d3c557bb930075e4cd32f">BlockInfo::start</a></div><div class="ttdeci">uint16_t start</div><div class="ttdef"><b>Definition:</b> <a href="rpzaenc_8c_source.html#l00080">rpzaenc.c:80</a></div></div>
<div class="ttc" id="afilter__design_8txt_html_af1ec77bdca1b30e8153fc5da88f603db"><div class="ttname"><a href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a></div><div class="ttdeci">ret</div><div class="ttdef"><b>Definition:</b> <a href="filter__design_8txt_source.html#l00187">filter_design.txt:187</a></div></div>
<div class="ttc" id="arpzaenc_8c_html_ab6c31af54a7b8ae8e20957fb3cd97f10"><div class="ttname"><a href="rpzaenc_8c.html#ab6c31af54a7b8ae8e20957fb3cd97f10">rgb24_to_rgb555</a></div><div class="ttdeci">static uint16_t rgb24_to_rgb555(uint8_t *rgb24)</div><div class="ttdef"><b>Definition:</b> <a href="rpzaenc_8c_source.html#l00137">rpzaenc.c:137</a></div></div>
<div class="ttc" id="astruct_block_info_html_ae69e376b474d2c9139b559c705d8b061"><div class="ttname"><a href="struct_block_info.html#ae69e376b474d2c9139b559c705d8b061">BlockInfo::blocks_per_row</a></div><div class="ttdeci">int blocks_per_row</div><div class="ttdef"><b>Definition:</b> <a href="rpzaenc_8c_source.html#l00082">rpzaenc.c:82</a></div></div>
<div class="ttc" id="afilter__design_8txt_html_a48ad71a5b40cdd5f23c601f33665a953"><div class="ttname"><a href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a></div><div class="ttdeci">these buffered frames must be flushed immediately if a new input produces new the filter must not call request_frame to get more It must just process the frame or queue it The task of requesting more frames is left to the filter s request_frame method or the application If a filter has several the filter must be ready for frames arriving randomly on any input any filter with several inputs will most likely require some kind of queuing mechanism It is perfectly acceptable to have a limited queue and to drop frames when the inputs are too unbalanced request_frame For filters that do not use the this method is called when a frame is wanted on an output For a it should directly call filter_frame on the corresponding output For a if there are queued frames already one of these frames should be pushed If the filter should request a frame on one of its repeatedly until at least one frame has been pushed Return or at least make progress towards producing a frame</div><div class="ttdef"><b>Definition:</b> <a href="filter__design_8txt_source.html#l00264">filter_design.txt:264</a></div></div>
<div class="ttc" id="astruct_a_v_packet_html"><div class="ttname"><a href="struct_a_v_packet.html">AVPacket</a></div><div class="ttdef"><b>Definition:</b> <a href="packet_8h_source.html#l00340">packet.h:340</a></div></div>
<div class="ttc" id="astruct_a_v_frame_html_a1d0f65014a8d1bf78cec8cbed2304992"><div class="ttname"><a href="struct_a_v_frame.html#a1d0f65014a8d1bf78cec8cbed2304992">AVFrame::data</a></div><div class="ttdeci">uint8_t * data[AV_NUM_DATA_POINTERS]</div><div class="ttdef"><b>Definition:</b> <a href="frame_8h_source.html#l00322">frame.h:322</a></div></div>
<div class="ttc" id="ademuxing__decoding_8c_html_a3d4c6562f0b27cf0cacbbea5c038c090"><div class="ttname"><a href="demuxing__decoding_8c.html#a3d4c6562f0b27cf0cacbbea5c038c090">pkt</a></div><div class="ttdeci">static AVPacket pkt</div><div class="ttdef"><b>Definition:</b> <a href="demuxing__decoding_8c_source.html#l00054">demuxing_decoding.c:54</a></div></div>
<div class="ttc" id="astruct_a_v_frame_html_aed14fa772ce46881020fd1545c86432c"><div class="ttname"><a href="struct_a_v_frame.html#aed14fa772ce46881020fd1545c86432c">AVFrame::format</a></div><div class="ttdeci">int format</div><div class="ttdef"><b>Definition:</b> <a href="frame_8h_source.html#l00381">frame.h:381</a></div></div>
<div class="ttc" id="apixfmt_8h_html_a9a8e335cf3be472042bc9f0cf80cd4c5a0e08f8a5d0fa21c3e258816a9dcce7c3"><div class="ttname"><a href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a0e08f8a5d0fa21c3e258816a9dcce7c3">AV_PIX_FMT_NONE</a></div><div class="ttdeci">@ AV_PIX_FMT_NONE</div><div class="ttdef"><b>Definition:</b> <a href="pixfmt_8h_source.html#l00065">pixfmt.h:65</a></div></div>
<div class="ttc" id="agroup__avoptions_html_ggabd75aa30eb8ad6387672df9a1fa79444ac068b8f6afeeb293a13aeabb5d702411"><div class="ttname"><a href="group__avoptions.html#ggabd75aa30eb8ad6387672df9a1fa79444ac068b8f6afeeb293a13aeabb5d702411">AV_OPT_TYPE_INT</a></div><div class="ttdeci">@ AV_OPT_TYPE_INT</div><div class="ttdef"><b>Definition:</b> <a href="opt_8h_source.html#l00225">opt.h:225</a></div></div>
<div class="ttc" id="astruct_a_v_packet_html_a4d1ea19f63eb107111fd650ca514d1f4"><div class="ttname"><a href="struct_a_v_packet.html#a4d1ea19f63eb107111fd650ca514d1f4">AVPacket::size</a></div><div class="ttdeci">int size</div><div class="ttdef"><b>Definition:</b> <a href="packet_8h_source.html#l00364">packet.h:364</a></div></div>
<div class="ttc" id="arpzaenc_8c_html_a384ff94b5139f441c282c9b4c7b985e6"><div class="ttname"><a href="rpzaenc_8c.html#a384ff94b5139f441c282c9b4c7b985e6">options</a></div><div class="ttdeci">static const AVOption options[]</div><div class="ttdef"><b>Definition:</b> <a href="rpzaenc_8c_source.html#l00830">rpzaenc.c:830</a></div></div>
<div class="ttc" id="arpzaenc_8c_html_a7b8da94fb39e743a39c3835b2751d2ac"><div class="ttname"><a href="rpzaenc_8c.html#a7b8da94fb39e743a39c3835b2751d2ac">rgb</a></div><div class="ttdeci">struct rgb rgb</div></div>
<div class="ttc" id="agroup__lavu__misc_html_gga9a84bba4713dfced21a1a56163be1f48ac1a46f59be5c6c2d3412ab172d6b8cf5"><div class="ttname"><a href="group__lavu__misc.html#gga9a84bba4713dfced21a1a56163be1f48ac1a46f59be5c6c2d3412ab172d6b8cf5">AVMEDIA_TYPE_VIDEO</a></div><div class="ttdeci">@ AVMEDIA_TYPE_VIDEO</div><div class="ttdef"><b>Definition:</b> <a href="avutil_8h_source.html#l00201">avutil.h:201</a></div></div>
<div class="ttc" id="agroup__lavc__core_html_ggaadca229ad2c20e060a14fec08a5cc7cea2e83b6080158a68a1e2486e342d2c36d"><div class="ttname"><a href="group__lavc__core.html#ggaadca229ad2c20e060a14fec08a5cc7cea2e83b6080158a68a1e2486e342d2c36d">AV_CODEC_ID_RPZA</a></div><div class="ttdeci">@ AV_CODEC_ID_RPZA</div><div class="ttdef"><b>Definition:</b> <a href="codec__id_8h_source.html#l00091">codec_id.h:91</a></div></div>
<div class="ttc" id="aput__bits_8h_html_a6f7bba5ea37c63f99b266928759fe6f6"><div class="ttname"><a href="put__bits_8h.html#a6f7bba5ea37c63f99b266928759fe6f6">flush_put_bits</a></div><div class="ttdeci">static void flush_put_bits(PutBitContext *s)</div><div class="ttdef"><b>Definition:</b> <a href="put__bits_8h_source.html#l00117">put_bits.h:117</a></div></div>
<div class="ttc" id="arpzaenc_8c_html_a8814f46d12fa3078f121b7912e83face"><div class="ttname"><a href="rpzaenc_8c.html#a8814f46d12fa3078f121b7912e83face">match_color</a></div><div class="ttdeci">static int match_color(uint16_t *color, uint8_t colors[4][3])</div><div class="ttdef"><b>Definition:</b> <a href="rpzaenc_8c_source.html#l00358">rpzaenc.c:358</a></div></div>
<div class="ttc" id="astruct_a_v_codec_html"><div class="ttname"><a href="struct_a_v_codec.html">AVCodec</a></div><div class="ttdef"><b>Definition:</b> <a href="codec_8h_source.html#l00190">codec.h:190</a></div></div>
<div class="ttc" id="avf__palettegen_8c_html_a0fa5abf62b01f8a592bca729cb14390b"><div class="ttname"><a href="vf__palettegen_8c.html#a0fa5abf62b01f8a592bca729cb14390b">diff</a></div><div class="ttdeci">static av_always_inline int diff(const uint32_t a, const uint32_t b)</div><div class="ttdef"><b>Definition:</b> <a href="vf__palettegen_8c_source.html#l00136">vf_palettegen.c:136</a></div></div>
<div class="ttc" id="astruct_block_info_html_ab09b46083586081c17a1ac9ae62c05c4"><div class="ttname"><a href="struct_block_info.html#ab09b46083586081c17a1ac9ae62c05c4">BlockInfo::image_height</a></div><div class="ttdeci">int image_height</div><div class="ttdef"><b>Definition:</b> <a href="rpzaenc_8c_source.html#l00078">rpzaenc.c:78</a></div></div>
<div class="ttc" id="arpzaenc_8c_html_ade8726343ca32cab0df4d619b18bf083"><div class="ttname"><a href="rpzaenc_8c.html#ade8726343ca32cab0df4d619b18bf083">R</a></div><div class="ttdeci">#define R(color)</div><div class="ttdef"><b>Definition:</b> <a href="rpzaenc_8c_source.html#l00068">rpzaenc.c:68</a></div></div>
<div class="ttc" id="arpzaenc_8c_html_aae67f52f25c39daf698c21b9493a4670"><div class="ttname"><a href="rpzaenc_8c.html#aae67f52f25c39daf698c21b9493a4670">rpza_encode_stream</a></div><div class="ttdeci">static void rpza_encode_stream(RpzaContext *s, const AVFrame *pict)</div><div class="ttdef"><b>Definition:</b> <a href="rpzaenc_8c_source.html#l00547">rpzaenc.c:547</a></div></div>
<div class="ttc" id="afilter__design_8txt_html_a17afa58b2bc574dedcd1cc02e1fdf165"><div class="ttname"><a href="filter__design_8txt.html#a17afa58b2bc574dedcd1cc02e1fdf165">block</a></div><div class="ttdeci">The exact code depends on how similar the blocks are and how related they are to the block</div><div class="ttdef"><b>Definition:</b> <a href="filter__design_8txt_source.html#l00207">filter_design.txt:207</a></div></div>
<div class="ttc" id="arpzaenc_8c_html_acf0ec3c727fd0f0c4654ce4f1db61b57"><div class="ttname"><a href="rpzaenc_8c.html#acf0ec3c727fd0f0c4654ce4f1db61b57">update_block_stats</a></div><div class="ttdeci">static int update_block_stats(RpzaContext *s, BlockInfo *bi, uint16_t *block, uint8_t min_color[3], uint8_t max_color[3], int *total_rgb, int *total_pixels, uint8_t avg_color[3], int first_block)</div><div class="ttdef"><b>Definition:</b> <a href="rpzaenc_8c_source.html#l00443">rpzaenc.c:443</a></div></div>
<div class="ttc" id="arpzaenc_8c_html_a7fb1cb42a3c0a283e5f267363fcb647a"><div class="ttname"><a href="rpzaenc_8c.html#a7fb1cb42a3c0a283e5f267363fcb647a">diff_colors</a></div><div class="ttdeci">static int diff_colors(uint8_t *colorA, uint8_t *colorB)</div><div class="ttdef"><b>Definition:</b> <a href="rpzaenc_8c_source.html#l00156">rpzaenc.c:156</a></div></div>
<div class="ttc" id="astruct_a_v_frame_html"><div class="ttname"><a href="struct_a_v_frame.html">AVFrame</a></div><div class="ttdef"><b>Definition:</b> <a href="frame_8h_source.html#l00308">frame.h:308</a></div></div>
<div class="ttc" id="arpzaenc_8c_html_a10506cde2082afe0da80f03b36268036"><div class="ttname"><a href="rpzaenc_8c.html#a10506cde2082afe0da80f03b36268036">BlockInfo</a></div><div class="ttdeci">struct BlockInfo BlockInfo</div></div>
<div class="ttc" id="aencode_8c_html_a699df1216e8d9d57959f99508e9aadf6"><div class="ttname"><a href="encode_8c.html#a699df1216e8d9d57959f99508e9aadf6">ff_alloc_packet2</a></div><div class="ttdeci">int ff_alloc_packet2(AVCodecContext *avctx, AVPacket *avpkt, int64_t size, int64_t min_size)</div><div class="ttdef"><b>Definition:</b> <a href="encode_8c_source.html#l00033">encode.c:33</a></div></div>
<div class="ttc" id="affmpeg__filter_8c_html_a61569f2965b7a369eb10b6d75d410d11"><div class="ttname"><a href="ffmpeg__filter_8c.html#a61569f2965b7a369eb10b6d75d410d11">int</a></div><div class="ttdeci">int</div><div class="ttdef"><b>Definition:</b> <a href="ffmpeg__filter_8c_source.html#l00193">ffmpeg_filter.c:193</a></div></div>
<div class="ttc" id="aput__bits_8h_html"><div class="ttname"><a href="put__bits_8h.html">put_bits.h</a></div></div>
<div class="ttc" id="arpzaenc_8c_html_a16c8a1cbca001b0d85014be30fe1be1b"><div class="ttname"><a href="rpzaenc_8c.html#a16c8a1cbca001b0d85014be30fe1be1b">rpza_encode_frame</a></div><div class="ttdeci">static int rpza_encode_frame(AVCodecContext *avctx, AVPacket *pkt, const AVFrame *frame, int *got_packet)</div><div class="ttdef"><b>Definition:</b> <a href="rpzaenc_8c_source.html#l00773">rpzaenc.c:773</a></div></div>
<div class="ttc" id="arpzaenc_8c_html_a711276ee24330e7c2608f21b73c7568f"><div class="ttname"><a href="rpzaenc_8c.html#a711276ee24330e7c2608f21b73c7568f">max_component_diff</a></div><div class="ttdeci">static int max_component_diff(uint16_t *colorA, uint16_t *colorB)</div><div class="ttdef"><b>Definition:</b> <a href="rpzaenc_8c_source.html#l00170">rpzaenc.c:170</a></div></div>
<div class="ttc" id="aebur128_8h_html_af4463779bb9b119822c94419a10d31c0"><div class="ttname"><a href="ebur128_8h.html#af4463779bb9b119822c94419a10d31c0">channel</a></div><div class="ttdeci">channel</div><div class="ttdef"><b>Definition:</b> <a href="ebur128_8h_source.html#l00039">ebur128.h:39</a></div></div>
<div class="ttc" id="astruct_rpza_context_html_afdbdea5f80dcedf13d3e0b9d895496cb"><div class="ttname"><a href="struct_rpza_context.html#afdbdea5f80dcedf13d3e0b9d895496cb">RpzaContext::start_one_color_thresh</a></div><div class="ttdeci">int start_one_color_thresh</div><div class="ttdef"><b>Definition:</b> <a href="rpzaenc_8c_source.html#l00038">rpzaenc.c:38</a></div></div>
<div class="ttc" id="avorbis__enc__data_8h_html_ad2e88d75f808e6d4e78d48bceb10c336"><div class="ttname"><a href="vorbis__enc__data_8h.html#ad2e88d75f808e6d4e78d48bceb10c336">min</a></div><div class="ttdeci">float min</div><div class="ttdef"><b>Definition:</b> <a href="vorbis__enc__data_8h_source.html#l00456">vorbis_enc_data.h:456</a></div></div>
<div class="ttc" id="arpzaenc_8c_html_ad7f25e97333df3583e8b6f9210b3c8ac"><div class="ttname"><a href="rpzaenc_8c.html#ad7f25e97333df3583e8b6f9210b3c8ac">GET_CHAN</a></div><div class="ttdeci">#define GET_CHAN(color, chan)</div><div class="ttdef"><b>Definition:</b> <a href="rpzaenc_8c_source.html#l00067">rpzaenc.c:67</a></div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.8.20
</small></address>
</body>
</html>
