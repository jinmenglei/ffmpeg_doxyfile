<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>My Project: E:/github/ffmpeg/libavcodec/vaapi_encode.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">My Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_737c44b861ba7ee498141742fb455fa8.html">ffmpeg</a></li><li class="navelem"><a class="el" href="dir_56ad1dd09ca1ce410b5ba2c46dd71e4b.html">libavcodec</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">vaapi_encode.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="libavcodec_2vaapi__encode_8c.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> * This file is part of FFmpeg.</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> * FFmpeg is free software; you can redistribute it and/or</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> * modify it under the terms of the GNU Lesser General Public</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> * License as published by the Free Software Foundation; either</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> * version 2.1 of the License, or (at your option) any later version.</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> * FFmpeg is distributed in the hope that it will be useful,</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> * Lesser General Public License for more details.</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"> * You should have received a copy of the GNU Lesser General Public</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"> * License along with FFmpeg; if not, write to the Free Software</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"> * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160; </div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#include &lt;inttypes.h&gt;</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160; </div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="avassert_8h.html">libavutil/avassert.h</a>&quot;</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="common_8h.html">libavutil/common.h</a>&quot;</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="log_8h.html">libavutil/log.h</a>&quot;</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="pixdesc_8h.html">libavutil/pixdesc.h</a>&quot;</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160; </div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="vaapi__encode_8h.html">vaapi_encode.h</a>&quot;</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="encode_8h.html">encode.h</a>&quot;</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="avcodec_8h.html">avcodec.h</a>&quot;</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160; </div>
<div class="line"><a name="l00031"></a><span class="lineno"><a class="line" href="vaapi__encode_8h.html#a35f8a0672b026556d23848415260b9e3">   31</a></span>&#160;<span class="keyword">const</span> <a class="code" href="struct_a_v_codec_h_w_config_internal.html">AVCodecHWConfigInternal</a> *<span class="keyword">const</span> <a class="code" href="libavcodec_2vaapi__encode_8c.html#a35f8a0672b026556d23848415260b9e3">ff_vaapi_encode_hw_configs</a>[] = {</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    <a class="code" href="hwconfig_8h.html#a67594da711e5397d009cef8b48cd8001">HW_CONFIG_ENCODER_FRAMES</a>(VAAPI, VAAPI),</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;};</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160; </div>
<div class="line"><a name="l00036"></a><span class="lineno"><a class="line" href="libavcodec_2vaapi__encode_8c.html#acc021d89d7c70708bba85f7972610bf0">   36</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> * <span class="keyword">const</span> <a class="code" href="libavcodec_2vaapi__encode_8c.html#acc021d89d7c70708bba85f7972610bf0">picture_type_name</a>[] = { <span class="stringliteral">&quot;IDR&quot;</span>, <span class="stringliteral">&quot;I&quot;</span>, <span class="stringliteral">&quot;P&quot;</span>, <span class="stringliteral">&quot;B&quot;</span> };</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160; </div>
<div class="line"><a name="l00038"></a><span class="lineno"><a class="line" href="libavcodec_2vaapi__encode_8c.html#a3176053f5249c1bed25ddfe8409c5a2c">   38</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="libavcodec_2vaapi__encode_8c.html#a3176053f5249c1bed25ddfe8409c5a2c">vaapi_encode_make_packed_header</a>(<a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a> *avctx,</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;                                           <a class="code" href="struct_v_a_a_p_i_encode_picture.html">VAAPIEncodePicture</a> *pic,</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;                                           <span class="keywordtype">int</span> <a class="code" href="writing__filters_8txt.html#a860450fba1f740387dc082792ad89517">type</a>, <span class="keywordtype">char</span> *<a class="code" href="mxf_8c.html#a084824fc871e38157790c99ae1240842">data</a>, <span class="keywordtype">size_t</span> bit_len)</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;{</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    <a class="code" href="struct_v_a_a_p_i_encode_context.html">VAAPIEncodeContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a> = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#af3379123060ad8cc9c321c29af4f8360">priv_data</a>;</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    VAStatus vas;</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    VABufferID param_buffer, data_buffer;</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    VABufferID *tmp;</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    VAEncPackedHeaderParameterBuffer params = {</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;        .type = <a class="code" href="writing__filters_8txt.html#a860450fba1f740387dc082792ad89517">type</a>,</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;        .bit_length = bit_len,</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;        .has_emulation_bytes = 1,</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    };</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160; </div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    tmp = <a class="code" href="mem_8c.html#aadc230ece36ef112710b262a6601a16b">av_realloc_array</a>(pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#ada59d0ef73e012e82205dadb78aea94d">param_buffers</a>, <span class="keyword">sizeof</span>(*tmp), pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#abbc37306887fd1c4d4978d75ece71864">nb_param_buffers</a> + 2);</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    <span class="keywordflow">if</span> (!tmp)</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#ada59d0ef73e012e82205dadb78aea94d">param_buffers</a> = tmp;</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160; </div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    vas = vaCreateBuffer(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;hwctx-&gt;display, <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;va_context,</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;                         VAEncPackedHeaderParameterBufferType,</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;                         <span class="keyword">sizeof</span>(params), 1, &amp;params, &amp;param_buffer);</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    <span class="keywordflow">if</span> (vas != VA_STATUS_SUCCESS) {</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to create parameter buffer &quot;</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;               <span class="stringliteral">&quot;for packed header (type %d): %d (%s).\n&quot;</span>,</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;               <a class="code" href="writing__filters_8txt.html#a860450fba1f740387dc082792ad89517">type</a>, vas, vaErrorStr(vas));</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EIO);</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    }</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#ada59d0ef73e012e82205dadb78aea94d">param_buffers</a>[pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#abbc37306887fd1c4d4978d75ece71864">nb_param_buffers</a>++] = param_buffer;</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160; </div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    vas = vaCreateBuffer(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;hwctx-&gt;display, <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;va_context,</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;                         VAEncPackedHeaderDataBufferType,</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;                         (bit_len + 7) / 8, 1, <a class="code" href="mxf_8c.html#a084824fc871e38157790c99ae1240842">data</a>, &amp;data_buffer);</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    <span class="keywordflow">if</span> (vas != VA_STATUS_SUCCESS) {</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to create data buffer &quot;</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;               <span class="stringliteral">&quot;for packed header (type %d): %d (%s).\n&quot;</span>,</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;               <a class="code" href="writing__filters_8txt.html#a860450fba1f740387dc082792ad89517">type</a>, vas, vaErrorStr(vas));</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EIO);</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    }</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#ada59d0ef73e012e82205dadb78aea94d">param_buffers</a>[pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#abbc37306887fd1c4d4978d75ece71864">nb_param_buffers</a>++] = data_buffer;</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160; </div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga5b7221c3afd06848486776bd834a58a5">AV_LOG_DEBUG</a>, <span class="stringliteral">&quot;Packed header buffer (%d) is %#x/%#x &quot;</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;           <span class="stringliteral">&quot;(%zu bits).\n&quot;</span>, <a class="code" href="writing__filters_8txt.html#a860450fba1f740387dc082792ad89517">type</a>, param_buffer, data_buffer, bit_len);</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;}</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160; </div>
<div class="line"><a name="l00084"></a><span class="lineno"><a class="line" href="libavcodec_2vaapi__encode_8c.html#ac4748e44fc410421f3dbeb6b3889cb98">   84</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="libavcodec_2vaapi__encode_8c.html#ac4748e44fc410421f3dbeb6b3889cb98">vaapi_encode_make_param_buffer</a>(<a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a> *avctx,</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;                                          <a class="code" href="struct_v_a_a_p_i_encode_picture.html">VAAPIEncodePicture</a> *pic,</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;                                          <span class="keywordtype">int</span> <a class="code" href="writing__filters_8txt.html#a860450fba1f740387dc082792ad89517">type</a>, <span class="keywordtype">char</span> *<a class="code" href="mxf_8c.html#a084824fc871e38157790c99ae1240842">data</a>, <span class="keywordtype">size_t</span> <a class="code" href="vorbis__enc__data_8h.html#afed088663f8704004425cdae2120b9b3">len</a>)</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;{</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    <a class="code" href="struct_v_a_a_p_i_encode_context.html">VAAPIEncodeContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a> = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#af3379123060ad8cc9c321c29af4f8360">priv_data</a>;</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    VAStatus vas;</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    VABufferID *tmp;</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    VABufferID <a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a>;</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160; </div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    tmp = <a class="code" href="mem_8c.html#aadc230ece36ef112710b262a6601a16b">av_realloc_array</a>(pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#ada59d0ef73e012e82205dadb78aea94d">param_buffers</a>, <span class="keyword">sizeof</span>(*tmp), pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#abbc37306887fd1c4d4978d75ece71864">nb_param_buffers</a> + 1);</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <span class="keywordflow">if</span> (!tmp)</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#ada59d0ef73e012e82205dadb78aea94d">param_buffers</a> = tmp;</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160; </div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    vas = vaCreateBuffer(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;hwctx-&gt;display, <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;va_context,</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;                         <a class="code" href="writing__filters_8txt.html#a860450fba1f740387dc082792ad89517">type</a>, <a class="code" href="vorbis__enc__data_8h.html#afed088663f8704004425cdae2120b9b3">len</a>, 1, <a class="code" href="mxf_8c.html#a084824fc871e38157790c99ae1240842">data</a>, &amp;<a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a>);</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    <span class="keywordflow">if</span> (vas != VA_STATUS_SUCCESS) {</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to create parameter buffer &quot;</span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;               <span class="stringliteral">&quot;(type %d): %d (%s).\n&quot;</span>, <a class="code" href="writing__filters_8txt.html#a860450fba1f740387dc082792ad89517">type</a>, vas, vaErrorStr(vas));</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EIO);</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    }</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#ada59d0ef73e012e82205dadb78aea94d">param_buffers</a>[pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#abbc37306887fd1c4d4978d75ece71864">nb_param_buffers</a>++] = <a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a>;</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160; </div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga5b7221c3afd06848486776bd834a58a5">AV_LOG_DEBUG</a>, <span class="stringliteral">&quot;Param buffer (%d) is %#x.\n&quot;</span>,</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;           <a class="code" href="writing__filters_8txt.html#a860450fba1f740387dc082792ad89517">type</a>, <a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a>);</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;}</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160; </div>
<div class="line"><a name="l00112"></a><span class="lineno"><a class="line" href="libavcodec_2vaapi__encode_8c.html#a8064f29ddd1422812424eb17c3f2e93c">  112</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="libavcodec_2vaapi__encode_8c.html#a8064f29ddd1422812424eb17c3f2e93c">vaapi_encode_make_misc_param_buffer</a>(<a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a> *avctx,</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;                                               <a class="code" href="struct_v_a_a_p_i_encode_picture.html">VAAPIEncodePicture</a> *pic,</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;                                               <span class="keywordtype">int</span> <a class="code" href="writing__filters_8txt.html#a860450fba1f740387dc082792ad89517">type</a>,</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;                                               <span class="keyword">const</span> <span class="keywordtype">void</span> *<a class="code" href="mxf_8c.html#a084824fc871e38157790c99ae1240842">data</a>, <span class="keywordtype">size_t</span> <a class="code" href="vorbis__enc__data_8h.html#afed088663f8704004425cdae2120b9b3">len</a>)</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;{</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    <span class="comment">// Construct the buffer on the stack - 1KB is much larger than any</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    <span class="comment">// current misc parameter buffer type (the largest is EncQuality at</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    <span class="comment">// 224 bytes).</span></div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    <a class="code" href="audio__convert_8c.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> <a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a>[1024];</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    VAEncMiscParameterBuffer <a class="code" href="sdr2_8c.html#abd18f6ed7dc5da8824a97bc504e4280e">header</a> = {</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;        .type = <a class="code" href="writing__filters_8txt.html#a860450fba1f740387dc082792ad89517">type</a>,</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    };</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    <span class="keywordtype">size_t</span> buffer_size = <span class="keyword">sizeof</span>(<a class="code" href="sdr2_8c.html#abd18f6ed7dc5da8824a97bc504e4280e">header</a>) + <a class="code" href="vorbis__enc__data_8h.html#afed088663f8704004425cdae2120b9b3">len</a>;</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    <a class="code" href="avassert_8h.html#aae204192396f78cc8c5cd7ad5c57c23f">av_assert0</a>(buffer_size &lt;= <span class="keyword">sizeof</span>(<a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a>));</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160; </div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    memcpy(<a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a>, &amp;<a class="code" href="sdr2_8c.html#abd18f6ed7dc5da8824a97bc504e4280e">header</a>, <span class="keyword">sizeof</span>(<a class="code" href="sdr2_8c.html#abd18f6ed7dc5da8824a97bc504e4280e">header</a>));</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    memcpy(<a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a> + <span class="keyword">sizeof</span>(<a class="code" href="sdr2_8c.html#abd18f6ed7dc5da8824a97bc504e4280e">header</a>), <a class="code" href="mxf_8c.html#a084824fc871e38157790c99ae1240842">data</a>, <a class="code" href="vorbis__enc__data_8h.html#afed088663f8704004425cdae2120b9b3">len</a>);</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160; </div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="libavcodec_2vaapi__encode_8c.html#ac4748e44fc410421f3dbeb6b3889cb98">vaapi_encode_make_param_buffer</a>(avctx, pic,</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;                                          VAEncMiscParameterBufferType,</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;                                          <a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a>, buffer_size);</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;}</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160; </div>
<div class="line"><a name="l00135"></a><span class="lineno"><a class="line" href="libavcodec_2vaapi__encode_8c.html#a0c592d403bde93efd08918492f9a68d0">  135</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="libavcodec_2vaapi__encode_8c.html#a0c592d403bde93efd08918492f9a68d0">vaapi_encode_wait</a>(<a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a> *avctx,</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;                             <a class="code" href="struct_v_a_a_p_i_encode_picture.html">VAAPIEncodePicture</a> *pic)</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;{</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    <a class="code" href="struct_v_a_a_p_i_encode_context.html">VAAPIEncodeContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a> = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#af3379123060ad8cc9c321c29af4f8360">priv_data</a>;</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    VAStatus vas;</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160; </div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    <a class="code" href="avassert_8h.html#aae204192396f78cc8c5cd7ad5c57c23f">av_assert0</a>(pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a459df71dd956fce38da5710b840084ec">encode_issued</a>);</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160; </div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    <span class="keywordflow">if</span> (pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a9201c92d265a5e6b5f0c3195e0b9f251">encode_complete</a>) {</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;        <span class="comment">// Already waited for this picture.</span></div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    }</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160; </div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga5b7221c3afd06848486776bd834a58a5">AV_LOG_DEBUG</a>, <span class="stringliteral">&quot;Sync to pic %&quot;</span>PRId64<span class="stringliteral">&quot;/%&quot;</span>PRId64<span class="stringliteral">&quot; &quot;</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;           <span class="stringliteral">&quot;(input surface %#x).\n&quot;</span>, pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a4c211c3d8a02e456836bf7c7102151b2">display_order</a>,</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;           pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#aeebf0e912cc72cb3f0d394fe86019cda">encode_order</a>, pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#ab2e74518853179b0afc82386e65c014e">input_surface</a>);</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160; </div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    vas = vaSyncSurface(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;hwctx-&gt;display, pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#ab2e74518853179b0afc82386e65c014e">input_surface</a>);</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    <span class="keywordflow">if</span> (vas != VA_STATUS_SUCCESS) {</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to sync to picture completion: &quot;</span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;               <span class="stringliteral">&quot;%d (%s).\n&quot;</span>, vas, vaErrorStr(vas));</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EIO);</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    }</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160; </div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    <span class="comment">// Input is definitely finished with now.</span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    <a class="code" href="group__lavu__frame.html#ga979d73f3228814aee56aeca0636e37cc">av_frame_free</a>(&amp;pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#abdd10141f1025ea3a6903bafd450cbf7">input_image</a>);</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160; </div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a9201c92d265a5e6b5f0c3195e0b9f251">encode_complete</a> = 1;</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;}</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160; </div>
<div class="line"><a name="l00166"></a><span class="lineno"><a class="line" href="libavcodec_2vaapi__encode_8c.html#a74618fe18d23fd63836b464c14303105">  166</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="libavcodec_2vaapi__encode_8c.html#a74618fe18d23fd63836b464c14303105">vaapi_encode_make_row_slice</a>(<a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a> *avctx,</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;                                       <a class="code" href="struct_v_a_a_p_i_encode_picture.html">VAAPIEncodePicture</a> *pic)</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;{</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    <a class="code" href="struct_v_a_a_p_i_encode_context.html">VAAPIEncodeContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a> = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#af3379123060ad8cc9c321c29af4f8360">priv_data</a>;</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    <a class="code" href="struct_v_a_a_p_i_encode_slice.html">VAAPIEncodeSlice</a> *slice;</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>, rounding;</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160; </div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a72a967758798eb575425db365946dfd6">nb_slices</a>; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;        pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#aad6dfdc9e90a4e8cda77793c499c6ef1">slices</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="struct_v_a_a_p_i_encode_slice.html#a1af79506382a30f4ebbcdd5ba0927abd">row_size</a> = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;slice_size;</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160; </div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    rounding = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;slice_block_rows - <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nb_slices * <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;slice_size;</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    <a class="code" href="filter__design_8txt.html#a0e82f1088fdc24c14bf175d2ac77523f">if</a> (rounding &gt; 0) {</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;        <span class="comment">// Place rounding error at top and bottom of frame.</span></div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;        <a class="code" href="avassert_8h.html#aae204192396f78cc8c5cd7ad5c57c23f">av_assert0</a>(rounding &lt; pic-&gt;nb_slices);</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;        <span class="comment">// Some Intel drivers contain a bug where the encoder will fail</span></div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;        <span class="comment">// if the last slice is smaller than the one before it.  Since</span></div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;        <span class="comment">// that&#39;s straightforward to avoid here, just do so.</span></div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;        <span class="keywordflow">if</span> (rounding &lt;= 2) {</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;            <span class="keywordflow">for</span> (<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; rounding; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;                ++pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#aad6dfdc9e90a4e8cda77793c499c6ef1">slices</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="struct_v_a_a_p_i_encode_slice.html#a1af79506382a30f4ebbcdd5ba0927abd">row_size</a>;</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;            <span class="keywordflow">for</span> (<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; (rounding + 1) / 2; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;                ++pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#aad6dfdc9e90a4e8cda77793c499c6ef1">slices</a>[pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a72a967758798eb575425db365946dfd6">nb_slices</a> - <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> - 1].<a class="code" href="struct_v_a_a_p_i_encode_slice.html#a1af79506382a30f4ebbcdd5ba0927abd">row_size</a>;</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;            <a class="code" href="h264pred__template_8c.html#a93cca9adbbca82ea00bf3250781f6dce">for</a> (<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; rounding / 2; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;                ++pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#aad6dfdc9e90a4e8cda77793c499c6ef1">slices</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="struct_v_a_a_p_i_encode_slice.html#a1af79506382a30f4ebbcdd5ba0927abd">row_size</a>;</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;        }</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rounding &lt; 0) {</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;        <span class="comment">// Remove rounding error from last slice only.</span></div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;        <a class="code" href="avassert_8h.html#aae204192396f78cc8c5cd7ad5c57c23f">av_assert0</a>(rounding &lt; ctx-&gt;slice_size);</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;        pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#aad6dfdc9e90a4e8cda77793c499c6ef1">slices</a>[pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a72a967758798eb575425db365946dfd6">nb_slices</a> - 1].<a class="code" href="struct_v_a_a_p_i_encode_slice.html#a1af79506382a30f4ebbcdd5ba0927abd">row_size</a> += rounding;</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    }</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160; </div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a72a967758798eb575425db365946dfd6">nb_slices</a>; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;        slice = &amp;pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#aad6dfdc9e90a4e8cda77793c499c6ef1">slices</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;        slice-&gt;<a class="code" href="struct_v_a_a_p_i_encode_slice.html#a70db41297dea0624085ebbacc418262c">index</a> = <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> == 0) {</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;            slice-&gt;<a class="code" href="struct_v_a_a_p_i_encode_slice.html#ab386a9de917f4be220ba338eabbde3b7">row_start</a>   = 0;</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;            slice-&gt;<a class="code" href="struct_v_a_a_p_i_encode_slice.html#a3a0ea0892268d865f4981ac1b56baff9">block_start</a> = 0;</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;            <span class="keyword">const</span> <a class="code" href="struct_v_a_a_p_i_encode_slice.html">VAAPIEncodeSlice</a> *prev = &amp;pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#aad6dfdc9e90a4e8cda77793c499c6ef1">slices</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> - 1];</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;            slice-&gt;<a class="code" href="struct_v_a_a_p_i_encode_slice.html#ab386a9de917f4be220ba338eabbde3b7">row_start</a>   = prev-&gt;<a class="code" href="struct_v_a_a_p_i_encode_slice.html#ab386a9de917f4be220ba338eabbde3b7">row_start</a>   + prev-&gt;<a class="code" href="struct_v_a_a_p_i_encode_slice.html#a1af79506382a30f4ebbcdd5ba0927abd">row_size</a>;</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;            slice-&gt;<a class="code" href="struct_v_a_a_p_i_encode_slice.html#a3a0ea0892268d865f4981ac1b56baff9">block_start</a> = prev-&gt;<a class="code" href="struct_v_a_a_p_i_encode_slice.html#a3a0ea0892268d865f4981ac1b56baff9">block_start</a> + prev-&gt;<a class="code" href="struct_v_a_a_p_i_encode_slice.html#a21f0b514e8ad6659f990543021c83326">block_size</a>;</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;        }</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;        slice-&gt;<a class="code" href="struct_v_a_a_p_i_encode_slice.html#a21f0b514e8ad6659f990543021c83326">block_size</a>  = slice-&gt;<a class="code" href="struct_v_a_a_p_i_encode_slice.html#a1af79506382a30f4ebbcdd5ba0927abd">row_size</a> * <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;slice_block_cols;</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160; </div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga5b7221c3afd06848486776bd834a58a5">AV_LOG_DEBUG</a>, <span class="stringliteral">&quot;Slice %d: %d-%d (%d rows), &quot;</span></div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;               <span class="stringliteral">&quot;%d-%d (%d blocks).\n&quot;</span>, <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>, slice-&gt;<a class="code" href="struct_v_a_a_p_i_encode_slice.html#ab386a9de917f4be220ba338eabbde3b7">row_start</a>,</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;               slice-&gt;<a class="code" href="struct_v_a_a_p_i_encode_slice.html#ab386a9de917f4be220ba338eabbde3b7">row_start</a> + slice-&gt;<a class="code" href="struct_v_a_a_p_i_encode_slice.html#a1af79506382a30f4ebbcdd5ba0927abd">row_size</a> - 1, slice-&gt;<a class="code" href="struct_v_a_a_p_i_encode_slice.html#a1af79506382a30f4ebbcdd5ba0927abd">row_size</a>,</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;               slice-&gt;<a class="code" href="struct_v_a_a_p_i_encode_slice.html#a3a0ea0892268d865f4981ac1b56baff9">block_start</a>, slice-&gt;<a class="code" href="struct_v_a_a_p_i_encode_slice.html#a3a0ea0892268d865f4981ac1b56baff9">block_start</a> + slice-&gt;<a class="code" href="struct_v_a_a_p_i_encode_slice.html#a21f0b514e8ad6659f990543021c83326">block_size</a> - 1,</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;               slice-&gt;<a class="code" href="struct_v_a_a_p_i_encode_slice.html#a21f0b514e8ad6659f990543021c83326">block_size</a>);</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    }</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160; </div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;}</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160; </div>
<div class="line"><a name="l00221"></a><span class="lineno"><a class="line" href="libavcodec_2vaapi__encode_8c.html#ae708ecb37d37d4bb364397a6abfe00a6">  221</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="libavcodec_2vaapi__encode_8c.html#ae708ecb37d37d4bb364397a6abfe00a6">vaapi_encode_make_tile_slice</a>(<a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a> *avctx,</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;                                        <a class="code" href="struct_v_a_a_p_i_encode_picture.html">VAAPIEncodePicture</a> *pic)</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;{</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    <a class="code" href="struct_v_a_a_p_i_encode_context.html">VAAPIEncodeContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a> = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#af3379123060ad8cc9c321c29af4f8360">priv_data</a>;</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    <a class="code" href="struct_v_a_a_p_i_encode_slice.html">VAAPIEncodeSlice</a> *slice;</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>, j, <a class="code" href="gxfenc_8c.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a>;</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160; </div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;tile_cols; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;        <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;tile_rows; j++) {</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;            <a class="code" href="gxfenc_8c.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a>        = j * <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;tile_cols + <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;            slice        = &amp;pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#aad6dfdc9e90a4e8cda77793c499c6ef1">slices</a>[<a class="code" href="gxfenc_8c.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a>];</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;            slice-&gt;<a class="code" href="struct_v_a_a_p_i_encode_slice.html#a70db41297dea0624085ebbacc418262c">index</a> = <a class="code" href="gxfenc_8c.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a>;</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160; </div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;            pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#aad6dfdc9e90a4e8cda77793c499c6ef1">slices</a>[<a class="code" href="gxfenc_8c.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a>].<a class="code" href="struct_v_a_a_p_i_encode_slice.html#a3a0ea0892268d865f4981ac1b56baff9">block_start</a> = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;col_bd[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>] +</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;                                             <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;row_bd[j] * <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;slice_block_cols;</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;            pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#aad6dfdc9e90a4e8cda77793c499c6ef1">slices</a>[<a class="code" href="gxfenc_8c.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a>].<a class="code" href="struct_v_a_a_p_i_encode_slice.html#a21f0b514e8ad6659f990543021c83326">block_size</a>  = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;row_height[j] * <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;col_width[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160; </div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga5b7221c3afd06848486776bd834a58a5">AV_LOG_DEBUG</a>, <span class="stringliteral">&quot;Slice %2d: (%2d, %2d) start at: %4d &quot;</span></div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;               <span class="stringliteral">&quot;width:%2d height:%2d (%d blocks).\n&quot;</span>, <a class="code" href="gxfenc_8c.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a>, <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;col_bd[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>],</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;               <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;row_bd[j], slice-&gt;<a class="code" href="struct_v_a_a_p_i_encode_slice.html#a3a0ea0892268d865f4981ac1b56baff9">block_start</a>, <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;col_width[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>],</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;               <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;row_height[j], slice-&gt;<a class="code" href="struct_v_a_a_p_i_encode_slice.html#a21f0b514e8ad6659f990543021c83326">block_size</a>);</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;        }</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    }</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160; </div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;}</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160; </div>
<div class="line"><a name="l00248"></a><span class="lineno"><a class="line" href="libavcodec_2vaapi__encode_8c.html#aace97d9deb0efcb149ce16fd6df0e08f">  248</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="libavcodec_2vaapi__encode_8c.html#aace97d9deb0efcb149ce16fd6df0e08f">vaapi_encode_issue</a>(<a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a> *avctx,</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;                              <a class="code" href="struct_v_a_a_p_i_encode_picture.html">VAAPIEncodePicture</a> *pic)</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;{</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    <a class="code" href="struct_v_a_a_p_i_encode_context.html">VAAPIEncodeContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a> = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#af3379123060ad8cc9c321c29af4f8360">priv_data</a>;</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    <a class="code" href="struct_v_a_a_p_i_encode_slice.html">VAAPIEncodeSlice</a> *slice;</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    VAStatus vas;</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    <span class="keywordtype">int</span> err, <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    <span class="keywordtype">char</span> <a class="code" href="mxf_8c.html#a084824fc871e38157790c99ae1240842">data</a>[<a class="code" href="group__avoptions.html#gga06fc87d81c62e9abb8790b6e5713c55baed0269e9bae5024423f71b1f7454bd01">MAX_PARAM_BUFFER_SIZE</a>];</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    <span class="keywordtype">size_t</span> bit_len;</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    <a class="code" href="attributes_8h.html#a7ca8a3900269f92fcc7b68235dea7787">av_unused</a> <a class="code" href="struct_a_v_frame_side_data.html">AVFrameSideData</a> *sd;</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160; </div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga5b7221c3afd06848486776bd834a58a5">AV_LOG_DEBUG</a>, <span class="stringliteral">&quot;Issuing encode for pic %&quot;</span>PRId64<span class="stringliteral">&quot;/%&quot;</span>PRId64<span class="stringliteral">&quot; &quot;</span></div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;           <span class="stringliteral">&quot;as type %s.\n&quot;</span>, pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a4c211c3d8a02e456836bf7c7102151b2">display_order</a>, pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#aeebf0e912cc72cb3f0d394fe86019cda">encode_order</a>,</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;           <a class="code" href="libavcodec_2vaapi__encode_8c.html#acc021d89d7c70708bba85f7972610bf0">picture_type_name</a>[pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a455b050a491e1ce16c0b80781643be42">type</a>]);</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    <span class="keywordflow">if</span> (pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#af7067b239d6821ab286c9c268d1bb799">nb_refs</a> == 0) {</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga5b7221c3afd06848486776bd834a58a5">AV_LOG_DEBUG</a>, <span class="stringliteral">&quot;No reference pictures.\n&quot;</span>);</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga5b7221c3afd06848486776bd834a58a5">AV_LOG_DEBUG</a>, <span class="stringliteral">&quot;Refers to:&quot;</span>);</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#af7067b239d6821ab286c9c268d1bb799">nb_refs</a>; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga5b7221c3afd06848486776bd834a58a5">AV_LOG_DEBUG</a>, <span class="stringliteral">&quot; %&quot;</span>PRId64<span class="stringliteral">&quot;/%&quot;</span>PRId64,</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;                   pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a0f6b20a3de817daa22251145f0967213">refs</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a4c211c3d8a02e456836bf7c7102151b2">display_order</a>, pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a0f6b20a3de817daa22251145f0967213">refs</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#aeebf0e912cc72cb3f0d394fe86019cda">encode_order</a>);</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;        }</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga5b7221c3afd06848486776bd834a58a5">AV_LOG_DEBUG</a>, <span class="stringliteral">&quot;.\n&quot;</span>);</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    }</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160; </div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    <a class="code" href="avassert_8h.html#aae204192396f78cc8c5cd7ad5c57c23f">av_assert0</a>(!pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a459df71dd956fce38da5710b840084ec">encode_issued</a>);</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#af7067b239d6821ab286c9c268d1bb799">nb_refs</a>; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;        <a class="code" href="avassert_8h.html#aae204192396f78cc8c5cd7ad5c57c23f">av_assert0</a>(pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a0f6b20a3de817daa22251145f0967213">refs</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;        <a class="code" href="avassert_8h.html#aae204192396f78cc8c5cd7ad5c57c23f">av_assert0</a>(pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a0f6b20a3de817daa22251145f0967213">refs</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a459df71dd956fce38da5710b840084ec">encode_issued</a>);</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;    }</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160; </div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga5b7221c3afd06848486776bd834a58a5">AV_LOG_DEBUG</a>, <span class="stringliteral">&quot;Input surface is %#x.\n&quot;</span>, pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#ab2e74518853179b0afc82386e65c014e">input_surface</a>);</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160; </div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a03ac94018185f0c41753766088b3951b">recon_image</a> = <a class="code" href="group__lavu__frame.html#gac700017c5270c79c1e1befdeeb008b2f">av_frame_alloc</a>();</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;    <span class="keywordflow">if</span> (!pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a03ac94018185f0c41753766088b3951b">recon_image</a>) {</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;        err = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    }</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160; </div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    err = <a class="code" href="hwcontext_8c.html#adfa5aaa3a4f69b163ea30cadc6d663dc">av_hwframe_get_buffer</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;recon_frames_ref, pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a03ac94018185f0c41753766088b3951b">recon_image</a>, 0);</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    <span class="keywordflow">if</span> (err &lt; 0) {</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;        err = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    }</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a7b20419c52cbcfb242f90a8b35edfc14">recon_surface</a> = (VASurfaceID)(uintptr_t)pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a03ac94018185f0c41753766088b3951b">recon_image</a>-&gt;<a class="code" href="struct_a_v_frame.html#a1d0f65014a8d1bf78cec8cbed2304992">data</a>[3];</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga5b7221c3afd06848486776bd834a58a5">AV_LOG_DEBUG</a>, <span class="stringliteral">&quot;Recon surface is %#x.\n&quot;</span>, pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a7b20419c52cbcfb242f90a8b35edfc14">recon_surface</a>);</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160; </div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a066d9e1a3e58cdae02bb2ccf21e7a57c">output_buffer_ref</a> = <a class="code" href="group__lavu__bufferpool.html#ga2c745ecb4001452423e775b06b20fb7c">av_buffer_pool_get</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;output_buffer_pool);</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    <span class="keywordflow">if</span> (!pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a066d9e1a3e58cdae02bb2ccf21e7a57c">output_buffer_ref</a>) {</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;        err = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    }</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#ab10d79f488c154649c6b6c9ff223f8c6">output_buffer</a> = (VABufferID)(uintptr_t)pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a066d9e1a3e58cdae02bb2ccf21e7a57c">output_buffer_ref</a>-&gt;<a class="code" href="struct_a_v_buffer_ref.html#acb8452e99cd75074b93800b532c6ea4b">data</a>;</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga5b7221c3afd06848486776bd834a58a5">AV_LOG_DEBUG</a>, <span class="stringliteral">&quot;Output buffer is %#x.\n&quot;</span>,</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;           pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#ab10d79f488c154649c6b6c9ff223f8c6">output_buffer</a>);</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160; </div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;codec-&gt;picture_params_size &gt; 0) {</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;        pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a0b5603bae3f5d92488a246b62b7393e6">codec_picture_params</a> = <a class="code" href="tableprint__vlc_8h.html#ae97db1f58b6b1515ed57a83bea3dd572">av_malloc</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;codec-&gt;picture_params_size);</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;        <span class="keywordflow">if</span> (!pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a0b5603bae3f5d92488a246b62b7393e6">codec_picture_params</a>)</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;            <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;        memcpy(pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a0b5603bae3f5d92488a246b62b7393e6">codec_picture_params</a>, <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;codec_picture_params,</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;               <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;codec-&gt;picture_params_size);</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;        <a class="code" href="avassert_8h.html#aae204192396f78cc8c5cd7ad5c57c23f">av_assert0</a>(!<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;codec_picture_params);</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    }</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160; </div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#abbc37306887fd1c4d4978d75ece71864">nb_param_buffers</a> = 0;</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160; </div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    <span class="keywordflow">if</span> (pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a455b050a491e1ce16c0b80781643be42">type</a> == <a class="code" href="vaapi__encode_8h.html#adf764cbdea00d65edcd07bb9953ad2b7ab56d9a8ef94cff8f64aff4c9f115503a">PICTURE_TYPE_IDR</a> &amp;&amp; <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;codec-&gt;init_sequence_params) {</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;        err = <a class="code" href="libavcodec_2vaapi__encode_8c.html#ac4748e44fc410421f3dbeb6b3889cb98">vaapi_encode_make_param_buffer</a>(avctx, pic,</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;                                             VAEncSequenceParameterBufferType,</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;                                             <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;codec_sequence_params,</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;                                             <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;codec-&gt;sequence_params_size);</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;        <span class="keywordflow">if</span> (err &lt; 0)</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;            <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    }</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160; </div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    <span class="keywordflow">if</span> (pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a455b050a491e1ce16c0b80781643be42">type</a> == <a class="code" href="vaapi__encode_8h.html#adf764cbdea00d65edcd07bb9953ad2b7ab56d9a8ef94cff8f64aff4c9f115503a">PICTURE_TYPE_IDR</a>) {</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nb_global_params; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;            err = <a class="code" href="libavcodec_2vaapi__encode_8c.html#a8064f29ddd1422812424eb17c3f2e93c">vaapi_encode_make_misc_param_buffer</a>(avctx, pic,</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;                                                      <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;global_params_type[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>],</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;                                                      <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;global_params[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>],</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;                                                      <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;global_params_size[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;            <span class="keywordflow">if</span> (err &lt; 0)</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;                <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;        }</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    }</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160; </div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;codec-&gt;init_picture_params) {</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;        err = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;codec-&gt;init_picture_params(avctx, pic);</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;        <span class="keywordflow">if</span> (err &lt; 0) {</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to initialise picture &quot;</span></div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;                   <span class="stringliteral">&quot;parameters: %d.\n&quot;</span>, err);</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;            <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;        }</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;        err = <a class="code" href="libavcodec_2vaapi__encode_8c.html#ac4748e44fc410421f3dbeb6b3889cb98">vaapi_encode_make_param_buffer</a>(avctx, pic,</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;                                             VAEncPictureParameterBufferType,</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;                                             pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a0b5603bae3f5d92488a246b62b7393e6">codec_picture_params</a>,</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;                                             <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;codec-&gt;picture_params_size);</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;        <span class="keywordflow">if</span> (err &lt; 0)</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;            <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    }</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160; </div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    <span class="keywordflow">if</span> (pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a455b050a491e1ce16c0b80781643be42">type</a> == <a class="code" href="vaapi__encode_8h.html#adf764cbdea00d65edcd07bb9953ad2b7ab56d9a8ef94cff8f64aff4c9f115503a">PICTURE_TYPE_IDR</a>) {</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;va_packed_headers &amp; VA_ENC_PACKED_HEADER_SEQUENCE &amp;&amp;</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;            <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;codec-&gt;write_sequence_header) {</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;            bit_len = 8 * <span class="keyword">sizeof</span>(<a class="code" href="mxf_8c.html#a084824fc871e38157790c99ae1240842">data</a>);</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;            err = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;codec-&gt;write_sequence_header(avctx, <a class="code" href="mxf_8c.html#a084824fc871e38157790c99ae1240842">data</a>, &amp;bit_len);</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;            <span class="keywordflow">if</span> (err &lt; 0) {</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;                <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to write per-sequence &quot;</span></div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;                       <span class="stringliteral">&quot;header: %d.\n&quot;</span>, err);</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;                <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;            }</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;            err = <a class="code" href="libavcodec_2vaapi__encode_8c.html#a3176053f5249c1bed25ddfe8409c5a2c">vaapi_encode_make_packed_header</a>(avctx, pic,</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;                                                  <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;codec-&gt;sequence_header_type,</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;                                                  <a class="code" href="mxf_8c.html#a084824fc871e38157790c99ae1240842">data</a>, bit_len);</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;            <span class="keywordflow">if</span> (err &lt; 0)</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;                <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;        }</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    }</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160; </div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;va_packed_headers &amp; VA_ENC_PACKED_HEADER_PICTURE &amp;&amp;</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;codec-&gt;write_picture_header) {</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;        bit_len = 8 * <span class="keyword">sizeof</span>(<a class="code" href="mxf_8c.html#a084824fc871e38157790c99ae1240842">data</a>);</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;        err = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;codec-&gt;write_picture_header(avctx, pic, <a class="code" href="mxf_8c.html#a084824fc871e38157790c99ae1240842">data</a>, &amp;bit_len);</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;        <span class="keywordflow">if</span> (err &lt; 0) {</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to write per-picture &quot;</span></div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;                   <span class="stringliteral">&quot;header: %d.\n&quot;</span>, err);</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;            <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;        }</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;        err = <a class="code" href="libavcodec_2vaapi__encode_8c.html#a3176053f5249c1bed25ddfe8409c5a2c">vaapi_encode_make_packed_header</a>(avctx, pic,</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;                                              <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;codec-&gt;picture_header_type,</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;                                              <a class="code" href="mxf_8c.html#a084824fc871e38157790c99ae1240842">data</a>, bit_len);</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;        <span class="keywordflow">if</span> (err &lt; 0)</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;            <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;    }</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160; </div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;codec-&gt;write_extra_buffer) {</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0;; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;            <span class="keywordtype">size_t</span> <a class="code" href="vorbis__enc__data_8h.html#afed088663f8704004425cdae2120b9b3">len</a> = <span class="keyword">sizeof</span>(<a class="code" href="mxf_8c.html#a084824fc871e38157790c99ae1240842">data</a>);</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;            <span class="keywordtype">int</span> <a class="code" href="writing__filters_8txt.html#a860450fba1f740387dc082792ad89517">type</a>;</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;            err = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;codec-&gt;write_extra_buffer(avctx, pic, <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>, &amp;<a class="code" href="writing__filters_8txt.html#a860450fba1f740387dc082792ad89517">type</a>,</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;                                                 <a class="code" href="mxf_8c.html#a084824fc871e38157790c99ae1240842">data</a>, &amp;<a class="code" href="vorbis__enc__data_8h.html#afed088663f8704004425cdae2120b9b3">len</a>);</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;            <span class="keywordflow">if</span> (err == <a class="code" href="group__lavu__error.html#gab4faa0afdf35076914824200331defff">AVERROR_EOF</a>)</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;            <span class="keywordflow">if</span> (err &lt; 0) {</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;                <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to write extra &quot;</span></div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;                       <span class="stringliteral">&quot;buffer %d: %d.\n&quot;</span>, <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>, err);</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;                <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;            }</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160; </div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;            err = <a class="code" href="libavcodec_2vaapi__encode_8c.html#ac4748e44fc410421f3dbeb6b3889cb98">vaapi_encode_make_param_buffer</a>(avctx, pic, <a class="code" href="writing__filters_8txt.html#a860450fba1f740387dc082792ad89517">type</a>,</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;                                                 <a class="code" href="mxf_8c.html#a084824fc871e38157790c99ae1240842">data</a>, <a class="code" href="vorbis__enc__data_8h.html#afed088663f8704004425cdae2120b9b3">len</a>);</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;            <span class="keywordflow">if</span> (err &lt; 0)</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;                <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;        }</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    }</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160; </div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;va_packed_headers &amp; VA_ENC_PACKED_HEADER_MISC &amp;&amp;</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;codec-&gt;write_extra_header) {</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0;; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;            <span class="keywordtype">int</span> <a class="code" href="writing__filters_8txt.html#a860450fba1f740387dc082792ad89517">type</a>;</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;            bit_len = 8 * <span class="keyword">sizeof</span>(<a class="code" href="mxf_8c.html#a084824fc871e38157790c99ae1240842">data</a>);</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;            err = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;codec-&gt;write_extra_header(avctx, pic, <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>, &amp;<a class="code" href="writing__filters_8txt.html#a860450fba1f740387dc082792ad89517">type</a>,</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;                                                 <a class="code" href="mxf_8c.html#a084824fc871e38157790c99ae1240842">data</a>, &amp;bit_len);</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;            <span class="keywordflow">if</span> (err == <a class="code" href="group__lavu__error.html#gab4faa0afdf35076914824200331defff">AVERROR_EOF</a>)</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;            <span class="keywordflow">if</span> (err &lt; 0) {</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;                <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to write extra &quot;</span></div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;                       <span class="stringliteral">&quot;header %d: %d.\n&quot;</span>, <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>, err);</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;                <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;            }</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160; </div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;            err = <a class="code" href="libavcodec_2vaapi__encode_8c.html#a3176053f5249c1bed25ddfe8409c5a2c">vaapi_encode_make_packed_header</a>(avctx, pic, <a class="code" href="writing__filters_8txt.html#a860450fba1f740387dc082792ad89517">type</a>,</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;                                                  <a class="code" href="mxf_8c.html#a084824fc871e38157790c99ae1240842">data</a>, bit_len);</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;            <span class="keywordflow">if</span> (err &lt; 0)</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;                <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;        }</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    }</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160; </div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    <span class="keywordflow">if</span> (pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a72a967758798eb575425db365946dfd6">nb_slices</a> == 0)</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;        pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a72a967758798eb575425db365946dfd6">nb_slices</a> = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nb_slices;</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;    <span class="keywordflow">if</span> (pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a72a967758798eb575425db365946dfd6">nb_slices</a> &gt; 0) {</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;        pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#aad6dfdc9e90a4e8cda77793c499c6ef1">slices</a> = <a class="code" href="mem_8c.html#aedc3761897b7e9ea8ae1222b3d013c94">av_mallocz_array</a>(pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a72a967758798eb575425db365946dfd6">nb_slices</a>, <span class="keyword">sizeof</span>(*pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#aad6dfdc9e90a4e8cda77793c499c6ef1">slices</a>));</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;        <span class="keywordflow">if</span> (!pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#aad6dfdc9e90a4e8cda77793c499c6ef1">slices</a>) {</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;            err = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;            <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;        }</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160; </div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;tile_rows &amp;&amp; <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;tile_cols)</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;            <a class="code" href="libavcodec_2vaapi__encode_8c.html#ae708ecb37d37d4bb364397a6abfe00a6">vaapi_encode_make_tile_slice</a>(avctx, pic);</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;            <a class="code" href="libavcodec_2vaapi__encode_8c.html#a74618fe18d23fd63836b464c14303105">vaapi_encode_make_row_slice</a>(avctx, pic);</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    }</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160; </div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a72a967758798eb575425db365946dfd6">nb_slices</a>; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;        slice = &amp;pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#aad6dfdc9e90a4e8cda77793c499c6ef1">slices</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160; </div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;codec-&gt;slice_params_size &gt; 0) {</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;            slice-&gt;<a class="code" href="struct_v_a_a_p_i_encode_slice.html#a4ef0c52a1f5c8310dd26c65016c039ef">codec_slice_params</a> = <a class="code" href="group__lavu__mem__funcs.html#gaf143ecab33a3868b57345466c39de7c1">av_mallocz</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;codec-&gt;slice_params_size);</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;            <span class="keywordflow">if</span> (!slice-&gt;<a class="code" href="struct_v_a_a_p_i_encode_slice.html#a4ef0c52a1f5c8310dd26c65016c039ef">codec_slice_params</a>) {</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;                err = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;                <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;            }</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;        }</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160; </div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;codec-&gt;init_slice_params) {</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;            err = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;codec-&gt;init_slice_params(avctx, pic, slice);</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;            <span class="keywordflow">if</span> (err &lt; 0) {</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;                <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to initialise slice &quot;</span></div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;                       <span class="stringliteral">&quot;parameters: %d.\n&quot;</span>, err);</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;                <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;            }</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;        }</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160; </div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;va_packed_headers &amp; VA_ENC_PACKED_HEADER_SLICE &amp;&amp;</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;            <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;codec-&gt;write_slice_header) {</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;            bit_len = 8 * <span class="keyword">sizeof</span>(<a class="code" href="mxf_8c.html#a084824fc871e38157790c99ae1240842">data</a>);</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;            err = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;codec-&gt;write_slice_header(avctx, pic, slice,</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;                                                 <a class="code" href="mxf_8c.html#a084824fc871e38157790c99ae1240842">data</a>, &amp;bit_len);</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;            <span class="keywordflow">if</span> (err &lt; 0) {</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;                <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to write per-slice &quot;</span></div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;                       <span class="stringliteral">&quot;header: %d.\n&quot;</span>, err);</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;                <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;            }</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;            err = <a class="code" href="libavcodec_2vaapi__encode_8c.html#a3176053f5249c1bed25ddfe8409c5a2c">vaapi_encode_make_packed_header</a>(avctx, pic,</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;                                                  <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;codec-&gt;slice_header_type,</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;                                                  <a class="code" href="mxf_8c.html#a084824fc871e38157790c99ae1240842">data</a>, bit_len);</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;            <span class="keywordflow">if</span> (err &lt; 0)</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;                <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;        }</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160; </div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;codec-&gt;init_slice_params) {</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;            err = <a class="code" href="libavcodec_2vaapi__encode_8c.html#ac4748e44fc410421f3dbeb6b3889cb98">vaapi_encode_make_param_buffer</a>(avctx, pic,</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;                                                 VAEncSliceParameterBufferType,</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;                                                 slice-&gt;<a class="code" href="struct_v_a_a_p_i_encode_slice.html#a4ef0c52a1f5c8310dd26c65016c039ef">codec_slice_params</a>,</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;                                                 <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;codec-&gt;slice_params_size);</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;            <span class="keywordflow">if</span> (err &lt; 0)</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;                <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;        }</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    }</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160; </div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;<span class="preprocessor">#if VA_CHECK_VERSION(1, 0, 0)</span></div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;    sd = <a class="code" href="group__lavu__frame.html#gadec0efb470b1eead6a979333d9deca0c">av_frame_get_side_data</a>(pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#abdd10141f1025ea3a6903bafd450cbf7">input_image</a>,</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;                                <a class="code" href="group__lavu__frame.html#ggae01fa7e427274293aacdf2adc17076bcaf525ec92d2c5a78d44950bc3f29972aa">AV_FRAME_DATA_REGIONS_OF_INTEREST</a>);</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;    <span class="keywordflow">if</span> (sd &amp;&amp; <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;roi_allowed) {</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;        <span class="keyword">const</span> <a class="code" href="struct_a_v_region_of_interest.html">AVRegionOfInterest</a> *roi;</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;        uint32_t roi_size;</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;        VAEncMiscParameterBufferROI param_roi;</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;        <span class="keywordtype">int</span> nb_roi, <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>, v;</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160; </div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;        roi = (<span class="keyword">const</span> <a class="code" href="struct_a_v_region_of_interest.html">AVRegionOfInterest</a>*)sd-&gt;data;</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;        roi_size = roi-&gt;<a class="code" href="struct_a_v_region_of_interest.html#a5c75595b7003be167ed674bf565654db">self_size</a>;</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;        <a class="code" href="avassert_8h.html#aae204192396f78cc8c5cd7ad5c57c23f">av_assert0</a>(roi_size &amp;&amp; sd-&gt;size % roi_size == 0);</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;        nb_roi = sd-&gt;size / roi_size;</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;        <span class="keywordflow">if</span> (nb_roi &gt; <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;roi_max_regions) {</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;            <span class="keywordflow">if</span> (!<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;roi_warned) {</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;                <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga85b57516ca703cc47d9bbe5f4658c716">AV_LOG_WARNING</a>, <span class="stringliteral">&quot;More ROIs set than &quot;</span></div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;                       <span class="stringliteral">&quot;supported by driver (%d &gt; %d).\n&quot;</span>,</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;                       nb_roi, <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;roi_max_regions);</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;                <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;roi_warned = 1;</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;            }</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;            nb_roi = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;roi_max_regions;</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;        }</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160; </div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;        pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a9a8f3647d559171b4dde7983752f9231">roi</a> = <a class="code" href="mem_8c.html#aedc3761897b7e9ea8ae1222b3d013c94">av_mallocz_array</a>(nb_roi, <span class="keyword">sizeof</span>(*pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a9a8f3647d559171b4dde7983752f9231">roi</a>));</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;        <span class="keywordflow">if</span> (!pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a9a8f3647d559171b4dde7983752f9231">roi</a>) {</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;            err = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;            <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;        }</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;        <span class="comment">// For overlapping regions, the first in the array takes priority.</span></div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; nb_roi; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;            roi = (<span class="keyword">const</span> <a class="code" href="struct_a_v_region_of_interest.html">AVRegionOfInterest</a>*)(sd-&gt;data + roi_size * <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160; </div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;            <a class="code" href="avassert_8h.html#aae204192396f78cc8c5cd7ad5c57c23f">av_assert0</a>(roi-&gt;<a class="code" href="struct_a_v_region_of_interest.html#ae7421571aad4d48b63e91274ba424ee0">qoffset</a>.<a class="code" href="struct_a_v_rational.html#aee46bdac67d965ac0a4204e753f910c3">den</a> != 0);</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;            v = roi-&gt;<a class="code" href="struct_a_v_region_of_interest.html#ae7421571aad4d48b63e91274ba424ee0">qoffset</a>.<a class="code" href="struct_a_v_rational.html#ae9a98c10a301c5e937095105b6f0fdb9">num</a> * <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;roi_quant_range / roi-&gt;<a class="code" href="struct_a_v_region_of_interest.html#ae7421571aad4d48b63e91274ba424ee0">qoffset</a>.<a class="code" href="struct_a_v_rational.html#aee46bdac67d965ac0a4204e753f910c3">den</a>;</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga5b7221c3afd06848486776bd834a58a5">AV_LOG_DEBUG</a>, <span class="stringliteral">&quot;ROI: (%d,%d)-(%d,%d) -&gt; %+d.\n&quot;</span>,</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;                   roi-&gt;<a class="code" href="struct_a_v_region_of_interest.html#af07ce47d1c824676f790d95e23ff9caf">top</a>, roi-&gt;<a class="code" href="struct_a_v_region_of_interest.html#a66cec26997f55f6ac16822f5a6ea3100">left</a>, roi-&gt;<a class="code" href="struct_a_v_region_of_interest.html#a04201e2f63181c3007c4dfe0c7b8c815">bottom</a>, roi-&gt;<a class="code" href="struct_a_v_region_of_interest.html#a3a7e57502405cc44afd3ff3693ef3389">right</a>, v);</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160; </div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;            pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a9a8f3647d559171b4dde7983752f9231">roi</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>] = (VAEncROI) {</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;                .roi_rectangle = {</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;                    .x      = roi-&gt;<a class="code" href="struct_a_v_region_of_interest.html#a66cec26997f55f6ac16822f5a6ea3100">left</a>,</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;                    .y      = roi-&gt;<a class="code" href="struct_a_v_region_of_interest.html#af07ce47d1c824676f790d95e23ff9caf">top</a>,</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;                    .width  = roi-&gt;<a class="code" href="struct_a_v_region_of_interest.html#a3a7e57502405cc44afd3ff3693ef3389">right</a>  - roi-&gt;<a class="code" href="struct_a_v_region_of_interest.html#a66cec26997f55f6ac16822f5a6ea3100">left</a>,</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;                    .height = roi-&gt;<a class="code" href="struct_a_v_region_of_interest.html#a04201e2f63181c3007c4dfe0c7b8c815">bottom</a> - roi-&gt;<a class="code" href="struct_a_v_region_of_interest.html#af07ce47d1c824676f790d95e23ff9caf">top</a>,</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;                },</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;                .roi_value = av_clip_int8(v),</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;            };</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;        }</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160; </div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;        param_roi = (VAEncMiscParameterBufferROI) {</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;            .num_roi      = nb_roi,</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;            .max_delta_qp = INT8_MAX,</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;            .min_delta_qp = INT8_MIN,</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;            .roi          = pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a9a8f3647d559171b4dde7983752f9231">roi</a>,</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;            .roi_flags.bits.roi_value_is_qp_delta = 1,</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;        };</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160; </div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;        err = <a class="code" href="libavcodec_2vaapi__encode_8c.html#a8064f29ddd1422812424eb17c3f2e93c">vaapi_encode_make_misc_param_buffer</a>(avctx, pic,</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;                                                  VAEncMiscParameterTypeROI,</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;                                                  &amp;param_roi,</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;                                                  <span class="keyword">sizeof</span>(param_roi));</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;        <span class="keywordflow">if</span> (err &lt; 0)</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;            <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;    }</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160; </div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;    vas = vaBeginPicture(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;hwctx-&gt;display, <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;va_context,</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;                         pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#ab2e74518853179b0afc82386e65c014e">input_surface</a>);</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;    <span class="keywordflow">if</span> (vas != VA_STATUS_SUCCESS) {</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to begin picture encode issue: &quot;</span></div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;               <span class="stringliteral">&quot;%d (%s).\n&quot;</span>, vas, vaErrorStr(vas));</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;        err = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EIO);</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;        <span class="keywordflow">goto</span> fail_with_picture;</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;    }</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160; </div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;    vas = vaRenderPicture(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;hwctx-&gt;display, <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;va_context,</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;                          pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#ada59d0ef73e012e82205dadb78aea94d">param_buffers</a>, pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#abbc37306887fd1c4d4978d75ece71864">nb_param_buffers</a>);</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;    <span class="keywordflow">if</span> (vas != VA_STATUS_SUCCESS) {</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to upload encode parameters: &quot;</span></div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;               <span class="stringliteral">&quot;%d (%s).\n&quot;</span>, vas, vaErrorStr(vas));</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;        err = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EIO);</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;        <span class="keywordflow">goto</span> fail_with_picture;</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;    }</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160; </div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;    vas = vaEndPicture(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;hwctx-&gt;display, <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;va_context);</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;    <span class="keywordflow">if</span> (vas != VA_STATUS_SUCCESS) {</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to end picture encode issue: &quot;</span></div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;               <span class="stringliteral">&quot;%d (%s).\n&quot;</span>, vas, vaErrorStr(vas));</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;        err = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EIO);</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;        <span class="comment">// vaRenderPicture() has been called here, so we should not destroy</span></div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;        <span class="comment">// the parameter buffers unless separate destruction is required.</span></div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;        <span class="keywordflow">if</span> (CONFIG_VAAPI_1 || <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;hwctx-&gt;driver_quirks &amp;</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;            <a class="code" href="group__avoptions.html#gga06fc87d81c62e9abb8790b6e5713c55ba225e072f2eba3d53c29d0b5f197d49ed">AV_VAAPI_DRIVER_QUIRK_RENDER_PARAM_BUFFERS</a>)</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;            <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;            <span class="keywordflow">goto</span> fail_at_end;</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;    }</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160; </div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;    <span class="keywordflow">if</span> (CONFIG_VAAPI_1 || <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;hwctx-&gt;driver_quirks &amp;</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;        <a class="code" href="group__avoptions.html#gga06fc87d81c62e9abb8790b6e5713c55ba225e072f2eba3d53c29d0b5f197d49ed">AV_VAAPI_DRIVER_QUIRK_RENDER_PARAM_BUFFERS</a>) {</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#abbc37306887fd1c4d4978d75ece71864">nb_param_buffers</a>; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;            vas = vaDestroyBuffer(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;hwctx-&gt;display,</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;                                  pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#ada59d0ef73e012e82205dadb78aea94d">param_buffers</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;            <span class="keywordflow">if</span> (vas != VA_STATUS_SUCCESS) {</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;                <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to destroy &quot;</span></div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;                       <span class="stringliteral">&quot;param buffer %#x: %d (%s).\n&quot;</span>,</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;                       pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#ada59d0ef73e012e82205dadb78aea94d">param_buffers</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>], vas, vaErrorStr(vas));</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;                <span class="comment">// And ignore.</span></div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;            }</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;        }</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;    }</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160; </div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;    pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a459df71dd956fce38da5710b840084ec">encode_issued</a> = 1;</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160; </div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160; </div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;fail_with_picture:</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;    vaEndPicture(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;hwctx-&gt;display, <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;va_context);</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;<a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>:</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;    <span class="keywordflow">for</span>(<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#abbc37306887fd1c4d4978d75ece71864">nb_param_buffers</a>; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;        vaDestroyBuffer(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;hwctx-&gt;display, pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#ada59d0ef73e012e82205dadb78aea94d">param_buffers</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;    <span class="keywordflow">if</span> (pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#aad6dfdc9e90a4e8cda77793c499c6ef1">slices</a>) {</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a72a967758798eb575425db365946dfd6">nb_slices</a>; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#adba82e1bcd02de510a858fcbedf79ef1">av_freep</a>(&amp;pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#aad6dfdc9e90a4e8cda77793c499c6ef1">slices</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="struct_v_a_a_p_i_encode_slice.html#a4ef0c52a1f5c8310dd26c65016c039ef">codec_slice_params</a>);</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;    }</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;fail_at_end:</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#adba82e1bcd02de510a858fcbedf79ef1">av_freep</a>(&amp;pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a0b5603bae3f5d92488a246b62b7393e6">codec_picture_params</a>);</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#adba82e1bcd02de510a858fcbedf79ef1">av_freep</a>(&amp;pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#ada59d0ef73e012e82205dadb78aea94d">param_buffers</a>);</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#adba82e1bcd02de510a858fcbedf79ef1">av_freep</a>(&amp;pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#aad6dfdc9e90a4e8cda77793c499c6ef1">slices</a>);</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#adba82e1bcd02de510a858fcbedf79ef1">av_freep</a>(&amp;pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a9a8f3647d559171b4dde7983752f9231">roi</a>);</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;    <a class="code" href="group__lavu__frame.html#ga979d73f3228814aee56aeca0636e37cc">av_frame_free</a>(&amp;pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a03ac94018185f0c41753766088b3951b">recon_image</a>);</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;    <a class="code" href="group__lavu__buffer.html#ga135e9e929b5033bb8f68322497b2effc">av_buffer_unref</a>(&amp;pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a066d9e1a3e58cdae02bb2ccf21e7a57c">output_buffer_ref</a>);</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;    pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#ab10d79f488c154649c6b6c9ff223f8c6">output_buffer</a> = VA_INVALID_ID;</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;    <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;}</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160; </div>
<div class="line"><a name="l00625"></a><span class="lineno"><a class="line" href="libavcodec_2vaapi__encode_8c.html#aed53f0bcf39d848d68a62ed83da063c8">  625</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="libavcodec_2vaapi__encode_8c.html#aed53f0bcf39d848d68a62ed83da063c8">vaapi_encode_output</a>(<a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a> *avctx,</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;                               <a class="code" href="struct_v_a_a_p_i_encode_picture.html">VAAPIEncodePicture</a> *pic, <a class="code" href="struct_a_v_packet.html">AVPacket</a> *<a class="code" href="demuxing__decoding_8c.html#a3d4c6562f0b27cf0cacbbea5c038c090">pkt</a>)</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;{</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;    <a class="code" href="struct_v_a_a_p_i_encode_context.html">VAAPIEncodeContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a> = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#af3379123060ad8cc9c321c29af4f8360">priv_data</a>;</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;    VACodedBufferSegment *buf_list, *buf;</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;    VAStatus vas;</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;    <span class="keywordtype">int</span> total_size = 0;</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;    <a class="code" href="audio__convert_8c.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> *ptr;</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;    <span class="keywordtype">int</span> err;</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160; </div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;    err = <a class="code" href="libavcodec_2vaapi__encode_8c.html#a0c592d403bde93efd08918492f9a68d0">vaapi_encode_wait</a>(avctx, pic);</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;    <span class="keywordflow">if</span> (err &lt; 0)</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;        <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160; </div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;    buf_list = <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;    vas = vaMapBuffer(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;hwctx-&gt;display, pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#ab10d79f488c154649c6b6c9ff223f8c6">output_buffer</a>,</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;                      (<span class="keywordtype">void</span>**)&amp;buf_list);</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;    <span class="keywordflow">if</span> (vas != VA_STATUS_SUCCESS) {</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to map output buffers: &quot;</span></div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;               <span class="stringliteral">&quot;%d (%s).\n&quot;</span>, vas, vaErrorStr(vas));</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;        err = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EIO);</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;    }</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160; </div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;    <span class="keywordflow">for</span> (buf = buf_list; buf; buf = buf-&gt;next)</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;        total_size += buf-&gt;size;</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160; </div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;    err = <a class="code" href="group__lavc__packet.html#gadfa708660b85a56749c753124de2da7d">av_new_packet</a>(<a class="code" href="demuxing__decoding_8c.html#a3d4c6562f0b27cf0cacbbea5c038c090">pkt</a>, total_size);</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;    ptr = <a class="code" href="demuxing__decoding_8c.html#a3d4c6562f0b27cf0cacbbea5c038c090">pkt</a>-&gt;<a class="code" href="struct_a_v_packet.html#aaf4fe58dfcc7c232c1f2268b539d8367">data</a>;</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160; </div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;    <span class="keywordflow">if</span> (err &lt; 0)</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;        <span class="keywordflow">goto</span> fail_mapped;</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160; </div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;    <span class="keywordflow">for</span> (buf = buf_list; buf; buf = buf-&gt;next) {</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga5b7221c3afd06848486776bd834a58a5">AV_LOG_DEBUG</a>, <span class="stringliteral">&quot;Output buffer: %u bytes &quot;</span></div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;               <span class="stringliteral">&quot;(status %08x).\n&quot;</span>, buf-&gt;size, buf-&gt;status);</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160; </div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;        memcpy(ptr, buf-&gt;buf, buf-&gt;size);</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;        ptr += buf-&gt;size;</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;    }</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160; </div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;    <span class="keywordflow">if</span> (pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a455b050a491e1ce16c0b80781643be42">type</a> == <a class="code" href="vaapi__encode_8h.html#adf764cbdea00d65edcd07bb9953ad2b7ab56d9a8ef94cff8f64aff4c9f115503a">PICTURE_TYPE_IDR</a>)</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;        <a class="code" href="demuxing__decoding_8c.html#a3d4c6562f0b27cf0cacbbea5c038c090">pkt</a>-&gt;<a class="code" href="struct_a_v_packet.html#a437be96a9da675f12caa228a9c81bd82">flags</a> |= <a class="code" href="group__lavc__packet.html#ga75603d7c2b8adf5829f4fd2fb860168f">AV_PKT_FLAG_KEY</a>;</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160; </div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;    <a class="code" href="demuxing__decoding_8c.html#a3d4c6562f0b27cf0cacbbea5c038c090">pkt</a>-&gt;<a class="code" href="struct_a_v_packet.html#a73bde0a37f3b1efc839f11295bfbf42a">pts</a> = pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a0a28d9343217d043aae8a6bfedea7b04">pts</a>;</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160; </div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;    vas = vaUnmapBuffer(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;hwctx-&gt;display, pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#ab10d79f488c154649c6b6c9ff223f8c6">output_buffer</a>);</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;    <span class="keywordflow">if</span> (vas != VA_STATUS_SUCCESS) {</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to unmap output buffers: &quot;</span></div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;               <span class="stringliteral">&quot;%d (%s).\n&quot;</span>, vas, vaErrorStr(vas));</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;        err = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EIO);</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;    }</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160; </div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;    <a class="code" href="group__lavu__buffer.html#ga135e9e929b5033bb8f68322497b2effc">av_buffer_unref</a>(&amp;pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a066d9e1a3e58cdae02bb2ccf21e7a57c">output_buffer_ref</a>);</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;    pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#ab10d79f488c154649c6b6c9ff223f8c6">output_buffer</a> = VA_INVALID_ID;</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160; </div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga5b7221c3afd06848486776bd834a58a5">AV_LOG_DEBUG</a>, <span class="stringliteral">&quot;Output read for pic %&quot;</span>PRId64<span class="stringliteral">&quot;/%&quot;</span>PRId64<span class="stringliteral">&quot;.\n&quot;</span>,</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;           pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a4c211c3d8a02e456836bf7c7102151b2">display_order</a>, pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#aeebf0e912cc72cb3f0d394fe86019cda">encode_order</a>);</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160; </div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;fail_mapped:</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;    vaUnmapBuffer(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;hwctx-&gt;display, pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#ab10d79f488c154649c6b6c9ff223f8c6">output_buffer</a>);</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;<a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>:</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;    <a class="code" href="group__lavu__buffer.html#ga135e9e929b5033bb8f68322497b2effc">av_buffer_unref</a>(&amp;pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a066d9e1a3e58cdae02bb2ccf21e7a57c">output_buffer_ref</a>);</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;    pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#ab10d79f488c154649c6b6c9ff223f8c6">output_buffer</a> = VA_INVALID_ID;</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;    <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;}</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160; </div>
<div class="line"><a name="l00694"></a><span class="lineno"><a class="line" href="libavcodec_2vaapi__encode_8c.html#adf7f242bc5cabaadcf953e0d7feef8a1">  694</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="libavcodec_2vaapi__encode_8c.html#adf7f242bc5cabaadcf953e0d7feef8a1">vaapi_encode_discard</a>(<a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a> *avctx,</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;                                <a class="code" href="struct_v_a_a_p_i_encode_picture.html">VAAPIEncodePicture</a> *pic)</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;{</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;    <a class="code" href="libavcodec_2vaapi__encode_8c.html#a0c592d403bde93efd08918492f9a68d0">vaapi_encode_wait</a>(avctx, pic);</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160; </div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;    <span class="keywordflow">if</span> (pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a066d9e1a3e58cdae02bb2ccf21e7a57c">output_buffer_ref</a>) {</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga5b7221c3afd06848486776bd834a58a5">AV_LOG_DEBUG</a>, <span class="stringliteral">&quot;Discard output for pic &quot;</span></div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;               <span class="stringliteral">&quot;%&quot;</span>PRId64<span class="stringliteral">&quot;/%&quot;</span>PRId64<span class="stringliteral">&quot;.\n&quot;</span>,</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;               pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a4c211c3d8a02e456836bf7c7102151b2">display_order</a>, pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#aeebf0e912cc72cb3f0d394fe86019cda">encode_order</a>);</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160; </div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;        <a class="code" href="group__lavu__buffer.html#ga135e9e929b5033bb8f68322497b2effc">av_buffer_unref</a>(&amp;pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a066d9e1a3e58cdae02bb2ccf21e7a57c">output_buffer_ref</a>);</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;        pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#ab10d79f488c154649c6b6c9ff223f8c6">output_buffer</a> = VA_INVALID_ID;</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;    }</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160; </div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;}</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160; </div>
<div class="line"><a name="l00711"></a><span class="lineno"><a class="line" href="libavcodec_2vaapi__encode_8c.html#a95eb97478a252ece50e806fae0d6af9a">  711</a></span>&#160;<span class="keyword">static</span> <a class="code" href="struct_v_a_a_p_i_encode_picture.html">VAAPIEncodePicture</a> *<a class="code" href="libavcodec_2vaapi__encode_8c.html#a95eb97478a252ece50e806fae0d6af9a">vaapi_encode_alloc</a>(<a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a> *avctx)</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;{</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;    <a class="code" href="struct_v_a_a_p_i_encode_context.html">VAAPIEncodeContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a> = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#af3379123060ad8cc9c321c29af4f8360">priv_data</a>;</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;    <a class="code" href="struct_v_a_a_p_i_encode_picture.html">VAAPIEncodePicture</a> *pic;</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160; </div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;    pic = <a class="code" href="group__lavu__mem__funcs.html#gaf143ecab33a3868b57345466c39de7c1">av_mallocz</a>(<span class="keyword">sizeof</span>(*pic));</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;    <span class="keywordflow">if</span> (!pic)</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160; </div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;codec-&gt;picture_priv_data_size &gt; 0) {</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;        pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a5ebeafc2d09071a391659e2acf38dda3">priv_data</a> = <a class="code" href="group__lavu__mem__funcs.html#gaf143ecab33a3868b57345466c39de7c1">av_mallocz</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;codec-&gt;picture_priv_data_size);</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;        <span class="keywordflow">if</span> (!pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a5ebeafc2d09071a391659e2acf38dda3">priv_data</a>) {</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#adba82e1bcd02de510a858fcbedf79ef1">av_freep</a>(&amp;pic);</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;        }</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;    }</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160; </div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;    pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#ab2e74518853179b0afc82386e65c014e">input_surface</a> = VA_INVALID_ID;</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;    pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a7b20419c52cbcfb242f90a8b35edfc14">recon_surface</a> = VA_INVALID_ID;</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;    pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#ab10d79f488c154649c6b6c9ff223f8c6">output_buffer</a> = VA_INVALID_ID;</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160; </div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;    <span class="keywordflow">return</span> pic;</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;}</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160; </div>
<div class="line"><a name="l00735"></a><span class="lineno"><a class="line" href="libavcodec_2vaapi__encode_8c.html#a39fd61d4df4898b7ae3ae638065ef008">  735</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="libavcodec_2vaapi__encode_8c.html#a39fd61d4df4898b7ae3ae638065ef008">vaapi_encode_free</a>(<a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a> *avctx,</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;                             <a class="code" href="struct_v_a_a_p_i_encode_picture.html">VAAPIEncodePicture</a> *pic)</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;{</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160; </div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;    <span class="keywordflow">if</span> (pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a459df71dd956fce38da5710b840084ec">encode_issued</a>)</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;        <a class="code" href="libavcodec_2vaapi__encode_8c.html#adf7f242bc5cabaadcf953e0d7feef8a1">vaapi_encode_discard</a>(avctx, pic);</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160; </div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;    <span class="keywordflow">if</span> (pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#aad6dfdc9e90a4e8cda77793c499c6ef1">slices</a>) {</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a72a967758798eb575425db365946dfd6">nb_slices</a>; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#adba82e1bcd02de510a858fcbedf79ef1">av_freep</a>(&amp;pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#aad6dfdc9e90a4e8cda77793c499c6ef1">slices</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="struct_v_a_a_p_i_encode_slice.html#a4ef0c52a1f5c8310dd26c65016c039ef">codec_slice_params</a>);</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;    }</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#adba82e1bcd02de510a858fcbedf79ef1">av_freep</a>(&amp;pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a0b5603bae3f5d92488a246b62b7393e6">codec_picture_params</a>);</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160; </div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;    <a class="code" href="group__lavu__frame.html#ga979d73f3228814aee56aeca0636e37cc">av_frame_free</a>(&amp;pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#abdd10141f1025ea3a6903bafd450cbf7">input_image</a>);</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;    <a class="code" href="group__lavu__frame.html#ga979d73f3228814aee56aeca0636e37cc">av_frame_free</a>(&amp;pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a03ac94018185f0c41753766088b3951b">recon_image</a>);</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160; </div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#adba82e1bcd02de510a858fcbedf79ef1">av_freep</a>(&amp;pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#ada59d0ef73e012e82205dadb78aea94d">param_buffers</a>);</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#adba82e1bcd02de510a858fcbedf79ef1">av_freep</a>(&amp;pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#aad6dfdc9e90a4e8cda77793c499c6ef1">slices</a>);</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;    <span class="comment">// Output buffer should already be destroyed.</span></div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;    <a class="code" href="avassert_8h.html#aae204192396f78cc8c5cd7ad5c57c23f">av_assert0</a>(pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#ab10d79f488c154649c6b6c9ff223f8c6">output_buffer</a> == VA_INVALID_ID);</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160; </div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#adba82e1bcd02de510a858fcbedf79ef1">av_freep</a>(&amp;pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a5ebeafc2d09071a391659e2acf38dda3">priv_data</a>);</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#adba82e1bcd02de510a858fcbedf79ef1">av_freep</a>(&amp;pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a0b5603bae3f5d92488a246b62b7393e6">codec_picture_params</a>);</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#adba82e1bcd02de510a858fcbedf79ef1">av_freep</a>(&amp;pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a9a8f3647d559171b4dde7983752f9231">roi</a>);</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160; </div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#a079eab092887563f2bef9106c6120089">av_free</a>(pic);</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160; </div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;}</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160; </div>
<div class="line"><a name="l00766"></a><span class="lineno"><a class="line" href="libavcodec_2vaapi__encode_8c.html#a1a84f02361807d40eb1d95a5b951f478">  766</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="libavcodec_2vaapi__encode_8c.html#a1a84f02361807d40eb1d95a5b951f478">vaapi_encode_add_ref</a>(<a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a> *avctx,</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;                                 <a class="code" href="struct_v_a_a_p_i_encode_picture.html">VAAPIEncodePicture</a> *pic,</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;                                 <a class="code" href="struct_v_a_a_p_i_encode_picture.html">VAAPIEncodePicture</a> *target,</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;                                 <span class="keywordtype">int</span> is_ref, <span class="keywordtype">int</span> in_dpb, <span class="keywordtype">int</span> prev)</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;{</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;    <span class="keywordtype">int</span> refs = 0;</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160; </div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;    <span class="keywordflow">if</span> (is_ref) {</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;        <a class="code" href="avassert_8h.html#aae204192396f78cc8c5cd7ad5c57c23f">av_assert0</a>(pic != target);</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;        <a class="code" href="avassert_8h.html#aae204192396f78cc8c5cd7ad5c57c23f">av_assert0</a>(pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#af7067b239d6821ab286c9c268d1bb799">nb_refs</a> &lt; <a class="code" href="group__avoptions.html#gga06fc87d81c62e9abb8790b6e5713c55ba8adb148d2ac4dda4c65d4ef8d13eaf09">MAX_PICTURE_REFERENCES</a>);</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;        pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a0f6b20a3de817daa22251145f0967213">refs</a>[pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#af7067b239d6821ab286c9c268d1bb799">nb_refs</a>++] = target;</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;        ++refs;</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;    }</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160; </div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;    <span class="keywordflow">if</span> (in_dpb) {</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;        <a class="code" href="avassert_8h.html#aae204192396f78cc8c5cd7ad5c57c23f">av_assert0</a>(pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a00607efbf6665511840f09b80e257f50">nb_dpb_pics</a> &lt; <a class="code" href="group__avoptions.html#gga06fc87d81c62e9abb8790b6e5713c55baca65838438d536410bdc17544ec1531c">MAX_DPB_SIZE</a>);</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;        pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a83158ec0aff37a9b2337525a0d4b7b0c">dpb</a>[pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a00607efbf6665511840f09b80e257f50">nb_dpb_pics</a>++] = target;</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;        ++refs;</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;    }</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160; </div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;    <span class="keywordflow">if</span> (prev) {</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;        <a class="code" href="avassert_8h.html#aae204192396f78cc8c5cd7ad5c57c23f">av_assert0</a>(!pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a990d7ec9ddfeda0d522e0856eaf84efd">prev</a>);</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;        pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a990d7ec9ddfeda0d522e0856eaf84efd">prev</a> = target;</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;        ++refs;</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;    }</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160; </div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;    target-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a83b6ea88509d40eab77e313def6fb786">ref_count</a>[0] += refs;</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;    target-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a83b6ea88509d40eab77e313def6fb786">ref_count</a>[1] += refs;</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;}</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160; </div>
<div class="line"><a name="l00796"></a><span class="lineno"><a class="line" href="libavcodec_2vaapi__encode_8c.html#a6d05de653e5f9f59a791c6e4260f5e5e">  796</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="libavcodec_2vaapi__encode_8c.html#a6d05de653e5f9f59a791c6e4260f5e5e">vaapi_encode_remove_refs</a>(<a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a> *avctx,</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;                                     <a class="code" href="struct_v_a_a_p_i_encode_picture.html">VAAPIEncodePicture</a> *pic,</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;                                     <span class="keywordtype">int</span> <a class="code" href="svq3_8c.html#abbb6c7c49508c1ac374683f2d1159e08">level</a>)</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;{</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160; </div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;    <span class="keywordflow">if</span> (pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a512cbe2731947ce2270d5ca4c0977768">ref_removed</a>[<a class="code" href="svq3_8c.html#abbb6c7c49508c1ac374683f2d1159e08">level</a>])</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160; </div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#af7067b239d6821ab286c9c268d1bb799">nb_refs</a>; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;        <a class="code" href="avassert_8h.html#aae204192396f78cc8c5cd7ad5c57c23f">av_assert0</a>(pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a0f6b20a3de817daa22251145f0967213">refs</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;        --pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a0f6b20a3de817daa22251145f0967213">refs</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a83b6ea88509d40eab77e313def6fb786">ref_count</a>[<a class="code" href="svq3_8c.html#abbb6c7c49508c1ac374683f2d1159e08">level</a>];</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;        <a class="code" href="avassert_8h.html#aae204192396f78cc8c5cd7ad5c57c23f">av_assert0</a>(pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a0f6b20a3de817daa22251145f0967213">refs</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a83b6ea88509d40eab77e313def6fb786">ref_count</a>[<a class="code" href="svq3_8c.html#abbb6c7c49508c1ac374683f2d1159e08">level</a>] &gt;= 0);</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;    }</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160; </div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a00607efbf6665511840f09b80e257f50">nb_dpb_pics</a>; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;        <a class="code" href="avassert_8h.html#aae204192396f78cc8c5cd7ad5c57c23f">av_assert0</a>(pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a83158ec0aff37a9b2337525a0d4b7b0c">dpb</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;        --pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a83158ec0aff37a9b2337525a0d4b7b0c">dpb</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a83b6ea88509d40eab77e313def6fb786">ref_count</a>[<a class="code" href="svq3_8c.html#abbb6c7c49508c1ac374683f2d1159e08">level</a>];</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;        <a class="code" href="avassert_8h.html#aae204192396f78cc8c5cd7ad5c57c23f">av_assert0</a>(pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a83158ec0aff37a9b2337525a0d4b7b0c">dpb</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a83b6ea88509d40eab77e313def6fb786">ref_count</a>[<a class="code" href="svq3_8c.html#abbb6c7c49508c1ac374683f2d1159e08">level</a>] &gt;= 0);</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;    }</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160; </div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;    <a class="code" href="avassert_8h.html#aae204192396f78cc8c5cd7ad5c57c23f">av_assert0</a>(pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a990d7ec9ddfeda0d522e0856eaf84efd">prev</a> || pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a455b050a491e1ce16c0b80781643be42">type</a> == <a class="code" href="vaapi__encode_8h.html#adf764cbdea00d65edcd07bb9953ad2b7ab56d9a8ef94cff8f64aff4c9f115503a">PICTURE_TYPE_IDR</a>);</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;    <span class="keywordflow">if</span> (pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a990d7ec9ddfeda0d522e0856eaf84efd">prev</a>) {</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;        --pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a990d7ec9ddfeda0d522e0856eaf84efd">prev</a>-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a83b6ea88509d40eab77e313def6fb786">ref_count</a>[<a class="code" href="svq3_8c.html#abbb6c7c49508c1ac374683f2d1159e08">level</a>];</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;        <a class="code" href="avassert_8h.html#aae204192396f78cc8c5cd7ad5c57c23f">av_assert0</a>(pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a990d7ec9ddfeda0d522e0856eaf84efd">prev</a>-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a83b6ea88509d40eab77e313def6fb786">ref_count</a>[<a class="code" href="svq3_8c.html#abbb6c7c49508c1ac374683f2d1159e08">level</a>] &gt;= 0);</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;    }</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160; </div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;    pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a512cbe2731947ce2270d5ca4c0977768">ref_removed</a>[<a class="code" href="svq3_8c.html#abbb6c7c49508c1ac374683f2d1159e08">level</a>] = 1;</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;}</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160; </div>
<div class="line"><a name="l00826"></a><span class="lineno"><a class="line" href="libavcodec_2vaapi__encode_8c.html#a732dda14f455b15e7aaaa67b9b7361b5">  826</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="libavcodec_2vaapi__encode_8c.html#a732dda14f455b15e7aaaa67b9b7361b5">vaapi_encode_set_b_pictures</a>(<a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a> *avctx,</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;                                        <a class="code" href="struct_v_a_a_p_i_encode_picture.html">VAAPIEncodePicture</a> *start,</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;                                        <a class="code" href="struct_v_a_a_p_i_encode_picture.html">VAAPIEncodePicture</a> *<a class="code" href="avrndec_8c.html#a13191ba45577b1d4f9b37d64df91eb55">end</a>,</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;                                        <a class="code" href="struct_v_a_a_p_i_encode_picture.html">VAAPIEncodePicture</a> *prev,</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;                                        <span class="keywordtype">int</span> current_depth,</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;                                        <a class="code" href="struct_v_a_a_p_i_encode_picture.html">VAAPIEncodePicture</a> **last)</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;{</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;    <a class="code" href="struct_v_a_a_p_i_encode_context.html">VAAPIEncodeContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a> = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#af3379123060ad8cc9c321c29af4f8360">priv_data</a>;</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;    <a class="code" href="struct_v_a_a_p_i_encode_picture.html">VAAPIEncodePicture</a> *pic, *next, *<a class="code" href="tests_2jpeg2000dwt_8c.html#a5cabdd8be5af41f675fed06498e094b7">ref</a>;</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="code" href="vorbis__enc__data_8h.html#afed088663f8704004425cdae2120b9b3">len</a>;</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160; </div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;    <a class="code" href="avassert_8h.html#aae204192396f78cc8c5cd7ad5c57c23f">av_assert0</a>(start &amp;&amp; <a class="code" href="avrndec_8c.html#a13191ba45577b1d4f9b37d64df91eb55">end</a> &amp;&amp; start != <a class="code" href="avrndec_8c.html#a13191ba45577b1d4f9b37d64df91eb55">end</a> &amp;&amp; start-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#aaa8c71a04b83ac217a42bf41e0e1a0ff">next</a> != <a class="code" href="avrndec_8c.html#a13191ba45577b1d4f9b37d64df91eb55">end</a>);</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160; </div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;    <span class="comment">// If we are at the maximum depth then encode all pictures as</span></div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;    <span class="comment">// non-referenced B-pictures.  Also do this if there is exactly one</span></div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;    <span class="comment">// picture left, since there will be nothing to reference it.</span></div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;    <span class="keywordflow">if</span> (current_depth == <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;max_b_depth || start-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#aaa8c71a04b83ac217a42bf41e0e1a0ff">next</a>-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#aaa8c71a04b83ac217a42bf41e0e1a0ff">next</a> == <a class="code" href="avrndec_8c.html#a13191ba45577b1d4f9b37d64df91eb55">end</a>) {</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;        <span class="keywordflow">for</span> (pic = start-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#aaa8c71a04b83ac217a42bf41e0e1a0ff">next</a>; pic; pic = pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#aaa8c71a04b83ac217a42bf41e0e1a0ff">next</a>) {</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;            <span class="keywordflow">if</span> (pic == <a class="code" href="avrndec_8c.html#a13191ba45577b1d4f9b37d64df91eb55">end</a>)</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;            pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a455b050a491e1ce16c0b80781643be42">type</a>    = <a class="code" href="vaapi__encode_8h.html#adf764cbdea00d65edcd07bb9953ad2b7a4a3d20bd96935a81d334d85be050639b">PICTURE_TYPE_B</a>;</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;            pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a71966a0785a63842d1e1a0ce91b0578f">b_depth</a> = current_depth;</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160; </div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;            <a class="code" href="libavcodec_2vaapi__encode_8c.html#a1a84f02361807d40eb1d95a5b951f478">vaapi_encode_add_ref</a>(avctx, pic, start, 1, 1, 0);</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;            <a class="code" href="libavcodec_2vaapi__encode_8c.html#a1a84f02361807d40eb1d95a5b951f478">vaapi_encode_add_ref</a>(avctx, pic, <a class="code" href="avrndec_8c.html#a13191ba45577b1d4f9b37d64df91eb55">end</a>,   1, 1, 0);</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;            <a class="code" href="libavcodec_2vaapi__encode_8c.html#a1a84f02361807d40eb1d95a5b951f478">vaapi_encode_add_ref</a>(avctx, pic, prev,  0, 0, 1);</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160; </div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;            <span class="keywordflow">for</span> (<a class="code" href="tests_2jpeg2000dwt_8c.html#a5cabdd8be5af41f675fed06498e094b7">ref</a> = <a class="code" href="avrndec_8c.html#a13191ba45577b1d4f9b37d64df91eb55">end</a>-&gt;refs[1]; <a class="code" href="tests_2jpeg2000dwt_8c.html#a5cabdd8be5af41f675fed06498e094b7">ref</a>; <a class="code" href="tests_2jpeg2000dwt_8c.html#a5cabdd8be5af41f675fed06498e094b7">ref</a> = <a class="code" href="tests_2jpeg2000dwt_8c.html#a5cabdd8be5af41f675fed06498e094b7">ref</a>-&gt;refs[1])</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;                <a class="code" href="libavcodec_2vaapi__encode_8c.html#a1a84f02361807d40eb1d95a5b951f478">vaapi_encode_add_ref</a>(avctx, pic, <a class="code" href="tests_2jpeg2000dwt_8c.html#a5cabdd8be5af41f675fed06498e094b7">ref</a>, 0, 1, 0);</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;        }</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;        *last = prev;</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160; </div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;        <span class="comment">// Split the current list at the midpoint with a referenced</span></div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;        <span class="comment">// B-picture, then descend into each side separately.</span></div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;        <a class="code" href="vorbis__enc__data_8h.html#afed088663f8704004425cdae2120b9b3">len</a> = 0;</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;        <span class="keywordflow">for</span> (pic = start-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#aaa8c71a04b83ac217a42bf41e0e1a0ff">next</a>; pic != <a class="code" href="avrndec_8c.html#a13191ba45577b1d4f9b37d64df91eb55">end</a>; pic = pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#aaa8c71a04b83ac217a42bf41e0e1a0ff">next</a>)</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;            ++<a class="code" href="vorbis__enc__data_8h.html#afed088663f8704004425cdae2120b9b3">len</a>;</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;        <span class="keywordflow">for</span> (pic = start-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#aaa8c71a04b83ac217a42bf41e0e1a0ff">next</a>, <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 1; 2 * i &lt; len; pic = pic-&gt;next, <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++);</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160; </div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;        pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a455b050a491e1ce16c0b80781643be42">type</a>    = <a class="code" href="vaapi__encode_8h.html#adf764cbdea00d65edcd07bb9953ad2b7a4a3d20bd96935a81d334d85be050639b">PICTURE_TYPE_B</a>;</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;        pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a71966a0785a63842d1e1a0ce91b0578f">b_depth</a> = current_depth;</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160; </div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;        pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a766b1e3c4288cc9024524fee987c1fce">is_reference</a> = 1;</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160; </div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;        <a class="code" href="libavcodec_2vaapi__encode_8c.html#a1a84f02361807d40eb1d95a5b951f478">vaapi_encode_add_ref</a>(avctx, pic, pic,   0, 1, 0);</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;        <a class="code" href="libavcodec_2vaapi__encode_8c.html#a1a84f02361807d40eb1d95a5b951f478">vaapi_encode_add_ref</a>(avctx, pic, start, 1, 1, 0);</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;        <a class="code" href="libavcodec_2vaapi__encode_8c.html#a1a84f02361807d40eb1d95a5b951f478">vaapi_encode_add_ref</a>(avctx, pic, <a class="code" href="avrndec_8c.html#a13191ba45577b1d4f9b37d64df91eb55">end</a>,   1, 1, 0);</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;        <a class="code" href="libavcodec_2vaapi__encode_8c.html#a1a84f02361807d40eb1d95a5b951f478">vaapi_encode_add_ref</a>(avctx, pic, prev,  0, 0, 1);</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160; </div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="tests_2jpeg2000dwt_8c.html#a5cabdd8be5af41f675fed06498e094b7">ref</a> = <a class="code" href="avrndec_8c.html#a13191ba45577b1d4f9b37d64df91eb55">end</a>-&gt;refs[1]; <a class="code" href="tests_2jpeg2000dwt_8c.html#a5cabdd8be5af41f675fed06498e094b7">ref</a>; <a class="code" href="tests_2jpeg2000dwt_8c.html#a5cabdd8be5af41f675fed06498e094b7">ref</a> = <a class="code" href="tests_2jpeg2000dwt_8c.html#a5cabdd8be5af41f675fed06498e094b7">ref</a>-&gt;refs[1])</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;            <a class="code" href="libavcodec_2vaapi__encode_8c.html#a1a84f02361807d40eb1d95a5b951f478">vaapi_encode_add_ref</a>(avctx, pic, <a class="code" href="tests_2jpeg2000dwt_8c.html#a5cabdd8be5af41f675fed06498e094b7">ref</a>, 0, 1, 0);</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160; </div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &gt; 1)</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;            <a class="code" href="libavcodec_2vaapi__encode_8c.html#a732dda14f455b15e7aaaa67b9b7361b5">vaapi_encode_set_b_pictures</a>(avctx, start, pic, pic,</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;                                        current_depth + 1, &amp;next);</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;            next = pic;</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160; </div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;        <a class="code" href="libavcodec_2vaapi__encode_8c.html#a732dda14f455b15e7aaaa67b9b7361b5">vaapi_encode_set_b_pictures</a>(avctx, pic, <a class="code" href="avrndec_8c.html#a13191ba45577b1d4f9b37d64df91eb55">end</a>, next,</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;                                    current_depth + 1, last);</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;    }</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;}</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160; </div>
<div class="line"><a name="l00890"></a><span class="lineno"><a class="line" href="libavcodec_2vaapi__encode_8c.html#aa909347b2105a5320def7f2e99f6851b">  890</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="libavcodec_2vaapi__encode_8c.html#aa909347b2105a5320def7f2e99f6851b">vaapi_encode_pick_next</a>(<a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a> *avctx,</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;                                  <a class="code" href="struct_v_a_a_p_i_encode_picture.html">VAAPIEncodePicture</a> **pic_out)</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;{</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;    <a class="code" href="struct_v_a_a_p_i_encode_context.html">VAAPIEncodeContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a> = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#af3379123060ad8cc9c321c29af4f8360">priv_data</a>;</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;    <a class="code" href="struct_v_a_a_p_i_encode_picture.html">VAAPIEncodePicture</a> *pic = <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, *next, *start;</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>, b_counter, closed_gop_end;</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160; </div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;    <span class="comment">// If there are any B-frames already queued, the next one to encode</span></div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;    <span class="comment">// is the earliest not-yet-issued frame for which all references are</span></div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;    <span class="comment">// available.</span></div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;    <span class="keywordflow">for</span> (pic = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;pic_start; pic; pic = pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#aaa8c71a04b83ac217a42bf41e0e1a0ff">next</a>) {</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;        <span class="keywordflow">if</span> (pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a459df71dd956fce38da5710b840084ec">encode_issued</a>)</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;        <span class="keywordflow">if</span> (pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a455b050a491e1ce16c0b80781643be42">type</a> != <a class="code" href="vaapi__encode_8h.html#adf764cbdea00d65edcd07bb9953ad2b7a4a3d20bd96935a81d334d85be050639b">PICTURE_TYPE_B</a>)</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#af7067b239d6821ab286c9c268d1bb799">nb_refs</a>; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;            <span class="keywordflow">if</span> (!pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a0f6b20a3de817daa22251145f0967213">refs</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a459df71dd956fce38da5710b840084ec">encode_issued</a>)</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;        }</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> == pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#af7067b239d6821ab286c9c268d1bb799">nb_refs</a>)</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;    }</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160; </div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;    <span class="keywordflow">if</span> (pic) {</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga5b7221c3afd06848486776bd834a58a5">AV_LOG_DEBUG</a>, <span class="stringliteral">&quot;Pick B-picture at depth %d to &quot;</span></div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;               <span class="stringliteral">&quot;encode next.\n&quot;</span>, pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a71966a0785a63842d1e1a0ce91b0578f">b_depth</a>);</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;        *pic_out = pic;</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;    }</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160; </div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;    <span class="comment">// Find the B-per-Pth available picture to become the next picture</span></div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;    <span class="comment">// on the top layer.</span></div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;    start = <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;    b_counter = 0;</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;    closed_gop_end = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;closed_gop ||</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;                     <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;idr_counter == <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;gop_per_idr;</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;    <span class="keywordflow">for</span> (pic = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;pic_start; pic; pic = next) {</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;        next = pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#aaa8c71a04b83ac217a42bf41e0e1a0ff">next</a>;</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;        <span class="keywordflow">if</span> (pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a459df71dd956fce38da5710b840084ec">encode_issued</a>) {</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;            start = pic;</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;        }</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;        <span class="comment">// If the next available picture is force-IDR, encode it to start</span></div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;        <span class="comment">// a new GOP immediately.</span></div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;        <span class="keywordflow">if</span> (pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#ad45123e35df627c1103ad8e762bc5b0a">force_idr</a>)</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;        <span class="keywordflow">if</span> (b_counter == <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;b_per_p)</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;        <span class="comment">// If this picture ends a closed GOP or starts a new GOP then it</span></div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;        <span class="comment">// needs to be in the top layer.</span></div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;gop_counter + b_counter + closed_gop_end &gt;= <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;gop_size)</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;        <span class="comment">// If the picture after this one is force-IDR, we need to encode</span></div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;        <span class="comment">// this one in the top layer.</span></div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;        <span class="keywordflow">if</span> (next &amp;&amp; next-&gt;force_idr)</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;        ++b_counter;</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;    }</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160; </div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;    <span class="comment">// At the end of the stream the last picture must be in the top layer.</span></div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;    <span class="keywordflow">if</span> (!pic &amp;&amp; <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;end_of_stream) {</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;        --b_counter;</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;        pic = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;pic_end;</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;        <span class="keywordflow">if</span> (pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a459df71dd956fce38da5710b840084ec">encode_issued</a>)</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="group__lavu__error.html#gab4faa0afdf35076914824200331defff">AVERROR_EOF</a>;</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;    }</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160; </div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;    <span class="keywordflow">if</span> (!pic) {</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga5b7221c3afd06848486776bd834a58a5">AV_LOG_DEBUG</a>, <span class="stringliteral">&quot;Pick nothing to encode next - &quot;</span></div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;               <span class="stringliteral">&quot;need more input for reference pictures.\n&quot;</span>);</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EAGAIN);</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;    }</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;input_order &lt;= <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;decode_delay &amp;&amp; !<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;end_of_stream) {</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga5b7221c3afd06848486776bd834a58a5">AV_LOG_DEBUG</a>, <span class="stringliteral">&quot;Pick nothing to encode next - &quot;</span></div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;               <span class="stringliteral">&quot;need more input for timestamps.\n&quot;</span>);</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EAGAIN);</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;    }</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160; </div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;    <span class="keywordflow">if</span> (pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#ad45123e35df627c1103ad8e762bc5b0a">force_idr</a>) {</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga5b7221c3afd06848486776bd834a58a5">AV_LOG_DEBUG</a>, <span class="stringliteral">&quot;Pick forced IDR-picture to &quot;</span></div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;               <span class="stringliteral">&quot;encode next.\n&quot;</span>);</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;        pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a455b050a491e1ce16c0b80781643be42">type</a> = <a class="code" href="vaapi__encode_8h.html#adf764cbdea00d65edcd07bb9953ad2b7ab56d9a8ef94cff8f64aff4c9f115503a">PICTURE_TYPE_IDR</a>;</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;idr_counter = 1;</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;gop_counter = 1;</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160; </div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;gop_counter + b_counter &gt;= <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;gop_size) {</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;idr_counter == <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;gop_per_idr) {</div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga5b7221c3afd06848486776bd834a58a5">AV_LOG_DEBUG</a>, <span class="stringliteral">&quot;Pick new-GOP IDR-picture to &quot;</span></div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;                   <span class="stringliteral">&quot;encode next.\n&quot;</span>);</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;            pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a455b050a491e1ce16c0b80781643be42">type</a> = <a class="code" href="vaapi__encode_8h.html#adf764cbdea00d65edcd07bb9953ad2b7ab56d9a8ef94cff8f64aff4c9f115503a">PICTURE_TYPE_IDR</a>;</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;            <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;idr_counter = 1;</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga5b7221c3afd06848486776bd834a58a5">AV_LOG_DEBUG</a>, <span class="stringliteral">&quot;Pick new-GOP I-picture to &quot;</span></div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;                   <span class="stringliteral">&quot;encode next.\n&quot;</span>);</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;            pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a455b050a491e1ce16c0b80781643be42">type</a> = <a class="code" href="vaapi__encode_8h.html#adf764cbdea00d65edcd07bb9953ad2b7acc8409d697602a190af45b91bb061624">PICTURE_TYPE_I</a>;</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;            ++<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;idr_counter;</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;        }</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;gop_counter = 1;</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160; </div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;gop_counter + b_counter + closed_gop_end == <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;gop_size) {</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga5b7221c3afd06848486776bd834a58a5">AV_LOG_DEBUG</a>, <span class="stringliteral">&quot;Pick group-end P-picture to &quot;</span></div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;                   <span class="stringliteral">&quot;encode next.\n&quot;</span>);</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga5b7221c3afd06848486776bd834a58a5">AV_LOG_DEBUG</a>, <span class="stringliteral">&quot;Pick normal P-picture to &quot;</span></div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;                   <span class="stringliteral">&quot;encode next.\n&quot;</span>);</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;        }</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;        pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a455b050a491e1ce16c0b80781643be42">type</a> = <a class="code" href="vaapi__encode_8h.html#adf764cbdea00d65edcd07bb9953ad2b7a653f32daa38a2adc6d8abebcfdf44173">PICTURE_TYPE_P</a>;</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;        <a class="code" href="avassert_8h.html#aae204192396f78cc8c5cd7ad5c57c23f">av_assert0</a>(start);</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;gop_counter += 1 + b_counter;</div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;    }</div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;    pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a766b1e3c4288cc9024524fee987c1fce">is_reference</a> = 1;</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;    *pic_out = pic;</div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160; </div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;    <a class="code" href="libavcodec_2vaapi__encode_8c.html#a1a84f02361807d40eb1d95a5b951f478">vaapi_encode_add_ref</a>(avctx, pic, pic, 0, 1, 0);</div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;    <span class="keywordflow">if</span> (pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a455b050a491e1ce16c0b80781643be42">type</a> != <a class="code" href="vaapi__encode_8h.html#adf764cbdea00d65edcd07bb9953ad2b7ab56d9a8ef94cff8f64aff4c9f115503a">PICTURE_TYPE_IDR</a>) {</div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;        <a class="code" href="libavcodec_2vaapi__encode_8c.html#a1a84f02361807d40eb1d95a5b951f478">vaapi_encode_add_ref</a>(avctx, pic, start,</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;                             pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a455b050a491e1ce16c0b80781643be42">type</a> == <a class="code" href="vaapi__encode_8h.html#adf764cbdea00d65edcd07bb9953ad2b7a653f32daa38a2adc6d8abebcfdf44173">PICTURE_TYPE_P</a>,</div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;                             b_counter &gt; 0, 0);</div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;        <a class="code" href="libavcodec_2vaapi__encode_8c.html#a1a84f02361807d40eb1d95a5b951f478">vaapi_encode_add_ref</a>(avctx, pic, <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;next_prev, 0, 0, 1);</div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;    }</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;next_prev)</div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;        --<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;next_prev-&gt;ref_count[0];</div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160; </div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;    <span class="keywordflow">if</span> (b_counter &gt; 0) {</div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;        <a class="code" href="libavcodec_2vaapi__encode_8c.html#a732dda14f455b15e7aaaa67b9b7361b5">vaapi_encode_set_b_pictures</a>(avctx, start, pic, pic, 1,</div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;                                    &amp;<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;next_prev);</div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;next_prev = pic;</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;    }</div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;    ++<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;next_prev-&gt;ref_count[0];</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;}</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160; </div>
<div class="line"><a name="l01024"></a><span class="lineno"><a class="line" href="libavcodec_2vaapi__encode_8c.html#aad896a0f76ac9d6f2865b7e779f00feb"> 1024</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="libavcodec_2vaapi__encode_8c.html#aad896a0f76ac9d6f2865b7e779f00feb">vaapi_encode_clear_old</a>(<a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a> *avctx)</div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;{</div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;    <a class="code" href="struct_v_a_a_p_i_encode_context.html">VAAPIEncodeContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a> = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#af3379123060ad8cc9c321c29af4f8360">priv_data</a>;</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;    <a class="code" href="struct_v_a_a_p_i_encode_picture.html">VAAPIEncodePicture</a> *pic, *prev, *next;</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160; </div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;    <a class="code" href="avassert_8h.html#aae204192396f78cc8c5cd7ad5c57c23f">av_assert0</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;pic_start);</div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160; </div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;    <span class="comment">// Remove direct references once each picture is complete.</span></div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;    <span class="keywordflow">for</span> (pic = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;pic_start; pic; pic = pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#aaa8c71a04b83ac217a42bf41e0e1a0ff">next</a>) {</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;        <span class="keywordflow">if</span> (pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a9201c92d265a5e6b5f0c3195e0b9f251">encode_complete</a> &amp;&amp; pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#aaa8c71a04b83ac217a42bf41e0e1a0ff">next</a>)</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;            <a class="code" href="libavcodec_2vaapi__encode_8c.html#a6d05de653e5f9f59a791c6e4260f5e5e">vaapi_encode_remove_refs</a>(avctx, pic, 0);</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;    }</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160; </div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;    <span class="comment">// Remove indirect references once a picture has no direct references.</span></div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;    <span class="keywordflow">for</span> (pic = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;pic_start; pic; pic = pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#aaa8c71a04b83ac217a42bf41e0e1a0ff">next</a>) {</div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;        <span class="keywordflow">if</span> (pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a9201c92d265a5e6b5f0c3195e0b9f251">encode_complete</a> &amp;&amp; pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a83b6ea88509d40eab77e313def6fb786">ref_count</a>[0] == 0)</div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;            <a class="code" href="libavcodec_2vaapi__encode_8c.html#a6d05de653e5f9f59a791c6e4260f5e5e">vaapi_encode_remove_refs</a>(avctx, pic, 1);</div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;    }</div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160; </div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;    <span class="comment">// Clear out all complete pictures with no remaining references.</span></div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;    prev = <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;    <span class="keywordflow">for</span> (pic = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;pic_start; pic; pic = next) {</div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;        next = pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#aaa8c71a04b83ac217a42bf41e0e1a0ff">next</a>;</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;        <span class="keywordflow">if</span> (pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a9201c92d265a5e6b5f0c3195e0b9f251">encode_complete</a> &amp;&amp; pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a83b6ea88509d40eab77e313def6fb786">ref_count</a>[1] == 0) {</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;            <a class="code" href="avassert_8h.html#aae204192396f78cc8c5cd7ad5c57c23f">av_assert0</a>(pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a512cbe2731947ce2270d5ca4c0977768">ref_removed</a>[0] &amp;&amp; pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a512cbe2731947ce2270d5ca4c0977768">ref_removed</a>[1]);</div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;            <span class="keywordflow">if</span> (prev)</div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;                prev-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#aaa8c71a04b83ac217a42bf41e0e1a0ff">next</a> = next;</div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;                <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;pic_start = next;</div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;            <a class="code" href="libavcodec_2vaapi__encode_8c.html#a39fd61d4df4898b7ae3ae638065ef008">vaapi_encode_free</a>(avctx, pic);</div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;            prev = pic;</div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;        }</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;    }</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160; </div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;}</div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160; </div>
<div class="line"><a name="l01062"></a><span class="lineno"><a class="line" href="libavcodec_2vaapi__encode_8c.html#ac5d061eefc94230d7f0145743db6e543"> 1062</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="libavcodec_2vaapi__encode_8c.html#ac5d061eefc94230d7f0145743db6e543">vaapi_encode_check_frame</a>(<a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a> *avctx,</div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;                                    <span class="keyword">const</span> <a class="code" href="struct_a_v_frame.html">AVFrame</a> *<a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>)</div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;{</div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;    <a class="code" href="struct_v_a_a_p_i_encode_context.html">VAAPIEncodeContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a> = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#af3379123060ad8cc9c321c29af4f8360">priv_data</a>;</div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160; </div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;    <span class="keywordflow">if</span> ((<a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>-&gt;crop_top  || <a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>-&gt;crop_bottom ||</div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;         <a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>-&gt;crop_left || <a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>-&gt;crop_right) &amp;&amp; !<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;crop_warned) {</div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga85b57516ca703cc47d9bbe5f4658c716">AV_LOG_WARNING</a>, <span class="stringliteral">&quot;Cropping information on input &quot;</span></div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;               <span class="stringliteral">&quot;frames ignored due to lack of API support.\n&quot;</span>);</div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;crop_warned = 1;</div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;    }</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160; </div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;roi_allowed) {</div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;        <a class="code" href="struct_a_v_frame_side_data.html">AVFrameSideData</a> *sd =</div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;            <a class="code" href="group__lavu__frame.html#gadec0efb470b1eead6a979333d9deca0c">av_frame_get_side_data</a>(<a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>, <a class="code" href="group__lavu__frame.html#ggae01fa7e427274293aacdf2adc17076bcaf525ec92d2c5a78d44950bc3f29972aa">AV_FRAME_DATA_REGIONS_OF_INTEREST</a>);</div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160; </div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;        <span class="keywordflow">if</span> (sd &amp;&amp; !<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;roi_warned) {</div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga85b57516ca703cc47d9bbe5f4658c716">AV_LOG_WARNING</a>, <span class="stringliteral">&quot;ROI side data on input &quot;</span></div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;                   <span class="stringliteral">&quot;frames ignored due to lack of driver support.\n&quot;</span>);</div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;            <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;roi_warned = 1;</div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;        }</div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;    }</div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160; </div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;}</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160; </div>
<div class="line"><a name="l01088"></a><span class="lineno"><a class="line" href="libavcodec_2vaapi__encode_8c.html#a3936e7d89f3866a231a28aeadc0c3984"> 1088</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="libavcodec_2vaapi__encode_8c.html#a3936e7d89f3866a231a28aeadc0c3984">vaapi_encode_send_frame</a>(<a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a> *avctx, <a class="code" href="struct_a_v_frame.html">AVFrame</a> *<a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>)</div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;{</div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;    <a class="code" href="struct_v_a_a_p_i_encode_context.html">VAAPIEncodeContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a> = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#af3379123060ad8cc9c321c29af4f8360">priv_data</a>;</div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;    <a class="code" href="struct_v_a_a_p_i_encode_picture.html">VAAPIEncodePicture</a> *pic;</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;    <span class="keywordtype">int</span> err;</div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160; </div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>) {</div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga5b7221c3afd06848486776bd834a58a5">AV_LOG_DEBUG</a>, <span class="stringliteral">&quot;Input frame: %ux%u (%&quot;</span>PRId64<span class="stringliteral">&quot;).\n&quot;</span>,</div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;               <a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>-&gt;width, <a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>-&gt;height, <a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>-&gt;pts);</div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160; </div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;        err = <a class="code" href="libavcodec_2vaapi__encode_8c.html#ac5d061eefc94230d7f0145743db6e543">vaapi_encode_check_frame</a>(avctx, <a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>);</div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;        <span class="keywordflow">if</span> (err &lt; 0)</div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;            <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160; </div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;        pic = <a class="code" href="libavcodec_2vaapi__encode_8c.html#a95eb97478a252ece50e806fae0d6af9a">vaapi_encode_alloc</a>(avctx);</div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;        <span class="keywordflow">if</span> (!pic)</div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160; </div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;        pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#abdd10141f1025ea3a6903bafd450cbf7">input_image</a> = <a class="code" href="group__lavu__frame.html#gac700017c5270c79c1e1befdeeb008b2f">av_frame_alloc</a>();</div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;        <span class="keywordflow">if</span> (!pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#abdd10141f1025ea3a6903bafd450cbf7">input_image</a>) {</div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;            err = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;            <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;        }</div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160; </div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;input_order == 0 || <a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>-&gt;pict_type == <a class="code" href="group__lavu__picture.html#ggae6cbcab1f70d8e476757f1c1f5a0a78ea02be39f151a8ace7a65c86e13053e817">AV_PICTURE_TYPE_I</a>)</div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;            pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#ad45123e35df627c1103ad8e762bc5b0a">force_idr</a> = 1;</div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160; </div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;        pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#ab2e74518853179b0afc82386e65c014e">input_surface</a> = (VASurfaceID)(uintptr_t)<a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>-&gt;data[3];</div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;        pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a0a28d9343217d043aae8a6bfedea7b04">pts</a> = <a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>-&gt;pts;</div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160; </div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;        <a class="code" href="group__lavu__frame.html#ga709e62bc2917ffd84c5c0f4e1dfc48f7">av_frame_move_ref</a>(pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#abdd10141f1025ea3a6903bafd450cbf7">input_image</a>, <a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>);</div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160; </div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;input_order == 0)</div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;            <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;first_pts = pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a0a28d9343217d043aae8a6bfedea7b04">pts</a>;</div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;input_order == <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;decode_delay)</div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;            <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;dts_pts_diff = pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a0a28d9343217d043aae8a6bfedea7b04">pts</a> - <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;first_pts;</div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;output_delay &gt; 0)</div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;            <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;ts_ring[<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;input_order % (3 * <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;output_delay)] = pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a0a28d9343217d043aae8a6bfedea7b04">pts</a>;</div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160; </div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;        pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#a4c211c3d8a02e456836bf7c7102151b2">display_order</a> = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;input_order;</div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;        ++<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;input_order;</div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160; </div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;        <a class="code" href="filter__design_8txt.html#a0e82f1088fdc24c14bf175d2ac77523f">if</a> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;pic_start) {</div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;            <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;pic_end-&gt;next = pic;</div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;            <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;pic_end       = pic;</div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;            <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;pic_start     = pic;</div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;            <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;pic_end       = pic;</div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;        }</div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160; </div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;end_of_stream = 1;</div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160; </div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;        <span class="comment">// Fix timestamps if we hit end-of-stream before the initial decode</span></div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;        <span class="comment">// delay has elapsed.</span></div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;input_order &lt; <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;decode_delay)</div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;            <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;dts_pts_diff = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;pic_end-&gt;pts - <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;first_pts;</div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;    }</div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160; </div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160; </div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;<a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>:</div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;    <a class="code" href="libavcodec_2vaapi__encode_8c.html#a39fd61d4df4898b7ae3ae638065ef008">vaapi_encode_free</a>(avctx, pic);</div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;    <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;}</div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160; </div>
<div class="line"><a name="l01154"></a><span class="lineno"><a class="line" href="vaapi__encode_8h.html#aa28619b3d9fec15b23657f531b1dd6ee"> 1154</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="libavcodec_2vaapi__encode_8c.html#aa28619b3d9fec15b23657f531b1dd6ee">ff_vaapi_encode_receive_packet</a>(<a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a> *avctx, <a class="code" href="struct_a_v_packet.html">AVPacket</a> *<a class="code" href="demuxing__decoding_8c.html#a3d4c6562f0b27cf0cacbbea5c038c090">pkt</a>)</div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;{</div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;    <a class="code" href="struct_v_a_a_p_i_encode_context.html">VAAPIEncodeContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a> = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#af3379123060ad8cc9c321c29af4f8360">priv_data</a>;</div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;    <a class="code" href="struct_v_a_a_p_i_encode_picture.html">VAAPIEncodePicture</a> *pic;</div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;    <a class="code" href="struct_a_v_frame.html">AVFrame</a> *<a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a> = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;frame;</div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;    <span class="keywordtype">int</span> err;</div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160; </div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;    err = <a class="code" href="encode_8c.html#a24f7e9c2daa5cc6033a220bf53870c62">ff_encode_get_frame</a>(avctx, <a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>);</div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;    <span class="keywordflow">if</span> (err &lt; 0 &amp;&amp; err != <a class="code" href="group__lavu__error.html#gab4faa0afdf35076914824200331defff">AVERROR_EOF</a>)</div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;        <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160; </div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;    <span class="keywordflow">if</span> (err == <a class="code" href="group__lavu__error.html#gab4faa0afdf35076914824200331defff">AVERROR_EOF</a>)</div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;        <a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a> = <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160; </div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;    err = <a class="code" href="libavcodec_2vaapi__encode_8c.html#a3936e7d89f3866a231a28aeadc0c3984">vaapi_encode_send_frame</a>(avctx, <a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>);</div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;    <span class="keywordflow">if</span> (err &lt; 0)</div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;        <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160; </div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;pic_start) {</div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;end_of_stream)</div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="group__lavu__error.html#gab4faa0afdf35076914824200331defff">AVERROR_EOF</a>;</div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EAGAIN);</div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;    }</div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160; </div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;    pic = <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;    err = <a class="code" href="libavcodec_2vaapi__encode_8c.html#aa909347b2105a5320def7f2e99f6851b">vaapi_encode_pick_next</a>(avctx, &amp;pic);</div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;    <span class="keywordflow">if</span> (err &lt; 0)</div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;        <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;    <a class="code" href="avassert_8h.html#aae204192396f78cc8c5cd7ad5c57c23f">av_assert0</a>(pic);</div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160; </div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;    pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#aeebf0e912cc72cb3f0d394fe86019cda">encode_order</a> = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;encode_order++;</div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160; </div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;    err = <a class="code" href="libavcodec_2vaapi__encode_8c.html#aace97d9deb0efcb149ce16fd6df0e08f">vaapi_encode_issue</a>(avctx, pic);</div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;    <span class="keywordflow">if</span> (err &lt; 0) {</div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Encode failed: %d.\n&quot;</span>, err);</div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;        <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;    }</div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160; </div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;    err = <a class="code" href="libavcodec_2vaapi__encode_8c.html#aed53f0bcf39d848d68a62ed83da063c8">vaapi_encode_output</a>(avctx, pic, <a class="code" href="demuxing__decoding_8c.html#a3d4c6562f0b27cf0cacbbea5c038c090">pkt</a>);</div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;    <span class="keywordflow">if</span> (err &lt; 0) {</div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Output failed: %d.\n&quot;</span>, err);</div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;        <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;    }</div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160; </div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;output_delay == 0) {</div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;        <a class="code" href="demuxing__decoding_8c.html#a3d4c6562f0b27cf0cacbbea5c038c090">pkt</a>-&gt;<a class="code" href="struct_a_v_packet.html#a85dbbd306b44b02390cd91c45e6a0f76">dts</a> = <a class="code" href="demuxing__decoding_8c.html#a3d4c6562f0b27cf0cacbbea5c038c090">pkt</a>-&gt;<a class="code" href="struct_a_v_packet.html#a73bde0a37f3b1efc839f11295bfbf42a">pts</a>;</div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#aeebf0e912cc72cb3f0d394fe86019cda">encode_order</a> &lt; <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;decode_delay) {</div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;ts_ring[pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#aeebf0e912cc72cb3f0d394fe86019cda">encode_order</a>] &lt; INT64_MIN + <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;dts_pts_diff)</div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;            <a class="code" href="demuxing__decoding_8c.html#a3d4c6562f0b27cf0cacbbea5c038c090">pkt</a>-&gt;<a class="code" href="struct_a_v_packet.html#a85dbbd306b44b02390cd91c45e6a0f76">dts</a> = INT64_MIN;</div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;            <a class="code" href="demuxing__decoding_8c.html#a3d4c6562f0b27cf0cacbbea5c038c090">pkt</a>-&gt;<a class="code" href="struct_a_v_packet.html#a85dbbd306b44b02390cd91c45e6a0f76">dts</a> = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;ts_ring[pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#aeebf0e912cc72cb3f0d394fe86019cda">encode_order</a>] - <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;dts_pts_diff;</div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;        <a class="code" href="demuxing__decoding_8c.html#a3d4c6562f0b27cf0cacbbea5c038c090">pkt</a>-&gt;<a class="code" href="struct_a_v_packet.html#a85dbbd306b44b02390cd91c45e6a0f76">dts</a> = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;ts_ring[(pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#aeebf0e912cc72cb3f0d394fe86019cda">encode_order</a> - <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;decode_delay) %</div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;                                (3 * <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;output_delay)];</div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;    }</div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga5b7221c3afd06848486776bd834a58a5">AV_LOG_DEBUG</a>, <span class="stringliteral">&quot;Output packet: pts %&quot;</span>PRId64<span class="stringliteral">&quot; dts %&quot;</span>PRId64<span class="stringliteral">&quot;.\n&quot;</span>,</div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;           <a class="code" href="demuxing__decoding_8c.html#a3d4c6562f0b27cf0cacbbea5c038c090">pkt</a>-&gt;<a class="code" href="struct_a_v_packet.html#a73bde0a37f3b1efc839f11295bfbf42a">pts</a>, <a class="code" href="demuxing__decoding_8c.html#a3d4c6562f0b27cf0cacbbea5c038c090">pkt</a>-&gt;<a class="code" href="struct_a_v_packet.html#a85dbbd306b44b02390cd91c45e6a0f76">dts</a>);</div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160; </div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;output_order = pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#aeebf0e912cc72cb3f0d394fe86019cda">encode_order</a>;</div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;    <a class="code" href="libavcodec_2vaapi__encode_8c.html#aad896a0f76ac9d6f2865b7e779f00feb">vaapi_encode_clear_old</a>(avctx);</div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160; </div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;}</div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160; </div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160; </div>
<div class="line"><a name="l01220"></a><span class="lineno"><a class="line" href="libavcodec_2vaapi__encode_8c.html#a5c62d3b58fc2a9ef2511250f2745452a"> 1220</a></span>&#160;<span class="keyword">static</span> <a class="code" href="attributes_8h.html#abeeb324fff79a5335d36774704e2475c">av_cold</a> <span class="keywordtype">void</span> <a class="code" href="libavcodec_2vaapi__encode_8c.html#a5c62d3b58fc2a9ef2511250f2745452a">vaapi_encode_add_global_param</a>(<a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a> *avctx, <span class="keywordtype">int</span> <a class="code" href="writing__filters_8txt.html#a860450fba1f740387dc082792ad89517">type</a>,</div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;                                                  <span class="keywordtype">void</span> *<a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a>, <span class="keywordtype">size_t</span> <a class="code" href="group__lavu__mem__funcs.html#ga34e10fdac079a9ca4512b8ccd7f20b8a">size</a>)</div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;{</div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;    <a class="code" href="struct_v_a_a_p_i_encode_context.html">VAAPIEncodeContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a> = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#af3379123060ad8cc9c321c29af4f8360">priv_data</a>;</div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160; </div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;    <a class="code" href="avassert_8h.html#aae204192396f78cc8c5cd7ad5c57c23f">av_assert0</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nb_global_params &lt; <a class="code" href="group__avoptions.html#gga06fc87d81c62e9abb8790b6e5713c55babfcf96f0d71b49b261c0948d031c127a">MAX_GLOBAL_PARAMS</a>);</div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160; </div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;global_params_type[<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nb_global_params] = <a class="code" href="writing__filters_8txt.html#a860450fba1f740387dc082792ad89517">type</a>;</div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;global_params     [<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nb_global_params] = <a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a>;</div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;global_params_size[<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nb_global_params] = <a class="code" href="group__lavu__mem__funcs.html#ga34e10fdac079a9ca4512b8ccd7f20b8a">size</a>;</div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160; </div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;    ++<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nb_global_params;</div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;}</div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160; </div>
<div class="line"><a name="l01234"></a><span class="lineno"><a class="line" href="struct_v_a_a_p_i_encode_r_t_format.html"> 1234</a></span>&#160;<span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="struct_v_a_a_p_i_encode_r_t_format.html">VAAPIEncodeRTFormat</a> {</div>
<div class="line"><a name="l01235"></a><span class="lineno"><a class="line" href="struct_v_a_a_p_i_encode_r_t_format.html#a11e1aa11797c944271be7eb2b5b3feb6"> 1235</a></span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="struct_v_a_a_p_i_encode_r_t_format.html#a11e1aa11797c944271be7eb2b5b3feb6">name</a>;</div>
<div class="line"><a name="l01236"></a><span class="lineno"><a class="line" href="struct_v_a_a_p_i_encode_r_t_format.html#a0a0803cb294781c45ebacc09ef6b9f6d"> 1236</a></span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="struct_v_a_a_p_i_encode_r_t_format.html#a0a0803cb294781c45ebacc09ef6b9f6d">value</a>;</div>
<div class="line"><a name="l01237"></a><span class="lineno"><a class="line" href="struct_v_a_a_p_i_encode_r_t_format.html#abf368514fa39395bd01fc6af4f225f86"> 1237</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="struct_v_a_a_p_i_encode_r_t_format.html#abf368514fa39395bd01fc6af4f225f86">depth</a>;</div>
<div class="line"><a name="l01238"></a><span class="lineno"><a class="line" href="struct_v_a_a_p_i_encode_r_t_format.html#a06a9aff1ee4f4cd2233b52b0f2dcb44f"> 1238</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="struct_v_a_a_p_i_encode_r_t_format.html#a06a9aff1ee4f4cd2233b52b0f2dcb44f">nb_components</a>;</div>
<div class="line"><a name="l01239"></a><span class="lineno"><a class="line" href="struct_v_a_a_p_i_encode_r_t_format.html#ac2a230d8bccbdcc1b84374c19c2d8104"> 1239</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="struct_v_a_a_p_i_encode_r_t_format.html#ac2a230d8bccbdcc1b84374c19c2d8104">log2_chroma_w</a>;</div>
<div class="line"><a name="l01240"></a><span class="lineno"><a class="line" href="struct_v_a_a_p_i_encode_r_t_format.html#a8f43c72041a58d7dbd6a2f20564f0647"> 1240</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="struct_v_a_a_p_i_encode_r_t_format.html#a8f43c72041a58d7dbd6a2f20564f0647">log2_chroma_h</a>;</div>
<div class="line"><a name="l01241"></a><span class="lineno"><a class="line" href="libavcodec_2vaapi__encode_8c.html#a27258a18f00f0b61a80d3b64e7aaae94"> 1241</a></span>&#160;} <a class="code" href="libavcodec_2vaapi__encode_8c.html#a27258a18f00f0b61a80d3b64e7aaae94">VAAPIEncodeRTFormat</a>;</div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160; </div>
<div class="line"><a name="l01243"></a><span class="lineno"><a class="line" href="libavcodec_2vaapi__encode_8c.html#ab77fff81bcff76be46e2b5dff426ea6a"> 1243</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="struct_v_a_a_p_i_encode_r_t_format.html">VAAPIEncodeRTFormat</a> <a class="code" href="libavcodec_2vaapi__encode_8c.html#ab77fff81bcff76be46e2b5dff426ea6a">vaapi_encode_rt_formats</a>[] = {</div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;    { <span class="stringliteral">&quot;YUV400&quot;</span>,    VA_RT_FORMAT_YUV400,        8, 1,      },</div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;    { <span class="stringliteral">&quot;YUV420&quot;</span>,    VA_RT_FORMAT_YUV420,        8, 3, 1, 1 },</div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;    { <span class="stringliteral">&quot;YUV422&quot;</span>,    VA_RT_FORMAT_YUV422,        8, 3, 1, 0 },</div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;<span class="preprocessor">#if VA_CHECK_VERSION(1, 2, 0)</span></div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;    { <span class="stringliteral">&quot;YUV422_10&quot;</span>, VA_RT_FORMAT_YUV422_10,    10, 3, 1, 0 },</div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;    { <span class="stringliteral">&quot;YUV444&quot;</span>,    VA_RT_FORMAT_YUV444,        8, 3, 0, 0 },</div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;    { <span class="stringliteral">&quot;YUV411&quot;</span>,    VA_RT_FORMAT_YUV411,        8, 3, 2, 0 },</div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;<span class="preprocessor">#if VA_CHECK_VERSION(0, 38, 1)</span></div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;    { <span class="stringliteral">&quot;YUV420_10&quot;</span>, VA_RT_FORMAT_YUV420_10BPP, 10, 3, 1, 1 },</div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;};</div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160; </div>
<div class="line"><a name="l01257"></a><span class="lineno"><a class="line" href="libavcodec_2vaapi__encode_8c.html#acf8754cdb63cca6783425c5bcaaf57b5"> 1257</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> VAEntrypoint <a class="code" href="libavcodec_2vaapi__encode_8c.html#acf8754cdb63cca6783425c5bcaaf57b5">vaapi_encode_entrypoints_normal</a>[] = {</div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;    VAEntrypointEncSlice,</div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;    VAEntrypointEncPicture,</div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;<span class="preprocessor">#if VA_CHECK_VERSION(0, 39, 2)</span></div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;    VAEntrypointEncSliceLP,</div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;    0</div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;};</div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;<span class="preprocessor">#if VA_CHECK_VERSION(0, 39, 2)</span></div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> VAEntrypoint vaapi_encode_entrypoints_low_power[] = {</div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;    VAEntrypointEncSliceLP,</div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;    0</div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;};</div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160; </div>
<div class="line"><a name="l01272"></a><span class="lineno"><a class="line" href="libavcodec_2vaapi__encode_8c.html#a56b623f757fbe8f192a9cef3d30b4e0a"> 1272</a></span>&#160;<span class="keyword">static</span> <a class="code" href="attributes_8h.html#abeeb324fff79a5335d36774704e2475c">av_cold</a> <span class="keywordtype">int</span> <a class="code" href="libavcodec_2vaapi__encode_8c.html#a56b623f757fbe8f192a9cef3d30b4e0a">vaapi_encode_profile_entrypoint</a>(<a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a> *avctx)</div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;{</div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;    <a class="code" href="struct_v_a_a_p_i_encode_context.html">VAAPIEncodeContext</a>      *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a> = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#af3379123060ad8cc9c321c29af4f8360">priv_data</a>;</div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;    VAProfile    *va_profiles    = <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;    VAEntrypoint *va_entrypoints = <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;    VAStatus vas;</div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;    <span class="keyword">const</span> VAEntrypoint *usable_entrypoints;</div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;    <span class="keyword">const</span> <a class="code" href="struct_v_a_a_p_i_encode_profile.html">VAAPIEncodeProfile</a> *<a class="code" href="qsvenc_8c.html#aacd2c6f4a09d71ea05bdcc1c2e9d42dd">profile</a>;</div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;    <span class="keyword">const</span> <a class="code" href="struct_a_v_pix_fmt_descriptor.html">AVPixFmtDescriptor</a> *<a class="code" href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a>;</div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;    VAConfigAttrib rt_format_attr;</div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;    <span class="keyword">const</span> <a class="code" href="struct_v_a_a_p_i_encode_r_t_format.html">VAAPIEncodeRTFormat</a> *rt_format;</div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *profile_string, *entrypoint_string;</div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>, j, n, depth, err;</div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160; </div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160; </div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;low_power) {</div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;<span class="preprocessor">#if VA_CHECK_VERSION(0, 39, 2)</span></div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;        usable_entrypoints = vaapi_encode_entrypoints_low_power;</div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Low-power encoding is not &quot;</span></div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;               <span class="stringliteral">&quot;supported with this VAAPI version.\n&quot;</span>);</div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EINVAL);</div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;        usable_entrypoints = <a class="code" href="libavcodec_2vaapi__encode_8c.html#acf8754cdb63cca6783425c5bcaaf57b5">vaapi_encode_entrypoints_normal</a>;</div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;    }</div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160; </div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;    <a class="code" href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a> = <a class="code" href="pixdesc_8c.html#afe0c3e8aef5173de28bbdaea4298f5f0">av_pix_fmt_desc_get</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;input_frames-&gt;sw_format);</div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a>) {</div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Invalid input pixfmt (%d).\n&quot;</span>,</div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;               <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;input_frames-&gt;sw_format);</div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EINVAL);</div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;    }</div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;    depth = <a class="code" href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a>-&gt;comp[0].depth;</div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 1; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a>-&gt;nb_components; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a>-&gt;comp[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].depth != depth) {</div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Invalid input pixfmt (%s).\n&quot;</span>,</div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;                   <a class="code" href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a>-&gt;name);</div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EINVAL);</div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;        }</div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;    }</div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga9b58b28e2d429b930b69db19877f76a8">AV_LOG_VERBOSE</a>, <span class="stringliteral">&quot;Input surface format is %s.\n&quot;</span>,</div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;           <a class="code" href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a>-&gt;name);</div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160; </div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;    n = vaMaxNumProfiles(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;hwctx-&gt;display);</div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;    va_profiles = <a class="code" href="mem_8c.html#a254f3455439c15a2c8a75b8f0235fdbd">av_malloc_array</a>(n, <span class="keyword">sizeof</span>(VAProfile));</div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;    <span class="keywordflow">if</span> (!va_profiles) {</div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;        err = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;    }</div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;    vas = vaQueryConfigProfiles(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;hwctx-&gt;display, va_profiles, &amp;n);</div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;    <span class="keywordflow">if</span> (vas != VA_STATUS_SUCCESS) {</div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to query profiles: %d (%s).\n&quot;</span>,</div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;               vas, vaErrorStr(vas));</div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;        err = <a class="code" href="group__lavu__error.html#ga9c520e483ba8648495620ffdb4c491f2">AVERROR_EXTERNAL</a>;</div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;    }</div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160; </div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;    <a class="code" href="avassert_8h.html#aae204192396f78cc8c5cd7ad5c57c23f">av_assert0</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;codec-&gt;profiles);</div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;codec-&gt;profiles[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].av_profile !=</div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;                 <a class="code" href="avcodec_8h.html#a1d8d03f5be975b8a728574cbdb00c896">FF_PROFILE_UNKNOWN</a>); <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;        <a class="code" href="qsvenc_8c.html#aacd2c6f4a09d71ea05bdcc1c2e9d42dd">profile</a> = &amp;<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;codec-&gt;profiles[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;        <span class="keywordflow">if</span> (depth               != <a class="code" href="qsvenc_8c.html#aacd2c6f4a09d71ea05bdcc1c2e9d42dd">profile</a>-&gt;depth ||</div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;            <a class="code" href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a>-&gt;nb_components != <a class="code" href="qsvenc_8c.html#aacd2c6f4a09d71ea05bdcc1c2e9d42dd">profile</a>-&gt;nb_components)</div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a>-&gt;nb_components &gt; 1 &amp;&amp;</div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;            (<a class="code" href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a>-&gt;log2_chroma_w != <a class="code" href="qsvenc_8c.html#aacd2c6f4a09d71ea05bdcc1c2e9d42dd">profile</a>-&gt;log2_chroma_w ||</div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;             <a class="code" href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a>-&gt;log2_chroma_h != <a class="code" href="qsvenc_8c.html#aacd2c6f4a09d71ea05bdcc1c2e9d42dd">profile</a>-&gt;log2_chroma_h))</div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;        <span class="keywordflow">if</span> (avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a7abe7095de73df98df4895bf9e25fc6b">profile</a> != <a class="code" href="qsvenc_8c.html#aacd2c6f4a09d71ea05bdcc1c2e9d42dd">profile</a>-&gt;av_profile &amp;&amp;</div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;            avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a7abe7095de73df98df4895bf9e25fc6b">profile</a> != <a class="code" href="avcodec_8h.html#a1d8d03f5be975b8a728574cbdb00c896">FF_PROFILE_UNKNOWN</a>)</div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160; </div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;<span class="preprocessor">#if VA_CHECK_VERSION(1, 0, 0)</span></div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;        profile_string = vaProfileStr(<a class="code" href="qsvenc_8c.html#aacd2c6f4a09d71ea05bdcc1c2e9d42dd">profile</a>-&gt;va_profile);</div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;        profile_string = <span class="stringliteral">&quot;(no profile names)&quot;</span>;</div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160; </div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;        <span class="keywordflow">for</span> (j = 0; j &lt; n; j++) {</div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;            <span class="keywordflow">if</span> (va_profiles[j] == <a class="code" href="qsvenc_8c.html#aacd2c6f4a09d71ea05bdcc1c2e9d42dd">profile</a>-&gt;va_profile)</div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;        }</div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;        <span class="keywordflow">if</span> (j &gt;= n) {</div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga9b58b28e2d429b930b69db19877f76a8">AV_LOG_VERBOSE</a>, <span class="stringliteral">&quot;Compatible profile %s (%d) &quot;</span></div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;                   <span class="stringliteral">&quot;is not supported by driver.\n&quot;</span>, profile_string,</div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;                   <a class="code" href="qsvenc_8c.html#aacd2c6f4a09d71ea05bdcc1c2e9d42dd">profile</a>-&gt;va_profile);</div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;        }</div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160; </div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;profile = <a class="code" href="qsvenc_8c.html#aacd2c6f4a09d71ea05bdcc1c2e9d42dd">profile</a>;</div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;    }</div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;profile) {</div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;No usable encoding profile found.\n&quot;</span>);</div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;        err = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOSYS);</div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;    }</div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160; </div>
<div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;    avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a7abe7095de73df98df4895bf9e25fc6b">profile</a>  = <a class="code" href="qsvenc_8c.html#aacd2c6f4a09d71ea05bdcc1c2e9d42dd">profile</a>-&gt;av_profile;</div>
<div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;va_profile = <a class="code" href="qsvenc_8c.html#aacd2c6f4a09d71ea05bdcc1c2e9d42dd">profile</a>-&gt;va_profile;</div>
<div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga9b58b28e2d429b930b69db19877f76a8">AV_LOG_VERBOSE</a>, <span class="stringliteral">&quot;Using VAAPI profile %s (%d).\n&quot;</span>,</div>
<div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;           profile_string, <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;va_profile);</div>
<div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160; </div>
<div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;    n = vaMaxNumEntrypoints(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;hwctx-&gt;display);</div>
<div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;    va_entrypoints = <a class="code" href="mem_8c.html#a254f3455439c15a2c8a75b8f0235fdbd">av_malloc_array</a>(n, <span class="keyword">sizeof</span>(VAEntrypoint));</div>
<div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;    <span class="keywordflow">if</span> (!va_entrypoints) {</div>
<div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;        err = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;    }</div>
<div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;    vas = vaQueryConfigEntrypoints(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;hwctx-&gt;display, <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;va_profile,</div>
<div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;                                   va_entrypoints, &amp;n);</div>
<div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;    <span class="keywordflow">if</span> (vas != VA_STATUS_SUCCESS) {</div>
<div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to query entrypoints for &quot;</span></div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;               <span class="stringliteral">&quot;profile %s (%d): %d (%s).\n&quot;</span>, profile_string,</div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;               <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;va_profile, vas, vaErrorStr(vas));</div>
<div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;        err = <a class="code" href="group__lavu__error.html#ga9c520e483ba8648495620ffdb4c491f2">AVERROR_EXTERNAL</a>;</div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;    }</div>
<div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160; </div>
<div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; n; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;        <span class="keywordflow">for</span> (j = 0; usable_entrypoints[j]; j++) {</div>
<div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;            <span class="keywordflow">if</span> (va_entrypoints[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>] == usable_entrypoints[j])</div>
<div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;        }</div>
<div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;        <span class="keywordflow">if</span> (usable_entrypoints[j])</div>
<div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;    }</div>
<div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &gt;= n) {</div>
<div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;No usable encoding entrypoint found &quot;</span></div>
<div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;               <span class="stringliteral">&quot;for profile %s (%d).\n&quot;</span>, profile_string, <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;va_profile);</div>
<div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;        err = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOSYS);</div>
<div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;    }</div>
<div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160; </div>
<div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;va_entrypoint = va_entrypoints[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;<span class="preprocessor">#if VA_CHECK_VERSION(1, 0, 0)</span></div>
<div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;    entrypoint_string = vaEntrypointStr(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;va_entrypoint);</div>
<div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;    entrypoint_string = <span class="stringliteral">&quot;(no entrypoint names)&quot;</span>;</div>
<div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga9b58b28e2d429b930b69db19877f76a8">AV_LOG_VERBOSE</a>, <span class="stringliteral">&quot;Using VAAPI entrypoint %s (%d).\n&quot;</span>,</div>
<div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;           entrypoint_string, <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;va_entrypoint);</div>
<div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160; </div>
<div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="sinewin__tablegen__template_8c.html#a3508a98d3ee7e2c9a4841fe264cf70f7">FF_ARRAY_ELEMS</a>(<a class="code" href="libavcodec_2vaapi__encode_8c.html#ab77fff81bcff76be46e2b5dff426ea6a">vaapi_encode_rt_formats</a>); <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;        rt_format = &amp;<a class="code" href="libavcodec_2vaapi__encode_8c.html#ab77fff81bcff76be46e2b5dff426ea6a">vaapi_encode_rt_formats</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;        <span class="keywordflow">if</span> (rt_format-&gt;<a class="code" href="struct_v_a_a_p_i_encode_r_t_format.html#abf368514fa39395bd01fc6af4f225f86">depth</a>         == depth &amp;&amp;</div>
<div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;            rt_format-&gt;<a class="code" href="struct_v_a_a_p_i_encode_r_t_format.html#a06a9aff1ee4f4cd2233b52b0f2dcb44f">nb_components</a> == <a class="code" href="qsvenc_8c.html#aacd2c6f4a09d71ea05bdcc1c2e9d42dd">profile</a>-&gt;nb_components &amp;&amp;</div>
<div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;            rt_format-&gt;<a class="code" href="struct_v_a_a_p_i_encode_r_t_format.html#ac2a230d8bccbdcc1b84374c19c2d8104">log2_chroma_w</a> == <a class="code" href="qsvenc_8c.html#aacd2c6f4a09d71ea05bdcc1c2e9d42dd">profile</a>-&gt;log2_chroma_w &amp;&amp;</div>
<div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;            rt_format-&gt;<a class="code" href="struct_v_a_a_p_i_encode_r_t_format.html#a8f43c72041a58d7dbd6a2f20564f0647">log2_chroma_h</a> == <a class="code" href="qsvenc_8c.html#aacd2c6f4a09d71ea05bdcc1c2e9d42dd">profile</a>-&gt;log2_chroma_h)</div>
<div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;    }</div>
<div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &gt;= <a class="code" href="sinewin__tablegen__template_8c.html#a3508a98d3ee7e2c9a4841fe264cf70f7">FF_ARRAY_ELEMS</a>(<a class="code" href="libavcodec_2vaapi__encode_8c.html#ab77fff81bcff76be46e2b5dff426ea6a">vaapi_encode_rt_formats</a>)) {</div>
<div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;No usable render target format &quot;</span></div>
<div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;               <span class="stringliteral">&quot;found for profile %s (%d) entrypoint %s (%d).\n&quot;</span>,</div>
<div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;               profile_string, <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;va_profile,</div>
<div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;               entrypoint_string, <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;va_entrypoint);</div>
<div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;        err = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOSYS);</div>
<div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;    }</div>
<div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160; </div>
<div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;    rt_format_attr = (VAConfigAttrib) { VAConfigAttribRTFormat };</div>
<div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;    vas = vaGetConfigAttributes(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;hwctx-&gt;display,</div>
<div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;                                <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;va_profile, <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;va_entrypoint,</div>
<div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;                                &amp;rt_format_attr, 1);</div>
<div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;    <span class="keywordflow">if</span> (vas != VA_STATUS_SUCCESS) {</div>
<div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to query RT format &quot;</span></div>
<div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;               <span class="stringliteral">&quot;config attribute: %d (%s).\n&quot;</span>, vas, vaErrorStr(vas));</div>
<div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;        err = <a class="code" href="group__lavu__error.html#ga9c520e483ba8648495620ffdb4c491f2">AVERROR_EXTERNAL</a>;</div>
<div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;    }</div>
<div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160; </div>
<div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;    <span class="keywordflow">if</span> (rt_format_attr.value == VA_ATTRIB_NOT_SUPPORTED) {</div>
<div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga9b58b28e2d429b930b69db19877f76a8">AV_LOG_VERBOSE</a>, <span class="stringliteral">&quot;RT format config attribute not &quot;</span></div>
<div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;               <span class="stringliteral">&quot;supported by driver: assuming surface RT format %s &quot;</span></div>
<div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;               <span class="stringliteral">&quot;is valid.\n&quot;</span>, rt_format-&gt;<a class="code" href="struct_v_a_a_p_i_encode_r_t_format.html#a11e1aa11797c944271be7eb2b5b3feb6">name</a>);</div>
<div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!(rt_format_attr.value &amp; rt_format-&gt;<a class="code" href="struct_v_a_a_p_i_encode_r_t_format.html#a0a0803cb294781c45ebacc09ef6b9f6d">value</a>)) {</div>
<div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Surface RT format %s not supported &quot;</span></div>
<div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;               <span class="stringliteral">&quot;by driver for encoding profile %s (%d) entrypoint %s (%d).\n&quot;</span>,</div>
<div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;               rt_format-&gt;<a class="code" href="struct_v_a_a_p_i_encode_r_t_format.html#a11e1aa11797c944271be7eb2b5b3feb6">name</a>, profile_string, <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;va_profile,</div>
<div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;               entrypoint_string, <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;va_entrypoint);</div>
<div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;        err = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOSYS);</div>
<div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga9b58b28e2d429b930b69db19877f76a8">AV_LOG_VERBOSE</a>, <span class="stringliteral">&quot;Using VAAPI render target &quot;</span></div>
<div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;               <span class="stringliteral">&quot;format %s (%#x).\n&quot;</span>, rt_format-&gt;<a class="code" href="struct_v_a_a_p_i_encode_r_t_format.html#a11e1aa11797c944271be7eb2b5b3feb6">name</a>, rt_format-&gt;<a class="code" href="struct_v_a_a_p_i_encode_r_t_format.html#a0a0803cb294781c45ebacc09ef6b9f6d">value</a>);</div>
<div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;config_attributes[<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nb_config_attributes++] =</div>
<div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;            (VAConfigAttrib) {</div>
<div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;            .type  = VAConfigAttribRTFormat,</div>
<div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;            .value = rt_format-&gt;<a class="code" href="struct_v_a_a_p_i_encode_r_t_format.html#a0a0803cb294781c45ebacc09ef6b9f6d">value</a>,</div>
<div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;        };</div>
<div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;    }</div>
<div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160; </div>
<div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;    err = 0;</div>
<div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;<a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>:</div>
<div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#adba82e1bcd02de510a858fcbedf79ef1">av_freep</a>(&amp;va_profiles);</div>
<div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#adba82e1bcd02de510a858fcbedf79ef1">av_freep</a>(&amp;va_entrypoints);</div>
<div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;    <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;}</div>
<div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160; </div>
<div class="line"><a name="l01472"></a><span class="lineno"><a class="line" href="libavcodec_2vaapi__encode_8c.html#ad722c5a88a31067be89908e7cc836066"> 1472</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="struct_v_a_a_p_i_encode_r_c_mode.html">VAAPIEncodeRCMode</a> <a class="code" href="libavcodec_2vaapi__encode_8c.html#ad722c5a88a31067be89908e7cc836066">vaapi_encode_rc_modes</a>[] = {</div>
<div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;    <span class="comment">//                                  Bitrate   Quality</span></div>
<div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;    <span class="comment">//                                     | Maxrate | HRD/VBV</span></div>
<div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;    { 0 }, <span class="comment">//                              |    |    |    |</span></div>
<div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;    { <a class="code" href="vaapi__encode_8h.html#a99fb83031ce9923c84392b4e92f956b5a5d5bf4fa66599951866951d97ce8897d">RC_MODE_CQP</a>,  <span class="stringliteral">&quot;CQP&quot;</span>,  1, VA_RC_CQP,  0,   0,   1,   0 },</div>
<div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;    { <a class="code" href="vaapi__encode_8h.html#a99fb83031ce9923c84392b4e92f956b5ab433d7f001038a3ce0eb623789bef910">RC_MODE_CBR</a>,  <span class="stringliteral">&quot;CBR&quot;</span>,  1, VA_RC_CBR,  1,   0,   0,   1 },</div>
<div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;    { <a class="code" href="vaapi__encode_8h.html#a99fb83031ce9923c84392b4e92f956b5ad729ee7c5714d6063cc2bc4e91dd0b0d">RC_MODE_VBR</a>,  <span class="stringliteral">&quot;VBR&quot;</span>,  1, VA_RC_VBR,  1,   1,   0,   1 },</div>
<div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;<span class="preprocessor">#if VA_CHECK_VERSION(1, 1, 0)</span></div>
<div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;    { <a class="code" href="vaapi__encode_8h.html#a99fb83031ce9923c84392b4e92f956b5a0211927b756afaa318c53c3c9e94a253">RC_MODE_ICQ</a>,  <span class="stringliteral">&quot;ICQ&quot;</span>,  1, VA_RC_ICQ,  0,   0,   1,   0 },</div>
<div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;    { <a class="code" href="vaapi__encode_8h.html#a99fb83031ce9923c84392b4e92f956b5a0211927b756afaa318c53c3c9e94a253">RC_MODE_ICQ</a>,  <span class="stringliteral">&quot;ICQ&quot;</span>,  0 },</div>
<div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;<span class="preprocessor">#if VA_CHECK_VERSION(1, 3, 0)</span></div>
<div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;    { <a class="code" href="vaapi__encode_8h.html#a99fb83031ce9923c84392b4e92f956b5ab340a1cc2c507d4e6a23cc627a778451">RC_MODE_QVBR</a>, <span class="stringliteral">&quot;QVBR&quot;</span>, 1, VA_RC_QVBR, 1,   1,   1,   1 },</div>
<div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;    { <a class="code" href="vaapi__encode_8h.html#a99fb83031ce9923c84392b4e92f956b5afc89ef74e8eb0a75ad568ae5217a1188">RC_MODE_AVBR</a>, <span class="stringliteral">&quot;AVBR&quot;</span>, 0, VA_RC_AVBR, 1,   0,   0,   0 },</div>
<div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;    { <a class="code" href="vaapi__encode_8h.html#a99fb83031ce9923c84392b4e92f956b5ab340a1cc2c507d4e6a23cc627a778451">RC_MODE_QVBR</a>, <span class="stringliteral">&quot;QVBR&quot;</span>, 0 },</div>
<div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;    { <a class="code" href="vaapi__encode_8h.html#a99fb83031ce9923c84392b4e92f956b5afc89ef74e8eb0a75ad568ae5217a1188">RC_MODE_AVBR</a>, <span class="stringliteral">&quot;AVBR&quot;</span>, 0 },</div>
<div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;};</div>
<div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160; </div>
<div class="line"><a name="l01493"></a><span class="lineno"><a class="line" href="libavcodec_2vaapi__encode_8c.html#a23d840a141775ab2176725b6a5d59f26"> 1493</a></span>&#160;<span class="keyword">static</span> <a class="code" href="attributes_8h.html#abeeb324fff79a5335d36774704e2475c">av_cold</a> <span class="keywordtype">int</span> <a class="code" href="libavcodec_2vaapi__encode_8c.html#a23d840a141775ab2176725b6a5d59f26">vaapi_encode_init_rate_control</a>(<a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a> *avctx)</div>
<div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;{</div>
<div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;    <a class="code" href="struct_v_a_a_p_i_encode_context.html">VAAPIEncodeContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a> = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#af3379123060ad8cc9c321c29af4f8360">priv_data</a>;</div>
<div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;    uint32_t supported_va_rc_modes;</div>
<div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;    <span class="keyword">const</span> <a class="code" href="struct_v_a_a_p_i_encode_r_c_mode.html">VAAPIEncodeRCMode</a> *<a class="code" href="qsvenc_8c.html#a0f95ed71fe45fda6152a62f1f3b219c4">rc_mode</a>;</div>
<div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;    int64_t rc_bits_per_second;</div>
<div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;    <span class="keywordtype">int</span>     rc_target_percentage;</div>
<div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;    <span class="keywordtype">int</span>     rc_window_size;</div>
<div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;    <span class="keywordtype">int</span>     rc_quality;</div>
<div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;    int64_t hrd_buffer_size;</div>
<div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;    int64_t hrd_initial_buffer_fullness;</div>
<div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;    <span class="keywordtype">int</span> fr_num, fr_den;</div>
<div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;    VAConfigAttrib rc_attr = { VAConfigAttribRateControl };</div>
<div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;    VAStatus vas;</div>
<div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;    <span class="keywordtype">char</span> supported_rc_modes_string[64];</div>
<div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160; </div>
<div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;    vas = vaGetConfigAttributes(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;hwctx-&gt;display,</div>
<div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;                                <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;va_profile, <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;va_entrypoint,</div>
<div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;                                &amp;rc_attr, 1);</div>
<div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;    <span class="keywordflow">if</span> (vas != VA_STATUS_SUCCESS) {</div>
<div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to query rate control &quot;</span></div>
<div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;               <span class="stringliteral">&quot;config attribute: %d (%s).\n&quot;</span>, vas, vaErrorStr(vas));</div>
<div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="group__lavu__error.html#ga9c520e483ba8648495620ffdb4c491f2">AVERROR_EXTERNAL</a>;</div>
<div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;    }</div>
<div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;    <span class="keywordflow">if</span> (rc_attr.value == VA_ATTRIB_NOT_SUPPORTED) {</div>
<div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga9b58b28e2d429b930b69db19877f76a8">AV_LOG_VERBOSE</a>, <span class="stringliteral">&quot;Driver does not report any &quot;</span></div>
<div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;               <span class="stringliteral">&quot;supported rate control modes: assuming CQP only.\n&quot;</span>);</div>
<div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;        supported_va_rc_modes = VA_RC_CQP;</div>
<div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;        strcpy(supported_rc_modes_string, <span class="stringliteral">&quot;unknown&quot;</span>);</div>
<div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;        <span class="keywordtype">char</span> *<a class="code" href="namespaceconvert__header.html#ae1e061c0db8a47f53e1f3de5e371872e">str</a> = supported_rc_modes_string;</div>
<div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;        <span class="keywordtype">size_t</span> <a class="code" href="vorbis__enc__data_8h.html#afed088663f8704004425cdae2120b9b3">len</a> = <span class="keyword">sizeof</span>(supported_rc_modes_string);</div>
<div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;        <span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="code" href="rate__distortion_8txt.html#a526861bf57e81f603c2201f788ae709c">first</a> = 1, res;</div>
<div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160; </div>
<div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;        supported_va_rc_modes = rc_attr.value;</div>
<div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="sinewin__tablegen__template_8c.html#a3508a98d3ee7e2c9a4841fe264cf70f7">FF_ARRAY_ELEMS</a>(<a class="code" href="libavcodec_2vaapi__encode_8c.html#ad722c5a88a31067be89908e7cc836066">vaapi_encode_rc_modes</a>); <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;            <a class="code" href="qsvenc_8c.html#a0f95ed71fe45fda6152a62f1f3b219c4">rc_mode</a> = &amp;<a class="code" href="libavcodec_2vaapi__encode_8c.html#ad722c5a88a31067be89908e7cc836066">vaapi_encode_rc_modes</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;            <span class="keywordflow">if</span> (supported_va_rc_modes &amp; <a class="code" href="qsvenc_8c.html#a0f95ed71fe45fda6152a62f1f3b219c4">rc_mode</a>-&gt;va_mode) {</div>
<div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;                res = <a class="code" href="snprintf_8h.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a>(<a class="code" href="namespaceconvert__header.html#ae1e061c0db8a47f53e1f3de5e371872e">str</a>, <a class="code" href="vorbis__enc__data_8h.html#afed088663f8704004425cdae2120b9b3">len</a>, <span class="stringliteral">&quot;%s%s&quot;</span>,</div>
<div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;                               <a class="code" href="rate__distortion_8txt.html#a526861bf57e81f603c2201f788ae709c">first</a> ? <span class="stringliteral">&quot;&quot;</span> : <span class="stringliteral">&quot;, &quot;</span>, <a class="code" href="qsvenc_8c.html#a0f95ed71fe45fda6152a62f1f3b219c4">rc_mode</a>-&gt;name);</div>
<div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;                <a class="code" href="rate__distortion_8txt.html#a526861bf57e81f603c2201f788ae709c">first</a> = 0;</div>
<div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;                <span class="keywordflow">if</span> (res &lt; 0) {</div>
<div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;                    *<a class="code" href="namespaceconvert__header.html#ae1e061c0db8a47f53e1f3de5e371872e">str</a> = 0;</div>
<div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;                }</div>
<div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;                <a class="code" href="vorbis__enc__data_8h.html#afed088663f8704004425cdae2120b9b3">len</a> -= res;</div>
<div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;                <a class="code" href="namespaceconvert__header.html#ae1e061c0db8a47f53e1f3de5e371872e">str</a> += res;</div>
<div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="vorbis__enc__data_8h.html#afed088663f8704004425cdae2120b9b3">len</a> == 0)</div>
<div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;            }</div>
<div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;        }</div>
<div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160; </div>
<div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga5b7221c3afd06848486776bd834a58a5">AV_LOG_DEBUG</a>, <span class="stringliteral">&quot;Driver supports RC modes %s.\n&quot;</span>,</div>
<div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;               supported_rc_modes_string);</div>
<div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;    }</div>
<div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160; </div>
<div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;    <span class="comment">// Rate control mode selection:</span></div>
<div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;    <span class="comment">// * If the user has set a mode explicitly with the rc_mode option,</span></div>
<div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;    <span class="comment">//   use it and fail if it is not available.</span></div>
<div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;    <span class="comment">// * If an explicit QP option has been set, use CQP.</span></div>
<div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;    <span class="comment">// * If the codec is CQ-only, use CQP.</span></div>
<div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;    <span class="comment">// * If the QSCALE avcodec option is set, use CQP.</span></div>
<div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;    <span class="comment">// * If bitrate and quality are both set, try QVBR.</span></div>
<div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;    <span class="comment">// * If quality is set, try ICQ, then CQP.</span></div>
<div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;    <span class="comment">// * If bitrate and maxrate are set and have the same value, try CBR.</span></div>
<div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;    <span class="comment">// * If a bitrate is set, try AVBR, then VBR, then CBR.</span></div>
<div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;    <span class="comment">// * If no bitrate is set, try ICQ, then CQP.</span></div>
<div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160; </div>
<div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;<span class="preprocessor">#define TRY_RC_MODE(mode, fail) do { \</span></div>
<div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;<span class="preprocessor">        rc_mode = &amp;vaapi_encode_rc_modes[mode]; \</span></div>
<div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;<span class="preprocessor">        if (!(rc_mode-&gt;va_mode &amp; supported_va_rc_modes)) { \</span></div>
<div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;<span class="preprocessor">            if (fail) { \</span></div>
<div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;<span class="preprocessor">                av_log(avctx, AV_LOG_ERROR, &quot;Driver does not support %s &quot; \</span></div>
<div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;<span class="preprocessor">                       &quot;RC mode (supported modes: %s).\n&quot;, rc_mode-&gt;name, \</span></div>
<div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;<span class="preprocessor">                       supported_rc_modes_string); \</span></div>
<div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;<span class="preprocessor">                return AVERROR(EINVAL); \</span></div>
<div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;<span class="preprocessor">            } \</span></div>
<div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;<span class="preprocessor">            av_log(avctx, AV_LOG_DEBUG, &quot;Driver does not support %s &quot; \</span></div>
<div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;<span class="preprocessor">                   &quot;RC mode.\n&quot;, rc_mode-&gt;name); \</span></div>
<div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;<span class="preprocessor">            rc_mode = NULL; \</span></div>
<div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;<span class="preprocessor">        } else { \</span></div>
<div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;<span class="preprocessor">            goto rc_mode_found; \</span></div>
<div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;<span class="preprocessor">        } \</span></div>
<div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;<span class="preprocessor">    } while (0)</span></div>
<div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160; </div>
<div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;explicit_rc_mode)</div>
<div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;        <a class="code" href="libavcodec_2vaapi__encode_8c.html#a1076a20e6356fecd75cca2f82df74a25">TRY_RC_MODE</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;explicit_rc_mode, 1);</div>
<div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160; </div>
<div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;explicit_qp)</div>
<div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;        <a class="code" href="libavcodec_2vaapi__encode_8c.html#a1076a20e6356fecd75cca2f82df74a25">TRY_RC_MODE</a>(<a class="code" href="vaapi__encode_8h.html#a99fb83031ce9923c84392b4e92f956b5a5d5bf4fa66599951866951d97ce8897d">RC_MODE_CQP</a>, 1);</div>
<div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160; </div>
<div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;codec-&gt;<a class="code" href="struct_a_v_format_context.html#a32379cc371463b235d54235d4af06a15">flags</a> &amp; <a class="code" href="vaapi__encode_8h.html#abc6126af1d45847bc59afa0aa3216b04a5b3e6d5c03c045f30ecaef927f8b35a2">FLAG_CONSTANT_QUALITY_ONLY</a>)</div>
<div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;        <a class="code" href="libavcodec_2vaapi__encode_8c.html#a1076a20e6356fecd75cca2f82df74a25">TRY_RC_MODE</a>(<a class="code" href="vaapi__encode_8h.html#a99fb83031ce9923c84392b4e92f956b5a5d5bf4fa66599951866951d97ce8897d">RC_MODE_CQP</a>, 1);</div>
<div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160; </div>
<div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;    <span class="keywordflow">if</span> (avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#abb01e291550fa3fb96188af4d494587e">flags</a> &amp; <a class="code" href="group__lavc__core.html#ga70edda5debd8433d29ec1b9eed57422b">AV_CODEC_FLAG_QSCALE</a>)</div>
<div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;        <a class="code" href="libavcodec_2vaapi__encode_8c.html#a1076a20e6356fecd75cca2f82df74a25">TRY_RC_MODE</a>(<a class="code" href="vaapi__encode_8h.html#a99fb83031ce9923c84392b4e92f956b5a5d5bf4fa66599951866951d97ce8897d">RC_MODE_CQP</a>, 1);</div>
<div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160; </div>
<div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;    <span class="keywordflow">if</span> (avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a6b53fda85ad61baa345edbd96cb8a33c">bit_rate</a> &gt; 0 &amp;&amp; avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a209f5ec60cb5f0b0a4962f4c5c5bb541">global_quality</a> &gt; 0)</div>
<div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;        <a class="code" href="libavcodec_2vaapi__encode_8c.html#a1076a20e6356fecd75cca2f82df74a25">TRY_RC_MODE</a>(<a class="code" href="vaapi__encode_8h.html#a99fb83031ce9923c84392b4e92f956b5ab340a1cc2c507d4e6a23cc627a778451">RC_MODE_QVBR</a>, 0);</div>
<div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160; </div>
<div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;    <span class="keywordflow">if</span> (avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a209f5ec60cb5f0b0a4962f4c5c5bb541">global_quality</a> &gt; 0) {</div>
<div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;        <a class="code" href="libavcodec_2vaapi__encode_8c.html#a1076a20e6356fecd75cca2f82df74a25">TRY_RC_MODE</a>(<a class="code" href="vaapi__encode_8h.html#a99fb83031ce9923c84392b4e92f956b5a0211927b756afaa318c53c3c9e94a253">RC_MODE_ICQ</a>, 0);</div>
<div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;        <a class="code" href="libavcodec_2vaapi__encode_8c.html#a1076a20e6356fecd75cca2f82df74a25">TRY_RC_MODE</a>(<a class="code" href="vaapi__encode_8h.html#a99fb83031ce9923c84392b4e92f956b5a5d5bf4fa66599951866951d97ce8897d">RC_MODE_CQP</a>, 0);</div>
<div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;    }</div>
<div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160; </div>
<div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;    <span class="keywordflow">if</span> (avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a6b53fda85ad61baa345edbd96cb8a33c">bit_rate</a> &gt; 0 &amp;&amp; avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#aa2b5582f1a360534310b686cc3f7c668">rc_max_rate</a> == avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a6b53fda85ad61baa345edbd96cb8a33c">bit_rate</a>)</div>
<div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;        <a class="code" href="libavcodec_2vaapi__encode_8c.html#a1076a20e6356fecd75cca2f82df74a25">TRY_RC_MODE</a>(<a class="code" href="vaapi__encode_8h.html#a99fb83031ce9923c84392b4e92f956b5ab433d7f001038a3ce0eb623789bef910">RC_MODE_CBR</a>, 0);</div>
<div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160; </div>
<div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;    <span class="keywordflow">if</span> (avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a6b53fda85ad61baa345edbd96cb8a33c">bit_rate</a> &gt; 0) {</div>
<div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;        <a class="code" href="libavcodec_2vaapi__encode_8c.html#a1076a20e6356fecd75cca2f82df74a25">TRY_RC_MODE</a>(<a class="code" href="vaapi__encode_8h.html#a99fb83031ce9923c84392b4e92f956b5afc89ef74e8eb0a75ad568ae5217a1188">RC_MODE_AVBR</a>, 0);</div>
<div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;        <a class="code" href="libavcodec_2vaapi__encode_8c.html#a1076a20e6356fecd75cca2f82df74a25">TRY_RC_MODE</a>(<a class="code" href="vaapi__encode_8h.html#a99fb83031ce9923c84392b4e92f956b5ad729ee7c5714d6063cc2bc4e91dd0b0d">RC_MODE_VBR</a>, 0);</div>
<div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;        <a class="code" href="libavcodec_2vaapi__encode_8c.html#a1076a20e6356fecd75cca2f82df74a25">TRY_RC_MODE</a>(<a class="code" href="vaapi__encode_8h.html#a99fb83031ce9923c84392b4e92f956b5ab433d7f001038a3ce0eb623789bef910">RC_MODE_CBR</a>, 0);</div>
<div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;        <a class="code" href="libavcodec_2vaapi__encode_8c.html#a1076a20e6356fecd75cca2f82df74a25">TRY_RC_MODE</a>(<a class="code" href="vaapi__encode_8h.html#a99fb83031ce9923c84392b4e92f956b5a0211927b756afaa318c53c3c9e94a253">RC_MODE_ICQ</a>, 0);</div>
<div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;        <a class="code" href="libavcodec_2vaapi__encode_8c.html#a1076a20e6356fecd75cca2f82df74a25">TRY_RC_MODE</a>(<a class="code" href="vaapi__encode_8h.html#a99fb83031ce9923c84392b4e92f956b5a5d5bf4fa66599951866951d97ce8897d">RC_MODE_CQP</a>, 0);</div>
<div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;    }</div>
<div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160; </div>
<div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Driver does not support any &quot;</span></div>
<div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;           <span class="stringliteral">&quot;RC mode compatible with selected options &quot;</span></div>
<div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;           <span class="stringliteral">&quot;(supported modes: %s).\n&quot;</span>, supported_rc_modes_string);</div>
<div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EINVAL);</div>
<div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160; </div>
<div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;rc_mode_found:</div>
<div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="qsvenc_8c.html#a0f95ed71fe45fda6152a62f1f3b219c4">rc_mode</a>-&gt;bitrate) {</div>
<div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;        <span class="keywordflow">if</span> (avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a6b53fda85ad61baa345edbd96cb8a33c">bit_rate</a> &lt;= 0) {</div>
<div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Bitrate must be set for %s &quot;</span></div>
<div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;                   <span class="stringliteral">&quot;RC mode.\n&quot;</span>, <a class="code" href="qsvenc_8c.html#a0f95ed71fe45fda6152a62f1f3b219c4">rc_mode</a>-&gt;name);</div>
<div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EINVAL);</div>
<div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;        }</div>
<div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160; </div>
<div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="qsvenc_8c.html#a0f95ed71fe45fda6152a62f1f3b219c4">rc_mode</a>-&gt;mode == <a class="code" href="vaapi__encode_8h.html#a99fb83031ce9923c84392b4e92f956b5afc89ef74e8eb0a75ad568ae5217a1188">RC_MODE_AVBR</a>) {</div>
<div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;            <span class="comment">// For maximum confusion AVBR is hacked into the existing API</span></div>
<div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;            <span class="comment">// by overloading some of the fields with completely different</span></div>
<div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;            <span class="comment">// meanings.</span></div>
<div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160; </div>
<div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;            <span class="comment">// Target percentage does not apply in AVBR mode.</span></div>
<div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;            rc_bits_per_second = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a6b53fda85ad61baa345edbd96cb8a33c">bit_rate</a>;</div>
<div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160; </div>
<div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;            <span class="comment">// Accuracy tolerance range for meeting the specified target</span></div>
<div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;            <span class="comment">// bitrate.  It&#39;s very unclear how this is actually intended</span></div>
<div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;            <span class="comment">// to work - since we do want to get the specified bitrate,</span></div>
<div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;            <span class="comment">// set the accuracy to 100% for now.</span></div>
<div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;            rc_target_percentage = 100;</div>
<div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160; </div>
<div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;            <span class="comment">// Convergence period in frames.  The GOP size reflects the</span></div>
<div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;            <span class="comment">// user&#39;s intended block size for cutting, so reusing that</span></div>
<div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;            <span class="comment">// as the convergence period seems a reasonable default.</span></div>
<div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;            rc_window_size = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a9b6b3f1fcbdcc2ad9f4dbb4370496e38">gop_size</a> &gt; 0 ? avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a9b6b3f1fcbdcc2ad9f4dbb4370496e38">gop_size</a> : 60;</div>
<div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160; </div>
<div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="qsvenc_8c.html#a0f95ed71fe45fda6152a62f1f3b219c4">rc_mode</a>-&gt;maxrate) {</div>
<div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;            <span class="keywordflow">if</span> (avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#aa2b5582f1a360534310b686cc3f7c668">rc_max_rate</a> &gt; 0) {</div>
<div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;                <span class="keywordflow">if</span> (avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#aa2b5582f1a360534310b686cc3f7c668">rc_max_rate</a> &lt; avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a6b53fda85ad61baa345edbd96cb8a33c">bit_rate</a>) {</div>
<div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;                    <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Invalid bitrate settings: &quot;</span></div>
<div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;                           <span class="stringliteral">&quot;bitrate (%&quot;</span>PRId64<span class="stringliteral">&quot;) must not be greater than &quot;</span></div>
<div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;                           <span class="stringliteral">&quot;maxrate (%&quot;</span>PRId64<span class="stringliteral">&quot;).\n&quot;</span>, avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a6b53fda85ad61baa345edbd96cb8a33c">bit_rate</a>,</div>
<div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;                           avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#aa2b5582f1a360534310b686cc3f7c668">rc_max_rate</a>);</div>
<div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;                    <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EINVAL);</div>
<div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;                }</div>
<div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;                rc_bits_per_second   = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#aa2b5582f1a360534310b686cc3f7c668">rc_max_rate</a>;</div>
<div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;                rc_target_percentage = (avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a6b53fda85ad61baa345edbd96cb8a33c">bit_rate</a> * 100) /</div>
<div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;                                       avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#aa2b5582f1a360534310b686cc3f7c668">rc_max_rate</a>;</div>
<div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;                <span class="comment">// We only have a target bitrate, but this mode requires</span></div>
<div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;                <span class="comment">// that a maximum rate be supplied as well.  Since the</span></div>
<div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;                <span class="comment">// user does not want this to be a constraint, arbitrarily</span></div>
<div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;                <span class="comment">// pick a maximum rate of double the target rate.</span></div>
<div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;                rc_bits_per_second   = 2 * avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a6b53fda85ad61baa345edbd96cb8a33c">bit_rate</a>;</div>
<div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;                rc_target_percentage = 50;</div>
<div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;            }</div>
<div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;            <span class="keywordflow">if</span> (avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#aa2b5582f1a360534310b686cc3f7c668">rc_max_rate</a> &gt; avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a6b53fda85ad61baa345edbd96cb8a33c">bit_rate</a>) {</div>
<div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;                <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga85b57516ca703cc47d9bbe5f4658c716">AV_LOG_WARNING</a>, <span class="stringliteral">&quot;Max bitrate is ignored &quot;</span></div>
<div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;                       <span class="stringliteral">&quot;in %s RC mode.\n&quot;</span>, <a class="code" href="qsvenc_8c.html#a0f95ed71fe45fda6152a62f1f3b219c4">rc_mode</a>-&gt;name);</div>
<div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;            }</div>
<div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;            rc_bits_per_second   = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a6b53fda85ad61baa345edbd96cb8a33c">bit_rate</a>;</div>
<div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;            rc_target_percentage = 100;</div>
<div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;        }</div>
<div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;        rc_bits_per_second   = 0;</div>
<div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;        rc_target_percentage = 100;</div>
<div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;    }</div>
<div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160; </div>
<div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="qsvenc_8c.html#a0f95ed71fe45fda6152a62f1f3b219c4">rc_mode</a>-&gt;quality) {</div>
<div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;explicit_qp) {</div>
<div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;            rc_quality = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;explicit_qp;</div>
<div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a209f5ec60cb5f0b0a4962f4c5c5bb541">global_quality</a> &gt; 0) {</div>
<div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;            rc_quality = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a209f5ec60cb5f0b0a4962f4c5c5bb541">global_quality</a>;</div>
<div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;            rc_quality = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;codec-&gt;default_quality;</div>
<div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga85b57516ca703cc47d9bbe5f4658c716">AV_LOG_WARNING</a>, <span class="stringliteral">&quot;No quality level set; &quot;</span></div>
<div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;                   <span class="stringliteral">&quot;using default (%d).\n&quot;</span>, rc_quality);</div>
<div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;        }</div>
<div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;        rc_quality = 0;</div>
<div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;    }</div>
<div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160; </div>
<div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="qsvenc_8c.html#a0f95ed71fe45fda6152a62f1f3b219c4">rc_mode</a>-&gt;hrd) {</div>
<div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;        <span class="keywordflow">if</span> (avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a15000607a7e2371162348bb35b0184c1">rc_buffer_size</a>)</div>
<div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;            hrd_buffer_size = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a15000607a7e2371162348bb35b0184c1">rc_buffer_size</a>;</div>
<div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#aa2b5582f1a360534310b686cc3f7c668">rc_max_rate</a> &gt; 0)</div>
<div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;            hrd_buffer_size = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#aa2b5582f1a360534310b686cc3f7c668">rc_max_rate</a>;</div>
<div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;            hrd_buffer_size = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a6b53fda85ad61baa345edbd96cb8a33c">bit_rate</a>;</div>
<div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;        <span class="keywordflow">if</span> (avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a7546ebfa9e9ffede316576dced7e150c">rc_initial_buffer_occupancy</a>) {</div>
<div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;            <span class="keywordflow">if</span> (avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a7546ebfa9e9ffede316576dced7e150c">rc_initial_buffer_occupancy</a> &gt; hrd_buffer_size) {</div>
<div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;                <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Invalid RC buffer settings: &quot;</span></div>
<div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;                       <span class="stringliteral">&quot;must have initial buffer size (%d) &lt;= &quot;</span></div>
<div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;                       <span class="stringliteral">&quot;buffer size (%&quot;</span>PRId64<span class="stringliteral">&quot;).\n&quot;</span>,</div>
<div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;                       avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a7546ebfa9e9ffede316576dced7e150c">rc_initial_buffer_occupancy</a>, hrd_buffer_size);</div>
<div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EINVAL);</div>
<div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;            }</div>
<div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;            hrd_initial_buffer_fullness = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a7546ebfa9e9ffede316576dced7e150c">rc_initial_buffer_occupancy</a>;</div>
<div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;            hrd_initial_buffer_fullness = hrd_buffer_size * 3 / 4;</div>
<div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;        }</div>
<div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160; </div>
<div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;        rc_window_size = (hrd_buffer_size * 1000) / rc_bits_per_second;</div>
<div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;        <span class="keywordflow">if</span> (avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a15000607a7e2371162348bb35b0184c1">rc_buffer_size</a> || avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a7546ebfa9e9ffede316576dced7e150c">rc_initial_buffer_occupancy</a>) {</div>
<div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga85b57516ca703cc47d9bbe5f4658c716">AV_LOG_WARNING</a>, <span class="stringliteral">&quot;Buffering settings are ignored &quot;</span></div>
<div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;                   <span class="stringliteral">&quot;in %s RC mode.\n&quot;</span>, <a class="code" href="qsvenc_8c.html#a0f95ed71fe45fda6152a62f1f3b219c4">rc_mode</a>-&gt;name);</div>
<div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;        }</div>
<div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160; </div>
<div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;        hrd_buffer_size             = 0;</div>
<div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;        hrd_initial_buffer_fullness = 0;</div>
<div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160; </div>
<div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="qsvenc_8c.html#a0f95ed71fe45fda6152a62f1f3b219c4">rc_mode</a>-&gt;mode != <a class="code" href="vaapi__encode_8h.html#a99fb83031ce9923c84392b4e92f956b5afc89ef74e8eb0a75ad568ae5217a1188">RC_MODE_AVBR</a>) {</div>
<div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;            <span class="comment">// Already set (with completely different meaning) for AVBR.</span></div>
<div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;            rc_window_size = 1000;</div>
<div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;        }</div>
<div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;    }</div>
<div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160; </div>
<div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;    <span class="keywordflow">if</span> (rc_bits_per_second          &gt; UINT32_MAX ||</div>
<div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;        hrd_buffer_size             &gt; UINT32_MAX ||</div>
<div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;        hrd_initial_buffer_fullness &gt; UINT32_MAX) {</div>
<div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;RC parameters of 2^32 or &quot;</span></div>
<div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;               <span class="stringliteral">&quot;greater are not supported by VAAPI.\n&quot;</span>);</div>
<div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EINVAL);</div>
<div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;    }</div>
<div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160; </div>
<div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;rc_mode     = <a class="code" href="qsvenc_8c.html#a0f95ed71fe45fda6152a62f1f3b219c4">rc_mode</a>;</div>
<div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;rc_quality  = rc_quality;</div>
<div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;va_rc_mode  = <a class="code" href="qsvenc_8c.html#a0f95ed71fe45fda6152a62f1f3b219c4">rc_mode</a>-&gt;va_mode;</div>
<div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;va_bit_rate = rc_bits_per_second;</div>
<div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160; </div>
<div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga9b58b28e2d429b930b69db19877f76a8">AV_LOG_VERBOSE</a>, <span class="stringliteral">&quot;RC mode: %s.\n&quot;</span>, <a class="code" href="qsvenc_8c.html#a0f95ed71fe45fda6152a62f1f3b219c4">rc_mode</a>-&gt;name);</div>
<div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;    <span class="keywordflow">if</span> (rc_attr.value == VA_ATTRIB_NOT_SUPPORTED) {</div>
<div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;        <span class="comment">// This driver does not want the RC mode attribute to be set.</span></div>
<div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;config_attributes[<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nb_config_attributes++] =</div>
<div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;            (VAConfigAttrib) {</div>
<div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;            .type  = VAConfigAttribRateControl,</div>
<div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;            .value = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;va_rc_mode,</div>
<div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;        };</div>
<div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;    }</div>
<div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160; </div>
<div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="qsvenc_8c.html#a0f95ed71fe45fda6152a62f1f3b219c4">rc_mode</a>-&gt;quality)</div>
<div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga9b58b28e2d429b930b69db19877f76a8">AV_LOG_VERBOSE</a>, <span class="stringliteral">&quot;RC quality: %d.\n&quot;</span>, rc_quality);</div>
<div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160; </div>
<div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="qsvenc_8c.html#a0f95ed71fe45fda6152a62f1f3b219c4">rc_mode</a>-&gt;va_mode != VA_RC_CQP) {</div>
<div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="qsvenc_8c.html#a0f95ed71fe45fda6152a62f1f3b219c4">rc_mode</a>-&gt;mode == <a class="code" href="vaapi__encode_8h.html#a99fb83031ce9923c84392b4e92f956b5afc89ef74e8eb0a75ad568ae5217a1188">RC_MODE_AVBR</a>) {</div>
<div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga9b58b28e2d429b930b69db19877f76a8">AV_LOG_VERBOSE</a>, <span class="stringliteral">&quot;RC target: %&quot;</span>PRId64<span class="stringliteral">&quot; bps &quot;</span></div>
<div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;                   <span class="stringliteral">&quot;converging in %d frames with %d%% accuracy.\n&quot;</span>,</div>
<div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;                   rc_bits_per_second, rc_window_size,</div>
<div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;                   rc_target_percentage);</div>
<div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="qsvenc_8c.html#a0f95ed71fe45fda6152a62f1f3b219c4">rc_mode</a>-&gt;bitrate) {</div>
<div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga9b58b28e2d429b930b69db19877f76a8">AV_LOG_VERBOSE</a>, <span class="stringliteral">&quot;RC target: %d%% of &quot;</span></div>
<div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;                   <span class="stringliteral">&quot;%&quot;</span>PRId64<span class="stringliteral">&quot; bps over %d ms.\n&quot;</span>, rc_target_percentage,</div>
<div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;                   rc_bits_per_second, rc_window_size);</div>
<div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;        }</div>
<div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160; </div>
<div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;rc_params = (VAEncMiscParameterRateControl) {</div>
<div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;            .bits_per_second    = rc_bits_per_second,</div>
<div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;            .target_percentage  = rc_target_percentage,</div>
<div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;            .window_size        = rc_window_size,</div>
<div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;            .initial_qp         = 0,</div>
<div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;            .min_qp             = (avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a3f63bc9141e25bf7f1cda0cef7cd4a60">qmin</a> &gt; 0 ? avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a3f63bc9141e25bf7f1cda0cef7cd4a60">qmin</a> : 0),</div>
<div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;            .basic_unit_size    = 0,</div>
<div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;#<span class="keywordflow">if</span> VA_CHECK_VERSION(1, 1, 0)</div>
<div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;            .ICQ_quality_factor = av_clip(rc_quality, 1, 51),</div>
<div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;            .max_qp             = (avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#ab015db3b7fcd227193a7c17283914187">qmax</a> &gt; 0 ? avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#ab015db3b7fcd227193a7c17283914187">qmax</a> : 0),</div>
<div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;#endif</div>
<div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;#<span class="keywordflow">if</span> VA_CHECK_VERSION(1, 3, 0)</div>
<div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;            .quality_factor     = rc_quality,</div>
<div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;        };</div>
<div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;        <a class="code" href="libavcodec_2vaapi__encode_8c.html#a5c62d3b58fc2a9ef2511250f2745452a">vaapi_encode_add_global_param</a>(avctx,</div>
<div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;                                      VAEncMiscParameterTypeRateControl,</div>
<div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;                                      &amp;<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;rc_params,</div>
<div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;                                      <span class="keyword">sizeof</span>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;rc_params));</div>
<div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;    }</div>
<div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160; </div>
<div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="qsvenc_8c.html#a0f95ed71fe45fda6152a62f1f3b219c4">rc_mode</a>-&gt;hrd) {</div>
<div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga9b58b28e2d429b930b69db19877f76a8">AV_LOG_VERBOSE</a>, <span class="stringliteral">&quot;RC buffer: %&quot;</span>PRId64<span class="stringliteral">&quot; bits, &quot;</span></div>
<div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;               <span class="stringliteral">&quot;initial fullness %&quot;</span>PRId64<span class="stringliteral">&quot; bits.\n&quot;</span>,</div>
<div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;               hrd_buffer_size, hrd_initial_buffer_fullness);</div>
<div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160; </div>
<div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;hrd_params = (VAEncMiscParameterHRD) {</div>
<div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;            .initial_buffer_fullness = hrd_initial_buffer_fullness,</div>
<div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;            .buffer_size             = hrd_buffer_size,</div>
<div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;        };</div>
<div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;        <a class="code" href="libavcodec_2vaapi__encode_8c.html#a5c62d3b58fc2a9ef2511250f2745452a">vaapi_encode_add_global_param</a>(avctx,</div>
<div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;                                      VAEncMiscParameterTypeHRD,</div>
<div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;                                      &amp;<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;hrd_params,</div>
<div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;                                      <span class="keyword">sizeof</span>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;hrd_params));</div>
<div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;    }</div>
<div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160; </div>
<div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;    <span class="keywordflow">if</span> (avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a4d08b297e97eefd66c714df4fff493c8">framerate</a>.<a class="code" href="struct_a_v_rational.html#ae9a98c10a301c5e937095105b6f0fdb9">num</a> &gt; 0 &amp;&amp; avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a4d08b297e97eefd66c714df4fff493c8">framerate</a>.<a class="code" href="struct_a_v_rational.html#aee46bdac67d965ac0a4204e753f910c3">den</a> &gt; 0)</div>
<div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;        <a class="code" href="group__lavu__math__rational.html#ga4fd9c0b8e663cf3d55e89fbc6ce71602">av_reduce</a>(&amp;fr_num, &amp;fr_den,</div>
<div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;                  avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a4d08b297e97eefd66c714df4fff493c8">framerate</a>.<a class="code" href="struct_a_v_rational.html#ae9a98c10a301c5e937095105b6f0fdb9">num</a>, avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a4d08b297e97eefd66c714df4fff493c8">framerate</a>.<a class="code" href="struct_a_v_rational.html#aee46bdac67d965ac0a4204e753f910c3">den</a>, 65535);</div>
<div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;        <a class="code" href="group__lavu__math__rational.html#ga4fd9c0b8e663cf3d55e89fbc6ce71602">av_reduce</a>(&amp;fr_num, &amp;fr_den,</div>
<div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;                  avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#ab7bfeb9fa5840aac090e2b0bd0ef7589">time_base</a>.<a class="code" href="struct_a_v_rational.html#aee46bdac67d965ac0a4204e753f910c3">den</a>, avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#ab7bfeb9fa5840aac090e2b0bd0ef7589">time_base</a>.<a class="code" href="struct_a_v_rational.html#ae9a98c10a301c5e937095105b6f0fdb9">num</a>, 65535);</div>
<div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160; </div>
<div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga9b58b28e2d429b930b69db19877f76a8">AV_LOG_VERBOSE</a>, <span class="stringliteral">&quot;RC framerate: %d/%d (%.2f fps).\n&quot;</span>,</div>
<div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;           fr_num, fr_den, (<span class="keywordtype">double</span>)fr_num / fr_den);</div>
<div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160; </div>
<div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;fr_params = (VAEncMiscParameterFrameRate) {</div>
<div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;        .framerate = (<span class="keywordtype">unsigned</span> <a class="code" href="ffmpeg__filter_8c.html#a61569f2965b7a369eb10b6d75d410d11">int</a>)fr_den &lt;&lt; 16 | fr_num,</div>
<div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;    };</div>
<div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;<span class="preprocessor">#if VA_CHECK_VERSION(0, 40, 0)</span></div>
<div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;    <a class="code" href="libavcodec_2vaapi__encode_8c.html#a5c62d3b58fc2a9ef2511250f2745452a">vaapi_encode_add_global_param</a>(avctx,</div>
<div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;                                  VAEncMiscParameterTypeFrameRate,</div>
<div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;                                  &amp;<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;fr_params,</div>
<div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;                                  <span class="keyword">sizeof</span>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;fr_params));</div>
<div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160; </div>
<div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;}</div>
<div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160; </div>
<div class="line"><a name="l01823"></a><span class="lineno"><a class="line" href="libavcodec_2vaapi__encode_8c.html#ae0dfaf8475c426d4d3732e0f78f3fdf1"> 1823</a></span>&#160;<span class="keyword">static</span> <a class="code" href="attributes_8h.html#abeeb324fff79a5335d36774704e2475c">av_cold</a> <span class="keywordtype">int</span> <a class="code" href="libavcodec_2vaapi__encode_8c.html#ae0dfaf8475c426d4d3732e0f78f3fdf1">vaapi_encode_init_gop_structure</a>(<a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a> *avctx)</div>
<div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;{</div>
<div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;    <a class="code" href="struct_v_a_a_p_i_encode_context.html">VAAPIEncodeContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a> = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#af3379123060ad8cc9c321c29af4f8360">priv_data</a>;</div>
<div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;    VAStatus vas;</div>
<div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;    VAConfigAttrib attr = { VAConfigAttribEncMaxRefFrames };</div>
<div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;    uint32_t ref_l0, ref_l1;</div>
<div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160; </div>
<div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;    vas = vaGetConfigAttributes(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;hwctx-&gt;display,</div>
<div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;                                <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;va_profile,</div>
<div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;                                <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;va_entrypoint,</div>
<div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;                                &amp;attr, 1);</div>
<div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;    <span class="keywordflow">if</span> (vas != VA_STATUS_SUCCESS) {</div>
<div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to query reference frames &quot;</span></div>
<div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;               <span class="stringliteral">&quot;attribute: %d (%s).\n&quot;</span>, vas, vaErrorStr(vas));</div>
<div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="group__lavu__error.html#ga9c520e483ba8648495620ffdb4c491f2">AVERROR_EXTERNAL</a>;</div>
<div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;    }</div>
<div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160; </div>
<div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;    <span class="keywordflow">if</span> (attr.value == VA_ATTRIB_NOT_SUPPORTED) {</div>
<div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;        ref_l0 = ref_l1 = 0;</div>
<div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;        ref_l0 = attr.value       &amp; 0xffff;</div>
<div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;        ref_l1 = attr.value &gt;&gt; 16 &amp; 0xffff;</div>
<div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;    }</div>
<div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160; </div>
<div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;codec-&gt;<a class="code" href="struct_a_v_format_context.html#a32379cc371463b235d54235d4af06a15">flags</a> &amp; <a class="code" href="vaapi__encode_8h.html#abc6126af1d45847bc59afa0aa3216b04aea37de0df3305b9dbb2a3df87df1e222">FLAG_INTRA_ONLY</a> ||</div>
<div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;        avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a9b6b3f1fcbdcc2ad9f4dbb4370496e38">gop_size</a> &lt;= 1) {</div>
<div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga9b58b28e2d429b930b69db19877f76a8">AV_LOG_VERBOSE</a>, <span class="stringliteral">&quot;Using intra frames only.\n&quot;</span>);</div>
<div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;gop_size = 1;</div>
<div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ref_l0 &lt; 1) {</div>
<div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Driver does not support any &quot;</span></div>
<div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;               <span class="stringliteral">&quot;reference frames.\n&quot;</span>);</div>
<div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EINVAL);</div>
<div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;codec-&gt;<a class="code" href="struct_a_v_format_context.html#a32379cc371463b235d54235d4af06a15">flags</a> &amp; <a class="code" href="vaapi__encode_8h.html#abc6126af1d45847bc59afa0aa3216b04a4894ca430a745f72a320a8510f49abbf">FLAG_B_PICTURES</a>) ||</div>
<div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;               ref_l1 &lt; 1 || avctx-&gt;max_b_frames &lt; 1) {</div>
<div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga9b58b28e2d429b930b69db19877f76a8">AV_LOG_VERBOSE</a>, <span class="stringliteral">&quot;Using intra and P-frames &quot;</span></div>
<div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;               <span class="stringliteral">&quot;(supported references: %d / %d).\n&quot;</span>, ref_l0, ref_l1);</div>
<div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;gop_size = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a9b6b3f1fcbdcc2ad9f4dbb4370496e38">gop_size</a>;</div>
<div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;p_per_i  = INT_MAX;</div>
<div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;b_per_p  = 0;</div>
<div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga9b58b28e2d429b930b69db19877f76a8">AV_LOG_VERBOSE</a>, <span class="stringliteral">&quot;Using intra, P- and B-frames &quot;</span></div>
<div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;               <span class="stringliteral">&quot;(supported references: %d / %d).\n&quot;</span>, ref_l0, ref_l1);</div>
<div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;gop_size = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a9b6b3f1fcbdcc2ad9f4dbb4370496e38">gop_size</a>;</div>
<div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;p_per_i  = INT_MAX;</div>
<div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;b_per_p  = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a3e5334a611a3e2a6a653805bb9e2d4d4">max_b_frames</a>;</div>
<div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;codec-&gt;<a class="code" href="struct_a_v_format_context.html#a32379cc371463b235d54235d4af06a15">flags</a> &amp; <a class="code" href="vaapi__encode_8h.html#abc6126af1d45847bc59afa0aa3216b04adb158c6c9512d48028d0dba677934703">FLAG_B_PICTURE_REFERENCES</a>) {</div>
<div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;            <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;max_b_depth = <a class="code" href="common_8h.html#a0f84cbd7fd810cd678157c98cbfad4b0">FFMIN</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;desired_b_depth,</div>
<div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;                                     <a class="code" href="intmath_8h.html#a2998e3360a5d1a5763e8c1008b7b2e1d">av_log2</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;b_per_p) + 1);</div>
<div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;            <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;max_b_depth = 1;</div>
<div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;        }</div>
<div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;    }</div>
<div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160; </div>
<div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;codec-&gt;<a class="code" href="struct_a_v_format_context.html#a32379cc371463b235d54235d4af06a15">flags</a> &amp; <a class="code" href="vaapi__encode_8h.html#abc6126af1d45847bc59afa0aa3216b04abe8e15036905c4de8a6355add509c896">FLAG_NON_IDR_KEY_PICTURES</a>) {</div>
<div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;closed_gop  = !!(avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#abb01e291550fa3fb96188af4d494587e">flags</a> &amp; <a class="code" href="group__lavc__core.html#ga4444b40e467199423bba5cf5ac791c49">AV_CODEC_FLAG_CLOSED_GOP</a>);</div>
<div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;gop_per_idr = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;idr_interval + 1;</div>
<div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;closed_gop  = 1;</div>
<div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;gop_per_idr = 1;</div>
<div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;    }</div>
<div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160; </div>
<div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;}</div>
<div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160; </div>
<div class="line"><a name="l01887"></a><span class="lineno"><a class="line" href="libavcodec_2vaapi__encode_8c.html#a4c251c181207b0fa4a94cdc25a2f450a"> 1887</a></span>&#160;<span class="keyword">static</span> <a class="code" href="attributes_8h.html#abeeb324fff79a5335d36774704e2475c">av_cold</a> <span class="keywordtype">int</span> <a class="code" href="libavcodec_2vaapi__encode_8c.html#a4c251c181207b0fa4a94cdc25a2f450a">vaapi_encode_init_row_slice_structure</a>(<a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a> *avctx,</div>
<div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;                                                         uint32_t slice_structure)</div>
<div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;{</div>
<div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;    <a class="code" href="struct_v_a_a_p_i_encode_context.html">VAAPIEncodeContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a> = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#af3379123060ad8cc9c321c29af4f8360">priv_data</a>;</div>
<div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;    <span class="keywordtype">int</span> req_slices;</div>
<div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160; </div>
<div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;    <span class="comment">// For fixed-size slices currently we only support whole rows, making</span></div>
<div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;    <span class="comment">// rectangular slices.  This could be extended to arbitrary runs of</span></div>
<div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;    <span class="comment">// blocks, but since slices tend to be a conformance requirement and</span></div>
<div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;    <span class="comment">// most cases (such as broadcast or bluray) want rectangular slices</span></div>
<div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;    <span class="comment">// only it would need to be gated behind another option.</span></div>
<div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;    <span class="keywordflow">if</span> (avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#aff4e6a78c0f08be43879644632e04b24">slices</a> &gt; <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;slice_block_rows) {</div>
<div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga85b57516ca703cc47d9bbe5f4658c716">AV_LOG_WARNING</a>, <span class="stringliteral">&quot;Not enough rows to use &quot;</span></div>
<div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;               <span class="stringliteral">&quot;configured number of slices (%d &lt; %d); using &quot;</span></div>
<div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;               <span class="stringliteral">&quot;maximum.\n&quot;</span>, <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;slice_block_rows, avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#aff4e6a78c0f08be43879644632e04b24">slices</a>);</div>
<div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;        req_slices = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;slice_block_rows;</div>
<div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;        req_slices = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#aff4e6a78c0f08be43879644632e04b24">slices</a>;</div>
<div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;    }</div>
<div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;    <span class="keywordflow">if</span> (slice_structure &amp; VA_ENC_SLICE_STRUCTURE_ARBITRARY_ROWS ||</div>
<div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;        slice_structure &amp; VA_ENC_SLICE_STRUCTURE_ARBITRARY_MACROBLOCKS) {</div>
<div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nb_slices  = req_slices;</div>
<div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;slice_size = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;slice_block_rows / <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nb_slices;</div>
<div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (slice_structure &amp; VA_ENC_SLICE_STRUCTURE_POWER_OF_TWO_ROWS) {</div>
<div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;        <span class="keywordtype">int</span> k;</div>
<div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;        <span class="keywordflow">for</span> (k = 1;; k *= 2) {</div>
<div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;            <span class="keywordflow">if</span> (2 * k * (req_slices - 1) + 1 &gt;= <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;slice_block_rows)</div>
<div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;        }</div>
<div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nb_slices  = (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;slice_block_rows + k - 1) / k;</div>
<div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;slice_size = k;</div>
<div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;<span class="preprocessor">#if VA_CHECK_VERSION(1, 0, 0)</span></div>
<div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (slice_structure &amp; VA_ENC_SLICE_STRUCTURE_EQUAL_ROWS) {</div>
<div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nb_slices  = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;slice_block_rows;</div>
<div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;slice_size = 1;</div>
<div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Driver does not support any usable &quot;</span></div>
<div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;               <span class="stringliteral">&quot;slice structure modes (%#x).\n&quot;</span>, slice_structure);</div>
<div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EINVAL);</div>
<div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;    }</div>
<div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160; </div>
<div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;}</div>
<div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160; </div>
<div class="line"><a name="l01932"></a><span class="lineno"><a class="line" href="libavcodec_2vaapi__encode_8c.html#a7adac1c136586c62a8d0d94806609e51"> 1932</a></span>&#160;<span class="keyword">static</span> <a class="code" href="attributes_8h.html#abeeb324fff79a5335d36774704e2475c">av_cold</a> <span class="keywordtype">int</span> <a class="code" href="libavcodec_2vaapi__encode_8c.html#a7adac1c136586c62a8d0d94806609e51">vaapi_encode_init_tile_slice_structure</a>(<a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a> *avctx,</div>
<div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;                                                          uint32_t slice_structure)</div>
<div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;{</div>
<div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;    <a class="code" href="struct_v_a_a_p_i_encode_context.html">VAAPIEncodeContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a> = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#af3379123060ad8cc9c321c29af4f8360">priv_data</a>;</div>
<div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>, req_tiles;</div>
<div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160; </div>
<div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;    <span class="keywordflow">if</span> (!(slice_structure &amp; VA_ENC_SLICE_STRUCTURE_ARBITRARY_MACROBLOCKS ||</div>
<div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;         (slice_structure &amp; VA_ENC_SLICE_STRUCTURE_ARBITRARY_ROWS &amp;&amp;</div>
<div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;          <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;tile_cols == 1))) {</div>
<div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Supported slice structure (%#x) doesn&#39;t work for &quot;</span></div>
<div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;               <span class="stringliteral">&quot;current tile requirement.\n&quot;</span>, slice_structure);</div>
<div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EINVAL);</div>
<div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;    }</div>
<div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160; </div>
<div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;tile_rows &gt; <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;slice_block_rows ||</div>
<div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;tile_cols &gt; <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;slice_block_cols) {</div>
<div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga85b57516ca703cc47d9bbe5f4658c716">AV_LOG_WARNING</a>, <span class="stringliteral">&quot;Not enough block rows/cols (%d x %d) &quot;</span></div>
<div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;               <span class="stringliteral">&quot;for configured number of tile (%d x %d); &quot;</span>,</div>
<div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;               <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;slice_block_rows, <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;slice_block_cols,</div>
<div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;               <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;tile_rows, <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;tile_cols);</div>
<div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;tile_rows = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;tile_rows &gt; <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;slice_block_rows ?</div>
<div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;                                          <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;slice_block_rows : <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;tile_rows;</div>
<div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;tile_cols = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;tile_cols &gt; <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;slice_block_cols ?</div>
<div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;                                          <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;slice_block_cols : <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;tile_cols;</div>
<div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga85b57516ca703cc47d9bbe5f4658c716">AV_LOG_WARNING</a>, <span class="stringliteral">&quot;using allowed maximum (%d x %d).\n&quot;</span>,</div>
<div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;               <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;tile_rows, <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;tile_cols);</div>
<div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;    }</div>
<div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160; </div>
<div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;    req_tiles = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;tile_rows * <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;tile_cols;</div>
<div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160; </div>
<div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;    <span class="comment">// Tile slice is not allowed to cross the boundary of a tile due to</span></div>
<div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;    <span class="comment">// the constraints of media-driver. Currently we support one slice</span></div>
<div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;    <span class="comment">// per tile. This could be extended to multiple slices per tile.</span></div>
<div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;    <span class="keywordflow">if</span> (avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#aff4e6a78c0f08be43879644632e04b24">slices</a> != req_tiles)</div>
<div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga85b57516ca703cc47d9bbe5f4658c716">AV_LOG_WARNING</a>, <span class="stringliteral">&quot;The number of requested slices &quot;</span></div>
<div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;               <span class="stringliteral">&quot;mismatches with configured number of tile (%d != %d); &quot;</span></div>
<div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;               <span class="stringliteral">&quot;using requested tile number for slice.\n&quot;</span>,</div>
<div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;               avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#aff4e6a78c0f08be43879644632e04b24">slices</a>, req_tiles);</div>
<div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160; </div>
<div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nb_slices = req_tiles;</div>
<div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160; </div>
<div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;    <span class="comment">// Default in uniform spacing</span></div>
<div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;    <span class="comment">// 6-3, 6-5</span></div>
<div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;tile_cols; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;col_width[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>] = ( <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> + 1 ) * <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;slice_block_cols / <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;tile_cols -</div>
<div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;                                    <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> * <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;slice_block_cols / <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;tile_cols;</div>
<div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;col_bd[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> + 1]  = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;col_bd[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>] + <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;col_width[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;    }</div>
<div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;    <span class="comment">// 6-4, 6-6</span></div>
<div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;tile_rows; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;row_height[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>] = ( <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> + 1 ) * <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;slice_block_rows / <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;tile_rows -</div>
<div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;                                     <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> * <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;slice_block_rows / <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;tile_rows;</div>
<div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;row_bd[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> + 1] = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;row_bd[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>] + <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;row_height[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;    }</div>
<div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160; </div>
<div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga9b58b28e2d429b930b69db19877f76a8">AV_LOG_VERBOSE</a>, <span class="stringliteral">&quot;Encoding pictures with %d x %d tile.\n&quot;</span>,</div>
<div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;           <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;tile_rows, <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;tile_cols);</div>
<div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160; </div>
<div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;}</div>
<div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160; </div>
<div class="line"><a name="l01993"></a><span class="lineno"><a class="line" href="libavcodec_2vaapi__encode_8c.html#aad022021d7b698a82adf938943685c6a"> 1993</a></span>&#160;<span class="keyword">static</span> <a class="code" href="attributes_8h.html#abeeb324fff79a5335d36774704e2475c">av_cold</a> <span class="keywordtype">int</span> <a class="code" href="libavcodec_2vaapi__encode_8c.html#aad022021d7b698a82adf938943685c6a">vaapi_encode_init_slice_structure</a>(<a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a> *avctx)</div>
<div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;{</div>
<div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;    <a class="code" href="struct_v_a_a_p_i_encode_context.html">VAAPIEncodeContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a> = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#af3379123060ad8cc9c321c29af4f8360">priv_data</a>;</div>
<div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;    VAConfigAttrib attr[3] = { { VAConfigAttribEncMaxSlices },</div>
<div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;                               { VAConfigAttribEncSliceStructure },</div>
<div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;<span class="preprocessor">#if VA_CHECK_VERSION(1, 1, 0)</span></div>
<div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;                               { VAConfigAttribEncTileSupport },</div>
<div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;                             };</div>
<div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;    VAStatus vas;</div>
<div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;    uint32_t max_slices, slice_structure;</div>
<div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>;</div>
<div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160; </div>
<div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;    <span class="keywordflow">if</span> (!(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;codec-&gt;<a class="code" href="struct_a_v_format_context.html#a32379cc371463b235d54235d4af06a15">flags</a> &amp; <a class="code" href="vaapi__encode_8h.html#abc6126af1d45847bc59afa0aa3216b04a0bd3695af879bf892f15bfe02355b902">FLAG_SLICE_CONTROL</a>)) {</div>
<div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;        <span class="keywordflow">if</span> (avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#aff4e6a78c0f08be43879644632e04b24">slices</a> &gt; 0) {</div>
<div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga85b57516ca703cc47d9bbe5f4658c716">AV_LOG_WARNING</a>, <span class="stringliteral">&quot;Multiple slices were requested &quot;</span></div>
<div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;                   <span class="stringliteral">&quot;but this codec does not support controlling slices.\n&quot;</span>);</div>
<div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;        }</div>
<div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;    }</div>
<div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160; </div>
<div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;slice_block_rows = (avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a0449afd803eb107bd4dbc8b5ea22e363">height</a> + <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;slice_block_height - 1) /</div>
<div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;                             <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;slice_block_height;</div>
<div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;slice_block_cols = (avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a0d8f46461754e8abea0847dcbc41b956">width</a>  + <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;slice_block_width  - 1) /</div>
<div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;                             <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;slice_block_width;</div>
<div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160; </div>
<div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;    <span class="keywordflow">if</span> (avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#aff4e6a78c0f08be43879644632e04b24">slices</a> &lt;= 1 &amp;&amp; !<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;tile_rows &amp;&amp; !<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;tile_cols) {</div>
<div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nb_slices  = 1;</div>
<div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;slice_size = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;slice_block_rows;</div>
<div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;    }</div>
<div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160; </div>
<div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;    vas = vaGetConfigAttributes(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;hwctx-&gt;display,</div>
<div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;                                <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;va_profile,</div>
<div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;                                <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;va_entrypoint,</div>
<div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;                                attr, <a class="code" href="sinewin__tablegen__template_8c.html#a3508a98d3ee7e2c9a4841fe264cf70f7">FF_ARRAY_ELEMS</a>(attr));</div>
<div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;    <span class="keywordflow">if</span> (vas != VA_STATUS_SUCCESS) {</div>
<div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to query slice &quot;</span></div>
<div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;               <span class="stringliteral">&quot;attributes: %d (%s).\n&quot;</span>, vas, vaErrorStr(vas));</div>
<div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="group__lavu__error.html#ga9c520e483ba8648495620ffdb4c491f2">AVERROR_EXTERNAL</a>;</div>
<div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;    }</div>
<div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;    max_slices      = attr[0].value;</div>
<div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;    slice_structure = attr[1].value;</div>
<div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;    <span class="keywordflow">if</span> (max_slices      == VA_ATTRIB_NOT_SUPPORTED ||</div>
<div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;        slice_structure == VA_ATTRIB_NOT_SUPPORTED) {</div>
<div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Driver does not support encoding &quot;</span></div>
<div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;               <span class="stringliteral">&quot;pictures as multiple slices.\n.&quot;</span>);</div>
<div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EINVAL);</div>
<div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;    }</div>
<div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160; </div>
<div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;tile_rows &amp;&amp; <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;tile_cols) {</div>
<div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;<span class="preprocessor">#if VA_CHECK_VERSION(1, 1, 0)</span></div>
<div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;        uint32_t tile_support = attr[2].value;</div>
<div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;        <span class="keywordflow">if</span> (tile_support == VA_ATTRIB_NOT_SUPPORTED) {</div>
<div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Driver does not support encoding &quot;</span></div>
<div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;                   <span class="stringliteral">&quot;pictures as multiple tiles.\n.&quot;</span>);</div>
<div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EINVAL);</div>
<div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;        }</div>
<div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Tile encoding option is &quot;</span></div>
<div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;            <span class="stringliteral">&quot;not supported with this VAAPI version.\n&quot;</span>);</div>
<div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EINVAL);</div>
<div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;    }</div>
<div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160; </div>
<div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;tile_rows &amp;&amp; <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;tile_cols)</div>
<div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;        <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = <a class="code" href="libavcodec_2vaapi__encode_8c.html#a7adac1c136586c62a8d0d94806609e51">vaapi_encode_init_tile_slice_structure</a>(avctx, slice_structure);</div>
<div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;        <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = <a class="code" href="libavcodec_2vaapi__encode_8c.html#a4c251c181207b0fa4a94cdc25a2f450a">vaapi_encode_init_row_slice_structure</a>(avctx, slice_structure);</div>
<div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> &lt; 0)</div>
<div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>;</div>
<div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160; </div>
<div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nb_slices &gt; avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#aff4e6a78c0f08be43879644632e04b24">slices</a>) {</div>
<div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga85b57516ca703cc47d9bbe5f4658c716">AV_LOG_WARNING</a>, <span class="stringliteral">&quot;Slice count rounded up to &quot;</span></div>
<div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;               <span class="stringliteral">&quot;%d (from %d) due to driver constraints on slice &quot;</span></div>
<div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;               <span class="stringliteral">&quot;structure.\n&quot;</span>, <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nb_slices, avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#aff4e6a78c0f08be43879644632e04b24">slices</a>);</div>
<div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;    }</div>
<div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nb_slices &gt; max_slices) {</div>
<div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Driver does not support &quot;</span></div>
<div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;               <span class="stringliteral">&quot;encoding with %d slices (max %&quot;</span>PRIu32<span class="stringliteral">&quot;).\n&quot;</span>,</div>
<div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;               <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nb_slices, max_slices);</div>
<div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EINVAL);</div>
<div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;    }</div>
<div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160; </div>
<div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga9b58b28e2d429b930b69db19877f76a8">AV_LOG_VERBOSE</a>, <span class="stringliteral">&quot;Encoding pictures with %d slices.\n&quot;</span>,</div>
<div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;           <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nb_slices);</div>
<div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;}</div>
<div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160; </div>
<div class="line"><a name="l02082"></a><span class="lineno"><a class="line" href="libavcodec_2vaapi__encode_8c.html#af3ded04664e4b3943d78b437ad7bd1db"> 2082</a></span>&#160;<span class="keyword">static</span> <a class="code" href="attributes_8h.html#abeeb324fff79a5335d36774704e2475c">av_cold</a> <span class="keywordtype">int</span> <a class="code" href="libavcodec_2vaapi__encode_8c.html#af3ded04664e4b3943d78b437ad7bd1db">vaapi_encode_init_packed_headers</a>(<a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a> *avctx)</div>
<div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;{</div>
<div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;    <a class="code" href="struct_v_a_a_p_i_encode_context.html">VAAPIEncodeContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a> = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#af3379123060ad8cc9c321c29af4f8360">priv_data</a>;</div>
<div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;    VAStatus vas;</div>
<div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;    VAConfigAttrib attr = { VAConfigAttribEncPackedHeaders };</div>
<div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160; </div>
<div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;    vas = vaGetConfigAttributes(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;hwctx-&gt;display,</div>
<div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;                                <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;va_profile,</div>
<div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;                                <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;va_entrypoint,</div>
<div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;                                &amp;attr, 1);</div>
<div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;    <span class="keywordflow">if</span> (vas != VA_STATUS_SUCCESS) {</div>
<div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to query packed headers &quot;</span></div>
<div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;               <span class="stringliteral">&quot;attribute: %d (%s).\n&quot;</span>, vas, vaErrorStr(vas));</div>
<div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="group__lavu__error.html#ga9c520e483ba8648495620ffdb4c491f2">AVERROR_EXTERNAL</a>;</div>
<div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;    }</div>
<div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160; </div>
<div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;    <span class="keywordflow">if</span> (attr.value == VA_ATTRIB_NOT_SUPPORTED) {</div>
<div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;desired_packed_headers) {</div>
<div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga85b57516ca703cc47d9bbe5f4658c716">AV_LOG_WARNING</a>, <span class="stringliteral">&quot;Driver does not support any &quot;</span></div>
<div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;                   <span class="stringliteral">&quot;packed headers (wanted %#x).\n&quot;</span>,</div>
<div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;                   <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;desired_packed_headers);</div>
<div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga9b58b28e2d429b930b69db19877f76a8">AV_LOG_VERBOSE</a>, <span class="stringliteral">&quot;Driver does not support any &quot;</span></div>
<div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;                   <span class="stringliteral">&quot;packed headers (none wanted).\n&quot;</span>);</div>
<div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;        }</div>
<div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;va_packed_headers = 0;</div>
<div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;desired_packed_headers &amp; ~attr.value) {</div>
<div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga85b57516ca703cc47d9bbe5f4658c716">AV_LOG_WARNING</a>, <span class="stringliteral">&quot;Driver does not support some &quot;</span></div>
<div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;                   <span class="stringliteral">&quot;wanted packed headers (wanted %#x, found %#x).\n&quot;</span>,</div>
<div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;                   <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;desired_packed_headers, attr.value);</div>
<div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga9b58b28e2d429b930b69db19877f76a8">AV_LOG_VERBOSE</a>, <span class="stringliteral">&quot;All wanted packed headers &quot;</span></div>
<div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;                   <span class="stringliteral">&quot;available (wanted %#x, found %#x).\n&quot;</span>,</div>
<div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;                   <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;desired_packed_headers, attr.value);</div>
<div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;        }</div>
<div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;va_packed_headers = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;desired_packed_headers &amp; attr.value;</div>
<div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;    }</div>
<div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160; </div>
<div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;va_packed_headers) {</div>
<div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;config_attributes[<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nb_config_attributes++] =</div>
<div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;            (VAConfigAttrib) {</div>
<div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;            .type  = VAConfigAttribEncPackedHeaders,</div>
<div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;            .value = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;va_packed_headers,</div>
<div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;        };</div>
<div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;    }</div>
<div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160; </div>
<div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;    <span class="keywordflow">if</span> ( (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;desired_packed_headers &amp; VA_ENC_PACKED_HEADER_SEQUENCE) &amp;&amp;</div>
<div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;        !(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;va_packed_headers      &amp; VA_ENC_PACKED_HEADER_SEQUENCE) &amp;&amp;</div>
<div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;         (avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#abb01e291550fa3fb96188af4d494587e">flags</a> &amp; <a class="code" href="group__lavc__core.html#ga9ed82634c59b339786575827c47a8f68">AV_CODEC_FLAG_GLOBAL_HEADER</a>)) {</div>
<div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga85b57516ca703cc47d9bbe5f4658c716">AV_LOG_WARNING</a>, <span class="stringliteral">&quot;Driver does not support packed &quot;</span></div>
<div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;               <span class="stringliteral">&quot;sequence headers, but a global header is requested.\n&quot;</span>);</div>
<div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga85b57516ca703cc47d9bbe5f4658c716">AV_LOG_WARNING</a>, <span class="stringliteral">&quot;No global header will be written: &quot;</span></div>
<div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;               <span class="stringliteral">&quot;this may result in a stream which is not usable for some &quot;</span></div>
<div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;               <span class="stringliteral">&quot;purposes (e.g. not muxable to some containers).\n&quot;</span>);</div>
<div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;    }</div>
<div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160; </div>
<div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;}</div>
<div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160; </div>
<div class="line"><a name="l02142"></a><span class="lineno"><a class="line" href="libavcodec_2vaapi__encode_8c.html#a5d0faa2fc51c873f9df92b0e5f23769c"> 2142</a></span>&#160;<span class="keyword">static</span> <a class="code" href="attributes_8h.html#abeeb324fff79a5335d36774704e2475c">av_cold</a> <span class="keywordtype">int</span> <a class="code" href="libavcodec_2vaapi__encode_8c.html#a5d0faa2fc51c873f9df92b0e5f23769c">vaapi_encode_init_quality</a>(<a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a> *avctx)</div>
<div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;{</div>
<div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;<span class="preprocessor">#if VA_CHECK_VERSION(0, 36, 0)</span></div>
<div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;    <a class="code" href="struct_v_a_a_p_i_encode_context.html">VAAPIEncodeContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a> = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#af3379123060ad8cc9c321c29af4f8360">priv_data</a>;</div>
<div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;    VAStatus vas;</div>
<div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;    VAConfigAttrib attr = { VAConfigAttribEncQualityRange };</div>
<div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="rate__distortion_8txt.html#a098873585d16d8a7349bd6424684d45c">quality</a> = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#aa401ca663644caa51ede1889659c23d6">compression_level</a>;</div>
<div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160; </div>
<div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;    vas = vaGetConfigAttributes(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;hwctx-&gt;display,</div>
<div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;                                <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;va_profile,</div>
<div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;                                <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;va_entrypoint,</div>
<div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;                                &amp;attr, 1);</div>
<div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;    <span class="keywordflow">if</span> (vas != VA_STATUS_SUCCESS) {</div>
<div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to query quality &quot;</span></div>
<div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;               <span class="stringliteral">&quot;config attribute: %d (%s).\n&quot;</span>, vas, vaErrorStr(vas));</div>
<div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="group__lavu__error.html#ga9c520e483ba8648495620ffdb4c491f2">AVERROR_EXTERNAL</a>;</div>
<div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;    }</div>
<div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160; </div>
<div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;    <span class="keywordflow">if</span> (attr.value == VA_ATTRIB_NOT_SUPPORTED) {</div>
<div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="rate__distortion_8txt.html#a098873585d16d8a7349bd6424684d45c">quality</a> != 0) {</div>
<div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga85b57516ca703cc47d9bbe5f4658c716">AV_LOG_WARNING</a>, <span class="stringliteral">&quot;Quality attribute is not &quot;</span></div>
<div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;                   <span class="stringliteral">&quot;supported: will use default quality level.\n&quot;</span>);</div>
<div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;        }</div>
<div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="rate__distortion_8txt.html#a098873585d16d8a7349bd6424684d45c">quality</a> &gt; attr.value) {</div>
<div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga85b57516ca703cc47d9bbe5f4658c716">AV_LOG_WARNING</a>, <span class="stringliteral">&quot;Invalid quality level: &quot;</span></div>
<div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;                   <span class="stringliteral">&quot;valid range is 0-%d, using %d.\n&quot;</span>,</div>
<div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;                   attr.value, attr.value);</div>
<div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;            <a class="code" href="rate__distortion_8txt.html#a098873585d16d8a7349bd6424684d45c">quality</a> = attr.value;</div>
<div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;        }</div>
<div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160; </div>
<div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;quality_params = (VAEncMiscParameterBufferQualityLevel) {</div>
<div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;            .quality_level = <a class="code" href="rate__distortion_8txt.html#a098873585d16d8a7349bd6424684d45c">quality</a>,</div>
<div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;        };</div>
<div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;        <a class="code" href="libavcodec_2vaapi__encode_8c.html#a5c62d3b58fc2a9ef2511250f2745452a">vaapi_encode_add_global_param</a>(avctx,</div>
<div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;                                      VAEncMiscParameterTypeQualityLevel,</div>
<div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;                                      &amp;<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;quality_params,</div>
<div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;                                      <span class="keyword">sizeof</span>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;quality_params));</div>
<div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;    }</div>
<div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga85b57516ca703cc47d9bbe5f4658c716">AV_LOG_WARNING</a>, <span class="stringliteral">&quot;The encode quality option is &quot;</span></div>
<div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;           <span class="stringliteral">&quot;not supported with this VAAPI version.\n&quot;</span>);</div>
<div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160; </div>
<div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;}</div>
<div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160; </div>
<div class="line"><a name="l02189"></a><span class="lineno"><a class="line" href="libavcodec_2vaapi__encode_8c.html#a8deb9c25c3e1b7fa3ab897ee059d4fba"> 2189</a></span>&#160;<span class="keyword">static</span> <a class="code" href="attributes_8h.html#abeeb324fff79a5335d36774704e2475c">av_cold</a> <span class="keywordtype">int</span> <a class="code" href="libavcodec_2vaapi__encode_8c.html#a8deb9c25c3e1b7fa3ab897ee059d4fba">vaapi_encode_init_roi</a>(<a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a> *avctx)</div>
<div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;{</div>
<div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;<span class="preprocessor">#if VA_CHECK_VERSION(1, 0, 0)</span></div>
<div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;    <a class="code" href="struct_v_a_a_p_i_encode_context.html">VAAPIEncodeContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a> = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#af3379123060ad8cc9c321c29af4f8360">priv_data</a>;</div>
<div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;    VAStatus vas;</div>
<div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;    VAConfigAttrib attr = { VAConfigAttribEncROI };</div>
<div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160; </div>
<div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;    vas = vaGetConfigAttributes(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;hwctx-&gt;display,</div>
<div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;                                <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;va_profile,</div>
<div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;                                <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;va_entrypoint,</div>
<div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;                                &amp;attr, 1);</div>
<div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;    <span class="keywordflow">if</span> (vas != VA_STATUS_SUCCESS) {</div>
<div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to query ROI &quot;</span></div>
<div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;               <span class="stringliteral">&quot;config attribute: %d (%s).\n&quot;</span>, vas, vaErrorStr(vas));</div>
<div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="group__lavu__error.html#ga9c520e483ba8648495620ffdb4c491f2">AVERROR_EXTERNAL</a>;</div>
<div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;    }</div>
<div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160; </div>
<div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;    <span class="keywordflow">if</span> (attr.value == VA_ATTRIB_NOT_SUPPORTED) {</div>
<div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;roi_allowed = 0;</div>
<div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;        VAConfigAttribValEncROI roi = {</div>
<div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;            .value = attr.value,</div>
<div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;        };</div>
<div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160; </div>
<div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;roi_max_regions = roi.bits.num_roi_regions;</div>
<div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;roi_allowed = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;roi_max_regions &gt; 0 &amp;&amp;</div>
<div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;            (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;va_rc_mode == VA_RC_CQP ||</div>
<div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;             roi.bits.roi_rc_qp_delta_support);</div>
<div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;    }</div>
<div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;}</div>
<div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160; </div>
<div class="line"><a name="l02222"></a><span class="lineno"><a class="line" href="libavcodec_2vaapi__encode_8c.html#aa76fb15aa754ab120b139f4e6fd362ba"> 2222</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="libavcodec_2vaapi__encode_8c.html#aa76fb15aa754ab120b139f4e6fd362ba">vaapi_encode_free_output_buffer</a>(<span class="keywordtype">void</span> *opaque,</div>
<div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;                                            <a class="code" href="audio__convert_8c.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> *<a class="code" href="mxf_8c.html#a084824fc871e38157790c99ae1240842">data</a>)</div>
<div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;{</div>
<div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;    <a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a>   *avctx = opaque;</div>
<div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;    <a class="code" href="struct_v_a_a_p_i_encode_context.html">VAAPIEncodeContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a> = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#af3379123060ad8cc9c321c29af4f8360">priv_data</a>;</div>
<div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;    VABufferID buffer_id;</div>
<div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160; </div>
<div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;    buffer_id = (VABufferID)(uintptr_t)<a class="code" href="mxf_8c.html#a084824fc871e38157790c99ae1240842">data</a>;</div>
<div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160; </div>
<div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;    vaDestroyBuffer(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;hwctx-&gt;display, buffer_id);</div>
<div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160; </div>
<div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga5b7221c3afd06848486776bd834a58a5">AV_LOG_DEBUG</a>, <span class="stringliteral">&quot;Freed output buffer %#x\n&quot;</span>, buffer_id);</div>
<div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;}</div>
<div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160; </div>
<div class="line"><a name="l02236"></a><span class="lineno"><a class="line" href="libavcodec_2vaapi__encode_8c.html#a202ea7fe1efd977171c4dce7eab2f445"> 2236</a></span>&#160;<span class="keyword">static</span> <a class="code" href="struct_a_v_buffer_ref.html">AVBufferRef</a> *<a class="code" href="libavcodec_2vaapi__encode_8c.html#a202ea7fe1efd977171c4dce7eab2f445">vaapi_encode_alloc_output_buffer</a>(<span class="keywordtype">void</span> *opaque,</div>
<div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;                                                     <span class="keywordtype">int</span> <a class="code" href="group__lavu__mem__funcs.html#ga34e10fdac079a9ca4512b8ccd7f20b8a">size</a>)</div>
<div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;{</div>
<div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;    <a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a>   *avctx = opaque;</div>
<div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;    <a class="code" href="struct_v_a_a_p_i_encode_context.html">VAAPIEncodeContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a> = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#af3379123060ad8cc9c321c29af4f8360">priv_data</a>;</div>
<div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;    VABufferID buffer_id;</div>
<div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;    VAStatus vas;</div>
<div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160;    <a class="code" href="struct_a_v_buffer_ref.html">AVBufferRef</a> *<a class="code" href="tests_2jpeg2000dwt_8c.html#a5cabdd8be5af41f675fed06498e094b7">ref</a>;</div>
<div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160; </div>
<div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;    <span class="comment">// The output buffer size is fixed, so it needs to be large enough</span></div>
<div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160;    <span class="comment">// to hold the largest possible compressed frame.  We assume here</span></div>
<div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;    <span class="comment">// that the uncompressed frame plus some header data is an upper</span></div>
<div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160;    <span class="comment">// bound on that.</span></div>
<div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;    vas = vaCreateBuffer(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;hwctx-&gt;display, <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;va_context,</div>
<div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160;                         VAEncCodedBufferType,</div>
<div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;                         3 * <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;surface_width * <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;surface_height +</div>
<div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;                         (1 &lt;&lt; 16), 1, 0, &amp;buffer_id);</div>
<div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;    <span class="keywordflow">if</span> (vas != VA_STATUS_SUCCESS) {</div>
<div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to create bitstream &quot;</span></div>
<div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;               <span class="stringliteral">&quot;output buffer: %d (%s).\n&quot;</span>, vas, vaErrorStr(vas));</div>
<div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;    }</div>
<div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160; </div>
<div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga5b7221c3afd06848486776bd834a58a5">AV_LOG_DEBUG</a>, <span class="stringliteral">&quot;Allocated output buffer %#x\n&quot;</span>, buffer_id);</div>
<div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160; </div>
<div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;    <a class="code" href="tests_2jpeg2000dwt_8c.html#a5cabdd8be5af41f675fed06498e094b7">ref</a> = <a class="code" href="group__lavu__buffer.html#ga3e7f4c92db85ccba0b2a16dd0069842a">av_buffer_create</a>((<a class="code" href="audio__convert_8c.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a>*)(uintptr_t)buffer_id,</div>
<div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;                           <span class="keyword">sizeof</span>(buffer_id),</div>
<div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160;                           &amp;<a class="code" href="libavcodec_2vaapi__encode_8c.html#aa76fb15aa754ab120b139f4e6fd362ba">vaapi_encode_free_output_buffer</a>,</div>
<div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;                           avctx, <a class="code" href="group__lavu__buffer.html#gaa818f8f1011d69acc50c1f29cb85e576">AV_BUFFER_FLAG_READONLY</a>);</div>
<div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="tests_2jpeg2000dwt_8c.html#a5cabdd8be5af41f675fed06498e094b7">ref</a>) {</div>
<div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160;        vaDestroyBuffer(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;hwctx-&gt;display, buffer_id);</div>
<div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;    }</div>
<div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160; </div>
<div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="tests_2jpeg2000dwt_8c.html#a5cabdd8be5af41f675fed06498e094b7">ref</a>;</div>
<div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;}</div>
<div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160; </div>
<div class="line"><a name="l02273"></a><span class="lineno"><a class="line" href="libavcodec_2vaapi__encode_8c.html#a0c77b63d3a425bbc13899110282edb13"> 2273</a></span>&#160;<span class="keyword">static</span> <a class="code" href="attributes_8h.html#abeeb324fff79a5335d36774704e2475c">av_cold</a> <span class="keywordtype">int</span> <a class="code" href="libavcodec_2vaapi__encode_8c.html#a0c77b63d3a425bbc13899110282edb13">vaapi_encode_create_recon_frames</a>(<a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a> *avctx)</div>
<div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;{</div>
<div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160;    <a class="code" href="struct_v_a_a_p_i_encode_context.html">VAAPIEncodeContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a> = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#af3379123060ad8cc9c321c29af4f8360">priv_data</a>;</div>
<div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;    <a class="code" href="struct_a_v_v_a_a_p_i_h_w_config.html">AVVAAPIHWConfig</a> *hwconfig = <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;    <a class="code" href="struct_a_v_h_w_frames_constraints.html">AVHWFramesConstraints</a> *constraints = <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;    <span class="keyword">enum</span> <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5">AVPixelFormat</a> recon_format;</div>
<div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;    <span class="keywordtype">int</span> err, <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div>
<div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160; </div>
<div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;    hwconfig = <a class="code" href="hwcontext_8c.html#aaac4b2ed559ba36ce8c8cdfa9ce20d43">av_hwdevice_hwconfig_alloc</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;device_ref);</div>
<div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;    <span class="keywordflow">if</span> (!hwconfig) {</div>
<div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;        err = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160;    }</div>
<div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;    hwconfig-&gt;<a class="code" href="struct_a_v_v_a_a_p_i_h_w_config.html#a0ecea446600eeb1b7e93733317adbc98">config_id</a> = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;va_config;</div>
<div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160; </div>
<div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;    constraints = <a class="code" href="hwcontext_8c.html#a80f4c1184e1758150b6d9bc0adf2c1df">av_hwdevice_get_hwframe_constraints</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;device_ref,</div>
<div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;                                                      hwconfig);</div>
<div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;    <span class="keywordflow">if</span> (!constraints) {</div>
<div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;        err = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;    }</div>
<div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160; </div>
<div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;    <span class="comment">// Probably we can use the input surface format as the surface format</span></div>
<div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;    <span class="comment">// of the reconstructed frames.  If not, we just pick the first (only?)</span></div>
<div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;    <span class="comment">// format in the valid list and hope that it all works.</span></div>
<div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160;    recon_format = <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a0e08f8a5d0fa21c3e258816a9dcce7c3">AV_PIX_FMT_NONE</a>;</div>
<div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;    <span class="keywordflow">if</span> (constraints-&gt;<a class="code" href="struct_a_v_h_w_frames_constraints.html#aabea88093c6f85d6185ffb0852a2217f">valid_sw_formats</a>) {</div>
<div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; constraints-&gt;<a class="code" href="struct_a_v_h_w_frames_constraints.html#aabea88093c6f85d6185ffb0852a2217f">valid_sw_formats</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>] != <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a0e08f8a5d0fa21c3e258816a9dcce7c3">AV_PIX_FMT_NONE</a>; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;input_frames-&gt;sw_format ==</div>
<div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;                constraints-&gt;<a class="code" href="struct_a_v_h_w_frames_constraints.html#aabea88093c6f85d6185ffb0852a2217f">valid_sw_formats</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>]) {</div>
<div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;                recon_format = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;input_frames-&gt;sw_format;</div>
<div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160;            }</div>
<div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160;        }</div>
<div class="line"><a name="l02307"></a><span class="lineno"> 2307</span>&#160;        <span class="keywordflow">if</span> (recon_format == <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a0e08f8a5d0fa21c3e258816a9dcce7c3">AV_PIX_FMT_NONE</a>) {</div>
<div class="line"><a name="l02308"></a><span class="lineno"> 2308</span>&#160;            <span class="comment">// No match.  Just use the first in the supported list and</span></div>
<div class="line"><a name="l02309"></a><span class="lineno"> 2309</span>&#160;            <span class="comment">// hope for the best.</span></div>
<div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;            recon_format = constraints-&gt;<a class="code" href="struct_a_v_h_w_frames_constraints.html#aabea88093c6f85d6185ffb0852a2217f">valid_sw_formats</a>[0];</div>
<div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160;        }</div>
<div class="line"><a name="l02312"></a><span class="lineno"> 2312</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02313"></a><span class="lineno"> 2313</span>&#160;        <span class="comment">// No idea what to use; copy input format.</span></div>
<div class="line"><a name="l02314"></a><span class="lineno"> 2314</span>&#160;        recon_format = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;input_frames-&gt;sw_format;</div>
<div class="line"><a name="l02315"></a><span class="lineno"> 2315</span>&#160;    }</div>
<div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga5b7221c3afd06848486776bd834a58a5">AV_LOG_DEBUG</a>, <span class="stringliteral">&quot;Using %s as format of &quot;</span></div>
<div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160;           <span class="stringliteral">&quot;reconstructed frames.\n&quot;</span>, <a class="code" href="pixdesc_8c.html#ab92e2a8a9b58c982560c49df9f01e47e">av_get_pix_fmt_name</a>(recon_format));</div>
<div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160; </div>
<div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;surface_width  &lt; constraints-&gt;<a class="code" href="struct_a_v_h_w_frames_constraints.html#af220776925452091085139081d5d7251">min_width</a>  ||</div>
<div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;surface_height &lt; constraints-&gt;<a class="code" href="struct_a_v_h_w_frames_constraints.html#a3f1aec6d1c90f77837875c2a3598be46">min_height</a> ||</div>
<div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;surface_width  &gt; constraints-&gt;<a class="code" href="struct_a_v_h_w_frames_constraints.html#a34e06e3397af2b83de9d78f893bf4168">max_width</a> ||</div>
<div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;surface_height &gt; constraints-&gt;<a class="code" href="struct_a_v_h_w_frames_constraints.html#af5d3a683727f7b92abca7b7114d4e15c">max_height</a>) {</div>
<div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Hardware does not support encoding at &quot;</span></div>
<div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160;               <span class="stringliteral">&quot;size %dx%d (constraints: width %d-%d height %d-%d).\n&quot;</span>,</div>
<div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160;               <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;surface_width, <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;surface_height,</div>
<div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;               constraints-&gt;<a class="code" href="struct_a_v_h_w_frames_constraints.html#af220776925452091085139081d5d7251">min_width</a>,  constraints-&gt;<a class="code" href="struct_a_v_h_w_frames_constraints.html#a34e06e3397af2b83de9d78f893bf4168">max_width</a>,</div>
<div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160;               constraints-&gt;<a class="code" href="struct_a_v_h_w_frames_constraints.html#a3f1aec6d1c90f77837875c2a3598be46">min_height</a>, constraints-&gt;<a class="code" href="struct_a_v_h_w_frames_constraints.html#af5d3a683727f7b92abca7b7114d4e15c">max_height</a>);</div>
<div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160;        err = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EINVAL);</div>
<div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l02330"></a><span class="lineno"> 2330</span>&#160;    }</div>
<div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160; </div>
<div class="line"><a name="l02332"></a><span class="lineno"> 2332</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#adba82e1bcd02de510a858fcbedf79ef1">av_freep</a>(&amp;hwconfig);</div>
<div class="line"><a name="l02333"></a><span class="lineno"> 2333</span>&#160;    <a class="code" href="hwcontext_8c.html#a29da7fa7ffa73266d1cbfccb116ed634">av_hwframe_constraints_free</a>(&amp;constraints);</div>
<div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160; </div>
<div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;recon_frames_ref = <a class="code" href="hwcontext_8c.html#ac45a7c039eb4e084b692f69ff5f2e217">av_hwframe_ctx_alloc</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;device_ref);</div>
<div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;recon_frames_ref) {</div>
<div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;        err = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l02338"></a><span class="lineno"> 2338</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l02339"></a><span class="lineno"> 2339</span>&#160;    }</div>
<div class="line"><a name="l02340"></a><span class="lineno"> 2340</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;recon_frames = (<a class="code" href="struct_a_v_h_w_frames_context.html">AVHWFramesContext</a>*)<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;recon_frames_ref-&gt;data;</div>
<div class="line"><a name="l02341"></a><span class="lineno"> 2341</span>&#160; </div>
<div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;recon_frames-&gt;format    = <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5abb09cadf3b2d6b5ce5980401bcf638a8">AV_PIX_FMT_VAAPI</a>;</div>
<div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;recon_frames-&gt;sw_format = recon_format;</div>
<div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;recon_frames-&gt;width     = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;surface_width;</div>
<div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;recon_frames-&gt;height    = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;surface_height;</div>
<div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160; </div>
<div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;    err = <a class="code" href="hwcontext_8c.html#a66a7e1ebc7e459ce07d3de6639ac7e38">av_hwframe_ctx_init</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;recon_frames_ref);</div>
<div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160;    <span class="keywordflow">if</span> (err &lt; 0) {</div>
<div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to initialise reconstructed &quot;</span></div>
<div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160;               <span class="stringliteral">&quot;frame context: %d.\n&quot;</span>, err);</div>
<div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;    }</div>
<div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160; </div>
<div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160;    err = 0;</div>
<div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;  <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>:</div>
<div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#adba82e1bcd02de510a858fcbedf79ef1">av_freep</a>(&amp;hwconfig);</div>
<div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160;    <a class="code" href="hwcontext_8c.html#a29da7fa7ffa73266d1cbfccb116ed634">av_hwframe_constraints_free</a>(&amp;constraints);</div>
<div class="line"><a name="l02358"></a><span class="lineno"> 2358</span>&#160;    <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l02359"></a><span class="lineno"> 2359</span>&#160;}</div>
<div class="line"><a name="l02360"></a><span class="lineno"> 2360</span>&#160; </div>
<div class="line"><a name="l02361"></a><span class="lineno"><a class="line" href="vaapi__encode_8h.html#a227c6571de56a4396a38af663010c6ee"> 2361</a></span>&#160;<a class="code" href="attributes_8h.html#abeeb324fff79a5335d36774704e2475c">av_cold</a> <span class="keywordtype">int</span> <a class="code" href="libavcodec_2vaapi__encode_8c.html#ab55f58e120cb3bc6c0c7ab82385bc6d1">ff_vaapi_encode_init</a>(<a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a> *avctx)</div>
<div class="line"><a name="l02362"></a><span class="lineno"> 2362</span>&#160;{</div>
<div class="line"><a name="l02363"></a><span class="lineno"> 2363</span>&#160;    <a class="code" href="struct_v_a_a_p_i_encode_context.html">VAAPIEncodeContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a> = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#af3379123060ad8cc9c321c29af4f8360">priv_data</a>;</div>
<div class="line"><a name="l02364"></a><span class="lineno"> 2364</span>&#160;    <a class="code" href="struct_a_v_v_a_a_p_i_frames_context.html">AVVAAPIFramesContext</a> *recon_hwctx = <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l02365"></a><span class="lineno"> 2365</span>&#160;    VAStatus vas;</div>
<div class="line"><a name="l02366"></a><span class="lineno"> 2366</span>&#160;    <span class="keywordtype">int</span> err;</div>
<div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160; </div>
<div class="line"><a name="l02368"></a><span class="lineno"> 2368</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;frame = <a class="code" href="group__lavu__frame.html#gac700017c5270c79c1e1befdeeb008b2f">av_frame_alloc</a>();</div>
<div class="line"><a name="l02369"></a><span class="lineno"> 2369</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;frame) {</div>
<div class="line"><a name="l02370"></a><span class="lineno"> 2370</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l02371"></a><span class="lineno"> 2371</span>&#160;    }</div>
<div class="line"><a name="l02372"></a><span class="lineno"> 2372</span>&#160; </div>
<div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160;    <span class="keywordflow">if</span> (!avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a3bac44bb0b016ab838780cc19ac277d6">hw_frames_ctx</a>) {</div>
<div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;A hardware frames reference is &quot;</span></div>
<div class="line"><a name="l02375"></a><span class="lineno"> 2375</span>&#160;               <span class="stringliteral">&quot;required to associate the encoding device.\n&quot;</span>);</div>
<div class="line"><a name="l02376"></a><span class="lineno"> 2376</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EINVAL);</div>
<div class="line"><a name="l02377"></a><span class="lineno"> 2377</span>&#160;    }</div>
<div class="line"><a name="l02378"></a><span class="lineno"> 2378</span>&#160; </div>
<div class="line"><a name="l02379"></a><span class="lineno"> 2379</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;va_config  = VA_INVALID_ID;</div>
<div class="line"><a name="l02380"></a><span class="lineno"> 2380</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;va_context = VA_INVALID_ID;</div>
<div class="line"><a name="l02381"></a><span class="lineno"> 2381</span>&#160; </div>
<div class="line"><a name="l02382"></a><span class="lineno"> 2382</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;input_frames_ref = <a class="code" href="group__lavu__buffer.html#gaa40ce7d3ede946a89d03323bbd7268c1">av_buffer_ref</a>(avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a3bac44bb0b016ab838780cc19ac277d6">hw_frames_ctx</a>);</div>
<div class="line"><a name="l02383"></a><span class="lineno"> 2383</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;input_frames_ref) {</div>
<div class="line"><a name="l02384"></a><span class="lineno"> 2384</span>&#160;        err = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l02385"></a><span class="lineno"> 2385</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l02386"></a><span class="lineno"> 2386</span>&#160;    }</div>
<div class="line"><a name="l02387"></a><span class="lineno"> 2387</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;input_frames = (<a class="code" href="struct_a_v_h_w_frames_context.html">AVHWFramesContext</a>*)<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;input_frames_ref-&gt;data;</div>
<div class="line"><a name="l02388"></a><span class="lineno"> 2388</span>&#160; </div>
<div class="line"><a name="l02389"></a><span class="lineno"> 2389</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;device_ref = <a class="code" href="group__lavu__buffer.html#gaa40ce7d3ede946a89d03323bbd7268c1">av_buffer_ref</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;input_frames-&gt;device_ref);</div>
<div class="line"><a name="l02390"></a><span class="lineno"> 2390</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;device_ref) {</div>
<div class="line"><a name="l02391"></a><span class="lineno"> 2391</span>&#160;        err = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l02392"></a><span class="lineno"> 2392</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l02393"></a><span class="lineno"> 2393</span>&#160;    }</div>
<div class="line"><a name="l02394"></a><span class="lineno"> 2394</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;device = (<a class="code" href="struct_a_v_h_w_device_context.html">AVHWDeviceContext</a>*)<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;device_ref-&gt;data;</div>
<div class="line"><a name="l02395"></a><span class="lineno"> 2395</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;hwctx = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;device-&gt;hwctx;</div>
<div class="line"><a name="l02396"></a><span class="lineno"> 2396</span>&#160; </div>
<div class="line"><a name="l02397"></a><span class="lineno"> 2397</span>&#160;    err = <a class="code" href="libavcodec_2vaapi__encode_8c.html#a56b623f757fbe8f192a9cef3d30b4e0a">vaapi_encode_profile_entrypoint</a>(avctx);</div>
<div class="line"><a name="l02398"></a><span class="lineno"> 2398</span>&#160;    <span class="keywordflow">if</span> (err &lt; 0)</div>
<div class="line"><a name="l02399"></a><span class="lineno"> 2399</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l02400"></a><span class="lineno"> 2400</span>&#160; </div>
<div class="line"><a name="l02401"></a><span class="lineno"> 2401</span>&#160;    err = <a class="code" href="libavcodec_2vaapi__encode_8c.html#a23d840a141775ab2176725b6a5d59f26">vaapi_encode_init_rate_control</a>(avctx);</div>
<div class="line"><a name="l02402"></a><span class="lineno"> 2402</span>&#160;    <span class="keywordflow">if</span> (err &lt; 0)</div>
<div class="line"><a name="l02403"></a><span class="lineno"> 2403</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l02404"></a><span class="lineno"> 2404</span>&#160; </div>
<div class="line"><a name="l02405"></a><span class="lineno"> 2405</span>&#160;    err = <a class="code" href="libavcodec_2vaapi__encode_8c.html#ae0dfaf8475c426d4d3732e0f78f3fdf1">vaapi_encode_init_gop_structure</a>(avctx);</div>
<div class="line"><a name="l02406"></a><span class="lineno"> 2406</span>&#160;    <span class="keywordflow">if</span> (err &lt; 0)</div>
<div class="line"><a name="l02407"></a><span class="lineno"> 2407</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l02408"></a><span class="lineno"> 2408</span>&#160; </div>
<div class="line"><a name="l02409"></a><span class="lineno"> 2409</span>&#160;    err = <a class="code" href="libavcodec_2vaapi__encode_8c.html#aad022021d7b698a82adf938943685c6a">vaapi_encode_init_slice_structure</a>(avctx);</div>
<div class="line"><a name="l02410"></a><span class="lineno"> 2410</span>&#160;    <span class="keywordflow">if</span> (err &lt; 0)</div>
<div class="line"><a name="l02411"></a><span class="lineno"> 2411</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l02412"></a><span class="lineno"> 2412</span>&#160; </div>
<div class="line"><a name="l02413"></a><span class="lineno"> 2413</span>&#160;    err = <a class="code" href="libavcodec_2vaapi__encode_8c.html#af3ded04664e4b3943d78b437ad7bd1db">vaapi_encode_init_packed_headers</a>(avctx);</div>
<div class="line"><a name="l02414"></a><span class="lineno"> 2414</span>&#160;    <span class="keywordflow">if</span> (err &lt; 0)</div>
<div class="line"><a name="l02415"></a><span class="lineno"> 2415</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l02416"></a><span class="lineno"> 2416</span>&#160; </div>
<div class="line"><a name="l02417"></a><span class="lineno"> 2417</span>&#160;    err = <a class="code" href="libavcodec_2vaapi__encode_8c.html#a8deb9c25c3e1b7fa3ab897ee059d4fba">vaapi_encode_init_roi</a>(avctx);</div>
<div class="line"><a name="l02418"></a><span class="lineno"> 2418</span>&#160;    <span class="keywordflow">if</span> (err &lt; 0)</div>
<div class="line"><a name="l02419"></a><span class="lineno"> 2419</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l02420"></a><span class="lineno"> 2420</span>&#160; </div>
<div class="line"><a name="l02421"></a><span class="lineno"> 2421</span>&#160;    <span class="keywordflow">if</span> (avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#aa401ca663644caa51ede1889659c23d6">compression_level</a> &gt;= 0) {</div>
<div class="line"><a name="l02422"></a><span class="lineno"> 2422</span>&#160;        err = <a class="code" href="libavcodec_2vaapi__encode_8c.html#a5d0faa2fc51c873f9df92b0e5f23769c">vaapi_encode_init_quality</a>(avctx);</div>
<div class="line"><a name="l02423"></a><span class="lineno"> 2423</span>&#160;        <span class="keywordflow">if</span> (err &lt; 0)</div>
<div class="line"><a name="l02424"></a><span class="lineno"> 2424</span>&#160;            <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l02425"></a><span class="lineno"> 2425</span>&#160;    }</div>
<div class="line"><a name="l02426"></a><span class="lineno"> 2426</span>&#160; </div>
<div class="line"><a name="l02427"></a><span class="lineno"> 2427</span>&#160;    vas = vaCreateConfig(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;hwctx-&gt;display,</div>
<div class="line"><a name="l02428"></a><span class="lineno"> 2428</span>&#160;                         <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;va_profile, <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;va_entrypoint,</div>
<div class="line"><a name="l02429"></a><span class="lineno"> 2429</span>&#160;                         <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;config_attributes, <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nb_config_attributes,</div>
<div class="line"><a name="l02430"></a><span class="lineno"> 2430</span>&#160;                         &amp;<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;va_config);</div>
<div class="line"><a name="l02431"></a><span class="lineno"> 2431</span>&#160;    <span class="keywordflow">if</span> (vas != VA_STATUS_SUCCESS) {</div>
<div class="line"><a name="l02432"></a><span class="lineno"> 2432</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to create encode pipeline &quot;</span></div>
<div class="line"><a name="l02433"></a><span class="lineno"> 2433</span>&#160;               <span class="stringliteral">&quot;configuration: %d (%s).\n&quot;</span>, vas, vaErrorStr(vas));</div>
<div class="line"><a name="l02434"></a><span class="lineno"> 2434</span>&#160;        err = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EIO);</div>
<div class="line"><a name="l02435"></a><span class="lineno"> 2435</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l02436"></a><span class="lineno"> 2436</span>&#160;    }</div>
<div class="line"><a name="l02437"></a><span class="lineno"> 2437</span>&#160; </div>
<div class="line"><a name="l02438"></a><span class="lineno"> 2438</span>&#160;    err = <a class="code" href="libavcodec_2vaapi__encode_8c.html#a0c77b63d3a425bbc13899110282edb13">vaapi_encode_create_recon_frames</a>(avctx);</div>
<div class="line"><a name="l02439"></a><span class="lineno"> 2439</span>&#160;    <span class="keywordflow">if</span> (err &lt; 0)</div>
<div class="line"><a name="l02440"></a><span class="lineno"> 2440</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l02441"></a><span class="lineno"> 2441</span>&#160; </div>
<div class="line"><a name="l02442"></a><span class="lineno"> 2442</span>&#160;    recon_hwctx = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;recon_frames-&gt;hwctx;</div>
<div class="line"><a name="l02443"></a><span class="lineno"> 2443</span>&#160;    vas = vaCreateContext(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;hwctx-&gt;display, <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;va_config,</div>
<div class="line"><a name="l02444"></a><span class="lineno"> 2444</span>&#160;                          <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;surface_width, <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;surface_height,</div>
<div class="line"><a name="l02445"></a><span class="lineno"> 2445</span>&#160;                          VA_PROGRESSIVE,</div>
<div class="line"><a name="l02446"></a><span class="lineno"> 2446</span>&#160;                          recon_hwctx-&gt;<a class="code" href="struct_a_v_v_a_a_p_i_frames_context.html#a18c4ca9956227c498679a823e14e1375">surface_ids</a>,</div>
<div class="line"><a name="l02447"></a><span class="lineno"> 2447</span>&#160;                          recon_hwctx-&gt;<a class="code" href="struct_a_v_v_a_a_p_i_frames_context.html#af574bfa0abf14b96ae667f25494a3bcf">nb_surfaces</a>,</div>
<div class="line"><a name="l02448"></a><span class="lineno"> 2448</span>&#160;                          &amp;<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;va_context);</div>
<div class="line"><a name="l02449"></a><span class="lineno"> 2449</span>&#160;    <span class="keywordflow">if</span> (vas != VA_STATUS_SUCCESS) {</div>
<div class="line"><a name="l02450"></a><span class="lineno"> 2450</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to create encode pipeline &quot;</span></div>
<div class="line"><a name="l02451"></a><span class="lineno"> 2451</span>&#160;               <span class="stringliteral">&quot;context: %d (%s).\n&quot;</span>, vas, vaErrorStr(vas));</div>
<div class="line"><a name="l02452"></a><span class="lineno"> 2452</span>&#160;        err = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EIO);</div>
<div class="line"><a name="l02453"></a><span class="lineno"> 2453</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l02454"></a><span class="lineno"> 2454</span>&#160;    }</div>
<div class="line"><a name="l02455"></a><span class="lineno"> 2455</span>&#160; </div>
<div class="line"><a name="l02456"></a><span class="lineno"> 2456</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;output_buffer_pool =</div>
<div class="line"><a name="l02457"></a><span class="lineno"> 2457</span>&#160;        <a class="code" href="group__lavu__bufferpool.html#ga615151c8889d5be39d17bce4d8c65117">av_buffer_pool_init2</a>(<span class="keyword">sizeof</span>(VABufferID), avctx,</div>
<div class="line"><a name="l02458"></a><span class="lineno"> 2458</span>&#160;                             &amp;<a class="code" href="libavcodec_2vaapi__encode_8c.html#a202ea7fe1efd977171c4dce7eab2f445">vaapi_encode_alloc_output_buffer</a>, <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><a name="l02459"></a><span class="lineno"> 2459</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;output_buffer_pool) {</div>
<div class="line"><a name="l02460"></a><span class="lineno"> 2460</span>&#160;        err = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l02461"></a><span class="lineno"> 2461</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l02462"></a><span class="lineno"> 2462</span>&#160;    }</div>
<div class="line"><a name="l02463"></a><span class="lineno"> 2463</span>&#160; </div>
<div class="line"><a name="l02464"></a><span class="lineno"> 2464</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;codec-&gt;configure) {</div>
<div class="line"><a name="l02465"></a><span class="lineno"> 2465</span>&#160;        err = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;codec-&gt;configure(avctx);</div>
<div class="line"><a name="l02466"></a><span class="lineno"> 2466</span>&#160;        <span class="keywordflow">if</span> (err &lt; 0)</div>
<div class="line"><a name="l02467"></a><span class="lineno"> 2467</span>&#160;            <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l02468"></a><span class="lineno"> 2468</span>&#160;    }</div>
<div class="line"><a name="l02469"></a><span class="lineno"> 2469</span>&#160; </div>
<div class="line"><a name="l02470"></a><span class="lineno"> 2470</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;output_delay = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;b_per_p;</div>
<div class="line"><a name="l02471"></a><span class="lineno"> 2471</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;decode_delay = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;max_b_depth;</div>
<div class="line"><a name="l02472"></a><span class="lineno"> 2472</span>&#160; </div>
<div class="line"><a name="l02473"></a><span class="lineno"> 2473</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;codec-&gt;sequence_params_size &gt; 0) {</div>
<div class="line"><a name="l02474"></a><span class="lineno"> 2474</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;codec_sequence_params =</div>
<div class="line"><a name="l02475"></a><span class="lineno"> 2475</span>&#160;            <a class="code" href="group__lavu__mem__funcs.html#gaf143ecab33a3868b57345466c39de7c1">av_mallocz</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;codec-&gt;sequence_params_size);</div>
<div class="line"><a name="l02476"></a><span class="lineno"> 2476</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;codec_sequence_params) {</div>
<div class="line"><a name="l02477"></a><span class="lineno"> 2477</span>&#160;            err = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l02478"></a><span class="lineno"> 2478</span>&#160;            <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l02479"></a><span class="lineno"> 2479</span>&#160;        }</div>
<div class="line"><a name="l02480"></a><span class="lineno"> 2480</span>&#160;    }</div>
<div class="line"><a name="l02481"></a><span class="lineno"> 2481</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;codec-&gt;picture_params_size &gt; 0) {</div>
<div class="line"><a name="l02482"></a><span class="lineno"> 2482</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;codec_picture_params =</div>
<div class="line"><a name="l02483"></a><span class="lineno"> 2483</span>&#160;            <a class="code" href="group__lavu__mem__funcs.html#gaf143ecab33a3868b57345466c39de7c1">av_mallocz</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;codec-&gt;picture_params_size);</div>
<div class="line"><a name="l02484"></a><span class="lineno"> 2484</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;codec_picture_params) {</div>
<div class="line"><a name="l02485"></a><span class="lineno"> 2485</span>&#160;            err = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l02486"></a><span class="lineno"> 2486</span>&#160;            <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l02487"></a><span class="lineno"> 2487</span>&#160;        }</div>
<div class="line"><a name="l02488"></a><span class="lineno"> 2488</span>&#160;    }</div>
<div class="line"><a name="l02489"></a><span class="lineno"> 2489</span>&#160; </div>
<div class="line"><a name="l02490"></a><span class="lineno"> 2490</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;codec-&gt;init_sequence_params) {</div>
<div class="line"><a name="l02491"></a><span class="lineno"> 2491</span>&#160;        err = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;codec-&gt;init_sequence_params(avctx);</div>
<div class="line"><a name="l02492"></a><span class="lineno"> 2492</span>&#160;        <span class="keywordflow">if</span> (err &lt; 0) {</div>
<div class="line"><a name="l02493"></a><span class="lineno"> 2493</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Codec sequence initialisation &quot;</span></div>
<div class="line"><a name="l02494"></a><span class="lineno"> 2494</span>&#160;                   <span class="stringliteral">&quot;failed: %d.\n&quot;</span>, err);</div>
<div class="line"><a name="l02495"></a><span class="lineno"> 2495</span>&#160;            <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l02496"></a><span class="lineno"> 2496</span>&#160;        }</div>
<div class="line"><a name="l02497"></a><span class="lineno"> 2497</span>&#160;    }</div>
<div class="line"><a name="l02498"></a><span class="lineno"> 2498</span>&#160; </div>
<div class="line"><a name="l02499"></a><span class="lineno"> 2499</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;va_packed_headers &amp; VA_ENC_PACKED_HEADER_SEQUENCE &amp;&amp;</div>
<div class="line"><a name="l02500"></a><span class="lineno"> 2500</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;codec-&gt;write_sequence_header &amp;&amp;</div>
<div class="line"><a name="l02501"></a><span class="lineno"> 2501</span>&#160;        avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#abb01e291550fa3fb96188af4d494587e">flags</a> &amp; <a class="code" href="group__lavc__core.html#ga9ed82634c59b339786575827c47a8f68">AV_CODEC_FLAG_GLOBAL_HEADER</a>) {</div>
<div class="line"><a name="l02502"></a><span class="lineno"> 2502</span>&#160;        <span class="keywordtype">char</span> <a class="code" href="mxf_8c.html#a084824fc871e38157790c99ae1240842">data</a>[<a class="code" href="group__avoptions.html#gga06fc87d81c62e9abb8790b6e5713c55baed0269e9bae5024423f71b1f7454bd01">MAX_PARAM_BUFFER_SIZE</a>];</div>
<div class="line"><a name="l02503"></a><span class="lineno"> 2503</span>&#160;        <span class="keywordtype">size_t</span> bit_len = 8 * <span class="keyword">sizeof</span>(<a class="code" href="mxf_8c.html#a084824fc871e38157790c99ae1240842">data</a>);</div>
<div class="line"><a name="l02504"></a><span class="lineno"> 2504</span>&#160; </div>
<div class="line"><a name="l02505"></a><span class="lineno"> 2505</span>&#160;        err = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;codec-&gt;write_sequence_header(avctx, <a class="code" href="mxf_8c.html#a084824fc871e38157790c99ae1240842">data</a>, &amp;bit_len);</div>
<div class="line"><a name="l02506"></a><span class="lineno"> 2506</span>&#160;        <span class="keywordflow">if</span> (err &lt; 0) {</div>
<div class="line"><a name="l02507"></a><span class="lineno"> 2507</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to write sequence header &quot;</span></div>
<div class="line"><a name="l02508"></a><span class="lineno"> 2508</span>&#160;                   <span class="stringliteral">&quot;for extradata: %d.\n&quot;</span>, err);</div>
<div class="line"><a name="l02509"></a><span class="lineno"> 2509</span>&#160;            <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l02510"></a><span class="lineno"> 2510</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02511"></a><span class="lineno"> 2511</span>&#160;            avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#ae246ca7a1c72c151891ed0599e8dbfba">extradata_size</a> = (bit_len + 7) / 8;</div>
<div class="line"><a name="l02512"></a><span class="lineno"> 2512</span>&#160;            avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#abe964316aaaa61967b012efdcced79c4">extradata</a> = <a class="code" href="group__lavu__mem__funcs.html#gaf143ecab33a3868b57345466c39de7c1">av_mallocz</a>(avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#ae246ca7a1c72c151891ed0599e8dbfba">extradata_size</a> +</div>
<div class="line"><a name="l02513"></a><span class="lineno"> 2513</span>&#160;                                          <a class="code" href="group__lavc__decoding.html#ga8f5b632a03ce83ac8e025894b1fc307a">AV_INPUT_BUFFER_PADDING_SIZE</a>);</div>
<div class="line"><a name="l02514"></a><span class="lineno"> 2514</span>&#160;            <span class="keywordflow">if</span> (!avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#abe964316aaaa61967b012efdcced79c4">extradata</a>) {</div>
<div class="line"><a name="l02515"></a><span class="lineno"> 2515</span>&#160;                err = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l02516"></a><span class="lineno"> 2516</span>&#160;                <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l02517"></a><span class="lineno"> 2517</span>&#160;            }</div>
<div class="line"><a name="l02518"></a><span class="lineno"> 2518</span>&#160;            memcpy(avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#abe964316aaaa61967b012efdcced79c4">extradata</a>, <a class="code" href="mxf_8c.html#a084824fc871e38157790c99ae1240842">data</a>, avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#ae246ca7a1c72c151891ed0599e8dbfba">extradata_size</a>);</div>
<div class="line"><a name="l02519"></a><span class="lineno"> 2519</span>&#160;        }</div>
<div class="line"><a name="l02520"></a><span class="lineno"> 2520</span>&#160;    }</div>
<div class="line"><a name="l02521"></a><span class="lineno"> 2521</span>&#160; </div>
<div class="line"><a name="l02522"></a><span class="lineno"> 2522</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l02523"></a><span class="lineno"> 2523</span>&#160; </div>
<div class="line"><a name="l02524"></a><span class="lineno"> 2524</span>&#160;<a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>:</div>
<div class="line"><a name="l02525"></a><span class="lineno"> 2525</span>&#160;    <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l02526"></a><span class="lineno"> 2526</span>&#160;}</div>
<div class="line"><a name="l02527"></a><span class="lineno"> 2527</span>&#160; </div>
<div class="line"><a name="l02528"></a><span class="lineno"><a class="line" href="vaapi__encode_8h.html#a6001e09ebee921c1a48906e67d2e7f6e"> 2528</a></span>&#160;<a class="code" href="attributes_8h.html#abeeb324fff79a5335d36774704e2475c">av_cold</a> <span class="keywordtype">int</span> <a class="code" href="libavcodec_2vaapi__encode_8c.html#ac75ceee4c1b5bb20cff6639320bccf32">ff_vaapi_encode_close</a>(<a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a> *avctx)</div>
<div class="line"><a name="l02529"></a><span class="lineno"> 2529</span>&#160;{</div>
<div class="line"><a name="l02530"></a><span class="lineno"> 2530</span>&#160;    <a class="code" href="struct_v_a_a_p_i_encode_context.html">VAAPIEncodeContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a> = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#af3379123060ad8cc9c321c29af4f8360">priv_data</a>;</div>
<div class="line"><a name="l02531"></a><span class="lineno"> 2531</span>&#160;    <a class="code" href="struct_v_a_a_p_i_encode_picture.html">VAAPIEncodePicture</a> *pic, *next;</div>
<div class="line"><a name="l02532"></a><span class="lineno"> 2532</span>&#160; </div>
<div class="line"><a name="l02533"></a><span class="lineno"> 2533</span>&#160;    <span class="keywordflow">for</span> (pic = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;pic_start; pic; pic = next) {</div>
<div class="line"><a name="l02534"></a><span class="lineno"> 2534</span>&#160;        next = pic-&gt;<a class="code" href="struct_v_a_a_p_i_encode_picture.html#aaa8c71a04b83ac217a42bf41e0e1a0ff">next</a>;</div>
<div class="line"><a name="l02535"></a><span class="lineno"> 2535</span>&#160;        <a class="code" href="libavcodec_2vaapi__encode_8c.html#a39fd61d4df4898b7ae3ae638065ef008">vaapi_encode_free</a>(avctx, pic);</div>
<div class="line"><a name="l02536"></a><span class="lineno"> 2536</span>&#160;    }</div>
<div class="line"><a name="l02537"></a><span class="lineno"> 2537</span>&#160; </div>
<div class="line"><a name="l02538"></a><span class="lineno"> 2538</span>&#160;    <a class="code" href="group__lavu__bufferpool.html#ga7b76781c5944b3bb59b2e3b1a8994e4a">av_buffer_pool_uninit</a>(&amp;<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;output_buffer_pool);</div>
<div class="line"><a name="l02539"></a><span class="lineno"> 2539</span>&#160; </div>
<div class="line"><a name="l02540"></a><span class="lineno"> 2540</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;va_context != VA_INVALID_ID) {</div>
<div class="line"><a name="l02541"></a><span class="lineno"> 2541</span>&#160;        vaDestroyContext(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;hwctx-&gt;display, <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;va_context);</div>
<div class="line"><a name="l02542"></a><span class="lineno"> 2542</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;va_context = VA_INVALID_ID;</div>
<div class="line"><a name="l02543"></a><span class="lineno"> 2543</span>&#160;    }</div>
<div class="line"><a name="l02544"></a><span class="lineno"> 2544</span>&#160; </div>
<div class="line"><a name="l02545"></a><span class="lineno"> 2545</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;va_config != VA_INVALID_ID) {</div>
<div class="line"><a name="l02546"></a><span class="lineno"> 2546</span>&#160;        vaDestroyConfig(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;hwctx-&gt;display, <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;va_config);</div>
<div class="line"><a name="l02547"></a><span class="lineno"> 2547</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;va_config = VA_INVALID_ID;</div>
<div class="line"><a name="l02548"></a><span class="lineno"> 2548</span>&#160;    }</div>
<div class="line"><a name="l02549"></a><span class="lineno"> 2549</span>&#160; </div>
<div class="line"><a name="l02550"></a><span class="lineno"> 2550</span>&#160;    <a class="code" href="group__lavu__frame.html#ga979d73f3228814aee56aeca0636e37cc">av_frame_free</a>(&amp;<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;frame);</div>
<div class="line"><a name="l02551"></a><span class="lineno"> 2551</span>&#160; </div>
<div class="line"><a name="l02552"></a><span class="lineno"> 2552</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#adba82e1bcd02de510a858fcbedf79ef1">av_freep</a>(&amp;<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;codec_sequence_params);</div>
<div class="line"><a name="l02553"></a><span class="lineno"> 2553</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#adba82e1bcd02de510a858fcbedf79ef1">av_freep</a>(&amp;<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;codec_picture_params);</div>
<div class="line"><a name="l02554"></a><span class="lineno"> 2554</span>&#160; </div>
<div class="line"><a name="l02555"></a><span class="lineno"> 2555</span>&#160;    <a class="code" href="group__lavu__buffer.html#ga135e9e929b5033bb8f68322497b2effc">av_buffer_unref</a>(&amp;<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;recon_frames_ref);</div>
<div class="line"><a name="l02556"></a><span class="lineno"> 2556</span>&#160;    <a class="code" href="group__lavu__buffer.html#ga135e9e929b5033bb8f68322497b2effc">av_buffer_unref</a>(&amp;<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;input_frames_ref);</div>
<div class="line"><a name="l02557"></a><span class="lineno"> 2557</span>&#160;    <a class="code" href="group__lavu__buffer.html#ga135e9e929b5033bb8f68322497b2effc">av_buffer_unref</a>(&amp;<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;device_ref);</div>
<div class="line"><a name="l02558"></a><span class="lineno"> 2558</span>&#160; </div>
<div class="line"><a name="l02559"></a><span class="lineno"> 2559</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l02560"></a><span class="lineno"> 2560</span>&#160;}</div>
</div><!-- fragment --></div><!-- contents -->
<div class="ttc" id="astruct_a_v_v_a_a_p_i_frames_context_html_af574bfa0abf14b96ae667f25494a3bcf"><div class="ttname"><a href="struct_a_v_v_a_a_p_i_frames_context.html#af574bfa0abf14b96ae667f25494a3bcf">AVVAAPIFramesContext::nb_surfaces</a></div><div class="ttdeci">int nb_surfaces</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vaapi_8h_source.html#l00102">hwcontext_vaapi.h:102</a></div></div>
<div class="ttc" id="astruct_v_a_a_p_i_encode_slice_html_a1af79506382a30f4ebbcdd5ba0927abd"><div class="ttname"><a href="struct_v_a_a_p_i_encode_slice.html#a1af79506382a30f4ebbcdd5ba0927abd">VAAPIEncodeSlice::row_size</a></div><div class="ttdeci">int row_size</div><div class="ttdef"><b>Definition:</b> <a href="vaapi__encode_8h_source.html#l00064">vaapi_encode.h:64</a></div></div>
<div class="ttc" id="avaapi__encode_8h_html_adf764cbdea00d65edcd07bb9953ad2b7a4a3d20bd96935a81d334d85be050639b"><div class="ttname"><a href="vaapi__encode_8h.html#adf764cbdea00d65edcd07bb9953ad2b7a4a3d20bd96935a81d334d85be050639b">PICTURE_TYPE_B</a></div><div class="ttdeci">@ PICTURE_TYPE_B</div><div class="ttdef"><b>Definition:</b> <a href="vaapi__encode_8h_source.html#l00058">vaapi_encode.h:58</a></div></div>
<div class="ttc" id="agroup__lavu__log__constants_html_ga85b57516ca703cc47d9bbe5f4658c716"><div class="ttname"><a href="group__lavu__log__constants.html#ga85b57516ca703cc47d9bbe5f4658c716">AV_LOG_WARNING</a></div><div class="ttdeci">#define AV_LOG_WARNING</div><div class="ttdef"><b>Definition:</b> <a href="log_8h_source.html#l00200">log.h:200</a></div></div>
<div class="ttc" id="astruct_v_a_a_p_i_encode_picture_html_ad45123e35df627c1103ad8e762bc5b0a"><div class="ttname"><a href="struct_v_a_a_p_i_encode_picture.html#ad45123e35df627c1103ad8e762bc5b0a">VAAPIEncodePicture::force_idr</a></div><div class="ttdeci">int force_idr</div><div class="ttdef"><b>Definition:</b> <a href="vaapi__encode_8h_source.html#l00076">vaapi_encode.h:76</a></div></div>
<div class="ttc" id="astruct_a_v_codec_context_html"><div class="ttname"><a href="struct_a_v_codec_context.html">AVCodecContext</a></div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l00526">avcodec.h:526</a></div></div>
<div class="ttc" id="astruct_v_a_a_p_i_encode_picture_html_a0a28d9343217d043aae8a6bfedea7b04"><div class="ttname"><a href="struct_v_a_a_p_i_encode_picture.html#a0a28d9343217d043aae8a6bfedea7b04">VAAPIEncodePicture::pts</a></div><div class="ttdeci">int64_t pts</div><div class="ttdef"><b>Definition:</b> <a href="vaapi__encode_8h_source.html#l00075">vaapi_encode.h:75</a></div></div>
<div class="ttc" id="apixfmt_8h_html_a9a8e335cf3be472042bc9f0cf80cd4c5"><div class="ttname"><a href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5">AVPixelFormat</a></div><div class="ttdeci">AVPixelFormat</div><div class="ttdef"><b>Definition:</b> <a href="pixfmt_8h_source.html#l00064">pixfmt.h:64</a></div></div>
<div class="ttc" id="astruct_a_v_codec_context_html_a6b53fda85ad61baa345edbd96cb8a33c"><div class="ttname"><a href="struct_a_v_codec_context.html#a6b53fda85ad61baa345edbd96cb8a33c">AVCodecContext::bit_rate</a></div><div class="ttdeci">int64_t bit_rate</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l00576">avcodec.h:576</a></div></div>
<div class="ttc" id="astruct_a_v_codec_context_html_a3bac44bb0b016ab838780cc19ac277d6"><div class="ttname"><a href="struct_a_v_codec_context.html#a3bac44bb0b016ab838780cc19ac277d6">AVCodecContext::hw_frames_ctx</a></div><div class="ttdeci">AVBufferRef * hw_frames_ctx</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l02226">avcodec.h:2226</a></div></div>
<div class="ttc" id="asvq3_8c_html_abbb6c7c49508c1ac374683f2d1159e08"><div class="ttname"><a href="svq3_8c.html#abbb6c7c49508c1ac374683f2d1159e08">level</a></div><div class="ttdeci">uint8_t level</div><div class="ttdef"><b>Definition:</b> <a href="svq3_8c_source.html#l00205">svq3.c:205</a></div></div>
<div class="ttc" id="alibavcodec_2vaapi__encode_8c_html_a8deb9c25c3e1b7fa3ab897ee059d4fba"><div class="ttname"><a href="libavcodec_2vaapi__encode_8c.html#a8deb9c25c3e1b7fa3ab897ee059d4fba">vaapi_encode_init_roi</a></div><div class="ttdeci">static av_cold int vaapi_encode_init_roi(AVCodecContext *avctx)</div><div class="ttdef"><b>Definition:</b> <a href="libavcodec_2vaapi__encode_8c_source.html#l02189">vaapi_encode.c:2189</a></div></div>
<div class="ttc" id="astruct_v_a_a_p_i_encode_picture_html_abdd10141f1025ea3a6903bafd450cbf7"><div class="ttname"><a href="struct_v_a_a_p_i_encode_picture.html#abdd10141f1025ea3a6903bafd450cbf7">VAAPIEncodePicture::input_image</a></div><div class="ttdeci">AVFrame * input_image</div><div class="ttdef"><b>Definition:</b> <a href="vaapi__encode_8h_source.html#l00090">vaapi_encode.h:90</a></div></div>
<div class="ttc" id="afilter__design_8txt_html_adf2fb515710d47541f7150ecd2950e76"><div class="ttname"><a href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a></div><div class="ttdeci">Filter the word “frame” indicates either a video frame or a group of audio as stored in an AVFrame structure Format for each input and each output the list of supported formats For video that means pixel format For audio that means channel sample they are references to shared objects When the negotiation mechanism computes the intersection of the formats supported at each end of a all references to both lists are replaced with a reference to the intersection And when a single format is eventually chosen for a link amongst the remaining all references to the list are updated That means that if a filter requires that its input and output have the same format amongst a supported all it has to do is use a reference to the same list of formats query_formats can leave some formats unset and return AVERROR(EAGAIN) to cause the negotiation mechanism toagain later. That can be used by filters with complex requirements to use the format negotiated on one link to set the formats supported on another. Frame references ownership and permissions</div></div>
<div class="ttc" id="astruct_v_a_a_p_i_encode_picture_html_a7b20419c52cbcfb242f90a8b35edfc14"><div class="ttname"><a href="struct_v_a_a_p_i_encode_picture.html#a7b20419c52cbcfb242f90a8b35edfc14">VAAPIEncodePicture::recon_surface</a></div><div class="ttdeci">VASurfaceID recon_surface</div><div class="ttdef"><b>Definition:</b> <a href="vaapi__encode_8h_source.html#l00094">vaapi_encode.h:94</a></div></div>
<div class="ttc" id="astruct_a_v_codec_context_html_a0449afd803eb107bd4dbc8b5ea22e363"><div class="ttname"><a href="struct_a_v_codec_context.html#a0449afd803eb107bd4dbc8b5ea22e363">AVCodecContext::height</a></div><div class="ttdeci">int height</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l00699">avcodec.h:699</a></div></div>
<div class="ttc" id="astruct_a_v_h_w_frames_constraints_html_a34e06e3397af2b83de9d78f893bf4168"><div class="ttname"><a href="struct_a_v_h_w_frames_constraints.html#a34e06e3397af2b83de9d78f893bf4168">AVHWFramesConstraints::max_width</a></div><div class="ttdeci">int max_width</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext_8h_source.html#l00478">hwcontext.h:478</a></div></div>
<div class="ttc" id="astruct_a_v_codec_context_html_af3379123060ad8cc9c321c29af4f8360"><div class="ttname"><a href="struct_a_v_codec_context.html#af3379123060ad8cc9c321c29af4f8360">AVCodecContext::priv_data</a></div><div class="ttdeci">void * priv_data</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l00553">avcodec.h:553</a></div></div>
<div class="ttc" id="agroup__lavu__frame_html_gadec0efb470b1eead6a979333d9deca0c"><div class="ttname"><a href="group__lavu__frame.html#gadec0efb470b1eead6a979333d9deca0c">av_frame_get_side_data</a></div><div class="ttdeci">AVFrameSideData * av_frame_get_side_data(const AVFrame *frame, enum AVFrameSideDataType type)</div><div class="ttdef"><b>Definition:</b> <a href="frame_8c_source.html#l00738">frame.c:738</a></div></div>
<div class="ttc" id="astruct_a_v_codec_context_html_a3f63bc9141e25bf7f1cda0cef7cd4a60"><div class="ttname"><a href="struct_a_v_codec_context.html#a3f63bc9141e25bf7f1cda0cef7cd4a60">AVCodecContext::qmin</a></div><div class="ttdeci">int qmin</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l01368">avcodec.h:1368</a></div></div>
<div class="ttc" id="ahwcontext_8c_html_aaac4b2ed559ba36ce8c8cdfa9ce20d43"><div class="ttname"><a href="hwcontext_8c.html#aaac4b2ed559ba36ce8c8cdfa9ce20d43">av_hwdevice_hwconfig_alloc</a></div><div class="ttdeci">void * av_hwdevice_hwconfig_alloc(AVBufferRef *ref)</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext_8c_source.html#l00565">hwcontext.c:565</a></div></div>
<div class="ttc" id="apixdesc_8c_html_afe0c3e8aef5173de28bbdaea4298f5f0"><div class="ttname"><a href="pixdesc_8c.html#afe0c3e8aef5173de28bbdaea4298f5f0">av_pix_fmt_desc_get</a></div><div class="ttdeci">const AVPixFmtDescriptor * av_pix_fmt_desc_get(enum AVPixelFormat pix_fmt)</div><div class="ttdef"><b>Definition:</b> <a href="pixdesc_8c_source.html#l02573">pixdesc.c:2573</a></div></div>
<div class="ttc" id="agroup__lavu__error_html_gab4faa0afdf35076914824200331defff"><div class="ttname"><a href="group__lavu__error.html#gab4faa0afdf35076914824200331defff">AVERROR_EOF</a></div><div class="ttdeci">#define AVERROR_EOF</div><div class="ttdoc">End of file.</div><div class="ttdef"><b>Definition:</b> <a href="error_8h_source.html#l00055">error.h:55</a></div></div>
<div class="ttc" id="alibavcodec_2vaapi__encode_8c_html_a74618fe18d23fd63836b464c14303105"><div class="ttname"><a href="libavcodec_2vaapi__encode_8c.html#a74618fe18d23fd63836b464c14303105">vaapi_encode_make_row_slice</a></div><div class="ttdeci">static int vaapi_encode_make_row_slice(AVCodecContext *avctx, VAAPIEncodePicture *pic)</div><div class="ttdef"><b>Definition:</b> <a href="libavcodec_2vaapi__encode_8c_source.html#l00166">vaapi_encode.c:166</a></div></div>
<div class="ttc" id="avaapi__encode_8h_html_abc6126af1d45847bc59afa0aa3216b04adb158c6c9512d48028d0dba677934703"><div class="ttname"><a href="vaapi__encode_8h.html#abc6126af1d45847bc59afa0aa3216b04adb158c6c9512d48028d0dba677934703">FLAG_B_PICTURE_REFERENCES</a></div><div class="ttdeci">@ FLAG_B_PICTURE_REFERENCES</div><div class="ttdef"><b>Definition:</b> <a href="vaapi__encode_8h_source.html#l00360">vaapi_encode.h:360</a></div></div>
<div class="ttc" id="amem_8c_html_a254f3455439c15a2c8a75b8f0235fdbd"><div class="ttname"><a href="mem_8c.html#a254f3455439c15a2c8a75b8f0235fdbd">av_malloc_array</a></div><div class="ttdeci">void * av_malloc_array(size_t nmemb, size_t size)</div><div class="ttdef"><b>Definition:</b> <a href="mem_8c_source.html#l00182">mem.c:182</a></div></div>
<div class="ttc" id="astruct_v_a_a_p_i_encode_picture_html_ada59d0ef73e012e82205dadb78aea94d"><div class="ttname"><a href="struct_v_a_a_p_i_encode_picture.html#ada59d0ef73e012e82205dadb78aea94d">VAAPIEncodePicture::param_buffers</a></div><div class="ttdeci">VABufferID * param_buffers</div><div class="ttdef"><b>Definition:</b> <a href="vaapi__encode_8h_source.html#l00097">vaapi_encode.h:97</a></div></div>
<div class="ttc" id="astruct_a_v_buffer_ref_html_acb8452e99cd75074b93800b532c6ea4b"><div class="ttname"><a href="struct_a_v_buffer_ref.html#acb8452e99cd75074b93800b532c6ea4b">AVBufferRef::data</a></div><div class="ttdeci">uint8_t * data</div><div class="ttdef"><b>Definition:</b> <a href="buffer_8h_source.html#l00089">buffer.h:89</a></div></div>
<div class="ttc" id="avaapi__encode_8h_html_a99fb83031ce9923c84392b4e92f956b5ad729ee7c5714d6063cc2bc4e91dd0b0d"><div class="ttname"><a href="vaapi__encode_8h.html#a99fb83031ce9923c84392b4e92f956b5ad729ee7c5714d6063cc2bc4e91dd0b0d">RC_MODE_VBR</a></div><div class="ttdeci">@ RC_MODE_VBR</div><div class="ttdef"><b>Definition:</b> <a href="vaapi__encode_8h_source.html#l00149">vaapi_encode.h:149</a></div></div>
<div class="ttc" id="agroup__lavc__core_html_ga70edda5debd8433d29ec1b9eed57422b"><div class="ttname"><a href="group__lavc__core.html#ga70edda5debd8433d29ec1b9eed57422b">AV_CODEC_FLAG_QSCALE</a></div><div class="ttdeci">#define AV_CODEC_FLAG_QSCALE</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l00275">avcodec.h:275</a></div></div>
<div class="ttc" id="astruct_v_a_a_p_i_encode_picture_html_a990d7ec9ddfeda0d522e0856eaf84efd"><div class="ttname"><a href="struct_v_a_a_p_i_encode_picture.html#a990d7ec9ddfeda0d522e0856eaf84efd">VAAPIEncodePicture::prev</a></div><div class="ttdeci">struct VAAPIEncodePicture * prev</div><div class="ttdef"><b>Definition:</b> <a href="vaapi__encode_8h_source.html#l00119">vaapi_encode.h:119</a></div></div>
<div class="ttc" id="avaapi__encode_8h_html_abc6126af1d45847bc59afa0aa3216b04aea37de0df3305b9dbb2a3df87df1e222"><div class="ttname"><a href="vaapi__encode_8h.html#abc6126af1d45847bc59afa0aa3216b04aea37de0df3305b9dbb2a3df87df1e222">FLAG_INTRA_ONLY</a></div><div class="ttdeci">@ FLAG_INTRA_ONLY</div><div class="ttdef"><b>Definition:</b> <a href="vaapi__encode_8h_source.html#l00356">vaapi_encode.h:356</a></div></div>
<div class="ttc" id="astruct_a_v_codec_h_w_config_internal_html"><div class="ttname"><a href="struct_a_v_codec_h_w_config_internal.html">AVCodecHWConfigInternal</a></div><div class="ttdef"><b>Definition:</b> <a href="hwconfig_8h_source.html#l00029">hwconfig.h:29</a></div></div>
<div class="ttc" id="alibavcodec_2vaapi__encode_8c_html_acf8754cdb63cca6783425c5bcaaf57b5"><div class="ttname"><a href="libavcodec_2vaapi__encode_8c.html#acf8754cdb63cca6783425c5bcaaf57b5">vaapi_encode_entrypoints_normal</a></div><div class="ttdeci">static const VAEntrypoint vaapi_encode_entrypoints_normal[]</div><div class="ttdef"><b>Definition:</b> <a href="libavcodec_2vaapi__encode_8c_source.html#l01257">vaapi_encode.c:1257</a></div></div>
<div class="ttc" id="alibavcodec_2vaapi__encode_8c_html_a27258a18f00f0b61a80d3b64e7aaae94"><div class="ttname"><a href="libavcodec_2vaapi__encode_8c.html#a27258a18f00f0b61a80d3b64e7aaae94">VAAPIEncodeRTFormat</a></div><div class="ttdeci">struct VAAPIEncodeRTFormat VAAPIEncodeRTFormat</div></div>
<div class="ttc" id="aattributes_8h_html_a7ca8a3900269f92fcc7b68235dea7787"><div class="ttname"><a href="attributes_8h.html#a7ca8a3900269f92fcc7b68235dea7787">av_unused</a></div><div class="ttdeci">#define av_unused</div><div class="ttdef"><b>Definition:</b> <a href="attributes_8h_source.html#l00133">attributes.h:133</a></div></div>
<div class="ttc" id="astruct_v_a_a_p_i_encode_r_t_format_html_abf368514fa39395bd01fc6af4f225f86"><div class="ttname"><a href="struct_v_a_a_p_i_encode_r_t_format.html#abf368514fa39395bd01fc6af4f225f86">VAAPIEncodeRTFormat::depth</a></div><div class="ttdeci">int depth</div><div class="ttdef"><b>Definition:</b> <a href="libavcodec_2vaapi__encode_8c_source.html#l01237">vaapi_encode.c:1237</a></div></div>
<div class="ttc" id="agroup__lavu__frame_html_ga979d73f3228814aee56aeca0636e37cc"><div class="ttname"><a href="group__lavu__frame.html#ga979d73f3228814aee56aeca0636e37cc">av_frame_free</a></div><div class="ttdeci">void av_frame_free(AVFrame **frame)</div><div class="ttdef"><b>Definition:</b> <a href="frame_8c_source.html#l00203">frame.c:203</a></div></div>
<div class="ttc" id="alibavcodec_2vaapi__encode_8c_html_aad022021d7b698a82adf938943685c6a"><div class="ttname"><a href="libavcodec_2vaapi__encode_8c.html#aad022021d7b698a82adf938943685c6a">vaapi_encode_init_slice_structure</a></div><div class="ttdeci">static av_cold int vaapi_encode_init_slice_structure(AVCodecContext *avctx)</div><div class="ttdef"><b>Definition:</b> <a href="libavcodec_2vaapi__encode_8c_source.html#l01993">vaapi_encode.c:1993</a></div></div>
<div class="ttc" id="aqsvenc_8c_html_aacd2c6f4a09d71ea05bdcc1c2e9d42dd"><div class="ttname"><a href="qsvenc_8c.html#aacd2c6f4a09d71ea05bdcc1c2e9d42dd">profile</a></div><div class="ttdeci">mfxU16 profile</div><div class="ttdef"><b>Definition:</b> <a href="qsvenc_8c_source.html#l00045">qsvenc.c:45</a></div></div>
<div class="ttc" id="aavrndec_8c_html_a13191ba45577b1d4f9b37d64df91eb55"><div class="ttname"><a href="avrndec_8c.html#a13191ba45577b1d4f9b37d64df91eb55">end</a></div><div class="ttdeci">static av_cold int end(AVCodecContext *avctx)</div><div class="ttdef"><b>Definition:</b> <a href="avrndec_8c_source.html#l00092">avrndec.c:92</a></div></div>
<div class="ttc" id="ahwcontext_8c_html_a66a7e1ebc7e459ce07d3de6639ac7e38"><div class="ttname"><a href="hwcontext_8c.html#a66a7e1ebc7e459ce07d3de6639ac7e38">av_hwframe_ctx_init</a></div><div class="ttdeci">int av_hwframe_ctx_init(AVBufferRef *ref)</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext_8c_source.html#l00333">hwcontext.c:333</a></div></div>
<div class="ttc" id="amem_8c_html_aadc230ece36ef112710b262a6601a16b"><div class="ttname"><a href="mem_8c.html#aadc230ece36ef112710b262a6601a16b">av_realloc_array</a></div><div class="ttdeci">void * av_realloc_array(void *ptr, size_t nmemb, size_t size)</div><div class="ttdef"><b>Definition:</b> <a href="mem_8c_source.html#l00198">mem.c:198</a></div></div>
<div class="ttc" id="astruct_a_v_region_of_interest_html_a3a7e57502405cc44afd3ff3693ef3389"><div class="ttname"><a href="struct_a_v_region_of_interest.html#a3a7e57502405cc44afd3ff3693ef3389">AVRegionOfInterest::right</a></div><div class="ttdeci">int right</div><div class="ttdef"><b>Definition:</b> <a href="frame_8h_source.html#l00251">frame.h:251</a></div></div>
<div class="ttc" id="apixdesc_8h_html"><div class="ttname"><a href="pixdesc_8h.html">pixdesc.h</a></div></div>
<div class="ttc" id="ahwcontext_8c_html_ac45a7c039eb4e084b692f69ff5f2e217"><div class="ttname"><a href="hwcontext_8c.html#ac45a7c039eb4e084b692f69ff5f2e217">av_hwframe_ctx_alloc</a></div><div class="ttdeci">AVBufferRef * av_hwframe_ctx_alloc(AVBufferRef *device_ref_in)</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext_8c_source.html#l00247">hwcontext.c:247</a></div></div>
<div class="ttc" id="aencode_8h_html"><div class="ttname"><a href="encode_8h.html">encode.h</a></div></div>
<div class="ttc" id="amxf_8c_html_a084824fc871e38157790c99ae1240842"><div class="ttname"><a href="mxf_8c.html#a084824fc871e38157790c99ae1240842">data</a></div><div class="ttdeci">const char data[16]</div><div class="ttdef"><b>Definition:</b> <a href="mxf_8c_source.html#l00151">mxf.c:151</a></div></div>
<div class="ttc" id="astruct_v_a_a_p_i_encode_picture_html_a459df71dd956fce38da5710b840084ec"><div class="ttname"><a href="struct_v_a_a_p_i_encode_picture.html#a459df71dd956fce38da5710b840084ec">VAAPIEncodePicture::encode_issued</a></div><div class="ttdeci">int encode_issued</div><div class="ttdef"><b>Definition:</b> <a href="vaapi__encode_8h_source.html#l00087">vaapi_encode.h:87</a></div></div>
<div class="ttc" id="agroup__lavu__log__constants_html_ga9b58b28e2d429b930b69db19877f76a8"><div class="ttname"><a href="group__lavu__log__constants.html#ga9b58b28e2d429b930b69db19877f76a8">AV_LOG_VERBOSE</a></div><div class="ttdeci">#define AV_LOG_VERBOSE</div><div class="ttdef"><b>Definition:</b> <a href="log_8h_source.html#l00210">log.h:210</a></div></div>
<div class="ttc" id="astruct_a_v_region_of_interest_html_a66cec26997f55f6ac16822f5a6ea3100"><div class="ttname"><a href="struct_a_v_region_of_interest.html#a66cec26997f55f6ac16822f5a6ea3100">AVRegionOfInterest::left</a></div><div class="ttdeci">int left</div><div class="ttdef"><b>Definition:</b> <a href="frame_8h_source.html#l00250">frame.h:250</a></div></div>
<div class="ttc" id="alibavcodec_2vaapi__encode_8c_html_ac75ceee4c1b5bb20cff6639320bccf32"><div class="ttname"><a href="libavcodec_2vaapi__encode_8c.html#ac75ceee4c1b5bb20cff6639320bccf32">ff_vaapi_encode_close</a></div><div class="ttdeci">av_cold int ff_vaapi_encode_close(AVCodecContext *avctx)</div><div class="ttdef"><b>Definition:</b> <a href="libavcodec_2vaapi__encode_8c_source.html#l02528">vaapi_encode.c:2528</a></div></div>
<div class="ttc" id="agroup__lavu__buffer_html_ga3e7f4c92db85ccba0b2a16dd0069842a"><div class="ttname"><a href="group__lavu__buffer.html#ga3e7f4c92db85ccba0b2a16dd0069842a">av_buffer_create</a></div><div class="ttdeci">AVBufferRef * av_buffer_create(uint8_t *data, int size, void(*free)(void *opaque, uint8_t *data), void *opaque, int flags)</div><div class="ttdef"><b>Definition:</b> <a href="buffer_8c_source.html#l00029">buffer.c:29</a></div></div>
<div class="ttc" id="astruct_v_a_a_p_i_encode_r_t_format_html"><div class="ttname"><a href="struct_v_a_a_p_i_encode_r_t_format.html">VAAPIEncodeRTFormat</a></div><div class="ttdef"><b>Definition:</b> <a href="libavcodec_2vaapi__encode_8c_source.html#l01234">vaapi_encode.c:1234</a></div></div>
<div class="ttc" id="alibavcodec_2vaapi__encode_8c_html_a23d840a141775ab2176725b6a5d59f26"><div class="ttname"><a href="libavcodec_2vaapi__encode_8c.html#a23d840a141775ab2176725b6a5d59f26">vaapi_encode_init_rate_control</a></div><div class="ttdeci">static av_cold int vaapi_encode_init_rate_control(AVCodecContext *avctx)</div><div class="ttdef"><b>Definition:</b> <a href="libavcodec_2vaapi__encode_8c_source.html#l01493">vaapi_encode.c:1493</a></div></div>
<div class="ttc" id="ahwcontext_8c_html_a80f4c1184e1758150b6d9bc0adf2c1df"><div class="ttname"><a href="hwcontext_8c.html#a80f4c1184e1758150b6d9bc0adf2c1df">av_hwdevice_get_hwframe_constraints</a></div><div class="ttdeci">AVHWFramesConstraints * av_hwdevice_get_hwframe_constraints(AVBufferRef *ref, const void *hwconfig)</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext_8c_source.html#l00576">hwcontext.c:576</a></div></div>
<div class="ttc" id="avaapi__encode_8h_html_a99fb83031ce9923c84392b4e92f956b5a0211927b756afaa318c53c3c9e94a253"><div class="ttname"><a href="vaapi__encode_8h.html#a99fb83031ce9923c84392b4e92f956b5a0211927b756afaa318c53c3c9e94a253">RC_MODE_ICQ</a></div><div class="ttdeci">@ RC_MODE_ICQ</div><div class="ttdef"><b>Definition:</b> <a href="vaapi__encode_8h_source.html#l00150">vaapi_encode.h:150</a></div></div>
<div class="ttc" id="agroup__lavc__packet_html_ga75603d7c2b8adf5829f4fd2fb860168f"><div class="ttname"><a href="group__lavc__packet.html#ga75603d7c2b8adf5829f4fd2fb860168f">AV_PKT_FLAG_KEY</a></div><div class="ttdeci">#define AV_PKT_FLAG_KEY</div><div class="ttdoc">The packet contains a keyframe.</div><div class="ttdef"><b>Definition:</b> <a href="packet_8h_source.html#l00401">packet.h:401</a></div></div>
<div class="ttc" id="arate__distortion_8txt_html_a098873585d16d8a7349bd6424684d45c"><div class="ttname"><a href="rate__distortion_8txt.html#a098873585d16d8a7349bd6424684d45c">quality</a></div><div class="ttdeci">trying all byte sequences megabyte in length and selecting the best looking sequence will yield cases to try But a word about quality</div><div class="ttdef"><b>Definition:</b> <a href="rate__distortion_8txt_source.html#l00012">rate_distortion.txt:12</a></div></div>
<div class="ttc" id="astruct_v_a_a_p_i_encode_picture_html_a03ac94018185f0c41753766088b3951b"><div class="ttname"><a href="struct_v_a_a_p_i_encode_picture.html#a03ac94018185f0c41753766088b3951b">VAAPIEncodePicture::recon_image</a></div><div class="ttdeci">AVFrame * recon_image</div><div class="ttdef"><b>Definition:</b> <a href="vaapi__encode_8h_source.html#l00093">vaapi_encode.h:93</a></div></div>
<div class="ttc" id="astruct_a_v_region_of_interest_html"><div class="ttname"><a href="struct_a_v_region_of_interest.html">AVRegionOfInterest</a></div><div class="ttdef"><b>Definition:</b> <a href="frame_8h_source.html#l00233">frame.h:233</a></div></div>
<div class="ttc" id="astruct_a_v_packet_html_aaf4fe58dfcc7c232c1f2268b539d8367"><div class="ttname"><a href="struct_a_v_packet.html#aaf4fe58dfcc7c232c1f2268b539d8367">AVPacket::data</a></div><div class="ttdeci">uint8_t * data</div><div class="ttdef"><b>Definition:</b> <a href="packet_8h_source.html#l00363">packet.h:363</a></div></div>
<div class="ttc" id="atableprint__vlc_8h_html_ae97db1f58b6b1515ed57a83bea3dd572"><div class="ttname"><a href="tableprint__vlc_8h.html#ae97db1f58b6b1515ed57a83bea3dd572">av_malloc</a></div><div class="ttdeci">#define av_malloc(s)</div><div class="ttdef"><b>Definition:</b> <a href="tableprint__vlc_8h_source.html#l00031">tableprint_vlc.h:31</a></div></div>
<div class="ttc" id="agroup__lavc__core_html_ga9ed82634c59b339786575827c47a8f68"><div class="ttname"><a href="group__lavc__core.html#ga9ed82634c59b339786575827c47a8f68">AV_CODEC_FLAG_GLOBAL_HEADER</a></div><div class="ttdeci">#define AV_CODEC_FLAG_GLOBAL_HEADER</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l00329">avcodec.h:329</a></div></div>
<div class="ttc" id="astruct_v_a_a_p_i_encode_picture_html_a71966a0785a63842d1e1a0ce91b0578f"><div class="ttname"><a href="struct_v_a_a_p_i_encode_picture.html#a71966a0785a63842d1e1a0ce91b0578f">VAAPIEncodePicture::b_depth</a></div><div class="ttdeci">int b_depth</div><div class="ttdef"><b>Definition:</b> <a href="vaapi__encode_8h_source.html#l00086">vaapi_encode.h:86</a></div></div>
<div class="ttc" id="astruct_a_v_codec_context_html_ae246ca7a1c72c151891ed0599e8dbfba"><div class="ttname"><a href="struct_a_v_codec_context.html#ae246ca7a1c72c151891ed0599e8dbfba">AVCodecContext::extradata_size</a></div><div class="ttdeci">int extradata_size</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l00628">avcodec.h:628</a></div></div>
<div class="ttc" id="avaapi__encode_8h_html_abc6126af1d45847bc59afa0aa3216b04a4894ca430a745f72a320a8510f49abbf"><div class="ttname"><a href="vaapi__encode_8h.html#abc6126af1d45847bc59afa0aa3216b04a4894ca430a745f72a320a8510f49abbf">FLAG_B_PICTURES</a></div><div class="ttdeci">@ FLAG_B_PICTURES</div><div class="ttdef"><b>Definition:</b> <a href="vaapi__encode_8h_source.html#l00358">vaapi_encode.h:358</a></div></div>
<div class="ttc" id="astruct_a_v_h_w_frames_constraints_html_a3f1aec6d1c90f77837875c2a3598be46"><div class="ttname"><a href="struct_a_v_h_w_frames_constraints.html#a3f1aec6d1c90f77837875c2a3598be46">AVHWFramesConstraints::min_height</a></div><div class="ttdeci">int min_height</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext_8h_source.html#l00472">hwcontext.h:472</a></div></div>
<div class="ttc" id="astruct_v_a_a_p_i_encode_picture_html_a0b5603bae3f5d92488a246b62b7393e6"><div class="ttname"><a href="struct_v_a_a_p_i_encode_picture.html#a0b5603bae3f5d92488a246b62b7393e6">VAAPIEncodePicture::codec_picture_params</a></div><div class="ttdeci">void * codec_picture_params</div><div class="ttdef"><b>Definition:</b> <a href="vaapi__encode_8h_source.html#l00103">vaapi_encode.h:103</a></div></div>
<div class="ttc" id="astruct_a_v_codec_context_html_a9b6b3f1fcbdcc2ad9f4dbb4370496e38"><div class="ttname"><a href="struct_a_v_codec_context.html#a9b6b3f1fcbdcc2ad9f4dbb4370496e38">AVCodecContext::gop_size</a></div><div class="ttdeci">int gop_size</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l00721">avcodec.h:721</a></div></div>
<div class="ttc" id="agroup__avoptions_html_gga06fc87d81c62e9abb8790b6e5713c55babfcf96f0d71b49b261c0948d031c127a"><div class="ttname"><a href="group__avoptions.html#gga06fc87d81c62e9abb8790b6e5713c55babfcf96f0d71b49b261c0948d031c127a">MAX_GLOBAL_PARAMS</a></div><div class="ttdeci">@ MAX_GLOBAL_PARAMS</div><div class="ttdef"><b>Definition:</b> <a href="vaapi__encode_8h_source.html#l00041">vaapi_encode.h:41</a></div></div>
<div class="ttc" id="avaapi__encode_8h_html"><div class="ttname"><a href="vaapi__encode_8h.html">vaapi_encode.h</a></div></div>
<div class="ttc" id="alibavcodec_2vaapi__encode_8c_html_ae0dfaf8475c426d4d3732e0f78f3fdf1"><div class="ttname"><a href="libavcodec_2vaapi__encode_8c.html#ae0dfaf8475c426d4d3732e0f78f3fdf1">vaapi_encode_init_gop_structure</a></div><div class="ttdeci">static av_cold int vaapi_encode_init_gop_structure(AVCodecContext *avctx)</div><div class="ttdef"><b>Definition:</b> <a href="libavcodec_2vaapi__encode_8c_source.html#l01823">vaapi_encode.c:1823</a></div></div>
<div class="ttc" id="alibavcodec_2vaapi__encode_8c_html_ae708ecb37d37d4bb364397a6abfe00a6"><div class="ttname"><a href="libavcodec_2vaapi__encode_8c.html#ae708ecb37d37d4bb364397a6abfe00a6">vaapi_encode_make_tile_slice</a></div><div class="ttdeci">static int vaapi_encode_make_tile_slice(AVCodecContext *avctx, VAAPIEncodePicture *pic)</div><div class="ttdef"><b>Definition:</b> <a href="libavcodec_2vaapi__encode_8c_source.html#l00221">vaapi_encode.c:221</a></div></div>
<div class="ttc" id="acheckasm_8h_html_a73a3b169ac8c3419cbe15327e75ffcfd"><div class="ttname"><a href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a></div><div class="ttdeci">#define fail()</div><div class="ttdef"><b>Definition:</b> <a href="checkasm_8h_source.html#l00123">checkasm.h:123</a></div></div>
<div class="ttc" id="astruct_a_v_format_context_html_a32379cc371463b235d54235d4af06a15"><div class="ttname"><a href="struct_a_v_format_context.html#a32379cc371463b235d54235d4af06a15">AVFormatContext::flags</a></div><div class="ttdeci">int flags</div><div class="ttdef"><b>Definition:</b> <a href="avformat_8h_source.html#l01354">avformat.h:1354</a></div></div>
<div class="ttc" id="astruct_v_a_a_p_i_encode_picture_html_a455b050a491e1ce16c0b80781643be42"><div class="ttname"><a href="struct_v_a_a_p_i_encode_picture.html#a455b050a491e1ce16c0b80781643be42">VAAPIEncodePicture::type</a></div><div class="ttdeci">int type</div><div class="ttdef"><b>Definition:</b> <a href="vaapi__encode_8h_source.html#l00085">vaapi_encode.h:85</a></div></div>
<div class="ttc" id="alibavcodec_2vaapi__encode_8c_html_aa909347b2105a5320def7f2e99f6851b"><div class="ttname"><a href="libavcodec_2vaapi__encode_8c.html#aa909347b2105a5320def7f2e99f6851b">vaapi_encode_pick_next</a></div><div class="ttdeci">static int vaapi_encode_pick_next(AVCodecContext *avctx, VAAPIEncodePicture **pic_out)</div><div class="ttdef"><b>Definition:</b> <a href="libavcodec_2vaapi__encode_8c_source.html#l00890">vaapi_encode.c:890</a></div></div>
<div class="ttc" id="awriting__filters_8txt_html_a860450fba1f740387dc082792ad89517"><div class="ttname"><a href="writing__filters_8txt.html#a860450fba1f740387dc082792ad89517">type</a></div><div class="ttdeci">it s the only field you need to keep assuming you have a context There is some magic you don t need to care about around this just let it vf type</div><div class="ttdef"><b>Definition:</b> <a href="writing__filters_8txt_source.html#l00086">writing_filters.txt:86</a></div></div>
<div class="ttc" id="alibavcodec_2vaapi__encode_8c_html_a1076a20e6356fecd75cca2f82df74a25"><div class="ttname"><a href="libavcodec_2vaapi__encode_8c.html#a1076a20e6356fecd75cca2f82df74a25">TRY_RC_MODE</a></div><div class="ttdeci">#define TRY_RC_MODE(mode, fail)</div></div>
<div class="ttc" id="astruct_a_v_region_of_interest_html_af07ce47d1c824676f790d95e23ff9caf"><div class="ttname"><a href="struct_a_v_region_of_interest.html#af07ce47d1c824676f790d95e23ff9caf">AVRegionOfInterest::top</a></div><div class="ttdeci">int top</div><div class="ttdef"><b>Definition:</b> <a href="frame_8h_source.html#l00248">frame.h:248</a></div></div>
<div class="ttc" id="agroup__lavu__math__rational_html_ga4fd9c0b8e663cf3d55e89fbc6ce71602"><div class="ttname"><a href="group__lavu__math__rational.html#ga4fd9c0b8e663cf3d55e89fbc6ce71602">av_reduce</a></div><div class="ttdeci">int av_reduce(int *dst_num, int *dst_den, int64_t num, int64_t den, int64_t max)</div><div class="ttdef"><b>Definition:</b> <a href="rational_8c_source.html#l00035">rational.c:35</a></div></div>
<div class="ttc" id="astruct_a_v_h_w_device_context_html"><div class="ttname"><a href="struct_a_v_h_w_device_context.html">AVHWDeviceContext</a></div><div class="ttdef"><b>Definition:</b> <a href="hwcontext_8h_source.html#l00061">hwcontext.h:61</a></div></div>
<div class="ttc" id="agroup__lavu__frame_html_gac700017c5270c79c1e1befdeeb008b2f"><div class="ttname"><a href="group__lavu__frame.html#gac700017c5270c79c1e1befdeeb008b2f">av_frame_alloc</a></div><div class="ttdeci">AVFrame * av_frame_alloc(void)</div><div class="ttdef"><b>Definition:</b> <a href="frame_8c_source.html#l00190">frame.c:190</a></div></div>
<div class="ttc" id="alibavcodec_2vaapi__encode_8c_html_ab77fff81bcff76be46e2b5dff426ea6a"><div class="ttname"><a href="libavcodec_2vaapi__encode_8c.html#ab77fff81bcff76be46e2b5dff426ea6a">vaapi_encode_rt_formats</a></div><div class="ttdeci">static const VAAPIEncodeRTFormat vaapi_encode_rt_formats[]</div><div class="ttdef"><b>Definition:</b> <a href="libavcodec_2vaapi__encode_8c_source.html#l01243">vaapi_encode.c:1243</a></div></div>
<div class="ttc" id="astruct_a_v_v_a_a_p_i_h_w_config_html"><div class="ttname"><a href="struct_a_v_v_a_a_p_i_h_w_config.html">AVVAAPIHWConfig</a></div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vaapi_8h_source.html#l00110">hwcontext_vaapi.h:110</a></div></div>
<div class="ttc" id="alibavcodec_2vaapi__encode_8c_html_acc021d89d7c70708bba85f7972610bf0"><div class="ttname"><a href="libavcodec_2vaapi__encode_8c.html#acc021d89d7c70708bba85f7972610bf0">picture_type_name</a></div><div class="ttdeci">static const char *const picture_type_name[]</div><div class="ttdef"><b>Definition:</b> <a href="libavcodec_2vaapi__encode_8c_source.html#l00036">vaapi_encode.c:36</a></div></div>
<div class="ttc" id="arate__distortion_8txt_html_a526861bf57e81f603c2201f788ae709c"><div class="ttname"><a href="rate__distortion_8txt.html#a526861bf57e81f603c2201f788ae709c">first</a></div><div class="ttdeci">trying all byte sequences megabyte in length and selecting the best looking sequence will yield cases to try But first</div><div class="ttdef"><b>Definition:</b> <a href="rate__distortion_8txt_source.html#l00012">rate_distortion.txt:12</a></div></div>
<div class="ttc" id="aavassert_8h_html"><div class="ttname"><a href="avassert_8h.html">avassert.h</a></div></div>
<div class="ttc" id="agroup__lavu__log__constants_html_gaffe151ff4cd8a24b2e77ac8d9616c85c"><div class="ttname"><a href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a></div><div class="ttdeci">#define AV_LOG_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="log_8h_source.html#l00194">log.h:194</a></div></div>
<div class="ttc" id="avaapi__encode_8h_html_abc6126af1d45847bc59afa0aa3216b04abe8e15036905c4de8a6355add509c896"><div class="ttname"><a href="vaapi__encode_8h.html#abc6126af1d45847bc59afa0aa3216b04abe8e15036905c4de8a6355add509c896">FLAG_NON_IDR_KEY_PICTURES</a></div><div class="ttdeci">@ FLAG_NON_IDR_KEY_PICTURES</div><div class="ttdef"><b>Definition:</b> <a href="vaapi__encode_8h_source.html#l00363">vaapi_encode.h:363</a></div></div>
<div class="ttc" id="aattributes_8h_html_abeeb324fff79a5335d36774704e2475c"><div class="ttname"><a href="attributes_8h.html#abeeb324fff79a5335d36774704e2475c">av_cold</a></div><div class="ttdeci">#define av_cold</div><div class="ttdef"><b>Definition:</b> <a href="attributes_8h_source.html#l00090">attributes.h:90</a></div></div>
<div class="ttc" id="astruct_v_a_a_p_i_encode_r_t_format_html_a06a9aff1ee4f4cd2233b52b0f2dcb44f"><div class="ttname"><a href="struct_v_a_a_p_i_encode_r_t_format.html#a06a9aff1ee4f4cd2233b52b0f2dcb44f">VAAPIEncodeRTFormat::nb_components</a></div><div class="ttdeci">int nb_components</div><div class="ttdef"><b>Definition:</b> <a href="libavcodec_2vaapi__encode_8c_source.html#l01238">vaapi_encode.c:1238</a></div></div>
<div class="ttc" id="astruct_v_a_a_p_i_encode_r_t_format_html_ac2a230d8bccbdcc1b84374c19c2d8104"><div class="ttname"><a href="struct_v_a_a_p_i_encode_r_t_format.html#ac2a230d8bccbdcc1b84374c19c2d8104">VAAPIEncodeRTFormat::log2_chroma_w</a></div><div class="ttdeci">int log2_chroma_w</div><div class="ttdef"><b>Definition:</b> <a href="libavcodec_2vaapi__encode_8c_source.html#l01239">vaapi_encode.c:1239</a></div></div>
<div class="ttc" id="agroup__lavu__bufferpool_html_ga2c745ecb4001452423e775b06b20fb7c"><div class="ttname"><a href="group__lavu__bufferpool.html#ga2c745ecb4001452423e775b06b20fb7c">av_buffer_pool_get</a></div><div class="ttdeci">AVBufferRef * av_buffer_pool_get(AVBufferPool *pool)</div><div class="ttdef"><b>Definition:</b> <a href="buffer_8c_source.html#l00364">buffer.c:364</a></div></div>
<div class="ttc" id="ahwcontext_8c_html_a29da7fa7ffa73266d1cbfccb116ed634"><div class="ttname"><a href="hwcontext_8c.html#a29da7fa7ffa73266d1cbfccb116ed634">av_hwframe_constraints_free</a></div><div class="ttdeci">void av_hwframe_constraints_free(AVHWFramesConstraints **constraints)</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext_8c_source.html#l00601">hwcontext.c:601</a></div></div>
<div class="ttc" id="agroup__lavc__packet_html_gadfa708660b85a56749c753124de2da7d"><div class="ttname"><a href="group__lavc__packet.html#gadfa708660b85a56749c753124de2da7d">av_new_packet</a></div><div class="ttdeci">int av_new_packet(AVPacket *pkt, int size)</div><div class="ttdef"><b>Definition:</b> <a href="avpacket_8c_source.html#l00088">avpacket.c:88</a></div></div>
<div class="ttc" id="agroup__lavu__buffer_html_gaa818f8f1011d69acc50c1f29cb85e576"><div class="ttname"><a href="group__lavu__buffer.html#gaa818f8f1011d69acc50c1f29cb85e576">AV_BUFFER_FLAG_READONLY</a></div><div class="ttdeci">#define AV_BUFFER_FLAG_READONLY</div><div class="ttdef"><b>Definition:</b> <a href="buffer_8h_source.html#l00113">buffer.h:113</a></div></div>
<div class="ttc" id="astruct_a_v_region_of_interest_html_a5c75595b7003be167ed674bf565654db"><div class="ttname"><a href="struct_a_v_region_of_interest.html#a5c75595b7003be167ed674bf565654db">AVRegionOfInterest::self_size</a></div><div class="ttdeci">uint32_t self_size</div><div class="ttdef"><b>Definition:</b> <a href="frame_8h_source.html#l00238">frame.h:238</a></div></div>
<div class="ttc" id="avaapi__encode_8h_html_a99fb83031ce9923c84392b4e92f956b5a5d5bf4fa66599951866951d97ce8897d"><div class="ttname"><a href="vaapi__encode_8h.html#a99fb83031ce9923c84392b4e92f956b5a5d5bf4fa66599951866951d97ce8897d">RC_MODE_CQP</a></div><div class="ttdeci">@ RC_MODE_CQP</div><div class="ttdef"><b>Definition:</b> <a href="vaapi__encode_8h_source.html#l00147">vaapi_encode.h:147</a></div></div>
<div class="ttc" id="alibavcodec_2vaapi__encode_8c_html_ac4748e44fc410421f3dbeb6b3889cb98"><div class="ttname"><a href="libavcodec_2vaapi__encode_8c.html#ac4748e44fc410421f3dbeb6b3889cb98">vaapi_encode_make_param_buffer</a></div><div class="ttdeci">static int vaapi_encode_make_param_buffer(AVCodecContext *avctx, VAAPIEncodePicture *pic, int type, char *data, size_t len)</div><div class="ttdef"><b>Definition:</b> <a href="libavcodec_2vaapi__encode_8c_source.html#l00084">vaapi_encode.c:84</a></div></div>
<div class="ttc" id="astruct_a_v_codec_context_html_ab015db3b7fcd227193a7c17283914187"><div class="ttname"><a href="struct_a_v_codec_context.html#ab015db3b7fcd227193a7c17283914187">AVCodecContext::qmax</a></div><div class="ttdeci">int qmax</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l01375">avcodec.h:1375</a></div></div>
<div class="ttc" id="aavcodec_8h_html_a1d8d03f5be975b8a728574cbdb00c896"><div class="ttname"><a href="avcodec_8h.html#a1d8d03f5be975b8a728574cbdb00c896">FF_PROFILE_UNKNOWN</a></div><div class="ttdeci">#define FF_PROFILE_UNKNOWN</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l01860">avcodec.h:1860</a></div></div>
<div class="ttc" id="aavassert_8h_html_aae204192396f78cc8c5cd7ad5c57c23f"><div class="ttname"><a href="avassert_8h.html#aae204192396f78cc8c5cd7ad5c57c23f">av_assert0</a></div><div class="ttdeci">#define av_assert0(cond)</div><div class="ttdef"><b>Definition:</b> <a href="avassert_8h_source.html#l00037">avassert.h:37</a></div></div>
<div class="ttc" id="astruct_a_v_h_w_frames_constraints_html_af220776925452091085139081d5d7251"><div class="ttname"><a href="struct_a_v_h_w_frames_constraints.html#af220776925452091085139081d5d7251">AVHWFramesConstraints::min_width</a></div><div class="ttdeci">int min_width</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext_8h_source.html#l00471">hwcontext.h:471</a></div></div>
<div class="ttc" id="agroup__lavu__log__constants_html_ga5b7221c3afd06848486776bd834a58a5"><div class="ttname"><a href="group__lavu__log__constants.html#ga5b7221c3afd06848486776bd834a58a5">AV_LOG_DEBUG</a></div><div class="ttdeci">#define AV_LOG_DEBUG</div><div class="ttdef"><b>Definition:</b> <a href="log_8h_source.html#l00215">log.h:215</a></div></div>
<div class="ttc" id="atests_2movenc_8c_html_a93cc7296f13f507c1fd7abd0db36b898"><div class="ttname"><a href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a></div><div class="ttdeci">AVFormatContext * ctx</div><div class="ttdef"><b>Definition:</b> <a href="tests_2movenc_8c_source.html#l00048">movenc.c:48</a></div></div>
<div class="ttc" id="astruct_a_v_h_w_frames_constraints_html_aabea88093c6f85d6185ffb0852a2217f"><div class="ttname"><a href="struct_a_v_h_w_frames_constraints.html#aabea88093c6f85d6185ffb0852a2217f">AVHWFramesConstraints::valid_sw_formats</a></div><div class="ttdeci">enum AVPixelFormat * valid_sw_formats</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext_8h_source.html#l00465">hwcontext.h:465</a></div></div>
<div class="ttc" id="astruct_a_v_packet_html_a73bde0a37f3b1efc839f11295bfbf42a"><div class="ttname"><a href="struct_a_v_packet.html#a73bde0a37f3b1efc839f11295bfbf42a">AVPacket::pts</a></div><div class="ttdeci">int64_t pts</div><div class="ttdef"><b>Definition:</b> <a href="packet_8h_source.html#l00356">packet.h:356</a></div></div>
<div class="ttc" id="alibavcodec_2vaapi__encode_8c_html_aa28619b3d9fec15b23657f531b1dd6ee"><div class="ttname"><a href="libavcodec_2vaapi__encode_8c.html#aa28619b3d9fec15b23657f531b1dd6ee">ff_vaapi_encode_receive_packet</a></div><div class="ttdeci">int ff_vaapi_encode_receive_packet(AVCodecContext *avctx, AVPacket *pkt)</div><div class="ttdef"><b>Definition:</b> <a href="libavcodec_2vaapi__encode_8c_source.html#l01154">vaapi_encode.c:1154</a></div></div>
<div class="ttc" id="alibavcodec_2vaapi__encode_8c_html_a95eb97478a252ece50e806fae0d6af9a"><div class="ttname"><a href="libavcodec_2vaapi__encode_8c.html#a95eb97478a252ece50e806fae0d6af9a">vaapi_encode_alloc</a></div><div class="ttdeci">static VAAPIEncodePicture * vaapi_encode_alloc(AVCodecContext *avctx)</div><div class="ttdef"><b>Definition:</b> <a href="libavcodec_2vaapi__encode_8c_source.html#l00711">vaapi_encode.c:711</a></div></div>
<div class="ttc" id="alibavcodec_2vaapi__encode_8c_html_a732dda14f455b15e7aaaa67b9b7361b5"><div class="ttname"><a href="libavcodec_2vaapi__encode_8c.html#a732dda14f455b15e7aaaa67b9b7361b5">vaapi_encode_set_b_pictures</a></div><div class="ttdeci">static void vaapi_encode_set_b_pictures(AVCodecContext *avctx, VAAPIEncodePicture *start, VAAPIEncodePicture *end, VAAPIEncodePicture *prev, int current_depth, VAAPIEncodePicture **last)</div><div class="ttdef"><b>Definition:</b> <a href="libavcodec_2vaapi__encode_8c_source.html#l00826">vaapi_encode.c:826</a></div></div>
<div class="ttc" id="alibavcodec_2vaapi__encode_8c_html_adf7f242bc5cabaadcf953e0d7feef8a1"><div class="ttname"><a href="libavcodec_2vaapi__encode_8c.html#adf7f242bc5cabaadcf953e0d7feef8a1">vaapi_encode_discard</a></div><div class="ttdeci">static int vaapi_encode_discard(AVCodecContext *avctx, VAAPIEncodePicture *pic)</div><div class="ttdef"><b>Definition:</b> <a href="libavcodec_2vaapi__encode_8c_source.html#l00694">vaapi_encode.c:694</a></div></div>
<div class="ttc" id="astruct_a_v_codec_context_html_aff4e6a78c0f08be43879644632e04b24"><div class="ttname"><a href="struct_a_v_codec_context.html#aff4e6a78c0f08be43879644632e04b24">AVCodecContext::slices</a></div><div class="ttdeci">int slices</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l01177">avcodec.h:1177</a></div></div>
<div class="ttc" id="afilter__design_8txt_html_a0e82f1088fdc24c14bf175d2ac77523f"><div class="ttname"><a href="filter__design_8txt.html#a0e82f1088fdc24c14bf175d2ac77523f">if</a></div><div class="ttdeci">if(ret)</div><div class="ttdef"><b>Definition:</b> <a href="filter__design_8txt_source.html#l00179">filter_design.txt:179</a></div></div>
<div class="ttc" id="agroup__avoptions_html_gga06fc87d81c62e9abb8790b6e5713c55baca65838438d536410bdc17544ec1531c"><div class="ttname"><a href="group__avoptions.html#gga06fc87d81c62e9abb8790b6e5713c55baca65838438d536410bdc17544ec1531c">MAX_DPB_SIZE</a></div><div class="ttdeci">@ MAX_DPB_SIZE</div><div class="ttdef"><b>Definition:</b> <a href="vaapi__encode_8h_source.html#l00042">vaapi_encode.h:42</a></div></div>
<div class="ttc" id="alibavcodec_2vaapi__encode_8c_html_a1a84f02361807d40eb1d95a5b951f478"><div class="ttname"><a href="libavcodec_2vaapi__encode_8c.html#a1a84f02361807d40eb1d95a5b951f478">vaapi_encode_add_ref</a></div><div class="ttdeci">static void vaapi_encode_add_ref(AVCodecContext *avctx, VAAPIEncodePicture *pic, VAAPIEncodePicture *target, int is_ref, int in_dpb, int prev)</div><div class="ttdef"><b>Definition:</b> <a href="libavcodec_2vaapi__encode_8c_source.html#l00766">vaapi_encode.c:766</a></div></div>
<div class="ttc" id="astruct_v_a_a_p_i_encode_picture_html_a766b1e3c4288cc9024524fee987c1fce"><div class="ttname"><a href="struct_v_a_a_p_i_encode_picture.html#a766b1e3c4288cc9024524fee987c1fce">VAAPIEncodePicture::is_reference</a></div><div class="ttdeci">int is_reference</div><div class="ttdef"><b>Definition:</b> <a href="vaapi__encode_8h_source.html#l00106">vaapi_encode.h:106</a></div></div>
<div class="ttc" id="alibavcodec_2vaapi__encode_8c_html_aace97d9deb0efcb149ce16fd6df0e08f"><div class="ttname"><a href="libavcodec_2vaapi__encode_8c.html#aace97d9deb0efcb149ce16fd6df0e08f">vaapi_encode_issue</a></div><div class="ttdeci">static int vaapi_encode_issue(AVCodecContext *avctx, VAAPIEncodePicture *pic)</div><div class="ttdef"><b>Definition:</b> <a href="libavcodec_2vaapi__encode_8c_source.html#l00248">vaapi_encode.c:248</a></div></div>
<div class="ttc" id="astruct_v_a_a_p_i_encode_picture_html_aad6dfdc9e90a4e8cda77793c499c6ef1"><div class="ttname"><a href="struct_v_a_a_p_i_encode_picture.html#aad6dfdc9e90a4e8cda77793c499c6ef1">VAAPIEncodePicture::slices</a></div><div class="ttdeci">VAAPIEncodeSlice * slices</div><div class="ttdef"><b>Definition:</b> <a href="vaapi__encode_8h_source.html#l00127">vaapi_encode.h:127</a></div></div>
<div class="ttc" id="astruct_a_v_packet_html_a437be96a9da675f12caa228a9c81bd82"><div class="ttname"><a href="struct_a_v_packet.html#a437be96a9da675f12caa228a9c81bd82">AVPacket::flags</a></div><div class="ttdeci">int flags</div><div class="ttdef"><b>Definition:</b> <a href="packet_8h_source.html#l00369">packet.h:369</a></div></div>
<div class="ttc" id="acoverity_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="coverity_8c_source.html#l00032">coverity.c:32</a></div></div>
<div class="ttc" id="astruct_v_a_a_p_i_encode_picture_html_a9201c92d265a5e6b5f0c3195e0b9f251"><div class="ttname"><a href="struct_v_a_a_p_i_encode_picture.html#a9201c92d265a5e6b5f0c3195e0b9f251">VAAPIEncodePicture::encode_complete</a></div><div class="ttdeci">int encode_complete</div><div class="ttdef"><b>Definition:</b> <a href="vaapi__encode_8h_source.html#l00088">vaapi_encode.h:88</a></div></div>
<div class="ttc" id="agroup__lavu__buffer_html_ga135e9e929b5033bb8f68322497b2effc"><div class="ttname"><a href="group__lavu__buffer.html#ga135e9e929b5033bb8f68322497b2effc">av_buffer_unref</a></div><div class="ttdeci">void av_buffer_unref(AVBufferRef **buf)</div><div class="ttdef"><b>Definition:</b> <a href="buffer_8c_source.html#l00125">buffer.c:125</a></div></div>
<div class="ttc" id="astruct_a_v_h_w_frames_context_html"><div class="ttname"><a href="struct_a_v_h_w_frames_context.html">AVHWFramesContext</a></div><div class="ttdef"><b>Definition:</b> <a href="hwcontext_8h_source.html#l00124">hwcontext.h:124</a></div></div>
<div class="ttc" id="astruct_v_a_a_p_i_encode_picture_html_a00607efbf6665511840f09b80e257f50"><div class="ttname"><a href="struct_v_a_a_p_i_encode_picture.html#a00607efbf6665511840f09b80e257f50">VAAPIEncodePicture::nb_dpb_pics</a></div><div class="ttdeci">int nb_dpb_pics</div><div class="ttdef"><b>Definition:</b> <a href="vaapi__encode_8h_source.html#l00111">vaapi_encode.h:111</a></div></div>
<div class="ttc" id="astruct_v_a_a_p_i_encode_picture_html_abbc37306887fd1c4d4978d75ece71864"><div class="ttname"><a href="struct_v_a_a_p_i_encode_picture.html#abbc37306887fd1c4d4978d75ece71864">VAAPIEncodePicture::nb_param_buffers</a></div><div class="ttdeci">int nb_param_buffers</div><div class="ttdef"><b>Definition:</b> <a href="vaapi__encode_8h_source.html#l00096">vaapi_encode.h:96</a></div></div>
<div class="ttc" id="agroup__lavu__picture_html_ggae6cbcab1f70d8e476757f1c1f5a0a78ea02be39f151a8ace7a65c86e13053e817"><div class="ttname"><a href="group__lavu__picture.html#ggae6cbcab1f70d8e476757f1c1f5a0a78ea02be39f151a8ace7a65c86e13053e817">AV_PICTURE_TYPE_I</a></div><div class="ttdeci">@ AV_PICTURE_TYPE_I</div><div class="ttdoc">Intra.</div><div class="ttdef"><b>Definition:</b> <a href="avutil_8h_source.html#l00274">avutil.h:274</a></div></div>
<div class="ttc" id="agroup__lavu__bufferpool_html_ga7b76781c5944b3bb59b2e3b1a8994e4a"><div class="ttname"><a href="group__lavu__bufferpool.html#ga7b76781c5944b3bb59b2e3b1a8994e4a">av_buffer_pool_uninit</a></div><div class="ttdeci">void av_buffer_pool_uninit(AVBufferPool **ppool)</div><div class="ttdef"><b>Definition:</b> <a href="buffer_8c_source.html#l00303">buffer.c:303</a></div></div>
<div class="ttc" id="alibavcodec_2vaapi__encode_8c_html_a6d05de653e5f9f59a791c6e4260f5e5e"><div class="ttname"><a href="libavcodec_2vaapi__encode_8c.html#a6d05de653e5f9f59a791c6e4260f5e5e">vaapi_encode_remove_refs</a></div><div class="ttdeci">static void vaapi_encode_remove_refs(AVCodecContext *avctx, VAAPIEncodePicture *pic, int level)</div><div class="ttdef"><b>Definition:</b> <a href="libavcodec_2vaapi__encode_8c_source.html#l00796">vaapi_encode.c:796</a></div></div>
<div class="ttc" id="astruct_v_a_a_p_i_encode_slice_html_a70db41297dea0624085ebbacc418262c"><div class="ttname"><a href="struct_v_a_a_p_i_encode_slice.html#a70db41297dea0624085ebbacc418262c">VAAPIEncodeSlice::index</a></div><div class="ttdeci">int index</div><div class="ttdef"><b>Definition:</b> <a href="vaapi__encode_8h_source.html#l00062">vaapi_encode.h:62</a></div></div>
<div class="ttc" id="astruct_v_a_a_p_i_encode_picture_html_a72a967758798eb575425db365946dfd6"><div class="ttname"><a href="struct_v_a_a_p_i_encode_picture.html#a72a967758798eb575425db365946dfd6">VAAPIEncodePicture::nb_slices</a></div><div class="ttdeci">int nb_slices</div><div class="ttdef"><b>Definition:</b> <a href="vaapi__encode_8h_source.html#l00126">vaapi_encode.h:126</a></div></div>
<div class="ttc" id="astruct_v_a_a_p_i_encode_picture_html_a0f6b20a3de817daa22251145f0967213"><div class="ttname"><a href="struct_v_a_a_p_i_encode_picture.html#a0f6b20a3de817daa22251145f0967213">VAAPIEncodePicture::refs</a></div><div class="ttdeci">struct VAAPIEncodePicture * refs[MAX_PICTURE_REFERENCES]</div><div class="ttdef"><b>Definition:</b> <a href="vaapi__encode_8h_source.html#l00116">vaapi_encode.h:116</a></div></div>
<div class="ttc" id="alibavcodec_2vaapi__encode_8c_html_a202ea7fe1efd977171c4dce7eab2f445"><div class="ttname"><a href="libavcodec_2vaapi__encode_8c.html#a202ea7fe1efd977171c4dce7eab2f445">vaapi_encode_alloc_output_buffer</a></div><div class="ttdeci">static AVBufferRef * vaapi_encode_alloc_output_buffer(void *opaque, int size)</div><div class="ttdef"><b>Definition:</b> <a href="libavcodec_2vaapi__encode_8c_source.html#l02236">vaapi_encode.c:2236</a></div></div>
<div class="ttc" id="astruct_a_v_pix_fmt_descriptor_html"><div class="ttname"><a href="struct_a_v_pix_fmt_descriptor.html">AVPixFmtDescriptor</a></div><div class="ttdef"><b>Definition:</b> <a href="pixdesc_8h_source.html#l00081">pixdesc.h:81</a></div></div>
<div class="ttc" id="agxfenc_8c_html_a750b5d744c39a06bfb13e6eb010e35d0"><div class="ttname"><a href="gxfenc_8c.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a></div><div class="ttdeci">int index</div><div class="ttdef"><b>Definition:</b> <a href="gxfenc_8c_source.html#l00089">gxfenc.c:89</a></div></div>
<div class="ttc" id="ah264pred__template_8c_html_a93cca9adbbca82ea00bf3250781f6dce"><div class="ttname"><a href="h264pred__template_8c.html#a93cca9adbbca82ea00bf3250781f6dce">for</a></div><div class="ttdeci">for(j=16;j &gt;0;--j)</div><div class="ttdef"><b>Definition:</b> <a href="h264pred__template_8c_source.html#l00469">h264pred_template.c:469</a></div></div>
<div class="ttc" id="astruct_a_v_h_w_frames_constraints_html"><div class="ttname"><a href="struct_a_v_h_w_frames_constraints.html">AVHWFramesConstraints</a></div><div class="ttdef"><b>Definition:</b> <a href="hwcontext_8h_source.html#l00453">hwcontext.h:453</a></div></div>
<div class="ttc" id="astruct_a_v_codec_context_html_a7abe7095de73df98df4895bf9e25fc6b"><div class="ttname"><a href="struct_a_v_codec_context.html#a7abe7095de73df98df4895bf9e25fc6b">AVCodecContext::profile</a></div><div class="ttdeci">int profile</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l01859">avcodec.h:1859</a></div></div>
<div class="ttc" id="agroup__lavu__mem__funcs_html_gaf143ecab33a3868b57345466c39de7c1"><div class="ttname"><a href="group__lavu__mem__funcs.html#gaf143ecab33a3868b57345466c39de7c1">av_mallocz</a></div><div class="ttdeci">void * av_mallocz(size_t size)</div><div class="ttdef"><b>Definition:</b> <a href="mem_8c_source.html#l00237">mem.c:237</a></div></div>
<div class="ttc" id="avaapi__encode_8h_html_a99fb83031ce9923c84392b4e92f956b5afc89ef74e8eb0a75ad568ae5217a1188"><div class="ttname"><a href="vaapi__encode_8h.html#a99fb83031ce9923c84392b4e92f956b5afc89ef74e8eb0a75ad568ae5217a1188">RC_MODE_AVBR</a></div><div class="ttdeci">@ RC_MODE_AVBR</div><div class="ttdef"><b>Definition:</b> <a href="vaapi__encode_8h_source.html#l00152">vaapi_encode.h:152</a></div></div>
<div class="ttc" id="alibavcodec_2vaapi__encode_8c_html_a5d0faa2fc51c873f9df92b0e5f23769c"><div class="ttname"><a href="libavcodec_2vaapi__encode_8c.html#a5d0faa2fc51c873f9df92b0e5f23769c">vaapi_encode_init_quality</a></div><div class="ttdeci">static av_cold int vaapi_encode_init_quality(AVCodecContext *avctx)</div><div class="ttdef"><b>Definition:</b> <a href="libavcodec_2vaapi__encode_8c_source.html#l02142">vaapi_encode.c:2142</a></div></div>
<div class="ttc" id="astruct_a_v_v_a_a_p_i_frames_context_html_a18c4ca9956227c498679a823e14e1375"><div class="ttname"><a href="struct_a_v_v_a_a_p_i_frames_context.html#a18c4ca9956227c498679a823e14e1375">AVVAAPIFramesContext::surface_ids</a></div><div class="ttdeci">VASurfaceID * surface_ids</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vaapi_8h_source.html#l00101">hwcontext_vaapi.h:101</a></div></div>
<div class="ttc" id="astruct_a_v_frame_side_data_html"><div class="ttname"><a href="struct_a_v_frame_side_data.html">AVFrameSideData</a></div><div class="ttdef"><b>Definition:</b> <a href="frame_8h_source.html#l00214">frame.h:214</a></div></div>
<div class="ttc" id="alibavcodec_2vaapi__encode_8c_html_a8064f29ddd1422812424eb17c3f2e93c"><div class="ttname"><a href="libavcodec_2vaapi__encode_8c.html#a8064f29ddd1422812424eb17c3f2e93c">vaapi_encode_make_misc_param_buffer</a></div><div class="ttdeci">static int vaapi_encode_make_misc_param_buffer(AVCodecContext *avctx, VAAPIEncodePicture *pic, int type, const void *data, size_t len)</div><div class="ttdef"><b>Definition:</b> <a href="libavcodec_2vaapi__encode_8c_source.html#l00112">vaapi_encode.c:112</a></div></div>
<div class="ttc" id="alibavcodec_2vaapi__encode_8c_html_ad722c5a88a31067be89908e7cc836066"><div class="ttname"><a href="libavcodec_2vaapi__encode_8c.html#ad722c5a88a31067be89908e7cc836066">vaapi_encode_rc_modes</a></div><div class="ttdeci">static const VAAPIEncodeRCMode vaapi_encode_rc_modes[]</div><div class="ttdef"><b>Definition:</b> <a href="libavcodec_2vaapi__encode_8c_source.html#l01472">vaapi_encode.c:1472</a></div></div>
<div class="ttc" id="astruct_v_a_a_p_i_encode_picture_html_a4c211c3d8a02e456836bf7c7102151b2"><div class="ttname"><a href="struct_v_a_a_p_i_encode_picture.html#a4c211c3d8a02e456836bf7c7102151b2">VAAPIEncodePicture::display_order</a></div><div class="ttdeci">int64_t display_order</div><div class="ttdef"><b>Definition:</b> <a href="vaapi__encode_8h_source.html#l00073">vaapi_encode.h:73</a></div></div>
<div class="ttc" id="agroup__avoptions_html_gga06fc87d81c62e9abb8790b6e5713c55ba225e072f2eba3d53c29d0b5f197d49ed"><div class="ttname"><a href="group__avoptions.html#gga06fc87d81c62e9abb8790b6e5713c55ba225e072f2eba3d53c29d0b5f197d49ed">AV_VAAPI_DRIVER_QUIRK_RENDER_PARAM_BUFFERS</a></div><div class="ttdeci">@ AV_VAAPI_DRIVER_QUIRK_RENDER_PARAM_BUFFERS</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vaapi_8h_source.html#l00047">hwcontext_vaapi.h:47</a></div></div>
<div class="ttc" id="astruct_v_a_a_p_i_encode_slice_html_a21f0b514e8ad6659f990543021c83326"><div class="ttname"><a href="struct_v_a_a_p_i_encode_slice.html#a21f0b514e8ad6659f990543021c83326">VAAPIEncodeSlice::block_size</a></div><div class="ttdeci">int block_size</div><div class="ttdef"><b>Definition:</b> <a href="vaapi__encode_8h_source.html#l00066">vaapi_encode.h:66</a></div></div>
<div class="ttc" id="astruct_a_v_codec_context_html_a4d08b297e97eefd66c714df4fff493c8"><div class="ttname"><a href="struct_a_v_codec_context.html#a4d08b297e97eefd66c714df4fff493c8">AVCodecContext::framerate</a></div><div class="ttdeci">AVRational framerate</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l02069">avcodec.h:2069</a></div></div>
<div class="ttc" id="astruct_a_v_codec_context_html_a0d8f46461754e8abea0847dcbc41b956"><div class="ttname"><a href="struct_a_v_codec_context.html#a0d8f46461754e8abea0847dcbc41b956">AVCodecContext::width</a></div><div class="ttdeci">int width</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l00699">avcodec.h:699</a></div></div>
<div class="ttc" id="astruct_a_v_codec_context_html_abb01e291550fa3fb96188af4d494587e"><div class="ttname"><a href="struct_a_v_codec_context.html#abb01e291550fa3fb96188af4d494587e">AVCodecContext::flags</a></div><div class="ttdeci">int flags</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l00606">avcodec.h:606</a></div></div>
<div class="ttc" id="astruct_a_v_packet_html_a85dbbd306b44b02390cd91c45e6a0f76"><div class="ttname"><a href="struct_a_v_packet.html#a85dbbd306b44b02390cd91c45e6a0f76">AVPacket::dts</a></div><div class="ttdeci">int64_t dts</div><div class="ttdef"><b>Definition:</b> <a href="packet_8h_source.html#l00362">packet.h:362</a></div></div>
<div class="ttc" id="astruct_a_v_codec_context_html_ab7bfeb9fa5840aac090e2b0bd0ef7589"><div class="ttname"><a href="struct_a_v_codec_context.html#ab7bfeb9fa5840aac090e2b0bd0ef7589">AVCodecContext::time_base</a></div><div class="ttdeci">AVRational time_base</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l00649">avcodec.h:649</a></div></div>
<div class="ttc" id="avaapi__encode_8h_html_a99fb83031ce9923c84392b4e92f956b5ab340a1cc2c507d4e6a23cc627a778451"><div class="ttname"><a href="vaapi__encode_8h.html#a99fb83031ce9923c84392b4e92f956b5ab340a1cc2c507d4e6a23cc627a778451">RC_MODE_QVBR</a></div><div class="ttdeci">@ RC_MODE_QVBR</div><div class="ttdef"><b>Definition:</b> <a href="vaapi__encode_8h_source.html#l00151">vaapi_encode.h:151</a></div></div>
<div class="ttc" id="astruct_v_a_a_p_i_encode_picture_html_a5ebeafc2d09071a391659e2acf38dda3"><div class="ttname"><a href="struct_v_a_a_p_i_encode_picture.html#a5ebeafc2d09071a391659e2acf38dda3">VAAPIEncodePicture::priv_data</a></div><div class="ttdeci">void * priv_data</div><div class="ttdef"><b>Definition:</b> <a href="vaapi__encode_8h_source.html#l00102">vaapi_encode.h:102</a></div></div>
<div class="ttc" id="astruct_a_v_buffer_ref_html"><div class="ttname"><a href="struct_a_v_buffer_ref.html">AVBufferRef</a></div><div class="ttdef"><b>Definition:</b> <a href="buffer_8h_source.html#l00081">buffer.h:81</a></div></div>
<div class="ttc" id="asdr2_8c_html_abd18f6ed7dc5da8824a97bc504e4280e"><div class="ttname"><a href="sdr2_8c.html#abd18f6ed7dc5da8824a97bc504e4280e">header</a></div><div class="ttdeci">static const uint8_t header[24]</div><div class="ttdef"><b>Definition:</b> <a href="sdr2_8c_source.html#l00067">sdr2.c:67</a></div></div>
<div class="ttc" id="acommon_8h_html_a0f84cbd7fd810cd678157c98cbfad4b0"><div class="ttname"><a href="common_8h.html#a0f84cbd7fd810cd678157c98cbfad4b0">FFMIN</a></div><div class="ttdeci">#define FFMIN(a, b)</div><div class="ttdef"><b>Definition:</b> <a href="common_8h_source.html#l00096">common.h:96</a></div></div>
<div class="ttc" id="astruct_v_a_a_p_i_encode_picture_html_af7067b239d6821ab286c9c268d1bb799"><div class="ttname"><a href="struct_v_a_a_p_i_encode_picture.html#af7067b239d6821ab286c9c268d1bb799">VAAPIEncodePicture::nb_refs</a></div><div class="ttdeci">int nb_refs</div><div class="ttdef"><b>Definition:</b> <a href="vaapi__encode_8h_source.html#l00115">vaapi_encode.h:115</a></div></div>
<div class="ttc" id="alibavcodec_2vaapi__encode_8c_html_af3ded04664e4b3943d78b437ad7bd1db"><div class="ttname"><a href="libavcodec_2vaapi__encode_8c.html#af3ded04664e4b3943d78b437ad7bd1db">vaapi_encode_init_packed_headers</a></div><div class="ttdeci">static av_cold int vaapi_encode_init_packed_headers(AVCodecContext *avctx)</div><div class="ttdef"><b>Definition:</b> <a href="libavcodec_2vaapi__encode_8c_source.html#l02082">vaapi_encode.c:2082</a></div></div>
<div class="ttc" id="amem_8c_html_aedc3761897b7e9ea8ae1222b3d013c94"><div class="ttname"><a href="mem_8c.html#aedc3761897b7e9ea8ae1222b3d013c94">av_mallocz_array</a></div><div class="ttdeci">void * av_mallocz_array(size_t nmemb, size_t size)</div><div class="ttdef"><b>Definition:</b> <a href="mem_8c_source.html#l00190">mem.c:190</a></div></div>
<div class="ttc" id="agroup__lavu__error_html_ga9c520e483ba8648495620ffdb4c491f2"><div class="ttname"><a href="group__lavu__error.html#ga9c520e483ba8648495620ffdb4c491f2">AVERROR_EXTERNAL</a></div><div class="ttdeci">#define AVERROR_EXTERNAL</div><div class="ttdoc">Generic error in an external library.</div><div class="ttdef"><b>Definition:</b> <a href="error_8h_source.html#l00057">error.h:57</a></div></div>
<div class="ttc" id="alibavcodec_2vaapi__encode_8c_html_a0c77b63d3a425bbc13899110282edb13"><div class="ttname"><a href="libavcodec_2vaapi__encode_8c.html#a0c77b63d3a425bbc13899110282edb13">vaapi_encode_create_recon_frames</a></div><div class="ttdeci">static av_cold int vaapi_encode_create_recon_frames(AVCodecContext *avctx)</div><div class="ttdef"><b>Definition:</b> <a href="libavcodec_2vaapi__encode_8c_source.html#l02273">vaapi_encode.c:2273</a></div></div>
<div class="ttc" id="astruct_v_a_a_p_i_encode_r_t_format_html_a11e1aa11797c944271be7eb2b5b3feb6"><div class="ttname"><a href="struct_v_a_a_p_i_encode_r_t_format.html#a11e1aa11797c944271be7eb2b5b3feb6">VAAPIEncodeRTFormat::name</a></div><div class="ttdeci">const char * name</div><div class="ttdef"><b>Definition:</b> <a href="libavcodec_2vaapi__encode_8c_source.html#l01235">vaapi_encode.c:1235</a></div></div>
<div class="ttc" id="astruct_v_a_a_p_i_encode_profile_html"><div class="ttname"><a href="struct_v_a_a_p_i_encode_profile.html">VAAPIEncodeProfile</a></div><div class="ttdef"><b>Definition:</b> <a href="vaapi__encode_8h_source.html#l00130">vaapi_encode.h:130</a></div></div>
<div class="ttc" id="astruct_a_v_codec_context_html_aa2b5582f1a360534310b686cc3f7c668"><div class="ttname"><a href="struct_a_v_codec_context.html#aa2b5582f1a360534310b686cc3f7c668">AVCodecContext::rc_max_rate</a></div><div class="ttdeci">int64_t rc_max_rate</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l01404">avcodec.h:1404</a></div></div>
<div class="ttc" id="apixfmt_8h_html_a9a8e335cf3be472042bc9f0cf80cd4c5abb09cadf3b2d6b5ce5980401bcf638a8"><div class="ttname"><a href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5abb09cadf3b2d6b5ce5980401bcf638a8">AV_PIX_FMT_VAAPI</a></div><div class="ttdeci">@ AV_PIX_FMT_VAAPI</div><div class="ttdef"><b>Definition:</b> <a href="pixfmt_8h_source.html#l00122">pixfmt.h:122</a></div></div>
<div class="ttc" id="aintmath_8h_html_a2998e3360a5d1a5763e8c1008b7b2e1d"><div class="ttname"><a href="intmath_8h.html#a2998e3360a5d1a5763e8c1008b7b2e1d">av_log2</a></div><div class="ttdeci">#define av_log2</div><div class="ttdef"><b>Definition:</b> <a href="intmath_8h_source.html#l00083">intmath.h:83</a></div></div>
<div class="ttc" id="alibavcodec_2vaapi__encode_8c_html_a39fd61d4df4898b7ae3ae638065ef008"><div class="ttname"><a href="libavcodec_2vaapi__encode_8c.html#a39fd61d4df4898b7ae3ae638065ef008">vaapi_encode_free</a></div><div class="ttdeci">static int vaapi_encode_free(AVCodecContext *avctx, VAAPIEncodePicture *pic)</div><div class="ttdef"><b>Definition:</b> <a href="libavcodec_2vaapi__encode_8c_source.html#l00735">vaapi_encode.c:735</a></div></div>
<div class="ttc" id="astruct_v_a_a_p_i_encode_picture_html_a83158ec0aff37a9b2337525a0d4b7b0c"><div class="ttname"><a href="struct_v_a_a_p_i_encode_picture.html#a83158ec0aff37a9b2337525a0d4b7b0c">VAAPIEncodePicture::dpb</a></div><div class="ttdeci">struct VAAPIEncodePicture * dpb[MAX_DPB_SIZE]</div><div class="ttdef"><b>Definition:</b> <a href="vaapi__encode_8h_source.html#l00112">vaapi_encode.h:112</a></div></div>
<div class="ttc" id="ahwconfig_8h_html_a67594da711e5397d009cef8b48cd8001"><div class="ttname"><a href="hwconfig_8h.html#a67594da711e5397d009cef8b48cd8001">HW_CONFIG_ENCODER_FRAMES</a></div><div class="ttdeci">#define HW_CONFIG_ENCODER_FRAMES(format, device_type_)</div><div class="ttdef"><b>Definition:</b> <a href="hwconfig_8h_source.html#l00099">hwconfig.h:99</a></div></div>
<div class="ttc" id="avaapi__encode_8h_html_adf764cbdea00d65edcd07bb9953ad2b7a653f32daa38a2adc6d8abebcfdf44173"><div class="ttname"><a href="vaapi__encode_8h.html#adf764cbdea00d65edcd07bb9953ad2b7a653f32daa38a2adc6d8abebcfdf44173">PICTURE_TYPE_P</a></div><div class="ttdeci">@ PICTURE_TYPE_P</div><div class="ttdef"><b>Definition:</b> <a href="vaapi__encode_8h_source.html#l00057">vaapi_encode.h:57</a></div></div>
<div class="ttc" id="astruct_a_v_v_a_a_p_i_h_w_config_html_a0ecea446600eeb1b7e93733317adbc98"><div class="ttname"><a href="struct_a_v_v_a_a_p_i_h_w_config.html#a0ecea446600eeb1b7e93733317adbc98">AVVAAPIHWConfig::config_id</a></div><div class="ttdeci">VAConfigID config_id</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vaapi_8h_source.html#l00114">hwcontext_vaapi.h:114</a></div></div>
<div class="ttc" id="astruct_v_a_a_p_i_encode_context_html"><div class="ttname"><a href="struct_v_a_a_p_i_encode_context.html">VAAPIEncodeContext</a></div><div class="ttdef"><b>Definition:</b> <a href="vaapi__encode_8h_source.html#l00175">vaapi_encode.h:175</a></div></div>
<div class="ttc" id="alibavcodec_2vaapi__encode_8c_html_aa76fb15aa754ab120b139f4e6fd362ba"><div class="ttname"><a href="libavcodec_2vaapi__encode_8c.html#aa76fb15aa754ab120b139f4e6fd362ba">vaapi_encode_free_output_buffer</a></div><div class="ttdeci">static void vaapi_encode_free_output_buffer(void *opaque, uint8_t *data)</div><div class="ttdef"><b>Definition:</b> <a href="libavcodec_2vaapi__encode_8c_source.html#l02222">vaapi_encode.c:2222</a></div></div>
<div class="ttc" id="ainput_8c_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="input_8c_source.html#l00407">input.c:407</a></div></div>
<div class="ttc" id="alibavcodec_2vaapi__encode_8c_html_ac5d061eefc94230d7f0145743db6e543"><div class="ttname"><a href="libavcodec_2vaapi__encode_8c.html#ac5d061eefc94230d7f0145743db6e543">vaapi_encode_check_frame</a></div><div class="ttdeci">static int vaapi_encode_check_frame(AVCodecContext *avctx, const AVFrame *frame)</div><div class="ttdef"><b>Definition:</b> <a href="libavcodec_2vaapi__encode_8c_source.html#l01062">vaapi_encode.c:1062</a></div></div>
<div class="ttc" id="avaapi__encode_8h_html_adf764cbdea00d65edcd07bb9953ad2b7ab56d9a8ef94cff8f64aff4c9f115503a"><div class="ttname"><a href="vaapi__encode_8h.html#adf764cbdea00d65edcd07bb9953ad2b7ab56d9a8ef94cff8f64aff4c9f115503a">PICTURE_TYPE_IDR</a></div><div class="ttdeci">@ PICTURE_TYPE_IDR</div><div class="ttdef"><b>Definition:</b> <a href="vaapi__encode_8h_source.html#l00055">vaapi_encode.h:55</a></div></div>
<div class="ttc" id="astruct_v_a_a_p_i_encode_slice_html"><div class="ttname"><a href="struct_v_a_a_p_i_encode_slice.html">VAAPIEncodeSlice</a></div><div class="ttdef"><b>Definition:</b> <a href="vaapi__encode_8h_source.html#l00061">vaapi_encode.h:61</a></div></div>
<div class="ttc" id="alog_8h_html"><div class="ttname"><a href="log_8h.html">log.h</a></div></div>
<div class="ttc" id="astruct_a_v_region_of_interest_html_ae7421571aad4d48b63e91274ba424ee0"><div class="ttname"><a href="struct_a_v_region_of_interest.html#ae7421571aad4d48b63e91274ba424ee0">AVRegionOfInterest::qoffset</a></div><div class="ttdeci">AVRational qoffset</div><div class="ttdef"><b>Definition:</b> <a href="frame_8h_source.html#l00275">frame.h:275</a></div></div>
<div class="ttc" id="acommon_8h_html"><div class="ttname"><a href="common_8h.html">common.h</a></div></div>
<div class="ttc" id="astruct_v_a_a_p_i_encode_r_t_format_html_a8f43c72041a58d7dbd6a2f20564f0647"><div class="ttname"><a href="struct_v_a_a_p_i_encode_r_t_format.html#a8f43c72041a58d7dbd6a2f20564f0647">VAAPIEncodeRTFormat::log2_chroma_h</a></div><div class="ttdeci">int log2_chroma_h</div><div class="ttdef"><b>Definition:</b> <a href="libavcodec_2vaapi__encode_8c_source.html#l01240">vaapi_encode.c:1240</a></div></div>
<div class="ttc" id="agroup__lavu__frame_html_ga709e62bc2917ffd84c5c0f4e1dfc48f7"><div class="ttname"><a href="group__lavu__frame.html#ga709e62bc2917ffd84c5c0f4e1dfc48f7">av_frame_move_ref</a></div><div class="ttdeci">void av_frame_move_ref(AVFrame *dst, AVFrame *src)</div><div class="ttdef"><b>Definition:</b> <a href="frame_8c_source.html#l00582">frame.c:582</a></div></div>
<div class="ttc" id="aaudio__convert_8c_html_ae1affc9ca37cfb624959c866a73f83c2"><div class="ttname"><a href="audio__convert_8c.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a></div><div class="ttdeci">uint8_t</div><div class="ttdef"><b>Definition:</b> <a href="audio__convert_8c_source.html#l00194">audio_convert.c:194</a></div></div>
<div class="ttc" id="astruct_v_a_a_p_i_encode_picture_html"><div class="ttname"><a href="struct_v_a_a_p_i_encode_picture.html">VAAPIEncodePicture</a></div><div class="ttdef"><b>Definition:</b> <a href="vaapi__encode_8h_source.html#l00070">vaapi_encode.h:70</a></div></div>
<div class="ttc" id="avaapi__encode_8h_html_adf764cbdea00d65edcd07bb9953ad2b7acc8409d697602a190af45b91bb061624"><div class="ttname"><a href="vaapi__encode_8h.html#adf764cbdea00d65edcd07bb9953ad2b7acc8409d697602a190af45b91bb061624">PICTURE_TYPE_I</a></div><div class="ttdeci">@ PICTURE_TYPE_I</div><div class="ttdef"><b>Definition:</b> <a href="vaapi__encode_8h_source.html#l00056">vaapi_encode.h:56</a></div></div>
<div class="ttc" id="agroup__avoptions_html_gga06fc87d81c62e9abb8790b6e5713c55baed0269e9bae5024423f71b1f7454bd01"><div class="ttname"><a href="group__avoptions.html#gga06fc87d81c62e9abb8790b6e5713c55baed0269e9bae5024423f71b1f7454bd01">MAX_PARAM_BUFFER_SIZE</a></div><div class="ttdeci">@ MAX_PARAM_BUFFER_SIZE</div><div class="ttdef"><b>Definition:</b> <a href="vaapi__encode_8h_source.html#l00045">vaapi_encode.h:45</a></div></div>
<div class="ttc" id="avorbis__enc__data_8h_html_afed088663f8704004425cdae2120b9b3"><div class="ttname"><a href="vorbis__enc__data_8h.html#afed088663f8704004425cdae2120b9b3">len</a></div><div class="ttdeci">int len</div><div class="ttdef"><b>Definition:</b> <a href="vorbis__enc__data_8h_source.html#l00452">vorbis_enc_data.h:452</a></div></div>
<div class="ttc" id="agroup__lavu__bufferpool_html_ga615151c8889d5be39d17bce4d8c65117"><div class="ttname"><a href="group__lavu__bufferpool.html#ga615151c8889d5be39d17bce4d8c65117">av_buffer_pool_init2</a></div><div class="ttdeci">AVBufferPool * av_buffer_pool_init2(int size, void *opaque, AVBufferRef *(*alloc)(void *opaque, int size), void(*pool_free)(void *opaque))</div><div class="ttdef"><b>Definition:</b> <a href="buffer_8c_source.html#l00245">buffer.c:245</a></div></div>
<div class="ttc" id="astruct_v_a_a_p_i_encode_picture_html_a9a8f3647d559171b4dde7983752f9231"><div class="ttname"><a href="struct_v_a_a_p_i_encode_picture.html#a9a8f3647d559171b4dde7983752f9231">VAAPIEncodePicture::roi</a></div><div class="ttdeci">void * roi</div><div class="ttdef"><b>Definition:</b> <a href="vaapi__encode_8h_source.html#l00082">vaapi_encode.h:82</a></div></div>
<div class="ttc" id="aavcodec_8h_html"><div class="ttname"><a href="avcodec_8h.html">avcodec.h</a></div></div>
<div class="ttc" id="avaapi__encode_8h_html_abc6126af1d45847bc59afa0aa3216b04a5b3e6d5c03c045f30ecaef927f8b35a2"><div class="ttname"><a href="vaapi__encode_8h.html#abc6126af1d45847bc59afa0aa3216b04a5b3e6d5c03c045f30ecaef927f8b35a2">FLAG_CONSTANT_QUALITY_ONLY</a></div><div class="ttdeci">@ FLAG_CONSTANT_QUALITY_ONLY</div><div class="ttdef"><b>Definition:</b> <a href="vaapi__encode_8h_source.html#l00354">vaapi_encode.h:354</a></div></div>
<div class="ttc" id="alibavcodec_2vaapi__encode_8c_html_a35f8a0672b026556d23848415260b9e3"><div class="ttname"><a href="libavcodec_2vaapi__encode_8c.html#a35f8a0672b026556d23848415260b9e3">ff_vaapi_encode_hw_configs</a></div><div class="ttdeci">const AVCodecHWConfigInternal *const ff_vaapi_encode_hw_configs[]</div><div class="ttdef"><b>Definition:</b> <a href="libavcodec_2vaapi__encode_8c_source.html#l00031">vaapi_encode.c:31</a></div></div>
<div class="ttc" id="agroup__lavc__core_html_ga4444b40e467199423bba5cf5ac791c49"><div class="ttname"><a href="group__lavc__core.html#ga4444b40e467199423bba5cf5ac791c49">AV_CODEC_FLAG_CLOSED_GOP</a></div><div class="ttdeci">#define AV_CODEC_FLAG_CLOSED_GOP</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l00343">avcodec.h:343</a></div></div>
<div class="ttc" id="astruct_v_a_a_p_i_encode_picture_html_ab2e74518853179b0afc82386e65c014e"><div class="ttname"><a href="struct_v_a_a_p_i_encode_picture.html#ab2e74518853179b0afc82386e65c014e">VAAPIEncodePicture::input_surface</a></div><div class="ttdeci">VASurfaceID input_surface</div><div class="ttdef"><b>Definition:</b> <a href="vaapi__encode_8h_source.html#l00091">vaapi_encode.h:91</a></div></div>
<div class="ttc" id="alibavcodec_2vaapi__encode_8c_html_ab55f58e120cb3bc6c0c7ab82385bc6d1"><div class="ttname"><a href="libavcodec_2vaapi__encode_8c.html#ab55f58e120cb3bc6c0c7ab82385bc6d1">ff_vaapi_encode_init</a></div><div class="ttdeci">av_cold int ff_vaapi_encode_init(AVCodecContext *avctx)</div><div class="ttdef"><b>Definition:</b> <a href="libavcodec_2vaapi__encode_8c_source.html#l02361">vaapi_encode.c:2361</a></div></div>
<div class="ttc" id="afilter__design_8txt_html_af1ec77bdca1b30e8153fc5da88f603db"><div class="ttname"><a href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a></div><div class="ttdeci">ret</div><div class="ttdef"><b>Definition:</b> <a href="filter__design_8txt_source.html#l00187">filter_design.txt:187</a></div></div>
<div class="ttc" id="alibavcodec_2vaapi__encode_8c_html_a5c62d3b58fc2a9ef2511250f2745452a"><div class="ttname"><a href="libavcodec_2vaapi__encode_8c.html#a5c62d3b58fc2a9ef2511250f2745452a">vaapi_encode_add_global_param</a></div><div class="ttdeci">static av_cold void vaapi_encode_add_global_param(AVCodecContext *avctx, int type, void *buffer, size_t size)</div><div class="ttdef"><b>Definition:</b> <a href="libavcodec_2vaapi__encode_8c_source.html#l01220">vaapi_encode.c:1220</a></div></div>
<div class="ttc" id="alibavcodec_2vaapi__encode_8c_html_aed53f0bcf39d848d68a62ed83da063c8"><div class="ttname"><a href="libavcodec_2vaapi__encode_8c.html#aed53f0bcf39d848d68a62ed83da063c8">vaapi_encode_output</a></div><div class="ttdeci">static int vaapi_encode_output(AVCodecContext *avctx, VAAPIEncodePicture *pic, AVPacket *pkt)</div><div class="ttdef"><b>Definition:</b> <a href="libavcodec_2vaapi__encode_8c_source.html#l00625">vaapi_encode.c:625</a></div></div>
<div class="ttc" id="afilter__design_8txt_html_a48ad71a5b40cdd5f23c601f33665a953"><div class="ttname"><a href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a></div><div class="ttdeci">these buffered frames must be flushed immediately if a new input produces new the filter must not call request_frame to get more It must just process the frame or queue it The task of requesting more frames is left to the filter s request_frame method or the application If a filter has several the filter must be ready for frames arriving randomly on any input any filter with several inputs will most likely require some kind of queuing mechanism It is perfectly acceptable to have a limited queue and to drop frames when the inputs are too unbalanced request_frame For filters that do not use the this method is called when a frame is wanted on an output For a it should directly call filter_frame on the corresponding output For a if there are queued frames already one of these frames should be pushed If the filter should request a frame on one of its repeatedly until at least one frame has been pushed Return or at least make progress towards producing a frame</div><div class="ttdef"><b>Definition:</b> <a href="filter__design_8txt_source.html#l00264">filter_design.txt:264</a></div></div>
<div class="ttc" id="astruct_a_v_codec_context_html_abe964316aaaa61967b012efdcced79c4"><div class="ttname"><a href="struct_a_v_codec_context.html#abe964316aaaa61967b012efdcced79c4">AVCodecContext::extradata</a></div><div class="ttdeci">uint8_t * extradata</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l00627">avcodec.h:627</a></div></div>
<div class="ttc" id="astruct_a_v_rational_html_ae9a98c10a301c5e937095105b6f0fdb9"><div class="ttname"><a href="struct_a_v_rational.html#ae9a98c10a301c5e937095105b6f0fdb9">AVRational::num</a></div><div class="ttdeci">int num</div><div class="ttdoc">Numerator.</div><div class="ttdef"><b>Definition:</b> <a href="rational_8h_source.html#l00059">rational.h:59</a></div></div>
<div class="ttc" id="astruct_a_v_packet_html"><div class="ttname"><a href="struct_a_v_packet.html">AVPacket</a></div><div class="ttdef"><b>Definition:</b> <a href="packet_8h_source.html#l00340">packet.h:340</a></div></div>
<div class="ttc" id="astruct_a_v_codec_context_html_aa401ca663644caa51ede1889659c23d6"><div class="ttname"><a href="struct_a_v_codec_context.html#aa401ca663644caa51ede1889659c23d6">AVCodecContext::compression_level</a></div><div class="ttdeci">int compression_level</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l00598">avcodec.h:598</a></div></div>
<div class="ttc" id="astruct_a_v_v_a_a_p_i_frames_context_html"><div class="ttname"><a href="struct_a_v_v_a_a_p_i_frames_context.html">AVVAAPIFramesContext</a></div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vaapi_8h_source.html#l00088">hwcontext_vaapi.h:88</a></div></div>
<div class="ttc" id="astruct_v_a_a_p_i_encode_picture_html_aeebf0e912cc72cb3f0d394fe86019cda"><div class="ttname"><a href="struct_v_a_a_p_i_encode_picture.html#aeebf0e912cc72cb3f0d394fe86019cda">VAAPIEncodePicture::encode_order</a></div><div class="ttdeci">int64_t encode_order</div><div class="ttdef"><b>Definition:</b> <a href="vaapi__encode_8h_source.html#l00074">vaapi_encode.h:74</a></div></div>
<div class="ttc" id="agroup__lavu__mem__funcs_html_ga34e10fdac079a9ca4512b8ccd7f20b8a"><div class="ttname"><a href="group__lavu__mem__funcs.html#ga34e10fdac079a9ca4512b8ccd7f20b8a">size</a></div><div class="ttdeci">int size</div><div class="ttdef"><b>Definition:</b> <a href="twinvq__data_8h_source.html#l11134">twinvq_data.h:11134</a></div></div>
<div class="ttc" id="agroup__lavc__decoding_html_ga8f5b632a03ce83ac8e025894b1fc307a"><div class="ttname"><a href="group__lavc__decoding.html#ga8f5b632a03ce83ac8e025894b1fc307a">AV_INPUT_BUFFER_PADDING_SIZE</a></div><div class="ttdeci">#define AV_INPUT_BUFFER_PADDING_SIZE</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l00215">avcodec.h:215</a></div></div>
<div class="ttc" id="astruct_v_a_a_p_i_encode_r_c_mode_html"><div class="ttname"><a href="struct_v_a_a_p_i_encode_r_c_mode.html">VAAPIEncodeRCMode</a></div><div class="ttdef"><b>Definition:</b> <a href="vaapi__encode_8h_source.html#l00156">vaapi_encode.h:156</a></div></div>
<div class="ttc" id="asinewin__tablegen__template_8c_html_a3508a98d3ee7e2c9a4841fe264cf70f7"><div class="ttname"><a href="sinewin__tablegen__template_8c.html#a3508a98d3ee7e2c9a4841fe264cf70f7">FF_ARRAY_ELEMS</a></div><div class="ttdeci">#define FF_ARRAY_ELEMS(a)</div><div class="ttdef"><b>Definition:</b> <a href="sinewin__tablegen__template_8c_source.html#l00038">sinewin_tablegen_template.c:38</a></div></div>
<div class="ttc" id="astruct_a_v_frame_html_a1d0f65014a8d1bf78cec8cbed2304992"><div class="ttname"><a href="struct_a_v_frame.html#a1d0f65014a8d1bf78cec8cbed2304992">AVFrame::data</a></div><div class="ttdeci">uint8_t * data[AV_NUM_DATA_POINTERS]</div><div class="ttdef"><b>Definition:</b> <a href="frame_8h_source.html#l00322">frame.h:322</a></div></div>
<div class="ttc" id="ademuxing__decoding_8c_html_a3d4c6562f0b27cf0cacbbea5c038c090"><div class="ttname"><a href="demuxing__decoding_8c.html#a3d4c6562f0b27cf0cacbbea5c038c090">pkt</a></div><div class="ttdeci">static AVPacket pkt</div><div class="ttdef"><b>Definition:</b> <a href="demuxing__decoding_8c_source.html#l00054">demuxing_decoding.c:54</a></div></div>
<div class="ttc" id="afilter__design_8txt_html_ab5bf43ceeffd5c440d539ae2ed025827"><div class="ttname"><a href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a></div><div class="ttdeci">the frame and frame reference mechanism is intended to as much as expensive copies of that data while still allowing the filters to produce correct results The data is stored in buffers represented by AVFrame structures Several references can point to the same frame buffer</div><div class="ttdef"><b>Definition:</b> <a href="filter__design_8txt_source.html#l00049">filter_design.txt:49</a></div></div>
<div class="ttc" id="apixfmt_8h_html_a9a8e335cf3be472042bc9f0cf80cd4c5a0e08f8a5d0fa21c3e258816a9dcce7c3"><div class="ttname"><a href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a0e08f8a5d0fa21c3e258816a9dcce7c3">AV_PIX_FMT_NONE</a></div><div class="ttdeci">@ AV_PIX_FMT_NONE</div><div class="ttdef"><b>Definition:</b> <a href="pixfmt_8h_source.html#l00065">pixfmt.h:65</a></div></div>
<div class="ttc" id="astruct_a_v_h_w_frames_constraints_html_af5d3a683727f7b92abca7b7114d4e15c"><div class="ttname"><a href="struct_a_v_h_w_frames_constraints.html#af5d3a683727f7b92abca7b7114d4e15c">AVHWFramesConstraints::max_height</a></div><div class="ttdeci">int max_height</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext_8h_source.html#l00479">hwcontext.h:479</a></div></div>
<div class="ttc" id="atests_2jpeg2000dwt_8c_html_a5cabdd8be5af41f675fed06498e094b7"><div class="ttname"><a href="tests_2jpeg2000dwt_8c.html#a5cabdd8be5af41f675fed06498e094b7">ref</a></div><div class="ttdeci">static int ref[MAX_W *MAX_W]</div><div class="ttdef"><b>Definition:</b> <a href="tests_2jpeg2000dwt_8c_source.html#l00107">jpeg2000dwt.c:107</a></div></div>
<div class="ttc" id="astruct_v_a_a_p_i_encode_r_t_format_html_a0a0803cb294781c45ebacc09ef6b9f6d"><div class="ttname"><a href="struct_v_a_a_p_i_encode_r_t_format.html#a0a0803cb294781c45ebacc09ef6b9f6d">VAAPIEncodeRTFormat::value</a></div><div class="ttdeci">unsigned int value</div><div class="ttdef"><b>Definition:</b> <a href="libavcodec_2vaapi__encode_8c_source.html#l01236">vaapi_encode.c:1236</a></div></div>
<div class="ttc" id="astruct_v_a_a_p_i_encode_picture_html_aaa8c71a04b83ac217a42bf41e0e1a0ff"><div class="ttname"><a href="struct_v_a_a_p_i_encode_picture.html#aaa8c71a04b83ac217a42bf41e0e1a0ff">VAAPIEncodePicture::next</a></div><div class="ttdeci">struct VAAPIEncodePicture * next</div><div class="ttdef"><b>Definition:</b> <a href="vaapi__encode_8h_source.html#l00071">vaapi_encode.h:71</a></div></div>
<div class="ttc" id="astruct_v_a_a_p_i_encode_slice_html_a4ef0c52a1f5c8310dd26c65016c039ef"><div class="ttname"><a href="struct_v_a_a_p_i_encode_slice.html#a4ef0c52a1f5c8310dd26c65016c039ef">VAAPIEncodeSlice::codec_slice_params</a></div><div class="ttdeci">void * codec_slice_params</div><div class="ttdef"><b>Definition:</b> <a href="vaapi__encode_8h_source.html#l00067">vaapi_encode.h:67</a></div></div>
<div class="ttc" id="agroup__lavu__buffer_html_gaa40ce7d3ede946a89d03323bbd7268c1"><div class="ttname"><a href="group__lavu__buffer.html#gaa40ce7d3ede946a89d03323bbd7268c1">av_buffer_ref</a></div><div class="ttdeci">AVBufferRef * av_buffer_ref(AVBufferRef *buf)</div><div class="ttdef"><b>Definition:</b> <a href="buffer_8c_source.html#l00093">buffer.c:93</a></div></div>
<div class="ttc" id="agroup__avoptions_html_gga06fc87d81c62e9abb8790b6e5713c55ba8adb148d2ac4dda4c65d4ef8d13eaf09"><div class="ttname"><a href="group__avoptions.html#gga06fc87d81c62e9abb8790b6e5713c55ba8adb148d2ac4dda4c65d4ef8d13eaf09">MAX_PICTURE_REFERENCES</a></div><div class="ttdeci">@ MAX_PICTURE_REFERENCES</div><div class="ttdef"><b>Definition:</b> <a href="vaapi__encode_8h_source.html#l00043">vaapi_encode.h:43</a></div></div>
<div class="ttc" id="astruct_v_a_a_p_i_encode_picture_html_a066d9e1a3e58cdae02bb2ccf21e7a57c"><div class="ttname"><a href="struct_v_a_a_p_i_encode_picture.html#a066d9e1a3e58cdae02bb2ccf21e7a57c">VAAPIEncodePicture::output_buffer_ref</a></div><div class="ttdeci">AVBufferRef * output_buffer_ref</div><div class="ttdef"><b>Definition:</b> <a href="vaapi__encode_8h_source.html#l00099">vaapi_encode.h:99</a></div></div>
<div class="ttc" id="alibavcodec_2vaapi__encode_8c_html_a7adac1c136586c62a8d0d94806609e51"><div class="ttname"><a href="libavcodec_2vaapi__encode_8c.html#a7adac1c136586c62a8d0d94806609e51">vaapi_encode_init_tile_slice_structure</a></div><div class="ttdeci">static av_cold int vaapi_encode_init_tile_slice_structure(AVCodecContext *avctx, uint32_t slice_structure)</div><div class="ttdef"><b>Definition:</b> <a href="libavcodec_2vaapi__encode_8c_source.html#l01932">vaapi_encode.c:1932</a></div></div>
<div class="ttc" id="alibsvtav1_8c_html_a710bce51374aba96ab04912897666c35"><div class="ttname"><a href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a></div><div class="ttdeci">const char * desc</div><div class="ttdef"><b>Definition:</b> <a href="libsvtav1_8c_source.html#l00079">libsvtav1.c:79</a></div></div>
<div class="ttc" id="aencode_8c_html_a24f7e9c2daa5cc6033a220bf53870c62"><div class="ttname"><a href="encode_8c.html#a24f7e9c2daa5cc6033a220bf53870c62">ff_encode_get_frame</a></div><div class="ttdeci">int ff_encode_get_frame(AVCodecContext *avctx, AVFrame *frame)</div><div class="ttdef"><b>Definition:</b> <a href="encode_8c_source.html#l00107">encode.c:107</a></div></div>
<div class="ttc" id="alibavcodec_2vaapi__encode_8c_html_a3936e7d89f3866a231a28aeadc0c3984"><div class="ttname"><a href="libavcodec_2vaapi__encode_8c.html#a3936e7d89f3866a231a28aeadc0c3984">vaapi_encode_send_frame</a></div><div class="ttdeci">static int vaapi_encode_send_frame(AVCodecContext *avctx, AVFrame *frame)</div><div class="ttdef"><b>Definition:</b> <a href="libavcodec_2vaapi__encode_8c_source.html#l01088">vaapi_encode.c:1088</a></div></div>
<div class="ttc" id="atableprint__vlc_8h_html_a079eab092887563f2bef9106c6120089"><div class="ttname"><a href="tableprint__vlc_8h.html#a079eab092887563f2bef9106c6120089">av_free</a></div><div class="ttdeci">#define av_free(p)</div><div class="ttdef"><b>Definition:</b> <a href="tableprint__vlc_8h_source.html#l00034">tableprint_vlc.h:34</a></div></div>
<div class="ttc" id="astruct_a_v_codec_context_html_a209f5ec60cb5f0b0a4962f4c5c5bb541"><div class="ttname"><a href="struct_a_v_codec_context.html#a209f5ec60cb5f0b0a4962f4c5c5bb541">AVCodecContext::global_quality</a></div><div class="ttdeci">int global_quality</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l00592">avcodec.h:592</a></div></div>
<div class="ttc" id="alibavcodec_2vaapi__encode_8c_html_a56b623f757fbe8f192a9cef3d30b4e0a"><div class="ttname"><a href="libavcodec_2vaapi__encode_8c.html#a56b623f757fbe8f192a9cef3d30b4e0a">vaapi_encode_profile_entrypoint</a></div><div class="ttdeci">static av_cold int vaapi_encode_profile_entrypoint(AVCodecContext *avctx)</div><div class="ttdef"><b>Definition:</b> <a href="libavcodec_2vaapi__encode_8c_source.html#l01272">vaapi_encode.c:1272</a></div></div>
<div class="ttc" id="astruct_a_v_region_of_interest_html_a04201e2f63181c3007c4dfe0c7b8c815"><div class="ttname"><a href="struct_a_v_region_of_interest.html#a04201e2f63181c3007c4dfe0c7b8c815">AVRegionOfInterest::bottom</a></div><div class="ttdeci">int bottom</div><div class="ttdef"><b>Definition:</b> <a href="frame_8h_source.html#l00249">frame.h:249</a></div></div>
<div class="ttc" id="atableprint__vlc_8h_html_adba82e1bcd02de510a858fcbedf79ef1"><div class="ttname"><a href="tableprint__vlc_8h.html#adba82e1bcd02de510a858fcbedf79ef1">av_freep</a></div><div class="ttdeci">#define av_freep(p)</div><div class="ttdef"><b>Definition:</b> <a href="tableprint__vlc_8h_source.html#l00035">tableprint_vlc.h:35</a></div></div>
<div class="ttc" id="astruct_v_a_a_p_i_encode_picture_html_a83b6ea88509d40eab77e313def6fb786"><div class="ttname"><a href="struct_v_a_a_p_i_encode_picture.html#a83b6ea88509d40eab77e313def6fb786">VAAPIEncodePicture::ref_count</a></div><div class="ttdeci">int ref_count[2]</div><div class="ttdef"><b>Definition:</b> <a href="vaapi__encode_8h_source.html#l00123">vaapi_encode.h:123</a></div></div>
<div class="ttc" id="astruct_a_v_codec_context_html_a3e5334a611a3e2a6a653805bb9e2d4d4"><div class="ttname"><a href="struct_a_v_codec_context.html#a3e5334a611a3e2a6a653805bb9e2d4d4">AVCodecContext::max_b_frames</a></div><div class="ttdeci">int max_b_frames</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l00786">avcodec.h:786</a></div></div>
<div class="ttc" id="anamespaceconvert__header_html_ae1e061c0db8a47f53e1f3de5e371872e"><div class="ttname"><a href="namespaceconvert__header.html#ae1e061c0db8a47f53e1f3de5e371872e">convert_header.str</a></div><div class="ttdeci">string str</div><div class="ttdef"><b>Definition:</b> <a href="convert__header_8py_source.html#l00020">convert_header.py:20</a></div></div>
<div class="ttc" id="agroup__lavu__frame_html_ggae01fa7e427274293aacdf2adc17076bcaf525ec92d2c5a78d44950bc3f29972aa"><div class="ttname"><a href="group__lavu__frame.html#ggae01fa7e427274293aacdf2adc17076bcaf525ec92d2c5a78d44950bc3f29972aa">AV_FRAME_DATA_REGIONS_OF_INTEREST</a></div><div class="ttdeci">@ AV_FRAME_DATA_REGIONS_OF_INTEREST</div><div class="ttdef"><b>Definition:</b> <a href="frame_8h_source.html#l00181">frame.h:181</a></div></div>
<div class="ttc" id="atableprint__vlc_8h_html_af38b91523053c244564a94f1ef862c2c"><div class="ttname"><a href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a></div><div class="ttdeci">#define av_log(a,...)</div><div class="ttdef"><b>Definition:</b> <a href="tableprint__vlc_8h_source.html#l00028">tableprint_vlc.h:28</a></div></div>
<div class="ttc" id="alibavcodec_2vaapi__encode_8c_html_aad896a0f76ac9d6f2865b7e779f00feb"><div class="ttname"><a href="libavcodec_2vaapi__encode_8c.html#aad896a0f76ac9d6f2865b7e779f00feb">vaapi_encode_clear_old</a></div><div class="ttdeci">static int vaapi_encode_clear_old(AVCodecContext *avctx)</div><div class="ttdef"><b>Definition:</b> <a href="libavcodec_2vaapi__encode_8c_source.html#l01024">vaapi_encode.c:1024</a></div></div>
<div class="ttc" id="astruct_v_a_a_p_i_encode_slice_html_a3a0ea0892268d865f4981ac1b56baff9"><div class="ttname"><a href="struct_v_a_a_p_i_encode_slice.html#a3a0ea0892268d865f4981ac1b56baff9">VAAPIEncodeSlice::block_start</a></div><div class="ttdeci">int block_start</div><div class="ttdef"><b>Definition:</b> <a href="vaapi__encode_8h_source.html#l00065">vaapi_encode.h:65</a></div></div>
<div class="ttc" id="aqsvenc_8c_html_a0f95ed71fe45fda6152a62f1f3b219c4"><div class="ttname"><a href="qsvenc_8c.html#a0f95ed71fe45fda6152a62f1f3b219c4">rc_mode</a></div><div class="ttdeci">mfxU16 rc_mode</div><div class="ttdef"><b>Definition:</b> <a href="qsvenc_8c_source.html#l00084">qsvenc.c:84</a></div></div>
<div class="ttc" id="astruct_a_v_frame_html"><div class="ttname"><a href="struct_a_v_frame.html">AVFrame</a></div><div class="ttdef"><b>Definition:</b> <a href="frame_8h_source.html#l00308">frame.h:308</a></div></div>
<div class="ttc" id="alibavcodec_2vaapi__encode_8c_html_a3176053f5249c1bed25ddfe8409c5a2c"><div class="ttname"><a href="libavcodec_2vaapi__encode_8c.html#a3176053f5249c1bed25ddfe8409c5a2c">vaapi_encode_make_packed_header</a></div><div class="ttdeci">static int vaapi_encode_make_packed_header(AVCodecContext *avctx, VAAPIEncodePicture *pic, int type, char *data, size_t bit_len)</div><div class="ttdef"><b>Definition:</b> <a href="libavcodec_2vaapi__encode_8c_source.html#l00038">vaapi_encode.c:38</a></div></div>
<div class="ttc" id="alibavcodec_2vaapi__encode_8c_html_a0c592d403bde93efd08918492f9a68d0"><div class="ttname"><a href="libavcodec_2vaapi__encode_8c.html#a0c592d403bde93efd08918492f9a68d0">vaapi_encode_wait</a></div><div class="ttdeci">static int vaapi_encode_wait(AVCodecContext *avctx, VAAPIEncodePicture *pic)</div><div class="ttdef"><b>Definition:</b> <a href="libavcodec_2vaapi__encode_8c_source.html#l00135">vaapi_encode.c:135</a></div></div>
<div class="ttc" id="affmpeg__filter_8c_html_a61569f2965b7a369eb10b6d75d410d11"><div class="ttname"><a href="ffmpeg__filter_8c.html#a61569f2965b7a369eb10b6d75d410d11">int</a></div><div class="ttdeci">int</div><div class="ttdef"><b>Definition:</b> <a href="ffmpeg__filter_8c_source.html#l00193">ffmpeg_filter.c:193</a></div></div>
<div class="ttc" id="ahwcontext_8c_html_adfa5aaa3a4f69b163ea30cadc6d663dc"><div class="ttname"><a href="hwcontext_8c.html#adfa5aaa3a4f69b163ea30cadc6d663dc">av_hwframe_get_buffer</a></div><div class="ttdeci">int av_hwframe_get_buffer(AVBufferRef *hwframe_ref, AVFrame *frame, int flags)</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext_8c_source.html#l00502">hwcontext.c:502</a></div></div>
<div class="ttc" id="asnprintf_8h_html_aa367b75c5aed883fef5befbdf04835a4"><div class="ttname"><a href="snprintf_8h.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a></div><div class="ttdeci">#define snprintf</div><div class="ttdef"><b>Definition:</b> <a href="snprintf_8h_source.html#l00034">snprintf.h:34</a></div></div>
<div class="ttc" id="avaapi__encode_8h_html_abc6126af1d45847bc59afa0aa3216b04a0bd3695af879bf892f15bfe02355b902"><div class="ttname"><a href="vaapi__encode_8h.html#abc6126af1d45847bc59afa0aa3216b04a0bd3695af879bf892f15bfe02355b902">FLAG_SLICE_CONTROL</a></div><div class="ttdeci">@ FLAG_SLICE_CONTROL</div><div class="ttdef"><b>Definition:</b> <a href="vaapi__encode_8h_source.html#l00352">vaapi_encode.h:352</a></div></div>
<div class="ttc" id="astruct_a_v_rational_html_aee46bdac67d965ac0a4204e753f910c3"><div class="ttname"><a href="struct_a_v_rational.html#aee46bdac67d965ac0a4204e753f910c3">AVRational::den</a></div><div class="ttdeci">int den</div><div class="ttdoc">Denominator.</div><div class="ttdef"><b>Definition:</b> <a href="rational_8h_source.html#l00060">rational.h:60</a></div></div>
<div class="ttc" id="astruct_a_v_codec_context_html_a15000607a7e2371162348bb35b0184c1"><div class="ttname"><a href="struct_a_v_codec_context.html#a15000607a7e2371162348bb35b0184c1">AVCodecContext::rc_buffer_size</a></div><div class="ttdeci">int rc_buffer_size</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l01389">avcodec.h:1389</a></div></div>
<div class="ttc" id="astruct_a_v_codec_context_html_a7546ebfa9e9ffede316576dced7e150c"><div class="ttname"><a href="struct_a_v_codec_context.html#a7546ebfa9e9ffede316576dced7e150c">AVCodecContext::rc_initial_buffer_occupancy</a></div><div class="ttdeci">int rc_initial_buffer_occupancy</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l01432">avcodec.h:1432</a></div></div>
<div class="ttc" id="avaapi__encode_8h_html_a99fb83031ce9923c84392b4e92f956b5ab433d7f001038a3ce0eb623789bef910"><div class="ttname"><a href="vaapi__encode_8h.html#a99fb83031ce9923c84392b4e92f956b5ab433d7f001038a3ce0eb623789bef910">RC_MODE_CBR</a></div><div class="ttdeci">@ RC_MODE_CBR</div><div class="ttdef"><b>Definition:</b> <a href="vaapi__encode_8h_source.html#l00148">vaapi_encode.h:148</a></div></div>
<div class="ttc" id="astruct_v_a_a_p_i_encode_slice_html_ab386a9de917f4be220ba338eabbde3b7"><div class="ttname"><a href="struct_v_a_a_p_i_encode_slice.html#ab386a9de917f4be220ba338eabbde3b7">VAAPIEncodeSlice::row_start</a></div><div class="ttdeci">int row_start</div><div class="ttdef"><b>Definition:</b> <a href="vaapi__encode_8h_source.html#l00063">vaapi_encode.h:63</a></div></div>
<div class="ttc" id="alibavcodec_2vaapi__encode_8c_html_a4c251c181207b0fa4a94cdc25a2f450a"><div class="ttname"><a href="libavcodec_2vaapi__encode_8c.html#a4c251c181207b0fa4a94cdc25a2f450a">vaapi_encode_init_row_slice_structure</a></div><div class="ttdeci">static av_cold int vaapi_encode_init_row_slice_structure(AVCodecContext *avctx, uint32_t slice_structure)</div><div class="ttdef"><b>Definition:</b> <a href="libavcodec_2vaapi__encode_8c_source.html#l01887">vaapi_encode.c:1887</a></div></div>
<div class="ttc" id="astruct_v_a_a_p_i_encode_picture_html_a512cbe2731947ce2270d5ca4c0977768"><div class="ttname"><a href="struct_v_a_a_p_i_encode_picture.html#a512cbe2731947ce2270d5ca4c0977768">VAAPIEncodePicture::ref_removed</a></div><div class="ttdeci">int ref_removed[2]</div><div class="ttdef"><b>Definition:</b> <a href="vaapi__encode_8h_source.html#l00124">vaapi_encode.h:124</a></div></div>
<div class="ttc" id="apixdesc_8c_html_ab92e2a8a9b58c982560c49df9f01e47e"><div class="ttname"><a href="pixdesc_8c.html#ab92e2a8a9b58c982560c49df9f01e47e">av_get_pix_fmt_name</a></div><div class="ttdeci">const char * av_get_pix_fmt_name(enum AVPixelFormat pix_fmt)</div><div class="ttdef"><b>Definition:</b> <a href="pixdesc_8c_source.html#l02489">pixdesc.c:2489</a></div></div>
<div class="ttc" id="astruct_v_a_a_p_i_encode_picture_html_ab10d79f488c154649c6b6c9ff223f8c6"><div class="ttname"><a href="struct_v_a_a_p_i_encode_picture.html#ab10d79f488c154649c6b6c9ff223f8c6">VAAPIEncodePicture::output_buffer</a></div><div class="ttdeci">VABufferID output_buffer</div><div class="ttdef"><b>Definition:</b> <a href="vaapi__encode_8h_source.html#l00100">vaapi_encode.h:100</a></div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.8.20
</small></address>
</body>
</html>
