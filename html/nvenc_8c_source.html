<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>My Project: E:/github/ffmpeg/libavcodec/nvenc.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">My Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_737c44b861ba7ee498141742fb455fa8.html">ffmpeg</a></li><li class="navelem"><a class="el" href="dir_56ad1dd09ca1ce410b5ba2c46dd71e4b.html">libavcodec</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">nvenc.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="nvenc_8c.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno"><a class="line" href="nvenc_8h.html#a7dc7ef0ced6600352858a0fb7d22342d">    1</a></span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> * H.264/HEVC hardware encoding using nvidia nvenc</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> * Copyright (c) 2016 Timo Rothenpieler &lt;timo@rothenpieler.org&gt;</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> * This file is part of FFmpeg.</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> * FFmpeg is free software; you can redistribute it and/or</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> * modify it under the terms of the GNU Lesser General Public</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> * License as published by the Free Software Foundation; either</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> * version 2.1 of the License, or (at your option) any later version.</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> * FFmpeg is distributed in the hope that it will be useful,</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"> * Lesser General Public License for more details.</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"> * You should have received a copy of the GNU Lesser General Public</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"> * License along with FFmpeg; if not, write to the Free Software</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment"> * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160; </div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#include &quot;config.h&quot;</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160; </div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="nvenc_8h.html">nvenc.h</a>&quot;</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="hevc__sei_8h.html">hevc_sei.h</a>&quot;</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160; </div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="hwcontext__cuda_8h.html">libavutil/hwcontext_cuda.h</a>&quot;</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="hwcontext_8h.html">libavutil/hwcontext.h</a>&quot;</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="cuda__check_8h.html">libavutil/cuda_check.h</a>&quot;</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="imgutils_8h.html">libavutil/imgutils.h</a>&quot;</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="avassert_8h.html">libavutil/avassert.h</a>&quot;</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="mem_8h.html">libavutil/mem.h</a>&quot;</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="pixdesc_8h.html">libavutil/pixdesc.h</a>&quot;</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="atsc__a53_8h.html">atsc_a53.h</a>&quot;</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="encode_8h.html">encode.h</a>&quot;</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="libavutil_2internal_8h.html">internal.h</a>&quot;</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="packet__internal_8h.html">packet_internal.h</a>&quot;</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160; </div>
<div class="line"><a name="l00039"></a><span class="lineno"><a class="line" href="nvenc_8c.html#aabb147a1f2a98d37cb3ce0dd6d50b78d">   39</a></span>&#160;<span class="preprocessor">#define CHECK_CU(x) FF_CUDA_CHECK_DL(avctx, dl_fn-&gt;cuda_dl, x)</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160; </div>
<div class="line"><a name="l00041"></a><span class="lineno"><a class="line" href="nvenc_8c.html#ab9c969896faddf6ab3f8153bea54bcf2">   41</a></span>&#160;<span class="preprocessor">#define NVENC_CAP 0x30</span></div>
<div class="line"><a name="l00042"></a><span class="lineno"><a class="line" href="nvenc_8c.html#ab0f7f7ce226b631569310a06829ab957">   42</a></span>&#160;<span class="preprocessor">#define IS_CBR(rc) (rc == NV_ENC_PARAMS_RC_CBR ||             \</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="preprocessor">                    rc == NV_ENC_PARAMS_RC_CBR_LOWDELAY_HQ || \</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="preprocessor">                    rc == NV_ENC_PARAMS_RC_CBR_HQ)</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160; </div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="keyword">const</span> <span class="keyword">enum</span> <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5">AVPixelFormat</a> <a class="code" href="nvenc_8c.html#a7dc7ef0ced6600352858a0fb7d22342d">ff_nvenc_pix_fmts</a>[] = {</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a1aa7677092740d8def31655b5d7f0cc2">AV_PIX_FMT_YUV420P</a>,</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a0b271df0acd125218c1e365a0f754022">AV_PIX_FMT_NV12</a>,</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    <a class="code" href="pixfmt_8h.html#a6265531cbe491ec34449e3769e545f1f">AV_PIX_FMT_P010</a>,</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a82034006e681cddbb7b1d5cb7045626a">AV_PIX_FMT_YUV444P</a>,</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    <a class="code" href="pixfmt_8h.html#a6506505b35c1afd66c10cd537369cdd6">AV_PIX_FMT_P016</a>,      <span class="comment">// Truncated to 10bits</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    <a class="code" href="pixfmt_8h.html#ae7920607c5cf9a219cc94b5c7efc457d">AV_PIX_FMT_YUV444P16</a>, <span class="comment">// Truncated to 10bits</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    <a class="code" href="pixfmt_8h.html#a000d452c556c94e3865fea5d14a77c8f">AV_PIX_FMT_0RGB32</a>,</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <a class="code" href="pixfmt_8h.html#af3d101ef5e0fdb975f01a831daede80a">AV_PIX_FMT_0BGR32</a>,</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a5ab95e18c0c9e5335f29121418eab314">AV_PIX_FMT_CUDA</a>,</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="preprocessor">#if CONFIG_D3D11VA</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a8cfd0b36308fa1ad3522ef8815ccbd0a">AV_PIX_FMT_D3D11</a>,</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a0e08f8a5d0fa21c3e258816a9dcce7c3">AV_PIX_FMT_NONE</a></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;};</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160; </div>
<div class="line"><a name="l00062"></a><span class="lineno"><a class="line" href="nvenc_8h.html#a46da6bbf53a3b19ef1762a8aa16c19fc">   62</a></span>&#160;<span class="keyword">const</span> <a class="code" href="struct_a_v_codec_h_w_config_internal.html">AVCodecHWConfigInternal</a> *<span class="keyword">const</span> <a class="code" href="nvenc_8c.html#a46da6bbf53a3b19ef1762a8aa16c19fc">ff_nvenc_hw_configs</a>[] = {</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    <a class="code" href="hwconfig_8h.html#a67594da711e5397d009cef8b48cd8001">HW_CONFIG_ENCODER_FRAMES</a>(CUDA,  CUDA),</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    <a class="code" href="hwconfig_8h.html#a63e6dde7eab6be3a7da254f49ffe5d0d">HW_CONFIG_ENCODER_DEVICE</a>(<a class="code" href="af__afade_8c.html#a007dea27057008224e9da69eaeca8606ac157bdf0b85a40d2619cbc8bc1ae5fe2">NONE</a>,  CUDA),</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="preprocessor">#if CONFIG_D3D11VA</span></div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <a class="code" href="hwconfig_8h.html#a67594da711e5397d009cef8b48cd8001">HW_CONFIG_ENCODER_FRAMES</a>(D3D11, D3D11VA),</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    <a class="code" href="hwconfig_8h.html#a63e6dde7eab6be3a7da254f49ffe5d0d">HW_CONFIG_ENCODER_DEVICE</a>(<a class="code" href="af__afade_8c.html#a007dea27057008224e9da69eaeca8606ac157bdf0b85a40d2619cbc8bc1ae5fe2">NONE</a>,  D3D11VA),</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;};</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160; </div>
<div class="line"><a name="l00072"></a><span class="lineno"><a class="line" href="nvenc_8c.html#aa811025b0fbbeacacd640511c965212f">   72</a></span>&#160;<span class="preprocessor">#define IS_10BIT(pix_fmt)  (pix_fmt == AV_PIX_FMT_P010    || \</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="preprocessor">                            pix_fmt == AV_PIX_FMT_P016    || \</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="preprocessor">                            pix_fmt == AV_PIX_FMT_YUV444P16)</span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160; </div>
<div class="line"><a name="l00076"></a><span class="lineno"><a class="line" href="nvenc_8c.html#a4283d2a341ed469ecbb452243fd148a7">   76</a></span>&#160;<span class="preprocessor">#define IS_YUV444(pix_fmt) (pix_fmt == AV_PIX_FMT_YUV444P || \</span></div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="preprocessor">                            pix_fmt == AV_PIX_FMT_YUV444P16)</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160; </div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">struct </span>{</div>
<div class="line"><a name="l00080"></a><span class="lineno"><a class="line" href="nvenc_8c.html#a4e0ddbacaa28d61a8fa4b77cc67a736f">   80</a></span>&#160;    NVENCSTATUS <a class="code" href="nvenc_8c.html#a4e0ddbacaa28d61a8fa4b77cc67a736f">nverr</a>;</div>
<div class="line"><a name="l00081"></a><span class="lineno"><a class="line" href="nvenc_8c.html#ac504a73146da1c32baabe689e4ca3e1b">   81</a></span>&#160;    <span class="keywordtype">int</span>         <a class="code" href="nvenc_8c.html#ac504a73146da1c32baabe689e4ca3e1b">averr</a>;</div>
<div class="line"><a name="l00082"></a><span class="lineno"><a class="line" href="nvenc_8c.html#a710bce51374aba96ab04912897666c35">   82</a></span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="nvenc_8c.html#a710bce51374aba96ab04912897666c35">desc</a>;</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;} <a class="code" href="nvenc_8c.html#a3be29e24df433bfd1a0c641215cb23bf">nvenc_errors</a>[] = {</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    { NV_ENC_SUCCESS,                      0,                <span class="stringliteral">&quot;success&quot;</span>                  },</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    { NV_ENC_ERR_NO_ENCODE_DEVICE,         <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOENT),  <span class="stringliteral">&quot;no encode device&quot;</span>         },</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    { NV_ENC_ERR_UNSUPPORTED_DEVICE,       <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOSYS),  <span class="stringliteral">&quot;unsupported device&quot;</span>       },</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    { NV_ENC_ERR_INVALID_ENCODERDEVICE,    <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EINVAL),  <span class="stringliteral">&quot;invalid encoder device&quot;</span>   },</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    { NV_ENC_ERR_INVALID_DEVICE,           <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EINVAL),  <span class="stringliteral">&quot;invalid device&quot;</span>           },</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    { NV_ENC_ERR_DEVICE_NOT_EXIST,         <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EIO),     <span class="stringliteral">&quot;device does not exist&quot;</span>    },</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    { NV_ENC_ERR_INVALID_PTR,              <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EFAULT),  <span class="stringliteral">&quot;invalid ptr&quot;</span>              },</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    { NV_ENC_ERR_INVALID_EVENT,            <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EINVAL),  <span class="stringliteral">&quot;invalid event&quot;</span>            },</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    { NV_ENC_ERR_INVALID_PARAM,            <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EINVAL),  <span class="stringliteral">&quot;invalid param&quot;</span>            },</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    { NV_ENC_ERR_INVALID_CALL,             <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EINVAL),  <span class="stringliteral">&quot;invalid call&quot;</span>             },</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    { NV_ENC_ERR_OUT_OF_MEMORY,            <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM),  <span class="stringliteral">&quot;out of memory&quot;</span>            },</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    { NV_ENC_ERR_ENCODER_NOT_INITIALIZED,  <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EINVAL),  <span class="stringliteral">&quot;encoder not initialized&quot;</span>  },</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    { NV_ENC_ERR_UNSUPPORTED_PARAM,        <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOSYS),  <span class="stringliteral">&quot;unsupported param&quot;</span>        },</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    { NV_ENC_ERR_LOCK_BUSY,                <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EAGAIN),  <span class="stringliteral">&quot;lock busy&quot;</span>                },</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    { NV_ENC_ERR_NOT_ENOUGH_BUFFER,        <a class="code" href="group__lavu__error.html#ga76077a6d42ee211f59712485bd977e40">AVERROR_BUFFER_TOO_SMALL</a>, <span class="stringliteral">&quot;not enough buffer&quot;</span>},</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    { NV_ENC_ERR_INVALID_VERSION,          <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EINVAL),  <span class="stringliteral">&quot;invalid version&quot;</span>          },</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    { NV_ENC_ERR_MAP_FAILED,               <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EIO),     <span class="stringliteral">&quot;map failed&quot;</span>               },</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    { NV_ENC_ERR_NEED_MORE_INPUT,          <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EAGAIN),  <span class="stringliteral">&quot;need more input&quot;</span>          },</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    { NV_ENC_ERR_ENCODER_BUSY,             <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EAGAIN),  <span class="stringliteral">&quot;encoder busy&quot;</span>             },</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    { NV_ENC_ERR_EVENT_NOT_REGISTERD,      <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EBADF),   <span class="stringliteral">&quot;event not registered&quot;</span>     },</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    { NV_ENC_ERR_GENERIC,                  <a class="code" href="group__lavu__error.html#ga4ebaa288c7684a26a591c501208910e4">AVERROR_UNKNOWN</a>,  <span class="stringliteral">&quot;generic error&quot;</span>            },</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    { NV_ENC_ERR_INCOMPATIBLE_CLIENT_KEY,  <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EINVAL),  <span class="stringliteral">&quot;incompatible client key&quot;</span>  },</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    { NV_ENC_ERR_UNIMPLEMENTED,            <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOSYS),  <span class="stringliteral">&quot;unimplemented&quot;</span>            },</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    { NV_ENC_ERR_RESOURCE_REGISTER_FAILED, <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EIO),     <span class="stringliteral">&quot;resource register failed&quot;</span> },</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    { NV_ENC_ERR_RESOURCE_NOT_REGISTERED,  <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EBADF),   <span class="stringliteral">&quot;resource not registered&quot;</span>  },</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    { NV_ENC_ERR_RESOURCE_NOT_MAPPED,      <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EBADF),   <span class="stringliteral">&quot;resource not mapped&quot;</span>      },</div>
<div class="line"><a name="l00110"></a><span class="lineno"><a class="line" href="nvenc_8c.html#a3be29e24df433bfd1a0c641215cb23bf">  110</a></span>&#160;};</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160; </div>
<div class="line"><a name="l00112"></a><span class="lineno"><a class="line" href="nvenc_8c.html#a8d2892124c776dfe7b168dc1739109fd">  112</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="nvenc_8c.html#a8d2892124c776dfe7b168dc1739109fd">nvenc_map_error</a>(NVENCSTATUS err, <span class="keyword">const</span> <span class="keywordtype">char</span> **<a class="code" href="nvenc_8c.html#a710bce51374aba96ab04912897666c35">desc</a>)</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;{</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="sinewin__tablegen__template_8c.html#a3508a98d3ee7e2c9a4841fe264cf70f7">FF_ARRAY_ELEMS</a>(<a class="code" href="nvenc_8c.html#a3be29e24df433bfd1a0c641215cb23bf">nvenc_errors</a>); <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="nvenc_8c.html#a3be29e24df433bfd1a0c641215cb23bf">nvenc_errors</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="nvenc_8c.html#a4e0ddbacaa28d61a8fa4b77cc67a736f">nverr</a> == err) {</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="nvenc_8c.html#a710bce51374aba96ab04912897666c35">desc</a>)</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;                *<a class="code" href="nvenc_8c.html#a710bce51374aba96ab04912897666c35">desc</a> = <a class="code" href="nvenc_8c.html#a3be29e24df433bfd1a0c641215cb23bf">nvenc_errors</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].desc;</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="nvenc_8c.html#a3be29e24df433bfd1a0c641215cb23bf">nvenc_errors</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].averr;</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;        }</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    }</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="nvenc_8c.html#a710bce51374aba96ab04912897666c35">desc</a>)</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;        *<a class="code" href="nvenc_8c.html#a710bce51374aba96ab04912897666c35">desc</a> = <span class="stringliteral">&quot;unknown error&quot;</span>;</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="group__lavu__error.html#ga4ebaa288c7684a26a591c501208910e4">AVERROR_UNKNOWN</a>;</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;}</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160; </div>
<div class="line"><a name="l00127"></a><span class="lineno"><a class="line" href="nvenc_8c.html#a9859649f623b83a65a82803d3199e07a">  127</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="nvenc_8c.html#a9859649f623b83a65a82803d3199e07a">nvenc_print_error</a>(<a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a> *avctx, NVENCSTATUS err,</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;                             <span class="keyword">const</span> <span class="keywordtype">char</span> *error_string)</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;{</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="nvenc_8c.html#a710bce51374aba96ab04912897666c35">desc</a>;</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *details = <span class="stringliteral">&quot;(no details)&quot;</span>;</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = <a class="code" href="nvenc_8c.html#a8d2892124c776dfe7b168dc1739109fd">nvenc_map_error</a>(err, &amp;<a class="code" href="nvenc_8c.html#a710bce51374aba96ab04912897666c35">desc</a>);</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160; </div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="preprocessor">#ifdef NVENC_HAVE_GETLASTERRORSTRING</span></div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    <a class="code" href="struct_nvenc_context.html">NvencContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a> = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#af3379123060ad8cc9c321c29af4f8360">priv_data</a>;</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    NV_ENCODE_API_FUNCTION_LIST *p_nvenc = &amp;<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nvenc_dload_funcs.nvenc_funcs;</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160; </div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    <span class="keywordflow">if</span> (p_nvenc &amp;&amp; <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nvencoder)</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;        details = p_nvenc-&gt;nvEncGetLastErrorString(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nvencoder);</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160; </div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;%s: %s (%d): %s\n&quot;</span>, error_string, <a class="code" href="nvenc_8c.html#a710bce51374aba96ab04912897666c35">desc</a>, err, details);</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160; </div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>;</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;}</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160; </div>
<div class="line"><a name="l00147"></a><span class="lineno"><a class="line" href="nvenc_8c.html#abc524845e42dad899e1ca3f76cd3c1e6">  147</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="nvenc_8c.html#abc524845e42dad899e1ca3f76cd3c1e6">nvenc_print_driver_requirement</a>(<a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a> *avctx, <span class="keywordtype">int</span> <a class="code" href="svq3_8c.html#abbb6c7c49508c1ac374683f2d1159e08">level</a>)</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;{</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="preprocessor">#if NVENCAPI_CHECK_VERSION(11, 1)</span></div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *minver = <span class="stringliteral">&quot;(unknown)&quot;</span>;</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="preprocessor">#elif NVENCAPI_CHECK_VERSION(11, 0)</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="preprocessor"># if defined(_WIN32) || defined(__CYGWIN__)</span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *minver = <span class="stringliteral">&quot;456.71&quot;</span>;</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="preprocessor"># else</span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *minver = <span class="stringliteral">&quot;455.28&quot;</span>;</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;<span class="preprocessor"># endif</span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="preprocessor">#elif NVENCAPI_CHECK_VERSION(10, 0)</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="preprocessor"># if defined(_WIN32) || defined(__CYGWIN__)</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *minver = <span class="stringliteral">&quot;450.51&quot;</span>;</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="preprocessor"># else</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *minver = <span class="stringliteral">&quot;445.87&quot;</span>;</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;<span class="preprocessor"># endif</span></div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;<span class="preprocessor">#elif NVENCAPI_CHECK_VERSION(9, 1)</span></div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;<span class="preprocessor"># if defined(_WIN32) || defined(__CYGWIN__)</span></div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *minver = <span class="stringliteral">&quot;436.15&quot;</span>;</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;<span class="preprocessor"># else</span></div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *minver = <span class="stringliteral">&quot;435.21&quot;</span>;</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;<span class="preprocessor"># endif</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;<span class="preprocessor">#elif NVENCAPI_CHECK_VERSION(9, 0)</span></div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;<span class="preprocessor"># if defined(_WIN32) || defined(__CYGWIN__)</span></div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *minver = <span class="stringliteral">&quot;418.81&quot;</span>;</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;<span class="preprocessor"># else</span></div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *minver = <span class="stringliteral">&quot;418.30&quot;</span>;</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;<span class="preprocessor"># endif</span></div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;<span class="preprocessor">#elif NVENCAPI_CHECK_VERSION(8, 2)</span></div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;<span class="preprocessor"># if defined(_WIN32) || defined(__CYGWIN__)</span></div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *minver = <span class="stringliteral">&quot;397.93&quot;</span>;</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;<span class="preprocessor"># else</span></div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *minver = <span class="stringliteral">&quot;396.24&quot;</span>;</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;<span class="preprocessor">#elif NVENCAPI_CHECK_VERSION(8, 1)</span></div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;<span class="preprocessor"># if defined(_WIN32) || defined(__CYGWIN__)</span></div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *minver = <span class="stringliteral">&quot;390.77&quot;</span>;</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;<span class="preprocessor"># else</span></div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *minver = <span class="stringliteral">&quot;390.25&quot;</span>;</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;<span class="preprocessor"># endif</span></div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;<span class="preprocessor"># if defined(_WIN32) || defined(__CYGWIN__)</span></div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *minver = <span class="stringliteral">&quot;378.66&quot;</span>;</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;<span class="preprocessor"># else</span></div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *minver = <span class="stringliteral">&quot;378.13&quot;</span>;</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;<span class="preprocessor"># endif</span></div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="svq3_8c.html#abbb6c7c49508c1ac374683f2d1159e08">level</a>, <span class="stringliteral">&quot;The minimum required Nvidia driver for nvenc is %s or newer\n&quot;</span>, minver);</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;}</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160; </div>
<div class="line"><a name="l00197"></a><span class="lineno"><a class="line" href="nvenc_8c.html#a0c2527be99411c653118f3d8a7bdadbd">  197</a></span>&#160;<span class="keyword">static</span> <a class="code" href="attributes_8h.html#abeeb324fff79a5335d36774704e2475c">av_cold</a> <span class="keywordtype">int</span> <a class="code" href="nvenc_8c.html#a0c2527be99411c653118f3d8a7bdadbd">nvenc_load_libraries</a>(<a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a> *avctx)</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;{</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    <a class="code" href="struct_nvenc_context.html">NvencContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>            = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#af3379123060ad8cc9c321c29af4f8360">priv_data</a>;</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    <a class="code" href="struct_nvenc_dyn_load_functions.html">NvencDynLoadFunctions</a> *dl_fn = &amp;<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nvenc_dload_funcs;</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    NVENCSTATUS err;</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    uint32_t nvenc_max_ver;</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>;</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160; </div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = cuda_load_functions(&amp;dl_fn-&gt;<a class="code" href="struct_nvenc_dyn_load_functions.html#a801dc578eedece0a47492f092fd2dfbf">cuda_dl</a>, avctx);</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> &lt; 0)</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>;</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160; </div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = nvenc_load_functions(&amp;dl_fn-&gt;<a class="code" href="struct_nvenc_dyn_load_functions.html#a3d276b8fd283c51b18982a6da56d9309">nvenc_dl</a>, avctx);</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> &lt; 0) {</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;        <a class="code" href="nvenc_8c.html#abc524845e42dad899e1ca3f76cd3c1e6">nvenc_print_driver_requirement</a>(avctx, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>);</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>;</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    }</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160; </div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    err = dl_fn-&gt;<a class="code" href="struct_nvenc_dyn_load_functions.html#a3d276b8fd283c51b18982a6da56d9309">nvenc_dl</a>-&gt;NvEncodeAPIGetMaxSupportedVersion(&amp;nvenc_max_ver);</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    <span class="keywordflow">if</span> (err != NV_ENC_SUCCESS)</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="nvenc_8c.html#a9859649f623b83a65a82803d3199e07a">nvenc_print_error</a>(avctx, err, <span class="stringliteral">&quot;Failed to query nvenc max version&quot;</span>);</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160; </div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga9b58b28e2d429b930b69db19877f76a8">AV_LOG_VERBOSE</a>, <span class="stringliteral">&quot;Loaded Nvenc version %d.%d\n&quot;</span>, nvenc_max_ver &gt;&gt; 4, nvenc_max_ver &amp; 0<a class="code" href="cbs__av1_8c.html#a1ff781bc4368127725d8bb494f615fb3">xf</a>);</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160; </div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    <span class="keywordflow">if</span> ((NVENCAPI_MAJOR_VERSION &lt;&lt; 4 | NVENCAPI_MINOR_VERSION) &gt; nvenc_max_ver) {</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Driver does not support the required nvenc API version. &quot;</span></div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;               <span class="stringliteral">&quot;Required: %d.%d Found: %d.%d\n&quot;</span>,</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;               NVENCAPI_MAJOR_VERSION, NVENCAPI_MINOR_VERSION,</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;               nvenc_max_ver &gt;&gt; 4, nvenc_max_ver &amp; 0<a class="code" href="cbs__av1_8c.html#a1ff781bc4368127725d8bb494f615fb3">xf</a>);</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;        <a class="code" href="nvenc_8c.html#abc524845e42dad899e1ca3f76cd3c1e6">nvenc_print_driver_requirement</a>(avctx, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>);</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOSYS);</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    }</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160; </div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    dl_fn-&gt;<a class="code" href="struct_nvenc_dyn_load_functions.html#abb541819aaaf75f51f9c2c23f674de94">nvenc_funcs</a>.version = NV_ENCODE_API_FUNCTION_LIST_VER;</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160; </div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    err = dl_fn-&gt;<a class="code" href="struct_nvenc_dyn_load_functions.html#a3d276b8fd283c51b18982a6da56d9309">nvenc_dl</a>-&gt;NvEncodeAPICreateInstance(&amp;dl_fn-&gt;<a class="code" href="struct_nvenc_dyn_load_functions.html#abb541819aaaf75f51f9c2c23f674de94">nvenc_funcs</a>);</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    <span class="keywordflow">if</span> (err != NV_ENC_SUCCESS)</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="nvenc_8c.html#a9859649f623b83a65a82803d3199e07a">nvenc_print_error</a>(avctx, err, <span class="stringliteral">&quot;Failed to create nvenc instance&quot;</span>);</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160; </div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga9b58b28e2d429b930b69db19877f76a8">AV_LOG_VERBOSE</a>, <span class="stringliteral">&quot;Nvenc initialized successfully\n&quot;</span>);</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160; </div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;}</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160; </div>
<div class="line"><a name="l00241"></a><span class="lineno"><a class="line" href="nvenc_8c.html#a12819453065171c2aa768766ab201f4e">  241</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="nvenc_8c.html#a12819453065171c2aa768766ab201f4e">nvenc_push_context</a>(<a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a> *avctx)</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;{</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    <a class="code" href="struct_nvenc_context.html">NvencContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>            = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#af3379123060ad8cc9c321c29af4f8360">priv_data</a>;</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    <a class="code" href="struct_nvenc_dyn_load_functions.html">NvencDynLoadFunctions</a> *dl_fn = &amp;<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nvenc_dload_funcs;</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160; </div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;d3d11_device)</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160; </div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="nvenc_8c.html#aabb147a1f2a98d37cb3ce0dd6d50b78d">CHECK_CU</a>(dl_fn-&gt;<a class="code" href="struct_nvenc_dyn_load_functions.html#a801dc578eedece0a47492f092fd2dfbf">cuda_dl</a>-&gt;cuCtxPushCurrent(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;cu_context));</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;}</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160; </div>
<div class="line"><a name="l00252"></a><span class="lineno"><a class="line" href="nvenc_8c.html#ad2d50f7855c51659e8df21a154b26577">  252</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="nvenc_8c.html#ad2d50f7855c51659e8df21a154b26577">nvenc_pop_context</a>(<a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a> *avctx)</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;{</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    <a class="code" href="struct_nvenc_context.html">NvencContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>            = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#af3379123060ad8cc9c321c29af4f8360">priv_data</a>;</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    <a class="code" href="struct_nvenc_dyn_load_functions.html">NvencDynLoadFunctions</a> *dl_fn = &amp;<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nvenc_dload_funcs;</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    CUcontext <a class="code" href="motion_8c.html#a7c1d654b7b6114d7a0abc8d351dd1bcd">dummy</a>;</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160; </div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;d3d11_device)</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160; </div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="nvenc_8c.html#aabb147a1f2a98d37cb3ce0dd6d50b78d">CHECK_CU</a>(dl_fn-&gt;<a class="code" href="struct_nvenc_dyn_load_functions.html#a801dc578eedece0a47492f092fd2dfbf">cuda_dl</a>-&gt;cuCtxPopCurrent(&amp;<a class="code" href="motion_8c.html#a7c1d654b7b6114d7a0abc8d351dd1bcd">dummy</a>));</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;}</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160; </div>
<div class="line"><a name="l00264"></a><span class="lineno"><a class="line" href="nvenc_8c.html#a9bb7a5dcc832adb060e92e25976389ec">  264</a></span>&#160;<span class="keyword">static</span> <a class="code" href="attributes_8h.html#abeeb324fff79a5335d36774704e2475c">av_cold</a> <span class="keywordtype">int</span> <a class="code" href="nvenc_8c.html#a9bb7a5dcc832adb060e92e25976389ec">nvenc_open_session</a>(<a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a> *avctx)</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;{</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    NV_ENC_OPEN_ENCODE_SESSION_EX_PARAMS params = { 0 };</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    <a class="code" href="struct_nvenc_context.html">NvencContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a> = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#af3379123060ad8cc9c321c29af4f8360">priv_data</a>;</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    NV_ENCODE_API_FUNCTION_LIST *p_nvenc = &amp;<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nvenc_dload_funcs.nvenc_funcs;</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    NVENCSTATUS <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>;</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160; </div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    params.version    = NV_ENC_OPEN_ENCODE_SESSION_EX_PARAMS_VER;</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    params.apiVersion = NVENCAPI_VERSION;</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;d3d11_device) {</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;        params.device     = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;d3d11_device;</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;        params.deviceType = NV_ENC_DEVICE_TYPE_DIRECTX;</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;        params.device     = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;cu_context;</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;        params.deviceType = NV_ENC_DEVICE_TYPE_CUDA;</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    }</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160; </div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = p_nvenc-&gt;nvEncOpenEncodeSessionEx(&amp;params, &amp;<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nvencoder);</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> != NV_ENC_SUCCESS) {</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nvencoder = <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="nvenc_8c.html#a9859649f623b83a65a82803d3199e07a">nvenc_print_error</a>(avctx, <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>, <span class="stringliteral">&quot;OpenEncodeSessionEx failed&quot;</span>);</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    }</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160; </div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;}</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160; </div>
<div class="line"><a name="l00290"></a><span class="lineno"><a class="line" href="nvenc_8c.html#ac72a8499f99a33d19cc60b5e15aeb6d4">  290</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="nvenc_8c.html#ac72a8499f99a33d19cc60b5e15aeb6d4">nvenc_check_codec_support</a>(<a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a> *avctx)</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;{</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    <a class="code" href="struct_nvenc_context.html">NvencContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>                    = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#af3379123060ad8cc9c321c29af4f8360">priv_data</a>;</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    NV_ENCODE_API_FUNCTION_LIST *p_nvenc = &amp;<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nvenc_dload_funcs.nvenc_funcs;</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>, count = 0;</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    GUID *guids = <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160; </div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = p_nvenc-&gt;nvEncGetEncodeGUIDCount(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nvencoder, &amp;count);</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160; </div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> != NV_ENC_SUCCESS || !count)</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOSYS);</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160; </div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    guids = <a class="code" href="tableprint__vlc_8h.html#ae97db1f58b6b1515ed57a83bea3dd572">av_malloc</a>(count * <span class="keyword">sizeof</span>(GUID));</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    <span class="keywordflow">if</span> (!guids)</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160; </div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = p_nvenc-&gt;nvEncGetEncodeGUIDs(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nvencoder, guids, count, &amp;count);</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> != NV_ENC_SUCCESS) {</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;        <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOSYS);</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    }</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160; </div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOSYS);</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; count; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;        <span class="keywordflow">if</span> (!memcmp(&amp;guids[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>], &amp;<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;init_encode_params.encodeGUID, <span class="keyword">sizeof</span>(*guids))) {</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;            <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = 0;</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;        }</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    }</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160; </div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;<a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>:</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#a079eab092887563f2bef9106c6120089">av_free</a>(guids);</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160; </div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>;</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;}</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160; </div>
<div class="line"><a name="l00326"></a><span class="lineno"><a class="line" href="nvenc_8c.html#a0f0ca83a25ba921f09477bd0e6c6278e">  326</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="nvenc_8c.html#a0f0ca83a25ba921f09477bd0e6c6278e">nvenc_check_cap</a>(<a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a> *avctx, NV_ENC_CAPS cap)</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;{</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    <a class="code" href="struct_nvenc_context.html">NvencContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a> = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#af3379123060ad8cc9c321c29af4f8360">priv_data</a>;</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    NV_ENCODE_API_FUNCTION_LIST *p_nvenc = &amp;<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nvenc_dload_funcs.nvenc_funcs;</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    NV_ENC_CAPS_PARAM params        = { 0 };</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>, <a class="code" href="aeval_8c.html#a16aca557f352132b55bbc3c4769daa8b">val</a> = 0;</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160; </div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    params.version     = NV_ENC_CAPS_PARAM_VER;</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    params.capsToQuery = cap;</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160; </div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = p_nvenc-&gt;nvEncGetEncodeCaps(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nvencoder, <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;init_encode_params.encodeGUID, &amp;params, &amp;<a class="code" href="aeval_8c.html#a16aca557f352132b55bbc3c4769daa8b">val</a>);</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160; </div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> == NV_ENC_SUCCESS)</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="aeval_8c.html#a16aca557f352132b55bbc3c4769daa8b">val</a>;</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;}</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160; </div>
<div class="line"><a name="l00343"></a><span class="lineno"><a class="line" href="nvenc_8c.html#a40d2efce9c4948a72268823edb874d3a">  343</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="nvenc_8c.html#a40d2efce9c4948a72268823edb874d3a">nvenc_check_capabilities</a>(<a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a> *avctx)</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;{</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    <a class="code" href="struct_nvenc_context.html">NvencContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a> = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#af3379123060ad8cc9c321c29af4f8360">priv_data</a>;</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>;</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160; </div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = <a class="code" href="nvenc_8c.html#ac72a8499f99a33d19cc60b5e15aeb6d4">nvenc_check_codec_support</a>(avctx);</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> &lt; 0) {</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga85b57516ca703cc47d9bbe5f4658c716">AV_LOG_WARNING</a>, <span class="stringliteral">&quot;Codec not supported\n&quot;</span>);</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>;</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    }</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160; </div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = <a class="code" href="nvenc_8c.html#a0f0ca83a25ba921f09477bd0e6c6278e">nvenc_check_cap</a>(avctx, NV_ENC_CAPS_SUPPORT_YUV444_ENCODE);</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="nvenc_8c.html#a4283d2a341ed469ecbb452243fd148a7">IS_YUV444</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;data_pix_fmt) &amp;&amp; <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> &lt;= 0) {</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga85b57516ca703cc47d9bbe5f4658c716">AV_LOG_WARNING</a>, <span class="stringliteral">&quot;YUV444P not supported\n&quot;</span>);</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOSYS);</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    }</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160; </div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = <a class="code" href="nvenc_8c.html#a0f0ca83a25ba921f09477bd0e6c6278e">nvenc_check_cap</a>(avctx, NV_ENC_CAPS_SUPPORT_LOSSLESS_ENCODE);</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;preset &gt;= <a class="code" href="group__avoptions.html#gga06fc87d81c62e9abb8790b6e5713c55ba464ca6b9ea1e24bcbadde231ea15cac0">PRESET_LOSSLESS_DEFAULT</a> &amp;&amp; <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> &lt;= 0) {</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga85b57516ca703cc47d9bbe5f4658c716">AV_LOG_WARNING</a>, <span class="stringliteral">&quot;Lossless encoding not supported\n&quot;</span>);</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOSYS);</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    }</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160; </div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;    <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = <a class="code" href="nvenc_8c.html#a0f0ca83a25ba921f09477bd0e6c6278e">nvenc_check_cap</a>(avctx, NV_ENC_CAPS_WIDTH_MAX);</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    <span class="keywordflow">if</span> (ret &lt; avctx-&gt;<a class="code" href="tests_2snowenc_8c.html#a667b04d7fb6ef46db4da4af554c5b6f7">width</a>) {</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga85b57516ca703cc47d9bbe5f4658c716">AV_LOG_WARNING</a>, <span class="stringliteral">&quot;Width %d exceeds %d\n&quot;</span>,</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;               avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a0d8f46461754e8abea0847dcbc41b956">width</a>, <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>);</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOSYS);</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    }</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160; </div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;    <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = <a class="code" href="nvenc_8c.html#a0f0ca83a25ba921f09477bd0e6c6278e">nvenc_check_cap</a>(avctx, NV_ENC_CAPS_HEIGHT_MAX);</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    <span class="keywordflow">if</span> (ret &lt; avctx-&gt;<a class="code" href="tests_2snowenc_8c.html#a64f9f90ece96c7bab4aee3deacf170e0">height</a>) {</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga85b57516ca703cc47d9bbe5f4658c716">AV_LOG_WARNING</a>, <span class="stringliteral">&quot;Height %d exceeds %d\n&quot;</span>,</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;               avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a0449afd803eb107bd4dbc8b5ea22e363">height</a>, <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>);</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOSYS);</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    }</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160; </div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = <a class="code" href="nvenc_8c.html#a0f0ca83a25ba921f09477bd0e6c6278e">nvenc_check_cap</a>(avctx, NV_ENC_CAPS_NUM_MAX_BFRAMES);</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    <span class="keywordflow">if</span> (ret &lt; avctx-&gt;max_b_frames) {</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga85b57516ca703cc47d9bbe5f4658c716">AV_LOG_WARNING</a>, <span class="stringliteral">&quot;Max B-frames %d exceed %d\n&quot;</span>,</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;               avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a3e5334a611a3e2a6a653805bb9e2d4d4">max_b_frames</a>, <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>);</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160; </div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOSYS);</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;    }</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160; </div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;    <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = <a class="code" href="nvenc_8c.html#a0f0ca83a25ba921f09477bd0e6c6278e">nvenc_check_cap</a>(avctx, NV_ENC_CAPS_SUPPORT_FIELD_ENCODING);</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;    <span class="keywordflow">if</span> (ret &lt; 1 &amp;&amp; avctx-&gt;<a class="code" href="cbs__av1_8c.html#a67119bce106892b6dade1dc5aa405ac9">flags</a> &amp; <a class="code" href="group__lavc__core.html#ga502225f65e2092fbc45945247892cb0f">AV_CODEC_FLAG_INTERLACED_DCT</a>) {</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga85b57516ca703cc47d9bbe5f4658c716">AV_LOG_WARNING</a>,</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;               <span class="stringliteral">&quot;Interlaced encoding is not supported. Supported level: %d\n&quot;</span>,</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;               <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>);</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOSYS);</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    }</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160; </div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = <a class="code" href="nvenc_8c.html#a0f0ca83a25ba921f09477bd0e6c6278e">nvenc_check_cap</a>(avctx, NV_ENC_CAPS_SUPPORT_10BIT_ENCODE);</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="nvenc_8c.html#aa811025b0fbbeacacd640511c965212f">IS_10BIT</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;data_pix_fmt) &amp;&amp; <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> &lt;= 0) {</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga85b57516ca703cc47d9bbe5f4658c716">AV_LOG_WARNING</a>, <span class="stringliteral">&quot;10 bit encode not supported\n&quot;</span>);</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOSYS);</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    }</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160; </div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = <a class="code" href="nvenc_8c.html#a0f0ca83a25ba921f09477bd0e6c6278e">nvenc_check_cap</a>(avctx, NV_ENC_CAPS_SUPPORT_LOOKAHEAD);</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;rc_lookahead &gt; 0 &amp;&amp; <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> &lt;= 0) {</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga85b57516ca703cc47d9bbe5f4658c716">AV_LOG_WARNING</a>, <span class="stringliteral">&quot;RC lookahead not supported\n&quot;</span>);</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOSYS);</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;    }</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160; </div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = <a class="code" href="nvenc_8c.html#a0f0ca83a25ba921f09477bd0e6c6278e">nvenc_check_cap</a>(avctx, NV_ENC_CAPS_SUPPORT_TEMPORAL_AQ);</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;temporal_aq &gt; 0 &amp;&amp; <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> &lt;= 0) {</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga85b57516ca703cc47d9bbe5f4658c716">AV_LOG_WARNING</a>, <span class="stringliteral">&quot;Temporal AQ not supported\n&quot;</span>);</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOSYS);</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;    }</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160; </div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = <a class="code" href="nvenc_8c.html#a0f0ca83a25ba921f09477bd0e6c6278e">nvenc_check_cap</a>(avctx, NV_ENC_CAPS_SUPPORT_WEIGHTED_PREDICTION);</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;weighted_pred &gt; 0 &amp;&amp; <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> &lt;= 0) {</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a> (avctx, <a class="code" href="group__lavu__log__constants.html#ga85b57516ca703cc47d9bbe5f4658c716">AV_LOG_WARNING</a>, <span class="stringliteral">&quot;Weighted Prediction not supported\n&quot;</span>);</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOSYS);</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;    }</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160; </div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;    <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = <a class="code" href="nvenc_8c.html#a0f0ca83a25ba921f09477bd0e6c6278e">nvenc_check_cap</a>(avctx, NV_ENC_CAPS_SUPPORT_CABAC);</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;coder == NV_ENC_H264_ENTROPY_CODING_MODE_CABAC &amp;&amp; <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> &lt;= 0) {</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga85b57516ca703cc47d9bbe5f4658c716">AV_LOG_WARNING</a>, <span class="stringliteral">&quot;CABAC entropy coding not supported\n&quot;</span>);</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOSYS);</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    }</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160; </div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;<span class="preprocessor">#ifdef NVENC_HAVE_BFRAME_REF_MODE</span></div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;    <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = <a class="code" href="nvenc_8c.html#a0f0ca83a25ba921f09477bd0e6c6278e">nvenc_check_cap</a>(avctx, NV_ENC_CAPS_SUPPORT_BFRAME_REF_MODE);</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;b_ref_mode == NV_ENC_BFRAME_REF_MODE_EACH &amp;&amp; <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> != 1 &amp;&amp; <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> != 3) {</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga85b57516ca703cc47d9bbe5f4658c716">AV_LOG_WARNING</a>, <span class="stringliteral">&quot;Each B frame as reference is not supported\n&quot;</span>);</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOSYS);</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;b_ref_mode != NV_ENC_BFRAME_REF_MODE_DISABLED &amp;&amp; <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> == 0) {</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga85b57516ca703cc47d9bbe5f4658c716">AV_LOG_WARNING</a>, <span class="stringliteral">&quot;B frames as references are not supported\n&quot;</span>);</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOSYS);</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    }</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;b_ref_mode != 0) {</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga85b57516ca703cc47d9bbe5f4658c716">AV_LOG_WARNING</a>, <span class="stringliteral">&quot;B frames as references need SDK 8.1 at build time\n&quot;</span>);</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOSYS);</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;    }</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160; </div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;<span class="preprocessor">#ifdef NVENC_HAVE_MULTIPLE_REF_FRAMES</span></div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;    <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = <a class="code" href="nvenc_8c.html#a0f0ca83a25ba921f09477bd0e6c6278e">nvenc_check_cap</a>(avctx, NV_ENC_CAPS_SUPPORT_MULTIPLE_REF_FRAMES);</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;    <span class="keywordflow">if</span>(avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#aa0cb7241b4624dba761c8cf58fb2d5f0">refs</a> != NV_ENC_NUM_REF_FRAMES_AUTOSELECT &amp;&amp; <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> &lt;= 0) {</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga85b57516ca703cc47d9bbe5f4658c716">AV_LOG_WARNING</a>, <span class="stringliteral">&quot;Multiple reference frames are not supported by the device\n&quot;</span>);</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOSYS);</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    }</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    <span class="keywordflow">if</span>(avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#aa0cb7241b4624dba761c8cf58fb2d5f0">refs</a> != 0) {</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga85b57516ca703cc47d9bbe5f4658c716">AV_LOG_WARNING</a>, <span class="stringliteral">&quot;Multiple reference frames need SDK 9.1 at build time\n&quot;</span>);</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOSYS);</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;    }</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160; </div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;support_dyn_bitrate = <a class="code" href="nvenc_8c.html#a0f0ca83a25ba921f09477bd0e6c6278e">nvenc_check_cap</a>(avctx, NV_ENC_CAPS_SUPPORT_DYN_BITRATE_CHANGE);</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160; </div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;}</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160; </div>
<div class="line"><a name="l00460"></a><span class="lineno"><a class="line" href="nvenc_8c.html#a197d7024cb640b208160801121977be7">  460</a></span>&#160;<span class="keyword">static</span> <a class="code" href="attributes_8h.html#abeeb324fff79a5335d36774704e2475c">av_cold</a> <span class="keywordtype">int</span> <a class="code" href="nvenc_8c.html#a197d7024cb640b208160801121977be7">nvenc_check_device</a>(<a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a> *avctx, <span class="keywordtype">int</span> idx)</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;{</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;    <a class="code" href="struct_nvenc_context.html">NvencContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a> = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#af3379123060ad8cc9c321c29af4f8360">priv_data</a>;</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    <a class="code" href="struct_nvenc_dyn_load_functions.html">NvencDynLoadFunctions</a> *dl_fn = &amp;<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nvenc_dload_funcs;</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;    NV_ENCODE_API_FUNCTION_LIST *p_nvenc = &amp;dl_fn-&gt;<a class="code" href="struct_nvenc_dyn_load_functions.html#abb541819aaaf75f51f9c2c23f674de94">nvenc_funcs</a>;</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;    <span class="keywordtype">char</span> <a class="code" href="writing__filters_8txt.html#adb27990ed3d4ad300fd1dde281903508">name</a>[128] = { 0};</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="namespaceconvert__header.html#ac8d67a61fdde2fcdd4358f78109f4b7a">major</a>, <a class="code" href="namespaceconvert__header.html#afbbd9db93850ca44e2f56ebb00ce0e0c">minor</a>, <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>;</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;    CUdevice cu_device;</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    <span class="keywordtype">int</span> loglevel = <a class="code" href="group__lavu__log__constants.html#ga9b58b28e2d429b930b69db19877f76a8">AV_LOG_VERBOSE</a>;</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160; </div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;device == <a class="code" href="nvenc_8h.html#adc29c2ff13d900c2f185ee95427fb06ca7da7f42ac52783391873425e6937b3cc">LIST_DEVICES</a>)</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;        loglevel = <a class="code" href="group__lavu__log__constants.html#gad172eacfed8653e454c6fdcbe53baab3">AV_LOG_INFO</a>;</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160; </div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = <a class="code" href="nvenc_8c.html#aabb147a1f2a98d37cb3ce0dd6d50b78d">CHECK_CU</a>(dl_fn-&gt;<a class="code" href="struct_nvenc_dyn_load_functions.html#a801dc578eedece0a47492f092fd2dfbf">cuda_dl</a>-&gt;cuDeviceGet(&amp;cu_device, idx));</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> &lt; 0)</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>;</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160; </div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = <a class="code" href="nvenc_8c.html#aabb147a1f2a98d37cb3ce0dd6d50b78d">CHECK_CU</a>(dl_fn-&gt;<a class="code" href="struct_nvenc_dyn_load_functions.html#a801dc578eedece0a47492f092fd2dfbf">cuda_dl</a>-&gt;cuDeviceGetName(<a class="code" href="writing__filters_8txt.html#adb27990ed3d4ad300fd1dde281903508">name</a>, <span class="keyword">sizeof</span>(<a class="code" href="writing__filters_8txt.html#adb27990ed3d4ad300fd1dde281903508">name</a>), cu_device));</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> &lt; 0)</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>;</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160; </div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;    <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = <a class="code" href="nvenc_8c.html#aabb147a1f2a98d37cb3ce0dd6d50b78d">CHECK_CU</a>(dl_fn-&gt;<a class="code" href="struct_nvenc_dyn_load_functions.html#a801dc578eedece0a47492f092fd2dfbf">cuda_dl</a>-&gt;cuDeviceComputeCapability(&amp;<a class="code" href="namespaceconvert__header.html#ac8d67a61fdde2fcdd4358f78109f4b7a">major</a>, &amp;<a class="code" href="namespaceconvert__header.html#afbbd9db93850ca44e2f56ebb00ce0e0c">minor</a>, cu_device));</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> &lt; 0)</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>;</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160; </div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, loglevel, <span class="stringliteral">&quot;[ GPU #%d - &lt; %s &gt; has Compute SM %d.%d ]\n&quot;</span>, idx, <a class="code" href="writing__filters_8txt.html#adb27990ed3d4ad300fd1dde281903508">name</a>, <a class="code" href="namespaceconvert__header.html#ac8d67a61fdde2fcdd4358f78109f4b7a">major</a>, <a class="code" href="namespaceconvert__header.html#afbbd9db93850ca44e2f56ebb00ce0e0c">minor</a>);</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;    <span class="keywordflow">if</span> (((<a class="code" href="namespaceconvert__header.html#ac8d67a61fdde2fcdd4358f78109f4b7a">major</a> &lt;&lt; 4) | <a class="code" href="namespaceconvert__header.html#afbbd9db93850ca44e2f56ebb00ce0e0c">minor</a>) &lt; <a class="code" href="nvenc_8c.html#ab9c969896faddf6ab3f8153bea54bcf2">NVENC_CAP</a>) {</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, loglevel, <span class="stringliteral">&quot;does not support NVENC\n&quot;</span>);</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;    }</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160; </div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;device != idx &amp;&amp; <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;device != <a class="code" href="nvenc_8h.html#adc29c2ff13d900c2f185ee95427fb06caae9759caeef7d4a66c5f1c0a3f56643f">ANY_DEVICE</a>)</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;        <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160; </div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;    <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = <a class="code" href="nvenc_8c.html#aabb147a1f2a98d37cb3ce0dd6d50b78d">CHECK_CU</a>(dl_fn-&gt;<a class="code" href="struct_nvenc_dyn_load_functions.html#a801dc578eedece0a47492f092fd2dfbf">cuda_dl</a>-&gt;cuCtxCreate(&amp;<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;cu_context_internal, 0, cu_device));</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> &lt; 0)</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160; </div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;cu_context = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;cu_context_internal;</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;cu_stream = <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160; </div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;    <span class="keywordflow">if</span> ((<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = <a class="code" href="nvenc_8c.html#ad2d50f7855c51659e8df21a154b26577">nvenc_pop_context</a>(avctx)) &lt; 0)</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;        <span class="keywordflow">goto</span> fail2;</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160; </div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;    <span class="keywordflow">if</span> ((<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = <a class="code" href="nvenc_8c.html#a9bb7a5dcc832adb060e92e25976389ec">nvenc_open_session</a>(avctx)) &lt; 0)</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;        <span class="keywordflow">goto</span> fail2;</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160; </div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;    <span class="keywordflow">if</span> ((<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = <a class="code" href="nvenc_8c.html#a40d2efce9c4948a72268823edb874d3a">nvenc_check_capabilities</a>(avctx)) &lt; 0)</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;        <span class="keywordflow">goto</span> fail3;</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160; </div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, loglevel, <span class="stringliteral">&quot;supports NVENC\n&quot;</span>);</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160; </div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;    dl_fn-&gt;<a class="code" href="struct_nvenc_dyn_load_functions.html#a79079d6464c9f18004898ebaf72a07d8">nvenc_device_count</a>++;</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160; </div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;device == idx || <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;device == <a class="code" href="nvenc_8h.html#adc29c2ff13d900c2f185ee95427fb06caae9759caeef7d4a66c5f1c0a3f56643f">ANY_DEVICE</a>)</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160; </div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;fail3:</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;    <span class="keywordflow">if</span> ((<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = <a class="code" href="nvenc_8c.html#a12819453065171c2aa768766ab201f4e">nvenc_push_context</a>(avctx)) &lt; 0)</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>;</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160; </div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;    p_nvenc-&gt;nvEncDestroyEncoder(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nvencoder);</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nvencoder = <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160; </div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;    <span class="keywordflow">if</span> ((<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = <a class="code" href="nvenc_8c.html#ad2d50f7855c51659e8df21a154b26577">nvenc_pop_context</a>(avctx)) &lt; 0)</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>;</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160; </div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;fail2:</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;    <a class="code" href="nvenc_8c.html#aabb147a1f2a98d37cb3ce0dd6d50b78d">CHECK_CU</a>(dl_fn-&gt;<a class="code" href="struct_nvenc_dyn_load_functions.html#a801dc578eedece0a47492f092fd2dfbf">cuda_dl</a>-&gt;cuCtxDestroy(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;cu_context_internal));</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;cu_context_internal = <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160; </div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;<a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>:</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOSYS);</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;}</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160; </div>
<div class="line"><a name="l00535"></a><span class="lineno"><a class="line" href="nvenc_8c.html#ae45695734db17add2efbad9b3295fc7c">  535</a></span>&#160;<span class="keyword">static</span> <a class="code" href="attributes_8h.html#abeeb324fff79a5335d36774704e2475c">av_cold</a> <span class="keywordtype">int</span> <a class="code" href="nvenc_8c.html#ae45695734db17add2efbad9b3295fc7c">nvenc_setup_device</a>(<a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a> *avctx)</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;{</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;    <a class="code" href="struct_nvenc_context.html">NvencContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>            = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#af3379123060ad8cc9c321c29af4f8360">priv_data</a>;</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;    <a class="code" href="struct_nvenc_dyn_load_functions.html">NvencDynLoadFunctions</a> *dl_fn = &amp;<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nvenc_dload_funcs;</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160; </div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;    <span class="keywordflow">switch</span> (avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a6e606effa68724cae2ef5cc05f7fd9cb">codec</a>-&gt;<a class="code" href="struct_a_v_codec.html#a01a53d07936f4c7ee280444793b6967b">id</a>) {</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="group__lavc__core.html#ggaadca229ad2c20e060a14fec08a5cc7cea3d4c051c8b18a3c18750676a308c10be">AV_CODEC_ID_H264</a>:</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;init_encode_params.encodeGUID = NV_ENC_CODEC_H264_GUID;</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="group__lavc__core.html#ggaadca229ad2c20e060a14fec08a5cc7ceaa3e19a45b81bb602a4a37a4221274a20">AV_CODEC_ID_HEVC</a>:</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;init_encode_params.encodeGUID = NV_ENC_CODEC_HEVC_GUID;</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;    <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="group__lavu__error.html#gaa102cde7ec5acbc099c3bcbb58556a18">AVERROR_BUG</a>;</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;    }</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160; </div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;    <span class="keywordflow">if</span> (avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a0425c77b3d06d71e5db88b1d7e1b37f2">pix_fmt</a> == <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a5ab95e18c0c9e5335f29121418eab314">AV_PIX_FMT_CUDA</a> || avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a0425c77b3d06d71e5db88b1d7e1b37f2">pix_fmt</a> == <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a8cfd0b36308fa1ad3522ef8815ccbd0a">AV_PIX_FMT_D3D11</a> || avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a3bac44bb0b016ab838780cc19ac277d6">hw_frames_ctx</a> || avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#acf8113e490f9e7b57465e65af9c0c75c">hw_device_ctx</a>) {</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;        <a class="code" href="struct_a_v_h_w_frames_context.html">AVHWFramesContext</a>   *frames_ctx;</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;        <a class="code" href="struct_a_v_h_w_device_context.html">AVHWDeviceContext</a>   *hwdev_ctx;</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;        <a class="code" href="struct_a_v_c_u_d_a_device_context.html">AVCUDADeviceContext</a> *cuda_device_hwctx = <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;<span class="preprocessor">#if CONFIG_D3D11VA</span></div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;        <a class="code" href="struct_a_v_d3_d11_v_a_device_context.html">AVD3D11VADeviceContext</a> *d3d11_device_hwctx = <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;        <span class="keywordtype">int</span> <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>;</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160; </div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;        <span class="keywordflow">if</span> (avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a3bac44bb0b016ab838780cc19ac277d6">hw_frames_ctx</a>) {</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;            frames_ctx = (<a class="code" href="struct_a_v_h_w_frames_context.html">AVHWFramesContext</a>*)avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a3bac44bb0b016ab838780cc19ac277d6">hw_frames_ctx</a>-&gt;<a class="code" href="struct_a_v_buffer_ref.html#acb8452e99cd75074b93800b532c6ea4b">data</a>;</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;            <a class="code" href="filter__design_8txt.html#a0e82f1088fdc24c14bf175d2ac77523f">if</a> (frames_ctx-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#a045bc1713932804f6ceef170a5578e0e">format</a> == <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a5ab95e18c0c9e5335f29121418eab314">AV_PIX_FMT_CUDA</a>)</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;                cuda_device_hwctx = frames_ctx-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#ac9a7dbd0cbfcabc0b1529cb34cf53b6d">device_ctx</a>-&gt;<a class="code" href="struct_a_v_h_w_device_context.html#a46055b48d1a40445d775b4ae24f77f20">hwctx</a>;</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;<span class="preprocessor">#if CONFIG_D3D11VA</span></div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (frames_ctx-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#a045bc1713932804f6ceef170a5578e0e">format</a> == <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a8cfd0b36308fa1ad3522ef8815ccbd0a">AV_PIX_FMT_D3D11</a>)</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;                d3d11_device_hwctx = frames_ctx-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#ac9a7dbd0cbfcabc0b1529cb34cf53b6d">device_ctx</a>-&gt;<a class="code" href="struct_a_v_h_w_device_context.html#a46055b48d1a40445d775b4ae24f77f20">hwctx</a>;</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EINVAL);</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#acf8113e490f9e7b57465e65af9c0c75c">hw_device_ctx</a>) {</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;            hwdev_ctx = (<a class="code" href="struct_a_v_h_w_device_context.html">AVHWDeviceContext</a>*)avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#acf8113e490f9e7b57465e65af9c0c75c">hw_device_ctx</a>-&gt;<a class="code" href="struct_a_v_buffer_ref.html#acb8452e99cd75074b93800b532c6ea4b">data</a>;</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;            <a class="code" href="filter__design_8txt.html#a0e82f1088fdc24c14bf175d2ac77523f">if</a> (hwdev_ctx-&gt;<a class="code" href="struct_a_v_h_w_device_context.html#abc92603a11768828ef3aea1f9d089308">type</a> == <a class="code" href="hwcontext_8h.html#acf25724be4b066a51ad86aa9214b0d34a8447d4488b0fc4113c281cbdc6e7334e">AV_HWDEVICE_TYPE_CUDA</a>)</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;                cuda_device_hwctx = hwdev_ctx-&gt;<a class="code" href="struct_a_v_h_w_device_context.html#a46055b48d1a40445d775b4ae24f77f20">hwctx</a>;</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;<span class="preprocessor">#if CONFIG_D3D11VA</span></div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (hwdev_ctx-&gt;<a class="code" href="struct_a_v_h_w_device_context.html#abc92603a11768828ef3aea1f9d089308">type</a> == <a class="code" href="hwcontext_8h.html#acf25724be4b066a51ad86aa9214b0d34a1823a64d48c796978b892dd669659c4c">AV_HWDEVICE_TYPE_D3D11VA</a>)</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;                d3d11_device_hwctx = hwdev_ctx-&gt;<a class="code" href="struct_a_v_h_w_device_context.html#a46055b48d1a40445d775b4ae24f77f20">hwctx</a>;</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EINVAL);</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EINVAL);</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;        }</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160; </div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;        <span class="keywordflow">if</span> (cuda_device_hwctx) {</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;            <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;cu_context = cuda_device_hwctx-&gt;<a class="code" href="struct_a_v_c_u_d_a_device_context.html#ace8e7f76355f4120e33dd4488e26e96d">cuda_ctx</a>;</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;            <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;cu_stream = cuda_device_hwctx-&gt;<a class="code" href="struct_a_v_c_u_d_a_device_context.html#ae8f68056b89cd0c541d665600bf515f8">stream</a>;</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;        }</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;<span class="preprocessor">#if CONFIG_D3D11VA</span></div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (d3d11_device_hwctx) {</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;            <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;d3d11_device = d3d11_device_hwctx-&gt;<a class="code" href="struct_a_v_d3_d11_v_a_device_context.html#a846ae4cb1f91302845776cc843dc2808">device</a>;</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;            ID3D11Device_AddRef(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;d3d11_device);</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;        }</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160; </div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;        <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = <a class="code" href="nvenc_8c.html#a9bb7a5dcc832adb060e92e25976389ec">nvenc_open_session</a>(avctx);</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> &lt; 0)</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>;</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160; </div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;        <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = <a class="code" href="nvenc_8c.html#a40d2efce9c4948a72268823edb874d3a">nvenc_check_capabilities</a>(avctx);</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> &lt; 0) {</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga96970a2980bf6ad28cd403e7dc52d6c5">AV_LOG_FATAL</a>, <span class="stringliteral">&quot;Provided device doesn&#39;t support required NVENC features\n&quot;</span>);</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>;</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;        }</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;        <span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>, nb_devices = 0;</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160; </div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="nvenc_8c.html#aabb147a1f2a98d37cb3ce0dd6d50b78d">CHECK_CU</a>(dl_fn-&gt;<a class="code" href="struct_nvenc_dyn_load_functions.html#a801dc578eedece0a47492f092fd2dfbf">cuda_dl</a>-&gt;cuInit(0)) &lt; 0)</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="group__lavu__error.html#ga4ebaa288c7684a26a591c501208910e4">AVERROR_UNKNOWN</a>;</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160; </div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="nvenc_8c.html#aabb147a1f2a98d37cb3ce0dd6d50b78d">CHECK_CU</a>(dl_fn-&gt;<a class="code" href="struct_nvenc_dyn_load_functions.html#a801dc578eedece0a47492f092fd2dfbf">cuda_dl</a>-&gt;cuDeviceGetCount(&amp;nb_devices)) &lt; 0)</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="group__lavu__error.html#ga4ebaa288c7684a26a591c501208910e4">AVERROR_UNKNOWN</a>;</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160; </div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;        <span class="keywordflow">if</span> (!nb_devices) {</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga96970a2980bf6ad28cd403e7dc52d6c5">AV_LOG_FATAL</a>, <span class="stringliteral">&quot;No CUDA capable devices found\n&quot;</span>);</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="group__lavu__error.html#ga9c520e483ba8648495620ffdb4c491f2">AVERROR_EXTERNAL</a>;</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;        }</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160; </div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga9b58b28e2d429b930b69db19877f76a8">AV_LOG_VERBOSE</a>, <span class="stringliteral">&quot;%d CUDA capable devices found\n&quot;</span>, nb_devices);</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160; </div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;        dl_fn-&gt;<a class="code" href="struct_nvenc_dyn_load_functions.html#a79079d6464c9f18004898ebaf72a07d8">nvenc_device_count</a> = 0;</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; nb_devices; ++<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;            <span class="keywordflow">if</span> ((<a class="code" href="nvenc_8c.html#a197d7024cb640b208160801121977be7">nvenc_check_device</a>(avctx, <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)) &gt;= 0 &amp;&amp; <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;device != <a class="code" href="nvenc_8h.html#adc29c2ff13d900c2f185ee95427fb06ca7da7f42ac52783391873425e6937b3cc">LIST_DEVICES</a>)</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;                <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;        }</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160; </div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;device == <a class="code" href="nvenc_8h.html#adc29c2ff13d900c2f185ee95427fb06ca7da7f42ac52783391873425e6937b3cc">LIST_DEVICES</a>)</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="group__lavu__error.html#ga334ea23fd9e492cd0e718330f2353b6b">AVERROR_EXIT</a>;</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160; </div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;        <span class="keywordflow">if</span> (!dl_fn-&gt;<a class="code" href="struct_nvenc_dyn_load_functions.html#a79079d6464c9f18004898ebaf72a07d8">nvenc_device_count</a>) {</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga96970a2980bf6ad28cd403e7dc52d6c5">AV_LOG_FATAL</a>, <span class="stringliteral">&quot;No capable devices found\n&quot;</span>);</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="group__lavu__error.html#ga9c520e483ba8648495620ffdb4c491f2">AVERROR_EXTERNAL</a>;</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;        }</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160; </div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga96970a2980bf6ad28cd403e7dc52d6c5">AV_LOG_FATAL</a>, <span class="stringliteral">&quot;Requested GPU %d, but only %d GPUs are available!\n&quot;</span>, <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;device, nb_devices);</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EINVAL);</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;    }</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160; </div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;}</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160; </div>
<div class="line"><a name="l00641"></a><span class="lineno"><a class="line" href="struct_g_u_i_d_tuple.html">  641</a></span>&#160;<span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="struct_g_u_i_d_tuple.html">GUIDTuple</a> {</div>
<div class="line"><a name="l00642"></a><span class="lineno"><a class="line" href="struct_g_u_i_d_tuple.html#acd513c0d59ae5eb978b0b6f4bc22be05">  642</a></span>&#160;    <span class="keyword">const</span> GUID <a class="code" href="struct_g_u_i_d_tuple.html#acd513c0d59ae5eb978b0b6f4bc22be05">guid</a>;</div>
<div class="line"><a name="l00643"></a><span class="lineno"><a class="line" href="struct_g_u_i_d_tuple.html#af518fadff4c85736ecfcc2eeaac279f0">  643</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="struct_g_u_i_d_tuple.html#af518fadff4c85736ecfcc2eeaac279f0">flags</a>;</div>
<div class="line"><a name="l00644"></a><span class="lineno"><a class="line" href="nvenc_8c.html#a211fecd71f07bcb4546dc1c3ac8375c0">  644</a></span>&#160;} <a class="code" href="nvenc_8c.html#a211fecd71f07bcb4546dc1c3ac8375c0">GUIDTuple</a>;</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160; </div>
<div class="line"><a name="l00646"></a><span class="lineno"><a class="line" href="nvenc_8c.html#a565dbc279e0013ffbd152c7614ba8a8f">  646</a></span>&#160;<span class="preprocessor">#define PRESET_ALIAS(alias, name, ...) \</span></div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;<span class="preprocessor">    [PRESET_ ## alias] = { NV_ENC_PRESET_ ## name ## _GUID, __VA_ARGS__ }</span></div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160; </div>
<div class="line"><a name="l00649"></a><span class="lineno"><a class="line" href="nvenc_8c.html#ae1bc2b75d3ae189600fa0474e003f7f4">  649</a></span>&#160;<span class="preprocessor">#define PRESET(name, ...) PRESET_ALIAS(name, name, __VA_ARGS__)</span></div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160; </div>
<div class="line"><a name="l00651"></a><span class="lineno"><a class="line" href="nvenc_8c.html#aa4cf05195f3a39acc566306511dcad8d">  651</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="nvenc_8c.html#aa4cf05195f3a39acc566306511dcad8d">nvenc_map_preset</a>(<a class="code" href="struct_nvenc_context.html">NvencContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>)</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;{</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;    <a class="code" href="struct_g_u_i_d_tuple.html">GUIDTuple</a> presets[] = {</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;<span class="preprocessor">#ifdef NVENC_HAVE_NEW_PRESETS</span></div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;        <a class="code" href="nvenc_8c.html#ae1bc2b75d3ae189600fa0474e003f7f4">PRESET</a>(<a class="code" href="cavsdsp_8c.html#a6c2a9f7efd46f0160f3037869924d6ce">P1</a>),</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;        <a class="code" href="nvenc_8c.html#ae1bc2b75d3ae189600fa0474e003f7f4">PRESET</a>(<a class="code" href="cavsdsp_8c.html#ae00a52dba55d31948c377fa85d385b87">P2</a>),</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;        <a class="code" href="nvenc_8c.html#ae1bc2b75d3ae189600fa0474e003f7f4">PRESET</a>(<a class="code" href="hevcdsp__template_8c.html#a0707a89c2f63bd260108e9dbb669358e">P3</a>),</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;        <a class="code" href="nvenc_8c.html#ae1bc2b75d3ae189600fa0474e003f7f4">PRESET</a>(P4),</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;        <a class="code" href="nvenc_8c.html#ae1bc2b75d3ae189600fa0474e003f7f4">PRESET</a>(P5),</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;        <a class="code" href="nvenc_8c.html#ae1bc2b75d3ae189600fa0474e003f7f4">PRESET</a>(P6),</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;        <a class="code" href="nvenc_8c.html#ae1bc2b75d3ae189600fa0474e003f7f4">PRESET</a>(P7),</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;        <a class="code" href="nvenc_8c.html#a565dbc279e0013ffbd152c7614ba8a8f">PRESET_ALIAS</a>(SLOW,   P7, <a class="code" href="nvenc_8h.html#abc6126af1d45847bc59afa0aa3216b04a8e24acb32cbb33c5ef00164edd4973fb">NVENC_TWO_PASSES</a>),</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;        <a class="code" href="nvenc_8c.html#a565dbc279e0013ffbd152c7614ba8a8f">PRESET_ALIAS</a>(MEDIUM, P4, <a class="code" href="nvenc_8h.html#abc6126af1d45847bc59afa0aa3216b04afee116105aa3a30a9b28ca6281905925">NVENC_ONE_PASS</a>),</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;        <a class="code" href="nvenc_8c.html#a565dbc279e0013ffbd152c7614ba8a8f">PRESET_ALIAS</a>(FAST,   <a class="code" href="cavsdsp_8c.html#a6c2a9f7efd46f0160f3037869924d6ce">P1</a>, <a class="code" href="nvenc_8h.html#abc6126af1d45847bc59afa0aa3216b04afee116105aa3a30a9b28ca6281905925">NVENC_ONE_PASS</a>),</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;        <span class="comment">// Compat aliases</span></div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;        <a class="code" href="nvenc_8c.html#a565dbc279e0013ffbd152c7614ba8a8f">PRESET_ALIAS</a>(<a class="code" href="avdct_8c.html#a3da44afeba217135a680a7477b5e3ce3">DEFAULT</a>,             P4, <a class="code" href="nvenc_8h.html#abc6126af1d45847bc59afa0aa3216b04a3ed51dcd5f88e0045737487a3f537a41">NVENC_DEPRECATED_PRESET</a>),</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;        <a class="code" href="nvenc_8c.html#a565dbc279e0013ffbd152c7614ba8a8f">PRESET_ALIAS</a>(HP,                  <a class="code" href="cavsdsp_8c.html#a6c2a9f7efd46f0160f3037869924d6ce">P1</a>, <a class="code" href="nvenc_8h.html#abc6126af1d45847bc59afa0aa3216b04a3ed51dcd5f88e0045737487a3f537a41">NVENC_DEPRECATED_PRESET</a>),</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;        <a class="code" href="nvenc_8c.html#a565dbc279e0013ffbd152c7614ba8a8f">PRESET_ALIAS</a>(HQ,                  P7, <a class="code" href="nvenc_8h.html#abc6126af1d45847bc59afa0aa3216b04a3ed51dcd5f88e0045737487a3f537a41">NVENC_DEPRECATED_PRESET</a>),</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;        <a class="code" href="nvenc_8c.html#a565dbc279e0013ffbd152c7614ba8a8f">PRESET_ALIAS</a>(<a class="code" href="vf__curves_8c.html#a920971eab600c52963635b965ba64898">BD</a>,                  P5, <a class="code" href="nvenc_8h.html#abc6126af1d45847bc59afa0aa3216b04a3ed51dcd5f88e0045737487a3f537a41">NVENC_DEPRECATED_PRESET</a>),</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;        <a class="code" href="nvenc_8c.html#a565dbc279e0013ffbd152c7614ba8a8f">PRESET_ALIAS</a>(LOW_LATENCY_DEFAULT, P4, <a class="code" href="nvenc_8h.html#abc6126af1d45847bc59afa0aa3216b04a3ed51dcd5f88e0045737487a3f537a41">NVENC_DEPRECATED_PRESET</a> | <a class="code" href="nvenc_8h.html#abc6126af1d45847bc59afa0aa3216b04adaa15ff53eef4d8d6f1a9d1bb1f4f744">NVENC_LOWLATENCY</a>),</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;        <a class="code" href="nvenc_8c.html#a565dbc279e0013ffbd152c7614ba8a8f">PRESET_ALIAS</a>(LOW_LATENCY_HP,      <a class="code" href="cavsdsp_8c.html#a6c2a9f7efd46f0160f3037869924d6ce">P1</a>, <a class="code" href="nvenc_8h.html#abc6126af1d45847bc59afa0aa3216b04a3ed51dcd5f88e0045737487a3f537a41">NVENC_DEPRECATED_PRESET</a> | <a class="code" href="nvenc_8h.html#abc6126af1d45847bc59afa0aa3216b04adaa15ff53eef4d8d6f1a9d1bb1f4f744">NVENC_LOWLATENCY</a>),</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;        <a class="code" href="nvenc_8c.html#a565dbc279e0013ffbd152c7614ba8a8f">PRESET_ALIAS</a>(LOW_LATENCY_HQ,      P7, <a class="code" href="nvenc_8h.html#abc6126af1d45847bc59afa0aa3216b04a3ed51dcd5f88e0045737487a3f537a41">NVENC_DEPRECATED_PRESET</a> | <a class="code" href="nvenc_8h.html#abc6126af1d45847bc59afa0aa3216b04adaa15ff53eef4d8d6f1a9d1bb1f4f744">NVENC_LOWLATENCY</a>),</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;        <a class="code" href="nvenc_8c.html#a565dbc279e0013ffbd152c7614ba8a8f">PRESET_ALIAS</a>(LOSSLESS_DEFAULT,    P4, <a class="code" href="nvenc_8h.html#abc6126af1d45847bc59afa0aa3216b04a3ed51dcd5f88e0045737487a3f537a41">NVENC_DEPRECATED_PRESET</a> | <a class="code" href="nvenc_8h.html#abc6126af1d45847bc59afa0aa3216b04aa22e8b8329b9d0224ca00643f84e27e0">NVENC_LOSSLESS</a>),</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;        <a class="code" href="nvenc_8c.html#a565dbc279e0013ffbd152c7614ba8a8f">PRESET_ALIAS</a>(LOSSLESS_HP,         <a class="code" href="cavsdsp_8c.html#a6c2a9f7efd46f0160f3037869924d6ce">P1</a>, <a class="code" href="nvenc_8h.html#abc6126af1d45847bc59afa0aa3216b04a3ed51dcd5f88e0045737487a3f537a41">NVENC_DEPRECATED_PRESET</a> | <a class="code" href="nvenc_8h.html#abc6126af1d45847bc59afa0aa3216b04aa22e8b8329b9d0224ca00643f84e27e0">NVENC_LOSSLESS</a>),</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;        <a class="code" href="nvenc_8c.html#ae1bc2b75d3ae189600fa0474e003f7f4">PRESET</a>(<a class="code" href="avdct_8c.html#a3da44afeba217135a680a7477b5e3ce3">DEFAULT</a>),</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;        <a class="code" href="nvenc_8c.html#ae1bc2b75d3ae189600fa0474e003f7f4">PRESET</a>(HP),</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;        <a class="code" href="nvenc_8c.html#ae1bc2b75d3ae189600fa0474e003f7f4">PRESET</a>(HQ),</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;        <a class="code" href="nvenc_8c.html#ae1bc2b75d3ae189600fa0474e003f7f4">PRESET</a>(<a class="code" href="vf__curves_8c.html#a920971eab600c52963635b965ba64898">BD</a>),</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;        <a class="code" href="nvenc_8c.html#a565dbc279e0013ffbd152c7614ba8a8f">PRESET_ALIAS</a>(SLOW,   HQ,    <a class="code" href="nvenc_8h.html#abc6126af1d45847bc59afa0aa3216b04a8e24acb32cbb33c5ef00164edd4973fb">NVENC_TWO_PASSES</a>),</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;        <a class="code" href="nvenc_8c.html#a565dbc279e0013ffbd152c7614ba8a8f">PRESET_ALIAS</a>(MEDIUM, HQ,    <a class="code" href="nvenc_8h.html#abc6126af1d45847bc59afa0aa3216b04afee116105aa3a30a9b28ca6281905925">NVENC_ONE_PASS</a>),</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;        <a class="code" href="nvenc_8c.html#a565dbc279e0013ffbd152c7614ba8a8f">PRESET_ALIAS</a>(FAST,   HP,    <a class="code" href="nvenc_8h.html#abc6126af1d45847bc59afa0aa3216b04afee116105aa3a30a9b28ca6281905925">NVENC_ONE_PASS</a>),</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;        <a class="code" href="nvenc_8c.html#ae1bc2b75d3ae189600fa0474e003f7f4">PRESET</a>(LOW_LATENCY_DEFAULT, <a class="code" href="nvenc_8h.html#abc6126af1d45847bc59afa0aa3216b04adaa15ff53eef4d8d6f1a9d1bb1f4f744">NVENC_LOWLATENCY</a>),</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;        <a class="code" href="nvenc_8c.html#ae1bc2b75d3ae189600fa0474e003f7f4">PRESET</a>(LOW_LATENCY_HP,      <a class="code" href="nvenc_8h.html#abc6126af1d45847bc59afa0aa3216b04adaa15ff53eef4d8d6f1a9d1bb1f4f744">NVENC_LOWLATENCY</a>),</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;        <a class="code" href="nvenc_8c.html#ae1bc2b75d3ae189600fa0474e003f7f4">PRESET</a>(LOW_LATENCY_HQ,      <a class="code" href="nvenc_8h.html#abc6126af1d45847bc59afa0aa3216b04adaa15ff53eef4d8d6f1a9d1bb1f4f744">NVENC_LOWLATENCY</a>),</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;        <a class="code" href="nvenc_8c.html#ae1bc2b75d3ae189600fa0474e003f7f4">PRESET</a>(LOSSLESS_DEFAULT,    <a class="code" href="nvenc_8h.html#abc6126af1d45847bc59afa0aa3216b04aa22e8b8329b9d0224ca00643f84e27e0">NVENC_LOSSLESS</a>),</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;        <a class="code" href="nvenc_8c.html#ae1bc2b75d3ae189600fa0474e003f7f4">PRESET</a>(LOSSLESS_HP,         <a class="code" href="nvenc_8h.html#abc6126af1d45847bc59afa0aa3216b04aa22e8b8329b9d0224ca00643f84e27e0">NVENC_LOSSLESS</a>),</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;    };</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160; </div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;    <a class="code" href="struct_g_u_i_d_tuple.html">GUIDTuple</a> *t = &amp;presets[<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;preset];</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160; </div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;init_encode_params.presetGUID = t-&gt;<a class="code" href="struct_g_u_i_d_tuple.html#acd513c0d59ae5eb978b0b6f4bc22be05">guid</a>;</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;<a class="code" href="struct_a_v_format_context.html#a32379cc371463b235d54235d4af06a15">flags</a> = t-&gt;<a class="code" href="struct_g_u_i_d_tuple.html#af518fadff4c85736ecfcc2eeaac279f0">flags</a>;</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;}</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160; </div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;<span class="preprocessor">#undef PRESET</span></div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;<span class="preprocessor">#undef PRESET_ALIAS</span></div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160; </div>
<div class="line"><a name="l00700"></a><span class="lineno"><a class="line" href="nvenc_8c.html#a0dfcbbf27c383f6ddf48fcf8edea5081">  700</a></span>&#160;<span class="keyword">static</span> <a class="code" href="attributes_8h.html#abeeb324fff79a5335d36774704e2475c">av_cold</a> <span class="keywordtype">void</span> <a class="code" href="nvenc_8c.html#a0dfcbbf27c383f6ddf48fcf8edea5081">set_constqp</a>(<a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a> *avctx)</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;{</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;    <a class="code" href="struct_nvenc_context.html">NvencContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a> = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#af3379123060ad8cc9c321c29af4f8360">priv_data</a>;</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;    NV_ENC_RC_PARAMS *rc = &amp;<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;encode_config.rcParams;</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160; </div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;    rc-&gt;rateControlMode = NV_ENC_PARAMS_RC_CONSTQP;</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160; </div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;init_qp_p &gt;= 0) {</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;        rc-&gt;constQP.qpInterP = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;init_qp_p;</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;init_qp_i &gt;= 0 &amp;&amp; <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;init_qp_b &gt;= 0) {</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;            rc-&gt;constQP.qpIntra = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;init_qp_i;</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;            rc-&gt;constQP.qpInterB = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;init_qp_b;</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#aef7017818f06f053f2e63fe759b30eb1">i_quant_factor</a> != 0.0 &amp;&amp; avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a40a7fdf60f853d9140bbe1204a66efb2">b_quant_factor</a> != 0.0) {</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;            rc-&gt;constQP.qpIntra = av_clip(</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;                rc-&gt;constQP.qpInterP * <a class="code" href="cuda__runtime_8h.html#a7a87cd25426a228ce8ecbef48ab00de8">fabs</a>(avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#aef7017818f06f053f2e63fe759b30eb1">i_quant_factor</a>) + avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#afe9b149e17b9e28823ab3cf9732b990d">i_quant_offset</a> + 0.5, 0, 51);</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;            rc-&gt;constQP.qpInterB = av_clip(</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;                rc-&gt;constQP.qpInterP * <a class="code" href="cuda__runtime_8h.html#a7a87cd25426a228ce8ecbef48ab00de8">fabs</a>(avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a40a7fdf60f853d9140bbe1204a66efb2">b_quant_factor</a>) + avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a31a2ef78cf186083c2c676dda8e226db">b_quant_offset</a> + 0.5, 0, 51);</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;            rc-&gt;constQP.qpIntra = rc-&gt;constQP.qpInterP;</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;            rc-&gt;constQP.qpInterB = rc-&gt;constQP.qpInterP;</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;        }</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;cqp &gt;= 0) {</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;        rc-&gt;constQP.qpInterP = rc-&gt;constQP.qpInterB = rc-&gt;constQP.qpIntra = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;cqp;</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;        <span class="keywordflow">if</span> (avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a40a7fdf60f853d9140bbe1204a66efb2">b_quant_factor</a> != 0.0)</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;            rc-&gt;constQP.qpInterB = av_clip(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;cqp * <a class="code" href="cuda__runtime_8h.html#a7a87cd25426a228ce8ecbef48ab00de8">fabs</a>(avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a40a7fdf60f853d9140bbe1204a66efb2">b_quant_factor</a>) + avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a31a2ef78cf186083c2c676dda8e226db">b_quant_offset</a> + 0.5, 0, 51);</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;        <span class="keywordflow">if</span> (avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#aef7017818f06f053f2e63fe759b30eb1">i_quant_factor</a> != 0.0)</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;            rc-&gt;constQP.qpIntra = av_clip(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;cqp * <a class="code" href="cuda__runtime_8h.html#a7a87cd25426a228ce8ecbef48ab00de8">fabs</a>(avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#aef7017818f06f053f2e63fe759b30eb1">i_quant_factor</a>) + avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#afe9b149e17b9e28823ab3cf9732b990d">i_quant_offset</a> + 0.5, 0, 51);</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;    }</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160; </div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;    avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a3f63bc9141e25bf7f1cda0cef7cd4a60">qmin</a> = -1;</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;    avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#ab015db3b7fcd227193a7c17283914187">qmax</a> = -1;</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;}</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160; </div>
<div class="line"><a name="l00733"></a><span class="lineno"><a class="line" href="nvenc_8c.html#ad3564142e6a6c251c00c043c01420b48">  733</a></span>&#160;<span class="keyword">static</span> <a class="code" href="attributes_8h.html#abeeb324fff79a5335d36774704e2475c">av_cold</a> <span class="keywordtype">void</span> <a class="code" href="nvenc_8c.html#ad3564142e6a6c251c00c043c01420b48">set_vbr</a>(<a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a> *avctx)</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;{</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;    <a class="code" href="struct_nvenc_context.html">NvencContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a> = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#af3379123060ad8cc9c321c29af4f8360">priv_data</a>;</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;    NV_ENC_RC_PARAMS *rc = &amp;<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;encode_config.rcParams;</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;    <span class="keywordtype">int</span> qp_inter_p;</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160; </div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;    <span class="keywordflow">if</span> (avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a3f63bc9141e25bf7f1cda0cef7cd4a60">qmin</a> &gt;= 0 &amp;&amp; avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#ab015db3b7fcd227193a7c17283914187">qmax</a> &gt;= 0) {</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;        rc-&gt;enableMinQP = 1;</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;        rc-&gt;enableMaxQP = 1;</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160; </div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;        rc-&gt;minQP.qpInterB = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a3f63bc9141e25bf7f1cda0cef7cd4a60">qmin</a>;</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;        rc-&gt;minQP.qpInterP = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a3f63bc9141e25bf7f1cda0cef7cd4a60">qmin</a>;</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;        rc-&gt;minQP.qpIntra  = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a3f63bc9141e25bf7f1cda0cef7cd4a60">qmin</a>;</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160; </div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;        rc-&gt;maxQP.qpInterB = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#ab015db3b7fcd227193a7c17283914187">qmax</a>;</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;        rc-&gt;maxQP.qpInterP = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#ab015db3b7fcd227193a7c17283914187">qmax</a>;</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;        rc-&gt;maxQP.qpIntra = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#ab015db3b7fcd227193a7c17283914187">qmax</a>;</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160; </div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;        qp_inter_p = (avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#ab015db3b7fcd227193a7c17283914187">qmax</a> + 3 * avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a3f63bc9141e25bf7f1cda0cef7cd4a60">qmin</a>) / 4; <span class="comment">// biased towards Qmin</span></div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a3f63bc9141e25bf7f1cda0cef7cd4a60">qmin</a> &gt;= 0) {</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;        rc-&gt;enableMinQP = 1;</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160; </div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;        rc-&gt;minQP.qpInterB = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a3f63bc9141e25bf7f1cda0cef7cd4a60">qmin</a>;</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;        rc-&gt;minQP.qpInterP = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a3f63bc9141e25bf7f1cda0cef7cd4a60">qmin</a>;</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;        rc-&gt;minQP.qpIntra = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a3f63bc9141e25bf7f1cda0cef7cd4a60">qmin</a>;</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160; </div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;        qp_inter_p = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a3f63bc9141e25bf7f1cda0cef7cd4a60">qmin</a>;</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;        qp_inter_p = 26; <span class="comment">// default to 26</span></div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;    }</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160; </div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;    rc-&gt;enableInitialRCQP = 1;</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160; </div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;init_qp_p &lt; 0) {</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;        rc-&gt;initialRCQP.qpInterP  = qp_inter_p;</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;        rc-&gt;initialRCQP.qpInterP = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;init_qp_p;</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;    }</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160; </div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;init_qp_i &lt; 0) {</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;        <span class="keywordflow">if</span> (avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#aef7017818f06f053f2e63fe759b30eb1">i_quant_factor</a> != 0.0 &amp;&amp; avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a40a7fdf60f853d9140bbe1204a66efb2">b_quant_factor</a> != 0.0) {</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;            rc-&gt;initialRCQP.qpIntra = av_clip(</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;                rc-&gt;initialRCQP.qpInterP * <a class="code" href="cuda__runtime_8h.html#a7a87cd25426a228ce8ecbef48ab00de8">fabs</a>(avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#aef7017818f06f053f2e63fe759b30eb1">i_quant_factor</a>) + avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#afe9b149e17b9e28823ab3cf9732b990d">i_quant_offset</a> + 0.5, 0, 51);</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;            rc-&gt;initialRCQP.qpIntra = rc-&gt;initialRCQP.qpInterP;</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;        }</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;        rc-&gt;initialRCQP.qpIntra = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;init_qp_i;</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;    }</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160; </div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;init_qp_b &lt; 0) {</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;        <span class="keywordflow">if</span> (avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#aef7017818f06f053f2e63fe759b30eb1">i_quant_factor</a> != 0.0 &amp;&amp; avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a40a7fdf60f853d9140bbe1204a66efb2">b_quant_factor</a> != 0.0) {</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;            rc-&gt;initialRCQP.qpInterB = av_clip(</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;                rc-&gt;initialRCQP.qpInterP * <a class="code" href="cuda__runtime_8h.html#a7a87cd25426a228ce8ecbef48ab00de8">fabs</a>(avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a40a7fdf60f853d9140bbe1204a66efb2">b_quant_factor</a>) + avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a31a2ef78cf186083c2c676dda8e226db">b_quant_offset</a> + 0.5, 0, 51);</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;            rc-&gt;initialRCQP.qpInterB = rc-&gt;initialRCQP.qpInterP;</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;        }</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;        rc-&gt;initialRCQP.qpInterB = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;init_qp_b;</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;    }</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;}</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160; </div>
<div class="line"><a name="l00795"></a><span class="lineno"><a class="line" href="nvenc_8c.html#aaa00b7aeea59e09f19f2059bfc15bdb2">  795</a></span>&#160;<span class="keyword">static</span> <a class="code" href="attributes_8h.html#abeeb324fff79a5335d36774704e2475c">av_cold</a> <span class="keywordtype">void</span> <a class="code" href="nvenc_8c.html#aaa00b7aeea59e09f19f2059bfc15bdb2">set_lossless</a>(<a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a> *avctx)</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;{</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;    <a class="code" href="struct_nvenc_context.html">NvencContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a> = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#af3379123060ad8cc9c321c29af4f8360">priv_data</a>;</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;    NV_ENC_RC_PARAMS *rc = &amp;<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;encode_config.rcParams;</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160; </div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;    rc-&gt;rateControlMode = NV_ENC_PARAMS_RC_CONSTQP;</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;    rc-&gt;constQP.qpInterB = 0;</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;    rc-&gt;constQP.qpInterP = 0;</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;    rc-&gt;constQP.qpIntra  = 0;</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160; </div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;    avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a3f63bc9141e25bf7f1cda0cef7cd4a60">qmin</a> = -1;</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;    avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#ab015db3b7fcd227193a7c17283914187">qmax</a> = -1;</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;}</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160; </div>
<div class="line"><a name="l00809"></a><span class="lineno"><a class="line" href="nvenc_8c.html#a002b1b6f6b27c1de24105fd1d4223da1">  809</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="nvenc_8c.html#a002b1b6f6b27c1de24105fd1d4223da1">nvenc_override_rate_control</a>(<a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a> *avctx)</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;{</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;    <a class="code" href="struct_nvenc_context.html">NvencContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>    = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#af3379123060ad8cc9c321c29af4f8360">priv_data</a>;</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;    NV_ENC_RC_PARAMS *rc = &amp;<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;encode_config.rcParams;</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160; </div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;    <span class="keywordflow">switch</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;rc) {</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;    <span class="keywordflow">case</span> NV_ENC_PARAMS_RC_CONSTQP:</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;        <a class="code" href="nvenc_8c.html#a0dfcbbf27c383f6ddf48fcf8edea5081">set_constqp</a>(avctx);</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;    <span class="keywordflow">case</span> NV_ENC_PARAMS_RC_VBR_MINQP:</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;        <span class="keywordflow">if</span> (avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a3f63bc9141e25bf7f1cda0cef7cd4a60">qmin</a> &lt; 0) {</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga85b57516ca703cc47d9bbe5f4658c716">AV_LOG_WARNING</a>,</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;                   <span class="stringliteral">&quot;The variable bitrate rate-control requires &quot;</span></div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;                   <span class="stringliteral">&quot;the &#39;qmin&#39; option set.\n&quot;</span>);</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;            <a class="code" href="nvenc_8c.html#ad3564142e6a6c251c00c043c01420b48">set_vbr</a>(avctx);</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;        }</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;        <span class="comment">/* fall through */</span></div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;    <span class="keywordflow">case</span> NV_ENC_PARAMS_RC_VBR_HQ:</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;    <span class="keywordflow">case</span> NV_ENC_PARAMS_RC_VBR:</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;        <a class="code" href="nvenc_8c.html#ad3564142e6a6c251c00c043c01420b48">set_vbr</a>(avctx);</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;    <span class="keywordflow">case</span> NV_ENC_PARAMS_RC_CBR:</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;    <span class="keywordflow">case</span> NV_ENC_PARAMS_RC_CBR_HQ:</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;    <span class="keywordflow">case</span> NV_ENC_PARAMS_RC_CBR_LOWDELAY_HQ:</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;    }</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160; </div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;    rc-&gt;rateControlMode = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;rc;</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;}</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160; </div>
<div class="line"><a name="l00840"></a><span class="lineno"><a class="line" href="nvenc_8c.html#a408e6d9cd5e7265a9862520e562462ec">  840</a></span>&#160;<span class="keyword">static</span> <a class="code" href="attributes_8h.html#abeeb324fff79a5335d36774704e2475c">av_cold</a> <span class="keywordtype">int</span> <a class="code" href="nvenc_8c.html#a408e6d9cd5e7265a9862520e562462ec">nvenc_recalc_surfaces</a>(<a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a> *avctx)</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;{</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;    <a class="code" href="struct_nvenc_context.html">NvencContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a> = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#af3379123060ad8cc9c321c29af4f8360">priv_data</a>;</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;    <span class="comment">// default minimum of 4 surfaces</span></div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;    <span class="comment">// multiply by 2 for number of NVENCs on gpu (hardcode to 2)</span></div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;    <span class="comment">// another multiply by 2 to avoid blocking next PBB group</span></div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;    <span class="keywordtype">int</span> nb_surfaces = <a class="code" href="common_8h.html#a9960bd6780a9b16a216a57be1ee04359">FFMAX</a>(4, <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;encode_config.frameIntervalP * 2 * 2);</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160; </div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;    <span class="comment">// lookahead enabled</span></div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;rc_lookahead &gt; 0) {</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;        <span class="comment">// +1 is to account for lkd_bound calculation later</span></div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;        <span class="comment">// +4 is to allow sufficient pipelining with lookahead</span></div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;        nb_surfaces = <a class="code" href="common_8h.html#a9960bd6780a9b16a216a57be1ee04359">FFMAX</a>(1, <a class="code" href="common_8h.html#a9960bd6780a9b16a216a57be1ee04359">FFMAX</a>(nb_surfaces, <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;rc_lookahead + <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;encode_config.frameIntervalP + 1 + 4));</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;        <span class="keywordflow">if</span> (nb_surfaces &gt; <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nb_surfaces &amp;&amp; <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nb_surfaces &gt; 0)</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;        {</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga85b57516ca703cc47d9bbe5f4658c716">AV_LOG_WARNING</a>,</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;                   <span class="stringliteral">&quot;Defined rc_lookahead requires more surfaces, &quot;</span></div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;                   <span class="stringliteral">&quot;increasing used surfaces %d -&gt; %d\n&quot;</span>, <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nb_surfaces, nb_surfaces);</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;        }</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nb_surfaces = <a class="code" href="common_8h.html#a9960bd6780a9b16a216a57be1ee04359">FFMAX</a>(nb_surfaces, <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nb_surfaces);</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;encode_config.frameIntervalP &gt; 1 &amp;&amp; <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nb_surfaces &lt; nb_surfaces &amp;&amp; <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nb_surfaces &gt; 0)</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;        {</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga85b57516ca703cc47d9bbe5f4658c716">AV_LOG_WARNING</a>,</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;                   <span class="stringliteral">&quot;Defined b-frame requires more surfaces, &quot;</span></div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;                   <span class="stringliteral">&quot;increasing used surfaces %d -&gt; %d\n&quot;</span>, <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nb_surfaces, nb_surfaces);</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;            <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nb_surfaces = <a class="code" href="common_8h.html#a9960bd6780a9b16a216a57be1ee04359">FFMAX</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nb_surfaces, nb_surfaces);</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;        }</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nb_surfaces &lt;= 0)</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;            <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nb_surfaces = nb_surfaces;</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;        <span class="comment">// otherwise use user specified value</span></div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;    }</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160; </div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nb_surfaces = <a class="code" href="common_8h.html#a9960bd6780a9b16a216a57be1ee04359">FFMAX</a>(1, <a class="code" href="common_8h.html#a0f84cbd7fd810cd678157c98cbfad4b0">FFMIN</a>(<a class="code" href="nvenc_8h.html#ad1bcbc391302c678a37eb03dd5e49ea7">MAX_REGISTERED_FRAMES</a>, <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nb_surfaces));</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;async_depth = <a class="code" href="common_8h.html#a0f84cbd7fd810cd678157c98cbfad4b0">FFMIN</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;async_depth, <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nb_surfaces - 1);</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160; </div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;}</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160; </div>
<div class="line"><a name="l00879"></a><span class="lineno"><a class="line" href="nvenc_8c.html#ab8f2578d01b92d41e0a9722ba7b1f36a">  879</a></span>&#160;<span class="keyword">static</span> <a class="code" href="attributes_8h.html#abeeb324fff79a5335d36774704e2475c">av_cold</a> <span class="keywordtype">void</span> <a class="code" href="nvenc_8c.html#ab8f2578d01b92d41e0a9722ba7b1f36a">nvenc_setup_rate_control</a>(<a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a> *avctx)</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;{</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;    <a class="code" href="struct_nvenc_context.html">NvencContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a> = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#af3379123060ad8cc9c321c29af4f8360">priv_data</a>;</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160; </div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;    <span class="keywordflow">if</span> (avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a209f5ec60cb5f0b0a4962f4c5c5bb541">global_quality</a> &gt; 0)</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga85b57516ca703cc47d9bbe5f4658c716">AV_LOG_WARNING</a>, <span class="stringliteral">&quot;Using global_quality with nvenc is deprecated. Use qp instead.\n&quot;</span>);</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160; </div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;cqp &lt; 0 &amp;&amp; avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a209f5ec60cb5f0b0a4962f4c5c5bb541">global_quality</a> &gt; 0)</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;cqp = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a209f5ec60cb5f0b0a4962f4c5c5bb541">global_quality</a>;</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160; </div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;    <span class="keywordflow">if</span> (avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a6b53fda85ad61baa345edbd96cb8a33c">bit_rate</a> &gt; 0) {</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;encode_config.rcParams.averageBitRate = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a6b53fda85ad61baa345edbd96cb8a33c">bit_rate</a>;</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;encode_config.rcParams.averageBitRate &gt; 0) {</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;encode_config.rcParams.maxBitRate = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;encode_config.rcParams.averageBitRate;</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;    }</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160; </div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;    <span class="keywordflow">if</span> (avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#aa2b5582f1a360534310b686cc3f7c668">rc_max_rate</a> &gt; 0)</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;encode_config.rcParams.maxBitRate = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#aa2b5582f1a360534310b686cc3f7c668">rc_max_rate</a>;</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160; </div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;<span class="preprocessor">#ifdef NVENC_HAVE_MULTIPASS</span></div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;encode_config.rcParams.multiPass = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;multipass;</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160; </div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;<a class="code" href="struct_a_v_format_context.html#a32379cc371463b235d54235d4af06a15">flags</a> &amp; <a class="code" href="nvenc_8h.html#abc6126af1d45847bc59afa0aa3216b04afee116105aa3a30a9b28ca6281905925">NVENC_ONE_PASS</a>)</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;encode_config.rcParams.multiPass = NV_ENC_MULTI_PASS_DISABLED;</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;<a class="code" href="struct_a_v_format_context.html#a32379cc371463b235d54235d4af06a15">flags</a> &amp; <a class="code" href="nvenc_8h.html#abc6126af1d45847bc59afa0aa3216b04a8e24acb32cbb33c5ef00164edd4973fb">NVENC_TWO_PASSES</a> || <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;twopass &gt; 0)</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;encode_config.rcParams.multiPass = NV_ENC_TWO_PASS_FULL_RESOLUTION;</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160; </div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;rc &lt; 0) {</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;cbr) {</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;            <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;rc = NV_ENC_PARAMS_RC_CBR;</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;cqp &gt;= 0) {</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;            <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;rc = NV_ENC_PARAMS_RC_CONSTQP;</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;quality &gt;= 0.0f) {</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;            <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;rc = NV_ENC_PARAMS_RC_VBR;</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;        }</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;    }</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;rc &lt; 0) {</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;<a class="code" href="struct_a_v_format_context.html#a32379cc371463b235d54235d4af06a15">flags</a> &amp; <a class="code" href="nvenc_8h.html#abc6126af1d45847bc59afa0aa3216b04afee116105aa3a30a9b28ca6281905925">NVENC_ONE_PASS</a>)</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;            <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;twopass = 0;</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;<a class="code" href="struct_a_v_format_context.html#a32379cc371463b235d54235d4af06a15">flags</a> &amp; <a class="code" href="nvenc_8h.html#abc6126af1d45847bc59afa0aa3216b04a8e24acb32cbb33c5ef00164edd4973fb">NVENC_TWO_PASSES</a>)</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;            <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;twopass = 1;</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160; </div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;twopass &lt; 0)</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;            <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;twopass = (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;<a class="code" href="struct_a_v_format_context.html#a32379cc371463b235d54235d4af06a15">flags</a> &amp; <a class="code" href="nvenc_8h.html#abc6126af1d45847bc59afa0aa3216b04adaa15ff53eef4d8d6f1a9d1bb1f4f744">NVENC_LOWLATENCY</a>) != 0;</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160; </div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;cbr) {</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;twopass) {</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;                <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;rc = NV_ENC_PARAMS_RC_CBR_LOWDELAY_HQ;</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;                <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;rc = NV_ENC_PARAMS_RC_CBR;</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;            }</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;cqp &gt;= 0) {</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;            <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;rc = NV_ENC_PARAMS_RC_CONSTQP;</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;twopass) {</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;            <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;rc = NV_ENC_PARAMS_RC_VBR_HQ;</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a3f63bc9141e25bf7f1cda0cef7cd4a60">qmin</a> &gt;= 0 &amp;&amp; avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#ab015db3b7fcd227193a7c17283914187">qmax</a> &gt;= 0) {</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;            <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;rc = NV_ENC_PARAMS_RC_VBR_MINQP;</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;        }</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;    }</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160; </div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;rc &gt;= 0 &amp;&amp; <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;rc &amp; <a class="code" href="nvenc_8h.html#a682957a858a05251a419b7fc484a6a63">RC_MODE_DEPRECATED</a>) {</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga85b57516ca703cc47d9bbe5f4658c716">AV_LOG_WARNING</a>, <span class="stringliteral">&quot;Specified rc mode is deprecated.\n&quot;</span>);</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga85b57516ca703cc47d9bbe5f4658c716">AV_LOG_WARNING</a>, <span class="stringliteral">&quot;Use -rc constqp/cbr/vbr, -tune and -multipass instead.\n&quot;</span>);</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160; </div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;rc &amp;= ~<a class="code" href="nvenc_8h.html#a682957a858a05251a419b7fc484a6a63">RC_MODE_DEPRECATED</a>;</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;    }</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160; </div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;<span class="preprocessor">#ifdef NVENC_HAVE_LDKFS</span></div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;ldkfs)</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;         <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;encode_config.rcParams.lowDelayKeyFrameScale = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;ldkfs;</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160; </div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;<a class="code" href="struct_a_v_format_context.html#a32379cc371463b235d54235d4af06a15">flags</a> &amp; <a class="code" href="nvenc_8h.html#abc6126af1d45847bc59afa0aa3216b04aa22e8b8329b9d0224ca00643f84e27e0">NVENC_LOSSLESS</a>) {</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;        <a class="code" href="nvenc_8c.html#aaa00b7aeea59e09f19f2059bfc15bdb2">set_lossless</a>(avctx);</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;rc &gt;= 0) {</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;        <a class="code" href="nvenc_8c.html#a002b1b6f6b27c1de24105fd1d4223da1">nvenc_override_rate_control</a>(avctx);</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;encode_config.rcParams.rateControlMode = NV_ENC_PARAMS_RC_VBR;</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;        <a class="code" href="nvenc_8c.html#ad3564142e6a6c251c00c043c01420b48">set_vbr</a>(avctx);</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;    }</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160; </div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;    <span class="keywordflow">if</span> (avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a15000607a7e2371162348bb35b0184c1">rc_buffer_size</a> &gt; 0) {</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;encode_config.rcParams.vbvBufferSize = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a15000607a7e2371162348bb35b0184c1">rc_buffer_size</a>;</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;encode_config.rcParams.averageBitRate &gt; 0) {</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;        avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a15000607a7e2371162348bb35b0184c1">rc_buffer_size</a> = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;encode_config.rcParams.vbvBufferSize = 2 * <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;encode_config.rcParams.averageBitRate;</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;    }</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160; </div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;aq) {</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;encode_config.rcParams.enableAQ   = 1;</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;encode_config.rcParams.aqStrength = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;aq_strength;</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga9b58b28e2d429b930b69db19877f76a8">AV_LOG_VERBOSE</a>, <span class="stringliteral">&quot;AQ enabled.\n&quot;</span>);</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;    }</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160; </div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;temporal_aq) {</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;encode_config.rcParams.enableTemporalAQ = 1;</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga9b58b28e2d429b930b69db19877f76a8">AV_LOG_VERBOSE</a>, <span class="stringliteral">&quot;Temporal AQ enabled.\n&quot;</span>);</div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;    }</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160; </div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;rc_lookahead &gt; 0) {</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;        <span class="keywordtype">int</span> lkd_bound = <a class="code" href="common_8h.html#a0f84cbd7fd810cd678157c98cbfad4b0">FFMIN</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nb_surfaces, <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;async_depth) -</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;                        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;encode_config.frameIntervalP - 4;</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160; </div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;        <span class="keywordflow">if</span> (lkd_bound &lt; 0) {</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga85b57516ca703cc47d9bbe5f4658c716">AV_LOG_WARNING</a>,</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;                   <span class="stringliteral">&quot;Lookahead not enabled. Increase buffer delay (-delay).\n&quot;</span>);</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;            <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;encode_config.rcParams.enableLookahead = 1;</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;            <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;encode_config.rcParams.lookaheadDepth  = av_clip(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;rc_lookahead, 0, lkd_bound);</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;            <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;encode_config.rcParams.disableIadapt   = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;no_scenecut;</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;            <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;encode_config.rcParams.disableBadapt   = !<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;b_adapt;</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga9b58b28e2d429b930b69db19877f76a8">AV_LOG_VERBOSE</a>,</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;                   <span class="stringliteral">&quot;Lookahead enabled: depth %d, scenecut %s, B-adapt %s.\n&quot;</span>,</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;                   <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;encode_config.rcParams.lookaheadDepth,</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;                   <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;encode_config.rcParams.disableIadapt ? <span class="stringliteral">&quot;disabled&quot;</span> : <span class="stringliteral">&quot;enabled&quot;</span>,</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;                   <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;encode_config.rcParams.disableBadapt ? <span class="stringliteral">&quot;disabled&quot;</span> : <span class="stringliteral">&quot;enabled&quot;</span>);</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;        }</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;    }</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160; </div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;strict_gop) {</div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;encode_config.rcParams.strictGOPTarget = 1;</div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga9b58b28e2d429b930b69db19877f76a8">AV_LOG_VERBOSE</a>, <span class="stringliteral">&quot;Strict GOP target enabled.\n&quot;</span>);</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;    }</div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160; </div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nonref_p)</div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;encode_config.rcParams.enableNonRefP = 1;</div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160; </div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;zerolatency)</div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;encode_config.rcParams.zeroReorderDelay = 1;</div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160; </div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;quality) {</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;        <span class="comment">//convert from float to fixed point 8.8</span></div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;        <span class="keywordtype">int</span> tmp_quality = (<a class="code" href="ffmpeg__filter_8c.html#a61569f2965b7a369eb10b6d75d410d11">int</a>)(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;quality * 256.0f);</div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;encode_config.rcParams.targetQuality = (<a class="code" href="audio__convert_8c.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a>)(tmp_quality &gt;&gt; 8);</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;encode_config.rcParams.targetQualityLSB = (<a class="code" href="audio__convert_8c.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a>)(tmp_quality &amp; 0xff);</div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160; </div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga9b58b28e2d429b930b69db19877f76a8">AV_LOG_VERBOSE</a>, <span class="stringliteral">&quot;CQ(%d) mode enabled.\n&quot;</span>, tmp_quality);</div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160; </div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;        <span class="comment">//CQ mode shall discard avg bitrate &amp; honor max bitrate;</span></div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;encode_config.rcParams.averageBitRate = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a6b53fda85ad61baa345edbd96cb8a33c">bit_rate</a> = 0;</div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;encode_config.rcParams.maxBitRate = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#aa2b5582f1a360534310b686cc3f7c668">rc_max_rate</a>;</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;    }</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;}</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160; </div>
<div class="line"><a name="l01024"></a><span class="lineno"><a class="line" href="nvenc_8c.html#ae3125db28c17e482df85e0e25006131b"> 1024</a></span>&#160;<span class="keyword">static</span> <a class="code" href="attributes_8h.html#abeeb324fff79a5335d36774704e2475c">av_cold</a> <span class="keywordtype">int</span> <a class="code" href="nvenc_8c.html#ae3125db28c17e482df85e0e25006131b">nvenc_setup_h264_config</a>(<a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a> *avctx)</div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;{</div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;    <a class="code" href="struct_nvenc_context.html">NvencContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>                      = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#af3379123060ad8cc9c321c29af4f8360">priv_data</a>;</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;    NV_ENC_CONFIG *cc                      = &amp;<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;encode_config;</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;    NV_ENC_CONFIG_H264 *h264               = &amp;cc-&gt;encodeCodecConfig.h264Config;</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;    NV_ENC_CONFIG_H264_VUI_PARAMETERS *vui = &amp;h264-&gt;h264VUIParameters;</div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160; </div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;    vui-&gt;colourMatrix = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a8cd8caa7d40319324ce3d879a2edbd9f">colorspace</a>;</div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;    vui-&gt;colourPrimaries = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a3a41b3e5bde23b877799f6e72dac8ef3">color_primaries</a>;</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;    vui-&gt;transferCharacteristics = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#ab649e8c599f5a0e2a30448e67a36deb6">color_trc</a>;</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;    vui-&gt;videoFullRangeFlag = (avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a255bf7100a4ba6dcb6ee5d87740a4f35">color_range</a> == <a class="code" href="pixfmt_8h.html#a3da0bf691418bc22c4bcbe6583ad589aafce51dfb8b012df5cbbf59918c410f29">AVCOL_RANGE_JPEG</a></div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;        || <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;data_pix_fmt == <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5aef61d7a65003ef618420f618294107b0">AV_PIX_FMT_YUVJ420P</a> || <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;data_pix_fmt == <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5ab2e2ccfaeec66c0a5f58ffdbe2e850f9">AV_PIX_FMT_YUVJ422P</a> || <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;data_pix_fmt == <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5ae21031dcb2dd7bc75c83ec1ac2c26157">AV_PIX_FMT_YUVJ444P</a>);</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160; </div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;    vui-&gt;colourDescriptionPresentFlag =</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;        (avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a8cd8caa7d40319324ce3d879a2edbd9f">colorspace</a> != 2 || avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a3a41b3e5bde23b877799f6e72dac8ef3">color_primaries</a> != 2 || avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#ab649e8c599f5a0e2a30448e67a36deb6">color_trc</a> != 2);</div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160; </div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;    vui-&gt;videoSignalTypePresentFlag =</div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;        (vui-&gt;colourDescriptionPresentFlag</div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;        || vui-&gt;videoFormat != 5</div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;        || vui-&gt;videoFullRangeFlag != 0);</div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160; </div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;    h264-&gt;sliceMode = 3;</div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;    h264-&gt;sliceModeData = 1;</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160; </div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;    h264-&gt;disableSPSPPS = (avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#abb01e291550fa3fb96188af4d494587e">flags</a> &amp; <a class="code" href="group__lavc__core.html#ga9ed82634c59b339786575827c47a8f68">AV_CODEC_FLAG_GLOBAL_HEADER</a>) ? 1 : 0;</div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;    h264-&gt;repeatSPSPPS  = (avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#abb01e291550fa3fb96188af4d494587e">flags</a> &amp; <a class="code" href="group__lavc__core.html#ga9ed82634c59b339786575827c47a8f68">AV_CODEC_FLAG_GLOBAL_HEADER</a>) ? 0 : 1;</div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;    h264-&gt;outputAUD     = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;aud;</div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160; </div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;dpb_size &gt;= 0) {</div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;        <span class="comment">/* 0 means &quot;let the hardware decide&quot; */</span></div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;        h264-&gt;maxNumRefFrames = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;dpb_size;</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;    }</div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;    <span class="keywordflow">if</span> (avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a9b6b3f1fcbdcc2ad9f4dbb4370496e38">gop_size</a> &gt;= 0) {</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;        h264-&gt;idrPeriod = cc-&gt;gopLength;</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;    }</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160; </div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="nvenc_8c.html#ab0f7f7ce226b631569310a06829ab957">IS_CBR</a>(cc-&gt;rcParams.rateControlMode)) {</div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;        h264-&gt;outputBufferingPeriodSEI = 1;</div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;    }</div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160; </div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;    h264-&gt;outputPictureTimingSEI = 1;</div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160; </div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;    <span class="keywordflow">if</span> (cc-&gt;rcParams.rateControlMode == NV_ENC_PARAMS_RC_CBR_LOWDELAY_HQ ||</div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;        cc-&gt;rcParams.rateControlMode == NV_ENC_PARAMS_RC_CBR_HQ ||</div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;        cc-&gt;rcParams.rateControlMode == NV_ENC_PARAMS_RC_VBR_HQ) {</div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;        h264-&gt;adaptiveTransformMode = NV_ENC_H264_ADAPTIVE_TRANSFORM_ENABLE;</div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;        h264-&gt;fmoMode = NV_ENC_H264_FMO_DISABLE;</div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;    }</div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160; </div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;<a class="code" href="struct_a_v_format_context.html#a32379cc371463b235d54235d4af06a15">flags</a> &amp; <a class="code" href="nvenc_8h.html#abc6126af1d45847bc59afa0aa3216b04aa22e8b8329b9d0224ca00643f84e27e0">NVENC_LOSSLESS</a>) {</div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;        h264-&gt;qpPrimeYZeroTransformBypassFlag = 1;</div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;        <span class="keywordflow">switch</span>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;profile) {</div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="nvenc_8h.html#adf764cbdea00d65edcd07bb9953ad2b7aa85c8f0402b2263db2db09933892c8f9">NV_ENC_H264_PROFILE_BASELINE</a>:</div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;            cc-&gt;profileGUID = NV_ENC_H264_PROFILE_BASELINE_GUID;</div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;            avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a7abe7095de73df98df4895bf9e25fc6b">profile</a> = <a class="code" href="avcodec_8h.html#ae7b88419c24001277450732a5d3abe2b">FF_PROFILE_H264_BASELINE</a>;</div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="nvenc_8h.html#adf764cbdea00d65edcd07bb9953ad2b7a59e5ce4558dab204f05bb0fed4c9196b">NV_ENC_H264_PROFILE_MAIN</a>:</div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;            cc-&gt;profileGUID = NV_ENC_H264_PROFILE_MAIN_GUID;</div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;            avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a7abe7095de73df98df4895bf9e25fc6b">profile</a> = <a class="code" href="avcodec_8h.html#aa7d7e490128673e7747bb32ba7ea5486">FF_PROFILE_H264_MAIN</a>;</div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="nvenc_8h.html#adf764cbdea00d65edcd07bb9953ad2b7a7232f240b8d0b414cb49b12d30852c5e">NV_ENC_H264_PROFILE_HIGH</a>:</div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;            cc-&gt;profileGUID = NV_ENC_H264_PROFILE_HIGH_GUID;</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;            avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a7abe7095de73df98df4895bf9e25fc6b">profile</a> = <a class="code" href="avcodec_8h.html#a0ff6fe9cf1f7a1671d597b9524024332">FF_PROFILE_H264_HIGH</a>;</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="nvenc_8h.html#adf764cbdea00d65edcd07bb9953ad2b7a9b83cafeb7120787098cace6d9b96c94">NV_ENC_H264_PROFILE_HIGH_444P</a>:</div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;            cc-&gt;profileGUID = NV_ENC_H264_PROFILE_HIGH_444_GUID;</div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;            avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a7abe7095de73df98df4895bf9e25fc6b">profile</a> = <a class="code" href="avcodec_8h.html#adbd58c1bfa90fb3b5520d76ba9744251">FF_PROFILE_H264_HIGH_444_PREDICTIVE</a>;</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;        }</div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;    }</div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160; </div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;    <span class="comment">// force setting profile as high444p if input is AV_PIX_FMT_YUV444P</span></div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;data_pix_fmt == <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a82034006e681cddbb7b1d5cb7045626a">AV_PIX_FMT_YUV444P</a>) {</div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;        cc-&gt;profileGUID = NV_ENC_H264_PROFILE_HIGH_444_GUID;</div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;        avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a7abe7095de73df98df4895bf9e25fc6b">profile</a> = <a class="code" href="avcodec_8h.html#adbd58c1bfa90fb3b5520d76ba9744251">FF_PROFILE_H264_HIGH_444_PREDICTIVE</a>;</div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;    }</div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160; </div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;    h264-&gt;chromaFormatIDC = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a7abe7095de73df98df4895bf9e25fc6b">profile</a> == <a class="code" href="avcodec_8h.html#adbd58c1bfa90fb3b5520d76ba9744251">FF_PROFILE_H264_HIGH_444_PREDICTIVE</a> ? 3 : 1;</div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160; </div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;    h264-&gt;level = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;level;</div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160; </div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;coder &gt;= 0)</div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;        h264-&gt;entropyCodingMode = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;coder;</div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160; </div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;<span class="preprocessor">#ifdef NVENC_HAVE_BFRAME_REF_MODE</span></div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;    h264-&gt;useBFramesAsRef = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;b_ref_mode;</div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160; </div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;<span class="preprocessor">#ifdef NVENC_HAVE_MULTIPLE_REF_FRAMES</span></div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;    h264-&gt;numRefL0 = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#aa0cb7241b4624dba761c8cf58fb2d5f0">refs</a>;</div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;    h264-&gt;numRefL1 = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#aa0cb7241b4624dba761c8cf58fb2d5f0">refs</a>;</div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160; </div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;}</div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160; </div>
<div class="line"><a name="l01121"></a><span class="lineno"><a class="line" href="nvenc_8c.html#a0e43a99da4dfd50350396a6066da4978"> 1121</a></span>&#160;<span class="keyword">static</span> <a class="code" href="attributes_8h.html#abeeb324fff79a5335d36774704e2475c">av_cold</a> <span class="keywordtype">int</span> <a class="code" href="nvenc_8c.html#a0e43a99da4dfd50350396a6066da4978">nvenc_setup_hevc_config</a>(<a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a> *avctx)</div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;{</div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;    <a class="code" href="struct_nvenc_context.html">NvencContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>                      = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#af3379123060ad8cc9c321c29af4f8360">priv_data</a>;</div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;    NV_ENC_CONFIG *cc                      = &amp;<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;encode_config;</div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;    NV_ENC_CONFIG_HEVC *hevc               = &amp;cc-&gt;encodeCodecConfig.hevcConfig;</div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;    NV_ENC_CONFIG_HEVC_VUI_PARAMETERS *vui = &amp;hevc-&gt;hevcVUIParameters;</div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160; </div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;    vui-&gt;colourMatrix = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a8cd8caa7d40319324ce3d879a2edbd9f">colorspace</a>;</div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;    vui-&gt;colourPrimaries = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a3a41b3e5bde23b877799f6e72dac8ef3">color_primaries</a>;</div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;    vui-&gt;transferCharacteristics = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#ab649e8c599f5a0e2a30448e67a36deb6">color_trc</a>;</div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;    vui-&gt;videoFullRangeFlag = (avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a255bf7100a4ba6dcb6ee5d87740a4f35">color_range</a> == <a class="code" href="pixfmt_8h.html#a3da0bf691418bc22c4bcbe6583ad589aafce51dfb8b012df5cbbf59918c410f29">AVCOL_RANGE_JPEG</a></div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;        || <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;data_pix_fmt == <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5aef61d7a65003ef618420f618294107b0">AV_PIX_FMT_YUVJ420P</a> || <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;data_pix_fmt == <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5ab2e2ccfaeec66c0a5f58ffdbe2e850f9">AV_PIX_FMT_YUVJ422P</a> || <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;data_pix_fmt == <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5ae21031dcb2dd7bc75c83ec1ac2c26157">AV_PIX_FMT_YUVJ444P</a>);</div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160; </div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;    vui-&gt;colourDescriptionPresentFlag =</div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;        (avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a8cd8caa7d40319324ce3d879a2edbd9f">colorspace</a> != 2 || avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a3a41b3e5bde23b877799f6e72dac8ef3">color_primaries</a> != 2 || avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#ab649e8c599f5a0e2a30448e67a36deb6">color_trc</a> != 2);</div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160; </div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;    vui-&gt;videoSignalTypePresentFlag =</div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;        (vui-&gt;colourDescriptionPresentFlag</div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;        || vui-&gt;videoFormat != 5</div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;        || vui-&gt;videoFullRangeFlag != 0);</div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160; </div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;    hevc-&gt;sliceMode = 3;</div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;    hevc-&gt;sliceModeData = 1;</div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160; </div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;    hevc-&gt;disableSPSPPS = (avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#abb01e291550fa3fb96188af4d494587e">flags</a> &amp; <a class="code" href="group__lavc__core.html#ga9ed82634c59b339786575827c47a8f68">AV_CODEC_FLAG_GLOBAL_HEADER</a>) ? 1 : 0;</div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;    hevc-&gt;repeatSPSPPS  = (avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#abb01e291550fa3fb96188af4d494587e">flags</a> &amp; <a class="code" href="group__lavc__core.html#ga9ed82634c59b339786575827c47a8f68">AV_CODEC_FLAG_GLOBAL_HEADER</a>) ? 0 : 1;</div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;    hevc-&gt;outputAUD     = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;aud;</div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160; </div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;dpb_size &gt;= 0) {</div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;        <span class="comment">/* 0 means &quot;let the hardware decide&quot; */</span></div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;        hevc-&gt;maxNumRefFramesInDPB = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;dpb_size;</div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;    }</div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;    <span class="keywordflow">if</span> (avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a9b6b3f1fcbdcc2ad9f4dbb4370496e38">gop_size</a> &gt;= 0) {</div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;        hevc-&gt;idrPeriod = cc-&gt;gopLength;</div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;    }</div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160; </div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="nvenc_8c.html#ab0f7f7ce226b631569310a06829ab957">IS_CBR</a>(cc-&gt;rcParams.rateControlMode)) {</div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;        hevc-&gt;outputBufferingPeriodSEI = 1;</div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;    }</div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160; </div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;    hevc-&gt;outputPictureTimingSEI = 1;</div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160; </div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;    <span class="keywordflow">switch</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;profile) {</div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="nvenc_8h.html#a99fb83031ce9923c84392b4e92f956b5aa2bb72356e44a531d90cf3dc19c2da9c">NV_ENC_HEVC_PROFILE_MAIN</a>:</div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;        cc-&gt;profileGUID = NV_ENC_HEVC_PROFILE_MAIN_GUID;</div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;        avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a7abe7095de73df98df4895bf9e25fc6b">profile</a>  = <a class="code" href="avcodec_8h.html#af7a5858840ff5f2c70ae33a2cd1f4228">FF_PROFILE_HEVC_MAIN</a>;</div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="nvenc_8h.html#a99fb83031ce9923c84392b4e92f956b5af728942133f27bd1900866d3db771796">NV_ENC_HEVC_PROFILE_MAIN_10</a>:</div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;        cc-&gt;profileGUID = NV_ENC_HEVC_PROFILE_MAIN10_GUID;</div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;        avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a7abe7095de73df98df4895bf9e25fc6b">profile</a>  = <a class="code" href="avcodec_8h.html#aaf015040dda97fac08a56ddbd1dd1e31">FF_PROFILE_HEVC_MAIN_10</a>;</div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="nvenc_8h.html#a99fb83031ce9923c84392b4e92f956b5a5f324143f35bb1641f068a630a71d0b2">NV_ENC_HEVC_PROFILE_REXT</a>:</div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;        cc-&gt;profileGUID = NV_ENC_HEVC_PROFILE_FREXT_GUID;</div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;        avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a7abe7095de73df98df4895bf9e25fc6b">profile</a>  = <a class="code" href="avcodec_8h.html#aedc45d7b874ec5c3e4e9b6e9d948abc4">FF_PROFILE_HEVC_REXT</a>;</div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;    }</div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160; </div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;    <span class="comment">// force setting profile as main10 if input is 10 bit</span></div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="nvenc_8c.html#aa811025b0fbbeacacd640511c965212f">IS_10BIT</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;data_pix_fmt)) {</div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;        cc-&gt;profileGUID = NV_ENC_HEVC_PROFILE_MAIN10_GUID;</div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;        avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a7abe7095de73df98df4895bf9e25fc6b">profile</a> = <a class="code" href="avcodec_8h.html#aaf015040dda97fac08a56ddbd1dd1e31">FF_PROFILE_HEVC_MAIN_10</a>;</div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;    }</div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160; </div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;    <span class="comment">// force setting profile as rext if input is yuv444</span></div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="nvenc_8c.html#a4283d2a341ed469ecbb452243fd148a7">IS_YUV444</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;data_pix_fmt)) {</div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;        cc-&gt;profileGUID = NV_ENC_HEVC_PROFILE_FREXT_GUID;</div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;        avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a7abe7095de73df98df4895bf9e25fc6b">profile</a> = <a class="code" href="avcodec_8h.html#aedc45d7b874ec5c3e4e9b6e9d948abc4">FF_PROFILE_HEVC_REXT</a>;</div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;    }</div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160; </div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;    hevc-&gt;chromaFormatIDC = <a class="code" href="nvenc_8c.html#a4283d2a341ed469ecbb452243fd148a7">IS_YUV444</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;data_pix_fmt) ? 3 : 1;</div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160; </div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;    hevc-&gt;pixelBitDepthMinus8 = <a class="code" href="nvenc_8c.html#aa811025b0fbbeacacd640511c965212f">IS_10BIT</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;data_pix_fmt) ? 2 : 0;</div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160; </div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;    hevc-&gt;level = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;level;</div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160; </div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;    hevc-&gt;tier = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;tier;</div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160; </div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;<span class="preprocessor">#ifdef NVENC_HAVE_HEVC_BFRAME_REF_MODE</span></div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;    hevc-&gt;useBFramesAsRef = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;b_ref_mode;</div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160; </div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;<span class="preprocessor">#ifdef NVENC_HAVE_MULTIPLE_REF_FRAMES</span></div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;    hevc-&gt;numRefL0 = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#aa0cb7241b4624dba761c8cf58fb2d5f0">refs</a>;</div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;    hevc-&gt;numRefL1 = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#aa0cb7241b4624dba761c8cf58fb2d5f0">refs</a>;</div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160; </div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;}</div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160; </div>
<div class="line"><a name="l01210"></a><span class="lineno"><a class="line" href="nvenc_8c.html#a6b646db75e533cc26296c09679dcaa8f"> 1210</a></span>&#160;<span class="keyword">static</span> <a class="code" href="attributes_8h.html#abeeb324fff79a5335d36774704e2475c">av_cold</a> <span class="keywordtype">int</span> <a class="code" href="nvenc_8c.html#a6b646db75e533cc26296c09679dcaa8f">nvenc_setup_codec_config</a>(<a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a> *avctx)</div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;{</div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;    <span class="keywordflow">switch</span> (avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a6e606effa68724cae2ef5cc05f7fd9cb">codec</a>-&gt;<a class="code" href="struct_a_v_codec.html#a01a53d07936f4c7ee280444793b6967b">id</a>) {</div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="group__lavc__core.html#ggaadca229ad2c20e060a14fec08a5cc7cea3d4c051c8b18a3c18750676a308c10be">AV_CODEC_ID_H264</a>:</div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="nvenc_8c.html#ae3125db28c17e482df85e0e25006131b">nvenc_setup_h264_config</a>(avctx);</div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="group__lavc__core.html#ggaadca229ad2c20e060a14fec08a5cc7ceaa3e19a45b81bb602a4a37a4221274a20">AV_CODEC_ID_HEVC</a>:</div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="nvenc_8c.html#a0e43a99da4dfd50350396a6066da4978">nvenc_setup_hevc_config</a>(avctx);</div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;    <span class="comment">/* Earlier switch/case will return if unknown codec is passed. */</span></div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;    }</div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160; </div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;}</div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160; </div>
<div class="line"><a name="l01223"></a><span class="lineno"><a class="line" href="nvenc_8c.html#a86973c78da6778743a6380bcf423279a"> 1223</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="nvenc_8c.html#a86973c78da6778743a6380bcf423279a">compute_dar</a>(<a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a> *avctx, <span class="keywordtype">int</span> *dw, <span class="keywordtype">int</span> *dh) {</div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;    <span class="keywordtype">int</span> sw, sh;</div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160; </div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;    sw = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a0d8f46461754e8abea0847dcbc41b956">width</a>;</div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;    sh = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a0449afd803eb107bd4dbc8b5ea22e363">height</a>;</div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160; </div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;    <span class="keywordflow">if</span> (avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a5252d34fbce300228d4dbda19a8c3293">sample_aspect_ratio</a>.<a class="code" href="struct_a_v_rational.html#ae9a98c10a301c5e937095105b6f0fdb9">num</a> &gt; 0 &amp;&amp; avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a5252d34fbce300228d4dbda19a8c3293">sample_aspect_ratio</a>.<a class="code" href="struct_a_v_rational.html#aee46bdac67d965ac0a4204e753f910c3">den</a> &gt; 0) {</div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;        sw *= avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a5252d34fbce300228d4dbda19a8c3293">sample_aspect_ratio</a>.<a class="code" href="struct_a_v_rational.html#ae9a98c10a301c5e937095105b6f0fdb9">num</a>;</div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;        sh *= avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a5252d34fbce300228d4dbda19a8c3293">sample_aspect_ratio</a>.<a class="code" href="struct_a_v_rational.html#aee46bdac67d965ac0a4204e753f910c3">den</a>;</div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;    }</div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160; </div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;    <a class="code" href="group__lavu__math__rational.html#ga4fd9c0b8e663cf3d55e89fbc6ce71602">av_reduce</a>(dw, dh, sw, sh, 1024 * 1024);</div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;}</div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160; </div>
<div class="line"><a name="l01237"></a><span class="lineno"><a class="line" href="nvenc_8c.html#aede3a6e6b207b59d46698897b7cf4109"> 1237</a></span>&#160;<span class="keyword">static</span> <a class="code" href="attributes_8h.html#abeeb324fff79a5335d36774704e2475c">av_cold</a> <span class="keywordtype">int</span> <a class="code" href="nvenc_8c.html#aede3a6e6b207b59d46698897b7cf4109">nvenc_setup_encoder</a>(<a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a> *avctx)</div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;{</div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;    <a class="code" href="struct_nvenc_context.html">NvencContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a> = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#af3379123060ad8cc9c321c29af4f8360">priv_data</a>;</div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;    <a class="code" href="struct_nvenc_dyn_load_functions.html">NvencDynLoadFunctions</a> *dl_fn = &amp;<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nvenc_dload_funcs;</div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;    NV_ENCODE_API_FUNCTION_LIST *p_nvenc = &amp;dl_fn-&gt;<a class="code" href="struct_nvenc_dyn_load_functions.html#abb541819aaaf75f51f9c2c23f674de94">nvenc_funcs</a>;</div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160; </div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;    NV_ENC_PRESET_CONFIG preset_config = { 0 };</div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;    NVENCSTATUS nv_status = NV_ENC_SUCCESS;</div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;    <a class="code" href="struct_a_v_c_p_b_properties.html">AVCPBProperties</a> *cpb_props;</div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;    <span class="keywordtype">int</span> res = 0;</div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;    <span class="keywordtype">int</span> dw, dh;</div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160; </div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;encode_config.version = NV_ENC_CONFIG_VER;</div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;init_encode_params.version = NV_ENC_INITIALIZE_PARAMS_VER;</div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160; </div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;init_encode_params.encodeHeight = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a0449afd803eb107bd4dbc8b5ea22e363">height</a>;</div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;init_encode_params.encodeWidth = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a0d8f46461754e8abea0847dcbc41b956">width</a>;</div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160; </div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;init_encode_params.encodeConfig = &amp;<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;encode_config;</div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160; </div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;    <a class="code" href="nvenc_8c.html#aa4cf05195f3a39acc566306511dcad8d">nvenc_map_preset</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>);</div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160; </div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;<a class="code" href="struct_a_v_format_context.html#a32379cc371463b235d54235d4af06a15">flags</a> &amp; <a class="code" href="nvenc_8h.html#abc6126af1d45847bc59afa0aa3216b04a3ed51dcd5f88e0045737487a3f537a41">NVENC_DEPRECATED_PRESET</a>)</div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga85b57516ca703cc47d9bbe5f4658c716">AV_LOG_WARNING</a>, <span class="stringliteral">&quot;The selected preset is deprecated. Use p1 to p7 + -tune or fast/medium/slow.\n&quot;</span>);</div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160; </div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;    preset_config.version = NV_ENC_PRESET_CONFIG_VER;</div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;    preset_config.presetCfg.version = NV_ENC_CONFIG_VER;</div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160; </div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;<span class="preprocessor">#ifdef NVENC_HAVE_NEW_PRESETS</span></div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;init_encode_params.tuningInfo = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;tuning_info;</div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160; </div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;<a class="code" href="struct_a_v_format_context.html#a32379cc371463b235d54235d4af06a15">flags</a> &amp; <a class="code" href="nvenc_8h.html#abc6126af1d45847bc59afa0aa3216b04adaa15ff53eef4d8d6f1a9d1bb1f4f744">NVENC_LOWLATENCY</a>)</div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;init_encode_params.tuningInfo = NV_ENC_TUNING_INFO_LOW_LATENCY;</div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160; </div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;    nv_status = p_nvenc-&gt;nvEncGetEncodePresetConfigEx(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nvencoder,</div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;init_encode_params.encodeGUID,</div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;init_encode_params.presetGUID,</div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;init_encode_params.tuningInfo,</div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;        &amp;preset_config);</div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;    nv_status = p_nvenc-&gt;nvEncGetEncodePresetConfig(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nvencoder,</div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;init_encode_params.encodeGUID,</div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;init_encode_params.presetGUID,</div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;        &amp;preset_config);</div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;    <span class="keywordflow">if</span> (nv_status != NV_ENC_SUCCESS)</div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="nvenc_8c.html#a9859649f623b83a65a82803d3199e07a">nvenc_print_error</a>(avctx, nv_status, <span class="stringliteral">&quot;Cannot get the preset configuration&quot;</span>);</div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160; </div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;    memcpy(&amp;<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;encode_config, &amp;preset_config.presetCfg, <span class="keyword">sizeof</span>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;encode_config));</div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160; </div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;encode_config.version = NV_ENC_CONFIG_VER;</div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160; </div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;    <a class="code" href="nvenc_8c.html#a86973c78da6778743a6380bcf423279a">compute_dar</a>(avctx, &amp;dw, &amp;dh);</div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;init_encode_params.darHeight = dh;</div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;init_encode_params.darWidth = dw;</div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160; </div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;    <span class="keywordflow">if</span> (avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a4d08b297e97eefd66c714df4fff493c8">framerate</a>.<a class="code" href="struct_a_v_rational.html#ae9a98c10a301c5e937095105b6f0fdb9">num</a> &gt; 0 &amp;&amp; avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a4d08b297e97eefd66c714df4fff493c8">framerate</a>.<a class="code" href="struct_a_v_rational.html#aee46bdac67d965ac0a4204e753f910c3">den</a> &gt; 0) {</div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;init_encode_params.frameRateNum = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a4d08b297e97eefd66c714df4fff493c8">framerate</a>.<a class="code" href="struct_a_v_rational.html#ae9a98c10a301c5e937095105b6f0fdb9">num</a>;</div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;init_encode_params.frameRateDen = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a4d08b297e97eefd66c714df4fff493c8">framerate</a>.<a class="code" href="struct_a_v_rational.html#aee46bdac67d965ac0a4204e753f910c3">den</a>;</div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;init_encode_params.frameRateNum = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#ab7bfeb9fa5840aac090e2b0bd0ef7589">time_base</a>.<a class="code" href="struct_a_v_rational.html#aee46bdac67d965ac0a4204e753f910c3">den</a>;</div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;init_encode_params.frameRateDen = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#ab7bfeb9fa5840aac090e2b0bd0ef7589">time_base</a>.<a class="code" href="struct_a_v_rational.html#ae9a98c10a301c5e937095105b6f0fdb9">num</a> * avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a5c62b9c1528a272923ea2a4b86dea31a">ticks_per_frame</a>;</div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;    }</div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160; </div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;init_encode_params.enableEncodeAsync = 0;</div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;init_encode_params.enablePTD = 1;</div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160; </div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;<span class="preprocessor">#ifdef NVENC_HAVE_NEW_PRESETS</span></div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;    <span class="comment">/* If lookahead isn&#39;t set from CLI, use value from preset.</span></div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;<span class="comment">     * P6 &amp; P7 presets may enable lookahead for better quality.</span></div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;<span class="comment">     * */</span></div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;rc_lookahead == 0 &amp;&amp; <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;encode_config.rcParams.enableLookahead)</div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;rc_lookahead = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;encode_config.rcParams.lookaheadDepth;</div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160; </div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;init_encode_params.tuningInfo == NV_ENC_TUNING_INFO_LOSSLESS)</div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;<a class="code" href="struct_a_v_format_context.html#a32379cc371463b235d54235d4af06a15">flags</a> |= <a class="code" href="nvenc_8h.html#abc6126af1d45847bc59afa0aa3216b04aa22e8b8329b9d0224ca00643f84e27e0">NVENC_LOSSLESS</a>;</div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160; </div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;weighted_pred == 1)</div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;init_encode_params.enableWeightedPrediction = 1;</div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160; </div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;bluray_compat) {</div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;aud = 1;</div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;dpb_size = <a class="code" href="common_8h.html#a0f84cbd7fd810cd678157c98cbfad4b0">FFMIN</a>(<a class="code" href="common_8h.html#a9960bd6780a9b16a216a57be1ee04359">FFMAX</a>(avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#aa0cb7241b4624dba761c8cf58fb2d5f0">refs</a>, 0), 6);</div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;        avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a3e5334a611a3e2a6a653805bb9e2d4d4">max_b_frames</a> = <a class="code" href="common_8h.html#a0f84cbd7fd810cd678157c98cbfad4b0">FFMIN</a>(avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a3e5334a611a3e2a6a653805bb9e2d4d4">max_b_frames</a>, 3);</div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;        <span class="keywordflow">switch</span> (avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a6e606effa68724cae2ef5cc05f7fd9cb">codec</a>-&gt;<a class="code" href="struct_a_v_codec.html#a01a53d07936f4c7ee280444793b6967b">id</a>) {</div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="group__lavc__core.html#ggaadca229ad2c20e060a14fec08a5cc7cea3d4c051c8b18a3c18750676a308c10be">AV_CODEC_ID_H264</a>:</div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;            <span class="comment">/* maximum level depends on used resolution */</span></div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="group__lavc__core.html#ggaadca229ad2c20e060a14fec08a5cc7ceaa3e19a45b81bb602a4a37a4221274a20">AV_CODEC_ID_HEVC</a>:</div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;            <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;level = NV_ENC_LEVEL_HEVC_51;</div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;            <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;tier = NV_ENC_TIER_HEVC_HIGH;</div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;        }</div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;    }</div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160; </div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;    <span class="keywordflow">if</span> (avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a9b6b3f1fcbdcc2ad9f4dbb4370496e38">gop_size</a> &gt; 0) {</div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;        <span class="keywordflow">if</span> (avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a3e5334a611a3e2a6a653805bb9e2d4d4">max_b_frames</a> &gt;= 0) {</div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;            <span class="comment">/* 0 is intra-only, 1 is I/P only, 2 is one B-Frame, 3 two B-frames, and so on. */</span></div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;            <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;encode_config.frameIntervalP = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a3e5334a611a3e2a6a653805bb9e2d4d4">max_b_frames</a> + 1;</div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;        }</div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160; </div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;encode_config.gopLength = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a9b6b3f1fcbdcc2ad9f4dbb4370496e38">gop_size</a>;</div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a9b6b3f1fcbdcc2ad9f4dbb4370496e38">gop_size</a> == 0) {</div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;encode_config.frameIntervalP = 0;</div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;encode_config.gopLength = 1;</div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;    }</div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160; </div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;    <a class="code" href="nvenc_8c.html#a408e6d9cd5e7265a9862520e562462ec">nvenc_recalc_surfaces</a>(avctx);</div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160; </div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;    <a class="code" href="nvenc_8c.html#ab8f2578d01b92d41e0a9722ba7b1f36a">nvenc_setup_rate_control</a>(avctx);</div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160; </div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;    <span class="keywordflow">if</span> (avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#abb01e291550fa3fb96188af4d494587e">flags</a> &amp; <a class="code" href="group__lavc__core.html#ga502225f65e2092fbc45945247892cb0f">AV_CODEC_FLAG_INTERLACED_DCT</a>) {</div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;encode_config.frameFieldMode = NV_ENC_PARAMS_FRAME_FIELD_MODE_FIELD;</div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;encode_config.frameFieldMode = NV_ENC_PARAMS_FRAME_FIELD_MODE_FRAME;</div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;    }</div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160; </div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;    res = <a class="code" href="nvenc_8c.html#a6b646db75e533cc26296c09679dcaa8f">nvenc_setup_codec_config</a>(avctx);</div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;    <span class="keywordflow">if</span> (res)</div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;        <span class="keywordflow">return</span> res;</div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160; </div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;    res = <a class="code" href="nvenc_8c.html#a12819453065171c2aa768766ab201f4e">nvenc_push_context</a>(avctx);</div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;    <span class="keywordflow">if</span> (res &lt; 0)</div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;        <span class="keywordflow">return</span> res;</div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160; </div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;    nv_status = p_nvenc-&gt;nvEncInitializeEncoder(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nvencoder, &amp;<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;init_encode_params);</div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;    <span class="keywordflow">if</span> (nv_status != NV_ENC_SUCCESS) {</div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;        <a class="code" href="nvenc_8c.html#ad2d50f7855c51659e8df21a154b26577">nvenc_pop_context</a>(avctx);</div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="nvenc_8c.html#a9859649f623b83a65a82803d3199e07a">nvenc_print_error</a>(avctx, nv_status, <span class="stringliteral">&quot;InitializeEncoder failed&quot;</span>);</div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;    }</div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160; </div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;<span class="preprocessor">#ifdef NVENC_HAVE_CUSTREAM_PTR</span></div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;cu_context) {</div>
<div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;        nv_status = p_nvenc-&gt;nvEncSetIOCudaStreams(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nvencoder, &amp;<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;cu_stream, &amp;<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;cu_stream);</div>
<div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;        <span class="keywordflow">if</span> (nv_status != NV_ENC_SUCCESS) {</div>
<div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;            <a class="code" href="nvenc_8c.html#ad2d50f7855c51659e8df21a154b26577">nvenc_pop_context</a>(avctx);</div>
<div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="nvenc_8c.html#a9859649f623b83a65a82803d3199e07a">nvenc_print_error</a>(avctx, nv_status, <span class="stringliteral">&quot;SetIOCudaStreams failed&quot;</span>);</div>
<div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;        }</div>
<div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;    }</div>
<div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160; </div>
<div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;    res = <a class="code" href="nvenc_8c.html#ad2d50f7855c51659e8df21a154b26577">nvenc_pop_context</a>(avctx);</div>
<div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;    <span class="keywordflow">if</span> (res &lt; 0)</div>
<div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;        <span class="keywordflow">return</span> res;</div>
<div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160; </div>
<div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;encode_config.frameIntervalP &gt; 1)</div>
<div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;        avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a686a77363668795c15c87b532cc455fa">has_b_frames</a> = 2;</div>
<div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160; </div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;encode_config.rcParams.averageBitRate &gt; 0)</div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;        avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a6b53fda85ad61baa345edbd96cb8a33c">bit_rate</a> = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;encode_config.rcParams.averageBitRate;</div>
<div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160; </div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;    cpb_props = <a class="code" href="libavcodec_2internal_8h.html#a8e0ce66394bedcfbdc52cf8b7b7bedba">ff_add_cpb_side_data</a>(avctx);</div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;    <span class="keywordflow">if</span> (!cpb_props)</div>
<div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;    cpb_props-&gt;<a class="code" href="struct_a_v_c_p_b_properties.html#a920910dd19158348cb35fc576929bfd1">max_bitrate</a> = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;encode_config.rcParams.maxBitRate;</div>
<div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;    cpb_props-&gt;<a class="code" href="struct_a_v_c_p_b_properties.html#a128a4f2eda5bfa38c6b21195f310b116">avg_bitrate</a> = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a6b53fda85ad61baa345edbd96cb8a33c">bit_rate</a>;</div>
<div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;    cpb_props-&gt;<a class="code" href="struct_a_v_c_p_b_properties.html#a7a4517f685b5a1976080fe536860c86a">buffer_size</a> = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;encode_config.rcParams.vbvBufferSize;</div>
<div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160; </div>
<div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;}</div>
<div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160; </div>
<div class="line"><a name="l01399"></a><span class="lineno"><a class="line" href="nvenc_8c.html#a59c1f19ef585ad224635e83697b77a54"> 1399</a></span>&#160;<span class="keyword">static</span> NV_ENC_BUFFER_FORMAT <a class="code" href="nvenc_8c.html#a59c1f19ef585ad224635e83697b77a54">nvenc_map_buffer_format</a>(<span class="keyword">enum</span> <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5">AVPixelFormat</a> <a class="code" href="demuxing__decoding_8c.html#a7331e302ea7bb48e0b605a069576e135">pix_fmt</a>)</div>
<div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;{</div>
<div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;    <span class="keywordflow">switch</span> (<a class="code" href="demuxing__decoding_8c.html#a7331e302ea7bb48e0b605a069576e135">pix_fmt</a>) {</div>
<div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a1aa7677092740d8def31655b5d7f0cc2">AV_PIX_FMT_YUV420P</a>:</div>
<div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;        <span class="keywordflow">return</span> NV_ENC_BUFFER_FORMAT_YV12_PL;</div>
<div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a0b271df0acd125218c1e365a0f754022">AV_PIX_FMT_NV12</a>:</div>
<div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;        <span class="keywordflow">return</span> NV_ENC_BUFFER_FORMAT_NV12_PL;</div>
<div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="pixfmt_8h.html#a6265531cbe491ec34449e3769e545f1f">AV_PIX_FMT_P010</a>:</div>
<div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="pixfmt_8h.html#a6506505b35c1afd66c10cd537369cdd6">AV_PIX_FMT_P016</a>:</div>
<div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;        <span class="keywordflow">return</span> NV_ENC_BUFFER_FORMAT_YUV420_10BIT;</div>
<div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a82034006e681cddbb7b1d5cb7045626a">AV_PIX_FMT_YUV444P</a>:</div>
<div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;        <span class="keywordflow">return</span> NV_ENC_BUFFER_FORMAT_YUV444_PL;</div>
<div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="pixfmt_8h.html#ae7920607c5cf9a219cc94b5c7efc457d">AV_PIX_FMT_YUV444P16</a>:</div>
<div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;        <span class="keywordflow">return</span> NV_ENC_BUFFER_FORMAT_YUV444_10BIT;</div>
<div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="pixfmt_8h.html#a000d452c556c94e3865fea5d14a77c8f">AV_PIX_FMT_0RGB32</a>:</div>
<div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;        <span class="keywordflow">return</span> NV_ENC_BUFFER_FORMAT_ARGB;</div>
<div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="pixfmt_8h.html#af3d101ef5e0fdb975f01a831daede80a">AV_PIX_FMT_0BGR32</a>:</div>
<div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;        <span class="keywordflow">return</span> NV_ENC_BUFFER_FORMAT_ABGR;</div>
<div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;    <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;        <span class="keywordflow">return</span> NV_ENC_BUFFER_FORMAT_UNDEFINED;</div>
<div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;    }</div>
<div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;}</div>
<div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160; </div>
<div class="line"><a name="l01422"></a><span class="lineno"><a class="line" href="nvenc_8c.html#aace48cf2fe4a15ea60fece06bb02320d"> 1422</a></span>&#160;<span class="keyword">static</span> <a class="code" href="attributes_8h.html#abeeb324fff79a5335d36774704e2475c">av_cold</a> <span class="keywordtype">int</span> <a class="code" href="nvenc_8c.html#aace48cf2fe4a15ea60fece06bb02320d">nvenc_alloc_surface</a>(<a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a> *avctx, <span class="keywordtype">int</span> idx)</div>
<div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;{</div>
<div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;    <a class="code" href="struct_nvenc_context.html">NvencContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a> = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#af3379123060ad8cc9c321c29af4f8360">priv_data</a>;</div>
<div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;    <a class="code" href="struct_nvenc_dyn_load_functions.html">NvencDynLoadFunctions</a> *dl_fn = &amp;<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nvenc_dload_funcs;</div>
<div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;    NV_ENCODE_API_FUNCTION_LIST *p_nvenc = &amp;dl_fn-&gt;<a class="code" href="struct_nvenc_dyn_load_functions.html#abb541819aaaf75f51f9c2c23f674de94">nvenc_funcs</a>;</div>
<div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;    <a class="code" href="struct_nvenc_surface.html">NvencSurface</a>* tmp_surface = &amp;<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;surfaces[idx];</div>
<div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160; </div>
<div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;    NVENCSTATUS nv_status;</div>
<div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;    NV_ENC_CREATE_BITSTREAM_BUFFER allocOut = { 0 };</div>
<div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;    allocOut.version = NV_ENC_CREATE_BITSTREAM_BUFFER_VER;</div>
<div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160; </div>
<div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;    <span class="keywordflow">if</span> (avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a0425c77b3d06d71e5db88b1d7e1b37f2">pix_fmt</a> == <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a5ab95e18c0c9e5335f29121418eab314">AV_PIX_FMT_CUDA</a> || avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a0425c77b3d06d71e5db88b1d7e1b37f2">pix_fmt</a> == <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a8cfd0b36308fa1ad3522ef8815ccbd0a">AV_PIX_FMT_D3D11</a>) {</div>
<div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;surfaces[idx].in_ref = <a class="code" href="group__lavu__frame.html#gac700017c5270c79c1e1befdeeb008b2f">av_frame_alloc</a>();</div>
<div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;surfaces[idx].in_ref)</div>
<div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;        NV_ENC_CREATE_INPUT_BUFFER allocSurf = { 0 };</div>
<div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160; </div>
<div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;surfaces[idx].format = <a class="code" href="nvenc_8c.html#a59c1f19ef585ad224635e83697b77a54">nvenc_map_buffer_format</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;data_pix_fmt);</div>
<div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;surfaces[idx].format == NV_ENC_BUFFER_FORMAT_UNDEFINED) {</div>
<div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga96970a2980bf6ad28cd403e7dc52d6c5">AV_LOG_FATAL</a>, <span class="stringliteral">&quot;Invalid input pixel format: %s\n&quot;</span>,</div>
<div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;                   <a class="code" href="pixdesc_8c.html#ab92e2a8a9b58c982560c49df9f01e47e">av_get_pix_fmt_name</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;data_pix_fmt));</div>
<div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EINVAL);</div>
<div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;        }</div>
<div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160; </div>
<div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;        allocSurf.version = NV_ENC_CREATE_INPUT_BUFFER_VER;</div>
<div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;        allocSurf.width = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a0d8f46461754e8abea0847dcbc41b956">width</a>;</div>
<div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;        allocSurf.height = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a0449afd803eb107bd4dbc8b5ea22e363">height</a>;</div>
<div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;        allocSurf.bufferFmt = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;surfaces[idx].format;</div>
<div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160; </div>
<div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;        nv_status = p_nvenc-&gt;nvEncCreateInputBuffer(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nvencoder, &amp;allocSurf);</div>
<div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;        <span class="keywordflow">if</span> (nv_status != NV_ENC_SUCCESS) {</div>
<div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="nvenc_8c.html#a9859649f623b83a65a82803d3199e07a">nvenc_print_error</a>(avctx, nv_status, <span class="stringliteral">&quot;CreateInputBuffer failed&quot;</span>);</div>
<div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;        }</div>
<div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160; </div>
<div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;surfaces[idx].input_surface = allocSurf.inputBuffer;</div>
<div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;surfaces[idx].width = allocSurf.width;</div>
<div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;surfaces[idx].height = allocSurf.height;</div>
<div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;    }</div>
<div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160; </div>
<div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;    nv_status = p_nvenc-&gt;nvEncCreateBitstreamBuffer(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nvencoder, &amp;allocOut);</div>
<div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;    <span class="keywordflow">if</span> (nv_status != NV_ENC_SUCCESS) {</div>
<div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;        <span class="keywordtype">int</span> err = <a class="code" href="nvenc_8c.html#a9859649f623b83a65a82803d3199e07a">nvenc_print_error</a>(avctx, nv_status, <span class="stringliteral">&quot;CreateBitstreamBuffer failed&quot;</span>);</div>
<div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;        <span class="keywordflow">if</span> (avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a0425c77b3d06d71e5db88b1d7e1b37f2">pix_fmt</a> != <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a5ab95e18c0c9e5335f29121418eab314">AV_PIX_FMT_CUDA</a> &amp;&amp; avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a0425c77b3d06d71e5db88b1d7e1b37f2">pix_fmt</a> != <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a8cfd0b36308fa1ad3522ef8815ccbd0a">AV_PIX_FMT_D3D11</a>)</div>
<div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;            p_nvenc-&gt;nvEncDestroyInputBuffer(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nvencoder, <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;surfaces[idx].input_surface);</div>
<div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;        <a class="code" href="group__lavu__frame.html#ga979d73f3228814aee56aeca0636e37cc">av_frame_free</a>(&amp;<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;surfaces[idx].in_ref);</div>
<div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;        <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;    }</div>
<div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160; </div>
<div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;surfaces[idx].output_surface = allocOut.bitstreamBuffer;</div>
<div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160; </div>
<div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;    <a class="code" href="libavutil_2fifo_8c.html#ae95c15dcdd266b4005f8919e4f571180">av_fifo_generic_write</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;unused_surface_queue, &amp;tmp_surface, <span class="keyword">sizeof</span>(tmp_surface), <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160; </div>
<div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;}</div>
<div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160; </div>
<div class="line"><a name="l01478"></a><span class="lineno"><a class="line" href="nvenc_8c.html#aa0671022aab972ecf5afe5bda3b91605"> 1478</a></span>&#160;<span class="keyword">static</span> <a class="code" href="attributes_8h.html#abeeb324fff79a5335d36774704e2475c">av_cold</a> <span class="keywordtype">int</span> <a class="code" href="nvenc_8c.html#aa0671022aab972ecf5afe5bda3b91605">nvenc_setup_surfaces</a>(<a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a> *avctx)</div>
<div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;{</div>
<div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;    <a class="code" href="struct_nvenc_context.html">NvencContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a> = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#af3379123060ad8cc9c321c29af4f8360">priv_data</a>;</div>
<div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>, res = 0, res2;</div>
<div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160; </div>
<div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;surfaces = <a class="code" href="mem_8c.html#aedc3761897b7e9ea8ae1222b3d013c94">av_mallocz_array</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nb_surfaces, <span class="keyword">sizeof</span>(*<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;surfaces));</div>
<div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;surfaces)</div>
<div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160; </div>
<div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;timestamp_list = <a class="code" href="libavutil_2fifo_8c.html#adae9b18c5eed14fe851c5bb984ce374b">av_fifo_alloc</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nb_surfaces * <span class="keyword">sizeof</span>(int64_t));</div>
<div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;timestamp_list)</div>
<div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160; </div>
<div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;unused_surface_queue = <a class="code" href="libavutil_2fifo_8c.html#adae9b18c5eed14fe851c5bb984ce374b">av_fifo_alloc</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nb_surfaces * <span class="keyword">sizeof</span>(<a class="code" href="struct_nvenc_surface.html">NvencSurface</a>*));</div>
<div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;unused_surface_queue)</div>
<div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160; </div>
<div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;output_surface_queue = <a class="code" href="libavutil_2fifo_8c.html#adae9b18c5eed14fe851c5bb984ce374b">av_fifo_alloc</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nb_surfaces * <span class="keyword">sizeof</span>(<a class="code" href="struct_nvenc_surface.html">NvencSurface</a>*));</div>
<div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;output_surface_queue)</div>
<div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;output_surface_ready_queue = <a class="code" href="libavutil_2fifo_8c.html#adae9b18c5eed14fe851c5bb984ce374b">av_fifo_alloc</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nb_surfaces * <span class="keyword">sizeof</span>(<a class="code" href="struct_nvenc_surface.html">NvencSurface</a>*));</div>
<div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;output_surface_ready_queue)</div>
<div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160; </div>
<div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;    res = <a class="code" href="nvenc_8c.html#a12819453065171c2aa768766ab201f4e">nvenc_push_context</a>(avctx);</div>
<div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;    <span class="keywordflow">if</span> (res &lt; 0)</div>
<div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;        <span class="keywordflow">return</span> res;</div>
<div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160; </div>
<div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nb_surfaces; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;        <span class="keywordflow">if</span> ((res = <a class="code" href="nvenc_8c.html#aace48cf2fe4a15ea60fece06bb02320d">nvenc_alloc_surface</a>(avctx, <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)) &lt; 0)</div>
<div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;            <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;    }</div>
<div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160; </div>
<div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;<a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>:</div>
<div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;    res2 = <a class="code" href="nvenc_8c.html#ad2d50f7855c51659e8df21a154b26577">nvenc_pop_context</a>(avctx);</div>
<div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;    <span class="keywordflow">if</span> (res2 &lt; 0)</div>
<div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;        <span class="keywordflow">return</span> res2;</div>
<div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160; </div>
<div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;    <span class="keywordflow">return</span> res;</div>
<div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;}</div>
<div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160; </div>
<div class="line"><a name="l01519"></a><span class="lineno"><a class="line" href="nvenc_8c.html#a49cffae704078d7d011e5415bf758257"> 1519</a></span>&#160;<span class="keyword">static</span> <a class="code" href="attributes_8h.html#abeeb324fff79a5335d36774704e2475c">av_cold</a> <span class="keywordtype">int</span> <a class="code" href="nvenc_8c.html#a49cffae704078d7d011e5415bf758257">nvenc_setup_extradata</a>(<a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a> *avctx)</div>
<div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;{</div>
<div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;    <a class="code" href="struct_nvenc_context.html">NvencContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a> = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#af3379123060ad8cc9c321c29af4f8360">priv_data</a>;</div>
<div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;    <a class="code" href="struct_nvenc_dyn_load_functions.html">NvencDynLoadFunctions</a> *dl_fn = &amp;<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nvenc_dload_funcs;</div>
<div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;    NV_ENCODE_API_FUNCTION_LIST *p_nvenc = &amp;dl_fn-&gt;<a class="code" href="struct_nvenc_dyn_load_functions.html#abb541819aaaf75f51f9c2c23f674de94">nvenc_funcs</a>;</div>
<div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160; </div>
<div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;    NVENCSTATUS nv_status;</div>
<div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;    uint32_t outSize = 0;</div>
<div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;    <span class="keywordtype">char</span> tmpHeader[256];</div>
<div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;    NV_ENC_SEQUENCE_PARAM_PAYLOAD payload = { 0 };</div>
<div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;    payload.version = NV_ENC_SEQUENCE_PARAM_PAYLOAD_VER;</div>
<div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160; </div>
<div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;    payload.spsppsBuffer = tmpHeader;</div>
<div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;    payload.inBufferSize = <span class="keyword">sizeof</span>(tmpHeader);</div>
<div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;    payload.outSPSPPSPayloadSize = &amp;outSize;</div>
<div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160; </div>
<div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;    nv_status = p_nvenc-&gt;nvEncGetSequenceParams(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nvencoder, &amp;payload);</div>
<div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;    <span class="keywordflow">if</span> (nv_status != NV_ENC_SUCCESS) {</div>
<div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="nvenc_8c.html#a9859649f623b83a65a82803d3199e07a">nvenc_print_error</a>(avctx, nv_status, <span class="stringliteral">&quot;GetSequenceParams failed&quot;</span>);</div>
<div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;    }</div>
<div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160; </div>
<div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;    avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#ae246ca7a1c72c151891ed0599e8dbfba">extradata_size</a> = outSize;</div>
<div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;    avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#abe964316aaaa61967b012efdcced79c4">extradata</a> = <a class="code" href="group__lavu__mem__funcs.html#gaf143ecab33a3868b57345466c39de7c1">av_mallocz</a>(outSize + <a class="code" href="group__lavc__decoding.html#ga8f5b632a03ce83ac8e025894b1fc307a">AV_INPUT_BUFFER_PADDING_SIZE</a>);</div>
<div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160; </div>
<div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;    <span class="keywordflow">if</span> (!avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#abe964316aaaa61967b012efdcced79c4">extradata</a>) {</div>
<div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;    }</div>
<div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160; </div>
<div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;    memcpy(avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#abe964316aaaa61967b012efdcced79c4">extradata</a>, tmpHeader, outSize);</div>
<div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160; </div>
<div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;}</div>
<div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160; </div>
<div class="line"><a name="l01552"></a><span class="lineno"><a class="line" href="nvenc_8h.html#a25c02dcdd1d6f2663db363873cd1f6f3"> 1552</a></span>&#160;<a class="code" href="attributes_8h.html#abeeb324fff79a5335d36774704e2475c">av_cold</a> <span class="keywordtype">int</span> <a class="code" href="nvenc_8c.html#abbc0a5b2669e4998bebe51f8fe835b9a">ff_nvenc_encode_close</a>(<a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a> *avctx)</div>
<div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;{</div>
<div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;    <a class="code" href="struct_nvenc_context.html">NvencContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>               = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#af3379123060ad8cc9c321c29af4f8360">priv_data</a>;</div>
<div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;    <a class="code" href="struct_nvenc_dyn_load_functions.html">NvencDynLoadFunctions</a> *dl_fn = &amp;<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nvenc_dload_funcs;</div>
<div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;    NV_ENCODE_API_FUNCTION_LIST *p_nvenc = &amp;dl_fn-&gt;<a class="code" href="struct_nvenc_dyn_load_functions.html#abb541819aaaf75f51f9c2c23f674de94">nvenc_funcs</a>;</div>
<div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>, res;</div>
<div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160; </div>
<div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;    <span class="comment">/* the encoder has to be flushed before it can be closed */</span></div>
<div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nvencoder) {</div>
<div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;        NV_ENC_PIC_PARAMS params        = { .version        = NV_ENC_PIC_PARAMS_VER,</div>
<div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;                                            .encodePicFlags = NV_ENC_PIC_FLAG_EOS };</div>
<div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160; </div>
<div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;        res = <a class="code" href="nvenc_8c.html#a12819453065171c2aa768766ab201f4e">nvenc_push_context</a>(avctx);</div>
<div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;        <span class="keywordflow">if</span> (res &lt; 0)</div>
<div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;            <span class="keywordflow">return</span> res;</div>
<div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160; </div>
<div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;        p_nvenc-&gt;nvEncEncodePicture(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nvencoder, &amp;params);</div>
<div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;    }</div>
<div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160; </div>
<div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;    <a class="code" href="libavutil_2fifo_8c.html#a612be59edb6ab388a82d1487d1bd0c4d">av_fifo_freep</a>(&amp;<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;timestamp_list);</div>
<div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;    <a class="code" href="libavutil_2fifo_8c.html#a612be59edb6ab388a82d1487d1bd0c4d">av_fifo_freep</a>(&amp;<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;output_surface_ready_queue);</div>
<div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;    <a class="code" href="libavutil_2fifo_8c.html#a612be59edb6ab388a82d1487d1bd0c4d">av_fifo_freep</a>(&amp;<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;output_surface_queue);</div>
<div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;    <a class="code" href="libavutil_2fifo_8c.html#a612be59edb6ab388a82d1487d1bd0c4d">av_fifo_freep</a>(&amp;<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;unused_surface_queue);</div>
<div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160; </div>
<div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;surfaces &amp;&amp; (avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a0425c77b3d06d71e5db88b1d7e1b37f2">pix_fmt</a> == <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a5ab95e18c0c9e5335f29121418eab314">AV_PIX_FMT_CUDA</a> || avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a0425c77b3d06d71e5db88b1d7e1b37f2">pix_fmt</a> == <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a8cfd0b36308fa1ad3522ef8815ccbd0a">AV_PIX_FMT_D3D11</a>)) {</div>
<div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nb_registered_frames; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;registered_frames[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].mapped)</div>
<div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;                p_nvenc-&gt;nvEncUnmapInputResource(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nvencoder, <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;registered_frames[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].in_map.mappedResource);</div>
<div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;registered_frames[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].regptr)</div>
<div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;                p_nvenc-&gt;nvEncUnregisterResource(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nvencoder, <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;registered_frames[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].regptr);</div>
<div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;        }</div>
<div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nb_registered_frames = 0;</div>
<div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;    }</div>
<div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160; </div>
<div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;surfaces) {</div>
<div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nb_surfaces; ++<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div>
<div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;            <span class="keywordflow">if</span> (avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a0425c77b3d06d71e5db88b1d7e1b37f2">pix_fmt</a> != <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a5ab95e18c0c9e5335f29121418eab314">AV_PIX_FMT_CUDA</a> &amp;&amp; avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a0425c77b3d06d71e5db88b1d7e1b37f2">pix_fmt</a> != <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a8cfd0b36308fa1ad3522ef8815ccbd0a">AV_PIX_FMT_D3D11</a>)</div>
<div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;                p_nvenc-&gt;nvEncDestroyInputBuffer(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nvencoder, <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;surfaces[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].input_surface);</div>
<div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;            <a class="code" href="group__lavu__frame.html#ga979d73f3228814aee56aeca0636e37cc">av_frame_free</a>(&amp;<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;surfaces[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].in_ref);</div>
<div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;            p_nvenc-&gt;nvEncDestroyBitstreamBuffer(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nvencoder, <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;surfaces[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].output_surface);</div>
<div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;        }</div>
<div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;    }</div>
<div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#adba82e1bcd02de510a858fcbedf79ef1">av_freep</a>(&amp;<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;surfaces);</div>
<div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nb_surfaces = 0;</div>
<div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160; </div>
<div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;    <a class="code" href="group__lavu__frame.html#ga979d73f3228814aee56aeca0636e37cc">av_frame_free</a>(&amp;<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;frame);</div>
<div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160; </div>
<div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nvencoder) {</div>
<div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;        p_nvenc-&gt;nvEncDestroyEncoder(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nvencoder);</div>
<div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160; </div>
<div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;        res = <a class="code" href="nvenc_8c.html#ad2d50f7855c51659e8df21a154b26577">nvenc_pop_context</a>(avctx);</div>
<div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;        <span class="keywordflow">if</span> (res &lt; 0)</div>
<div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;            <span class="keywordflow">return</span> res;</div>
<div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;    }</div>
<div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nvencoder = <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160; </div>
<div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;cu_context_internal)</div>
<div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;        <a class="code" href="nvenc_8c.html#aabb147a1f2a98d37cb3ce0dd6d50b78d">CHECK_CU</a>(dl_fn-&gt;<a class="code" href="struct_nvenc_dyn_load_functions.html#a801dc578eedece0a47492f092fd2dfbf">cuda_dl</a>-&gt;cuCtxDestroy(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;cu_context_internal));</div>
<div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;cu_context = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;cu_context_internal = <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160; </div>
<div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;<span class="preprocessor">#if CONFIG_D3D11VA</span></div>
<div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;d3d11_device) {</div>
<div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;        ID3D11Device_Release(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;d3d11_device);</div>
<div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;d3d11_device = <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;    }</div>
<div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160; </div>
<div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;    nvenc_free_functions(&amp;dl_fn-&gt;<a class="code" href="struct_nvenc_dyn_load_functions.html#a3d276b8fd283c51b18982a6da56d9309">nvenc_dl</a>);</div>
<div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;    cuda_free_functions(&amp;dl_fn-&gt;<a class="code" href="struct_nvenc_dyn_load_functions.html#a801dc578eedece0a47492f092fd2dfbf">cuda_dl</a>);</div>
<div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160; </div>
<div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;    dl_fn-&gt;<a class="code" href="struct_nvenc_dyn_load_functions.html#a79079d6464c9f18004898ebaf72a07d8">nvenc_device_count</a> = 0;</div>
<div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160; </div>
<div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga9b58b28e2d429b930b69db19877f76a8">AV_LOG_VERBOSE</a>, <span class="stringliteral">&quot;Nvenc unloaded\n&quot;</span>);</div>
<div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160; </div>
<div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;}</div>
<div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160; </div>
<div class="line"><a name="l01629"></a><span class="lineno"><a class="line" href="nvenc_8h.html#a830d6c637d99ff40209f9887f9668c84"> 1629</a></span>&#160;<a class="code" href="attributes_8h.html#abeeb324fff79a5335d36774704e2475c">av_cold</a> <span class="keywordtype">int</span> <a class="code" href="nvenc_8c.html#a1561ceb78896b130d4926e8c83f417c1">ff_nvenc_encode_init</a>(<a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a> *avctx)</div>
<div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;{</div>
<div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;    <a class="code" href="struct_nvenc_context.html">NvencContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a> = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#af3379123060ad8cc9c321c29af4f8360">priv_data</a>;</div>
<div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>;</div>
<div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160; </div>
<div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;    <span class="keywordflow">if</span> (avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a0425c77b3d06d71e5db88b1d7e1b37f2">pix_fmt</a> == <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a5ab95e18c0c9e5335f29121418eab314">AV_PIX_FMT_CUDA</a> || avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a0425c77b3d06d71e5db88b1d7e1b37f2">pix_fmt</a> == <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a8cfd0b36308fa1ad3522ef8815ccbd0a">AV_PIX_FMT_D3D11</a>) {</div>
<div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;        <a class="code" href="struct_a_v_h_w_frames_context.html">AVHWFramesContext</a> *frames_ctx;</div>
<div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;        <span class="keywordflow">if</span> (!avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a3bac44bb0b016ab838780cc19ac277d6">hw_frames_ctx</a>) {</div>
<div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>,</div>
<div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;                   <span class="stringliteral">&quot;hw_frames_ctx must be set when using GPU frames as input\n&quot;</span>);</div>
<div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EINVAL);</div>
<div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;        }</div>
<div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;        frames_ctx = (<a class="code" href="struct_a_v_h_w_frames_context.html">AVHWFramesContext</a>*)avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a3bac44bb0b016ab838780cc19ac277d6">hw_frames_ctx</a>-&gt;<a class="code" href="struct_a_v_buffer_ref.html#acb8452e99cd75074b93800b532c6ea4b">data</a>;</div>
<div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;        <a class="code" href="filter__design_8txt.html#a0e82f1088fdc24c14bf175d2ac77523f">if</a> (frames_ctx-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#a045bc1713932804f6ceef170a5578e0e">format</a> != avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a0425c77b3d06d71e5db88b1d7e1b37f2">pix_fmt</a>) {</div>
<div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>,</div>
<div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;                   <span class="stringliteral">&quot;hw_frames_ctx must match the GPU frame type\n&quot;</span>);</div>
<div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EINVAL);</div>
<div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;        }</div>
<div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;data_pix_fmt = frames_ctx-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#a663a9aceca97aa7b2426c9aba6543e4a">sw_format</a>;</div>
<div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;data_pix_fmt = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a0425c77b3d06d71e5db88b1d7e1b37f2">pix_fmt</a>;</div>
<div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;    }</div>
<div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160; </div>
<div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;frame = <a class="code" href="group__lavu__frame.html#gac700017c5270c79c1e1befdeeb008b2f">av_frame_alloc</a>();</div>
<div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;frame)</div>
<div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160; </div>
<div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;    <span class="keywordflow">if</span> ((<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = <a class="code" href="nvenc_8c.html#a0c2527be99411c653118f3d8a7bdadbd">nvenc_load_libraries</a>(avctx)) &lt; 0)</div>
<div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>;</div>
<div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160; </div>
<div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;    <span class="keywordflow">if</span> ((<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = <a class="code" href="nvenc_8c.html#ae45695734db17add2efbad9b3295fc7c">nvenc_setup_device</a>(avctx)) &lt; 0)</div>
<div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>;</div>
<div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160; </div>
<div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;    <span class="keywordflow">if</span> ((<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = <a class="code" href="nvenc_8c.html#aede3a6e6b207b59d46698897b7cf4109">nvenc_setup_encoder</a>(avctx)) &lt; 0)</div>
<div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>;</div>
<div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160; </div>
<div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;    <span class="keywordflow">if</span> ((<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = <a class="code" href="nvenc_8c.html#aa0671022aab972ecf5afe5bda3b91605">nvenc_setup_surfaces</a>(avctx)) &lt; 0)</div>
<div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>;</div>
<div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160; </div>
<div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;    <span class="keywordflow">if</span> (avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#abb01e291550fa3fb96188af4d494587e">flags</a> &amp; <a class="code" href="group__lavc__core.html#ga9ed82634c59b339786575827c47a8f68">AV_CODEC_FLAG_GLOBAL_HEADER</a>) {</div>
<div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;        <span class="keywordflow">if</span> ((<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = <a class="code" href="nvenc_8c.html#a49cffae704078d7d011e5415bf758257">nvenc_setup_extradata</a>(avctx)) &lt; 0)</div>
<div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>;</div>
<div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;    }</div>
<div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160; </div>
<div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;}</div>
<div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160; </div>
<div class="line"><a name="l01676"></a><span class="lineno"><a class="line" href="nvenc_8c.html#aeae10f623a8eb7cd95caf0bebe58183a"> 1676</a></span>&#160;<span class="keyword">static</span> <a class="code" href="struct_nvenc_surface.html">NvencSurface</a> *<a class="code" href="nvenc_8c.html#aeae10f623a8eb7cd95caf0bebe58183a">get_free_frame</a>(<a class="code" href="struct_nvenc_context.html">NvencContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>)</div>
<div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;{</div>
<div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;    <a class="code" href="struct_nvenc_surface.html">NvencSurface</a> *tmp_surf;</div>
<div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160; </div>
<div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;    <span class="keywordflow">if</span> (!(<a class="code" href="libavutil_2fifo_8c.html#a81f4cea70d96846df7111daccc5ecce2">av_fifo_size</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;unused_surface_queue) &gt; 0))</div>
<div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;        <span class="comment">// queue empty</span></div>
<div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160; </div>
<div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;    <a class="code" href="libavutil_2fifo_8c.html#ab708d2f19b7a9592caa278256787adb6">av_fifo_generic_read</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;unused_surface_queue, &amp;tmp_surf, <span class="keyword">sizeof</span>(tmp_surf), <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;    <span class="keywordflow">return</span> tmp_surf;</div>
<div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;}</div>
<div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160; </div>
<div class="line"><a name="l01688"></a><span class="lineno"><a class="line" href="nvenc_8c.html#acfb5f27ea3ede9d61fb98fa4fbfe991f"> 1688</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="nvenc_8c.html#acfb5f27ea3ede9d61fb98fa4fbfe991f">nvenc_copy_frame</a>(<a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a> *avctx, <a class="code" href="struct_nvenc_surface.html">NvencSurface</a> *nv_surface,</div>
<div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;            NV_ENC_LOCK_INPUT_BUFFER *lock_buffer_params, <span class="keyword">const</span> <a class="code" href="struct_a_v_frame.html">AVFrame</a> *<a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>)</div>
<div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;{</div>
<div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;    <span class="keywordtype">int</span> dst_linesize[4] = {</div>
<div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;        lock_buffer_params-&gt;pitch,</div>
<div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;        lock_buffer_params-&gt;pitch,</div>
<div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;        lock_buffer_params-&gt;pitch,</div>
<div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;        lock_buffer_params-&gt;pitch</div>
<div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;    };</div>
<div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;    <a class="code" href="audio__convert_8c.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> *dst_data[4];</div>
<div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>;</div>
<div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160; </div>
<div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>-&gt;format == <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a1aa7677092740d8def31655b5d7f0cc2">AV_PIX_FMT_YUV420P</a>)</div>
<div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;        dst_linesize[1] = dst_linesize[2] &gt;&gt;= 1;</div>
<div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160; </div>
<div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;    <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = <a class="code" href="group__lavu__picture.html#ga4513d36f527c1476e89845631d975542">av_image_fill_pointers</a>(dst_data, <a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>-&gt;format, nv_surface-&gt;<a class="code" href="struct_nvenc_surface.html#a8b83a2e5f2996b0464695af7fa91936c">height</a>,</div>
<div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;                                 lock_buffer_params-&gt;bufferDataPtr, dst_linesize);</div>
<div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> &lt; 0)</div>
<div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>;</div>
<div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160; </div>
<div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>-&gt;format == <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a1aa7677092740d8def31655b5d7f0cc2">AV_PIX_FMT_YUV420P</a>)</div>
<div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;        <a class="code" href="common_8h.html#a09a0bb7d8fcfac416de7a5fe7fd8b0f1">FFSWAP</a>(<a class="code" href="audio__convert_8c.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a>*, dst_data[1], dst_data[2]);</div>
<div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160; </div>
<div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;    <a class="code" href="group__lavu__picture.html#ga6b5a267e202daadf81cbde6584055d1e">av_image_copy</a>(dst_data, dst_linesize,</div>
<div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;                  (<span class="keyword">const</span> <a class="code" href="audio__convert_8c.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a>**)<a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>-&gt;data, <a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>-&gt;linesize, <a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>-&gt;format,</div>
<div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;                  avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a0d8f46461754e8abea0847dcbc41b956">width</a>, avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a0449afd803eb107bd4dbc8b5ea22e363">height</a>);</div>
<div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160; </div>
<div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;}</div>
<div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160; </div>
<div class="line"><a name="l01718"></a><span class="lineno"><a class="line" href="nvenc_8c.html#a1a1bd2f7e2bd7245c34bb43884513c7c"> 1718</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="nvenc_8c.html#a1a1bd2f7e2bd7245c34bb43884513c7c">nvenc_find_free_reg_resource</a>(<a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a> *avctx)</div>
<div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;{</div>
<div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;    <a class="code" href="struct_nvenc_context.html">NvencContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a> = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#af3379123060ad8cc9c321c29af4f8360">priv_data</a>;</div>
<div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;    <a class="code" href="struct_nvenc_dyn_load_functions.html">NvencDynLoadFunctions</a> *dl_fn = &amp;<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nvenc_dload_funcs;</div>
<div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;    NV_ENCODE_API_FUNCTION_LIST *p_nvenc = &amp;dl_fn-&gt;<a class="code" href="struct_nvenc_dyn_load_functions.html#abb541819aaaf75f51f9c2c23f674de94">nvenc_funcs</a>;</div>
<div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;    NVENCSTATUS nv_status;</div>
<div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160; </div>
<div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>, first_round;</div>
<div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160; </div>
<div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nb_registered_frames == <a class="code" href="sinewin__tablegen__template_8c.html#a3508a98d3ee7e2c9a4841fe264cf70f7">FF_ARRAY_ELEMS</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;registered_frames)) {</div>
<div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;        <span class="keywordflow">for</span> (first_round = 1; first_round &gt;= 0; first_round--) {</div>
<div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;            <span class="keywordflow">for</span> (<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nb_registered_frames; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;                <span class="keywordflow">if</span> (!<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;registered_frames[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].mapped) {</div>
<div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;                    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;registered_frames[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].regptr) {</div>
<div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;                        <span class="keywordflow">if</span> (first_round)</div>
<div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;                            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;                        nv_status = p_nvenc-&gt;nvEncUnregisterResource(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nvencoder, <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;registered_frames[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].regptr);</div>
<div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;                        <span class="keywordflow">if</span> (nv_status != NV_ENC_SUCCESS)</div>
<div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;                            <span class="keywordflow">return</span> <a class="code" href="nvenc_8c.html#a9859649f623b83a65a82803d3199e07a">nvenc_print_error</a>(avctx, nv_status, <span class="stringliteral">&quot;Failed unregistering unused input resource&quot;</span>);</div>
<div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;                        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;registered_frames[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].ptr = <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;                        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;registered_frames[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].regptr = <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;                    }</div>
<div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;                    <span class="keywordflow">return</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div>
<div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;                }</div>
<div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;            }</div>
<div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;        }</div>
<div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nb_registered_frames++;</div>
<div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;    }</div>
<div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160; </div>
<div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Too many registered CUDA frames\n&quot;</span>);</div>
<div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;}</div>
<div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160; </div>
<div class="line"><a name="l01752"></a><span class="lineno"><a class="line" href="nvenc_8c.html#a3848440935c68dd375ff460e2b11d76c"> 1752</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="nvenc_8c.html#a3848440935c68dd375ff460e2b11d76c">nvenc_register_frame</a>(<a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a> *avctx, <span class="keyword">const</span> <a class="code" href="struct_a_v_frame.html">AVFrame</a> *<a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>)</div>
<div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;{</div>
<div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;    <a class="code" href="struct_nvenc_context.html">NvencContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a> = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#af3379123060ad8cc9c321c29af4f8360">priv_data</a>;</div>
<div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;    <a class="code" href="struct_nvenc_dyn_load_functions.html">NvencDynLoadFunctions</a> *dl_fn = &amp;<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nvenc_dload_funcs;</div>
<div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;    NV_ENCODE_API_FUNCTION_LIST *p_nvenc = &amp;dl_fn-&gt;<a class="code" href="struct_nvenc_dyn_load_functions.html#abb541819aaaf75f51f9c2c23f674de94">nvenc_funcs</a>;</div>
<div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160; </div>
<div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;    <a class="code" href="struct_a_v_h_w_frames_context.html">AVHWFramesContext</a> *frames_ctx = (<a class="code" href="struct_a_v_h_w_frames_context.html">AVHWFramesContext</a>*)<a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>-&gt;hw_frames_ctx-&gt;data;</div>
<div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;    NV_ENC_REGISTER_RESOURCE reg;</div>
<div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>, idx, <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>;</div>
<div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160; </div>
<div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;    <a class="code" href="h264pred__template_8c.html#a93cca9adbbca82ea00bf3250781f6dce">for</a> (<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nb_registered_frames; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;        <span class="keywordflow">if</span> (avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a0425c77b3d06d71e5db88b1d7e1b37f2">pix_fmt</a> == <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a5ab95e18c0c9e5335f29121418eab314">AV_PIX_FMT_CUDA</a> &amp;&amp; <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;registered_frames[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].ptr == <a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>-&gt;data[0])</div>
<div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div>
<div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a0425c77b3d06d71e5db88b1d7e1b37f2">pix_fmt</a> == <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a8cfd0b36308fa1ad3522ef8815ccbd0a">AV_PIX_FMT_D3D11</a> &amp;&amp; <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;registered_frames[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].ptr == <a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>-&gt;data[0] &amp;&amp; <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;registered_frames[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].ptr_index == (intptr_t)<a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>-&gt;data[1])</div>
<div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div>
<div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;    }</div>
<div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160; </div>
<div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;    idx = <a class="code" href="nvenc_8c.html#a1a1bd2f7e2bd7245c34bb43884513c7c">nvenc_find_free_reg_resource</a>(avctx);</div>
<div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;    <span class="keywordflow">if</span> (idx &lt; 0)</div>
<div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;        <span class="keywordflow">return</span> idx;</div>
<div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160; </div>
<div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;    reg.version            = NV_ENC_REGISTER_RESOURCE_VER;</div>
<div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;    reg.width              = frames_ctx-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#a9e6f29d0f744930cdd0e8bdff8771520">width</a>;</div>
<div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;    reg.height             = frames_ctx-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#ae61bbe1d8645a0c573085e29f1d0a58f">height</a>;</div>
<div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;    reg.pitch              = <a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>-&gt;linesize[0];</div>
<div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;    reg.resourceToRegister = <a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>-&gt;data[0];</div>
<div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160; </div>
<div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;    <span class="keywordflow">if</span> (avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a0425c77b3d06d71e5db88b1d7e1b37f2">pix_fmt</a> == <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a5ab95e18c0c9e5335f29121418eab314">AV_PIX_FMT_CUDA</a>) {</div>
<div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;        reg.resourceType   = NV_ENC_INPUT_RESOURCE_TYPE_CUDADEVICEPTR;</div>
<div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;    }</div>
<div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a0425c77b3d06d71e5db88b1d7e1b37f2">pix_fmt</a> == <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a8cfd0b36308fa1ad3522ef8815ccbd0a">AV_PIX_FMT_D3D11</a>) {</div>
<div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;        reg.resourceType     = NV_ENC_INPUT_RESOURCE_TYPE_DIRECTX;</div>
<div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;        reg.subResourceIndex = (intptr_t)<a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>-&gt;data[1];</div>
<div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;    }</div>
<div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160; </div>
<div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;    reg.bufferFormat       = <a class="code" href="nvenc_8c.html#a59c1f19ef585ad224635e83697b77a54">nvenc_map_buffer_format</a>(frames_ctx-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#a663a9aceca97aa7b2426c9aba6543e4a">sw_format</a>);</div>
<div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;    <span class="keywordflow">if</span> (reg.bufferFormat == NV_ENC_BUFFER_FORMAT_UNDEFINED) {</div>
<div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga96970a2980bf6ad28cd403e7dc52d6c5">AV_LOG_FATAL</a>, <span class="stringliteral">&quot;Invalid input pixel format: %s\n&quot;</span>,</div>
<div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;               <a class="code" href="pixdesc_8c.html#ab92e2a8a9b58c982560c49df9f01e47e">av_get_pix_fmt_name</a>(frames_ctx-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#a663a9aceca97aa7b2426c9aba6543e4a">sw_format</a>));</div>
<div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EINVAL);</div>
<div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;    }</div>
<div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160; </div>
<div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;    <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = p_nvenc-&gt;nvEncRegisterResource(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nvencoder, &amp;reg);</div>
<div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> != NV_ENC_SUCCESS) {</div>
<div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;        <a class="code" href="nvenc_8c.html#a9859649f623b83a65a82803d3199e07a">nvenc_print_error</a>(avctx, <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>, <span class="stringliteral">&quot;Error registering an input resource&quot;</span>);</div>
<div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="group__lavu__error.html#ga4ebaa288c7684a26a591c501208910e4">AVERROR_UNKNOWN</a>;</div>
<div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;    }</div>
<div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160; </div>
<div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;registered_frames[idx].ptr       = <a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>-&gt;data[0];</div>
<div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;registered_frames[idx].ptr_index = reg.subResourceIndex;</div>
<div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;registered_frames[idx].regptr    = reg.registeredResource;</div>
<div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;    <span class="keywordflow">return</span> idx;</div>
<div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;}</div>
<div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160; </div>
<div class="line"><a name="l01806"></a><span class="lineno"><a class="line" href="nvenc_8c.html#ab39cb2b1a84a821962598d9c43b918a4"> 1806</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="nvenc_8c.html#ab39cb2b1a84a821962598d9c43b918a4">nvenc_upload_frame</a>(<a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a> *avctx, <span class="keyword">const</span> <a class="code" href="struct_a_v_frame.html">AVFrame</a> *<a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>,</div>
<div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;                                      <a class="code" href="struct_nvenc_surface.html">NvencSurface</a> *nvenc_frame)</div>
<div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;{</div>
<div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;    <a class="code" href="struct_nvenc_context.html">NvencContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a> = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#af3379123060ad8cc9c321c29af4f8360">priv_data</a>;</div>
<div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;    <a class="code" href="struct_nvenc_dyn_load_functions.html">NvencDynLoadFunctions</a> *dl_fn = &amp;<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nvenc_dload_funcs;</div>
<div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;    NV_ENCODE_API_FUNCTION_LIST *p_nvenc = &amp;dl_fn-&gt;<a class="code" href="struct_nvenc_dyn_load_functions.html#abb541819aaaf75f51f9c2c23f674de94">nvenc_funcs</a>;</div>
<div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160; </div>
<div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;    <span class="keywordtype">int</span> res;</div>
<div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;    NVENCSTATUS nv_status;</div>
<div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160; </div>
<div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;    <span class="keywordflow">if</span> (avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a0425c77b3d06d71e5db88b1d7e1b37f2">pix_fmt</a> == <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a5ab95e18c0c9e5335f29121418eab314">AV_PIX_FMT_CUDA</a> || avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a0425c77b3d06d71e5db88b1d7e1b37f2">pix_fmt</a> == <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a8cfd0b36308fa1ad3522ef8815ccbd0a">AV_PIX_FMT_D3D11</a>) {</div>
<div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;        <span class="keywordtype">int</span> reg_idx = <a class="code" href="nvenc_8c.html#a3848440935c68dd375ff460e2b11d76c">nvenc_register_frame</a>(avctx, <a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>);</div>
<div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;        <span class="keywordflow">if</span> (reg_idx &lt; 0) {</div>
<div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Could not register an input HW frame\n&quot;</span>);</div>
<div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;            <span class="keywordflow">return</span> reg_idx;</div>
<div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;        }</div>
<div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160; </div>
<div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;        res = <a class="code" href="group__lavu__frame.html#ga88b0ecbc4eb3453eef3fbefa3bddeb7c">av_frame_ref</a>(nvenc_frame-&gt;<a class="code" href="struct_nvenc_surface.html#a58a869a12b6a5a69d6683cd3c1e09f37">in_ref</a>, <a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>);</div>
<div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;        <span class="keywordflow">if</span> (res &lt; 0)</div>
<div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;            <span class="keywordflow">return</span> res;</div>
<div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160; </div>
<div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;registered_frames[reg_idx].mapped) {</div>
<div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;            <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;registered_frames[reg_idx].in_map.version = NV_ENC_MAP_INPUT_RESOURCE_VER;</div>
<div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;            <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;registered_frames[reg_idx].in_map.registeredResource = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;registered_frames[reg_idx].regptr;</div>
<div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;            nv_status = p_nvenc-&gt;nvEncMapInputResource(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nvencoder, &amp;<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;registered_frames[reg_idx].in_map);</div>
<div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;            <span class="keywordflow">if</span> (nv_status != NV_ENC_SUCCESS) {</div>
<div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;                <a class="code" href="group__lavu__frame.html#ga0a2b687f9c1c5ed0089b01fd61227108">av_frame_unref</a>(nvenc_frame-&gt;<a class="code" href="struct_nvenc_surface.html#a58a869a12b6a5a69d6683cd3c1e09f37">in_ref</a>);</div>
<div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="nvenc_8c.html#a9859649f623b83a65a82803d3199e07a">nvenc_print_error</a>(avctx, nv_status, <span class="stringliteral">&quot;Error mapping an input resource&quot;</span>);</div>
<div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;            }</div>
<div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;        }</div>
<div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160; </div>
<div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;registered_frames[reg_idx].mapped += 1;</div>
<div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160; </div>
<div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;        nvenc_frame-&gt;<a class="code" href="struct_nvenc_surface.html#a7524fe6d22859c6c8537ffd89c6c9fe3">reg_idx</a>                   = reg_idx;</div>
<div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;        nvenc_frame-&gt;<a class="code" href="struct_nvenc_surface.html#ab57ef0f81d5dbb72e599b78f70401a98">input_surface</a>             = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;registered_frames[reg_idx].in_map.mappedResource;</div>
<div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;        nvenc_frame-&gt;<a class="code" href="struct_nvenc_surface.html#a5d57300593a94bf92a7858a00fe57d26">format</a>                    = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;registered_frames[reg_idx].in_map.mappedBufferFmt;</div>
<div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;        nvenc_frame-&gt;<a class="code" href="struct_nvenc_surface.html#abbd7146e6d65efe460193b8e0718b3d1">pitch</a>                     = <a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>-&gt;linesize[0];</div>
<div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160; </div>
<div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;        NV_ENC_LOCK_INPUT_BUFFER lockBufferParams = { 0 };</div>
<div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160; </div>
<div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;        lockBufferParams.version = NV_ENC_LOCK_INPUT_BUFFER_VER;</div>
<div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;        lockBufferParams.inputBuffer = nvenc_frame-&gt;<a class="code" href="struct_nvenc_surface.html#ab57ef0f81d5dbb72e599b78f70401a98">input_surface</a>;</div>
<div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160; </div>
<div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;        nv_status = p_nvenc-&gt;nvEncLockInputBuffer(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nvencoder, &amp;lockBufferParams);</div>
<div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;        <span class="keywordflow">if</span> (nv_status != NV_ENC_SUCCESS) {</div>
<div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="nvenc_8c.html#a9859649f623b83a65a82803d3199e07a">nvenc_print_error</a>(avctx, nv_status, <span class="stringliteral">&quot;Failed locking nvenc input buffer&quot;</span>);</div>
<div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;        }</div>
<div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160; </div>
<div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;        nvenc_frame-&gt;<a class="code" href="struct_nvenc_surface.html#abbd7146e6d65efe460193b8e0718b3d1">pitch</a> = lockBufferParams.pitch;</div>
<div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;        res = <a class="code" href="nvenc_8c.html#acfb5f27ea3ede9d61fb98fa4fbfe991f">nvenc_copy_frame</a>(avctx, nvenc_frame, &amp;lockBufferParams, <a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>);</div>
<div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160; </div>
<div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;        nv_status = p_nvenc-&gt;nvEncUnlockInputBuffer(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nvencoder, nvenc_frame-&gt;<a class="code" href="struct_nvenc_surface.html#ab57ef0f81d5dbb72e599b78f70401a98">input_surface</a>);</div>
<div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;        <span class="keywordflow">if</span> (nv_status != NV_ENC_SUCCESS) {</div>
<div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="nvenc_8c.html#a9859649f623b83a65a82803d3199e07a">nvenc_print_error</a>(avctx, nv_status, <span class="stringliteral">&quot;Failed unlocking input buffer!&quot;</span>);</div>
<div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;        }</div>
<div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160; </div>
<div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;        <span class="keywordflow">return</span> res;</div>
<div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;    }</div>
<div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;}</div>
<div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160; </div>
<div class="line"><a name="l01868"></a><span class="lineno"><a class="line" href="nvenc_8c.html#a4bf3899a8bed4f6012f9f9d6ad3111cc"> 1868</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="nvenc_8c.html#a4bf3899a8bed4f6012f9f9d6ad3111cc">nvenc_codec_specific_pic_params</a>(<a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a> *avctx,</div>
<div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;                                            NV_ENC_PIC_PARAMS *params,</div>
<div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;                                            NV_ENC_SEI_PAYLOAD *sei_data,</div>
<div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;                                            <span class="keywordtype">int</span> sei_count)</div>
<div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;{</div>
<div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;    <a class="code" href="struct_nvenc_context.html">NvencContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a> = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#af3379123060ad8cc9c321c29af4f8360">priv_data</a>;</div>
<div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160; </div>
<div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;    <span class="keywordflow">switch</span> (avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a6e606effa68724cae2ef5cc05f7fd9cb">codec</a>-&gt;<a class="code" href="struct_a_v_codec.html#a01a53d07936f4c7ee280444793b6967b">id</a>) {</div>
<div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="group__lavc__core.html#ggaadca229ad2c20e060a14fec08a5cc7cea3d4c051c8b18a3c18750676a308c10be">AV_CODEC_ID_H264</a>:</div>
<div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;        params-&gt;codecPicParams.h264PicParams.sliceMode =</div>
<div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;            <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;encode_config.encodeCodecConfig.h264Config.sliceMode;</div>
<div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;        params-&gt;codecPicParams.h264PicParams.sliceModeData =</div>
<div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;            <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;encode_config.encodeCodecConfig.h264Config.sliceModeData;</div>
<div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;        <span class="keywordflow">if</span> (sei_count &gt; 0) {</div>
<div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;            params-&gt;codecPicParams.h264PicParams.seiPayloadArray = sei_data;</div>
<div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;            params-&gt;codecPicParams.h264PicParams.seiPayloadArrayCnt = sei_count;</div>
<div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;        }</div>
<div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160; </div>
<div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="group__lavc__core.html#ggaadca229ad2c20e060a14fec08a5cc7ceaa3e19a45b81bb602a4a37a4221274a20">AV_CODEC_ID_HEVC</a>:</div>
<div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;        params-&gt;codecPicParams.hevcPicParams.sliceMode =</div>
<div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;            <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;encode_config.encodeCodecConfig.hevcConfig.sliceMode;</div>
<div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;        params-&gt;codecPicParams.hevcPicParams.sliceModeData =</div>
<div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;            <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;encode_config.encodeCodecConfig.hevcConfig.sliceModeData;</div>
<div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;        <span class="keywordflow">if</span> (sei_count &gt; 0) {</div>
<div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;            params-&gt;codecPicParams.hevcPicParams.seiPayloadArray = sei_data;</div>
<div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;            params-&gt;codecPicParams.hevcPicParams.seiPayloadArrayCnt = sei_count;</div>
<div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;        }</div>
<div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160; </div>
<div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;    }</div>
<div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;}</div>
<div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160; </div>
<div class="line"><a name="l01901"></a><span class="lineno"><a class="line" href="nvenc_8c.html#a4ff7bc81361be5089bb0483bad599c4f"> 1901</a></span>&#160;<span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="nvenc_8c.html#a4ff7bc81361be5089bb0483bad599c4f">timestamp_queue_enqueue</a>(<a class="code" href="struct_a_v_fifo_buffer.html">AVFifoBuffer</a>* queue, int64_t timestamp)</div>
<div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;{</div>
<div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;    <a class="code" href="libavutil_2fifo_8c.html#ae95c15dcdd266b4005f8919e4f571180">av_fifo_generic_write</a>(queue, &amp;timestamp, <span class="keyword">sizeof</span>(timestamp), <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;}</div>
<div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160; </div>
<div class="line"><a name="l01906"></a><span class="lineno"><a class="line" href="nvenc_8c.html#aa1c1fa16f8e3d7dbf31de73ad6927c46"> 1906</a></span>&#160;<span class="keyword">static</span> <span class="keyword">inline</span> int64_t <a class="code" href="nvenc_8c.html#aa1c1fa16f8e3d7dbf31de73ad6927c46">timestamp_queue_dequeue</a>(<a class="code" href="struct_a_v_fifo_buffer.html">AVFifoBuffer</a>* queue)</div>
<div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;{</div>
<div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;    int64_t timestamp = <a class="code" href="group__lavu__time.html#ga2eaefe702f95f619ea6f2d08afa01be1">AV_NOPTS_VALUE</a>;</div>
<div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="libavutil_2fifo_8c.html#a81f4cea70d96846df7111daccc5ecce2">av_fifo_size</a>(queue) &gt; 0)</div>
<div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;        <a class="code" href="libavutil_2fifo_8c.html#ab708d2f19b7a9592caa278256787adb6">av_fifo_generic_read</a>(queue, &amp;timestamp, <span class="keyword">sizeof</span>(timestamp), <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160; </div>
<div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;    <span class="keywordflow">return</span> timestamp;</div>
<div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;}</div>
<div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160; </div>
<div class="line"><a name="l01915"></a><span class="lineno"><a class="line" href="nvenc_8c.html#a54480c840eb58ea71cfe995dde601d1a"> 1915</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="nvenc_8c.html#a54480c840eb58ea71cfe995dde601d1a">nvenc_set_timestamp</a>(<a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a> *avctx,</div>
<div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;                               NV_ENC_LOCK_BITSTREAM *params,</div>
<div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;                               <a class="code" href="struct_a_v_packet.html">AVPacket</a> *<a class="code" href="demuxing__decoding_8c.html#a3d4c6562f0b27cf0cacbbea5c038c090">pkt</a>)</div>
<div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;{</div>
<div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;    <a class="code" href="struct_nvenc_context.html">NvencContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a> = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#af3379123060ad8cc9c321c29af4f8360">priv_data</a>;</div>
<div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160; </div>
<div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;    <a class="code" href="demuxing__decoding_8c.html#a3d4c6562f0b27cf0cacbbea5c038c090">pkt</a>-&gt;<a class="code" href="struct_a_v_packet.html#a73bde0a37f3b1efc839f11295bfbf42a">pts</a> = params-&gt;outputTimeStamp;</div>
<div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;    <a class="code" href="demuxing__decoding_8c.html#a3d4c6562f0b27cf0cacbbea5c038c090">pkt</a>-&gt;<a class="code" href="struct_a_v_packet.html#a85dbbd306b44b02390cd91c45e6a0f76">dts</a> = <a class="code" href="nvenc_8c.html#aa1c1fa16f8e3d7dbf31de73ad6927c46">timestamp_queue_dequeue</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;timestamp_list);</div>
<div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160; </div>
<div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;    <a class="code" href="demuxing__decoding_8c.html#a3d4c6562f0b27cf0cacbbea5c038c090">pkt</a>-&gt;<a class="code" href="struct_a_v_packet.html#a85dbbd306b44b02390cd91c45e6a0f76">dts</a> -= <a class="code" href="common_8h.html#a9960bd6780a9b16a216a57be1ee04359">FFMAX</a>(avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a3e5334a611a3e2a6a653805bb9e2d4d4">max_b_frames</a>, 0) * <a class="code" href="common_8h.html#a0f84cbd7fd810cd678157c98cbfad4b0">FFMIN</a>(avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a5c62b9c1528a272923ea2a4b86dea31a">ticks_per_frame</a>, 1);</div>
<div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160; </div>
<div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;}</div>
<div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160; </div>
<div class="line"><a name="l01929"></a><span class="lineno"><a class="line" href="nvenc_8c.html#a33fde0355c86734e53646b87a27d91ea"> 1929</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="nvenc_8c.html#a33fde0355c86734e53646b87a27d91ea">process_output_surface</a>(<a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a> *avctx, <a class="code" href="struct_a_v_packet.html">AVPacket</a> *<a class="code" href="demuxing__decoding_8c.html#a3d4c6562f0b27cf0cacbbea5c038c090">pkt</a>, <a class="code" href="struct_nvenc_surface.html">NvencSurface</a> *tmpoutsurf)</div>
<div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;{</div>
<div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;    <a class="code" href="struct_nvenc_context.html">NvencContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a> = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#af3379123060ad8cc9c321c29af4f8360">priv_data</a>;</div>
<div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;    <a class="code" href="struct_nvenc_dyn_load_functions.html">NvencDynLoadFunctions</a> *dl_fn = &amp;<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nvenc_dload_funcs;</div>
<div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;    NV_ENCODE_API_FUNCTION_LIST *p_nvenc = &amp;dl_fn-&gt;<a class="code" href="struct_nvenc_dyn_load_functions.html#abb541819aaaf75f51f9c2c23f674de94">nvenc_funcs</a>;</div>
<div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160; </div>
<div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;    uint32_t slice_mode_data;</div>
<div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;    uint32_t *slice_offsets = <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;    NV_ENC_LOCK_BITSTREAM lock_params = { 0 };</div>
<div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;    NVENCSTATUS nv_status;</div>
<div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;    <span class="keywordtype">int</span> res = 0;</div>
<div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160; </div>
<div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;    <span class="keyword">enum</span> <a class="code" href="group__lavu__picture.html#gae6cbcab1f70d8e476757f1c1f5a0a78e">AVPictureType</a> pict_type;</div>
<div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160; </div>
<div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;    <span class="keywordflow">switch</span> (avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a6e606effa68724cae2ef5cc05f7fd9cb">codec</a>-&gt;<a class="code" href="struct_a_v_codec.html#a01a53d07936f4c7ee280444793b6967b">id</a>) {</div>
<div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="group__lavc__core.html#ggaadca229ad2c20e060a14fec08a5cc7cea3d4c051c8b18a3c18750676a308c10be">AV_CODEC_ID_H264</a>:</div>
<div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;      slice_mode_data = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;encode_config.encodeCodecConfig.h264Config.sliceModeData;</div>
<div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="codec__id_8h.html#a60091c030fab7b9a8f3a7a6b783ab6f4">AV_CODEC_ID_H265</a>:</div>
<div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;      slice_mode_data = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;encode_config.encodeCodecConfig.hevcConfig.sliceModeData;</div>
<div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;    <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;      <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Unknown codec name\n&quot;</span>);</div>
<div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;      res = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EINVAL);</div>
<div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="target__bsf__fuzzer_8c.html#aa3d85a3469f60990fdff296efb86a9c2">error</a>;</div>
<div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;    }</div>
<div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;    slice_offsets = <a class="code" href="group__lavu__mem__funcs.html#gaf143ecab33a3868b57345466c39de7c1">av_mallocz</a>(slice_mode_data * <span class="keyword">sizeof</span>(*slice_offsets));</div>
<div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160; </div>
<div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;    <span class="keywordflow">if</span> (!slice_offsets) {</div>
<div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;        res = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="target__bsf__fuzzer_8c.html#aa3d85a3469f60990fdff296efb86a9c2">error</a>;</div>
<div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;    }</div>
<div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160; </div>
<div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;    lock_params.version = NV_ENC_LOCK_BITSTREAM_VER;</div>
<div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160; </div>
<div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;    lock_params.doNotWait = 0;</div>
<div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;    lock_params.outputBitstream = tmpoutsurf-&gt;<a class="code" href="struct_nvenc_surface.html#a25d91600ffa05ebdb7fa501d11f0acfc">output_surface</a>;</div>
<div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;    lock_params.sliceOffsets = slice_offsets;</div>
<div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160; </div>
<div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;    nv_status = p_nvenc-&gt;nvEncLockBitstream(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nvencoder, &amp;lock_params);</div>
<div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;    <span class="keywordflow">if</span> (nv_status != NV_ENC_SUCCESS) {</div>
<div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;        res = <a class="code" href="nvenc_8c.html#a9859649f623b83a65a82803d3199e07a">nvenc_print_error</a>(avctx, nv_status, <span class="stringliteral">&quot;Failed locking bitstream buffer&quot;</span>);</div>
<div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="target__bsf__fuzzer_8c.html#aa3d85a3469f60990fdff296efb86a9c2">error</a>;</div>
<div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;    }</div>
<div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160; </div>
<div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;    res = <a class="code" href="group__lavc__packet.html#gadfa708660b85a56749c753124de2da7d">av_new_packet</a>(<a class="code" href="demuxing__decoding_8c.html#a3d4c6562f0b27cf0cacbbea5c038c090">pkt</a>, lock_params.bitstreamSizeInBytes);</div>
<div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160; </div>
<div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;    <span class="keywordflow">if</span> (res &lt; 0) {</div>
<div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;        p_nvenc-&gt;nvEncUnlockBitstream(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nvencoder, tmpoutsurf-&gt;<a class="code" href="struct_nvenc_surface.html#a25d91600ffa05ebdb7fa501d11f0acfc">output_surface</a>);</div>
<div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="target__bsf__fuzzer_8c.html#aa3d85a3469f60990fdff296efb86a9c2">error</a>;</div>
<div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;    }</div>
<div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160; </div>
<div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;    memcpy(<a class="code" href="demuxing__decoding_8c.html#a3d4c6562f0b27cf0cacbbea5c038c090">pkt</a>-&gt;<a class="code" href="struct_a_v_packet.html#aaf4fe58dfcc7c232c1f2268b539d8367">data</a>, lock_params.bitstreamBufferPtr, lock_params.bitstreamSizeInBytes);</div>
<div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160; </div>
<div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;    nv_status = p_nvenc-&gt;nvEncUnlockBitstream(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nvencoder, tmpoutsurf-&gt;<a class="code" href="struct_nvenc_surface.html#a25d91600ffa05ebdb7fa501d11f0acfc">output_surface</a>);</div>
<div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;    <span class="keywordflow">if</span> (nv_status != NV_ENC_SUCCESS) {</div>
<div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;        res = <a class="code" href="nvenc_8c.html#a9859649f623b83a65a82803d3199e07a">nvenc_print_error</a>(avctx, nv_status, <span class="stringliteral">&quot;Failed unlocking bitstream buffer, expect the gates of mordor to open&quot;</span>);</div>
<div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="target__bsf__fuzzer_8c.html#aa3d85a3469f60990fdff296efb86a9c2">error</a>;</div>
<div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;    }</div>
<div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160; </div>
<div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160; </div>
<div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;    <span class="keywordflow">if</span> (avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a0425c77b3d06d71e5db88b1d7e1b37f2">pix_fmt</a> == <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a5ab95e18c0c9e5335f29121418eab314">AV_PIX_FMT_CUDA</a> || avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a0425c77b3d06d71e5db88b1d7e1b37f2">pix_fmt</a> == <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a8cfd0b36308fa1ad3522ef8815ccbd0a">AV_PIX_FMT_D3D11</a>) {</div>
<div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;registered_frames[tmpoutsurf-&gt;<a class="code" href="struct_nvenc_surface.html#a7524fe6d22859c6c8537ffd89c6c9fe3">reg_idx</a>].mapped -= 1;</div>
<div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;registered_frames[tmpoutsurf-&gt;<a class="code" href="struct_nvenc_surface.html#a7524fe6d22859c6c8537ffd89c6c9fe3">reg_idx</a>].mapped == 0) {</div>
<div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;            nv_status = p_nvenc-&gt;nvEncUnmapInputResource(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nvencoder, <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;registered_frames[tmpoutsurf-&gt;<a class="code" href="struct_nvenc_surface.html#a7524fe6d22859c6c8537ffd89c6c9fe3">reg_idx</a>].in_map.mappedResource);</div>
<div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;            <span class="keywordflow">if</span> (nv_status != NV_ENC_SUCCESS) {</div>
<div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;                res = <a class="code" href="nvenc_8c.html#a9859649f623b83a65a82803d3199e07a">nvenc_print_error</a>(avctx, nv_status, <span class="stringliteral">&quot;Failed unmapping input resource&quot;</span>);</div>
<div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;                <span class="keywordflow">goto</span> <a class="code" href="target__bsf__fuzzer_8c.html#aa3d85a3469f60990fdff296efb86a9c2">error</a>;</div>
<div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;            }</div>
<div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;registered_frames[tmpoutsurf-&gt;<a class="code" href="struct_nvenc_surface.html#a7524fe6d22859c6c8537ffd89c6c9fe3">reg_idx</a>].mapped &lt; 0) {</div>
<div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;            res = <a class="code" href="group__lavu__error.html#gaa102cde7ec5acbc099c3bcbb58556a18">AVERROR_BUG</a>;</div>
<div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;            <span class="keywordflow">goto</span> <a class="code" href="target__bsf__fuzzer_8c.html#aa3d85a3469f60990fdff296efb86a9c2">error</a>;</div>
<div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;        }</div>
<div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160; </div>
<div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;        <a class="code" href="group__lavu__frame.html#ga0a2b687f9c1c5ed0089b01fd61227108">av_frame_unref</a>(tmpoutsurf-&gt;<a class="code" href="struct_nvenc_surface.html#a58a869a12b6a5a69d6683cd3c1e09f37">in_ref</a>);</div>
<div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160; </div>
<div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;        tmpoutsurf-&gt;<a class="code" href="struct_nvenc_surface.html#ab57ef0f81d5dbb72e599b78f70401a98">input_surface</a> = <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;    }</div>
<div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160; </div>
<div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;    <span class="keywordflow">switch</span> (lock_params.pictureType) {</div>
<div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;    <span class="keywordflow">case</span> NV_ENC_PIC_TYPE_IDR:</div>
<div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;        <a class="code" href="demuxing__decoding_8c.html#a3d4c6562f0b27cf0cacbbea5c038c090">pkt</a>-&gt;<a class="code" href="struct_a_v_packet.html#a437be96a9da675f12caa228a9c81bd82">flags</a> |= <a class="code" href="group__lavc__packet.html#ga75603d7c2b8adf5829f4fd2fb860168f">AV_PKT_FLAG_KEY</a>;</div>
<div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;    <span class="keywordflow">case</span> NV_ENC_PIC_TYPE_I:</div>
<div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;        pict_type = <a class="code" href="group__lavu__picture.html#ggae6cbcab1f70d8e476757f1c1f5a0a78ea02be39f151a8ace7a65c86e13053e817">AV_PICTURE_TYPE_I</a>;</div>
<div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;    <span class="keywordflow">case</span> NV_ENC_PIC_TYPE_P:</div>
<div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;        pict_type = <a class="code" href="group__lavu__picture.html#ggae6cbcab1f70d8e476757f1c1f5a0a78eaa6fc0479507a03f173f07fc75dab2193">AV_PICTURE_TYPE_P</a>;</div>
<div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;    <span class="keywordflow">case</span> NV_ENC_PIC_TYPE_B:</div>
<div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;        pict_type = <a class="code" href="group__lavu__picture.html#ggae6cbcab1f70d8e476757f1c1f5a0a78ead22f8968e99bc48897c3f4ac29e82dae">AV_PICTURE_TYPE_B</a>;</div>
<div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;    <span class="keywordflow">case</span> NV_ENC_PIC_TYPE_BI:</div>
<div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;        pict_type = <a class="code" href="group__lavu__picture.html#ggae6cbcab1f70d8e476757f1c1f5a0a78ea71f9f194b0cbe86778cb6df41b867cf3">AV_PICTURE_TYPE_BI</a>;</div>
<div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;    <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Unknown picture type encountered, expect the output to be broken.\n&quot;</span>);</div>
<div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Please report this error and include as much information on how to reproduce it as possible.\n&quot;</span>);</div>
<div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;        res = <a class="code" href="group__lavu__error.html#ga9c520e483ba8648495620ffdb4c491f2">AVERROR_EXTERNAL</a>;</div>
<div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="target__bsf__fuzzer_8c.html#aa3d85a3469f60990fdff296efb86a9c2">error</a>;</div>
<div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;    }</div>
<div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160; </div>
<div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;<span class="preprocessor">#if FF_API_CODED_FRAME</span></div>
<div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;<a class="code" href="libavutil_2internal_8h.html#a5837cafc419c2b5ecdb1dfa330675d13">FF_DISABLE_DEPRECATION_WARNINGS</a></div>
<div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;    avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a5a2bc090d586303b25c642e3315d8671">coded_frame</a>-&gt;<a class="code" href="struct_a_v_frame.html#af9920fc3fbfa347b8943ae461b50d18b">pict_type</a> = pict_type;</div>
<div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;<a class="code" href="libavutil_2internal_8h.html#aa6ef004d10669ab4ee062367a014ea33">FF_ENABLE_DEPRECATION_WARNINGS</a></div>
<div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160; </div>
<div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;    <a class="code" href="avpacket_8c.html#a6e76c2d97b4905f969bed6b69b3d0c3c">ff_side_data_set_encoder_stats</a>(<a class="code" href="demuxing__decoding_8c.html#a3d4c6562f0b27cf0cacbbea5c038c090">pkt</a>,</div>
<div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;        (lock_params.frameAvgQP - 1) * <a class="code" href="group__lavu__enc.html#gad6ce86405f7381daad36ccf516b4da98">FF_QP2LAMBDA</a>, <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0, pict_type);</div>
<div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160; </div>
<div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;    res = <a class="code" href="nvenc_8c.html#a54480c840eb58ea71cfe995dde601d1a">nvenc_set_timestamp</a>(avctx, &amp;lock_params, <a class="code" href="demuxing__decoding_8c.html#a3d4c6562f0b27cf0cacbbea5c038c090">pkt</a>);</div>
<div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;    <span class="keywordflow">if</span> (res &lt; 0)</div>
<div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;        <span class="keywordflow">goto</span> error2;</div>
<div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160; </div>
<div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#a079eab092887563f2bef9106c6120089">av_free</a>(slice_offsets);</div>
<div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160; </div>
<div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160; </div>
<div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;<a class="code" href="target__bsf__fuzzer_8c.html#aa3d85a3469f60990fdff296efb86a9c2">error</a>:</div>
<div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;    <a class="code" href="nvenc_8c.html#aa1c1fa16f8e3d7dbf31de73ad6927c46">timestamp_queue_dequeue</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;timestamp_list);</div>
<div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160; </div>
<div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;error2:</div>
<div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#a079eab092887563f2bef9106c6120089">av_free</a>(slice_offsets);</div>
<div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160; </div>
<div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;    <span class="keywordflow">return</span> res;</div>
<div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;}</div>
<div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160; </div>
<div class="line"><a name="l02056"></a><span class="lineno"><a class="line" href="nvenc_8c.html#aea71d0c63dd7412756945440bf6a7b0e"> 2056</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="nvenc_8c.html#aea71d0c63dd7412756945440bf6a7b0e">output_ready</a>(<a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a> *avctx, <span class="keywordtype">int</span> <a class="code" href="aacdec__template_8c.html#affa0ccbe2ef7fd24bb8c61e28d1a6631">flush</a>)</div>
<div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;{</div>
<div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;    <a class="code" href="struct_nvenc_context.html">NvencContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a> = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#af3379123060ad8cc9c321c29af4f8360">priv_data</a>;</div>
<div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;    <span class="keywordtype">int</span> nb_ready, nb_pending;</div>
<div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160; </div>
<div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;    nb_ready   = <a class="code" href="libavutil_2fifo_8c.html#a81f4cea70d96846df7111daccc5ecce2">av_fifo_size</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;output_surface_ready_queue)   / <span class="keyword">sizeof</span>(<a class="code" href="struct_nvenc_surface.html">NvencSurface</a>*);</div>
<div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;    nb_pending = <a class="code" href="libavutil_2fifo_8c.html#a81f4cea70d96846df7111daccc5ecce2">av_fifo_size</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;output_surface_queue)         / <span class="keyword">sizeof</span>(<a class="code" href="struct_nvenc_surface.html">NvencSurface</a>*);</div>
<div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="aacdec__template_8c.html#affa0ccbe2ef7fd24bb8c61e28d1a6631">flush</a>)</div>
<div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;        <span class="keywordflow">return</span> nb_ready &gt; 0;</div>
<div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;    <span class="keywordflow">return</span> (nb_ready &gt; 0) &amp;&amp; (nb_ready + nb_pending &gt;= <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;async_depth);</div>
<div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;}</div>
<div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160; </div>
<div class="line"><a name="l02068"></a><span class="lineno"><a class="line" href="nvenc_8c.html#a32a2edb260c7b3537d8640f0f1d89863"> 2068</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="nvenc_8c.html#a32a2edb260c7b3537d8640f0f1d89863">reconfig_encoder</a>(<a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a> *avctx, <span class="keyword">const</span> <a class="code" href="struct_a_v_frame.html">AVFrame</a> *<a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>)</div>
<div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;{</div>
<div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;    <a class="code" href="struct_nvenc_context.html">NvencContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a> = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#af3379123060ad8cc9c321c29af4f8360">priv_data</a>;</div>
<div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;    NV_ENCODE_API_FUNCTION_LIST *p_nvenc = &amp;<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nvenc_dload_funcs.nvenc_funcs;</div>
<div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;    NVENCSTATUS <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>;</div>
<div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160; </div>
<div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;    NV_ENC_RECONFIGURE_PARAMS params = { 0 };</div>
<div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;    <span class="keywordtype">int</span> needs_reconfig = 0;</div>
<div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;    <span class="keywordtype">int</span> needs_encode_config = 0;</div>
<div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;    <span class="keywordtype">int</span> reconfig_bitrate = 0, reconfig_dar = 0;</div>
<div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;    <span class="keywordtype">int</span> dw, dh;</div>
<div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160; </div>
<div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;    params.version = NV_ENC_RECONFIGURE_PARAMS_VER;</div>
<div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;    params.reInitEncodeParams = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;init_encode_params;</div>
<div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160; </div>
<div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;    <a class="code" href="nvenc_8c.html#a86973c78da6778743a6380bcf423279a">compute_dar</a>(avctx, &amp;dw, &amp;dh);</div>
<div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;    <span class="keywordflow">if</span> (dw != <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;init_encode_params.darWidth || dh != <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;init_encode_params.darHeight) {</div>
<div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga9b58b28e2d429b930b69db19877f76a8">AV_LOG_VERBOSE</a>,</div>
<div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;               <span class="stringliteral">&quot;aspect ratio change (DAR): %d:%d -&gt; %d:%d\n&quot;</span>,</div>
<div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;               <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;init_encode_params.darWidth,</div>
<div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;               <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;init_encode_params.darHeight, dw, dh);</div>
<div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160; </div>
<div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;        params.reInitEncodeParams.darHeight = dh;</div>
<div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;        params.reInitEncodeParams.darWidth = dw;</div>
<div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160; </div>
<div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;        needs_reconfig = 1;</div>
<div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;        reconfig_dar = 1;</div>
<div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;    }</div>
<div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160; </div>
<div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;rc != NV_ENC_PARAMS_RC_CONSTQP &amp;&amp; <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;support_dyn_bitrate) {</div>
<div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;        <span class="keywordflow">if</span> (avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a6b53fda85ad61baa345edbd96cb8a33c">bit_rate</a> &gt; 0 &amp;&amp; params.reInitEncodeParams.encodeConfig-&gt;rcParams.averageBitRate != avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a6b53fda85ad61baa345edbd96cb8a33c">bit_rate</a>) {</div>
<div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga9b58b28e2d429b930b69db19877f76a8">AV_LOG_VERBOSE</a>,</div>
<div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;                   <span class="stringliteral">&quot;avg bitrate change: %d -&gt; %d\n&quot;</span>,</div>
<div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;                   params.reInitEncodeParams.encodeConfig-&gt;rcParams.averageBitRate,</div>
<div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;                   (uint32_t)avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a6b53fda85ad61baa345edbd96cb8a33c">bit_rate</a>);</div>
<div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160; </div>
<div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;            params.reInitEncodeParams.encodeConfig-&gt;rcParams.averageBitRate = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a6b53fda85ad61baa345edbd96cb8a33c">bit_rate</a>;</div>
<div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;            reconfig_bitrate = 1;</div>
<div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;        }</div>
<div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160; </div>
<div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;        <span class="keywordflow">if</span> (avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#aa2b5582f1a360534310b686cc3f7c668">rc_max_rate</a> &gt; 0 &amp;&amp; <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;encode_config.rcParams.maxBitRate != avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#aa2b5582f1a360534310b686cc3f7c668">rc_max_rate</a>) {</div>
<div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga9b58b28e2d429b930b69db19877f76a8">AV_LOG_VERBOSE</a>,</div>
<div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;                   <span class="stringliteral">&quot;max bitrate change: %d -&gt; %d\n&quot;</span>,</div>
<div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;                   params.reInitEncodeParams.encodeConfig-&gt;rcParams.maxBitRate,</div>
<div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;                   (uint32_t)avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#aa2b5582f1a360534310b686cc3f7c668">rc_max_rate</a>);</div>
<div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160; </div>
<div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;            params.reInitEncodeParams.encodeConfig-&gt;rcParams.maxBitRate = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#aa2b5582f1a360534310b686cc3f7c668">rc_max_rate</a>;</div>
<div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;            reconfig_bitrate = 1;</div>
<div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;        }</div>
<div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160; </div>
<div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;        <span class="keywordflow">if</span> (avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a15000607a7e2371162348bb35b0184c1">rc_buffer_size</a> &gt; 0 &amp;&amp; <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;encode_config.rcParams.vbvBufferSize != avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a15000607a7e2371162348bb35b0184c1">rc_buffer_size</a>) {</div>
<div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga9b58b28e2d429b930b69db19877f76a8">AV_LOG_VERBOSE</a>,</div>
<div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;                   <span class="stringliteral">&quot;vbv buffer size change: %d -&gt; %d\n&quot;</span>,</div>
<div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;                   params.reInitEncodeParams.encodeConfig-&gt;rcParams.vbvBufferSize,</div>
<div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;                   avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a15000607a7e2371162348bb35b0184c1">rc_buffer_size</a>);</div>
<div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160; </div>
<div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;            params.reInitEncodeParams.encodeConfig-&gt;rcParams.vbvBufferSize = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a15000607a7e2371162348bb35b0184c1">rc_buffer_size</a>;</div>
<div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;            reconfig_bitrate = 1;</div>
<div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;        }</div>
<div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160; </div>
<div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;        <span class="keywordflow">if</span> (reconfig_bitrate) {</div>
<div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;            params.resetEncoder = 1;</div>
<div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;            params.forceIDR = 1;</div>
<div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160; </div>
<div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;            needs_encode_config = 1;</div>
<div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;            needs_reconfig = 1;</div>
<div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;        }</div>
<div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;    }</div>
<div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160; </div>
<div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;    <span class="keywordflow">if</span> (!needs_encode_config)</div>
<div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;        params.reInitEncodeParams.encodeConfig = <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160; </div>
<div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;    <span class="keywordflow">if</span> (needs_reconfig) {</div>
<div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;        <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = p_nvenc-&gt;nvEncReconfigureEncoder(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nvencoder, &amp;params);</div>
<div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> != NV_ENC_SUCCESS) {</div>
<div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;            <a class="code" href="nvenc_8c.html#a9859649f623b83a65a82803d3199e07a">nvenc_print_error</a>(avctx, <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>, <span class="stringliteral">&quot;failed to reconfigure nvenc&quot;</span>);</div>
<div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;            <span class="keywordflow">if</span> (reconfig_dar) {</div>
<div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;                <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;init_encode_params.darHeight = dh;</div>
<div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;                <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;init_encode_params.darWidth = dw;</div>
<div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;            }</div>
<div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160; </div>
<div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;            <span class="keywordflow">if</span> (reconfig_bitrate) {</div>
<div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;                <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;encode_config.rcParams.averageBitRate = params.reInitEncodeParams.encodeConfig-&gt;rcParams.averageBitRate;</div>
<div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;                <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;encode_config.rcParams.maxBitRate = params.reInitEncodeParams.encodeConfig-&gt;rcParams.maxBitRate;</div>
<div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;                <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;encode_config.rcParams.vbvBufferSize = params.reInitEncodeParams.encodeConfig-&gt;rcParams.vbvBufferSize;</div>
<div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;            }</div>
<div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160; </div>
<div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;        }</div>
<div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;    }</div>
<div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;}</div>
<div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160; </div>
<div class="line"><a name="l02160"></a><span class="lineno"><a class="line" href="nvenc_8c.html#a231ab899ec4d674a87ebd3197461c607"> 2160</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="nvenc_8c.html#a231ab899ec4d674a87ebd3197461c607">nvenc_send_frame</a>(<a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a> *avctx, <span class="keyword">const</span> <a class="code" href="struct_a_v_frame.html">AVFrame</a> *<a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>)</div>
<div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;{</div>
<div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;    NVENCSTATUS nv_status;</div>
<div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;    <a class="code" href="struct_nvenc_surface.html">NvencSurface</a> *tmp_out_surf, *in_surf;</div>
<div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;    <span class="keywordtype">int</span> res, res2;</div>
<div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;    NV_ENC_SEI_PAYLOAD sei_data[8];</div>
<div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;    <span class="keywordtype">int</span> sei_count = 0;</div>
<div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div>
<div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160; </div>
<div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;    <a class="code" href="struct_nvenc_context.html">NvencContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a> = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#af3379123060ad8cc9c321c29af4f8360">priv_data</a>;</div>
<div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;    <a class="code" href="struct_nvenc_dyn_load_functions.html">NvencDynLoadFunctions</a> *dl_fn = &amp;<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nvenc_dload_funcs;</div>
<div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;    NV_ENCODE_API_FUNCTION_LIST *p_nvenc = &amp;dl_fn-&gt;<a class="code" href="struct_nvenc_dyn_load_functions.html#abb541819aaaf75f51f9c2c23f674de94">nvenc_funcs</a>;</div>
<div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160; </div>
<div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;    NV_ENC_PIC_PARAMS pic_params = { 0 };</div>
<div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;    pic_params.version = NV_ENC_PIC_PARAMS_VER;</div>
<div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160; </div>
<div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;    <span class="keywordflow">if</span> ((!<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;cu_context &amp;&amp; !<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;d3d11_device) || !<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nvencoder)</div>
<div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EINVAL);</div>
<div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160; </div>
<div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a> &amp;&amp; <a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>-&gt;buf[0]) {</div>
<div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;        in_surf = <a class="code" href="nvenc_8c.html#aeae10f623a8eb7cd95caf0bebe58183a">get_free_frame</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>);</div>
<div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;        <span class="keywordflow">if</span> (!in_surf)</div>
<div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EAGAIN);</div>
<div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160; </div>
<div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;        res = <a class="code" href="nvenc_8c.html#a12819453065171c2aa768766ab201f4e">nvenc_push_context</a>(avctx);</div>
<div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;        <span class="keywordflow">if</span> (res &lt; 0)</div>
<div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;            <span class="keywordflow">return</span> res;</div>
<div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160; </div>
<div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;        <a class="code" href="nvenc_8c.html#a32a2edb260c7b3537d8640f0f1d89863">reconfig_encoder</a>(avctx, <a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>);</div>
<div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160; </div>
<div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;        res = <a class="code" href="nvenc_8c.html#ab39cb2b1a84a821962598d9c43b918a4">nvenc_upload_frame</a>(avctx, <a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>, in_surf);</div>
<div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160; </div>
<div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;        res2 = <a class="code" href="nvenc_8c.html#ad2d50f7855c51659e8df21a154b26577">nvenc_pop_context</a>(avctx);</div>
<div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;        <span class="keywordflow">if</span> (res2 &lt; 0)</div>
<div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;            <span class="keywordflow">return</span> res2;</div>
<div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160; </div>
<div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;        <span class="keywordflow">if</span> (res)</div>
<div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;            <span class="keywordflow">return</span> res;</div>
<div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160; </div>
<div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;        pic_params.inputBuffer = in_surf-&gt;<a class="code" href="struct_nvenc_surface.html#ab57ef0f81d5dbb72e599b78f70401a98">input_surface</a>;</div>
<div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;        pic_params.bufferFmt = in_surf-&gt;<a class="code" href="struct_nvenc_surface.html#a5d57300593a94bf92a7858a00fe57d26">format</a>;</div>
<div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;        pic_params.inputWidth = in_surf-&gt;<a class="code" href="struct_nvenc_surface.html#a2ce57b71bd6be846eb48a8581ecd5984">width</a>;</div>
<div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;        pic_params.inputHeight = in_surf-&gt;<a class="code" href="struct_nvenc_surface.html#a8b83a2e5f2996b0464695af7fa91936c">height</a>;</div>
<div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;        pic_params.inputPitch = in_surf-&gt;<a class="code" href="struct_nvenc_surface.html#abbd7146e6d65efe460193b8e0718b3d1">pitch</a>;</div>
<div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;        pic_params.outputBitstream = in_surf-&gt;<a class="code" href="struct_nvenc_surface.html#a25d91600ffa05ebdb7fa501d11f0acfc">output_surface</a>;</div>
<div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160; </div>
<div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;        <span class="keywordflow">if</span> (avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#abb01e291550fa3fb96188af4d494587e">flags</a> &amp; <a class="code" href="group__lavc__core.html#ga502225f65e2092fbc45945247892cb0f">AV_CODEC_FLAG_INTERLACED_DCT</a>) {</div>
<div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>-&gt;top_field_first)</div>
<div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;                pic_params.pictureStruct = NV_ENC_PIC_STRUCT_FIELD_TOP_BOTTOM;</div>
<div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;                pic_params.pictureStruct = NV_ENC_PIC_STRUCT_FIELD_BOTTOM_TOP;</div>
<div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;            pic_params.pictureStruct = NV_ENC_PIC_STRUCT_FRAME;</div>
<div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;        }</div>
<div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160; </div>
<div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;forced_idr &gt;= 0 &amp;&amp; <a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>-&gt;pict_type == <a class="code" href="group__lavu__picture.html#ggae6cbcab1f70d8e476757f1c1f5a0a78ea02be39f151a8ace7a65c86e13053e817">AV_PICTURE_TYPE_I</a>) {</div>
<div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;            pic_params.encodePicFlags =</div>
<div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;                <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;forced_idr ? NV_ENC_PIC_FLAG_FORCEIDR : NV_ENC_PIC_FLAG_FORCEINTRA;</div>
<div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;            pic_params.encodePicFlags = 0;</div>
<div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;        }</div>
<div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160; </div>
<div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;        pic_params.inputTimeStamp = <a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>-&gt;pts;</div>
<div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160; </div>
<div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;a53_cc &amp;&amp; <a class="code" href="group__lavu__frame.html#gadec0efb470b1eead6a979333d9deca0c">av_frame_get_side_data</a>(<a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>, <a class="code" href="group__lavu__frame.html#ggae01fa7e427274293aacdf2adc17076bca4848fd3952b4c2e1c1b85acb628c78a6">AV_FRAME_DATA_A53_CC</a>)) {</div>
<div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;            <span class="keywordtype">void</span> *a53_data = <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;            <span class="keywordtype">size_t</span> a53_size = 0;</div>
<div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160; </div>
<div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="atsc__a53_8c.html#a39b3066f2015570b557376efb706f50f">ff_alloc_a53_sei</a>(<a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>, 0, (<span class="keywordtype">void</span>**)&amp;a53_data, &amp;a53_size) &lt; 0) {</div>
<div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;                <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Not enough memory for closed captions, skipping\n&quot;</span>);</div>
<div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;            }</div>
<div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160; </div>
<div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;            <span class="keywordflow">if</span> (a53_data) {</div>
<div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;                sei_data[sei_count].payloadSize = (uint32_t)a53_size;</div>
<div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;                sei_data[sei_count].payloadType = 4;</div>
<div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;                sei_data[sei_count].payload = (<a class="code" href="audio__convert_8c.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a>*)a53_data;</div>
<div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;                sei_count ++;</div>
<div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;            }</div>
<div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;        }</div>
<div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160; </div>
<div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;s12m_tc &amp;&amp; <a class="code" href="group__lavu__frame.html#gadec0efb470b1eead6a979333d9deca0c">av_frame_get_side_data</a>(<a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>, <a class="code" href="group__lavu__frame.html#ggae01fa7e427274293aacdf2adc17076bca9f4e4ed5a874d1089ec07c384b81bb70">AV_FRAME_DATA_S12M_TIMECODE</a>)) {</div>
<div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;            <span class="keywordtype">void</span> *tc_data = <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;            <span class="keywordtype">size_t</span> tc_size = 0;</div>
<div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160; </div>
<div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="libavcodec_2internal_8h.html#ab6089c632fa67edd08225cb3a83086a9">ff_alloc_timecode_sei</a>(<a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>, avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a4d08b297e97eefd66c714df4fff493c8">framerate</a>, 0, (<span class="keywordtype">void</span>**)&amp;tc_data, &amp;tc_size) &lt; 0) {</div>
<div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;                <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Not enough memory for timecode sei, skipping\n&quot;</span>);</div>
<div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160;            }</div>
<div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160; </div>
<div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160;            <span class="keywordflow">if</span> (tc_data) {</div>
<div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;                sei_data[sei_count].payloadSize = (uint32_t)tc_size;</div>
<div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160;                sei_data[sei_count].payloadType = <a class="code" href="hevc__sei_8h.html#abba0b9185313c25cb08327f8ee281bd1ab77e1bc31714407525ec9c7e42c20a7c">HEVC_SEI_TYPE_TIME_CODE</a>;</div>
<div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;                sei_data[sei_count].payload = (<a class="code" href="audio__convert_8c.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a>*)tc_data;</div>
<div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;                sei_count ++;</div>
<div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;            }</div>
<div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;        }</div>
<div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160; </div>
<div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;        <a class="code" href="nvenc_8c.html#a4bf3899a8bed4f6012f9f9d6ad3111cc">nvenc_codec_specific_pic_params</a>(avctx, &amp;pic_params, sei_data, sei_count);</div>
<div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160;        pic_params.encodePicFlags = NV_ENC_PIC_FLAG_EOS;</div>
<div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;    }</div>
<div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160; </div>
<div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;    res = <a class="code" href="nvenc_8c.html#a12819453065171c2aa768766ab201f4e">nvenc_push_context</a>(avctx);</div>
<div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;    <span class="keywordflow">if</span> (res &lt; 0)</div>
<div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160;        <span class="keywordflow">return</span> res;</div>
<div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160; </div>
<div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;    nv_status = p_nvenc-&gt;nvEncEncodePicture(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nvencoder, &amp;pic_params);</div>
<div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160; </div>
<div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;    <span class="keywordflow">for</span> ( <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; sei_count; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#adba82e1bcd02de510a858fcbedf79ef1">av_freep</a>(&amp;sei_data[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].payload);</div>
<div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160; </div>
<div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;    res = <a class="code" href="nvenc_8c.html#ad2d50f7855c51659e8df21a154b26577">nvenc_pop_context</a>(avctx);</div>
<div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;    <span class="keywordflow">if</span> (res &lt; 0)</div>
<div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;        <span class="keywordflow">return</span> res;</div>
<div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160; </div>
<div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;    <span class="keywordflow">if</span> (nv_status != NV_ENC_SUCCESS &amp;&amp;</div>
<div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160;        nv_status != NV_ENC_ERR_NEED_MORE_INPUT)</div>
<div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="nvenc_8c.html#a9859649f623b83a65a82803d3199e07a">nvenc_print_error</a>(avctx, nv_status, <span class="stringliteral">&quot;EncodePicture failed!&quot;</span>);</div>
<div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160; </div>
<div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a> &amp;&amp; <a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>-&gt;buf[0]) {</div>
<div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;        <a class="code" href="libavutil_2fifo_8c.html#ae95c15dcdd266b4005f8919e4f571180">av_fifo_generic_write</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;output_surface_queue, &amp;in_surf, <span class="keyword">sizeof</span>(in_surf), <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;        <a class="code" href="nvenc_8c.html#a4ff7bc81361be5089bb0483bad599c4f">timestamp_queue_enqueue</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;timestamp_list, <a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>-&gt;pts);</div>
<div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;    }</div>
<div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160; </div>
<div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;    <span class="comment">/* all the pending buffers are now ready for output */</span></div>
<div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;    <span class="keywordflow">if</span> (nv_status == NV_ENC_SUCCESS) {</div>
<div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160;        <span class="keywordflow">while</span> (<a class="code" href="libavutil_2fifo_8c.html#a81f4cea70d96846df7111daccc5ecce2">av_fifo_size</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;output_surface_queue) &gt; 0) {</div>
<div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;            <a class="code" href="libavutil_2fifo_8c.html#ab708d2f19b7a9592caa278256787adb6">av_fifo_generic_read</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;output_surface_queue, &amp;tmp_out_surf, <span class="keyword">sizeof</span>(tmp_out_surf), <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160;            <a class="code" href="libavutil_2fifo_8c.html#ae95c15dcdd266b4005f8919e4f571180">av_fifo_generic_write</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;output_surface_ready_queue, &amp;tmp_out_surf, <span class="keyword">sizeof</span>(tmp_out_surf), <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;        }</div>
<div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;    }</div>
<div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160; </div>
<div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;}</div>
<div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160; </div>
<div class="line"><a name="l02294"></a><span class="lineno"><a class="line" href="nvenc_8h.html#a1b190f75155ffdf3a33ddfbb02568b62"> 2294</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="nvenc_8c.html#a1b190f75155ffdf3a33ddfbb02568b62">ff_nvenc_receive_packet</a>(<a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a> *avctx, <a class="code" href="struct_a_v_packet.html">AVPacket</a> *<a class="code" href="demuxing__decoding_8c.html#a3d4c6562f0b27cf0cacbbea5c038c090">pkt</a>)</div>
<div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;{</div>
<div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;    <a class="code" href="struct_nvenc_surface.html">NvencSurface</a> *tmp_out_surf;</div>
<div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;    <span class="keywordtype">int</span> res, res2;</div>
<div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160; </div>
<div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;    <a class="code" href="struct_nvenc_context.html">NvencContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a> = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#af3379123060ad8cc9c321c29af4f8360">priv_data</a>;</div>
<div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160; </div>
<div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;    <a class="code" href="struct_a_v_frame.html">AVFrame</a> *<a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a> = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;frame;</div>
<div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160; </div>
<div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;    <span class="keywordflow">if</span> ((!<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;cu_context &amp;&amp; !<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;d3d11_device) || !<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nvencoder)</div>
<div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EINVAL);</div>
<div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160; </div>
<div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>-&gt;buf[0]) {</div>
<div class="line"><a name="l02307"></a><span class="lineno"> 2307</span>&#160;        res = <a class="code" href="encode_8c.html#a24f7e9c2daa5cc6033a220bf53870c62">ff_encode_get_frame</a>(avctx, <a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>);</div>
<div class="line"><a name="l02308"></a><span class="lineno"> 2308</span>&#160;        <span class="keywordflow">if</span> (res &lt; 0 &amp;&amp; res != <a class="code" href="group__lavu__error.html#gab4faa0afdf35076914824200331defff">AVERROR_EOF</a>)</div>
<div class="line"><a name="l02309"></a><span class="lineno"> 2309</span>&#160;            <span class="keywordflow">return</span> res;</div>
<div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;    }</div>
<div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160; </div>
<div class="line"><a name="l02312"></a><span class="lineno"> 2312</span>&#160;    res = <a class="code" href="nvenc_8c.html#a231ab899ec4d674a87ebd3197461c607">nvenc_send_frame</a>(avctx, <a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>);</div>
<div class="line"><a name="l02313"></a><span class="lineno"> 2313</span>&#160;    <span class="keywordflow">if</span> (res &lt; 0) {</div>
<div class="line"><a name="l02314"></a><span class="lineno"> 2314</span>&#160;        <span class="keywordflow">if</span> (res != <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EAGAIN))</div>
<div class="line"><a name="l02315"></a><span class="lineno"> 2315</span>&#160;            <span class="keywordflow">return</span> res;</div>
<div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;    } <span class="keywordflow">else</span></div>
<div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160;        <a class="code" href="group__lavu__frame.html#ga0a2b687f9c1c5ed0089b01fd61227108">av_frame_unref</a>(<a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>);</div>
<div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160; </div>
<div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="nvenc_8c.html#aea71d0c63dd7412756945440bf6a7b0e">output_ready</a>(avctx, avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#aeffc0091dc3138015b53107c8ffb04af">internal</a>-&gt;<a class="code" href="struct_a_v_codec_internal.html#abbc05b0d9ed9a56e9b9b999eea2e940d">draining</a>)) {</div>
<div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160;        <a class="code" href="libavutil_2fifo_8c.html#ab708d2f19b7a9592caa278256787adb6">av_fifo_generic_read</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;output_surface_ready_queue, &amp;tmp_out_surf, <span class="keyword">sizeof</span>(tmp_out_surf), <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160; </div>
<div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160;        res = <a class="code" href="nvenc_8c.html#a12819453065171c2aa768766ab201f4e">nvenc_push_context</a>(avctx);</div>
<div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160;        <span class="keywordflow">if</span> (res &lt; 0)</div>
<div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160;            <span class="keywordflow">return</span> res;</div>
<div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160; </div>
<div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;        res = <a class="code" href="nvenc_8c.html#a33fde0355c86734e53646b87a27d91ea">process_output_surface</a>(avctx, <a class="code" href="demuxing__decoding_8c.html#a3d4c6562f0b27cf0cacbbea5c038c090">pkt</a>, tmp_out_surf);</div>
<div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160; </div>
<div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160;        res2 = <a class="code" href="nvenc_8c.html#ad2d50f7855c51659e8df21a154b26577">nvenc_pop_context</a>(avctx);</div>
<div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160;        <span class="keywordflow">if</span> (res2 &lt; 0)</div>
<div class="line"><a name="l02330"></a><span class="lineno"> 2330</span>&#160;            <span class="keywordflow">return</span> res2;</div>
<div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160; </div>
<div class="line"><a name="l02332"></a><span class="lineno"> 2332</span>&#160;        <span class="keywordflow">if</span> (res)</div>
<div class="line"><a name="l02333"></a><span class="lineno"> 2333</span>&#160;            <span class="keywordflow">return</span> res;</div>
<div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160; </div>
<div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160;        <a class="code" href="libavutil_2fifo_8c.html#ae95c15dcdd266b4005f8919e4f571180">av_fifo_generic_write</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;unused_surface_queue, &amp;tmp_out_surf, <span class="keyword">sizeof</span>(tmp_out_surf), <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#aeffc0091dc3138015b53107c8ffb04af">internal</a>-&gt;<a class="code" href="struct_a_v_codec_internal.html#abbc05b0d9ed9a56e9b9b999eea2e940d">draining</a>) {</div>
<div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="group__lavu__error.html#gab4faa0afdf35076914824200331defff">AVERROR_EOF</a>;</div>
<div class="line"><a name="l02338"></a><span class="lineno"> 2338</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02339"></a><span class="lineno"> 2339</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EAGAIN);</div>
<div class="line"><a name="l02340"></a><span class="lineno"> 2340</span>&#160;    }</div>
<div class="line"><a name="l02341"></a><span class="lineno"> 2341</span>&#160; </div>
<div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160;}</div>
<div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160; </div>
<div class="line"><a name="l02345"></a><span class="lineno"><a class="line" href="nvenc_8h.html#ac020542c84c2c83f6f91a779de58614e"> 2345</a></span>&#160;<a class="code" href="attributes_8h.html#abeeb324fff79a5335d36774704e2475c">av_cold</a> <span class="keywordtype">void</span> <a class="code" href="nvenc_8c.html#afef80dff10bc1675bdfd3f2d8b259e10">ff_nvenc_encode_flush</a>(<a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a> *avctx)</div>
<div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160;{</div>
<div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;    <a class="code" href="struct_nvenc_context.html">NvencContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a> = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#af3379123060ad8cc9c321c29af4f8360">priv_data</a>;</div>
<div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160; </div>
<div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;    <a class="code" href="nvenc_8c.html#a231ab899ec4d674a87ebd3197461c607">nvenc_send_frame</a>(avctx, <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160;    <a class="code" href="libavutil_2fifo_8c.html#a2f257d5cd93686b047c9b29ef6493e51">av_fifo_reset</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;timestamp_list);</div>
<div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;}</div>
</div><!-- fragment --></div><!-- contents -->
<div class="ttc" id="atarget__bsf__fuzzer_8c_html_aa3d85a3469f60990fdff296efb86a9c2"><div class="ttname"><a href="target__bsf__fuzzer_8c.html#aa3d85a3469f60990fdff296efb86a9c2">error</a></div><div class="ttdeci">static void error(const char *err)</div><div class="ttdef"><b>Definition:</b> <a href="target__bsf__fuzzer_8c_source.html#l00030">target_bsf_fuzzer.c:30</a></div></div>
<div class="ttc" id="astruct_a_v_frame_html_af9920fc3fbfa347b8943ae461b50d18b"><div class="ttname"><a href="struct_a_v_frame.html#af9920fc3fbfa347b8943ae461b50d18b">AVFrame::pict_type</a></div><div class="ttdeci">enum AVPictureType pict_type</div><div class="ttdef"><b>Definition:</b> <a href="frame_8h_source.html#l00386">frame.h:391</a></div></div>
<div class="ttc" id="anvenc_8h_html_abc6126af1d45847bc59afa0aa3216b04aa22e8b8329b9d0224ca00643f84e27e0"><div class="ttname"><a href="nvenc_8h.html#abc6126af1d45847bc59afa0aa3216b04aa22e8b8329b9d0224ca00643f84e27e0">NVENC_LOSSLESS</a></div><div class="ttdeci">@ NVENC_LOSSLESS</div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8h_source.html#l00134">nvenc.h:134</a></div></div>
<div class="ttc" id="aavcodec_8h_html_aedc45d7b874ec5c3e4e9b6e9d948abc4"><div class="ttname"><a href="avcodec_8h.html#aedc45d7b874ec5c3e4e9b6e9d948abc4">FF_PROFILE_HEVC_REXT</a></div><div class="ttdeci">#define FF_PROFILE_HEVC_REXT</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l01950">avcodec.h:1950</a></div></div>
<div class="ttc" id="anvenc_8h_html_adf764cbdea00d65edcd07bb9953ad2b7a59e5ce4558dab204f05bb0fed4c9196b"><div class="ttname"><a href="nvenc_8h.html#adf764cbdea00d65edcd07bb9953ad2b7a59e5ce4558dab204f05bb0fed4c9196b">NV_ENC_H264_PROFILE_MAIN</a></div><div class="ttdeci">@ NV_ENC_H264_PROFILE_MAIN</div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8h_source.html#l00121">nvenc.h:121</a></div></div>
<div class="ttc" id="alibavutil_2internal_8h_html_aa6ef004d10669ab4ee062367a014ea33"><div class="ttname"><a href="libavutil_2internal_8h.html#aa6ef004d10669ab4ee062367a014ea33">FF_ENABLE_DEPRECATION_WARNINGS</a></div><div class="ttdeci">#define FF_ENABLE_DEPRECATION_WARNINGS</div><div class="ttdef"><b>Definition:</b> <a href="libavutil_2internal_8h_source.html#l00085">internal.h:85</a></div></div>
<div class="ttc" id="aatsc__a53_8c_html_a39b3066f2015570b557376efb706f50f"><div class="ttname"><a href="atsc__a53_8c.html#a39b3066f2015570b557376efb706f50f">ff_alloc_a53_sei</a></div><div class="ttdeci">int ff_alloc_a53_sei(const AVFrame *frame, size_t prefix_len, void **data, size_t *sei_size)</div><div class="ttdef"><b>Definition:</b> <a href="atsc__a53_8c_source.html#l00025">atsc_a53.c:25</a></div></div>
<div class="ttc" id="anvenc_8h_html_adc29c2ff13d900c2f185ee95427fb06ca7da7f42ac52783391873425e6937b3cc"><div class="ttname"><a href="nvenc_8h.html#adc29c2ff13d900c2f185ee95427fb06ca7da7f42ac52783391873425e6937b3cc">LIST_DEVICES</a></div><div class="ttdeci">@ LIST_DEVICES</div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8h_source.html#l00142">nvenc.h:142</a></div></div>
<div class="ttc" id="agroup__lavu__log__constants_html_ga85b57516ca703cc47d9bbe5f4658c716"><div class="ttname"><a href="group__lavu__log__constants.html#ga85b57516ca703cc47d9bbe5f4658c716">AV_LOG_WARNING</a></div><div class="ttdeci">#define AV_LOG_WARNING</div><div class="ttdef"><b>Definition:</b> <a href="log_8h_source.html#l00200">log.h:200</a></div></div>
<div class="ttc" id="anvenc_8c_html_a565dbc279e0013ffbd152c7614ba8a8f"><div class="ttname"><a href="nvenc_8c.html#a565dbc279e0013ffbd152c7614ba8a8f">PRESET_ALIAS</a></div><div class="ttdeci">#define PRESET_ALIAS(alias, name,...)</div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8c_source.html#l00646">nvenc.c:646</a></div></div>
<div class="ttc" id="astruct_a_v_codec_context_html"><div class="ttname"><a href="struct_a_v_codec_context.html">AVCodecContext</a></div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l00526">avcodec.h:526</a></div></div>
<div class="ttc" id="apixfmt_8h_html_a9a8e335cf3be472042bc9f0cf80cd4c5a5ab95e18c0c9e5335f29121418eab314"><div class="ttname"><a href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a5ab95e18c0c9e5335f29121418eab314">AV_PIX_FMT_CUDA</a></div><div class="ttdeci">@ AV_PIX_FMT_CUDA</div><div class="ttdef"><b>Definition:</b> <a href="pixfmt_8h_source.html#l00235">pixfmt.h:235</a></div></div>
<div class="ttc" id="anvenc_8h_html_adc29c2ff13d900c2f185ee95427fb06caae9759caeef7d4a66c5f1c0a3f56643f"><div class="ttname"><a href="nvenc_8h.html#adc29c2ff13d900c2f185ee95427fb06caae9759caeef7d4a66c5f1c0a3f56643f">ANY_DEVICE</a></div><div class="ttdeci">@ ANY_DEVICE</div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8h_source.html#l00143">nvenc.h:143</a></div></div>
<div class="ttc" id="astruct_a_v_codec_context_html_a6b53fda85ad61baa345edbd96cb8a33c"><div class="ttname"><a href="struct_a_v_codec_context.html#a6b53fda85ad61baa345edbd96cb8a33c">AVCodecContext::bit_rate</a></div><div class="ttdeci">int64_t bit_rate</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l00576">avcodec.h:576</a></div></div>
<div class="ttc" id="apixfmt_8h_html_a9a8e335cf3be472042bc9f0cf80cd4c5"><div class="ttname"><a href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5">AVPixelFormat</a></div><div class="ttdeci">AVPixelFormat</div><div class="ttdef"><b>Definition:</b> <a href="pixfmt_8h_source.html#l00064">pixfmt.h:64</a></div></div>
<div class="ttc" id="awriting__filters_8txt_html_adb27990ed3d4ad300fd1dde281903508"><div class="ttname"><a href="writing__filters_8txt.html#adb27990ed3d4ad300fd1dde281903508">name</a></div><div class="ttdeci">it s the only field you need to keep assuming you have a context There is some magic you don t need to care about around this just let it vf default minimum maximum flags name is the option name</div><div class="ttdef"><b>Definition:</b> <a href="writing__filters_8txt_source.html#l00088">writing_filters.txt:88</a></div></div>
<div class="ttc" id="astruct_a_v_codec_context_html_a3bac44bb0b016ab838780cc19ac277d6"><div class="ttname"><a href="struct_a_v_codec_context.html#a3bac44bb0b016ab838780cc19ac277d6">AVCodecContext::hw_frames_ctx</a></div><div class="ttdeci">AVBufferRef * hw_frames_ctx</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l02226">avcodec.h:2226</a></div></div>
<div class="ttc" id="asvq3_8c_html_abbb6c7c49508c1ac374683f2d1159e08"><div class="ttname"><a href="svq3_8c.html#abbb6c7c49508c1ac374683f2d1159e08">level</a></div><div class="ttdeci">uint8_t level</div><div class="ttdef"><b>Definition:</b> <a href="svq3_8c_source.html#l00205">svq3.c:205</a></div></div>
<div class="ttc" id="astruct_a_v_codec_context_html_ab649e8c599f5a0e2a30448e67a36deb6"><div class="ttname"><a href="struct_a_v_codec_context.html#ab649e8c599f5a0e2a30448e67a36deb6">AVCodecContext::color_trc</a></div><div class="ttdeci">enum AVColorTransferCharacteristic color_trc</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l01132">avcodec.h:1147</a></div></div>
<div class="ttc" id="afilter__design_8txt_html_adf2fb515710d47541f7150ecd2950e76"><div class="ttname"><a href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a></div><div class="ttdeci">Filter the word “frame” indicates either a video frame or a group of audio as stored in an AVFrame structure Format for each input and each output the list of supported formats For video that means pixel format For audio that means channel sample they are references to shared objects When the negotiation mechanism computes the intersection of the formats supported at each end of a all references to both lists are replaced with a reference to the intersection And when a single format is eventually chosen for a link amongst the remaining all references to the list are updated That means that if a filter requires that its input and output have the same format amongst a supported all it has to do is use a reference to the same list of formats query_formats can leave some formats unset and return AVERROR(EAGAIN) to cause the negotiation mechanism toagain later. That can be used by filters with complex requirements to use the format negotiated on one link to set the formats supported on another. Frame references ownership and permissions</div></div>
<div class="ttc" id="astruct_a_v_h_w_frames_context_html_a9e6f29d0f744930cdd0e8bdff8771520"><div class="ttname"><a href="struct_a_v_h_w_frames_context.html#a9e6f29d0f744930cdd0e8bdff8771520">AVHWFramesContext::width</a></div><div class="ttdeci">int width</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext_8h_source.html#l00229">hwcontext.h:229</a></div></div>
<div class="ttc" id="astruct_a_v_codec_context_html_a0449afd803eb107bd4dbc8b5ea22e363"><div class="ttname"><a href="struct_a_v_codec_context.html#a0449afd803eb107bd4dbc8b5ea22e363">AVCodecContext::height</a></div><div class="ttdeci">int height</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l00699">avcodec.h:699</a></div></div>
<div class="ttc" id="ahevcdsp__template_8c_html_a0707a89c2f63bd260108e9dbb669358e"><div class="ttname"><a href="hevcdsp__template_8c.html#a0707a89c2f63bd260108e9dbb669358e">P3</a></div><div class="ttdeci">#define P3</div><div class="ttdef"><b>Definition:</b> <a href="hevcdsp__template_8c_source.html#l01497">hevcdsp_template.c:1497</a></div></div>
<div class="ttc" id="alibavutil_2fifo_8c_html_ae95c15dcdd266b4005f8919e4f571180"><div class="ttname"><a href="libavutil_2fifo_8c.html#ae95c15dcdd266b4005f8919e4f571180">av_fifo_generic_write</a></div><div class="ttdeci">int av_fifo_generic_write(AVFifoBuffer *f, void *src, int size, int(*func)(void *, void *, int))</div><div class="ttdef"><b>Definition:</b> <a href="libavutil_2fifo_8c_source.html#l00122">fifo.c:122</a></div></div>
<div class="ttc" id="astruct_a_v_codec_context_html_af3379123060ad8cc9c321c29af4f8360"><div class="ttname"><a href="struct_a_v_codec_context.html#af3379123060ad8cc9c321c29af4f8360">AVCodecContext::priv_data</a></div><div class="ttdeci">void * priv_data</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l00553">avcodec.h:553</a></div></div>
<div class="ttc" id="astruct_a_v_h_w_device_context_html_abc92603a11768828ef3aea1f9d089308"><div class="ttname"><a href="struct_a_v_h_w_device_context.html#abc92603a11768828ef3aea1f9d089308">AVHWDeviceContext::type</a></div><div class="ttdeci">enum AVHWDeviceType type</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext_8h_source.html#l00071">hwcontext.h:79</a></div></div>
<div class="ttc" id="astruct_a_v_h_w_frames_context_html_a045bc1713932804f6ceef170a5578e0e"><div class="ttname"><a href="struct_a_v_h_w_frames_context.html#a045bc1713932804f6ceef170a5578e0e">AVHWFramesContext::format</a></div><div class="ttdeci">enum AVPixelFormat format</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext_8h_source.html#l00199">hwcontext.h:209</a></div></div>
<div class="ttc" id="acommon_8h_html_a09a0bb7d8fcfac416de7a5fe7fd8b0f1"><div class="ttname"><a href="common_8h.html#a09a0bb7d8fcfac416de7a5fe7fd8b0f1">FFSWAP</a></div><div class="ttdeci">#define FFSWAP(type, a, b)</div><div class="ttdef"><b>Definition:</b> <a href="common_8h_source.html#l00099">common.h:99</a></div></div>
<div class="ttc" id="agroup__lavu__frame_html_gadec0efb470b1eead6a979333d9deca0c"><div class="ttname"><a href="group__lavu__frame.html#gadec0efb470b1eead6a979333d9deca0c">av_frame_get_side_data</a></div><div class="ttdeci">AVFrameSideData * av_frame_get_side_data(const AVFrame *frame, enum AVFrameSideDataType type)</div><div class="ttdef"><b>Definition:</b> <a href="frame_8c_source.html#l00738">frame.c:738</a></div></div>
<div class="ttc" id="astruct_a_v_codec_context_html_a3f63bc9141e25bf7f1cda0cef7cd4a60"><div class="ttname"><a href="struct_a_v_codec_context.html#a3f63bc9141e25bf7f1cda0cef7cd4a60">AVCodecContext::qmin</a></div><div class="ttdeci">int qmin</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l01368">avcodec.h:1368</a></div></div>
<div class="ttc" id="aaf__afade_8c_html_a007dea27057008224e9da69eaeca8606ac157bdf0b85a40d2619cbc8bc1ae5fe2"><div class="ttname"><a href="af__afade_8c.html#a007dea27057008224e9da69eaeca8606ac157bdf0b85a40d2619cbc8bc1ae5fe2">NONE</a></div><div class="ttdeci">@ NONE</div><div class="ttdef"><b>Definition:</b> <a href="af__afade_8c_source.html#l00054">af_afade.c:54</a></div></div>
<div class="ttc" id="agroup__lavu__error_html_gab4faa0afdf35076914824200331defff"><div class="ttname"><a href="group__lavu__error.html#gab4faa0afdf35076914824200331defff">AVERROR_EOF</a></div><div class="ttdeci">#define AVERROR_EOF</div><div class="ttdoc">End of file.</div><div class="ttdef"><b>Definition:</b> <a href="error_8h_source.html#l00055">error.h:55</a></div></div>
<div class="ttc" id="aavpacket_8c_html_a6e76c2d97b4905f969bed6b69b3d0c3c"><div class="ttname"><a href="avpacket_8c.html#a6e76c2d97b4905f969bed6b69b3d0c3c">ff_side_data_set_encoder_stats</a></div><div class="ttdeci">int ff_side_data_set_encoder_stats(AVPacket *pkt, int quality, int64_t *error, int error_count, int pict_type)</div><div class="ttdef"><b>Definition:</b> <a href="avpacket_8c_source.html#l00796">avpacket.c:796</a></div></div>
<div class="ttc" id="aavcodec_8h_html_ae7b88419c24001277450732a5d3abe2b"><div class="ttname"><a href="avcodec_8h.html#ae7b88419c24001277450732a5d3abe2b">FF_PROFILE_H264_BASELINE</a></div><div class="ttdeci">#define FF_PROFILE_H264_BASELINE</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l01898">avcodec.h:1898</a></div></div>
<div class="ttc" id="agroup__lavu__frame_html_ggae01fa7e427274293aacdf2adc17076bca4848fd3952b4c2e1c1b85acb628c78a6"><div class="ttname"><a href="group__lavu__frame.html#ggae01fa7e427274293aacdf2adc17076bca4848fd3952b4c2e1c1b85acb628c78a6">AV_FRAME_DATA_A53_CC</a></div><div class="ttdeci">@ AV_FRAME_DATA_A53_CC</div><div class="ttdef"><b>Definition:</b> <a href="frame_8h_source.html#l00058">frame.h:58</a></div></div>
<div class="ttc" id="anvenc_8c_html_a12819453065171c2aa768766ab201f4e"><div class="ttname"><a href="nvenc_8c.html#a12819453065171c2aa768766ab201f4e">nvenc_push_context</a></div><div class="ttdeci">static int nvenc_push_context(AVCodecContext *avctx)</div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8c_source.html#l00241">nvenc.c:241</a></div></div>
<div class="ttc" id="astruct_a_v_buffer_ref_html_acb8452e99cd75074b93800b532c6ea4b"><div class="ttname"><a href="struct_a_v_buffer_ref.html#acb8452e99cd75074b93800b532c6ea4b">AVBufferRef::data</a></div><div class="ttdeci">uint8_t * data</div><div class="ttdef"><b>Definition:</b> <a href="buffer_8h_source.html#l00089">buffer.h:89</a></div></div>
<div class="ttc" id="agroup__lavu__picture_html_gae6cbcab1f70d8e476757f1c1f5a0a78e"><div class="ttname"><a href="group__lavu__picture.html#gae6cbcab1f70d8e476757f1c1f5a0a78e">AVPictureType</a></div><div class="ttdeci">AVPictureType</div><div class="ttdef"><b>Definition:</b> <a href="avutil_8h_source.html#l00272">avutil.h:272</a></div></div>
<div class="ttc" id="astruct_a_v_codec_context_html_a5a2bc090d586303b25c642e3315d8671"><div class="ttname"><a href="struct_a_v_codec_context.html#a5a2bc090d586303b25c642e3315d8671">AVCodecContext::coded_frame</a></div><div class="ttdeci">attribute_deprecated AVFrame * coded_frame</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l01776">avcodec.h:1776</a></div></div>
<div class="ttc" id="anvenc_8c_html_aea71d0c63dd7412756945440bf6a7b0e"><div class="ttname"><a href="nvenc_8c.html#aea71d0c63dd7412756945440bf6a7b0e">output_ready</a></div><div class="ttdeci">static int output_ready(AVCodecContext *avctx, int flush)</div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8c_source.html#l02056">nvenc.c:2056</a></div></div>
<div class="ttc" id="anvenc_8h_html_adf764cbdea00d65edcd07bb9953ad2b7a7232f240b8d0b414cb49b12d30852c5e"><div class="ttname"><a href="nvenc_8h.html#adf764cbdea00d65edcd07bb9953ad2b7a7232f240b8d0b414cb49b12d30852c5e">NV_ENC_H264_PROFILE_HIGH</a></div><div class="ttdeci">@ NV_ENC_H264_PROFILE_HIGH</div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8h_source.html#l00122">nvenc.h:122</a></div></div>
<div class="ttc" id="astruct_a_v_codec_h_w_config_internal_html"><div class="ttname"><a href="struct_a_v_codec_h_w_config_internal.html">AVCodecHWConfigInternal</a></div><div class="ttdef"><b>Definition:</b> <a href="hwconfig_8h_source.html#l00029">hwconfig.h:29</a></div></div>
<div class="ttc" id="agroup__lavu__frame_html_ggae01fa7e427274293aacdf2adc17076bca9f4e4ed5a874d1089ec07c384b81bb70"><div class="ttname"><a href="group__lavu__frame.html#ggae01fa7e427274293aacdf2adc17076bca9f4e4ed5a874d1089ec07c384b81bb70">AV_FRAME_DATA_S12M_TIMECODE</a></div><div class="ttdeci">@ AV_FRAME_DATA_S12M_TIMECODE</div><div class="ttdef"><b>Definition:</b> <a href="frame_8h_source.html#l00168">frame.h:168</a></div></div>
<div class="ttc" id="anvenc_8h_html_a99fb83031ce9923c84392b4e92f956b5a5f324143f35bb1641f068a630a71d0b2"><div class="ttname"><a href="nvenc_8h.html#a99fb83031ce9923c84392b4e92f956b5a5f324143f35bb1641f068a630a71d0b2">NV_ENC_HEVC_PROFILE_REXT</a></div><div class="ttdeci">@ NV_ENC_HEVC_PROFILE_REXT</div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8h_source.html#l00129">nvenc.h:129</a></div></div>
<div class="ttc" id="astruct_nvenc_surface_html_abbd7146e6d65efe460193b8e0718b3d1"><div class="ttname"><a href="struct_nvenc_surface.html#abbd7146e6d65efe460193b8e0718b3d1">NvencSurface::pitch</a></div><div class="ttdeci">int pitch</div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8h_source.html#l00080">nvenc.h:80</a></div></div>
<div class="ttc" id="agroup__lavu__frame_html_ga979d73f3228814aee56aeca0636e37cc"><div class="ttname"><a href="group__lavu__frame.html#ga979d73f3228814aee56aeca0636e37cc">av_frame_free</a></div><div class="ttdeci">void av_frame_free(AVFrame **frame)</div><div class="ttdef"><b>Definition:</b> <a href="frame_8c_source.html#l00203">frame.c:203</a></div></div>
<div class="ttc" id="apixdesc_8h_html"><div class="ttname"><a href="pixdesc_8h.html">pixdesc.h</a></div></div>
<div class="ttc" id="anvenc_8c_html_a54480c840eb58ea71cfe995dde601d1a"><div class="ttname"><a href="nvenc_8c.html#a54480c840eb58ea71cfe995dde601d1a">nvenc_set_timestamp</a></div><div class="ttdeci">static int nvenc_set_timestamp(AVCodecContext *avctx, NV_ENC_LOCK_BITSTREAM *params, AVPacket *pkt)</div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8c_source.html#l01915">nvenc.c:1915</a></div></div>
<div class="ttc" id="apixfmt_8h_html_a3da0bf691418bc22c4bcbe6583ad589aafce51dfb8b012df5cbbf59918c410f29"><div class="ttname"><a href="pixfmt_8h.html#a3da0bf691418bc22c4bcbe6583ad589aafce51dfb8b012df5cbbf59918c410f29">AVCOL_RANGE_JPEG</a></div><div class="ttdeci">@ AVCOL_RANGE_JPEG</div><div class="ttdef"><b>Definition:</b> <a href="pixfmt_8h_source.html#l00586">pixfmt.h:586</a></div></div>
<div class="ttc" id="acavsdsp_8c_html_a6c2a9f7efd46f0160f3037869924d6ce"><div class="ttname"><a href="cavsdsp_8c.html#a6c2a9f7efd46f0160f3037869924d6ce">P1</a></div><div class="ttdeci">#define P1</div><div class="ttdef"><b>Definition:</b> <a href="cavsdsp_8c_source.html#l00039">cavsdsp.c:39</a></div></div>
<div class="ttc" id="aencode_8h_html"><div class="ttname"><a href="encode_8h.html">encode.h</a></div></div>
<div class="ttc" id="astruct_a_v_c_u_d_a_device_context_html"><div class="ttname"><a href="struct_a_v_c_u_d_a_device_context.html">AVCUDADeviceContext</a></div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__cuda_8h_source.html#l00042">hwcontext_cuda.h:42</a></div></div>
<div class="ttc" id="aavcodec_8h_html_adbd58c1bfa90fb3b5520d76ba9744251"><div class="ttname"><a href="avcodec_8h.html#adbd58c1bfa90fb3b5520d76ba9744251">FF_PROFILE_H264_HIGH_444_PREDICTIVE</a></div><div class="ttdeci">#define FF_PROFILE_H264_HIGH_444_PREDICTIVE</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l01910">avcodec.h:1910</a></div></div>
<div class="ttc" id="anvenc_8c_html_a32a2edb260c7b3537d8640f0f1d89863"><div class="ttname"><a href="nvenc_8c.html#a32a2edb260c7b3537d8640f0f1d89863">reconfig_encoder</a></div><div class="ttdeci">static void reconfig_encoder(AVCodecContext *avctx, const AVFrame *frame)</div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8c_source.html#l02068">nvenc.c:2068</a></div></div>
<div class="ttc" id="agroup__lavu__log__constants_html_ga9b58b28e2d429b930b69db19877f76a8"><div class="ttname"><a href="group__lavu__log__constants.html#ga9b58b28e2d429b930b69db19877f76a8">AV_LOG_VERBOSE</a></div><div class="ttdeci">#define AV_LOG_VERBOSE</div><div class="ttdef"><b>Definition:</b> <a href="log_8h_source.html#l00210">log.h:210</a></div></div>
<div class="ttc" id="astruct_a_v_h_w_device_context_html_a46055b48d1a40445d775b4ae24f77f20"><div class="ttname"><a href="struct_a_v_h_w_device_context.html#a46055b48d1a40445d775b4ae24f77f20">AVHWDeviceContext::hwctx</a></div><div class="ttdeci">void * hwctx</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext_8h_source.html#l00092">hwcontext.h:92</a></div></div>
<div class="ttc" id="anvenc_8c_html_a7dc7ef0ced6600352858a0fb7d22342d"><div class="ttname"><a href="nvenc_8c.html#a7dc7ef0ced6600352858a0fb7d22342d">ff_nvenc_pix_fmts</a></div><div class="ttdeci">enum AVPixelFormat ff_nvenc_pix_fmts[]</div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8c_source.html#l00001">nvenc.c:46</a></div></div>
<div class="ttc" id="anvenc_8c_html_a0dfcbbf27c383f6ddf48fcf8edea5081"><div class="ttname"><a href="nvenc_8c.html#a0dfcbbf27c383f6ddf48fcf8edea5081">set_constqp</a></div><div class="ttdeci">static av_cold void set_constqp(AVCodecContext *avctx)</div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8c_source.html#l00700">nvenc.c:700</a></div></div>
<div class="ttc" id="astruct_a_v_fifo_buffer_html"><div class="ttname"><a href="struct_a_v_fifo_buffer.html">AVFifoBuffer</a></div><div class="ttdef"><b>Definition:</b> <a href="fifo_8h_source.html#l00031">fifo.h:31</a></div></div>
<div class="ttc" id="anvenc_8c_html_a9859649f623b83a65a82803d3199e07a"><div class="ttname"><a href="nvenc_8c.html#a9859649f623b83a65a82803d3199e07a">nvenc_print_error</a></div><div class="ttdeci">static int nvenc_print_error(AVCodecContext *avctx, NVENCSTATUS err, const char *error_string)</div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8c_source.html#l00127">nvenc.c:127</a></div></div>
<div class="ttc" id="avf__curves_8c_html_a920971eab600c52963635b965ba64898"><div class="ttname"><a href="vf__curves_8c.html#a920971eab600c52963635b965ba64898">BD</a></div><div class="ttdeci">#define BD</div></div>
<div class="ttc" id="alibavutil_2fifo_8c_html_ab708d2f19b7a9592caa278256787adb6"><div class="ttname"><a href="libavutil_2fifo_8c.html#ab708d2f19b7a9592caa278256787adb6">av_fifo_generic_read</a></div><div class="ttdeci">int av_fifo_generic_read(AVFifoBuffer *f, void *dest, int buf_size, void(*func)(void *, void *, int))</div><div class="ttdef"><b>Definition:</b> <a href="libavutil_2fifo_8c_source.html#l00213">fifo.c:213</a></div></div>
<div class="ttc" id="agroup__lavu__error_html_ga4ebaa288c7684a26a591c501208910e4"><div class="ttname"><a href="group__lavu__error.html#ga4ebaa288c7684a26a591c501208910e4">AVERROR_UNKNOWN</a></div><div class="ttdeci">#define AVERROR_UNKNOWN</div><div class="ttdoc">Unknown error, typically from an external library.</div><div class="ttdef"><b>Definition:</b> <a href="error_8h_source.html#l00071">error.h:71</a></div></div>
<div class="ttc" id="alibavcodec_2internal_8h_html_a8e0ce66394bedcfbdc52cf8b7b7bedba"><div class="ttname"><a href="libavcodec_2internal_8h.html#a8e0ce66394bedcfbdc52cf8b7b7bedba">ff_add_cpb_side_data</a></div><div class="ttdeci">AVCPBProperties * ff_add_cpb_side_data(AVCodecContext *avctx)</div><div class="ttdef"><b>Definition:</b> <a href="libavcodec_2utils_8c_source.html#l02005">utils.c:2005</a></div></div>
<div class="ttc" id="anvenc_8c_html_a4e0ddbacaa28d61a8fa4b77cc67a736f"><div class="ttname"><a href="nvenc_8c.html#a4e0ddbacaa28d61a8fa4b77cc67a736f">nverr</a></div><div class="ttdeci">NVENCSTATUS nverr</div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8c_source.html#l00080">nvenc.c:80</a></div></div>
<div class="ttc" id="anvenc_8c_html_aaa00b7aeea59e09f19f2059bfc15bdb2"><div class="ttname"><a href="nvenc_8c.html#aaa00b7aeea59e09f19f2059bfc15bdb2">set_lossless</a></div><div class="ttdeci">static av_cold void set_lossless(AVCodecContext *avctx)</div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8c_source.html#l00795">nvenc.c:795</a></div></div>
<div class="ttc" id="anvenc_8c_html_ae1bc2b75d3ae189600fa0474e003f7f4"><div class="ttname"><a href="nvenc_8c.html#ae1bc2b75d3ae189600fa0474e003f7f4">PRESET</a></div><div class="ttdeci">#define PRESET(name,...)</div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8c_source.html#l00649">nvenc.c:649</a></div></div>
<div class="ttc" id="alibavutil_2fifo_8c_html_a2f257d5cd93686b047c9b29ef6493e51"><div class="ttname"><a href="libavutil_2fifo_8c.html#a2f257d5cd93686b047c9b29ef6493e51">av_fifo_reset</a></div><div class="ttdeci">void av_fifo_reset(AVFifoBuffer *f)</div><div class="ttdef"><b>Definition:</b> <a href="libavutil_2fifo_8c_source.html#l00071">fifo.c:71</a></div></div>
<div class="ttc" id="agroup__lavc__packet_html_ga75603d7c2b8adf5829f4fd2fb860168f"><div class="ttname"><a href="group__lavc__packet.html#ga75603d7c2b8adf5829f4fd2fb860168f">AV_PKT_FLAG_KEY</a></div><div class="ttdeci">#define AV_PKT_FLAG_KEY</div><div class="ttdoc">The packet contains a keyframe.</div><div class="ttdef"><b>Definition:</b> <a href="packet_8h_source.html#l00401">packet.h:401</a></div></div>
<div class="ttc" id="anvenc_8c_html_afef80dff10bc1675bdfd3f2d8b259e10"><div class="ttname"><a href="nvenc_8c.html#afef80dff10bc1675bdfd3f2d8b259e10">ff_nvenc_encode_flush</a></div><div class="ttdeci">av_cold void ff_nvenc_encode_flush(AVCodecContext *avctx)</div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8c_source.html#l02345">nvenc.c:2345</a></div></div>
<div class="ttc" id="astruct_a_v_packet_html_aaf4fe58dfcc7c232c1f2268b539d8367"><div class="ttname"><a href="struct_a_v_packet.html#aaf4fe58dfcc7c232c1f2268b539d8367">AVPacket::data</a></div><div class="ttdeci">uint8_t * data</div><div class="ttdef"><b>Definition:</b> <a href="packet_8h_source.html#l00363">packet.h:363</a></div></div>
<div class="ttc" id="atableprint__vlc_8h_html_ae97db1f58b6b1515ed57a83bea3dd572"><div class="ttname"><a href="tableprint__vlc_8h.html#ae97db1f58b6b1515ed57a83bea3dd572">av_malloc</a></div><div class="ttdeci">#define av_malloc(s)</div><div class="ttdef"><b>Definition:</b> <a href="tableprint__vlc_8h_source.html#l00031">tableprint_vlc.h:31</a></div></div>
<div class="ttc" id="agroup__lavc__core_html_ga9ed82634c59b339786575827c47a8f68"><div class="ttname"><a href="group__lavc__core.html#ga9ed82634c59b339786575827c47a8f68">AV_CODEC_FLAG_GLOBAL_HEADER</a></div><div class="ttdeci">#define AV_CODEC_FLAG_GLOBAL_HEADER</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l00329">avcodec.h:329</a></div></div>
<div class="ttc" id="anvenc_8h_html"><div class="ttname"><a href="nvenc_8h.html">nvenc.h</a></div></div>
<div class="ttc" id="ahwcontext_8h_html_acf25724be4b066a51ad86aa9214b0d34a8447d4488b0fc4113c281cbdc6e7334e"><div class="ttname"><a href="hwcontext_8h.html#acf25724be4b066a51ad86aa9214b0d34a8447d4488b0fc4113c281cbdc6e7334e">AV_HWDEVICE_TYPE_CUDA</a></div><div class="ttdeci">@ AV_HWDEVICE_TYPE_CUDA</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext_8h_source.html#l00030">hwcontext.h:30</a></div></div>
<div class="ttc" id="astruct_nvenc_surface_html_ab57ef0f81d5dbb72e599b78f70401a98"><div class="ttname"><a href="struct_nvenc_surface.html#ab57ef0f81d5dbb72e599b78f70401a98">NvencSurface::input_surface</a></div><div class="ttdeci">NV_ENC_INPUT_PTR input_surface</div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8h_source.html#l00075">nvenc.h:75</a></div></div>
<div class="ttc" id="anvenc_8c_html_a86973c78da6778743a6380bcf423279a"><div class="ttname"><a href="nvenc_8c.html#a86973c78da6778743a6380bcf423279a">compute_dar</a></div><div class="ttdeci">static void compute_dar(AVCodecContext *avctx, int *dw, int *dh)</div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8c_source.html#l01223">nvenc.c:1223</a></div></div>
<div class="ttc" id="astruct_a_v_codec_context_html_ae246ca7a1c72c151891ed0599e8dbfba"><div class="ttname"><a href="struct_a_v_codec_context.html#ae246ca7a1c72c151891ed0599e8dbfba">AVCodecContext::extradata_size</a></div><div class="ttdeci">int extradata_size</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l00628">avcodec.h:628</a></div></div>
<div class="ttc" id="anvenc_8c_html_ab39cb2b1a84a821962598d9c43b918a4"><div class="ttname"><a href="nvenc_8c.html#ab39cb2b1a84a821962598d9c43b918a4">nvenc_upload_frame</a></div><div class="ttdeci">static int nvenc_upload_frame(AVCodecContext *avctx, const AVFrame *frame, NvencSurface *nvenc_frame)</div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8c_source.html#l01806">nvenc.c:1806</a></div></div>
<div class="ttc" id="anvenc_8h_html_abc6126af1d45847bc59afa0aa3216b04adaa15ff53eef4d8d6f1a9d1bb1f4f744"><div class="ttname"><a href="nvenc_8h.html#abc6126af1d45847bc59afa0aa3216b04adaa15ff53eef4d8d6f1a9d1bb1f4f744">NVENC_LOWLATENCY</a></div><div class="ttdeci">@ NVENC_LOWLATENCY</div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8h_source.html#l00133">nvenc.h:133</a></div></div>
<div class="ttc" id="astruct_a_v_codec_context_html_a9b6b3f1fcbdcc2ad9f4dbb4370496e38"><div class="ttname"><a href="struct_a_v_codec_context.html#a9b6b3f1fcbdcc2ad9f4dbb4370496e38">AVCodecContext::gop_size</a></div><div class="ttdeci">int gop_size</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l00721">avcodec.h:721</a></div></div>
<div class="ttc" id="anvenc_8c_html_ad3564142e6a6c251c00c043c01420b48"><div class="ttname"><a href="nvenc_8c.html#ad3564142e6a6c251c00c043c01420b48">set_vbr</a></div><div class="ttdeci">static av_cold void set_vbr(AVCodecContext *avctx)</div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8c_source.html#l00733">nvenc.c:733</a></div></div>
<div class="ttc" id="anvenc_8c_html_a8d2892124c776dfe7b168dc1739109fd"><div class="ttname"><a href="nvenc_8c.html#a8d2892124c776dfe7b168dc1739109fd">nvenc_map_error</a></div><div class="ttdeci">static int nvenc_map_error(NVENCSTATUS err, const char **desc)</div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8c_source.html#l00112">nvenc.c:112</a></div></div>
<div class="ttc" id="anvenc_8c_html_a0f0ca83a25ba921f09477bd0e6c6278e"><div class="ttname"><a href="nvenc_8c.html#a0f0ca83a25ba921f09477bd0e6c6278e">nvenc_check_cap</a></div><div class="ttdeci">static int nvenc_check_cap(AVCodecContext *avctx, NV_ENC_CAPS cap)</div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8c_source.html#l00326">nvenc.c:326</a></div></div>
<div class="ttc" id="acheckasm_8h_html_a73a3b169ac8c3419cbe15327e75ffcfd"><div class="ttname"><a href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a></div><div class="ttdeci">#define fail()</div><div class="ttdef"><b>Definition:</b> <a href="checkasm_8h_source.html#l00123">checkasm.h:123</a></div></div>
<div class="ttc" id="astruct_a_v_codec_context_html_a3a41b3e5bde23b877799f6e72dac8ef3"><div class="ttname"><a href="struct_a_v_codec_context.html#a3a41b3e5bde23b877799f6e72dac8ef3">AVCodecContext::color_primaries</a></div><div class="ttdeci">enum AVColorPrimaries color_primaries</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l01132">avcodec.h:1140</a></div></div>
<div class="ttc" id="astruct_a_v_format_context_html_a32379cc371463b235d54235d4af06a15"><div class="ttname"><a href="struct_a_v_format_context.html#a32379cc371463b235d54235d4af06a15">AVFormatContext::flags</a></div><div class="ttdeci">int flags</div><div class="ttdef"><b>Definition:</b> <a href="avformat_8h_source.html#l01354">avformat.h:1354</a></div></div>
<div class="ttc" id="ahwcontext_8h_html_acf25724be4b066a51ad86aa9214b0d34a1823a64d48c796978b892dd669659c4c"><div class="ttname"><a href="hwcontext_8h.html#acf25724be4b066a51ad86aa9214b0d34a1823a64d48c796978b892dd669659c4c">AV_HWDEVICE_TYPE_D3D11VA</a></div><div class="ttdeci">@ AV_HWDEVICE_TYPE_D3D11VA</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext_8h_source.html#l00035">hwcontext.h:35</a></div></div>
<div class="ttc" id="anvenc_8c_html_aa4cf05195f3a39acc566306511dcad8d"><div class="ttname"><a href="nvenc_8c.html#aa4cf05195f3a39acc566306511dcad8d">nvenc_map_preset</a></div><div class="ttdeci">static void nvenc_map_preset(NvencContext *ctx)</div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8c_source.html#l00651">nvenc.c:651</a></div></div>
<div class="ttc" id="aavcodec_8h_html_a0ff6fe9cf1f7a1671d597b9524024332"><div class="ttname"><a href="avcodec_8h.html#a0ff6fe9cf1f7a1671d597b9524024332">FF_PROFILE_H264_HIGH</a></div><div class="ttdeci">#define FF_PROFILE_H264_HIGH</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l01902">avcodec.h:1902</a></div></div>
<div class="ttc" id="aaeval_8c_html_a16aca557f352132b55bbc3c4769daa8b"><div class="ttname"><a href="aeval_8c.html#a16aca557f352132b55bbc3c4769daa8b">val</a></div><div class="ttdeci">static double val(void *priv, double ch)</div><div class="ttdef"><b>Definition:</b> <a href="aeval_8c_source.html#l00076">aeval.c:76</a></div></div>
<div class="ttc" id="anvenc_8c_html_acfb5f27ea3ede9d61fb98fa4fbfe991f"><div class="ttname"><a href="nvenc_8c.html#acfb5f27ea3ede9d61fb98fa4fbfe991f">nvenc_copy_frame</a></div><div class="ttdeci">static int nvenc_copy_frame(AVCodecContext *avctx, NvencSurface *nv_surface, NV_ENC_LOCK_INPUT_BUFFER *lock_buffer_params, const AVFrame *frame)</div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8c_source.html#l01688">nvenc.c:1688</a></div></div>
<div class="ttc" id="agroup__lavu__error_html_ga76077a6d42ee211f59712485bd977e40"><div class="ttname"><a href="group__lavu__error.html#ga76077a6d42ee211f59712485bd977e40">AVERROR_BUFFER_TOO_SMALL</a></div><div class="ttdeci">#define AVERROR_BUFFER_TOO_SMALL</div><div class="ttdoc">Buffer too small.</div><div class="ttdef"><b>Definition:</b> <a href="error_8h_source.html#l00051">error.h:51</a></div></div>
<div class="ttc" id="ahwcontext__cuda_8h_html"><div class="ttname"><a href="hwcontext__cuda_8h.html">hwcontext_cuda.h</a></div></div>
<div class="ttc" id="agroup__lavu__picture_html_ga4513d36f527c1476e89845631d975542"><div class="ttname"><a href="group__lavu__picture.html#ga4513d36f527c1476e89845631d975542">av_image_fill_pointers</a></div><div class="ttdeci">int av_image_fill_pointers(uint8_t *data[4], enum AVPixelFormat pix_fmt, int height, uint8_t *ptr, const int linesizes[4])</div><div class="ttdef"><b>Definition:</b> <a href="imgutils_8c_source.html#l00146">imgutils.c:146</a></div></div>
<div class="ttc" id="astruct_g_u_i_d_tuple_html_acd513c0d59ae5eb978b0b6f4bc22be05"><div class="ttname"><a href="struct_g_u_i_d_tuple.html#acd513c0d59ae5eb978b0b6f4bc22be05">GUIDTuple::guid</a></div><div class="ttdeci">const GUID guid</div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8c_source.html#l00642">nvenc.c:642</a></div></div>
<div class="ttc" id="agroup__lavu__math__rational_html_ga4fd9c0b8e663cf3d55e89fbc6ce71602"><div class="ttname"><a href="group__lavu__math__rational.html#ga4fd9c0b8e663cf3d55e89fbc6ce71602">av_reduce</a></div><div class="ttdeci">int av_reduce(int *dst_num, int *dst_den, int64_t num, int64_t den, int64_t max)</div><div class="ttdef"><b>Definition:</b> <a href="rational_8c_source.html#l00035">rational.c:35</a></div></div>
<div class="ttc" id="anvenc_8c_html_abc524845e42dad899e1ca3f76cd3c1e6"><div class="ttname"><a href="nvenc_8c.html#abc524845e42dad899e1ca3f76cd3c1e6">nvenc_print_driver_requirement</a></div><div class="ttdeci">static void nvenc_print_driver_requirement(AVCodecContext *avctx, int level)</div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8c_source.html#l00147">nvenc.c:147</a></div></div>
<div class="ttc" id="agroup__lavc__core_html_ga502225f65e2092fbc45945247892cb0f"><div class="ttname"><a href="group__lavc__core.html#ga502225f65e2092fbc45945247892cb0f">AV_CODEC_FLAG_INTERLACED_DCT</a></div><div class="ttdeci">#define AV_CODEC_FLAG_INTERLACED_DCT</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l00321">avcodec.h:321</a></div></div>
<div class="ttc" id="astruct_a_v_h_w_device_context_html"><div class="ttname"><a href="struct_a_v_h_w_device_context.html">AVHWDeviceContext</a></div><div class="ttdef"><b>Definition:</b> <a href="hwcontext_8h_source.html#l00061">hwcontext.h:61</a></div></div>
<div class="ttc" id="astruct_nvenc_surface_html_a25d91600ffa05ebdb7fa501d11f0acfc"><div class="ttname"><a href="struct_nvenc_surface.html#a25d91600ffa05ebdb7fa501d11f0acfc">NvencSurface::output_surface</a></div><div class="ttdeci">NV_ENC_OUTPUT_PTR output_surface</div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8h_source.html#l00082">nvenc.h:82</a></div></div>
<div class="ttc" id="astruct_nvenc_dyn_load_functions_html_a3d276b8fd283c51b18982a6da56d9309"><div class="ttname"><a href="struct_nvenc_dyn_load_functions.html#a3d276b8fd283c51b18982a6da56d9309">NvencDynLoadFunctions::nvenc_dl</a></div><div class="ttdeci">NvencFunctions * nvenc_dl</div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8h_source.html#l00089">nvenc.h:89</a></div></div>
<div class="ttc" id="anvenc_8c_html_a40d2efce9c4948a72268823edb874d3a"><div class="ttname"><a href="nvenc_8c.html#a40d2efce9c4948a72268823edb874d3a">nvenc_check_capabilities</a></div><div class="ttdeci">static int nvenc_check_capabilities(AVCodecContext *avctx)</div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8c_source.html#l00343">nvenc.c:343</a></div></div>
<div class="ttc" id="astruct_a_v_codec_context_html_a31a2ef78cf186083c2c676dda8e226db"><div class="ttname"><a href="struct_a_v_codec_context.html#a31a2ef78cf186083c2c676dda8e226db">AVCodecContext::b_quant_offset</a></div><div class="ttdeci">float b_quant_offset</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l00808">avcodec.h:808</a></div></div>
<div class="ttc" id="agroup__lavu__frame_html_gac700017c5270c79c1e1befdeeb008b2f"><div class="ttname"><a href="group__lavu__frame.html#gac700017c5270c79c1e1befdeeb008b2f">av_frame_alloc</a></div><div class="ttdeci">AVFrame * av_frame_alloc(void)</div><div class="ttdef"><b>Definition:</b> <a href="frame_8c_source.html#l00190">frame.c:190</a></div></div>
<div class="ttc" id="astruct_a_v_h_w_frames_context_html_ae61bbe1d8645a0c573085e29f1d0a58f"><div class="ttname"><a href="struct_a_v_h_w_frames_context.html#ae61bbe1d8645a0c573085e29f1d0a58f">AVHWFramesContext::height</a></div><div class="ttdeci">int height</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext_8h_source.html#l00229">hwcontext.h:229</a></div></div>
<div class="ttc" id="ahevc__sei_8h_html_abba0b9185313c25cb08327f8ee281bd1ab77e1bc31714407525ec9c7e42c20a7c"><div class="ttname"><a href="hevc__sei_8h.html#abba0b9185313c25cb08327f8ee281bd1ab77e1bc31714407525ec9c7e42c20a7c">HEVC_SEI_TYPE_TIME_CODE</a></div><div class="ttdeci">@ HEVC_SEI_TYPE_TIME_CODE</div><div class="ttdef"><b>Definition:</b> <a href="hevc__sei_8h_source.html#l00055">hevc_sei.h:55</a></div></div>
<div class="ttc" id="aavassert_8h_html"><div class="ttname"><a href="avassert_8h.html">avassert.h</a></div></div>
<div class="ttc" id="agroup__lavu__log__constants_html_gaffe151ff4cd8a24b2e77ac8d9616c85c"><div class="ttname"><a href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a></div><div class="ttdeci">#define AV_LOG_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="log_8h_source.html#l00194">log.h:194</a></div></div>
<div class="ttc" id="aattributes_8h_html_abeeb324fff79a5335d36774704e2475c"><div class="ttname"><a href="attributes_8h.html#abeeb324fff79a5335d36774704e2475c">av_cold</a></div><div class="ttdeci">#define av_cold</div><div class="ttdef"><b>Definition:</b> <a href="attributes_8h_source.html#l00090">attributes.h:90</a></div></div>
<div class="ttc" id="astruct_a_v_codec_context_html_a686a77363668795c15c87b532cc455fa"><div class="ttname"><a href="struct_a_v_codec_context.html#a686a77363668795c15c87b532cc455fa">AVCodecContext::has_b_frames</a></div><div class="ttdeci">int has_b_frames</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l00816">avcodec.h:816</a></div></div>
<div class="ttc" id="aavcodec_8h_html_af7a5858840ff5f2c70ae33a2cd1f4228"><div class="ttname"><a href="avcodec_8h.html#af7a5858840ff5f2c70ae33a2cd1f4228">FF_PROFILE_HEVC_MAIN</a></div><div class="ttdeci">#define FF_PROFILE_HEVC_MAIN</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l01947">avcodec.h:1947</a></div></div>
<div class="ttc" id="anvenc_8c_html_a211fecd71f07bcb4546dc1c3ac8375c0"><div class="ttname"><a href="nvenc_8c.html#a211fecd71f07bcb4546dc1c3ac8375c0">GUIDTuple</a></div><div class="ttdeci">struct GUIDTuple GUIDTuple</div></div>
<div class="ttc" id="astruct_a_v_codec_context_html_afe9b149e17b9e28823ab3cf9732b990d"><div class="ttname"><a href="struct_a_v_codec_context.html#afe9b149e17b9e28823ab3cf9732b990d">AVCodecContext::i_quant_offset</a></div><div class="ttdeci">float i_quant_offset</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l00838">avcodec.h:838</a></div></div>
<div class="ttc" id="apixfmt_8h_html_a9a8e335cf3be472042bc9f0cf80cd4c5ab2e2ccfaeec66c0a5f58ffdbe2e850f9"><div class="ttname"><a href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5ab2e2ccfaeec66c0a5f58ffdbe2e850f9">AV_PIX_FMT_YUVJ422P</a></div><div class="ttdeci">@ AV_PIX_FMT_YUVJ422P</div><div class="ttdoc">planar YUV 4:2:2, 16bpp, full scale (JPEG), deprecated in favor of AV_PIX_FMT_YUV422P and setting col...</div><div class="ttdef"><b>Definition:</b> <a href="pixfmt_8h_source.html#l00079">pixfmt.h:79</a></div></div>
<div class="ttc" id="anvenc_8c_html_a1561ceb78896b130d4926e8c83f417c1"><div class="ttname"><a href="nvenc_8c.html#a1561ceb78896b130d4926e8c83f417c1">ff_nvenc_encode_init</a></div><div class="ttdeci">av_cold int ff_nvenc_encode_init(AVCodecContext *avctx)</div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8c_source.html#l01629">nvenc.c:1629</a></div></div>
<div class="ttc" id="atests_2snowenc_8c_html_a667b04d7fb6ef46db4da4af554c5b6f7"><div class="ttname"><a href="tests_2snowenc_8c.html#a667b04d7fb6ef46db4da4af554c5b6f7">width</a></div><div class="ttdeci">#define width</div></div>
<div class="ttc" id="agroup__lavc__packet_html_gadfa708660b85a56749c753124de2da7d"><div class="ttname"><a href="group__lavc__packet.html#gadfa708660b85a56749c753124de2da7d">av_new_packet</a></div><div class="ttdeci">int av_new_packet(AVPacket *pkt, int size)</div><div class="ttdef"><b>Definition:</b> <a href="avpacket_8c_source.html#l00088">avpacket.c:88</a></div></div>
<div class="ttc" id="apixfmt_8h_html_ae7920607c5cf9a219cc94b5c7efc457d"><div class="ttname"><a href="pixfmt_8h.html#ae7920607c5cf9a219cc94b5c7efc457d">AV_PIX_FMT_YUV444P16</a></div><div class="ttdeci">#define AV_PIX_FMT_YUV444P16</div><div class="ttdef"><b>Definition:</b> <a href="pixfmt_8h_source.html#l00412">pixfmt.h:412</a></div></div>
<div class="ttc" id="apixfmt_8h_html_af3d101ef5e0fdb975f01a831daede80a"><div class="ttname"><a href="pixfmt_8h.html#af3d101ef5e0fdb975f01a831daede80a">AV_PIX_FMT_0BGR32</a></div><div class="ttdeci">#define AV_PIX_FMT_0BGR32</div><div class="ttdef"><b>Definition:</b> <a href="pixfmt_8h_source.html#l00377">pixfmt.h:377</a></div></div>
<div class="ttc" id="astruct_a_v_codec_internal_html_abbc05b0d9ed9a56e9b9b999eea2e940d"><div class="ttname"><a href="struct_a_v_codec_internal.html#abbc05b0d9ed9a56e9b9b999eea2e940d">AVCodecInternal::draining</a></div><div class="ttdeci">int draining</div><div class="ttdef"><b>Definition:</b> <a href="libavcodec_2internal_8h_source.html#l00174">internal.h:174</a></div></div>
<div class="ttc" id="astruct_a_v_codec_context_html_ab015db3b7fcd227193a7c17283914187"><div class="ttname"><a href="struct_a_v_codec_context.html#ab015db3b7fcd227193a7c17283914187">AVCodecContext::qmax</a></div><div class="ttdeci">int qmax</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l01375">avcodec.h:1375</a></div></div>
<div class="ttc" id="astruct_a_v_codec_context_html_a5252d34fbce300228d4dbda19a8c3293"><div class="ttname"><a href="struct_a_v_codec_context.html#a5252d34fbce300228d4dbda19a8c3293">AVCodecContext::sample_aspect_ratio</a></div><div class="ttdeci">AVRational sample_aspect_ratio</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l00905">avcodec.h:905</a></div></div>
<div class="ttc" id="atests_2movenc_8c_html_a93cc7296f13f507c1fd7abd0db36b898"><div class="ttname"><a href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a></div><div class="ttdeci">AVFormatContext * ctx</div><div class="ttdef"><b>Definition:</b> <a href="tests_2movenc_8c_source.html#l00048">movenc.c:48</a></div></div>
<div class="ttc" id="ademuxing__decoding_8c_html_a7331e302ea7bb48e0b605a069576e135"><div class="ttname"><a href="demuxing__decoding_8c.html#a7331e302ea7bb48e0b605a069576e135">pix_fmt</a></div><div class="ttdeci">static enum AVPixelFormat pix_fmt</div><div class="ttdef"><b>Definition:</b> <a href="demuxing__decoding_8c_source.html#l00039">demuxing_decoding.c:40</a></div></div>
<div class="ttc" id="astruct_a_v_packet_html_a73bde0a37f3b1efc839f11295bfbf42a"><div class="ttname"><a href="struct_a_v_packet.html#a73bde0a37f3b1efc839f11295bfbf42a">AVPacket::pts</a></div><div class="ttdeci">int64_t pts</div><div class="ttdef"><b>Definition:</b> <a href="packet_8h_source.html#l00356">packet.h:356</a></div></div>
<div class="ttc" id="anvenc_8c_html_a49cffae704078d7d011e5415bf758257"><div class="ttname"><a href="nvenc_8c.html#a49cffae704078d7d011e5415bf758257">nvenc_setup_extradata</a></div><div class="ttdeci">static av_cold int nvenc_setup_extradata(AVCodecContext *avctx)</div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8c_source.html#l01519">nvenc.c:1519</a></div></div>
<div class="ttc" id="anvenc_8c_html_a4ff7bc81361be5089bb0483bad599c4f"><div class="ttname"><a href="nvenc_8c.html#a4ff7bc81361be5089bb0483bad599c4f">timestamp_queue_enqueue</a></div><div class="ttdeci">static void timestamp_queue_enqueue(AVFifoBuffer *queue, int64_t timestamp)</div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8c_source.html#l01901">nvenc.c:1901</a></div></div>
<div class="ttc" id="anvenc_8h_html_a99fb83031ce9923c84392b4e92f956b5af728942133f27bd1900866d3db771796"><div class="ttname"><a href="nvenc_8h.html#a99fb83031ce9923c84392b4e92f956b5af728942133f27bd1900866d3db771796">NV_ENC_HEVC_PROFILE_MAIN_10</a></div><div class="ttdeci">@ NV_ENC_HEVC_PROFILE_MAIN_10</div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8h_source.html#l00128">nvenc.h:128</a></div></div>
<div class="ttc" id="apixfmt_8h_html_a9a8e335cf3be472042bc9f0cf80cd4c5a1aa7677092740d8def31655b5d7f0cc2"><div class="ttname"><a href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a1aa7677092740d8def31655b5d7f0cc2">AV_PIX_FMT_YUV420P</a></div><div class="ttdeci">@ AV_PIX_FMT_YUV420P</div><div class="ttdoc">planar YUV 4:2:0, 12bpp, (1 Cr &amp; Cb sample per 2x2 Y samples)</div><div class="ttdef"><b>Definition:</b> <a href="pixfmt_8h_source.html#l00066">pixfmt.h:66</a></div></div>
<div class="ttc" id="agroup__lavc__core_html_ggaadca229ad2c20e060a14fec08a5cc7cea3d4c051c8b18a3c18750676a308c10be"><div class="ttname"><a href="group__lavc__core.html#ggaadca229ad2c20e060a14fec08a5cc7cea3d4c051c8b18a3c18750676a308c10be">AV_CODEC_ID_H264</a></div><div class="ttdeci">@ AV_CODEC_ID_H264</div><div class="ttdef"><b>Definition:</b> <a href="codec__id_8h_source.html#l00076">codec_id.h:76</a></div></div>
<div class="ttc" id="apixfmt_8h_html_a9a8e335cf3be472042bc9f0cf80cd4c5ae21031dcb2dd7bc75c83ec1ac2c26157"><div class="ttname"><a href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5ae21031dcb2dd7bc75c83ec1ac2c26157">AV_PIX_FMT_YUVJ444P</a></div><div class="ttdeci">@ AV_PIX_FMT_YUVJ444P</div><div class="ttdoc">planar YUV 4:4:4, 24bpp, full scale (JPEG), deprecated in favor of AV_PIX_FMT_YUV444P and setting col...</div><div class="ttdef"><b>Definition:</b> <a href="pixfmt_8h_source.html#l00080">pixfmt.h:80</a></div></div>
<div class="ttc" id="afilter__design_8txt_html_a0e82f1088fdc24c14bf175d2ac77523f"><div class="ttname"><a href="filter__design_8txt.html#a0e82f1088fdc24c14bf175d2ac77523f">if</a></div><div class="ttdeci">if(ret)</div><div class="ttdef"><b>Definition:</b> <a href="filter__design_8txt_source.html#l00179">filter_design.txt:179</a></div></div>
<div class="ttc" id="astruct_nvenc_surface_html"><div class="ttname"><a href="struct_nvenc_surface.html">NvencSurface</a></div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8h_source.html#l00073">nvenc.h:74</a></div></div>
<div class="ttc" id="anvenc_8c_html_ab9c969896faddf6ab3f8153bea54bcf2"><div class="ttname"><a href="nvenc_8c.html#ab9c969896faddf6ab3f8153bea54bcf2">NVENC_CAP</a></div><div class="ttdeci">#define NVENC_CAP</div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8c_source.html#l00041">nvenc.c:41</a></div></div>
<div class="ttc" id="anvenc_8c_html_aa811025b0fbbeacacd640511c965212f"><div class="ttname"><a href="nvenc_8c.html#aa811025b0fbbeacacd640511c965212f">IS_10BIT</a></div><div class="ttdeci">#define IS_10BIT(pix_fmt)</div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8c_source.html#l00072">nvenc.c:72</a></div></div>
<div class="ttc" id="astruct_a_v_d3_d11_v_a_device_context_html_a846ae4cb1f91302845776cc843dc2808"><div class="ttname"><a href="struct_a_v_d3_d11_v_a_device_context.html#a846ae4cb1f91302845776cc843dc2808">AVD3D11VADeviceContext::device</a></div><div class="ttdeci">ID3D11Device * device</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__d3d11va_8h_source.html#l00056">hwcontext_d3d11va.h:56</a></div></div>
<div class="ttc" id="anvenc_8c_html_ab8f2578d01b92d41e0a9722ba7b1f36a"><div class="ttname"><a href="nvenc_8c.html#ab8f2578d01b92d41e0a9722ba7b1f36a">nvenc_setup_rate_control</a></div><div class="ttdeci">static av_cold void nvenc_setup_rate_control(AVCodecContext *avctx)</div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8c_source.html#l00879">nvenc.c:879</a></div></div>
<div class="ttc" id="astruct_a_v_packet_html_a437be96a9da675f12caa228a9c81bd82"><div class="ttname"><a href="struct_a_v_packet.html#a437be96a9da675f12caa228a9c81bd82">AVPacket::flags</a></div><div class="ttdeci">int flags</div><div class="ttdef"><b>Definition:</b> <a href="packet_8h_source.html#l00369">packet.h:369</a></div></div>
<div class="ttc" id="acuda__runtime_8h_html_a7a87cd25426a228ce8ecbef48ab00de8"><div class="ttname"><a href="cuda__runtime_8h.html#a7a87cd25426a228ce8ecbef48ab00de8">fabs</a></div><div class="ttdeci">static __device__ float fabs(float a)</div><div class="ttdef"><b>Definition:</b> <a href="cuda__runtime_8h_source.html#l00182">cuda_runtime.h:182</a></div></div>
<div class="ttc" id="aaacdec__template_8c_html_affa0ccbe2ef7fd24bb8c61e28d1a6631"><div class="ttname"><a href="aacdec__template_8c.html#affa0ccbe2ef7fd24bb8c61e28d1a6631">flush</a></div><div class="ttdeci">static void flush(AVCodecContext *avctx)</div><div class="ttdef"><b>Definition:</b> <a href="aacdec__template_8c_source.html#l00592">aacdec_template.c:592</a></div></div>
<div class="ttc" id="acoverity_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="coverity_8c_source.html#l00032">coverity.c:32</a></div></div>
<div class="ttc" id="astruct_a_v_h_w_frames_context_html"><div class="ttname"><a href="struct_a_v_h_w_frames_context.html">AVHWFramesContext</a></div><div class="ttdef"><b>Definition:</b> <a href="hwcontext_8h_source.html#l00124">hwcontext.h:124</a></div></div>
<div class="ttc" id="apixfmt_8h_html_a9a8e335cf3be472042bc9f0cf80cd4c5aef61d7a65003ef618420f618294107b0"><div class="ttname"><a href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5aef61d7a65003ef618420f618294107b0">AV_PIX_FMT_YUVJ420P</a></div><div class="ttdeci">@ AV_PIX_FMT_YUVJ420P</div><div class="ttdoc">planar YUV 4:2:0, 12bpp, full scale (JPEG), deprecated in favor of AV_PIX_FMT_YUV420P and setting col...</div><div class="ttdef"><b>Definition:</b> <a href="pixfmt_8h_source.html#l00078">pixfmt.h:78</a></div></div>
<div class="ttc" id="anvenc_8c_html_abbc0a5b2669e4998bebe51f8fe835b9a"><div class="ttname"><a href="nvenc_8c.html#abbc0a5b2669e4998bebe51f8fe835b9a">ff_nvenc_encode_close</a></div><div class="ttdeci">av_cold int ff_nvenc_encode_close(AVCodecContext *avctx)</div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8c_source.html#l01552">nvenc.c:1552</a></div></div>
<div class="ttc" id="agroup__lavu__picture_html_ggae6cbcab1f70d8e476757f1c1f5a0a78ea02be39f151a8ace7a65c86e13053e817"><div class="ttname"><a href="group__lavu__picture.html#ggae6cbcab1f70d8e476757f1c1f5a0a78ea02be39f151a8ace7a65c86e13053e817">AV_PICTURE_TYPE_I</a></div><div class="ttdeci">@ AV_PICTURE_TYPE_I</div><div class="ttdoc">Intra.</div><div class="ttdef"><b>Definition:</b> <a href="avutil_8h_source.html#l00274">avutil.h:274</a></div></div>
<div class="ttc" id="aavcodec_8h_html_aaf015040dda97fac08a56ddbd1dd1e31"><div class="ttname"><a href="avcodec_8h.html#aaf015040dda97fac08a56ddbd1dd1e31">FF_PROFILE_HEVC_MAIN_10</a></div><div class="ttdeci">#define FF_PROFILE_HEVC_MAIN_10</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l01948">avcodec.h:1948</a></div></div>
<div class="ttc" id="anvenc_8c_html_ae3125db28c17e482df85e0e25006131b"><div class="ttname"><a href="nvenc_8c.html#ae3125db28c17e482df85e0e25006131b">nvenc_setup_h264_config</a></div><div class="ttdeci">static av_cold int nvenc_setup_h264_config(AVCodecContext *avctx)</div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8c_source.html#l01024">nvenc.c:1024</a></div></div>
<div class="ttc" id="astruct_a_v_d3_d11_v_a_device_context_html"><div class="ttname"><a href="struct_a_v_d3_d11_v_a_device_context.html">AVD3D11VADeviceContext</a></div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__d3d11va_8h_source.html#l00045">hwcontext_d3d11va.h:45</a></div></div>
<div class="ttc" id="astruct_a_v_c_p_b_properties_html_a920910dd19158348cb35fc576929bfd1"><div class="ttname"><a href="struct_a_v_c_p_b_properties.html#a920910dd19158348cb35fc576929bfd1">AVCPBProperties::max_bitrate</a></div><div class="ttdeci">int max_bitrate</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l00454">avcodec.h:454</a></div></div>
<div class="ttc" id="anamespaceconvert__header_html_ac8d67a61fdde2fcdd4358f78109f4b7a"><div class="ttname"><a href="namespaceconvert__header.html#ac8d67a61fdde2fcdd4358f78109f4b7a">convert_header.major</a></div><div class="ttdeci">int major</div><div class="ttdef"><b>Definition:</b> <a href="convert__header_8py_source.html#l00023">convert_header.py:23</a></div></div>
<div class="ttc" id="astruct_a_v_c_p_b_properties_html_a128a4f2eda5bfa38c6b21195f310b116"><div class="ttname"><a href="struct_a_v_c_p_b_properties.html#a128a4f2eda5bfa38c6b21195f310b116">AVCPBProperties::avg_bitrate</a></div><div class="ttdeci">int avg_bitrate</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l00472">avcodec.h:472</a></div></div>
<div class="ttc" id="anvenc_8h_html_adf764cbdea00d65edcd07bb9953ad2b7a9b83cafeb7120787098cace6d9b96c94"><div class="ttname"><a href="nvenc_8h.html#adf764cbdea00d65edcd07bb9953ad2b7a9b83cafeb7120787098cace6d9b96c94">NV_ENC_H264_PROFILE_HIGH_444P</a></div><div class="ttdeci">@ NV_ENC_H264_PROFILE_HIGH_444P</div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8h_source.html#l00123">nvenc.h:123</a></div></div>
<div class="ttc" id="astruct_a_v_c_p_b_properties_html_a7a4517f685b5a1976080fe536860c86a"><div class="ttname"><a href="struct_a_v_c_p_b_properties.html#a7a4517f685b5a1976080fe536860c86a">AVCPBProperties::buffer_size</a></div><div class="ttdeci">int buffer_size</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l00481">avcodec.h:481</a></div></div>
<div class="ttc" id="ah264pred__template_8c_html_a93cca9adbbca82ea00bf3250781f6dce"><div class="ttname"><a href="h264pred__template_8c.html#a93cca9adbbca82ea00bf3250781f6dce">for</a></div><div class="ttdeci">for(j=16;j &gt;0;--j)</div><div class="ttdef"><b>Definition:</b> <a href="h264pred__template_8c_source.html#l00469">h264pred_template.c:469</a></div></div>
<div class="ttc" id="astruct_nvenc_surface_html_a5d57300593a94bf92a7858a00fe57d26"><div class="ttname"><a href="struct_nvenc_surface.html#a5d57300593a94bf92a7858a00fe57d26">NvencSurface::format</a></div><div class="ttdeci">NV_ENC_BUFFER_FORMAT format</div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8h_source.html#l00083">nvenc.h:83</a></div></div>
<div class="ttc" id="astruct_a_v_codec_context_html_a7abe7095de73df98df4895bf9e25fc6b"><div class="ttname"><a href="struct_a_v_codec_context.html#a7abe7095de73df98df4895bf9e25fc6b">AVCodecContext::profile</a></div><div class="ttdeci">int profile</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l01859">avcodec.h:1859</a></div></div>
<div class="ttc" id="agroup__lavu__mem__funcs_html_gaf143ecab33a3868b57345466c39de7c1"><div class="ttname"><a href="group__lavu__mem__funcs.html#gaf143ecab33a3868b57345466c39de7c1">av_mallocz</a></div><div class="ttdeci">void * av_mallocz(size_t size)</div><div class="ttdef"><b>Definition:</b> <a href="mem_8c_source.html#l00237">mem.c:237</a></div></div>
<div class="ttc" id="astruct_nvenc_dyn_load_functions_html_abb541819aaaf75f51f9c2c23f674de94"><div class="ttname"><a href="struct_nvenc_dyn_load_functions.html#abb541819aaaf75f51f9c2c23f674de94">NvencDynLoadFunctions::nvenc_funcs</a></div><div class="ttdeci">NV_ENCODE_API_FUNCTION_LIST nvenc_funcs</div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8h_source.html#l00091">nvenc.h:91</a></div></div>
<div class="ttc" id="anvenc_8c_html_a710bce51374aba96ab04912897666c35"><div class="ttname"><a href="nvenc_8c.html#a710bce51374aba96ab04912897666c35">desc</a></div><div class="ttdeci">const char * desc</div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8c_source.html#l00082">nvenc.c:82</a></div></div>
<div class="ttc" id="anvenc_8c_html_ad2d50f7855c51659e8df21a154b26577"><div class="ttname"><a href="nvenc_8c.html#ad2d50f7855c51659e8df21a154b26577">nvenc_pop_context</a></div><div class="ttdeci">static int nvenc_pop_context(AVCodecContext *avctx)</div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8c_source.html#l00252">nvenc.c:252</a></div></div>
<div class="ttc" id="ahwconfig_8h_html_a63e6dde7eab6be3a7da254f49ffe5d0d"><div class="ttname"><a href="hwconfig_8h.html#a63e6dde7eab6be3a7da254f49ffe5d0d">HW_CONFIG_ENCODER_DEVICE</a></div><div class="ttdeci">#define HW_CONFIG_ENCODER_DEVICE(format, device_type_)</div><div class="ttdef"><b>Definition:</b> <a href="hwconfig_8h_source.html#l00096">hwconfig.h:96</a></div></div>
<div class="ttc" id="astruct_a_v_codec_context_html_a40a7fdf60f853d9140bbe1204a66efb2"><div class="ttname"><a href="struct_a_v_codec_context.html#a40a7fdf60f853d9140bbe1204a66efb2">AVCodecContext::b_quant_factor</a></div><div class="ttdeci">float b_quant_factor</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l00795">avcodec.h:795</a></div></div>
<div class="ttc" id="astruct_nvenc_surface_html_a7524fe6d22859c6c8537ffd89c6c9fe3"><div class="ttname"><a href="struct_nvenc_surface.html#a7524fe6d22859c6c8537ffd89c6c9fe3">NvencSurface::reg_idx</a></div><div class="ttdeci">int reg_idx</div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8h_source.html#l00077">nvenc.h:77</a></div></div>
<div class="ttc" id="agroup__lavu__frame_html_ga88b0ecbc4eb3453eef3fbefa3bddeb7c"><div class="ttname"><a href="group__lavu__frame.html#ga88b0ecbc4eb3453eef3fbefa3bddeb7c">av_frame_ref</a></div><div class="ttdeci">int av_frame_ref(AVFrame *dst, const AVFrame *src)</div><div class="ttdef"><b>Definition:</b> <a href="frame_8c_source.html#l00443">frame.c:443</a></div></div>
<div class="ttc" id="anvenc_8c_html_ac72a8499f99a33d19cc60b5e15aeb6d4"><div class="ttname"><a href="nvenc_8c.html#ac72a8499f99a33d19cc60b5e15aeb6d4">nvenc_check_codec_support</a></div><div class="ttdeci">static int nvenc_check_codec_support(AVCodecContext *avctx)</div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8c_source.html#l00290">nvenc.c:290</a></div></div>
<div class="ttc" id="anvenc_8c_html_a46da6bbf53a3b19ef1762a8aa16c19fc"><div class="ttname"><a href="nvenc_8c.html#a46da6bbf53a3b19ef1762a8aa16c19fc">ff_nvenc_hw_configs</a></div><div class="ttdeci">const AVCodecHWConfigInternal *const ff_nvenc_hw_configs[]</div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8c_source.html#l00062">nvenc.c:62</a></div></div>
<div class="ttc" id="anvenc_8h_html_ad1bcbc391302c678a37eb03dd5e49ea7"><div class="ttname"><a href="nvenc_8h.html#ad1bcbc391302c678a37eb03dd5e49ea7">MAX_REGISTERED_FRAMES</a></div><div class="ttdeci">#define MAX_REGISTERED_FRAMES</div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8h_source.html#l00040">nvenc.h:40</a></div></div>
<div class="ttc" id="alibavcodec_2internal_8h_html_ab6089c632fa67edd08225cb3a83086a9"><div class="ttname"><a href="libavcodec_2internal_8h.html#ab6089c632fa67edd08225cb3a83086a9">ff_alloc_timecode_sei</a></div><div class="ttdeci">int ff_alloc_timecode_sei(const AVFrame *frame, AVRational rate, size_t prefix_len, void **data, size_t *sei_size)</div><div class="ttdef"><b>Definition:</b> <a href="libavcodec_2utils_8c_source.html#l02218">utils.c:2218</a></div></div>
<div class="ttc" id="acommon_8h_html_a9960bd6780a9b16a216a57be1ee04359"><div class="ttname"><a href="common_8h.html#a9960bd6780a9b16a216a57be1ee04359">FFMAX</a></div><div class="ttdeci">#define FFMAX(a, b)</div><div class="ttdef"><b>Definition:</b> <a href="common_8h_source.html#l00094">common.h:94</a></div></div>
<div class="ttc" id="anvenc_8c_html_aace48cf2fe4a15ea60fece06bb02320d"><div class="ttname"><a href="nvenc_8c.html#aace48cf2fe4a15ea60fece06bb02320d">nvenc_alloc_surface</a></div><div class="ttdeci">static av_cold int nvenc_alloc_surface(AVCodecContext *avctx, int idx)</div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8c_source.html#l01422">nvenc.c:1422</a></div></div>
<div class="ttc" id="astruct_a_v_codec_html_a01a53d07936f4c7ee280444793b6967b"><div class="ttname"><a href="struct_a_v_codec.html#a01a53d07936f4c7ee280444793b6967b">AVCodec::id</a></div><div class="ttdeci">enum AVCodecID id</div><div class="ttdef"><b>Definition:</b> <a href="codec_8h_source.html#l00202">codec.h:204</a></div></div>
<div class="ttc" id="agroup__lavu__time_html_ga2eaefe702f95f619ea6f2d08afa01be1"><div class="ttname"><a href="group__lavu__time.html#ga2eaefe702f95f619ea6f2d08afa01be1">AV_NOPTS_VALUE</a></div><div class="ttdeci">#define AV_NOPTS_VALUE</div><div class="ttdoc">Undefined timestamp value.</div><div class="ttdef"><b>Definition:</b> <a href="avutil_8h_source.html#l00248">avutil.h:248</a></div></div>
<div class="ttc" id="astruct_nvenc_dyn_load_functions_html_a801dc578eedece0a47492f092fd2dfbf"><div class="ttname"><a href="struct_nvenc_dyn_load_functions.html#a801dc578eedece0a47492f092fd2dfbf">NvencDynLoadFunctions::cuda_dl</a></div><div class="ttdeci">CudaFunctions * cuda_dl</div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8h_source.html#l00088">nvenc.h:88</a></div></div>
<div class="ttc" id="astruct_a_v_codec_context_html_a4d08b297e97eefd66c714df4fff493c8"><div class="ttname"><a href="struct_a_v_codec_context.html#a4d08b297e97eefd66c714df4fff493c8">AVCodecContext::framerate</a></div><div class="ttdeci">AVRational framerate</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l02069">avcodec.h:2069</a></div></div>
<div class="ttc" id="astruct_g_u_i_d_tuple_html_af518fadff4c85736ecfcc2eeaac279f0"><div class="ttname"><a href="struct_g_u_i_d_tuple.html#af518fadff4c85736ecfcc2eeaac279f0">GUIDTuple::flags</a></div><div class="ttdeci">int flags</div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8c_source.html#l00643">nvenc.c:643</a></div></div>
<div class="ttc" id="astruct_a_v_codec_context_html_a0d8f46461754e8abea0847dcbc41b956"><div class="ttname"><a href="struct_a_v_codec_context.html#a0d8f46461754e8abea0847dcbc41b956">AVCodecContext::width</a></div><div class="ttdeci">int width</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l00699">avcodec.h:699</a></div></div>
<div class="ttc" id="anvenc_8c_html_a197d7024cb640b208160801121977be7"><div class="ttname"><a href="nvenc_8c.html#a197d7024cb640b208160801121977be7">nvenc_check_device</a></div><div class="ttdeci">static av_cold int nvenc_check_device(AVCodecContext *avctx, int idx)</div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8c_source.html#l00460">nvenc.c:460</a></div></div>
<div class="ttc" id="astruct_a_v_codec_context_html_abb01e291550fa3fb96188af4d494587e"><div class="ttname"><a href="struct_a_v_codec_context.html#abb01e291550fa3fb96188af4d494587e">AVCodecContext::flags</a></div><div class="ttdeci">int flags</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l00606">avcodec.h:606</a></div></div>
<div class="ttc" id="astruct_a_v_packet_html_a85dbbd306b44b02390cd91c45e6a0f76"><div class="ttname"><a href="struct_a_v_packet.html#a85dbbd306b44b02390cd91c45e6a0f76">AVPacket::dts</a></div><div class="ttdeci">int64_t dts</div><div class="ttdef"><b>Definition:</b> <a href="packet_8h_source.html#l00362">packet.h:362</a></div></div>
<div class="ttc" id="astruct_a_v_codec_context_html_ab7bfeb9fa5840aac090e2b0bd0ef7589"><div class="ttname"><a href="struct_a_v_codec_context.html#ab7bfeb9fa5840aac090e2b0bd0ef7589">AVCodecContext::time_base</a></div><div class="ttdeci">AVRational time_base</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l00649">avcodec.h:649</a></div></div>
<div class="ttc" id="anvenc_8c_html_a3848440935c68dd375ff460e2b11d76c"><div class="ttname"><a href="nvenc_8c.html#a3848440935c68dd375ff460e2b11d76c">nvenc_register_frame</a></div><div class="ttdeci">static int nvenc_register_frame(AVCodecContext *avctx, const AVFrame *frame)</div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8c_source.html#l01752">nvenc.c:1752</a></div></div>
<div class="ttc" id="astruct_a_v_codec_context_html_acf8113e490f9e7b57465e65af9c0c75c"><div class="ttname"><a href="struct_a_v_codec_context.html#acf8113e490f9e7b57465e65af9c0c75c">AVCodecContext::hw_device_ctx</a></div><div class="ttdeci">AVBufferRef * hw_device_ctx</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l02278">avcodec.h:2278</a></div></div>
<div class="ttc" id="anvenc_8c_html_a1b190f75155ffdf3a33ddfbb02568b62"><div class="ttname"><a href="nvenc_8c.html#a1b190f75155ffdf3a33ddfbb02568b62">ff_nvenc_receive_packet</a></div><div class="ttdeci">int ff_nvenc_receive_packet(AVCodecContext *avctx, AVPacket *pkt)</div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8c_source.html#l02294">nvenc.c:2294</a></div></div>
<div class="ttc" id="atests_2snowenc_8c_html_a64f9f90ece96c7bab4aee3deacf170e0"><div class="ttname"><a href="tests_2snowenc_8c.html#a64f9f90ece96c7bab4aee3deacf170e0">height</a></div><div class="ttdeci">#define height</div></div>
<div class="ttc" id="acommon_8h_html_a0f84cbd7fd810cd678157c98cbfad4b0"><div class="ttname"><a href="common_8h.html#a0f84cbd7fd810cd678157c98cbfad4b0">FFMIN</a></div><div class="ttdeci">#define FFMIN(a, b)</div><div class="ttdef"><b>Definition:</b> <a href="common_8h_source.html#l00096">common.h:96</a></div></div>
<div class="ttc" id="anvenc_8c_html_a002b1b6f6b27c1de24105fd1d4223da1"><div class="ttname"><a href="nvenc_8c.html#a002b1b6f6b27c1de24105fd1d4223da1">nvenc_override_rate_control</a></div><div class="ttdeci">static void nvenc_override_rate_control(AVCodecContext *avctx)</div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8c_source.html#l00809">nvenc.c:809</a></div></div>
<div class="ttc" id="amem_8c_html_aedc3761897b7e9ea8ae1222b3d013c94"><div class="ttname"><a href="mem_8c.html#aedc3761897b7e9ea8ae1222b3d013c94">av_mallocz_array</a></div><div class="ttdeci">void * av_mallocz_array(size_t nmemb, size_t size)</div><div class="ttdef"><b>Definition:</b> <a href="mem_8c_source.html#l00190">mem.c:190</a></div></div>
<div class="ttc" id="agroup__lavu__error_html_ga9c520e483ba8648495620ffdb4c491f2"><div class="ttname"><a href="group__lavu__error.html#ga9c520e483ba8648495620ffdb4c491f2">AVERROR_EXTERNAL</a></div><div class="ttdeci">#define AVERROR_EXTERNAL</div><div class="ttdoc">Generic error in an external library.</div><div class="ttdef"><b>Definition:</b> <a href="error_8h_source.html#l00057">error.h:57</a></div></div>
<div class="ttc" id="apixfmt_8h_html_a9a8e335cf3be472042bc9f0cf80cd4c5a8cfd0b36308fa1ad3522ef8815ccbd0a"><div class="ttname"><a href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a8cfd0b36308fa1ad3522ef8815ccbd0a">AV_PIX_FMT_D3D11</a></div><div class="ttdeci">@ AV_PIX_FMT_D3D11</div><div class="ttdef"><b>Definition:</b> <a href="pixfmt_8h_source.html#l00313">pixfmt.h:313</a></div></div>
<div class="ttc" id="astruct_a_v_c_u_d_a_device_context_html_ae8f68056b89cd0c541d665600bf515f8"><div class="ttname"><a href="struct_a_v_c_u_d_a_device_context.html#ae8f68056b89cd0c541d665600bf515f8">AVCUDADeviceContext::stream</a></div><div class="ttdeci">CUstream stream</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__cuda_8h_source.html#l00044">hwcontext_cuda.h:44</a></div></div>
<div class="ttc" id="astruct_nvenc_dyn_load_functions_html_a79079d6464c9f18004898ebaf72a07d8"><div class="ttname"><a href="struct_nvenc_dyn_load_functions.html#a79079d6464c9f18004898ebaf72a07d8">NvencDynLoadFunctions::nvenc_device_count</a></div><div class="ttdeci">int nvenc_device_count</div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8h_source.html#l00092">nvenc.h:92</a></div></div>
<div class="ttc" id="astruct_a_v_codec_context_html_aa2b5582f1a360534310b686cc3f7c668"><div class="ttname"><a href="struct_a_v_codec_context.html#aa2b5582f1a360534310b686cc3f7c668">AVCodecContext::rc_max_rate</a></div><div class="ttdeci">int64_t rc_max_rate</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l01404">avcodec.h:1404</a></div></div>
<div class="ttc" id="anvenc_8c_html_aeae10f623a8eb7cd95caf0bebe58183a"><div class="ttname"><a href="nvenc_8c.html#aeae10f623a8eb7cd95caf0bebe58183a">get_free_frame</a></div><div class="ttdeci">static NvencSurface * get_free_frame(NvencContext *ctx)</div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8c_source.html#l01676">nvenc.c:1676</a></div></div>
<div class="ttc" id="agroup__lavu__log__constants_html_gad172eacfed8653e454c6fdcbe53baab3"><div class="ttname"><a href="group__lavu__log__constants.html#gad172eacfed8653e454c6fdcbe53baab3">AV_LOG_INFO</a></div><div class="ttdeci">#define AV_LOG_INFO</div><div class="ttdef"><b>Definition:</b> <a href="log_8h_source.html#l00205">log.h:205</a></div></div>
<div class="ttc" id="anvenc_8c_html_a9bb7a5dcc832adb060e92e25976389ec"><div class="ttname"><a href="nvenc_8c.html#a9bb7a5dcc832adb060e92e25976389ec">nvenc_open_session</a></div><div class="ttdeci">static av_cold int nvenc_open_session(AVCodecContext *avctx)</div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8c_source.html#l00264">nvenc.c:264</a></div></div>
<div class="ttc" id="ahwconfig_8h_html_a67594da711e5397d009cef8b48cd8001"><div class="ttname"><a href="hwconfig_8h.html#a67594da711e5397d009cef8b48cd8001">HW_CONFIG_ENCODER_FRAMES</a></div><div class="ttdeci">#define HW_CONFIG_ENCODER_FRAMES(format, device_type_)</div><div class="ttdef"><b>Definition:</b> <a href="hwconfig_8h_source.html#l00099">hwconfig.h:99</a></div></div>
<div class="ttc" id="anamespaceconvert__header_html_afbbd9db93850ca44e2f56ebb00ce0e0c"><div class="ttname"><a href="namespaceconvert__header.html#afbbd9db93850ca44e2f56ebb00ce0e0c">convert_header.minor</a></div><div class="ttdeci">int minor</div><div class="ttdef"><b>Definition:</b> <a href="convert__header_8py_source.html#l00026">convert_header.py:26</a></div></div>
<div class="ttc" id="ainput_8c_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="input_8c_source.html#l00407">input.c:407</a></div></div>
<div class="ttc" id="anvenc_8c_html_a33fde0355c86734e53646b87a27d91ea"><div class="ttname"><a href="nvenc_8c.html#a33fde0355c86734e53646b87a27d91ea">process_output_surface</a></div><div class="ttdeci">static int process_output_surface(AVCodecContext *avctx, AVPacket *pkt, NvencSurface *tmpoutsurf)</div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8c_source.html#l01929">nvenc.c:1929</a></div></div>
<div class="ttc" id="alibavutil_2internal_8h_html"><div class="ttname"><a href="libavutil_2internal_8h.html">internal.h</a></div></div>
<div class="ttc" id="anvenc_8c_html_a0c2527be99411c653118f3d8a7bdadbd"><div class="ttname"><a href="nvenc_8c.html#a0c2527be99411c653118f3d8a7bdadbd">nvenc_load_libraries</a></div><div class="ttdeci">static av_cold int nvenc_load_libraries(AVCodecContext *avctx)</div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8c_source.html#l00197">nvenc.c:197</a></div></div>
<div class="ttc" id="anvenc_8c_html_a408e6d9cd5e7265a9862520e562462ec"><div class="ttname"><a href="nvenc_8c.html#a408e6d9cd5e7265a9862520e562462ec">nvenc_recalc_surfaces</a></div><div class="ttdeci">static av_cold int nvenc_recalc_surfaces(AVCodecContext *avctx)</div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8c_source.html#l00840">nvenc.c:840</a></div></div>
<div class="ttc" id="agroup__lavc__core_html_ggaadca229ad2c20e060a14fec08a5cc7ceaa3e19a45b81bb602a4a37a4221274a20"><div class="ttname"><a href="group__lavc__core.html#ggaadca229ad2c20e060a14fec08a5cc7ceaa3e19a45b81bb602a4a37a4221274a20">AV_CODEC_ID_HEVC</a></div><div class="ttdeci">@ AV_CODEC_ID_HEVC</div><div class="ttdef"><b>Definition:</b> <a href="codec__id_8h_source.html#l00223">codec_id.h:223</a></div></div>
<div class="ttc" id="acbs__av1_8c_html_a1ff781bc4368127725d8bb494f615fb3"><div class="ttname"><a href="cbs__av1_8c.html#a1ff781bc4368127725d8bb494f615fb3">xf</a></div><div class="ttdeci">#define xf(width, name, var, range_min, range_max, subs,...)</div><div class="ttdef"><b>Definition:</b> <a href="cbs__av1_8c_source.html#l00663">cbs_av1.c:663</a></div></div>
<div class="ttc" id="aaudio__convert_8c_html_ae1affc9ca37cfb624959c866a73f83c2"><div class="ttname"><a href="audio__convert_8c.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a></div><div class="ttdeci">uint8_t</div><div class="ttdef"><b>Definition:</b> <a href="audio__convert_8c_source.html#l00194">audio_convert.c:194</a></div></div>
<div class="ttc" id="agroup__lavu__frame_html_ga0a2b687f9c1c5ed0089b01fd61227108"><div class="ttname"><a href="group__lavu__frame.html#ga0a2b687f9c1c5ed0089b01fd61227108">av_frame_unref</a></div><div class="ttdeci">void av_frame_unref(AVFrame *frame)</div><div class="ttdef"><b>Definition:</b> <a href="frame_8c_source.html#l00553">frame.c:553</a></div></div>
<div class="ttc" id="anvenc_8c_html_a4283d2a341ed469ecbb452243fd148a7"><div class="ttname"><a href="nvenc_8c.html#a4283d2a341ed469ecbb452243fd148a7">IS_YUV444</a></div><div class="ttdeci">#define IS_YUV444(pix_fmt)</div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8c_source.html#l00076">nvenc.c:76</a></div></div>
<div class="ttc" id="acavsdsp_8c_html_ae00a52dba55d31948c377fa85d385b87"><div class="ttname"><a href="cavsdsp_8c.html#ae00a52dba55d31948c377fa85d385b87">P2</a></div><div class="ttdeci">#define P2</div><div class="ttdef"><b>Definition:</b> <a href="cavsdsp_8c_source.html#l00038">cavsdsp.c:38</a></div></div>
<div class="ttc" id="anvenc_8c_html_ab0f7f7ce226b631569310a06829ab957"><div class="ttname"><a href="nvenc_8c.html#ab0f7f7ce226b631569310a06829ab957">IS_CBR</a></div><div class="ttdeci">#define IS_CBR(rc)</div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8c_source.html#l00042">nvenc.c:42</a></div></div>
<div class="ttc" id="anvenc_8c_html_aabb147a1f2a98d37cb3ce0dd6d50b78d"><div class="ttname"><a href="nvenc_8c.html#aabb147a1f2a98d37cb3ce0dd6d50b78d">CHECK_CU</a></div><div class="ttdeci">#define CHECK_CU(x)</div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8c_source.html#l00039">nvenc.c:39</a></div></div>
<div class="ttc" id="anvenc_8c_html_a59c1f19ef585ad224635e83697b77a54"><div class="ttname"><a href="nvenc_8c.html#a59c1f19ef585ad224635e83697b77a54">nvenc_map_buffer_format</a></div><div class="ttdeci">static NV_ENC_BUFFER_FORMAT nvenc_map_buffer_format(enum AVPixelFormat pix_fmt)</div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8c_source.html#l01399">nvenc.c:1399</a></div></div>
<div class="ttc" id="anvenc_8h_html_abc6126af1d45847bc59afa0aa3216b04a8e24acb32cbb33c5ef00164edd4973fb"><div class="ttname"><a href="nvenc_8h.html#abc6126af1d45847bc59afa0aa3216b04a8e24acb32cbb33c5ef00164edd4973fb">NVENC_TWO_PASSES</a></div><div class="ttdeci">@ NVENC_TWO_PASSES</div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8h_source.html#l00136">nvenc.h:136</a></div></div>
<div class="ttc" id="apixfmt_8h_html_a6506505b35c1afd66c10cd537369cdd6"><div class="ttname"><a href="pixfmt_8h.html#a6506505b35c1afd66c10cd537369cdd6">AV_PIX_FMT_P016</a></div><div class="ttdeci">#define AV_PIX_FMT_P016</div><div class="ttdef"><b>Definition:</b> <a href="pixfmt_8h_source.html#l00449">pixfmt.h:449</a></div></div>
<div class="ttc" id="astruct_a_v_codec_context_html_aef7017818f06f053f2e63fe759b30eb1"><div class="ttname"><a href="struct_a_v_codec_context.html#aef7017818f06f053f2e63fe759b30eb1">AVCodecContext::i_quant_factor</a></div><div class="ttdeci">float i_quant_factor</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l00831">avcodec.h:831</a></div></div>
<div class="ttc" id="astruct_a_v_c_u_d_a_device_context_html_ace8e7f76355f4120e33dd4488e26e96d"><div class="ttname"><a href="struct_a_v_c_u_d_a_device_context.html#ace8e7f76355f4120e33dd4488e26e96d">AVCUDADeviceContext::cuda_ctx</a></div><div class="ttdeci">CUcontext cuda_ctx</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__cuda_8h_source.html#l00043">hwcontext_cuda.h:43</a></div></div>
<div class="ttc" id="afilter__design_8txt_html_af1ec77bdca1b30e8153fc5da88f603db"><div class="ttname"><a href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a></div><div class="ttdeci">ret</div><div class="ttdef"><b>Definition:</b> <a href="filter__design_8txt_source.html#l00187">filter_design.txt:187</a></div></div>
<div class="ttc" id="agroup__lavu__log__constants_html_ga96970a2980bf6ad28cd403e7dc52d6c5"><div class="ttname"><a href="group__lavu__log__constants.html#ga96970a2980bf6ad28cd403e7dc52d6c5">AV_LOG_FATAL</a></div><div class="ttdeci">#define AV_LOG_FATAL</div><div class="ttdef"><b>Definition:</b> <a href="log_8h_source.html#l00188">log.h:188</a></div></div>
<div class="ttc" id="anvenc_8h_html_abc6126af1d45847bc59afa0aa3216b04afee116105aa3a30a9b28ca6281905925"><div class="ttname"><a href="nvenc_8h.html#abc6126af1d45847bc59afa0aa3216b04afee116105aa3a30a9b28ca6281905925">NVENC_ONE_PASS</a></div><div class="ttdeci">@ NVENC_ONE_PASS</div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8h_source.html#l00135">nvenc.h:135</a></div></div>
<div class="ttc" id="anvenc_8c_html_aede3a6e6b207b59d46698897b7cf4109"><div class="ttname"><a href="nvenc_8c.html#aede3a6e6b207b59d46698897b7cf4109">nvenc_setup_encoder</a></div><div class="ttdeci">static av_cold int nvenc_setup_encoder(AVCodecContext *avctx)</div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8c_source.html#l01237">nvenc.c:1237</a></div></div>
<div class="ttc" id="astruct_nvenc_surface_html_a2ce57b71bd6be846eb48a8581ecd5984"><div class="ttname"><a href="struct_nvenc_surface.html#a2ce57b71bd6be846eb48a8581ecd5984">NvencSurface::width</a></div><div class="ttdeci">int width</div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8h_source.html#l00078">nvenc.h:78</a></div></div>
<div class="ttc" id="apixfmt_8h_html_a9a8e335cf3be472042bc9f0cf80cd4c5a0b271df0acd125218c1e365a0f754022"><div class="ttname"><a href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a0b271df0acd125218c1e365a0f754022">AV_PIX_FMT_NV12</a></div><div class="ttdeci">@ AV_PIX_FMT_NV12</div><div class="ttdoc">planar YUV 4:2:0, 12bpp, 1 plane for Y and 1 plane for the UV components, which are interleaved (firs...</div><div class="ttdef"><b>Definition:</b> <a href="pixfmt_8h_source.html#l00089">pixfmt.h:89</a></div></div>
<div class="ttc" id="afilter__design_8txt_html_a48ad71a5b40cdd5f23c601f33665a953"><div class="ttname"><a href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a></div><div class="ttdeci">these buffered frames must be flushed immediately if a new input produces new the filter must not call request_frame to get more It must just process the frame or queue it The task of requesting more frames is left to the filter s request_frame method or the application If a filter has several the filter must be ready for frames arriving randomly on any input any filter with several inputs will most likely require some kind of queuing mechanism It is perfectly acceptable to have a limited queue and to drop frames when the inputs are too unbalanced request_frame For filters that do not use the this method is called when a frame is wanted on an output For a it should directly call filter_frame on the corresponding output For a if there are queued frames already one of these frames should be pushed If the filter should request a frame on one of its repeatedly until at least one frame has been pushed Return or at least make progress towards producing a frame</div><div class="ttdef"><b>Definition:</b> <a href="filter__design_8txt_source.html#l00264">filter_design.txt:264</a></div></div>
<div class="ttc" id="astruct_a_v_codec_context_html_abe964316aaaa61967b012efdcced79c4"><div class="ttname"><a href="struct_a_v_codec_context.html#abe964316aaaa61967b012efdcced79c4">AVCodecContext::extradata</a></div><div class="ttdeci">uint8_t * extradata</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l00627">avcodec.h:627</a></div></div>
<div class="ttc" id="anvenc_8c_html_ac504a73146da1c32baabe689e4ca3e1b"><div class="ttname"><a href="nvenc_8c.html#ac504a73146da1c32baabe689e4ca3e1b">averr</a></div><div class="ttdeci">int averr</div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8c_source.html#l00081">nvenc.c:81</a></div></div>
<div class="ttc" id="apixfmt_8h_html_a000d452c556c94e3865fea5d14a77c8f"><div class="ttname"><a href="pixfmt_8h.html#a000d452c556c94e3865fea5d14a77c8f">AV_PIX_FMT_0RGB32</a></div><div class="ttdeci">#define AV_PIX_FMT_0RGB32</div><div class="ttdef"><b>Definition:</b> <a href="pixfmt_8h_source.html#l00376">pixfmt.h:376</a></div></div>
<div class="ttc" id="acuda__check_8h_html"><div class="ttname"><a href="cuda__check_8h.html">cuda_check.h</a></div></div>
<div class="ttc" id="aatsc__a53_8h_html"><div class="ttname"><a href="atsc__a53_8h.html">atsc_a53.h</a></div></div>
<div class="ttc" id="astruct_a_v_rational_html_ae9a98c10a301c5e937095105b6f0fdb9"><div class="ttname"><a href="struct_a_v_rational.html#ae9a98c10a301c5e937095105b6f0fdb9">AVRational::num</a></div><div class="ttdeci">int num</div><div class="ttdoc">Numerator.</div><div class="ttdef"><b>Definition:</b> <a href="rational_8h_source.html#l00059">rational.h:59</a></div></div>
<div class="ttc" id="astruct_a_v_packet_html"><div class="ttname"><a href="struct_a_v_packet.html">AVPacket</a></div><div class="ttdef"><b>Definition:</b> <a href="packet_8h_source.html#l00340">packet.h:340</a></div></div>
<div class="ttc" id="astruct_nvenc_surface_html_a58a869a12b6a5a69d6683cd3c1e09f37"><div class="ttname"><a href="struct_nvenc_surface.html#a58a869a12b6a5a69d6683cd3c1e09f37">NvencSurface::in_ref</a></div><div class="ttdeci">AVFrame * in_ref</div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8h_source.html#l00076">nvenc.h:76</a></div></div>
<div class="ttc" id="agroup__lavc__decoding_html_ga8f5b632a03ce83ac8e025894b1fc307a"><div class="ttname"><a href="group__lavc__decoding.html#ga8f5b632a03ce83ac8e025894b1fc307a">AV_INPUT_BUFFER_PADDING_SIZE</a></div><div class="ttdeci">#define AV_INPUT_BUFFER_PADDING_SIZE</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l00215">avcodec.h:215</a></div></div>
<div class="ttc" id="asinewin__tablegen__template_8c_html_a3508a98d3ee7e2c9a4841fe264cf70f7"><div class="ttname"><a href="sinewin__tablegen__template_8c.html#a3508a98d3ee7e2c9a4841fe264cf70f7">FF_ARRAY_ELEMS</a></div><div class="ttdeci">#define FF_ARRAY_ELEMS(a)</div><div class="ttdef"><b>Definition:</b> <a href="sinewin__tablegen__template_8c_source.html#l00038">sinewin_tablegen_template.c:38</a></div></div>
<div class="ttc" id="anvenc_8c_html_a4bf3899a8bed4f6012f9f9d6ad3111cc"><div class="ttname"><a href="nvenc_8c.html#a4bf3899a8bed4f6012f9f9d6ad3111cc">nvenc_codec_specific_pic_params</a></div><div class="ttdeci">static void nvenc_codec_specific_pic_params(AVCodecContext *avctx, NV_ENC_PIC_PARAMS *params, NV_ENC_SEI_PAYLOAD *sei_data, int sei_count)</div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8c_source.html#l01868">nvenc.c:1868</a></div></div>
<div class="ttc" id="astruct_a_v_h_w_frames_context_html_ac9a7dbd0cbfcabc0b1529cb34cf53b6d"><div class="ttname"><a href="struct_a_v_h_w_frames_context.html#ac9a7dbd0cbfcabc0b1529cb34cf53b6d">AVHWFramesContext::device_ctx</a></div><div class="ttdeci">AVHWDeviceContext * device_ctx</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext_8h_source.html#l00149">hwcontext.h:149</a></div></div>
<div class="ttc" id="anvenc_8c_html_a3be29e24df433bfd1a0c641215cb23bf"><div class="ttname"><a href="nvenc_8c.html#a3be29e24df433bfd1a0c641215cb23bf">nvenc_errors</a></div><div class="ttdeci">static const struct @0 nvenc_errors[]</div></div>
<div class="ttc" id="agroup__lavu__picture_html_ga6b5a267e202daadf81cbde6584055d1e"><div class="ttname"><a href="group__lavu__picture.html#ga6b5a267e202daadf81cbde6584055d1e">av_image_copy</a></div><div class="ttdeci">void av_image_copy(uint8_t *dst_data[4], int dst_linesizes[4], const uint8_t *src_data[4], const int src_linesizes[4], enum AVPixelFormat pix_fmt, int width, int height)</div><div class="ttdef"><b>Definition:</b> <a href="imgutils_8c_source.html#l00422">imgutils.c:422</a></div></div>
<div class="ttc" id="ademuxing__decoding_8c_html_a3d4c6562f0b27cf0cacbbea5c038c090"><div class="ttname"><a href="demuxing__decoding_8c.html#a3d4c6562f0b27cf0cacbbea5c038c090">pkt</a></div><div class="ttdeci">static AVPacket pkt</div><div class="ttdef"><b>Definition:</b> <a href="demuxing__decoding_8c_source.html#l00054">demuxing_decoding.c:54</a></div></div>
<div class="ttc" id="agroup__lavu__picture_html_ggae6cbcab1f70d8e476757f1c1f5a0a78ead22f8968e99bc48897c3f4ac29e82dae"><div class="ttname"><a href="group__lavu__picture.html#ggae6cbcab1f70d8e476757f1c1f5a0a78ead22f8968e99bc48897c3f4ac29e82dae">AV_PICTURE_TYPE_B</a></div><div class="ttdeci">@ AV_PICTURE_TYPE_B</div><div class="ttdoc">Bi-dir predicted.</div><div class="ttdef"><b>Definition:</b> <a href="avutil_8h_source.html#l00276">avutil.h:276</a></div></div>
<div class="ttc" id="anvenc_8h_html_adf764cbdea00d65edcd07bb9953ad2b7aa85c8f0402b2263db2db09933892c8f9"><div class="ttname"><a href="nvenc_8h.html#adf764cbdea00d65edcd07bb9953ad2b7aa85c8f0402b2263db2db09933892c8f9">NV_ENC_H264_PROFILE_BASELINE</a></div><div class="ttdeci">@ NV_ENC_H264_PROFILE_BASELINE</div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8h_source.html#l00120">nvenc.h:120</a></div></div>
<div class="ttc" id="anvenc_8h_html_a99fb83031ce9923c84392b4e92f956b5aa2bb72356e44a531d90cf3dc19c2da9c"><div class="ttname"><a href="nvenc_8h.html#a99fb83031ce9923c84392b4e92f956b5aa2bb72356e44a531d90cf3dc19c2da9c">NV_ENC_HEVC_PROFILE_MAIN</a></div><div class="ttdeci">@ NV_ENC_HEVC_PROFILE_MAIN</div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8h_source.html#l00127">nvenc.h:127</a></div></div>
<div class="ttc" id="astruct_a_v_codec_context_html_aeffc0091dc3138015b53107c8ffb04af"><div class="ttname"><a href="struct_a_v_codec_context.html#aeffc0091dc3138015b53107c8ffb04af">AVCodecContext::internal</a></div><div class="ttdeci">struct AVCodecInternal * internal</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l00561">avcodec.h:561</a></div></div>
<div class="ttc" id="anvenc_8c_html_aa1c1fa16f8e3d7dbf31de73ad6927c46"><div class="ttname"><a href="nvenc_8c.html#aa1c1fa16f8e3d7dbf31de73ad6927c46">timestamp_queue_dequeue</a></div><div class="ttdeci">static int64_t timestamp_queue_dequeue(AVFifoBuffer *queue)</div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8c_source.html#l01906">nvenc.c:1906</a></div></div>
<div class="ttc" id="apixfmt_8h_html_a9a8e335cf3be472042bc9f0cf80cd4c5a0e08f8a5d0fa21c3e258816a9dcce7c3"><div class="ttname"><a href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a0e08f8a5d0fa21c3e258816a9dcce7c3">AV_PIX_FMT_NONE</a></div><div class="ttdeci">@ AV_PIX_FMT_NONE</div><div class="ttdef"><b>Definition:</b> <a href="pixfmt_8h_source.html#l00065">pixfmt.h:65</a></div></div>
<div class="ttc" id="astruct_nvenc_dyn_load_functions_html"><div class="ttname"><a href="struct_nvenc_dyn_load_functions.html">NvencDynLoadFunctions</a></div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8h_source.html#l00086">nvenc.h:87</a></div></div>
<div class="ttc" id="amotion_8c_html_a7c1d654b7b6114d7a0abc8d351dd1bcd"><div class="ttname"><a href="motion_8c.html#a7c1d654b7b6114d7a0abc8d351dd1bcd">dummy</a></div><div class="ttdeci">int dummy</div><div class="ttdef"><b>Definition:</b> <a href="motion_8c_source.html#l00064">motion.c:64</a></div></div>
<div class="ttc" id="anvenc_8c_html_aa0671022aab972ecf5afe5bda3b91605"><div class="ttname"><a href="nvenc_8c.html#aa0671022aab972ecf5afe5bda3b91605">nvenc_setup_surfaces</a></div><div class="ttdeci">static av_cold int nvenc_setup_surfaces(AVCodecContext *avctx)</div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8c_source.html#l01478">nvenc.c:1478</a></div></div>
<div class="ttc" id="agroup__avoptions_html_gga06fc87d81c62e9abb8790b6e5713c55ba464ca6b9ea1e24bcbadde231ea15cac0"><div class="ttname"><a href="group__avoptions.html#gga06fc87d81c62e9abb8790b6e5713c55ba464ca6b9ea1e24bcbadde231ea15cac0">PRESET_LOSSLESS_DEFAULT</a></div><div class="ttdeci">@ PRESET_LOSSLESS_DEFAULT</div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8h_source.html#l00106">nvenc.h:106</a></div></div>
<div class="ttc" id="acodec__id_8h_html_a60091c030fab7b9a8f3a7a6b783ab6f4"><div class="ttname"><a href="codec__id_8h.html#a60091c030fab7b9a8f3a7a6b783ab6f4">AV_CODEC_ID_H265</a></div><div class="ttdeci">#define AV_CODEC_ID_H265</div><div class="ttdef"><b>Definition:</b> <a href="codec__id_8h_source.html#l00224">codec_id.h:224</a></div></div>
<div class="ttc" id="anvenc_8c_html_a1a1bd2f7e2bd7245c34bb43884513c7c"><div class="ttname"><a href="nvenc_8c.html#a1a1bd2f7e2bd7245c34bb43884513c7c">nvenc_find_free_reg_resource</a></div><div class="ttdeci">static int nvenc_find_free_reg_resource(AVCodecContext *avctx)</div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8c_source.html#l01718">nvenc.c:1718</a></div></div>
<div class="ttc" id="aavcodec_8h_html_aa7d7e490128673e7747bb32ba7ea5486"><div class="ttname"><a href="avcodec_8h.html#aa7d7e490128673e7747bb32ba7ea5486">FF_PROFILE_H264_MAIN</a></div><div class="ttdeci">#define FF_PROFILE_H264_MAIN</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l01900">avcodec.h:1900</a></div></div>
<div class="ttc" id="apixfmt_8h_html_a9a8e335cf3be472042bc9f0cf80cd4c5a82034006e681cddbb7b1d5cb7045626a"><div class="ttname"><a href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a82034006e681cddbb7b1d5cb7045626a">AV_PIX_FMT_YUV444P</a></div><div class="ttdeci">@ AV_PIX_FMT_YUV444P</div><div class="ttdoc">planar YUV 4:4:4, 24bpp, (1 Cr &amp; Cb sample per 1x1 Y samples)</div><div class="ttdef"><b>Definition:</b> <a href="pixfmt_8h_source.html#l00071">pixfmt.h:71</a></div></div>
<div class="ttc" id="apixfmt_8h_html_a6265531cbe491ec34449e3769e545f1f"><div class="ttname"><a href="pixfmt_8h.html#a6265531cbe491ec34449e3769e545f1f">AV_PIX_FMT_P010</a></div><div class="ttdeci">#define AV_PIX_FMT_P010</div><div class="ttdef"><b>Definition:</b> <a href="pixfmt_8h_source.html#l00448">pixfmt.h:448</a></div></div>
<div class="ttc" id="alibavutil_2internal_8h_html_a5837cafc419c2b5ecdb1dfa330675d13"><div class="ttname"><a href="libavutil_2internal_8h.html#a5837cafc419c2b5ecdb1dfa330675d13">FF_DISABLE_DEPRECATION_WARNINGS</a></div><div class="ttdeci">#define FF_DISABLE_DEPRECATION_WARNINGS</div><div class="ttdef"><b>Definition:</b> <a href="libavutil_2internal_8h_source.html#l00084">internal.h:84</a></div></div>
<div class="ttc" id="agroup__lavu__picture_html_ggae6cbcab1f70d8e476757f1c1f5a0a78eaa6fc0479507a03f173f07fc75dab2193"><div class="ttname"><a href="group__lavu__picture.html#ggae6cbcab1f70d8e476757f1c1f5a0a78eaa6fc0479507a03f173f07fc75dab2193">AV_PICTURE_TYPE_P</a></div><div class="ttdeci">@ AV_PICTURE_TYPE_P</div><div class="ttdoc">Predicted.</div><div class="ttdef"><b>Definition:</b> <a href="avutil_8h_source.html#l00275">avutil.h:275</a></div></div>
<div class="ttc" id="amem_8h_html"><div class="ttname"><a href="mem_8h.html">mem.h</a></div></div>
<div class="ttc" id="aencode_8c_html_a24f7e9c2daa5cc6033a220bf53870c62"><div class="ttname"><a href="encode_8c.html#a24f7e9c2daa5cc6033a220bf53870c62">ff_encode_get_frame</a></div><div class="ttdeci">int ff_encode_get_frame(AVCodecContext *avctx, AVFrame *frame)</div><div class="ttdef"><b>Definition:</b> <a href="encode_8c_source.html#l00107">encode.c:107</a></div></div>
<div class="ttc" id="apacket__internal_8h_html"><div class="ttname"><a href="packet__internal_8h.html">packet_internal.h</a></div></div>
<div class="ttc" id="alibavutil_2fifo_8c_html_a81f4cea70d96846df7111daccc5ecce2"><div class="ttname"><a href="libavutil_2fifo_8c.html#a81f4cea70d96846df7111daccc5ecce2">av_fifo_size</a></div><div class="ttdeci">int av_fifo_size(const AVFifoBuffer *f)</div><div class="ttdef"><b>Definition:</b> <a href="libavutil_2fifo_8c_source.html#l00077">fifo.c:77</a></div></div>
<div class="ttc" id="astruct_a_v_codec_context_html_a0425c77b3d06d71e5db88b1d7e1b37f2"><div class="ttname"><a href="struct_a_v_codec_context.html#a0425c77b3d06d71e5db88b1d7e1b37f2">AVCodecContext::pix_fmt</a></div><div class="ttdeci">enum AVPixelFormat pix_fmt</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l00721">avcodec.h:736</a></div></div>
<div class="ttc" id="alibavutil_2fifo_8c_html_a612be59edb6ab388a82d1487d1bd0c4d"><div class="ttname"><a href="libavutil_2fifo_8c.html#a612be59edb6ab388a82d1487d1bd0c4d">av_fifo_freep</a></div><div class="ttdeci">void av_fifo_freep(AVFifoBuffer **f)</div><div class="ttdef"><b>Definition:</b> <a href="libavutil_2fifo_8c_source.html#l00063">fifo.c:63</a></div></div>
<div class="ttc" id="atableprint__vlc_8h_html_a079eab092887563f2bef9106c6120089"><div class="ttname"><a href="tableprint__vlc_8h.html#a079eab092887563f2bef9106c6120089">av_free</a></div><div class="ttdeci">#define av_free(p)</div><div class="ttdef"><b>Definition:</b> <a href="tableprint__vlc_8h_source.html#l00034">tableprint_vlc.h:34</a></div></div>
<div class="ttc" id="astruct_a_v_codec_context_html_a209f5ec60cb5f0b0a4962f4c5c5bb541"><div class="ttname"><a href="struct_a_v_codec_context.html#a209f5ec60cb5f0b0a4962f4c5c5bb541">AVCodecContext::global_quality</a></div><div class="ttdeci">int global_quality</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l00592">avcodec.h:592</a></div></div>
<div class="ttc" id="aavdct_8c_html_a3da44afeba217135a680a7477b5e3ce3"><div class="ttname"><a href="avdct_8c.html#a3da44afeba217135a680a7477b5e3ce3">DEFAULT</a></div><div class="ttdeci">#define DEFAULT</div><div class="ttdef"><b>Definition:</b> <a href="avdct_8c_source.html#l00028">avdct.c:28</a></div></div>
<div class="ttc" id="atableprint__vlc_8h_html_adba82e1bcd02de510a858fcbedf79ef1"><div class="ttname"><a href="tableprint__vlc_8h.html#adba82e1bcd02de510a858fcbedf79ef1">av_freep</a></div><div class="ttdeci">#define av_freep(p)</div><div class="ttdef"><b>Definition:</b> <a href="tableprint__vlc_8h_source.html#l00035">tableprint_vlc.h:35</a></div></div>
<div class="ttc" id="agroup__lavu__picture_html_ggae6cbcab1f70d8e476757f1c1f5a0a78ea71f9f194b0cbe86778cb6df41b867cf3"><div class="ttname"><a href="group__lavu__picture.html#ggae6cbcab1f70d8e476757f1c1f5a0a78ea71f9f194b0cbe86778cb6df41b867cf3">AV_PICTURE_TYPE_BI</a></div><div class="ttdeci">@ AV_PICTURE_TYPE_BI</div><div class="ttdoc">BI type.</div><div class="ttdef"><b>Definition:</b> <a href="avutil_8h_source.html#l00280">avutil.h:280</a></div></div>
<div class="ttc" id="anvenc_8c_html_ae45695734db17add2efbad9b3295fc7c"><div class="ttname"><a href="nvenc_8c.html#ae45695734db17add2efbad9b3295fc7c">nvenc_setup_device</a></div><div class="ttdeci">static av_cold int nvenc_setup_device(AVCodecContext *avctx)</div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8c_source.html#l00535">nvenc.c:535</a></div></div>
<div class="ttc" id="astruct_a_v_codec_context_html_a3e5334a611a3e2a6a653805bb9e2d4d4"><div class="ttname"><a href="struct_a_v_codec_context.html#a3e5334a611a3e2a6a653805bb9e2d4d4">AVCodecContext::max_b_frames</a></div><div class="ttdeci">int max_b_frames</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l00786">avcodec.h:786</a></div></div>
<div class="ttc" id="alibavutil_2fifo_8c_html_adae9b18c5eed14fe851c5bb984ce374b"><div class="ttname"><a href="libavutil_2fifo_8c.html#adae9b18c5eed14fe851c5bb984ce374b">av_fifo_alloc</a></div><div class="ttdeci">AVFifoBuffer * av_fifo_alloc(unsigned int size)</div><div class="ttdef"><b>Definition:</b> <a href="libavutil_2fifo_8c_source.html#l00043">fifo.c:43</a></div></div>
<div class="ttc" id="aimgutils_8h_html"><div class="ttname"><a href="imgutils_8h.html">imgutils.h</a></div></div>
<div class="ttc" id="acbs__av1_8c_html_a67119bce106892b6dade1dc5aa405ac9"><div class="ttname"><a href="cbs__av1_8c.html#a67119bce106892b6dade1dc5aa405ac9">flags</a></div><div class="ttdeci">#define flags(name, subs,...)</div><div class="ttdef"><b>Definition:</b> <a href="cbs__av1_8c_source.html#l00560">cbs_av1.c:560</a></div></div>
<div class="ttc" id="ahwcontext_8h_html"><div class="ttname"><a href="hwcontext_8h.html">hwcontext.h</a></div></div>
<div class="ttc" id="agroup__lavu__error_html_gaa102cde7ec5acbc099c3bcbb58556a18"><div class="ttname"><a href="group__lavu__error.html#gaa102cde7ec5acbc099c3bcbb58556a18">AVERROR_BUG</a></div><div class="ttdeci">#define AVERROR_BUG</div><div class="ttdoc">Internal bug, also see AVERROR_BUG2.</div><div class="ttdef"><b>Definition:</b> <a href="error_8h_source.html#l00050">error.h:50</a></div></div>
<div class="ttc" id="astruct_g_u_i_d_tuple_html"><div class="ttname"><a href="struct_g_u_i_d_tuple.html">GUIDTuple</a></div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8c_source.html#l00641">nvenc.c:641</a></div></div>
<div class="ttc" id="astruct_nvenc_surface_html_a8b83a2e5f2996b0464695af7fa91936c"><div class="ttname"><a href="struct_nvenc_surface.html#a8b83a2e5f2996b0464695af7fa91936c">NvencSurface::height</a></div><div class="ttdeci">int height</div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8h_source.html#l00079">nvenc.h:79</a></div></div>
<div class="ttc" id="atableprint__vlc_8h_html_af38b91523053c244564a94f1ef862c2c"><div class="ttname"><a href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a></div><div class="ttdeci">#define av_log(a,...)</div><div class="ttdef"><b>Definition:</b> <a href="tableprint__vlc_8h_source.html#l00028">tableprint_vlc.h:28</a></div></div>
<div class="ttc" id="astruct_a_v_codec_context_html_a255bf7100a4ba6dcb6ee5d87740a4f35"><div class="ttname"><a href="struct_a_v_codec_context.html#a255bf7100a4ba6dcb6ee5d87740a4f35">AVCodecContext::color_range</a></div><div class="ttdeci">enum AVColorRange color_range</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l01132">avcodec.h:1161</a></div></div>
<div class="ttc" id="astruct_a_v_c_p_b_properties_html"><div class="ttname"><a href="struct_a_v_c_p_b_properties.html">AVCPBProperties</a></div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l00448">avcodec.h:448</a></div></div>
<div class="ttc" id="agroup__lavu__error_html_ga334ea23fd9e492cd0e718330f2353b6b"><div class="ttname"><a href="group__lavu__error.html#ga334ea23fd9e492cd0e718330f2353b6b">AVERROR_EXIT</a></div><div class="ttdeci">#define AVERROR_EXIT</div><div class="ttdoc">Immediate exit was requested; the called function should not be restarted.</div><div class="ttdef"><b>Definition:</b> <a href="error_8h_source.html#l00056">error.h:56</a></div></div>
<div class="ttc" id="astruct_a_v_h_w_frames_context_html_a663a9aceca97aa7b2426c9aba6543e4a"><div class="ttname"><a href="struct_a_v_h_w_frames_context.html#a663a9aceca97aa7b2426c9aba6543e4a">AVHWFramesContext::sw_format</a></div><div class="ttdeci">enum AVPixelFormat sw_format</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext_8h_source.html#l00199">hwcontext.h:222</a></div></div>
<div class="ttc" id="anvenc_8c_html_a6b646db75e533cc26296c09679dcaa8f"><div class="ttname"><a href="nvenc_8c.html#a6b646db75e533cc26296c09679dcaa8f">nvenc_setup_codec_config</a></div><div class="ttdeci">static av_cold int nvenc_setup_codec_config(AVCodecContext *avctx)</div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8c_source.html#l01210">nvenc.c:1210</a></div></div>
<div class="ttc" id="agroup__lavu__enc_html_gad6ce86405f7381daad36ccf516b4da98"><div class="ttname"><a href="group__lavu__enc.html#gad6ce86405f7381daad36ccf516b4da98">FF_QP2LAMBDA</a></div><div class="ttdeci">#define FF_QP2LAMBDA</div><div class="ttdoc">factor to convert from H.263 QP to lambda</div><div class="ttdef"><b>Definition:</b> <a href="avutil_8h_source.html#l00227">avutil.h:227</a></div></div>
<div class="ttc" id="astruct_a_v_codec_context_html_a6e606effa68724cae2ef5cc05f7fd9cb"><div class="ttname"><a href="struct_a_v_codec_context.html#a6e606effa68724cae2ef5cc05f7fd9cb">AVCodecContext::codec</a></div><div class="ttdeci">const struct AVCodec * codec</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l00535">avcodec.h:535</a></div></div>
<div class="ttc" id="astruct_a_v_frame_html"><div class="ttname"><a href="struct_a_v_frame.html">AVFrame</a></div><div class="ttdef"><b>Definition:</b> <a href="frame_8h_source.html#l00308">frame.h:308</a></div></div>
<div class="ttc" id="affmpeg__filter_8c_html_a61569f2965b7a369eb10b6d75d410d11"><div class="ttname"><a href="ffmpeg__filter_8c.html#a61569f2965b7a369eb10b6d75d410d11">int</a></div><div class="ttdeci">int</div><div class="ttdef"><b>Definition:</b> <a href="ffmpeg__filter_8c_source.html#l00193">ffmpeg_filter.c:193</a></div></div>
<div class="ttc" id="ahevc__sei_8h_html"><div class="ttname"><a href="hevc__sei_8h.html">hevc_sei.h</a></div></div>
<div class="ttc" id="astruct_a_v_rational_html_aee46bdac67d965ac0a4204e753f910c3"><div class="ttname"><a href="struct_a_v_rational.html#aee46bdac67d965ac0a4204e753f910c3">AVRational::den</a></div><div class="ttdeci">int den</div><div class="ttdoc">Denominator.</div><div class="ttdef"><b>Definition:</b> <a href="rational_8h_source.html#l00060">rational.h:60</a></div></div>
<div class="ttc" id="astruct_a_v_codec_context_html_a15000607a7e2371162348bb35b0184c1"><div class="ttname"><a href="struct_a_v_codec_context.html#a15000607a7e2371162348bb35b0184c1">AVCodecContext::rc_buffer_size</a></div><div class="ttdeci">int rc_buffer_size</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l01389">avcodec.h:1389</a></div></div>
<div class="ttc" id="astruct_a_v_codec_context_html_a5c62b9c1528a272923ea2a4b86dea31a"><div class="ttname"><a href="struct_a_v_codec_context.html#a5c62b9c1528a272923ea2a4b86dea31a">AVCodecContext::ticks_per_frame</a></div><div class="ttdeci">int ticks_per_frame</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l00658">avcodec.h:658</a></div></div>
<div class="ttc" id="anvenc_8c_html_a0e43a99da4dfd50350396a6066da4978"><div class="ttname"><a href="nvenc_8c.html#a0e43a99da4dfd50350396a6066da4978">nvenc_setup_hevc_config</a></div><div class="ttdeci">static av_cold int nvenc_setup_hevc_config(AVCodecContext *avctx)</div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8c_source.html#l01121">nvenc.c:1121</a></div></div>
<div class="ttc" id="astruct_a_v_codec_context_html_a8cd8caa7d40319324ce3d879a2edbd9f"><div class="ttname"><a href="struct_a_v_codec_context.html#a8cd8caa7d40319324ce3d879a2edbd9f">AVCodecContext::colorspace</a></div><div class="ttdeci">enum AVColorSpace colorspace</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l01132">avcodec.h:1154</a></div></div>
<div class="ttc" id="anvenc_8h_html_a682957a858a05251a419b7fc484a6a63"><div class="ttname"><a href="nvenc_8h.html#a682957a858a05251a419b7fc484a6a63">RC_MODE_DEPRECATED</a></div><div class="ttdeci">#define RC_MODE_DEPRECATED</div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8h_source.html#l00041">nvenc.h:41</a></div></div>
<div class="ttc" id="astruct_a_v_codec_context_html_aa0cb7241b4624dba761c8cf58fb2d5f0"><div class="ttname"><a href="struct_a_v_codec_context.html#aa0cb7241b4624dba761c8cf58fb2d5f0">AVCodecContext::refs</a></div><div class="ttdeci">int refs</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l01114">avcodec.h:1114</a></div></div>
<div class="ttc" id="astruct_nvenc_context_html"><div class="ttname"><a href="struct_nvenc_context.html">NvencContext</a></div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8h_source.html#l00146">nvenc.h:147</a></div></div>
<div class="ttc" id="anvenc_8c_html_a231ab899ec4d674a87ebd3197461c607"><div class="ttname"><a href="nvenc_8c.html#a231ab899ec4d674a87ebd3197461c607">nvenc_send_frame</a></div><div class="ttdeci">static int nvenc_send_frame(AVCodecContext *avctx, const AVFrame *frame)</div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8c_source.html#l02160">nvenc.c:2160</a></div></div>
<div class="ttc" id="apixdesc_8c_html_ab92e2a8a9b58c982560c49df9f01e47e"><div class="ttname"><a href="pixdesc_8c.html#ab92e2a8a9b58c982560c49df9f01e47e">av_get_pix_fmt_name</a></div><div class="ttdeci">const char * av_get_pix_fmt_name(enum AVPixelFormat pix_fmt)</div><div class="ttdef"><b>Definition:</b> <a href="pixdesc_8c_source.html#l02489">pixdesc.c:2489</a></div></div>
<div class="ttc" id="anvenc_8h_html_abc6126af1d45847bc59afa0aa3216b04a3ed51dcd5f88e0045737487a3f537a41"><div class="ttname"><a href="nvenc_8h.html#abc6126af1d45847bc59afa0aa3216b04a3ed51dcd5f88e0045737487a3f537a41">NVENC_DEPRECATED_PRESET</a></div><div class="ttdeci">@ NVENC_DEPRECATED_PRESET</div><div class="ttdef"><b>Definition:</b> <a href="nvenc_8h_source.html#l00138">nvenc.h:138</a></div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.8.20
</small></address>
</body>
</html>
