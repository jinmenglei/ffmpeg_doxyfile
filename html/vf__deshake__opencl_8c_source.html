<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>My Project: E:/github/ffmpeg/libavfilter/vf_deshake_opencl.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">My Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_737c44b861ba7ee498141742fb455fa8.html">ffmpeg</a></li><li class="navelem"><a class="el" href="dir_e1bd69597e95623f2084619f16269321.html">libavfilter</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">vf_deshake_opencl.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="vf__deshake__opencl_8c.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> * This file is part of FFmpeg.</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> * FFmpeg is free software; you can redistribute it and/or</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> * modify it under the terms of the GNU Lesser General Public</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> * License as published by the Free Software Foundation; either</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> * version 2.1 of the License, or (at your option) any later version.</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> * FFmpeg is distributed in the hope that it will be useful,</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> * Lesser General Public License for more details.</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"> * You should have received a copy of the GNU Lesser General Public</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"> * License along with FFmpeg; if not, write to the Free Software</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"> * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"> * Copyright (C) 2000-2008, Intel Corporation, all rights reserved.</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment"> * Copyright (C) 2009, Willow Garage Inc., all rights reserved.</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment"> * Copyright (C) 2013, OpenCV Foundation, all rights reserved.</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment"> * Third party copyrights are property of their respective owners.</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment"> * Redistribution and use in source and binary forms, with or without modification,</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment"> * are permitted provided that the following conditions are met:</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment"> *   * Redistribution&#39;s of source code must retain the above copyright notice,</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment"> *     this list of conditions and the following disclaimer.</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment"> *   * Redistribution&#39;s in binary form must reproduce the above copyright notice,</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment"> *     this list of conditions and the following disclaimer in the documentation</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment"> *     and/or other materials provided with the distribution.</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="comment"> *   * The name of the copyright holders may not be used to endorse or promote products</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment"> *     derived from this software without specific prior written permission.</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="comment"> * This software is provided by the copyright holders and contributors &quot;as is&quot; and</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="comment"> * any express or implied warranties, including, but not limited to, the implied</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="comment"> * warranties of merchantability and fitness for a particular purpose are disclaimed.</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="comment"> * In no event shall the Intel Corporation or contributors be liable for any direct,</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="comment"> * indirect, incidental, special, exemplary, or consequential damages</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="comment"> * (including, but not limited to, procurement of substitute goods or services;</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="comment"> * loss of use, data, or profits; or business interruption) however caused</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="comment"> * and on any theory of liability, whether in contract, strict liability,</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="comment"> * or tort (including negligence or otherwise) arising in any way out of</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="comment"> * the use of this software, even if advised of the possibility of such damage.</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160; </div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="float_8h.html">float.h</a>&gt;</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="lfg_8h.html">libavutil/lfg.h</a>&gt;</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="opt_8h.html">libavutil/opt.h</a>&quot;</span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="imgutils_8h.html">libavutil/imgutils.h</a>&quot;</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="mem_8h.html">libavutil/mem.h</a>&quot;</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="fifo_8h.html">libavutil/fifo.h</a>&quot;</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="common_8h.html">libavutil/common.h</a>&quot;</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="avassert_8h.html">libavutil/avassert.h</a>&quot;</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="pixfmt_8h.html">libavutil/pixfmt.h</a>&quot;</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="avfilter_8h.html">avfilter.h</a>&quot;</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="framequeue_8h.html">framequeue.h</a>&quot;</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="filters_8h.html">filters.h</a>&quot;</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="transform_8h.html">transform.h</a>&quot;</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="formats_8h.html">formats.h</a>&quot;</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="libavutil_2internal_8h.html">internal.h</a>&quot;</span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="opencl_8h.html">opencl.h</a>&quot;</span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="opencl__source_8h.html">opencl_source.h</a>&quot;</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="video_8h.html">video.h</a>&quot;</span></div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160; </div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="comment">This filter matches feature points between frames (dealing with outliers) and then</span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="comment">uses the matches to estimate an affine transform between frames. This transform is</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="comment">decomposed into various values (translation, scale, rotation) and the values are</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="comment">summed relative to the start of the video to obtain on absolute camera position</span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="comment">for each frame. This &quot;camera path&quot; is then smoothed via a gaussian filter, resulting</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="comment">in a new path that is turned back into an affine transform and applied to each</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="comment">frame to render it.</span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="comment">High-level overview:</span></div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="comment">All of the work to extract motion data from frames occurs in queue_frame. Motion data</span></div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="comment">is buffered in a smoothing window, so queue_frame simply computes the absolute camera</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="comment">positions and places them in ringbuffers.</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="comment">filter_frame is responsible for looking at the absolute camera positions currently</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="comment">in the ringbuffers, applying the gaussian filter, and then transforming the frames.</span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160; </div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="comment">// Number of bits for BRIEF descriptors</span></div>
<div class="line"><a name="l00087"></a><span class="lineno"><a class="line" href="vf__deshake__opencl_8c.html#aa906eb01e76896e3890b54fecddc8ffc">   87</a></span>&#160;<span class="preprocessor">#define BREIFN 512</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="comment">// Size of the patch from which a BRIEF descriptor is extracted</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="comment">// This is the size used in OpenCV</span></div>
<div class="line"><a name="l00090"></a><span class="lineno"><a class="line" href="vf__deshake__opencl_8c.html#a2270d971760bf2ab09a7e6d7965e1c42">   90</a></span>&#160;<span class="preprocessor">#define BRIEF_PATCH_SIZE 31</span></div>
<div class="line"><a name="l00091"></a><span class="lineno"><a class="line" href="vf__deshake__opencl_8c.html#a07687e6cde9d1396ff2004e76d37d473">   91</a></span>&#160;<span class="preprocessor">#define BRIEF_PATCH_SIZE_HALF (BRIEF_PATCH_SIZE / 2)</span></div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160; </div>
<div class="line"><a name="l00093"></a><span class="lineno"><a class="line" href="vf__deshake__opencl_8c.html#a204a81d3183522f258d69d430fe4122e">   93</a></span>&#160;<span class="preprocessor">#define MATCHES_CONTIG_SIZE 2000</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160; </div>
<div class="line"><a name="l00095"></a><span class="lineno"><a class="line" href="vf__deshake__opencl_8c.html#a85ec8441a811e55d823408e0b8d5bfd0">   95</a></span>&#160;<span class="preprocessor">#define ROUNDED_UP_DIV(a, b) ((a + (b - 1)) / b)</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160; </div>
<div class="line"><a name="l00097"></a><span class="lineno"><a class="line" href="struct_point_pair.html">   97</a></span>&#160;<span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="struct_point_pair.html">PointPair</a> {</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    <span class="comment">// Previous frame</span></div>
<div class="line"><a name="l00099"></a><span class="lineno"><a class="line" href="struct_point_pair.html#a2723179bf26cf06740f47f174a26dd4d">   99</a></span>&#160;    cl_float2 <a class="code" href="struct_point_pair.html#a2723179bf26cf06740f47f174a26dd4d">p1</a>;</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    <span class="comment">// Current frame</span></div>
<div class="line"><a name="l00101"></a><span class="lineno"><a class="line" href="struct_point_pair.html#a38dcabbd5cea915755b9eba77ebc5427">  101</a></span>&#160;    cl_float2 <a class="code" href="struct_point_pair.html#a38dcabbd5cea915755b9eba77ebc5427">p2</a>;</div>
<div class="line"><a name="l00102"></a><span class="lineno"><a class="line" href="vf__deshake__opencl_8c.html#abc57895720c42e4d87775275b391a9f8">  102</a></span>&#160;} <a class="code" href="vf__deshake__opencl_8c.html#abc57895720c42e4d87775275b391a9f8">PointPair</a>;</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160; </div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="struct_motion_vector.html">MotionVector</a> {</div>
<div class="line"><a name="l00105"></a><span class="lineno"><a class="line" href="struct_motion_vector.html#acb7c81a18a7fcdafce38520f1794ad92">  105</a></span>&#160;    <a class="code" href="struct_point_pair.html">PointPair</a> <a class="code" href="struct_motion_vector.html#acb7c81a18a7fcdafce38520f1794ad92">p</a>;</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    <span class="comment">// Used to mark vectors as potential outliers</span></div>
<div class="line"><a name="l00107"></a><span class="lineno"><a class="line" href="struct_motion_vector.html#a9575b5b2610bb21eeb2550f2c13d922e">  107</a></span>&#160;    cl_int <a class="code" href="struct_motion_vector.html#a9575b5b2610bb21eeb2550f2c13d922e">should_consider</a>;</div>
<div class="line"><a name="l00108"></a><span class="lineno"><a class="line" href="vf__deshake__opencl_8c.html#ae9687f8b93a6b320cd8c7ab4b5bf5dab">  108</a></span>&#160;} <a class="code" href="vf__deshake__opencl_8c.html#ae9687f8b93a6b320cd8c7ab4b5bf5dab">MotionVector</a>;</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160; </div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="comment">// Denotes the indices for the different types of motion in the ringbuffers array</span></div>
<div class="line"><a name="l00111"></a><span class="lineno"><a class="line" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5">  111</a></span>&#160;<span class="keyword">enum</span> <a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5">RingbufferIndices</a> {</div>
<div class="line"><a name="l00112"></a><span class="lineno"><a class="line" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5ad4065c2ecefa3f3486ff44e2e409008d">  112</a></span>&#160;    <a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5ad4065c2ecefa3f3486ff44e2e409008d">RingbufX</a>,</div>
<div class="line"><a name="l00113"></a><span class="lineno"><a class="line" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5a647afa6f628f3817a6923cfcafe6779a">  113</a></span>&#160;    <a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5a647afa6f628f3817a6923cfcafe6779a">RingbufY</a>,</div>
<div class="line"><a name="l00114"></a><span class="lineno"><a class="line" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5a7071a06d4f6642fd037c82dd101a3321">  114</a></span>&#160;    <a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5a7071a06d4f6642fd037c82dd101a3321">RingbufRot</a>,</div>
<div class="line"><a name="l00115"></a><span class="lineno"><a class="line" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5a3271fdb76ac77fd9c6a61011c51e6f8e">  115</a></span>&#160;    <a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5a3271fdb76ac77fd9c6a61011c51e6f8e">RingbufScaleX</a>,</div>
<div class="line"><a name="l00116"></a><span class="lineno"><a class="line" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5aad52f91fb41da1ce46b0b832f1c5a04b">  116</a></span>&#160;    <a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5aad52f91fb41da1ce46b0b832f1c5a04b">RingbufScaleY</a>,</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160; </div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    <span class="comment">// Should always be last</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    <a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5a9113457a0b099555ded29c2f6a521cb7">RingbufCount</a></div>
<div class="line"><a name="l00120"></a><span class="lineno"><a class="line" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5a9113457a0b099555ded29c2f6a521cb7">  120</a></span>&#160;};</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160; </div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="comment">// Struct that holds data for drawing point match debug data</span></div>
<div class="line"><a name="l00123"></a><span class="lineno"><a class="line" href="struct_debug_matches.html">  123</a></span>&#160;<span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="struct_debug_matches.html">DebugMatches</a> {</div>
<div class="line"><a name="l00124"></a><span class="lineno"><a class="line" href="struct_debug_matches.html#ab0ec0dc3ed944615f4828998616e2387">  124</a></span>&#160;    <a class="code" href="struct_motion_vector.html">MotionVector</a> *<a class="code" href="struct_debug_matches.html#ab0ec0dc3ed944615f4828998616e2387">matches</a>;</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    <span class="comment">// The points used to calculate the affine transform for a frame</span></div>
<div class="line"><a name="l00126"></a><span class="lineno"><a class="line" href="struct_debug_matches.html#abd79e59e862cfd147ea9dbff77881c1e">  126</a></span>&#160;    <a class="code" href="struct_motion_vector.html">MotionVector</a> <a class="code" href="struct_debug_matches.html#abd79e59e862cfd147ea9dbff77881c1e">model_matches</a>[3];</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160; </div>
<div class="line"><a name="l00128"></a><span class="lineno"><a class="line" href="struct_debug_matches.html#ac7258324928e2eee6652aeaac94a53f1">  128</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="struct_debug_matches.html#ac7258324928e2eee6652aeaac94a53f1">num_matches</a>;</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    <span class="comment">// For cases where we couldn&#39;t calculate a model</span></div>
<div class="line"><a name="l00130"></a><span class="lineno"><a class="line" href="struct_debug_matches.html#a1445bdc06f80d04a082a8ca170665b93">  130</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="struct_debug_matches.html#a1445bdc06f80d04a082a8ca170665b93">num_model_matches</a>;</div>
<div class="line"><a name="l00131"></a><span class="lineno"><a class="line" href="vf__deshake__opencl_8c.html#a303d52aeabfba761c6e331861983fb82">  131</a></span>&#160;} <a class="code" href="vf__deshake__opencl_8c.html#a303d52aeabfba761c6e331861983fb82">DebugMatches</a>;</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160; </div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="comment">// Groups together the ringbuffers that store absolute distortion / position values</span></div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="comment">// for each frame</span></div>
<div class="line"><a name="l00135"></a><span class="lineno"><a class="line" href="struct_absolute_frame_motion.html">  135</a></span>&#160;<span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="struct_absolute_frame_motion.html">AbsoluteFrameMotion</a> {</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    <span class="comment">// Array with the various ringbuffers, indexed via the RingbufferIndices enum</span></div>
<div class="line"><a name="l00137"></a><span class="lineno"><a class="line" href="struct_absolute_frame_motion.html#a8cfe39ca16b5020b5aa3d0c67cb20bbb">  137</a></span>&#160;    <a class="code" href="struct_a_v_fifo_buffer.html">AVFifoBuffer</a> *<a class="code" href="struct_absolute_frame_motion.html#a8cfe39ca16b5020b5aa3d0c67cb20bbb">ringbuffers</a>[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5a9113457a0b099555ded29c2f6a521cb7">RingbufCount</a>];</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160; </div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    <span class="comment">// Offset to get to the current frame being processed</span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    <span class="comment">// (not in bytes)</span></div>
<div class="line"><a name="l00141"></a><span class="lineno"><a class="line" href="struct_absolute_frame_motion.html#ac0255cf0b9279f9a94b98e318380243e">  141</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="struct_absolute_frame_motion.html#ac0255cf0b9279f9a94b98e318380243e">curr_frame_offset</a>;</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    <span class="comment">// Keeps track of where the start and end of contiguous motion data is (to</span></div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    <span class="comment">// deal with cases where no motion data is found between two frames)</span></div>
<div class="line"><a name="l00144"></a><span class="lineno"><a class="line" href="struct_absolute_frame_motion.html#ae3114642778302fa1dce520054e222c5">  144</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="struct_absolute_frame_motion.html#ae3114642778302fa1dce520054e222c5">data_start_offset</a>;</div>
<div class="line"><a name="l00145"></a><span class="lineno"><a class="line" href="struct_absolute_frame_motion.html#af13ee6297ce6688742784267660cb911">  145</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="struct_absolute_frame_motion.html#af13ee6297ce6688742784267660cb911">data_end_offset</a>;</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160; </div>
<div class="line"><a name="l00147"></a><span class="lineno"><a class="line" href="struct_absolute_frame_motion.html#aebd12b2e7d7a0ceaa9e02f19f8aca9dc">  147</a></span>&#160;    <a class="code" href="struct_a_v_fifo_buffer.html">AVFifoBuffer</a> *<a class="code" href="struct_absolute_frame_motion.html#aebd12b2e7d7a0ceaa9e02f19f8aca9dc">debug_matches</a>;</div>
<div class="line"><a name="l00148"></a><span class="lineno"><a class="line" href="vf__deshake__opencl_8c.html#adadd946e759c992e1c18f108285f09a6">  148</a></span>&#160;} <a class="code" href="vf__deshake__opencl_8c.html#adadd946e759c992e1c18f108285f09a6">AbsoluteFrameMotion</a>;</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160; </div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="comment">// Takes care of freeing the arrays within the DebugMatches inside of the</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="comment">// debug_matches ringbuffer and then freeing the buffer itself.</span></div>
<div class="line"><a name="l00152"></a><span class="lineno"><a class="line" href="vf__deshake__opencl_8c.html#adc33dfb26baa854c039955d7439fe8c0">  152</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="vf__deshake__opencl_8c.html#adc33dfb26baa854c039955d7439fe8c0">free_debug_matches</a>(<a class="code" href="struct_absolute_frame_motion.html">AbsoluteFrameMotion</a> *afm) {</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    <a class="code" href="struct_debug_matches.html">DebugMatches</a> dm;</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160; </div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <span class="keywordflow">if</span> (!afm-&gt;<a class="code" href="struct_absolute_frame_motion.html#aebd12b2e7d7a0ceaa9e02f19f8aca9dc">debug_matches</a>) {</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    }</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160; </div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    <span class="keywordflow">while</span> (<a class="code" href="libavutil_2fifo_8c.html#a81f4cea70d96846df7111daccc5ecce2">av_fifo_size</a>(afm-&gt;<a class="code" href="struct_absolute_frame_motion.html#aebd12b2e7d7a0ceaa9e02f19f8aca9dc">debug_matches</a>) &gt; 0) {</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;        <a class="code" href="libavutil_2fifo_8c.html#ab708d2f19b7a9592caa278256787adb6">av_fifo_generic_read</a>(</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;            afm-&gt;<a class="code" href="struct_absolute_frame_motion.html#aebd12b2e7d7a0ceaa9e02f19f8aca9dc">debug_matches</a>,</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;            &amp;dm,</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;            <span class="keyword">sizeof</span>(<a class="code" href="struct_debug_matches.html">DebugMatches</a>),</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;            <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;        );</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160; </div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#adba82e1bcd02de510a858fcbedf79ef1">av_freep</a>(&amp;dm.<a class="code" href="struct_debug_matches.html#ab0ec0dc3ed944615f4828998616e2387">matches</a>);</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    }</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160; </div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    <a class="code" href="libavutil_2fifo_8c.html#a612be59edb6ab388a82d1487d1bd0c4d">av_fifo_freep</a>(&amp;afm-&gt;<a class="code" href="struct_absolute_frame_motion.html#aebd12b2e7d7a0ceaa9e02f19f8aca9dc">debug_matches</a>);</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;}</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160; </div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;<span class="comment">// Stores the translation, scale, rotation, and skew deltas between two frames</span></div>
<div class="line"><a name="l00174"></a><span class="lineno"><a class="line" href="struct_frame_delta.html">  174</a></span>&#160;<span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="struct_frame_delta.html">FrameDelta</a> {</div>
<div class="line"><a name="l00175"></a><span class="lineno"><a class="line" href="struct_frame_delta.html#a62cbcfdd88ecf0d96220bb61f2106907">  175</a></span>&#160;    cl_float2 <a class="code" href="struct_frame_delta.html#a62cbcfdd88ecf0d96220bb61f2106907">translation</a>;</div>
<div class="line"><a name="l00176"></a><span class="lineno"><a class="line" href="struct_frame_delta.html#af3b70c3f8624b139e8e935d6a464fcfe">  176</a></span>&#160;    <span class="keywordtype">float</span> <a class="code" href="struct_frame_delta.html#af3b70c3f8624b139e8e935d6a464fcfe">rotation</a>;</div>
<div class="line"><a name="l00177"></a><span class="lineno"><a class="line" href="struct_frame_delta.html#adf861bed13cca1a3d2aba10c6e74e3ba">  177</a></span>&#160;    cl_float2 <a class="code" href="struct_frame_delta.html#adf861bed13cca1a3d2aba10c6e74e3ba">scale</a>;</div>
<div class="line"><a name="l00178"></a><span class="lineno"><a class="line" href="struct_frame_delta.html#aed2e326e2da42c7e94ac8ffb3ae76956">  178</a></span>&#160;    cl_float2 <a class="code" href="struct_frame_delta.html#aed2e326e2da42c7e94ac8ffb3ae76956">skew</a>;</div>
<div class="line"><a name="l00179"></a><span class="lineno"><a class="line" href="vf__deshake__opencl_8c.html#aced7f52e0aab311d0b7138336653a536">  179</a></span>&#160;} <a class="code" href="vf__deshake__opencl_8c.html#aced7f52e0aab311d0b7138336653a536">FrameDelta</a>;</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160; </div>
<div class="line"><a name="l00181"></a><span class="lineno"><a class="line" href="struct_similarity_matrix.html">  181</a></span>&#160;<span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="struct_similarity_matrix.html">SimilarityMatrix</a> {</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    <span class="comment">// The 2x3 similarity matrix</span></div>
<div class="line"><a name="l00183"></a><span class="lineno"><a class="line" href="struct_similarity_matrix.html#a46c459590caaeb90c6c7c9e7559004c4">  183</a></span>&#160;    <span class="keywordtype">double</span> <a class="code" href="struct_similarity_matrix.html#a46c459590caaeb90c6c7c9e7559004c4">matrix</a>[6];</div>
<div class="line"><a name="l00184"></a><span class="lineno"><a class="line" href="vf__deshake__opencl_8c.html#a1ed197b9ba0435de2e69f24203e2c75a">  184</a></span>&#160;} <a class="code" href="vf__deshake__opencl_8c.html#a1ed197b9ba0435de2e69f24203e2c75a">SimilarityMatrix</a>;</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160; </div>
<div class="line"><a name="l00186"></a><span class="lineno"><a class="line" href="struct_crop_info.html">  186</a></span>&#160;<span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="struct_crop_info.html">CropInfo</a> {</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    <span class="comment">// The top left corner of the bounding box for the crop</span></div>
<div class="line"><a name="l00188"></a><span class="lineno"><a class="line" href="struct_crop_info.html#ae1943b8a3e6b5faca15573d739f83226">  188</a></span>&#160;    cl_float2 <a class="code" href="struct_crop_info.html#ae1943b8a3e6b5faca15573d739f83226">top_left</a>;</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    <span class="comment">// The bottom right corner of the bounding box for the crop</span></div>
<div class="line"><a name="l00190"></a><span class="lineno"><a class="line" href="struct_crop_info.html#a021b9999edc9cb446f56c8d9ed44e8d5">  190</a></span>&#160;    cl_float2 <a class="code" href="struct_crop_info.html#a021b9999edc9cb446f56c8d9ed44e8d5">bottom_right</a>;</div>
<div class="line"><a name="l00191"></a><span class="lineno"><a class="line" href="vf__deshake__opencl_8c.html#a8e8a6f5abd69302d0de8fd00be2ece98">  191</a></span>&#160;} <a class="code" href="vf__deshake__opencl_8c.html#a8e8a6f5abd69302d0de8fd00be2ece98">CropInfo</a>;</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160; </div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;<span class="comment">// Returned from function that determines start and end values for iteration</span></div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;<span class="comment">// around the current frame in a ringbuffer</span></div>
<div class="line"><a name="l00195"></a><span class="lineno"><a class="line" href="struct_iter_indices.html">  195</a></span>&#160;<span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="struct_iter_indices.html">IterIndices</a> {</div>
<div class="line"><a name="l00196"></a><span class="lineno"><a class="line" href="struct_iter_indices.html#ae39d58c5950929136c2422c6617a041d">  196</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="struct_iter_indices.html#ae39d58c5950929136c2422c6617a041d">start</a>;</div>
<div class="line"><a name="l00197"></a><span class="lineno"><a class="line" href="struct_iter_indices.html#aff2a431f9d303a170a41bd9546e70cde">  197</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="struct_iter_indices.html#aff2a431f9d303a170a41bd9546e70cde">end</a>;</div>
<div class="line"><a name="l00198"></a><span class="lineno"><a class="line" href="vf__deshake__opencl_8c.html#a3e5ef8037d7bb11051e90e3922aa3697">  198</a></span>&#160;} <a class="code" href="vf__deshake__opencl_8c.html#a3e5ef8037d7bb11051e90e3922aa3697">IterIndices</a>;</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160; </div>
<div class="line"><a name="l00200"></a><span class="lineno"><a class="line" href="struct_deshake_open_c_l_context.html">  200</a></span>&#160;<span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="struct_deshake_open_c_l_context.html">DeshakeOpenCLContext</a> {</div>
<div class="line"><a name="l00201"></a><span class="lineno"><a class="line" href="struct_deshake_open_c_l_context.html#ab292157fd24053079954dea475bcc415">  201</a></span>&#160;    <a class="code" href="struct_open_c_l_filter_context.html">OpenCLFilterContext</a> <a class="code" href="struct_deshake_open_c_l_context.html#ab292157fd24053079954dea475bcc415">ocf</a>;</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    <span class="comment">// Whether or not the above `OpenCLFilterContext` has been initialized</span></div>
<div class="line"><a name="l00203"></a><span class="lineno"><a class="line" href="struct_deshake_open_c_l_context.html#a460f3b6df63381875e9b8750a04fd925">  203</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="struct_deshake_open_c_l_context.html#a460f3b6df63381875e9b8750a04fd925">initialized</a>;</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160; </div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    <span class="comment">// These variables are used in the activate callback</span></div>
<div class="line"><a name="l00206"></a><span class="lineno"><a class="line" href="struct_deshake_open_c_l_context.html#ac7aef1ea8edc37e98f593dfcd91dad84">  206</a></span>&#160;    int64_t <a class="code" href="struct_deshake_open_c_l_context.html#ac7aef1ea8edc37e98f593dfcd91dad84">duration</a>;</div>
<div class="line"><a name="l00207"></a><span class="lineno"><a class="line" href="struct_deshake_open_c_l_context.html#ac859d628df2ed7cd622905fdb6365b33">  207</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="struct_deshake_open_c_l_context.html#ac859d628df2ed7cd622905fdb6365b33">eof</a>;</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160; </div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    <span class="comment">// State for random number generation</span></div>
<div class="line"><a name="l00210"></a><span class="lineno"><a class="line" href="struct_deshake_open_c_l_context.html#ad524792607e91fe68042dbe400d0a4de">  210</a></span>&#160;    <a class="code" href="struct_a_v_l_f_g.html">AVLFG</a> <a class="code" href="struct_deshake_open_c_l_context.html#ad524792607e91fe68042dbe400d0a4de">alfg</a>;</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160; </div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    <span class="comment">// FIFO frame queue used to buffer future frames for processing</span></div>
<div class="line"><a name="l00213"></a><span class="lineno"><a class="line" href="struct_deshake_open_c_l_context.html#a776fbef11213f42fc88a93f39cf7d3f3">  213</a></span>&#160;    <a class="code" href="struct_f_f_frame_queue.html">FFFrameQueue</a> <a class="code" href="struct_deshake_open_c_l_context.html#a776fbef11213f42fc88a93f39cf7d3f3">fq</a>;</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    <span class="comment">// Ringbuffers for frame positions</span></div>
<div class="line"><a name="l00215"></a><span class="lineno"><a class="line" href="struct_deshake_open_c_l_context.html#af41b236ec464389c9700936e54260726">  215</a></span>&#160;    <a class="code" href="struct_absolute_frame_motion.html">AbsoluteFrameMotion</a> <a class="code" href="struct_deshake_open_c_l_context.html#af41b236ec464389c9700936e54260726">abs_motion</a>;</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160; </div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    <span class="comment">// The number of frames&#39; motion to consider before and after the frame we are</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    <span class="comment">// smoothing</span></div>
<div class="line"><a name="l00219"></a><span class="lineno"><a class="line" href="struct_deshake_open_c_l_context.html#a4b73a586695575b9a355baae0432be1e">  219</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="struct_deshake_open_c_l_context.html#a4b73a586695575b9a355baae0432be1e">smooth_window</a>;</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    <span class="comment">// The number of the frame we are currently processing</span></div>
<div class="line"><a name="l00221"></a><span class="lineno"><a class="line" href="struct_deshake_open_c_l_context.html#a385c7d3da418f0a685ecc00756fcd4cf">  221</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="struct_deshake_open_c_l_context.html#a385c7d3da418f0a685ecc00756fcd4cf">curr_frame</a>;</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160; </div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    <span class="comment">// Stores a 1d array of normalised gaussian kernel values for convolution</span></div>
<div class="line"><a name="l00224"></a><span class="lineno"><a class="line" href="struct_deshake_open_c_l_context.html#a26f185755b7d230c5304b70c3369bff2">  224</a></span>&#160;    <span class="keywordtype">float</span> *<a class="code" href="struct_deshake_open_c_l_context.html#a26f185755b7d230c5304b70c3369bff2">gauss_kernel</a>;</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160; </div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    <span class="comment">// Buffer for error values used in RANSAC code</span></div>
<div class="line"><a name="l00227"></a><span class="lineno"><a class="line" href="struct_deshake_open_c_l_context.html#a8ac38dcf0b23b1e13eee252d5c0ac3fc">  227</a></span>&#160;    <span class="keywordtype">float</span> *<a class="code" href="struct_deshake_open_c_l_context.html#a8ac38dcf0b23b1e13eee252d5c0ac3fc">ransac_err</a>;</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160; </div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    <span class="comment">// Information regarding how to crop the smoothed luminance (or RGB) planes</span></div>
<div class="line"><a name="l00230"></a><span class="lineno"><a class="line" href="struct_deshake_open_c_l_context.html#a3a60dbef2cdb99207de33b4eb6e56701">  230</a></span>&#160;    <a class="code" href="struct_crop_info.html">CropInfo</a> <a class="code" href="struct_deshake_open_c_l_context.html#a3a60dbef2cdb99207de33b4eb6e56701">crop_y</a>;</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    <span class="comment">// Information regarding how to crop the smoothed chroma planes</span></div>
<div class="line"><a name="l00232"></a><span class="lineno"><a class="line" href="struct_deshake_open_c_l_context.html#ac5cdb80350d15e89f5d04821774dda35">  232</a></span>&#160;    <a class="code" href="struct_crop_info.html">CropInfo</a> <a class="code" href="struct_deshake_open_c_l_context.html#ac5cdb80350d15e89f5d04821774dda35">crop_uv</a>;</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160; </div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    <span class="comment">// Whether or not we are processing YUV input (as oppposed to RGB)</span></div>
<div class="line"><a name="l00235"></a><span class="lineno"><a class="line" href="struct_deshake_open_c_l_context.html#a988296689039b7ea4a63b4a2bdc1ca30">  235</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="struct_deshake_open_c_l_context.html#a988296689039b7ea4a63b4a2bdc1ca30">is_yuv</a>;</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    <span class="comment">// The underlying format of the hardware surfaces</span></div>
<div class="line"><a name="l00237"></a><span class="lineno"><a class="line" href="struct_deshake_open_c_l_context.html#a29fa9c662ba310cab97432efefc706ff">  237</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="struct_deshake_open_c_l_context.html#a29fa9c662ba310cab97432efefc706ff">sw_format</a>;</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160; </div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    <span class="comment">// Buffer to copy `matches` into for the CPU to work with</span></div>
<div class="line"><a name="l00240"></a><span class="lineno"><a class="line" href="struct_deshake_open_c_l_context.html#a8e05cd678122da9b5845b977e3222737">  240</a></span>&#160;    <a class="code" href="struct_motion_vector.html">MotionVector</a> *<a class="code" href="struct_deshake_open_c_l_context.html#a8e05cd678122da9b5845b977e3222737">matches_host</a>;</div>
<div class="line"><a name="l00241"></a><span class="lineno"><a class="line" href="struct_deshake_open_c_l_context.html#ae6a887d019eba0c61fb9c40d2c773b06">  241</a></span>&#160;    <a class="code" href="struct_motion_vector.html">MotionVector</a> *<a class="code" href="struct_deshake_open_c_l_context.html#ae6a887d019eba0c61fb9c40d2c773b06">matches_contig_host</a>;</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160; </div>
<div class="line"><a name="l00243"></a><span class="lineno"><a class="line" href="struct_deshake_open_c_l_context.html#af31e5026ce59c775a51e5f65d46c3931">  243</a></span>&#160;    <a class="code" href="struct_motion_vector.html">MotionVector</a> *<a class="code" href="struct_deshake_open_c_l_context.html#af31e5026ce59c775a51e5f65d46c3931">inliers</a>;</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160; </div>
<div class="line"><a name="l00245"></a><span class="lineno"><a class="line" href="struct_deshake_open_c_l_context.html#a79d104439a1735bbfeaef639bf340b4e">  245</a></span>&#160;    cl_command_queue <a class="code" href="struct_deshake_open_c_l_context.html#a79d104439a1735bbfeaef639bf340b4e">command_queue</a>;</div>
<div class="line"><a name="l00246"></a><span class="lineno"><a class="line" href="struct_deshake_open_c_l_context.html#ad68588f3779e87462e9460c60c5ecd63">  246</a></span>&#160;    cl_kernel <a class="code" href="struct_deshake_open_c_l_context.html#ad68588f3779e87462e9460c60c5ecd63">kernel_grayscale</a>;</div>
<div class="line"><a name="l00247"></a><span class="lineno"><a class="line" href="struct_deshake_open_c_l_context.html#ad59ba220d72a4f17d367860c85a1c4b8">  247</a></span>&#160;    cl_kernel <a class="code" href="struct_deshake_open_c_l_context.html#ad59ba220d72a4f17d367860c85a1c4b8">kernel_harris_response</a>;</div>
<div class="line"><a name="l00248"></a><span class="lineno"><a class="line" href="struct_deshake_open_c_l_context.html#a0544d6baadfae49479dfac27deb26631">  248</a></span>&#160;    cl_kernel <a class="code" href="struct_deshake_open_c_l_context.html#a0544d6baadfae49479dfac27deb26631">kernel_refine_features</a>;</div>
<div class="line"><a name="l00249"></a><span class="lineno"><a class="line" href="struct_deshake_open_c_l_context.html#a20f13310a4da88501cb8a82136e12624">  249</a></span>&#160;    cl_kernel <a class="code" href="struct_deshake_open_c_l_context.html#a20f13310a4da88501cb8a82136e12624">kernel_brief_descriptors</a>;</div>
<div class="line"><a name="l00250"></a><span class="lineno"><a class="line" href="struct_deshake_open_c_l_context.html#a4643b2df679a01bf1bd670e97445fca3">  250</a></span>&#160;    cl_kernel <a class="code" href="struct_deshake_open_c_l_context.html#a4643b2df679a01bf1bd670e97445fca3">kernel_match_descriptors</a>;</div>
<div class="line"><a name="l00251"></a><span class="lineno"><a class="line" href="struct_deshake_open_c_l_context.html#a229dd8f8447b313ed366581b8683a141">  251</a></span>&#160;    cl_kernel <a class="code" href="struct_deshake_open_c_l_context.html#a229dd8f8447b313ed366581b8683a141">kernel_transform</a>;</div>
<div class="line"><a name="l00252"></a><span class="lineno"><a class="line" href="struct_deshake_open_c_l_context.html#a8192eb89bbb66932516c6d383a65ac94">  252</a></span>&#160;    cl_kernel <a class="code" href="struct_deshake_open_c_l_context.html#a8192eb89bbb66932516c6d383a65ac94">kernel_crop_upscale</a>;</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160; </div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    <span class="comment">// Stores a frame converted to grayscale</span></div>
<div class="line"><a name="l00255"></a><span class="lineno"><a class="line" href="struct_deshake_open_c_l_context.html#a0f48467a039b920eba5ede7e9061a665">  255</a></span>&#160;    cl_mem <a class="code" href="struct_deshake_open_c_l_context.html#a0f48467a039b920eba5ede7e9061a665">grayscale</a>;</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    <span class="comment">// Stores the harris response for a frame (measure of &quot;cornerness&quot; for each pixel)</span></div>
<div class="line"><a name="l00257"></a><span class="lineno"><a class="line" href="struct_deshake_open_c_l_context.html#a61c2fbcc1ab251c2eb4a71043d98b53f">  257</a></span>&#160;    cl_mem <a class="code" href="struct_deshake_open_c_l_context.html#a61c2fbcc1ab251c2eb4a71043d98b53f">harris_buf</a>;</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160; </div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    <span class="comment">// Detected features after non-maximum suppression and sub-pixel refinement</span></div>
<div class="line"><a name="l00260"></a><span class="lineno"><a class="line" href="struct_deshake_open_c_l_context.html#a45f1a5b89a64cc7c95df393b2ab082a7">  260</a></span>&#160;    cl_mem <a class="code" href="struct_deshake_open_c_l_context.html#a45f1a5b89a64cc7c95df393b2ab082a7">refined_features</a>;</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    <span class="comment">// Saved from the previous frame</span></div>
<div class="line"><a name="l00262"></a><span class="lineno"><a class="line" href="struct_deshake_open_c_l_context.html#a588f6e97b0bc1508d365e126a724028f">  262</a></span>&#160;    cl_mem <a class="code" href="struct_deshake_open_c_l_context.html#a588f6e97b0bc1508d365e126a724028f">prev_refined_features</a>;</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160; </div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    <span class="comment">// BRIEF sampling pattern that is randomly initialized</span></div>
<div class="line"><a name="l00265"></a><span class="lineno"><a class="line" href="struct_deshake_open_c_l_context.html#a4852f1eeba2faa364c27908db1f59d14">  265</a></span>&#160;    cl_mem <a class="code" href="struct_deshake_open_c_l_context.html#a4852f1eeba2faa364c27908db1f59d14">brief_pattern</a>;</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    <span class="comment">// Feature point descriptors for the current frame</span></div>
<div class="line"><a name="l00267"></a><span class="lineno"><a class="line" href="struct_deshake_open_c_l_context.html#a77d66a199ea18b038f9df75d5b5ca312">  267</a></span>&#160;    cl_mem <a class="code" href="struct_deshake_open_c_l_context.html#a77d66a199ea18b038f9df75d5b5ca312">descriptors</a>;</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    <span class="comment">// Feature point descriptors for the previous frame</span></div>
<div class="line"><a name="l00269"></a><span class="lineno"><a class="line" href="struct_deshake_open_c_l_context.html#a2abcf1be5e0e345a6bb0be190fbe0378">  269</a></span>&#160;    cl_mem <a class="code" href="struct_deshake_open_c_l_context.html#a2abcf1be5e0e345a6bb0be190fbe0378">prev_descriptors</a>;</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    <span class="comment">// Vectors between points in current and previous frame</span></div>
<div class="line"><a name="l00271"></a><span class="lineno"><a class="line" href="struct_deshake_open_c_l_context.html#a05a20833a17dd7d1ed5cda9f3cb9e393">  271</a></span>&#160;    cl_mem <a class="code" href="struct_deshake_open_c_l_context.html#a05a20833a17dd7d1ed5cda9f3cb9e393">matches</a>;</div>
<div class="line"><a name="l00272"></a><span class="lineno"><a class="line" href="struct_deshake_open_c_l_context.html#a66a35be6a8a0c0cbef246a136257b673">  272</a></span>&#160;    cl_mem <a class="code" href="struct_deshake_open_c_l_context.html#a66a35be6a8a0c0cbef246a136257b673">matches_contig</a>;</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    <span class="comment">// Holds the matrix to transform luminance (or RGB) with</span></div>
<div class="line"><a name="l00274"></a><span class="lineno"><a class="line" href="struct_deshake_open_c_l_context.html#a72e0fa2b3833d4b58438839e33d9cb38">  274</a></span>&#160;    cl_mem <a class="code" href="struct_deshake_open_c_l_context.html#a72e0fa2b3833d4b58438839e33d9cb38">transform_y</a>;</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    <span class="comment">// Holds the matrix to transform chroma with</span></div>
<div class="line"><a name="l00276"></a><span class="lineno"><a class="line" href="struct_deshake_open_c_l_context.html#a5eac23c56e1fa82a5383b9399cbc6a28">  276</a></span>&#160;    cl_mem <a class="code" href="struct_deshake_open_c_l_context.html#a5eac23c56e1fa82a5383b9399cbc6a28">transform_uv</a>;</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160; </div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    <span class="comment">// Configurable options</span></div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160; </div>
<div class="line"><a name="l00280"></a><span class="lineno"><a class="line" href="struct_deshake_open_c_l_context.html#a7ae5c4772bc57a251f3cd25c5ba955be">  280</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="struct_deshake_open_c_l_context.html#a7ae5c4772bc57a251f3cd25c5ba955be">tripod_mode</a>;</div>
<div class="line"><a name="l00281"></a><span class="lineno"><a class="line" href="struct_deshake_open_c_l_context.html#af53b59cc19d39adb77f6337cbc132b07">  281</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="struct_deshake_open_c_l_context.html#af53b59cc19d39adb77f6337cbc132b07">debug_on</a>;</div>
<div class="line"><a name="l00282"></a><span class="lineno"><a class="line" href="struct_deshake_open_c_l_context.html#afebbd432ac813cb40ddfe331b4437d89">  282</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="struct_deshake_open_c_l_context.html#afebbd432ac813cb40ddfe331b4437d89">should_crop</a>;</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160; </div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    <span class="comment">// Whether or not feature points should be refined at a sub-pixel level</span></div>
<div class="line"><a name="l00285"></a><span class="lineno"><a class="line" href="struct_deshake_open_c_l_context.html#a9c380b1b1aa8527f665473a651e5a1c4">  285</a></span>&#160;    cl_int <a class="code" href="struct_deshake_open_c_l_context.html#a9c380b1b1aa8527f665473a651e5a1c4">refine_features</a>;</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    <span class="comment">// If the user sets a value other than the default, 0, this percentage is</span></div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    <span class="comment">// translated into a sigma value ranging from 0.5 to 40.0</span></div>
<div class="line"><a name="l00288"></a><span class="lineno"><a class="line" href="struct_deshake_open_c_l_context.html#a54085661b99c1e0c7034c6c0cad3be52">  288</a></span>&#160;    <span class="keywordtype">float</span> <a class="code" href="struct_deshake_open_c_l_context.html#a54085661b99c1e0c7034c6c0cad3be52">smooth_percent</a>;</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    <span class="comment">// This number is multiplied by the video frame rate to determine the size</span></div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    <span class="comment">// of the smooth window</span></div>
<div class="line"><a name="l00291"></a><span class="lineno"><a class="line" href="struct_deshake_open_c_l_context.html#a8f9da09912ebcdbb1bc59a5d75f74e86">  291</a></span>&#160;    <span class="keywordtype">float</span> <a class="code" href="struct_deshake_open_c_l_context.html#a8f9da09912ebcdbb1bc59a5d75f74e86">smooth_window_multiplier</a>;</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160; </div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    <span class="comment">// Debug stuff</span></div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160; </div>
<div class="line"><a name="l00295"></a><span class="lineno"><a class="line" href="struct_deshake_open_c_l_context.html#aa3332ab582d637e85277c04f340b8fa6">  295</a></span>&#160;    cl_kernel <a class="code" href="struct_deshake_open_c_l_context.html#aa3332ab582d637e85277c04f340b8fa6">kernel_draw_debug_info</a>;</div>
<div class="line"><a name="l00296"></a><span class="lineno"><a class="line" href="struct_deshake_open_c_l_context.html#ac220506f512606ac340a1c006b242d9c">  296</a></span>&#160;    cl_mem <a class="code" href="struct_deshake_open_c_l_context.html#ac220506f512606ac340a1c006b242d9c">debug_matches</a>;</div>
<div class="line"><a name="l00297"></a><span class="lineno"><a class="line" href="struct_deshake_open_c_l_context.html#a57027e4f486537b2be43c331122e1012">  297</a></span>&#160;    cl_mem <a class="code" href="struct_deshake_open_c_l_context.html#a57027e4f486537b2be43c331122e1012">debug_model_matches</a>;</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160; </div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    <span class="comment">// These store the total time spent executing the different kernels in nanoseconds</span></div>
<div class="line"><a name="l00300"></a><span class="lineno"><a class="line" href="struct_deshake_open_c_l_context.html#a47dadaea7e4fbae9dbcfc22c935eada8">  300</a></span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> <a class="code" href="struct_deshake_open_c_l_context.html#a47dadaea7e4fbae9dbcfc22c935eada8">grayscale_time</a>;</div>
<div class="line"><a name="l00301"></a><span class="lineno"><a class="line" href="struct_deshake_open_c_l_context.html#a0dc75da84837a440352d277911b7ac2f">  301</a></span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> <a class="code" href="struct_deshake_open_c_l_context.html#a0dc75da84837a440352d277911b7ac2f">harris_response_time</a>;</div>
<div class="line"><a name="l00302"></a><span class="lineno"><a class="line" href="struct_deshake_open_c_l_context.html#a3a240a85dceb2b2336bf3230bd4ebc36">  302</a></span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> <a class="code" href="struct_deshake_open_c_l_context.html#a3a240a85dceb2b2336bf3230bd4ebc36">refine_features_time</a>;</div>
<div class="line"><a name="l00303"></a><span class="lineno"><a class="line" href="struct_deshake_open_c_l_context.html#a1cd26a8dce26c3f5cbdbbf19ca88c6c3">  303</a></span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> <a class="code" href="struct_deshake_open_c_l_context.html#a1cd26a8dce26c3f5cbdbbf19ca88c6c3">brief_descriptors_time</a>;</div>
<div class="line"><a name="l00304"></a><span class="lineno"><a class="line" href="struct_deshake_open_c_l_context.html#a6994522939118f1aff64407eccc75261">  304</a></span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> <a class="code" href="struct_deshake_open_c_l_context.html#a6994522939118f1aff64407eccc75261">match_descriptors_time</a>;</div>
<div class="line"><a name="l00305"></a><span class="lineno"><a class="line" href="struct_deshake_open_c_l_context.html#a96d94e25fb2446f405147a0c9a46a769">  305</a></span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> <a class="code" href="struct_deshake_open_c_l_context.html#a96d94e25fb2446f405147a0c9a46a769">transform_time</a>;</div>
<div class="line"><a name="l00306"></a><span class="lineno"><a class="line" href="struct_deshake_open_c_l_context.html#ae96c83d6273eedf2402e2b59b2ff7905">  306</a></span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> <a class="code" href="struct_deshake_open_c_l_context.html#ae96c83d6273eedf2402e2b59b2ff7905">crop_upscale_time</a>;</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160; </div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    <span class="comment">// Time spent copying matched features from the device to the host</span></div>
<div class="line"><a name="l00309"></a><span class="lineno"><a class="line" href="struct_deshake_open_c_l_context.html#a2d119e5475c47905ac57b5289cc7798b">  309</a></span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> <a class="code" href="struct_deshake_open_c_l_context.html#a2d119e5475c47905ac57b5289cc7798b">read_buf_time</a>;</div>
<div class="line"><a name="l00310"></a><span class="lineno"><a class="line" href="vf__deshake__opencl_8c.html#a1e2fb9d8afcc831ea361958b31cc3eb2">  310</a></span>&#160;} <a class="code" href="vf__deshake__opencl_8c.html#a1e2fb9d8afcc831ea361958b31cc3eb2">DeshakeOpenCLContext</a>;</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160; </div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;<span class="comment">// Returns a random uniformly-distributed number in [low, high]</span></div>
<div class="line"><a name="l00313"></a><span class="lineno"><a class="line" href="vf__deshake__opencl_8c.html#a4ddbb86b2eab99c51940e4ea6bdc5af4">  313</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="vf__deshake__opencl_8c.html#a4ddbb86b2eab99c51940e4ea6bdc5af4">rand_in</a>(<span class="keywordtype">int</span> low, <span class="keywordtype">int</span> high, <a class="code" href="struct_a_v_l_f_g.html">AVLFG</a> *alfg) {</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    <span class="keywordflow">return</span> (<a class="code" href="lfg_8h.html#a58feb242e560adee0b7a16e11cce43e9">av_lfg_get</a>(alfg) % (high - low)) + low;</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;}</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160; </div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;<span class="comment">// Returns the average execution time for an event given the total time and the</span></div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;<span class="comment">// number of frames processed.</span></div>
<div class="line"><a name="l00319"></a><span class="lineno"><a class="line" href="vf__deshake__opencl_8c.html#a842030a6e61b33e1dfebf260817e112a">  319</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">double</span> <a class="code" href="vf__deshake__opencl_8c.html#a842030a6e61b33e1dfebf260817e112a">averaged_event_time_ms</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> total_time, <span class="keywordtype">int</span> num_frames) {</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    <span class="keywordflow">return</span> (<span class="keywordtype">double</span>)total_time / (double)num_frames / 1000000.0;</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;}</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160; </div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;<span class="comment">// The following code is loosely ported from OpenCV</span></div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160; </div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;<span class="comment">// Estimates affine transform from 3 point pairs</span></div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;<span class="comment">// model is a 2x3 matrix:</span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;<span class="comment">//      a b c</span></div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;<span class="comment">//      d e f</span></div>
<div class="line"><a name="l00329"></a><span class="lineno"><a class="line" href="vf__deshake__opencl_8c.html#a30cc92ce8ade04802bd88bb82bb0405d">  329</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="vf__deshake__opencl_8c.html#a30cc92ce8ade04802bd88bb82bb0405d">run_estimate_kernel</a>(<span class="keyword">const</span> <a class="code" href="struct_motion_vector.html">MotionVector</a> *point_pairs, <span class="keywordtype">double</span> *model)</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;{</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    <span class="comment">// src points</span></div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    <span class="keywordtype">double</span> x1 = point_pairs[0].<a class="code" href="struct_motion_vector.html#acb7c81a18a7fcdafce38520f1794ad92">p</a>.<a class="code" href="struct_point_pair.html#a2723179bf26cf06740f47f174a26dd4d">p1</a>.s[0];</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    <span class="keywordtype">double</span> y1 = point_pairs[0].<a class="code" href="struct_motion_vector.html#acb7c81a18a7fcdafce38520f1794ad92">p</a>.<a class="code" href="struct_point_pair.html#a2723179bf26cf06740f47f174a26dd4d">p1</a>.s[1];</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    <span class="keywordtype">double</span> x2 = point_pairs[1].<a class="code" href="struct_motion_vector.html#acb7c81a18a7fcdafce38520f1794ad92">p</a>.<a class="code" href="struct_point_pair.html#a2723179bf26cf06740f47f174a26dd4d">p1</a>.s[0];</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    <span class="keywordtype">double</span> y2 = point_pairs[1].<a class="code" href="struct_motion_vector.html#acb7c81a18a7fcdafce38520f1794ad92">p</a>.<a class="code" href="struct_point_pair.html#a2723179bf26cf06740f47f174a26dd4d">p1</a>.s[1];</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    <span class="keywordtype">double</span> x3 = point_pairs[2].<a class="code" href="struct_motion_vector.html#acb7c81a18a7fcdafce38520f1794ad92">p</a>.<a class="code" href="struct_point_pair.html#a2723179bf26cf06740f47f174a26dd4d">p1</a>.s[0];</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    <span class="keywordtype">double</span> y3 = point_pairs[2].<a class="code" href="struct_motion_vector.html#acb7c81a18a7fcdafce38520f1794ad92">p</a>.<a class="code" href="struct_point_pair.html#a2723179bf26cf06740f47f174a26dd4d">p1</a>.s[1];</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160; </div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    <span class="comment">// dest points</span></div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    <span class="keywordtype">double</span> X1 = point_pairs[0].<a class="code" href="struct_motion_vector.html#acb7c81a18a7fcdafce38520f1794ad92">p</a>.<a class="code" href="struct_point_pair.html#a38dcabbd5cea915755b9eba77ebc5427">p2</a>.s[0];</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    <span class="keywordtype">double</span> Y1 = point_pairs[0].<a class="code" href="struct_motion_vector.html#acb7c81a18a7fcdafce38520f1794ad92">p</a>.<a class="code" href="struct_point_pair.html#a38dcabbd5cea915755b9eba77ebc5427">p2</a>.s[1];</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    <span class="keywordtype">double</span> X2 = point_pairs[1].<a class="code" href="struct_motion_vector.html#acb7c81a18a7fcdafce38520f1794ad92">p</a>.<a class="code" href="struct_point_pair.html#a38dcabbd5cea915755b9eba77ebc5427">p2</a>.s[0];</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    <span class="keywordtype">double</span> Y2 = point_pairs[1].<a class="code" href="struct_motion_vector.html#acb7c81a18a7fcdafce38520f1794ad92">p</a>.<a class="code" href="struct_point_pair.html#a38dcabbd5cea915755b9eba77ebc5427">p2</a>.s[1];</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    <span class="keywordtype">double</span> X3 = point_pairs[2].<a class="code" href="struct_motion_vector.html#acb7c81a18a7fcdafce38520f1794ad92">p</a>.<a class="code" href="struct_point_pair.html#a38dcabbd5cea915755b9eba77ebc5427">p2</a>.s[0];</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    <span class="keywordtype">double</span> Y3 = point_pairs[2].<a class="code" href="struct_motion_vector.html#acb7c81a18a7fcdafce38520f1794ad92">p</a>.<a class="code" href="struct_point_pair.html#a38dcabbd5cea915755b9eba77ebc5427">p2</a>.s[1];</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160; </div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    <span class="keywordtype">double</span> d = 1.0 / ( x1*(y2-y3) + x2*(y3-y1) + x3*(y1-y2) );</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160; </div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    model[0] = d * ( X1*(y2-y3) + X2*(y3-y1) + X3*(y1-y2) );</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    model[1] = d * ( X1*(x3-x2) + X2*(x1-x3) + X3*(x2-x1) );</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    model[2] = d * ( X1*(x2*y3 - x3*y2) + X2*(x3*y1 - x1*y3) + X3*(x1*y2 - x2*y1) );</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160; </div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    model[3] = d * ( Y1*(y2-y3) + Y2*(y3-y1) + Y3*(y1-y2) );</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    model[4] = d * ( Y1*(x3-x2) + Y2*(x1-x3) + Y3*(x2-x1) );</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    model[5] = d * ( Y1*(x2*y3 - x3*y2) + Y2*(x3*y1 - x1*y3) + Y3*(x1*y2 - x2*y1) );</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;}</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160; </div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;<span class="comment">// Checks that the 3 points in the given array are not collinear</span></div>
<div class="line"><a name="l00359"></a><span class="lineno"><a class="line" href="vf__deshake__opencl_8c.html#a6a14a9679af60a3b5b6c9ac778290864">  359</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="vf__deshake__opencl_8c.html#a6a14a9679af60a3b5b6c9ac778290864">points_not_collinear</a>(<span class="keyword">const</span> cl_float2 **points)</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;{</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    <span class="keywordtype">int</span> j, k, <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 2;</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160; </div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>; j++) {</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;        <span class="keywordtype">double</span> dx1 = points[j]-&gt;s[0] - points[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;s[0];</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;        <span class="keywordtype">double</span> dy1 = points[j]-&gt;s[1] - points[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;s[1];</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160; </div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;        <span class="keywordflow">for</span> (k = 0; k &lt; j; k++) {</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;            <span class="keywordtype">double</span> dx2 = points[k]-&gt;s[0] - points[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;s[0];</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;            <span class="keywordtype">double</span> dy2 = points[k]-&gt;s[1] - points[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;s[1];</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160; </div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;            <span class="comment">// Assuming a 3840 x 2160 video with a point at (0, 0) and one at</span></div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;            <span class="comment">// (3839, 2159), this prevents a third point from being within roughly</span></div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;            <span class="comment">// 0.5 of a pixel of the line connecting the two on both axes</span></div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="cuda__runtime_8h.html#a7a87cd25426a228ce8ecbef48ab00de8">fabs</a>(dx2*dy1 - dy2*dx1) &lt;= 1.0) {</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;                <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;            }</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;        }</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    }</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160; </div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;}</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160; </div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;<span class="comment">// Checks a subset of 3 point pairs to make sure that the points are not collinear</span></div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;<span class="comment">// and not too close to each other</span></div>
<div class="line"><a name="l00385"></a><span class="lineno"><a class="line" href="vf__deshake__opencl_8c.html#a8ddfbb6d84d415a436ea86ae840b81fd">  385</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="vf__deshake__opencl_8c.html#a8ddfbb6d84d415a436ea86ae840b81fd">check_subset</a>(<span class="keyword">const</span> <a class="code" href="struct_motion_vector.html">MotionVector</a> *pairs_subset)</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;{</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;    <span class="keyword">const</span> cl_float2 *prev_points[] = {</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;        &amp;pairs_subset[0].<a class="code" href="struct_motion_vector.html#acb7c81a18a7fcdafce38520f1794ad92">p</a>.<a class="code" href="struct_point_pair.html#a2723179bf26cf06740f47f174a26dd4d">p1</a>,</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;        &amp;pairs_subset[1].<a class="code" href="struct_motion_vector.html#acb7c81a18a7fcdafce38520f1794ad92">p</a>.<a class="code" href="struct_point_pair.html#a2723179bf26cf06740f47f174a26dd4d">p1</a>,</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;        &amp;pairs_subset[2].<a class="code" href="struct_motion_vector.html#acb7c81a18a7fcdafce38520f1794ad92">p</a>.<a class="code" href="struct_point_pair.html#a2723179bf26cf06740f47f174a26dd4d">p1</a></div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;    };</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160; </div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    <span class="keyword">const</span> cl_float2 *curr_points[] = {</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;        &amp;pairs_subset[0].<a class="code" href="struct_motion_vector.html#acb7c81a18a7fcdafce38520f1794ad92">p</a>.<a class="code" href="struct_point_pair.html#a38dcabbd5cea915755b9eba77ebc5427">p2</a>,</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;        &amp;pairs_subset[1].<a class="code" href="struct_motion_vector.html#acb7c81a18a7fcdafce38520f1794ad92">p</a>.<a class="code" href="struct_point_pair.html#a38dcabbd5cea915755b9eba77ebc5427">p2</a>,</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;        &amp;pairs_subset[2].<a class="code" href="struct_motion_vector.html#acb7c81a18a7fcdafce38520f1794ad92">p</a>.<a class="code" href="struct_point_pair.html#a38dcabbd5cea915755b9eba77ebc5427">p2</a></div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    };</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160; </div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="vf__deshake__opencl_8c.html#a6a14a9679af60a3b5b6c9ac778290864">points_not_collinear</a>(prev_points) &amp;&amp; <a class="code" href="vf__deshake__opencl_8c.html#a6a14a9679af60a3b5b6c9ac778290864">points_not_collinear</a>(curr_points);</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;}</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160; </div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;<span class="comment">// Selects a random subset of 3 points from point_pairs and places them in pairs_subset</span></div>
<div class="line"><a name="l00403"></a><span class="lineno"><a class="line" href="vf__deshake__opencl_8c.html#acbbb850b53fb0195ed72a25734e1609f">  403</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="vf__deshake__opencl_8c.html#acbbb850b53fb0195ed72a25734e1609f">get_subset</a>(</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    <a class="code" href="struct_a_v_l_f_g.html">AVLFG</a> *alfg,</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;    <span class="keyword">const</span> <a class="code" href="struct_motion_vector.html">MotionVector</a> *point_pairs,</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> num_point_pairs,</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;    <a class="code" href="struct_motion_vector.html">MotionVector</a> *pairs_subset,</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    <span class="keywordtype">int</span> max_attempts</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;) {</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    <span class="keywordtype">int</span> idx[3];</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, j, iters = 0;</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160; </div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;    <span class="keywordflow">for</span> (; iters &lt; max_attempts; iters++) {</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; 3 &amp;&amp; iters &lt; max_attempts;) {</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;            <span class="keywordtype">int</span> idx_i = 0;</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160; </div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;            <span class="keywordflow">for</span> (;;) {</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;                idx_i = idx[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code" href="vf__deshake__opencl_8c.html#a4ddbb86b2eab99c51940e4ea6bdc5af4">rand_in</a>(0, num_point_pairs, alfg);</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160; </div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;                <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>; j++) {</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;                    <span class="keywordflow">if</span> (idx_i == idx[j]) {</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;                        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;                    }</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;                }</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160; </div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;                <span class="keywordflow">if</span> (j == <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;                }</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;            }</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160; </div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;            pairs_subset[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>] = point_pairs[idx[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>]];</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;            <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++;</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;        }</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160; </div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> == 3 &amp;&amp; !<a class="code" href="vf__deshake__opencl_8c.html#a8ddfbb6d84d415a436ea86ae840b81fd">check_subset</a>(pairs_subset)) {</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;        }</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;    }</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160; </div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> == 3 &amp;&amp; iters &lt; max_attempts;</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;}</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160; </div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;<span class="comment">// Computes the error for each of the given points based on the given model.</span></div>
<div class="line"><a name="l00445"></a><span class="lineno"><a class="line" href="vf__deshake__opencl_8c.html#a36f9cda70f2c32011a7370118a8a3877">  445</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="vf__deshake__opencl_8c.html#a36f9cda70f2c32011a7370118a8a3877">compute_error</a>(</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    <span class="keyword">const</span> <a class="code" href="struct_motion_vector.html">MotionVector</a> *point_pairs,</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> num_point_pairs,</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> *model,</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    <span class="keywordtype">float</span> *err</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;) {</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    <span class="keywordtype">double</span> F0 = model[0], <a class="code" href="cast5_8c.html#a0e9ed946a7660c126bbd39b503794ef7">F1</a> = model[1], <a class="code" href="cast5_8c.html#ab685025d5c2360da7a29094ccab00ad5">F2</a> = model[2];</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;    <span class="keywordtype">double</span> <a class="code" href="cast5_8c.html#aff7f98e5c83f59e0dd7abca3e5702904">F3</a> = model[3], F4 = model[4], F5 = model[5];</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160; </div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; num_point_pairs; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;        <span class="keyword">const</span> cl_float2 *<a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a> = &amp;point_pairs[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="struct_motion_vector.html#acb7c81a18a7fcdafce38520f1794ad92">p</a>.<a class="code" href="struct_point_pair.html#a2723179bf26cf06740f47f174a26dd4d">p1</a>;</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;        <span class="keyword">const</span> cl_float2 *t = &amp;point_pairs[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="struct_motion_vector.html#acb7c81a18a7fcdafce38520f1794ad92">p</a>.<a class="code" href="struct_point_pair.html#a38dcabbd5cea915755b9eba77ebc5427">p2</a>;</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160; </div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;        <span class="keywordtype">double</span> <a class="code" href="undefined_8txt.html#ad99f336d4c117c453fef82993434eb4d">a</a> = F0*<a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a>-&gt;s[0] + <a class="code" href="cast5_8c.html#a0e9ed946a7660c126bbd39b503794ef7">F1</a>*<a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a>-&gt;s[1] + <a class="code" href="cast5_8c.html#ab685025d5c2360da7a29094ccab00ad5">F2</a> - t-&gt;s[0];</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;        <span class="keywordtype">double</span> <a class="code" href="input_8c.html#ad6cdb6a14abe3eab42eaaadc93409aec">b</a> = <a class="code" href="cast5_8c.html#aff7f98e5c83f59e0dd7abca3e5702904">F3</a>*<a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a>-&gt;s[0] + F4*<a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a>-&gt;s[1] + F5 - t-&gt;s[1];</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160; </div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;        err[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code" href="undefined_8txt.html#ad99f336d4c117c453fef82993434eb4d">a</a>*<a class="code" href="undefined_8txt.html#ad99f336d4c117c453fef82993434eb4d">a</a> + <a class="code" href="input_8c.html#ad6cdb6a14abe3eab42eaaadc93409aec">b</a>*<a class="code" href="input_8c.html#ad6cdb6a14abe3eab42eaaadc93409aec">b</a>;</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;    }</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;}</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160; </div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;<span class="comment">// Determines which of the given point matches are inliers for the given model</span></div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;<span class="comment">// based on the specified threshold.</span></div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;<span class="comment">// err must be an array of num_point_pairs length</span></div>
<div class="line"><a name="l00469"></a><span class="lineno"><a class="line" href="vf__deshake__opencl_8c.html#af57797dd476bb0971eb7a7444d67e4e1">  469</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="vf__deshake__opencl_8c.html#af57797dd476bb0971eb7a7444d67e4e1">find_inliers</a>(</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    <a class="code" href="struct_motion_vector.html">MotionVector</a> *point_pairs,</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> num_point_pairs,</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> *model,</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    <span class="keywordtype">float</span> *err,</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    <span class="keywordtype">double</span> thresh</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;) {</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;    <span class="keywordtype">float</span> t = (float)(thresh * thresh);</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>, n = num_point_pairs, num_inliers = 0;</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160; </div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    <a class="code" href="vf__deshake__opencl_8c.html#a36f9cda70f2c32011a7370118a8a3877">compute_error</a>(point_pairs, num_point_pairs, model, err);</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160; </div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; n; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;        <span class="keywordflow">if</span> (err[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>] &lt;= t) {</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;            <span class="comment">// This is an inlier</span></div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;            point_pairs[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="struct_motion_vector.html#a9575b5b2610bb21eeb2550f2c13d922e">should_consider</a> = 1;</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;            num_inliers += 1;</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;            point_pairs[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="struct_motion_vector.html#a9575b5b2610bb21eeb2550f2c13d922e">should_consider</a> = 0;</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;        }</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;    }</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160; </div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;    <span class="keywordflow">return</span> num_inliers;</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;}</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160; </div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;<span class="comment">// Determines the number of iterations required to achieve the desired confidence level.</span></div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;<span class="comment">// The equation used to determine the number of iterations to do is:</span></div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;<span class="comment">// 1 - confidence = (1 - inlier_probability^num_points)^num_iters</span></div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;<span class="comment">// Solving for num_iters:</span></div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;<span class="comment">// num_iters = log(1 - confidence) / log(1 - inlier_probability^num_points)</span></div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;<span class="comment">// A more in-depth explanation can be found at https://en.wikipedia.org/wiki/Random_sample_consensus</span></div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;<span class="comment">// under the &#39;Parameters&#39; heading</span></div>
<div class="line"><a name="l00505"></a><span class="lineno"><a class="line" href="vf__deshake__opencl_8c.html#a9a86aeb5adfa66197a646bf68cc17346">  505</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="vf__deshake__opencl_8c.html#a9a86aeb5adfa66197a646bf68cc17346">ransac_update_num_iters</a>(<span class="keywordtype">double</span> confidence, <span class="keywordtype">double</span> num_outliers, <span class="keywordtype">int</span> max_iters)</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;{</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;    <span class="keywordtype">double</span> num, denom;</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160; </div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;    confidence   = av_clipd(confidence, 0.0, 1.0);</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;    num_outliers = av_clipd(num_outliers, 0.0, 1.0);</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160; </div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;    <span class="comment">// avoid inf&#39;s &amp; nan&#39;s</span></div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;    num = <a class="code" href="common_8h.html#a9960bd6780a9b16a216a57be1ee04359">FFMAX</a>(1.0 - confidence, DBL_MIN);</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;    denom = 1.0 - pow(1.0 - num_outliers, 3);</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;    <span class="keywordflow">if</span> (denom &lt; DBL_MIN) {</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;    }</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160; </div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;    num = log(num);</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    denom = log(denom);</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160; </div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;    <span class="keywordflow">return</span> denom &gt;= 0 || -num &gt;= max_iters * (-denom) ? max_iters : (<span class="keywordtype">int</span>)<a class="code" href="libm_8h.html#a7ddd290acf3fe2961676053dbbc2cec3">round</a>(num / denom);</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;}</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160; </div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;<span class="comment">// Estimates an affine transform between the given pairs of points using RANdom</span></div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;<span class="comment">// SAmple Consensus</span></div>
<div class="line"><a name="l00527"></a><span class="lineno"><a class="line" href="vf__deshake__opencl_8c.html#aac759b3a3a896f0967ba64248283d22b">  527</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="vf__deshake__opencl_8c.html#aac759b3a3a896f0967ba64248283d22b">estimate_affine_2d</a>(</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;    <a class="code" href="struct_deshake_open_c_l_context.html">DeshakeOpenCLContext</a> *deshake_ctx,</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;    <a class="code" href="struct_motion_vector.html">MotionVector</a> *point_pairs,</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;    <a class="code" href="struct_debug_matches.html">DebugMatches</a> *debug_matches,</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> num_point_pairs,</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;    <span class="keywordtype">double</span> *model_out,</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> threshold,</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> max_iters,</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> confidence</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;) {</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="filter__design_8txt.html#adf51c0fafb1c1b683c7f943c2a349904">result</a> = 0;</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;    <span class="keywordtype">double</span> best_model[6], model[6];</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;    <a class="code" href="struct_motion_vector.html">MotionVector</a> pairs_subset[3], best_pairs[3];</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160; </div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;    <span class="keywordtype">int</span> iter, niters = <a class="code" href="common_8h.html#a9960bd6780a9b16a216a57be1ee04359">FFMAX</a>(max_iters, 1);</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;    <span class="keywordtype">int</span> good_count, max_good_count = 0;</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160; </div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;    <span class="comment">// We need at least 3 points to build a model from</span></div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;    <span class="keywordflow">if</span> (num_point_pairs &lt; 3) {</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (num_point_pairs == 3) {</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;        <span class="comment">// There are only 3 points, so RANSAC doesn&#39;t apply here</span></div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;        <a class="code" href="vf__deshake__opencl_8c.html#a30cc92ce8ade04802bd88bb82bb0405d">run_estimate_kernel</a>(point_pairs, model_out);</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160; </div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; 3; ++<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;            point_pairs[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="struct_motion_vector.html#a9575b5b2610bb21eeb2550f2c13d922e">should_consider</a> = 1;</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;        }</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160; </div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;        <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;    }</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160; </div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;    <span class="keywordflow">for</span> (iter = 0; iter &lt; niters; ++iter) {</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;        <span class="keywordtype">int</span> found = <a class="code" href="vf__deshake__opencl_8c.html#acbbb850b53fb0195ed72a25734e1609f">get_subset</a>(&amp;deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#ad524792607e91fe68042dbe400d0a4de">alfg</a>, point_pairs, num_point_pairs, pairs_subset, 10000);</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160; </div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;        <span class="keywordflow">if</span> (!found) {</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;            <span class="keywordflow">if</span> (iter == 0) {</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;                <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;            }</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160; </div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;        }</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160; </div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;        <a class="code" href="vf__deshake__opencl_8c.html#a30cc92ce8ade04802bd88bb82bb0405d">run_estimate_kernel</a>(pairs_subset, model);</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;        good_count = <a class="code" href="vf__deshake__opencl_8c.html#af57797dd476bb0971eb7a7444d67e4e1">find_inliers</a>(point_pairs, num_point_pairs, model, deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#a8ac38dcf0b23b1e13eee252d5c0ac3fc">ransac_err</a>, threshold);</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160; </div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;        <span class="keywordflow">if</span> (good_count &gt; <a class="code" href="common_8h.html#a9960bd6780a9b16a216a57be1ee04359">FFMAX</a>(max_good_count, 2)) {</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="vf__colormatrix_8c.html#a9652b617fc0258128c53a9a98e5e9289">mi</a> = 0; <a class="code" href="vf__colormatrix_8c.html#a9652b617fc0258128c53a9a98e5e9289">mi</a> &lt; 6; ++<a class="code" href="vf__colormatrix_8c.html#a9652b617fc0258128c53a9a98e5e9289">mi</a>) {</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;                best_model[<a class="code" href="vf__colormatrix_8c.html#a9652b617fc0258128c53a9a98e5e9289">mi</a>] = model[<a class="code" href="vf__colormatrix_8c.html#a9652b617fc0258128c53a9a98e5e9289">mi</a>];</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;            }</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160; </div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> pi = 0; pi &lt; 3; pi++) {</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;                best_pairs[pi] = pairs_subset[pi];</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;            }</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160; </div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;            max_good_count = good_count;</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;            niters = <a class="code" href="vf__deshake__opencl_8c.html#a9a86aeb5adfa66197a646bf68cc17346">ransac_update_num_iters</a>(</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;                confidence,</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;                (<span class="keywordtype">double</span>)(num_point_pairs - good_count) / num_point_pairs,</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;                niters</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;            );</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;        }</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;    }</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160; </div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;    <span class="keywordflow">if</span> (max_good_count &gt; 0) {</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="vf__colormatrix_8c.html#a9652b617fc0258128c53a9a98e5e9289">mi</a> = 0; <a class="code" href="vf__colormatrix_8c.html#a9652b617fc0258128c53a9a98e5e9289">mi</a> &lt; 6; ++<a class="code" href="vf__colormatrix_8c.html#a9652b617fc0258128c53a9a98e5e9289">mi</a>) {</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;            model_out[<a class="code" href="vf__colormatrix_8c.html#a9652b617fc0258128c53a9a98e5e9289">mi</a>] = best_model[<a class="code" href="vf__colormatrix_8c.html#a9652b617fc0258128c53a9a98e5e9289">mi</a>];</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;        }</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160; </div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> pi = 0; pi &lt; 3; ++pi) {</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;            debug_matches-&gt;<a class="code" href="struct_debug_matches.html#abd79e59e862cfd147ea9dbff77881c1e">model_matches</a>[pi] = best_pairs[pi];</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;        }</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;        debug_matches-&gt;<a class="code" href="struct_debug_matches.html#a1445bdc06f80d04a082a8ca170665b93">num_model_matches</a> = 3;</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160; </div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;        <span class="comment">// Find the inliers again for the best model for debugging</span></div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;        <a class="code" href="vf__deshake__opencl_8c.html#af57797dd476bb0971eb7a7444d67e4e1">find_inliers</a>(point_pairs, num_point_pairs, best_model, deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#a8ac38dcf0b23b1e13eee252d5c0ac3fc">ransac_err</a>, threshold);</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;        <a class="code" href="filter__design_8txt.html#adf51c0fafb1c1b683c7f943c2a349904">result</a> = 1;</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;    }</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160; </div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf51c0fafb1c1b683c7f943c2a349904">result</a>;</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;}</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160; </div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;<span class="comment">// &quot;Wiggles&quot; the first point in best_pairs around a tiny bit in order to decrease the</span></div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;<span class="comment">// total error</span></div>
<div class="line"><a name="l00610"></a><span class="lineno"><a class="line" href="vf__deshake__opencl_8c.html#a00885c773e3a47ac0abf8ada377685dc">  610</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="vf__deshake__opencl_8c.html#a00885c773e3a47ac0abf8ada377685dc">optimize_model</a>(</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;    <a class="code" href="struct_deshake_open_c_l_context.html">DeshakeOpenCLContext</a> *deshake_ctx,</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;    <a class="code" href="struct_motion_vector.html">MotionVector</a> *best_pairs,</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;    <a class="code" href="struct_motion_vector.html">MotionVector</a> *inliers,</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> num_inliers,</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;    <span class="keywordtype">float</span> best_err,</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;    <span class="keywordtype">double</span> *model_out</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;) {</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;    <span class="keywordtype">float</span> move_x_val = 0.01;</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;    <span class="keywordtype">float</span> move_y_val = 0.01;</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;    <span class="keywordtype">int</span> move_x = 1;</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;    <span class="keywordtype">float</span> old_move_x_val = 0;</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;    <span class="keywordtype">double</span> model[6];</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;    <span class="keywordtype">int</span> last_changed = 0;</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160; </div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iters = 0; iters &lt; 200; iters++) {</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;        <span class="keywordtype">float</span> total_err = 0;</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160; </div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;        <span class="keywordflow">if</span> (move_x) {</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;            best_pairs[0].<a class="code" href="struct_motion_vector.html#acb7c81a18a7fcdafce38520f1794ad92">p</a>.<a class="code" href="struct_point_pair.html#a38dcabbd5cea915755b9eba77ebc5427">p2</a>.s[0] += move_x_val;</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;            best_pairs[0].<a class="code" href="struct_motion_vector.html#acb7c81a18a7fcdafce38520f1794ad92">p</a>.<a class="code" href="struct_point_pair.html#a38dcabbd5cea915755b9eba77ebc5427">p2</a>.s[0] += move_y_val;</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;        }</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160; </div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;        <a class="code" href="vf__deshake__opencl_8c.html#a30cc92ce8ade04802bd88bb82bb0405d">run_estimate_kernel</a>(best_pairs, model);</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;        <a class="code" href="vf__deshake__opencl_8c.html#a36f9cda70f2c32011a7370118a8a3877">compute_error</a>(inliers, num_inliers, model, deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#a8ac38dcf0b23b1e13eee252d5c0ac3fc">ransac_err</a>);</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160; </div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; num_inliers; j++) {</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;            total_err += deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#a8ac38dcf0b23b1e13eee252d5c0ac3fc">ransac_err</a>[j];</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;        }</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160; </div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;        <span class="keywordflow">if</span> (total_err &lt; best_err) {</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="vf__colormatrix_8c.html#a9652b617fc0258128c53a9a98e5e9289">mi</a> = 0; <a class="code" href="vf__colormatrix_8c.html#a9652b617fc0258128c53a9a98e5e9289">mi</a> &lt; 6; ++<a class="code" href="vf__colormatrix_8c.html#a9652b617fc0258128c53a9a98e5e9289">mi</a>) {</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;                model_out[<a class="code" href="vf__colormatrix_8c.html#a9652b617fc0258128c53a9a98e5e9289">mi</a>] = model[<a class="code" href="vf__colormatrix_8c.html#a9652b617fc0258128c53a9a98e5e9289">mi</a>];</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;            }</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160; </div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;            best_err = total_err;</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;            last_changed = iters;</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;            <span class="comment">// Undo the change</span></div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;            <span class="keywordflow">if</span> (move_x) {</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;                best_pairs[0].<a class="code" href="struct_motion_vector.html#acb7c81a18a7fcdafce38520f1794ad92">p</a>.<a class="code" href="struct_point_pair.html#a38dcabbd5cea915755b9eba77ebc5427">p2</a>.s[0] -= move_x_val;</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;                best_pairs[0].<a class="code" href="struct_motion_vector.html#acb7c81a18a7fcdafce38520f1794ad92">p</a>.<a class="code" href="struct_point_pair.html#a38dcabbd5cea915755b9eba77ebc5427">p2</a>.s[0] -= move_y_val;</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;            }</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160; </div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;            <span class="keywordflow">if</span> (iters - last_changed &gt; 4) {</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;                <span class="comment">// We&#39;ve already improved the model as much as we can</span></div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;            }</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160; </div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;            old_move_x_val = move_x_val;</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160; </div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;            <span class="keywordflow">if</span> (move_x) {</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;                move_x_val *= -1;</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;                move_y_val *= -1;</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;            }</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160; </div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;            <span class="keywordflow">if</span> (old_move_x_val &lt; 0) {</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;                move_x = 0;</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;                move_x = 1;</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;            }</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;        }</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;    }</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;}</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160; </div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;<span class="comment">// Uses a process similar to that of RANSAC to find a transform that minimizes</span></div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;<span class="comment">// the total error for a set of point matches determined to be inliers</span></div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;<span class="comment">// (Pick random subsets, compute model, find total error, iterate until error</span></div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;<span class="comment">// is minimized.)</span></div>
<div class="line"><a name="l00683"></a><span class="lineno"><a class="line" href="vf__deshake__opencl_8c.html#a478b505dff6bf71827cc70437b0515b0">  683</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="vf__deshake__opencl_8c.html#a478b505dff6bf71827cc70437b0515b0">minimize_error</a>(</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;    <a class="code" href="struct_deshake_open_c_l_context.html">DeshakeOpenCLContext</a> *deshake_ctx,</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;    <a class="code" href="struct_motion_vector.html">MotionVector</a> *inliers,</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;    <a class="code" href="struct_debug_matches.html">DebugMatches</a> *debug_matches,</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> num_inliers,</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;    <span class="keywordtype">double</span> *model_out,</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> max_iters</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;) {</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="filter__design_8txt.html#adf51c0fafb1c1b683c7f943c2a349904">result</a> = 0;</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;    <span class="keywordtype">float</span> best_err = FLT_MAX;</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;    <span class="keywordtype">double</span> best_model[6], model[6];</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;    <a class="code" href="struct_motion_vector.html">MotionVector</a> pairs_subset[3], best_pairs[3];</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160; </div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; max_iters; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;        <span class="keywordtype">float</span> total_err = 0;</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;        <span class="keywordtype">int</span> found = <a class="code" href="vf__deshake__opencl_8c.html#acbbb850b53fb0195ed72a25734e1609f">get_subset</a>(&amp;deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#ad524792607e91fe68042dbe400d0a4de">alfg</a>, inliers, num_inliers, pairs_subset, 10000);</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160; </div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;        <span class="keywordflow">if</span> (!found) {</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> == 0) {</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;                <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;            }</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160; </div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;        }</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160; </div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;        <a class="code" href="vf__deshake__opencl_8c.html#a30cc92ce8ade04802bd88bb82bb0405d">run_estimate_kernel</a>(pairs_subset, model);</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;        <a class="code" href="vf__deshake__opencl_8c.html#a36f9cda70f2c32011a7370118a8a3877">compute_error</a>(inliers, num_inliers, model, deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#a8ac38dcf0b23b1e13eee252d5c0ac3fc">ransac_err</a>);</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160; </div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; num_inliers; j++) {</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;            total_err += deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#a8ac38dcf0b23b1e13eee252d5c0ac3fc">ransac_err</a>[j];</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;        }</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160; </div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;        <span class="keywordflow">if</span> (total_err &lt; best_err) {</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="vf__colormatrix_8c.html#a9652b617fc0258128c53a9a98e5e9289">mi</a> = 0; <a class="code" href="vf__colormatrix_8c.html#a9652b617fc0258128c53a9a98e5e9289">mi</a> &lt; 6; ++<a class="code" href="vf__colormatrix_8c.html#a9652b617fc0258128c53a9a98e5e9289">mi</a>) {</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;                best_model[<a class="code" href="vf__colormatrix_8c.html#a9652b617fc0258128c53a9a98e5e9289">mi</a>] = model[<a class="code" href="vf__colormatrix_8c.html#a9652b617fc0258128c53a9a98e5e9289">mi</a>];</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;            }</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160; </div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> pi = 0; pi &lt; 3; pi++) {</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;                best_pairs[pi] = pairs_subset[pi];</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;            }</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160; </div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;            best_err = total_err;</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;        }</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;    }</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160; </div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="vf__colormatrix_8c.html#a9652b617fc0258128c53a9a98e5e9289">mi</a> = 0; <a class="code" href="vf__colormatrix_8c.html#a9652b617fc0258128c53a9a98e5e9289">mi</a> &lt; 6; ++<a class="code" href="vf__colormatrix_8c.html#a9652b617fc0258128c53a9a98e5e9289">mi</a>) {</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;        model_out[<a class="code" href="vf__colormatrix_8c.html#a9652b617fc0258128c53a9a98e5e9289">mi</a>] = best_model[<a class="code" href="vf__colormatrix_8c.html#a9652b617fc0258128c53a9a98e5e9289">mi</a>];</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;    }</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160; </div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> pi = 0; pi &lt; 3; ++pi) {</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;        debug_matches-&gt;<a class="code" href="struct_debug_matches.html#abd79e59e862cfd147ea9dbff77881c1e">model_matches</a>[pi] = best_pairs[pi];</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;    }</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;    debug_matches-&gt;<a class="code" href="struct_debug_matches.html#a1445bdc06f80d04a082a8ca170665b93">num_model_matches</a> = 3;</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;    <a class="code" href="filter__design_8txt.html#adf51c0fafb1c1b683c7f943c2a349904">result</a> = 1;</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160; </div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;    <a class="code" href="vf__deshake__opencl_8c.html#a00885c773e3a47ac0abf8ada377685dc">optimize_model</a>(deshake_ctx, best_pairs, inliers, num_inliers, best_err, model_out);</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf51c0fafb1c1b683c7f943c2a349904">result</a>;</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;}</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160; </div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;<span class="comment">// End code from OpenCV</span></div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160; </div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;<span class="comment">// Decomposes a similarity matrix into translation, rotation, scale, and skew</span></div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;<span class="comment">// See http://frederic-wang.fr/decomposition-of-2d-transform-matrices.html</span></div>
<div class="line"><a name="l00747"></a><span class="lineno"><a class="line" href="vf__deshake__opencl_8c.html#a29f077a9126bf10d4893bb1750c36c91">  747</a></span>&#160;<span class="keyword">static</span> <a class="code" href="struct_frame_delta.html">FrameDelta</a> <a class="code" href="vf__deshake__opencl_8c.html#a29f077a9126bf10d4893bb1750c36c91">decompose_transform</a>(<span class="keywordtype">double</span> *model)</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;{</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;    <a class="code" href="struct_frame_delta.html">FrameDelta</a> <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>;</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160; </div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;    <span class="keywordtype">double</span> <a class="code" href="undefined_8txt.html#ad99f336d4c117c453fef82993434eb4d">a</a> = model[0];</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;    <span class="keywordtype">double</span> <a class="code" href="undefined_8txt.html#a12d8853991e25cc8d069554379c29ef6">c</a> = model[1];</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;    <span class="keywordtype">double</span> e = model[2];</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;    <span class="keywordtype">double</span> <a class="code" href="input_8c.html#ad6cdb6a14abe3eab42eaaadc93409aec">b</a> = model[3];</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;    <span class="keywordtype">double</span> d = model[4];</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;    <span class="keywordtype">double</span> <a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a> = model[5];</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;    <span class="keywordtype">double</span> <a class="code" href="vorbis__enc__data_8h.html#a1ee4a05b54419bfadd66ee351d05812e">delta</a> = <a class="code" href="undefined_8txt.html#ad99f336d4c117c453fef82993434eb4d">a</a> * d - <a class="code" href="input_8c.html#ad6cdb6a14abe3eab42eaaadc93409aec">b</a> * <a class="code" href="undefined_8txt.html#a12d8853991e25cc8d069554379c29ef6">c</a>;</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160; </div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;    memset(&amp;<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>, 0, <span class="keyword">sizeof</span>(<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>));</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160; </div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;    <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>.translation.s[0] = e;</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;    <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>.translation.s[1] = <a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a>;</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160; </div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;    <span class="comment">// This is the QR method</span></div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="undefined_8txt.html#ad99f336d4c117c453fef82993434eb4d">a</a> != 0 || <a class="code" href="input_8c.html#ad6cdb6a14abe3eab42eaaadc93409aec">b</a> != 0) {</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;        <span class="keywordtype">double</span> <a class="code" href="vf__curves_8c.html#a33ac7b8ce37a3a60855883424fcf8b62">r</a> = <a class="code" href="libm_8h.html#a364edfcde984bdfbc031ae0b2ddd6e38">hypot</a>(<a class="code" href="undefined_8txt.html#ad99f336d4c117c453fef82993434eb4d">a</a>, <a class="code" href="input_8c.html#ad6cdb6a14abe3eab42eaaadc93409aec">b</a>);</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160; </div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;        <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>.rotation = <a class="code" href="common_8h.html#af5e4ff7761996bc901e59bd59756268d">FFSIGN</a>(<a class="code" href="input_8c.html#ad6cdb6a14abe3eab42eaaadc93409aec">b</a>) * acos(<a class="code" href="undefined_8txt.html#ad99f336d4c117c453fef82993434eb4d">a</a> / <a class="code" href="vf__curves_8c.html#a33ac7b8ce37a3a60855883424fcf8b62">r</a>);</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;        <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>.scale.s[0] = <a class="code" href="vf__curves_8c.html#a33ac7b8ce37a3a60855883424fcf8b62">r</a>;</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;        <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>.scale.s[1] = <a class="code" href="vorbis__enc__data_8h.html#a1ee4a05b54419bfadd66ee351d05812e">delta</a> / <a class="code" href="vf__curves_8c.html#a33ac7b8ce37a3a60855883424fcf8b62">r</a>;</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;        <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>.skew.s[0] = atan((<a class="code" href="undefined_8txt.html#ad99f336d4c117c453fef82993434eb4d">a</a> * <a class="code" href="undefined_8txt.html#a12d8853991e25cc8d069554379c29ef6">c</a> + <a class="code" href="input_8c.html#ad6cdb6a14abe3eab42eaaadc93409aec">b</a> * d) / (<a class="code" href="vf__curves_8c.html#a33ac7b8ce37a3a60855883424fcf8b62">r</a> * <a class="code" href="vf__curves_8c.html#a33ac7b8ce37a3a60855883424fcf8b62">r</a>));</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;        <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>.skew.s[1] = 0;</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="undefined_8txt.html#a12d8853991e25cc8d069554379c29ef6">c</a> != 0 || d != 0) {</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;        <span class="keywordtype">double</span> <a class="code" href="cbs__vp9_8c.html#a5950eda76c8ffc67651de936cd8c79ec">s</a> = sqrt(<a class="code" href="undefined_8txt.html#a12d8853991e25cc8d069554379c29ef6">c</a> * <a class="code" href="undefined_8txt.html#a12d8853991e25cc8d069554379c29ef6">c</a> + d * d);</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160; </div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;        <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>.rotation = <a class="code" href="mathematics_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a> / 2 - <a class="code" href="common_8h.html#af5e4ff7761996bc901e59bd59756268d">FFSIGN</a>(d) * acos(-<a class="code" href="undefined_8txt.html#a12d8853991e25cc8d069554379c29ef6">c</a> / <a class="code" href="cbs__vp9_8c.html#a5950eda76c8ffc67651de936cd8c79ec">s</a>);</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;        <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>.scale.s[0] = <a class="code" href="vorbis__enc__data_8h.html#a1ee4a05b54419bfadd66ee351d05812e">delta</a> / <a class="code" href="cbs__vp9_8c.html#a5950eda76c8ffc67651de936cd8c79ec">s</a>;</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;        <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>.scale.s[1] = <a class="code" href="cbs__vp9_8c.html#a5950eda76c8ffc67651de936cd8c79ec">s</a>;</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;        <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>.skew.s[0] = 0;</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;        <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>.skew.s[1] = atan((<a class="code" href="undefined_8txt.html#ad99f336d4c117c453fef82993434eb4d">a</a> * <a class="code" href="undefined_8txt.html#a12d8853991e25cc8d069554379c29ef6">c</a> + <a class="code" href="input_8c.html#ad6cdb6a14abe3eab42eaaadc93409aec">b</a> * d) / (<a class="code" href="cbs__vp9_8c.html#a5950eda76c8ffc67651de936cd8c79ec">s</a> * <a class="code" href="cbs__vp9_8c.html#a5950eda76c8ffc67651de936cd8c79ec">s</a>));</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;    } <span class="comment">// otherwise there is only translation</span></div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160; </div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>;</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;}</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160; </div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;<span class="comment">// Move valid vectors from the 2d buffer into a 1d buffer where they are contiguous</span></div>
<div class="line"><a name="l00787"></a><span class="lineno"><a class="line" href="vf__deshake__opencl_8c.html#a6f2f1655956e19d07d703031b77393bd">  787</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="vf__deshake__opencl_8c.html#a6f2f1655956e19d07d703031b77393bd">make_vectors_contig</a>(</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;    <a class="code" href="struct_deshake_open_c_l_context.html">DeshakeOpenCLContext</a> *deshake_ctx,</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;    <span class="keywordtype">int</span> size_y,</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;    <span class="keywordtype">int</span> size_x</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;) {</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;    <span class="keywordtype">int</span> num_vectors = 0;</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160; </div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; size_y; ++<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; size_x; ++j) {</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;            <a class="code" href="struct_motion_vector.html">MotionVector</a> v = deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#a8e05cd678122da9b5845b977e3222737">matches_host</a>[j + <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> * size_x];</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160; </div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;            <span class="keywordflow">if</span> (v.<a class="code" href="struct_motion_vector.html#a9575b5b2610bb21eeb2550f2c13d922e">should_consider</a>) {</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;                deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#ae6a887d019eba0c61fb9c40d2c773b06">matches_contig_host</a>[num_vectors] = v;</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;                ++num_vectors;</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;            }</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160; </div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;            <span class="comment">// Make sure we do not exceed the amount of space we allocated for these vectors</span></div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;            <span class="keywordflow">if</span> (num_vectors == <a class="code" href="vf__deshake__opencl_8c.html#a204a81d3183522f258d69d430fe4122e">MATCHES_CONTIG_SIZE</a> - 1) {</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;                <span class="keywordflow">return</span> num_vectors;</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;            }</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;        }</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;    }</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;    <span class="keywordflow">return</span> num_vectors;</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;}</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160; </div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;<span class="comment">// Returns the gaussian kernel value for the given x coordinate and sigma value</span></div>
<div class="line"><a name="l00813"></a><span class="lineno"><a class="line" href="vf__deshake__opencl_8c.html#a21d8250cfd99b8b03c3e7798fc86ff94">  813</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">float</span> <a class="code" href="vf__deshake__opencl_8c.html#a21d8250cfd99b8b03c3e7798fc86ff94">gaussian_for</a>(<span class="keywordtype">int</span> x, <span class="keywordtype">float</span> sigma) {</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;    <span class="keywordflow">return</span> 1.0f / <a class="code" href="libm_8h.html#a70609775e8ac20380d4382942f88c7b4">expf</a>(((<span class="keywordtype">float</span>)x * (<span class="keywordtype">float</span>)x) / (2.0<a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a> * sigma * sigma));</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;}</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160; </div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;<span class="comment">// Makes a normalized gaussian kernel of the given length for the given sigma</span></div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;<span class="comment">// and places it in gauss_kernel</span></div>
<div class="line"><a name="l00819"></a><span class="lineno"><a class="line" href="vf__deshake__opencl_8c.html#ad194e43933f3a2b31606a3152198eae4">  819</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="vf__deshake__opencl_8c.html#ad194e43933f3a2b31606a3152198eae4">make_gauss_kernel</a>(<span class="keywordtype">float</span> *gauss_kernel, <span class="keywordtype">float</span> length, <span class="keywordtype">float</span> sigma)</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;{</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;    <span class="keywordtype">float</span> gauss_sum = 0;</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;    <span class="keywordtype">int</span> window_half = length / 2;</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160; </div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; length; ++<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;        <span class="keywordtype">float</span> <a class="code" href="aeval_8c.html#a16aca557f352132b55bbc3c4769daa8b">val</a> = <a class="code" href="vf__deshake__opencl_8c.html#a21d8250cfd99b8b03c3e7798fc86ff94">gaussian_for</a>(<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> - window_half, sigma);</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160; </div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;        gauss_sum += <a class="code" href="aeval_8c.html#a16aca557f352132b55bbc3c4769daa8b">val</a>;</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;        gauss_kernel[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code" href="aeval_8c.html#a16aca557f352132b55bbc3c4769daa8b">val</a>;</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;    }</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160; </div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;    <span class="comment">// Normalize the gaussian values</span></div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; length; ++<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;        gauss_kernel[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>] /= gauss_sum;</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;    }</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;}</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160; </div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;<span class="comment">// Returns indices to start and end iteration at in order to iterate over a window</span></div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;<span class="comment">// of length size centered at the current frame in a ringbuffer</span></div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;<span class="comment">// Always returns numbers that result in a window of length size, even if that</span></div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;<span class="comment">// means specifying negative indices or indices past the end of the values in the</span></div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;<span class="comment">// ringbuffers. Make sure you clip indices appropriately within your loop.</span></div>
<div class="line"><a name="l00843"></a><span class="lineno"><a class="line" href="vf__deshake__opencl_8c.html#aaf257d81ebf7bdf695dc018cffba2da7">  843</a></span>&#160;<span class="keyword">static</span> <a class="code" href="struct_iter_indices.html">IterIndices</a> <a class="code" href="vf__deshake__opencl_8c.html#aaf257d81ebf7bdf695dc018cffba2da7">start_end_for</a>(<a class="code" href="struct_deshake_open_c_l_context.html">DeshakeOpenCLContext</a> *deshake_ctx, <span class="keywordtype">int</span> length) {</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;    <a class="code" href="struct_iter_indices.html">IterIndices</a> indices;</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160; </div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;    indices.<a class="code" href="struct_iter_indices.html#ae39d58c5950929136c2422c6617a041d">start</a> = deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#af41b236ec464389c9700936e54260726">abs_motion</a>.<a class="code" href="struct_absolute_frame_motion.html#ac0255cf0b9279f9a94b98e318380243e">curr_frame_offset</a> - (length / 2);</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;    indices.<a class="code" href="struct_iter_indices.html#aff2a431f9d303a170a41bd9546e70cde">end</a> = deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#af41b236ec464389c9700936e54260726">abs_motion</a>.<a class="code" href="struct_absolute_frame_motion.html#ac0255cf0b9279f9a94b98e318380243e">curr_frame_offset</a> + (length / 2) + (length % 2);</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160; </div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;    <span class="keywordflow">return</span> indices;</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;}</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160; </div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;<span class="comment">// Sets val to the value in the given ringbuffer at the given offset, taking care of</span></div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;<span class="comment">// clipping the offset into the appropriate range</span></div>
<div class="line"><a name="l00854"></a><span class="lineno"><a class="line" href="vf__deshake__opencl_8c.html#a4ed190bdc1f71da7f7bf78aaec510882">  854</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="vf__deshake__opencl_8c.html#a4ed190bdc1f71da7f7bf78aaec510882">ringbuf_float_at</a>(</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;    <a class="code" href="struct_deshake_open_c_l_context.html">DeshakeOpenCLContext</a> *deshake_ctx,</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;    <a class="code" href="struct_a_v_fifo_buffer.html">AVFifoBuffer</a> *<a class="code" href="filter__design_8txt.html#ad283c679febe22c5a4d36e3764daf32b">values</a>,</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;    <span class="keywordtype">float</span> *<a class="code" href="aeval_8c.html#a16aca557f352132b55bbc3c4769daa8b">val</a>,</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="writing__filters_8txt.html#ae1df9c886af8e844bb8849d403b76663">offset</a></div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;) {</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;    <span class="keywordtype">int</span> clip_start, clip_end, offset_clipped;</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;    <span class="keywordflow">if</span> (deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#af41b236ec464389c9700936e54260726">abs_motion</a>.<a class="code" href="struct_absolute_frame_motion.html#af13ee6297ce6688742784267660cb911">data_end_offset</a> != -1) {</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;        clip_end = deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#af41b236ec464389c9700936e54260726">abs_motion</a>.<a class="code" href="struct_absolute_frame_motion.html#af13ee6297ce6688742784267660cb911">data_end_offset</a>;</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;        <span class="comment">// This expression represents the last valid index in the buffer,</span></div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;        <span class="comment">// which we use repeatedly at the end of the video.</span></div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;        clip_end = deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#a4b73a586695575b9a355baae0432be1e">smooth_window</a> - (<a class="code" href="libavutil_2fifo_8c.html#ac1e0d8ee7f1568cb40fa95a740c60f13">av_fifo_space</a>(<a class="code" href="filter__design_8txt.html#ad283c679febe22c5a4d36e3764daf32b">values</a>) / <span class="keyword">sizeof</span>(float)) - 1;</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;    }</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160; </div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;    <span class="keywordflow">if</span> (deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#af41b236ec464389c9700936e54260726">abs_motion</a>.<a class="code" href="struct_absolute_frame_motion.html#ae3114642778302fa1dce520054e222c5">data_start_offset</a> != -1) {</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;        clip_start = deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#af41b236ec464389c9700936e54260726">abs_motion</a>.<a class="code" href="struct_absolute_frame_motion.html#ae3114642778302fa1dce520054e222c5">data_start_offset</a>;</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;        <span class="comment">// Negative indices will occur at the start of the video, and we want</span></div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;        <span class="comment">// them to be clipped to 0 in order to repeatedly use the position of</span></div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;        <span class="comment">// the first frame.</span></div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;        clip_start = 0;</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;    }</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160; </div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;    offset_clipped = av_clip(</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;        <a class="code" href="writing__filters_8txt.html#ae1df9c886af8e844bb8849d403b76663">offset</a>,</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;        clip_start,</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;        clip_end</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;    );</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160; </div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;    <a class="code" href="libavutil_2fifo_8c.html#ae44de4980b66c0695a4cf7808c140181">av_fifo_generic_peek_at</a>(</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;        <a class="code" href="filter__design_8txt.html#ad283c679febe22c5a4d36e3764daf32b">values</a>,</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;        <a class="code" href="aeval_8c.html#a16aca557f352132b55bbc3c4769daa8b">val</a>,</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;        offset_clipped * <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>),</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;        <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>),</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;        <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;    );</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;}</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160; </div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;<span class="comment">// Returns smoothed current frame value of the given buffer of floats based on the</span></div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;<span class="comment">// given Gaussian kernel and its length (also the window length, centered around the</span></div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;<span class="comment">// current frame) and the &quot;maximum value&quot; of the motion.</span></div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;<span class="comment">// This &quot;maximum value&quot; should be the width / height of the image in the case of</span></div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;<span class="comment">// translation and an empirically chosen constant for rotation / scale.</span></div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;<span class="comment">// The sigma chosen to generate the final gaussian kernel with used to smooth the</span></div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;<span class="comment">// camera path is either hardcoded (set by user, deshake_ctx-&gt;smooth_percent) or</span></div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;<span class="comment">// adaptively chosen.</span></div>
<div class="line"><a name="l00903"></a><span class="lineno"><a class="line" href="vf__deshake__opencl_8c.html#a32fee6ebcc3bc066f425852915a5bed6">  903</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">float</span> <a class="code" href="vf__deshake__opencl_8c.html#a32fee6ebcc3bc066f425852915a5bed6">smooth</a>(</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;    <a class="code" href="struct_deshake_open_c_l_context.html">DeshakeOpenCLContext</a> *deshake_ctx,</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;    <span class="keywordtype">float</span> *gauss_kernel,</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;    <span class="keywordtype">int</span> length,</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;    <span class="keywordtype">float</span> max_val,</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;    <a class="code" href="struct_a_v_fifo_buffer.html">AVFifoBuffer</a> *<a class="code" href="filter__design_8txt.html#ad283c679febe22c5a4d36e3764daf32b">values</a></div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;) {</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;    <span class="keywordtype">float</span> new_large_s = 0, new_small_s = 0, new_best = 0, old, diff_between,</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;          percent_of_max, inverted_percent;</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;    <a class="code" href="struct_iter_indices.html">IterIndices</a> indices = <a class="code" href="vf__deshake__opencl_8c.html#aaf257d81ebf7bdf695dc018cffba2da7">start_end_for</a>(deshake_ctx, length);</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;    <span class="keywordtype">float</span> large_sigma = 40.0f;</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;    <span class="keywordtype">float</span> small_sigma = 2.0f;</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;    <span class="keywordtype">float</span> best_sigma;</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160; </div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;    <span class="keywordflow">if</span> (deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#a54085661b99c1e0c7034c6c0cad3be52">smooth_percent</a>) {</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;        best_sigma = (large_sigma - 0.5f) * deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#a54085661b99c1e0c7034c6c0cad3be52">smooth_percent</a> + 0.5f;</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;        <span class="comment">// Strategy to adaptively smooth trajectory:</span></div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;        <span class="comment">//</span></div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;        <span class="comment">// 1. Smooth path with large and small sigma values</span></div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;        <span class="comment">// 2. Take the absolute value of the difference between them</span></div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;        <span class="comment">// 3. Get a percentage by putting the difference over the &quot;max value&quot;</span></div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;        <span class="comment">// 4, Invert the percentage</span></div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;        <span class="comment">// 5. Calculate a new sigma value weighted towards the larger sigma value</span></div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;        <span class="comment">// 6. Determine final smoothed trajectory value using that sigma</span></div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160; </div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;        <a class="code" href="vf__deshake__opencl_8c.html#ad194e43933f3a2b31606a3152198eae4">make_gauss_kernel</a>(gauss_kernel, length, large_sigma);</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = indices.<a class="code" href="struct_iter_indices.html#ae39d58c5950929136c2422c6617a041d">start</a>, j = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; indices.<a class="code" href="struct_iter_indices.html#aff2a431f9d303a170a41bd9546e70cde">end</a>; ++<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>, ++j) {</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;            <a class="code" href="vf__deshake__opencl_8c.html#a4ed190bdc1f71da7f7bf78aaec510882">ringbuf_float_at</a>(deshake_ctx, <a class="code" href="filter__design_8txt.html#ad283c679febe22c5a4d36e3764daf32b">values</a>, &amp;old, <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;            new_large_s += old * gauss_kernel[j];</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;        }</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160; </div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;        <a class="code" href="vf__deshake__opencl_8c.html#ad194e43933f3a2b31606a3152198eae4">make_gauss_kernel</a>(gauss_kernel, length, small_sigma);</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = indices.<a class="code" href="struct_iter_indices.html#ae39d58c5950929136c2422c6617a041d">start</a>, j = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; indices.<a class="code" href="struct_iter_indices.html#aff2a431f9d303a170a41bd9546e70cde">end</a>; ++<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>, ++j) {</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;            <a class="code" href="vf__deshake__opencl_8c.html#a4ed190bdc1f71da7f7bf78aaec510882">ringbuf_float_at</a>(deshake_ctx, <a class="code" href="filter__design_8txt.html#ad283c679febe22c5a4d36e3764daf32b">values</a>, &amp;old, <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;            new_small_s += old * gauss_kernel[j];</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;        }</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160; </div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;        diff_between = <a class="code" href="cuda__runtime_8h.html#a59c4f558e259b7fd968f8626da9187f7">fabsf</a>(new_large_s - new_small_s);</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;        percent_of_max = diff_between / max_val;</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;        inverted_percent = 1 - percent_of_max;</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;        best_sigma = large_sigma * <a class="code" href="libm_8h.html#ad1eb6660c7377c9b02883d77c5bf91e6">powf</a>(inverted_percent, 40);</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;    }</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160; </div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;    <a class="code" href="vf__deshake__opencl_8c.html#ad194e43933f3a2b31606a3152198eae4">make_gauss_kernel</a>(gauss_kernel, length, best_sigma);</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = indices.<a class="code" href="struct_iter_indices.html#ae39d58c5950929136c2422c6617a041d">start</a>, j = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; indices.<a class="code" href="struct_iter_indices.html#aff2a431f9d303a170a41bd9546e70cde">end</a>; ++<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>, ++j) {</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;        <a class="code" href="vf__deshake__opencl_8c.html#a4ed190bdc1f71da7f7bf78aaec510882">ringbuf_float_at</a>(deshake_ctx, <a class="code" href="filter__design_8txt.html#ad283c679febe22c5a4d36e3764daf32b">values</a>, &amp;old, <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;        new_best += old * gauss_kernel[j];</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;    }</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160; </div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;    <span class="keywordflow">return</span> new_best;</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;}</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160; </div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;<span class="comment">// Returns the position of the given point after the transform is applied</span></div>
<div class="line"><a name="l00957"></a><span class="lineno"><a class="line" href="vf__deshake__opencl_8c.html#af0745919fd99886bb935d32cc2c8dbb8">  957</a></span>&#160;<span class="keyword">static</span> cl_float2 <a class="code" href="vf__deshake__opencl_8c.html#af0745919fd99886bb935d32cc2c8dbb8">transformed_point</a>(<span class="keywordtype">float</span> x, <span class="keywordtype">float</span> y, <span class="keywordtype">float</span> *<a class="code" href="hevcdsp_8c.html#aa4607c9f8c7507415c1c10c59a2141b6">transform</a>) {</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;    cl_float2 <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>;</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160; </div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;    <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>.s[0] = x * <a class="code" href="hevcdsp_8c.html#aa4607c9f8c7507415c1c10c59a2141b6">transform</a>[0] + y * <a class="code" href="hevcdsp_8c.html#aa4607c9f8c7507415c1c10c59a2141b6">transform</a>[1] + <a class="code" href="hevcdsp_8c.html#aa4607c9f8c7507415c1c10c59a2141b6">transform</a>[2];</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;    <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>.s[1] = x * <a class="code" href="hevcdsp_8c.html#aa4607c9f8c7507415c1c10c59a2141b6">transform</a>[3] + y * <a class="code" href="hevcdsp_8c.html#aa4607c9f8c7507415c1c10c59a2141b6">transform</a>[4] + <a class="code" href="hevcdsp_8c.html#aa4607c9f8c7507415c1c10c59a2141b6">transform</a>[5];</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160; </div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>;</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;}</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160; </div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;<span class="comment">// Creates an affine transform that scales from the center of a frame</span></div>
<div class="line"><a name="l00967"></a><span class="lineno"><a class="line" href="vf__deshake__opencl_8c.html#a9163aad0cd348b8b75c90b4ee5b675d5">  967</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="vf__deshake__opencl_8c.html#a9163aad0cd348b8b75c90b4ee5b675d5">transform_center_scale</a>(</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;    <span class="keywordtype">float</span> x_shift,</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;    <span class="keywordtype">float</span> y_shift,</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;    <span class="keywordtype">float</span> angle,</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;    <span class="keywordtype">float</span> scale_x,</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;    <span class="keywordtype">float</span> scale_y,</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;    <span class="keywordtype">float</span> center_w,</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;    <span class="keywordtype">float</span> center_h,</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;    <span class="keywordtype">float</span> *matrix</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;) {</div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;    cl_float2 center_s;</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;    <span class="keywordtype">float</span> center_s_w, center_s_h;</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160; </div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;    <a class="code" href="transform_8c.html#a33249c4342a334d41b1c124ef28031cb">ff_get_matrix</a>(</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;        0,</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;        0,</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;        0,</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;        scale_x,</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;        scale_y,</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;        matrix</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;    );</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160; </div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;    center_s = <a class="code" href="vf__deshake__opencl_8c.html#af0745919fd99886bb935d32cc2c8dbb8">transformed_point</a>(center_w, center_h, matrix);</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;    center_s_w = center_w - center_s.s[0];</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;    center_s_h = center_h - center_s.s[1];</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160; </div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;    <a class="code" href="transform_8c.html#a33249c4342a334d41b1c124ef28031cb">ff_get_matrix</a>(</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;        x_shift + center_s_w,</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;        y_shift + center_s_h,</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;        angle,</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;        scale_x,</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;        scale_y,</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;        matrix</div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;    );</div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;}</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160; </div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;<span class="comment">// Determines the crop necessary to eliminate black borders from a smoothed frame</span></div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;<span class="comment">// and updates target crop accordingly</span></div>
<div class="line"><a name="l01005"></a><span class="lineno"><a class="line" href="vf__deshake__opencl_8c.html#aaeed07069929ebdb0d7ad7af57290562"> 1005</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="vf__deshake__opencl_8c.html#aaeed07069929ebdb0d7ad7af57290562">update_needed_crop</a>(</div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;    <a class="code" href="struct_crop_info.html">CropInfo</a>* crop,</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;    <span class="keywordtype">float</span> *<a class="code" href="hevcdsp_8c.html#aa4607c9f8c7507415c1c10c59a2141b6">transform</a>,</div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;    <span class="keywordtype">float</span> frame_width,</div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;    <span class="keywordtype">float</span> frame_height</div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;) {</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;    <span class="keywordtype">float</span> new_width, new_height, adjusted_width, adjusted_height, adjusted_x, adjusted_y;</div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160; </div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;    cl_float2 top_left = <a class="code" href="vf__deshake__opencl_8c.html#af0745919fd99886bb935d32cc2c8dbb8">transformed_point</a>(0, 0, <a class="code" href="hevcdsp_8c.html#aa4607c9f8c7507415c1c10c59a2141b6">transform</a>);</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;    cl_float2 top_right = <a class="code" href="vf__deshake__opencl_8c.html#af0745919fd99886bb935d32cc2c8dbb8">transformed_point</a>(frame_width, 0, <a class="code" href="hevcdsp_8c.html#aa4607c9f8c7507415c1c10c59a2141b6">transform</a>);</div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;    cl_float2 bottom_left = <a class="code" href="vf__deshake__opencl_8c.html#af0745919fd99886bb935d32cc2c8dbb8">transformed_point</a>(0, frame_height, <a class="code" href="hevcdsp_8c.html#aa4607c9f8c7507415c1c10c59a2141b6">transform</a>);</div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;    cl_float2 bottom_right = <a class="code" href="vf__deshake__opencl_8c.html#af0745919fd99886bb935d32cc2c8dbb8">transformed_point</a>(frame_width, frame_height, <a class="code" href="hevcdsp_8c.html#aa4607c9f8c7507415c1c10c59a2141b6">transform</a>);</div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;    <span class="keywordtype">float</span> ar_h = frame_height / frame_width;</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;    <span class="keywordtype">float</span> ar_w = frame_width / frame_height;</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160; </div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;    <span class="keywordflow">if</span> (crop-&gt;<a class="code" href="struct_crop_info.html#a021b9999edc9cb446f56c8d9ed44e8d5">bottom_right</a>.s[0] == 0) {</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;        <span class="comment">// The crop hasn&#39;t been set to the original size of the plane</span></div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;        crop-&gt;<a class="code" href="struct_crop_info.html#a021b9999edc9cb446f56c8d9ed44e8d5">bottom_right</a>.s[0] = frame_width;</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;        crop-&gt;<a class="code" href="struct_crop_info.html#a021b9999edc9cb446f56c8d9ed44e8d5">bottom_right</a>.s[1] = frame_height;</div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;    }</div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160; </div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;    crop-&gt;<a class="code" href="struct_crop_info.html#ae1943b8a3e6b5faca15573d739f83226">top_left</a>.s[0] = <a class="code" href="common_8h.html#a013fdaa079045ec5632fe121e211e516">FFMAX3</a>(</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;        crop-&gt;<a class="code" href="struct_crop_info.html#ae1943b8a3e6b5faca15573d739f83226">top_left</a>.s[0],</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;        top_left.s[0],</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;        bottom_left.s[0]</div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;    );</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160; </div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;    crop-&gt;<a class="code" href="struct_crop_info.html#ae1943b8a3e6b5faca15573d739f83226">top_left</a>.s[1] = <a class="code" href="common_8h.html#a013fdaa079045ec5632fe121e211e516">FFMAX3</a>(</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;        crop-&gt;<a class="code" href="struct_crop_info.html#ae1943b8a3e6b5faca15573d739f83226">top_left</a>.s[1],</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;        top_left.s[1],</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;        top_right.s[1]</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;    );</div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160; </div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;    crop-&gt;<a class="code" href="struct_crop_info.html#a021b9999edc9cb446f56c8d9ed44e8d5">bottom_right</a>.s[0] = <a class="code" href="common_8h.html#af6afbffa12562b076c34055bdcb3ad65">FFMIN3</a>(</div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;        crop-&gt;<a class="code" href="struct_crop_info.html#a021b9999edc9cb446f56c8d9ed44e8d5">bottom_right</a>.s[0],</div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;        bottom_right.s[0],</div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;        top_right.s[0]</div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;    );</div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160; </div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;    crop-&gt;<a class="code" href="struct_crop_info.html#a021b9999edc9cb446f56c8d9ed44e8d5">bottom_right</a>.s[1] = <a class="code" href="common_8h.html#af6afbffa12562b076c34055bdcb3ad65">FFMIN3</a>(</div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;        crop-&gt;<a class="code" href="struct_crop_info.html#a021b9999edc9cb446f56c8d9ed44e8d5">bottom_right</a>.s[1],</div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;        bottom_right.s[1],</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;        bottom_left.s[1]</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;    );</div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160; </div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;    <span class="comment">// Make sure our potentially new bounding box has the same aspect ratio</span></div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;    new_height = crop-&gt;<a class="code" href="struct_crop_info.html#a021b9999edc9cb446f56c8d9ed44e8d5">bottom_right</a>.s[1] - crop-&gt;<a class="code" href="struct_crop_info.html#ae1943b8a3e6b5faca15573d739f83226">top_left</a>.s[1];</div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;    new_width = crop-&gt;<a class="code" href="struct_crop_info.html#a021b9999edc9cb446f56c8d9ed44e8d5">bottom_right</a>.s[0] - crop-&gt;<a class="code" href="struct_crop_info.html#ae1943b8a3e6b5faca15573d739f83226">top_left</a>.s[0];</div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160; </div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;    adjusted_width = new_height * ar_w;</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;    adjusted_x = crop-&gt;<a class="code" href="struct_crop_info.html#a021b9999edc9cb446f56c8d9ed44e8d5">bottom_right</a>.s[0] - adjusted_width;</div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160; </div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;    <span class="keywordflow">if</span> (adjusted_x &gt;= crop-&gt;<a class="code" href="struct_crop_info.html#ae1943b8a3e6b5faca15573d739f83226">top_left</a>.s[0]) {</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;        crop-&gt;<a class="code" href="struct_crop_info.html#ae1943b8a3e6b5faca15573d739f83226">top_left</a>.s[0] = adjusted_x;</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;        adjusted_height = new_width * ar_h;</div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;        adjusted_y = crop-&gt;<a class="code" href="struct_crop_info.html#a021b9999edc9cb446f56c8d9ed44e8d5">bottom_right</a>.s[1] - adjusted_height;</div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;        crop-&gt;<a class="code" href="struct_crop_info.html#ae1943b8a3e6b5faca15573d739f83226">top_left</a>.s[1] = adjusted_y;</div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;    }</div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;}</div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160; </div>
<div class="line"><a name="l01066"></a><span class="lineno"><a class="line" href="vf__deshake__opencl_8c.html#a8a3ec369b17de7aad4fa5b00f8270411"> 1066</a></span>&#160;<span class="keyword">static</span> <a class="code" href="attributes_8h.html#abeeb324fff79a5335d36774704e2475c">av_cold</a> <span class="keywordtype">void</span> <a class="code" href="vf__deshake__opencl_8c.html#a8a3ec369b17de7aad4fa5b00f8270411">deshake_opencl_uninit</a>(<a class="code" href="struct_a_v_filter_context.html">AVFilterContext</a> *avctx)</div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;{</div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;    <a class="code" href="struct_deshake_open_c_l_context.html">DeshakeOpenCLContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a> = avctx-&gt;<a class="code" href="struct_a_v_filter_context.html#ab0858b4059e67889c7f27c5cc9e258eb">priv</a>;</div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;    cl_int cle;</div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160; </div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5a9113457a0b099555ded29c2f6a521cb7">RingbufCount</a>; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;        <a class="code" href="libavutil_2fifo_8c.html#a612be59edb6ab388a82d1487d1bd0c4d">av_fifo_freep</a>(&amp;<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;abs_motion.ringbuffers[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160; </div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;debug_on)</div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;        <a class="code" href="vf__deshake__opencl_8c.html#adc33dfb26baa854c039955d7439fe8c0">free_debug_matches</a>(&amp;<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;abs_motion);</div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160; </div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;gauss_kernel)</div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#adba82e1bcd02de510a858fcbedf79ef1">av_freep</a>(&amp;<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;gauss_kernel);</div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160; </div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;ransac_err)</div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#adba82e1bcd02de510a858fcbedf79ef1">av_freep</a>(&amp;<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;ransac_err);</div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160; </div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;matches_host)</div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#adba82e1bcd02de510a858fcbedf79ef1">av_freep</a>(&amp;<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;matches_host);</div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160; </div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;matches_contig_host)</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#adba82e1bcd02de510a858fcbedf79ef1">av_freep</a>(&amp;<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;matches_contig_host);</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160; </div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;inliers)</div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#adba82e1bcd02de510a858fcbedf79ef1">av_freep</a>(&amp;<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;inliers);</div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160; </div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;    <a class="code" href="framequeue_8c.html#ab667d4232d2fc65cc5e2766d3cbf4a44">ff_framequeue_free</a>(&amp;<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;fq);</div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160; </div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;    <a class="code" href="opencl_8h.html#a077a2c6a5e3fbd18f15ab3b7d1a5e157">CL_RELEASE_KERNEL</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;kernel_grayscale);</div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;    <a class="code" href="opencl_8h.html#a077a2c6a5e3fbd18f15ab3b7d1a5e157">CL_RELEASE_KERNEL</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;kernel_harris_response);</div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;    <a class="code" href="opencl_8h.html#a077a2c6a5e3fbd18f15ab3b7d1a5e157">CL_RELEASE_KERNEL</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;kernel_refine_features);</div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;    <a class="code" href="opencl_8h.html#a077a2c6a5e3fbd18f15ab3b7d1a5e157">CL_RELEASE_KERNEL</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;kernel_brief_descriptors);</div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;    <a class="code" href="opencl_8h.html#a077a2c6a5e3fbd18f15ab3b7d1a5e157">CL_RELEASE_KERNEL</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;kernel_match_descriptors);</div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;    <a class="code" href="opencl_8h.html#a077a2c6a5e3fbd18f15ab3b7d1a5e157">CL_RELEASE_KERNEL</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;kernel_crop_upscale);</div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;debug_on)</div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;        <a class="code" href="opencl_8h.html#a077a2c6a5e3fbd18f15ab3b7d1a5e157">CL_RELEASE_KERNEL</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;kernel_draw_debug_info);</div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160; </div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;    <a class="code" href="opencl_8h.html#af9c68815882f76b60a7b66529e0d5007">CL_RELEASE_QUEUE</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;command_queue);</div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160; </div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;is_yuv)</div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;        <a class="code" href="opencl_8h.html#aef0b96d45ea8cd517300a8309f673221">CL_RELEASE_MEMORY</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;grayscale);</div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;    <a class="code" href="opencl_8h.html#aef0b96d45ea8cd517300a8309f673221">CL_RELEASE_MEMORY</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;harris_buf);</div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;    <a class="code" href="opencl_8h.html#aef0b96d45ea8cd517300a8309f673221">CL_RELEASE_MEMORY</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;refined_features);</div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;    <a class="code" href="opencl_8h.html#aef0b96d45ea8cd517300a8309f673221">CL_RELEASE_MEMORY</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;prev_refined_features);</div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;    <a class="code" href="opencl_8h.html#aef0b96d45ea8cd517300a8309f673221">CL_RELEASE_MEMORY</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;brief_pattern);</div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;    <a class="code" href="opencl_8h.html#aef0b96d45ea8cd517300a8309f673221">CL_RELEASE_MEMORY</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;descriptors);</div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;    <a class="code" href="opencl_8h.html#aef0b96d45ea8cd517300a8309f673221">CL_RELEASE_MEMORY</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;prev_descriptors);</div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;    <a class="code" href="opencl_8h.html#aef0b96d45ea8cd517300a8309f673221">CL_RELEASE_MEMORY</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;matches);</div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;    <a class="code" href="opencl_8h.html#aef0b96d45ea8cd517300a8309f673221">CL_RELEASE_MEMORY</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;matches_contig);</div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;    <a class="code" href="opencl_8h.html#aef0b96d45ea8cd517300a8309f673221">CL_RELEASE_MEMORY</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;transform_y);</div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;    <a class="code" href="opencl_8h.html#aef0b96d45ea8cd517300a8309f673221">CL_RELEASE_MEMORY</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;transform_uv);</div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;debug_on) {</div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;        <a class="code" href="opencl_8h.html#aef0b96d45ea8cd517300a8309f673221">CL_RELEASE_MEMORY</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;debug_matches);</div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;        <a class="code" href="opencl_8h.html#aef0b96d45ea8cd517300a8309f673221">CL_RELEASE_MEMORY</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;debug_model_matches);</div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;    }</div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160; </div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;    <a class="code" href="opencl_8c.html#a36157d270f671e8d98d9c5a952eae5cd">ff_opencl_filter_uninit</a>(avctx);</div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;}</div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160; </div>
<div class="line"><a name="l01125"></a><span class="lineno"><a class="line" href="vf__deshake__opencl_8c.html#a129d88019af4c9f6579da1bb0b2aab3d"> 1125</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="vf__deshake__opencl_8c.html#a129d88019af4c9f6579da1bb0b2aab3d">deshake_opencl_init</a>(<a class="code" href="struct_a_v_filter_context.html">AVFilterContext</a> *avctx)</div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;{</div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;    <a class="code" href="struct_deshake_open_c_l_context.html">DeshakeOpenCLContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a> = avctx-&gt;<a class="code" href="struct_a_v_filter_context.html#ab0858b4059e67889c7f27c5cc9e258eb">priv</a>;</div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;    <a class="code" href="struct_a_v_filter_link.html">AVFilterLink</a> *outlink = avctx-&gt;<a class="code" href="struct_a_v_filter_context.html#ae9e65e98275f789bb5fbb72c52d4f3ad">outputs</a>[0];</div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;    <a class="code" href="struct_a_v_filter_link.html">AVFilterLink</a> *<a class="code" href="filter__design_8txt.html#a720b17cc89203cfc793b5d7e17a6ca88">inlink</a> = avctx-&gt;<a class="code" href="struct_a_v_filter_context.html#a6837bf4b3d70c0a2bd3122f9daadc0d4">inputs</a>[0];</div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;    <span class="comment">// Pointer to the host-side pattern buffer to be initialized and then copied</span></div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;    <span class="comment">// to the GPU</span></div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;    <a class="code" href="struct_point_pair.html">PointPair</a> *pattern_host = <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;    cl_int cle;</div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;    <span class="keywordtype">int</span> err;</div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;    cl_ulong8 zeroed_ulong8;</div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;    <a class="code" href="struct_f_f_frame_queue_global.html">FFFrameQueueGlobal</a> fqg;</div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;    cl_image_format grayscale_format;</div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;    cl_image_desc grayscale_desc;</div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;    cl_command_queue_properties queue_props;</div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160; </div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;    <span class="keyword">const</span> <span class="keyword">enum</span> <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5">AVPixelFormat</a> disallowed_formats[14] = {</div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;        <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5ad000ae47faa5fbe8d4b3b375151694ef">AV_PIX_FMT_GBRP</a>,</div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;        <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5aa1a4fd66f1f4d17ffcf23f360a010538">AV_PIX_FMT_GBRP9BE</a>,</div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;        <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a268f2be72d6a73c49a4ecc672b5f4628">AV_PIX_FMT_GBRP9LE</a>,</div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;        <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a15336747ffbc548ea27471d333cdf0e6">AV_PIX_FMT_GBRP10BE</a>,</div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;        <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5abad40e8c2ef081c630395e08593bffe4">AV_PIX_FMT_GBRP10LE</a>,</div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;        <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a9f08094c04f14344b51de97003ab0d54">AV_PIX_FMT_GBRP16BE</a>,</div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;        <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5aeb3f768331ce18fd5c6477a989a3ad37">AV_PIX_FMT_GBRP16LE</a>,</div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;        <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a87ab52104aeac9b13a39da1a09835bbc">AV_PIX_FMT_GBRAP</a>,</div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;        <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a6e4c926d3610ee2b013f037d4b22373f">AV_PIX_FMT_GBRAP16BE</a>,</div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;        <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5ad1af728e834504b8eb63f5560b7c8246">AV_PIX_FMT_GBRAP16LE</a>,</div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;        <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a412fb859c0c7de66dc0fee2464881927">AV_PIX_FMT_GBRAP12BE</a>,</div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;        <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5aa102709a993e4f42934630bc8b27ff52">AV_PIX_FMT_GBRAP12LE</a>,</div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;        <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5abd01a2f02df929264d07dc2c003a537e">AV_PIX_FMT_GBRAP10BE</a>,</div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;        <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5ac4c14311e40e6fba55adb3ade5d62bd9">AV_PIX_FMT_GBRAP10LE</a></div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;    };</div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160; </div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;    <span class="comment">// Number of elements for an array</span></div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> image_grid_32 = <a class="code" href="vf__deshake__opencl_8c.html#a85ec8441a811e55d823408e0b8d5bfd0">ROUNDED_UP_DIV</a>(outlink-&gt;<a class="code" href="struct_a_v_filter_link.html#a1efd10db9d097b6d27054da46e06e133">h</a>, 32) * <a class="code" href="vf__deshake__opencl_8c.html#a85ec8441a811e55d823408e0b8d5bfd0">ROUNDED_UP_DIV</a>(outlink-&gt;<a class="code" href="struct_a_v_filter_link.html#a08e3e25929bb29d5f6ef768343ff7f57">w</a>, 32);</div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160; </div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> descriptor_buf_size = image_grid_32 * (<a class="code" href="vf__deshake__opencl_8c.html#aa906eb01e76896e3890b54fecddc8ffc">BREIFN</a> / 8);</div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> features_buf_size = image_grid_32 * <span class="keyword">sizeof</span>(cl_float2);</div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160; </div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;    <span class="keyword">const</span> <a class="code" href="struct_a_v_h_w_frames_context.html">AVHWFramesContext</a> *hw_frames_ctx = (<a class="code" href="struct_a_v_h_w_frames_context.html">AVHWFramesContext</a>*)<a class="code" href="filter__design_8txt.html#a720b17cc89203cfc793b5d7e17a6ca88">inlink</a>-&gt;hw_frames_ctx-&gt;data;</div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;    <span class="keyword">const</span> <a class="code" href="struct_a_v_pix_fmt_descriptor.html">AVPixFmtDescriptor</a> *<a class="code" href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a> = <a class="code" href="pixdesc_8c.html#afe0c3e8aef5173de28bbdaea4298f5f0">av_pix_fmt_desc_get</a>(hw_frames_ctx-&gt;sw_format);</div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160; </div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;    <a class="code" href="avassert_8h.html#aae204192396f78cc8c5cd7ad5c57c23f">av_assert0</a>(hw_frames_ctx);</div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;    <a class="code" href="avassert_8h.html#aae204192396f78cc8c5cd7ad5c57c23f">av_assert0</a>(<a class="code" href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a>);</div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160; </div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;    <a class="code" href="framequeue_8c.html#abc3da492dbf358e6ab2520b6e3665ada">ff_framequeue_global_init</a>(&amp;fqg);</div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;    <a class="code" href="framequeue_8c.html#a7615fa0fc44ab6394a354c5f152faf93">ff_framequeue_init</a>(&amp;<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;fq, &amp;fqg);</div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;eof = 0;</div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;smooth_window = (<a class="code" href="ffmpeg__filter_8c.html#a61569f2965b7a369eb10b6d75d410d11">int</a>)(<a class="code" href="group__lavu__math__rational.html#ga935dbbf6bde8dfe5fa7ddb1da582eb07">av_q2d</a>(avctx-&gt;<a class="code" href="struct_a_v_filter_context.html#a6837bf4b3d70c0a2bd3122f9daadc0d4">inputs</a>[0]-&gt;<a class="code" href="struct_a_v_filter_link.html#a9711515003bff06b74d02adb751e8c78">frame_rate</a>) * <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;smooth_window_multiplier);</div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;curr_frame = 0;</div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160; </div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;    memset(&amp;zeroed_ulong8, 0, <span class="keyword">sizeof</span>(cl_ulong8));</div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160; </div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;gauss_kernel = <a class="code" href="mem_8c.html#a254f3455439c15a2c8a75b8f0235fdbd">av_malloc_array</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;smooth_window, <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));</div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;gauss_kernel) {</div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;        err = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;    }</div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160; </div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;ransac_err = <a class="code" href="mem_8c.html#a254f3455439c15a2c8a75b8f0235fdbd">av_malloc_array</a>(<a class="code" href="vf__deshake__opencl_8c.html#a204a81d3183522f258d69d430fe4122e">MATCHES_CONTIG_SIZE</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));</div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;ransac_err) {</div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;        err = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;    }</div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160; </div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5a9113457a0b099555ded29c2f6a521cb7">RingbufCount</a>; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;abs_motion.ringbuffers[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code" href="libavutil_2fifo_8c.html#ada874c149988db27a46f8f5447cef478">av_fifo_alloc_array</a>(</div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;            <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;smooth_window,</div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;            <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>)</div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;        );</div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160; </div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;abs_motion.ringbuffers[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>]) {</div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;            err = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;            <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;        }</div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;    }</div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160; </div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;debug_on) {</div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;abs_motion.debug_matches = <a class="code" href="libavutil_2fifo_8c.html#ada874c149988db27a46f8f5447cef478">av_fifo_alloc_array</a>(</div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;            <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;smooth_window / 2,</div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;            <span class="keyword">sizeof</span>(<a class="code" href="struct_debug_matches.html">DebugMatches</a>)</div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;        );</div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160; </div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;abs_motion.debug_matches) {</div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;            err = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;            <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;        }</div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;    }</div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160; </div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;abs_motion.curr_frame_offset = 0;</div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;abs_motion.data_start_offset = -1;</div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;abs_motion.data_end_offset = -1;</div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160; </div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;    pattern_host = <a class="code" href="mem_8c.html#a254f3455439c15a2c8a75b8f0235fdbd">av_malloc_array</a>(<a class="code" href="vf__deshake__opencl_8c.html#aa906eb01e76896e3890b54fecddc8ffc">BREIFN</a>, <span class="keyword">sizeof</span>(<a class="code" href="struct_point_pair.html">PointPair</a>));</div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;    <span class="keywordflow">if</span> (!pattern_host) {</div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;        err = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;    }</div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160; </div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;matches_host = <a class="code" href="mem_8c.html#a254f3455439c15a2c8a75b8f0235fdbd">av_malloc_array</a>(image_grid_32, <span class="keyword">sizeof</span>(<a class="code" href="struct_motion_vector.html">MotionVector</a>));</div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;matches_host) {</div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;        err = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;    }</div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160; </div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;matches_contig_host = <a class="code" href="mem_8c.html#a254f3455439c15a2c8a75b8f0235fdbd">av_malloc_array</a>(<a class="code" href="vf__deshake__opencl_8c.html#a204a81d3183522f258d69d430fe4122e">MATCHES_CONTIG_SIZE</a>, <span class="keyword">sizeof</span>(<a class="code" href="struct_motion_vector.html">MotionVector</a>));</div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;matches_contig_host) {</div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;        err = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;    }</div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160; </div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;inliers = <a class="code" href="mem_8c.html#a254f3455439c15a2c8a75b8f0235fdbd">av_malloc_array</a>(<a class="code" href="vf__deshake__opencl_8c.html#a204a81d3183522f258d69d430fe4122e">MATCHES_CONTIG_SIZE</a>, <span class="keyword">sizeof</span>(<a class="code" href="struct_motion_vector.html">MotionVector</a>));</div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;inliers) {</div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;        err = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;    }</div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160; </div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;    <span class="comment">// Initializing the patch pattern for building BREIF descriptors with</span></div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;    <a class="code" href="lfg_8c.html#aa8cc657d3dca15bc50a94730a4346d58">av_lfg_init</a>(&amp;<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;alfg, 234342424);</div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="vf__deshake__opencl_8c.html#aa906eb01e76896e3890b54fecddc8ffc">BREIFN</a>; ++<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;        <a class="code" href="struct_point_pair.html">PointPair</a> pair;</div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160; </div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 2; ++j) {</div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;            pair.<a class="code" href="struct_point_pair.html#a2723179bf26cf06740f47f174a26dd4d">p1</a>.s[j] = <a class="code" href="vf__deshake__opencl_8c.html#a4ddbb86b2eab99c51940e4ea6bdc5af4">rand_in</a>(-<a class="code" href="vf__deshake__opencl_8c.html#a07687e6cde9d1396ff2004e76d37d473">BRIEF_PATCH_SIZE_HALF</a>, <a class="code" href="vf__deshake__opencl_8c.html#a07687e6cde9d1396ff2004e76d37d473">BRIEF_PATCH_SIZE_HALF</a> + 1, &amp;<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;alfg);</div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;            pair.<a class="code" href="struct_point_pair.html#a38dcabbd5cea915755b9eba77ebc5427">p2</a>.s[j] = <a class="code" href="vf__deshake__opencl_8c.html#a4ddbb86b2eab99c51940e4ea6bdc5af4">rand_in</a>(-<a class="code" href="vf__deshake__opencl_8c.html#a07687e6cde9d1396ff2004e76d37d473">BRIEF_PATCH_SIZE_HALF</a>, <a class="code" href="vf__deshake__opencl_8c.html#a07687e6cde9d1396ff2004e76d37d473">BRIEF_PATCH_SIZE_HALF</a> + 1, &amp;<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;alfg);</div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;        }</div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160; </div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;        pattern_host[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>] = pair;</div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;    }</div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160; </div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; 14; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;sw_format == disallowed_formats[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>]) {</div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;unsupported format in deshake_opencl.\n&quot;</span>);</div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;            err = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOSYS);</div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;            <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;        }</div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;    }</div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160; </div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a>-&gt;flags &amp; <a class="code" href="pixdesc_8h.html#a4c4e95f659b1e131480c1e98d70c57de">AV_PIX_FMT_FLAG_RGB</a>) {</div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;is_yuv = 0;</div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;is_yuv = 1;</div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;    }</div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;sw_format = hw_frames_ctx-&gt;sw_format;</div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160; </div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;    err = <a class="code" href="opencl_8c.html#a5b53a58b993ccb639121edcb93950585">ff_opencl_filter_load_program</a>(avctx, &amp;<a class="code" href="opencl__source_8h.html#a61d55fe4f61022cf69c5d7a8674847da">ff_opencl_source_deshake</a>, 1);</div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;    <span class="keywordflow">if</span> (err &lt; 0)</div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160; </div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;debug_on) {</div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;        queue_props = CL_QUEUE_PROFILING_ENABLE;</div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;        queue_props = 0;</div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;    }</div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;command_queue = clCreateCommandQueue(</div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;ocf.hwctx-&gt;context,</div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;ocf.hwctx-&gt;device_id,</div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;        queue_props,</div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;        &amp;cle</div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;    );</div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;    <a class="code" href="opencl_8h.html#aff23105528b325d213e0fbf7300e1980">CL_FAIL_ON_ERROR</a>(<a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EIO), <span class="stringliteral">&quot;Failed to create OpenCL command queue %d.\n&quot;</span>, cle);</div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160; </div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;    <a class="code" href="opencl_8h.html#a6a3ab40c09685f9b3bf4113ac480b085">CL_CREATE_KERNEL</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, grayscale);</div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;    <a class="code" href="opencl_8h.html#a6a3ab40c09685f9b3bf4113ac480b085">CL_CREATE_KERNEL</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, harris_response);</div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;    <a class="code" href="opencl_8h.html#a6a3ab40c09685f9b3bf4113ac480b085">CL_CREATE_KERNEL</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, refine_features);</div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;    <a class="code" href="opencl_8h.html#a6a3ab40c09685f9b3bf4113ac480b085">CL_CREATE_KERNEL</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, brief_descriptors);</div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;    <a class="code" href="opencl_8h.html#a6a3ab40c09685f9b3bf4113ac480b085">CL_CREATE_KERNEL</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, match_descriptors);</div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;    <a class="code" href="opencl_8h.html#a6a3ab40c09685f9b3bf4113ac480b085">CL_CREATE_KERNEL</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, <a class="code" href="hevcdsp_8c.html#aa4607c9f8c7507415c1c10c59a2141b6">transform</a>);</div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;    <a class="code" href="opencl_8h.html#a6a3ab40c09685f9b3bf4113ac480b085">CL_CREATE_KERNEL</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, crop_upscale);</div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;debug_on)</div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;        <a class="code" href="opencl_8h.html#a6a3ab40c09685f9b3bf4113ac480b085">CL_CREATE_KERNEL</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, draw_debug_info);</div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160; </div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;is_yuv) {</div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;        grayscale_format.image_channel_order = CL_R;</div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;        grayscale_format.image_channel_data_type = CL_FLOAT;</div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160; </div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;        grayscale_desc = (cl_image_desc) {</div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;            .image_type = CL_MEM_OBJECT_IMAGE2D,</div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;            .image_width = outlink-&gt;<a class="code" href="struct_a_v_filter_link.html#a08e3e25929bb29d5f6ef768343ff7f57">w</a>,</div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;            .image_height = outlink-&gt;<a class="code" href="struct_a_v_filter_link.html#a1efd10db9d097b6d27054da46e06e133">h</a>,</div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;            .image_depth = 0,</div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;            .image_array_size = 0,</div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;            .image_row_pitch = 0,</div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;            .image_slice_pitch = 0,</div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;            .num_mip_levels = 0,</div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;            .num_samples = 0,</div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;            .buffer = <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;        };</div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160; </div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;grayscale = clCreateImage(</div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;            <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;ocf.hwctx-&gt;context,</div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;            0,</div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;            &amp;grayscale_format,</div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;            &amp;grayscale_desc,</div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;            <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;            &amp;cle</div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;        );</div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;        <a class="code" href="opencl_8h.html#aff23105528b325d213e0fbf7300e1980">CL_FAIL_ON_ERROR</a>(<a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EIO), <span class="stringliteral">&quot;Failed to create grayscale image: %d.\n&quot;</span>, cle);</div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;    }</div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160; </div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;    <a class="code" href="opencl_8h.html#ac82f71ad703bd52fa1929111fa1953ec">CL_CREATE_BUFFER</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, harris_buf, outlink-&gt;<a class="code" href="struct_a_v_filter_link.html#a1efd10db9d097b6d27054da46e06e133">h</a> * outlink-&gt;<a class="code" href="struct_a_v_filter_link.html#a08e3e25929bb29d5f6ef768343ff7f57">w</a> * <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));</div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;    <a class="code" href="opencl_8h.html#ac82f71ad703bd52fa1929111fa1953ec">CL_CREATE_BUFFER</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, refined_features, features_buf_size);</div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;    <a class="code" href="opencl_8h.html#ac82f71ad703bd52fa1929111fa1953ec">CL_CREATE_BUFFER</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, prev_refined_features, features_buf_size);</div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;    <a class="code" href="opencl_8h.html#aaa280f44bed54bca1bf9644bc18cb89a">CL_CREATE_BUFFER_FLAGS</a>(</div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>,</div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;        brief_pattern,</div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;        CL_MEM_READ_WRITE | CL_MEM_COPY_HOST_PTR,</div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;        <a class="code" href="vf__deshake__opencl_8c.html#aa906eb01e76896e3890b54fecddc8ffc">BREIFN</a> * <span class="keyword">sizeof</span>(<a class="code" href="struct_point_pair.html">PointPair</a>),</div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;        pattern_host</div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;    );</div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;    <a class="code" href="opencl_8h.html#ac82f71ad703bd52fa1929111fa1953ec">CL_CREATE_BUFFER</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, descriptors, descriptor_buf_size);</div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;    <a class="code" href="opencl_8h.html#ac82f71ad703bd52fa1929111fa1953ec">CL_CREATE_BUFFER</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, prev_descriptors, descriptor_buf_size);</div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;    <a class="code" href="opencl_8h.html#ac82f71ad703bd52fa1929111fa1953ec">CL_CREATE_BUFFER</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, matches, image_grid_32 * <span class="keyword">sizeof</span>(<a class="code" href="struct_motion_vector.html">MotionVector</a>));</div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;    <a class="code" href="opencl_8h.html#ac82f71ad703bd52fa1929111fa1953ec">CL_CREATE_BUFFER</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, matches_contig, <a class="code" href="vf__deshake__opencl_8c.html#a204a81d3183522f258d69d430fe4122e">MATCHES_CONTIG_SIZE</a> * <span class="keyword">sizeof</span>(<a class="code" href="struct_motion_vector.html">MotionVector</a>));</div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;    <a class="code" href="opencl_8h.html#ac82f71ad703bd52fa1929111fa1953ec">CL_CREATE_BUFFER</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, transform_y, 9 * <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));</div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;    <a class="code" href="opencl_8h.html#ac82f71ad703bd52fa1929111fa1953ec">CL_CREATE_BUFFER</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, transform_uv, 9 * <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));</div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;debug_on) {</div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;        <a class="code" href="opencl_8h.html#ac82f71ad703bd52fa1929111fa1953ec">CL_CREATE_BUFFER</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, debug_matches, <a class="code" href="vf__deshake__opencl_8c.html#a204a81d3183522f258d69d430fe4122e">MATCHES_CONTIG_SIZE</a> * <span class="keyword">sizeof</span>(<a class="code" href="struct_motion_vector.html">MotionVector</a>));</div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;        <a class="code" href="opencl_8h.html#ac82f71ad703bd52fa1929111fa1953ec">CL_CREATE_BUFFER</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, debug_model_matches, 3 * <span class="keyword">sizeof</span>(<a class="code" href="struct_motion_vector.html">MotionVector</a>));</div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;    }</div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160; </div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;initialized = 1;</div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#adba82e1bcd02de510a858fcbedf79ef1">av_freep</a>(&amp;pattern_host);</div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160; </div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160; </div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;<a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>:</div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#adba82e1bcd02de510a858fcbedf79ef1">av_freep</a>(&amp;pattern_host);</div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;    <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;}</div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160; </div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;<span class="comment">// Logs debug information about the transform data</span></div>
<div class="line"><a name="l01357"></a><span class="lineno"><a class="line" href="vf__deshake__opencl_8c.html#ae0e802e85b29e3ce507e66df45884676"> 1357</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="vf__deshake__opencl_8c.html#ae0e802e85b29e3ce507e66df45884676">transform_debug</a>(<a class="code" href="struct_a_v_filter_context.html">AVFilterContext</a> *avctx, <span class="keywordtype">float</span> *new_vals, <span class="keywordtype">float</span> *old_vals, <span class="keywordtype">int</span> curr_frame) {</div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga9b58b28e2d429b930b69db19877f76a8">AV_LOG_VERBOSE</a>,</div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;        <span class="stringliteral">&quot;Frame %d:\n&quot;</span></div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;        <span class="stringliteral">&quot;\tframe moved from: %f x, %f y\n&quot;</span></div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;        <span class="stringliteral">&quot;\t              to: %f x, %f y\n&quot;</span></div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;        <span class="stringliteral">&quot;\t    rotated from: %f degrees\n&quot;</span></div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;        <span class="stringliteral">&quot;\t              to: %f degrees\n&quot;</span></div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;        <span class="stringliteral">&quot;\t     scaled from: %f x, %f y\n&quot;</span></div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;        <span class="stringliteral">&quot;\t              to: %f x, %f y\n&quot;</span></div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;        <span class="stringliteral">&quot;\n&quot;</span></div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;        <span class="stringliteral">&quot;\tframe moved by: %f x, %f y\n&quot;</span></div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;        <span class="stringliteral">&quot;\t    rotated by: %f degrees\n&quot;</span></div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;        <span class="stringliteral">&quot;\t     scaled by: %f x, %f y\n&quot;</span>,</div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;        curr_frame,</div>
<div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;        old_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5ad4065c2ecefa3f3486ff44e2e409008d">RingbufX</a>], old_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5a647afa6f628f3817a6923cfcafe6779a">RingbufY</a>],</div>
<div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;        new_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5ad4065c2ecefa3f3486ff44e2e409008d">RingbufX</a>], new_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5a647afa6f628f3817a6923cfcafe6779a">RingbufY</a>],</div>
<div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;        old_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5a7071a06d4f6642fd037c82dd101a3321">RingbufRot</a>] * (180.0 / <a class="code" href="mathematics_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>),</div>
<div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;        new_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5a7071a06d4f6642fd037c82dd101a3321">RingbufRot</a>] * (180.0 / <a class="code" href="mathematics_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>),</div>
<div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;        old_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5a3271fdb76ac77fd9c6a61011c51e6f8e">RingbufScaleX</a>], old_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5aad52f91fb41da1ce46b0b832f1c5a04b">RingbufScaleY</a>],</div>
<div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;        new_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5a3271fdb76ac77fd9c6a61011c51e6f8e">RingbufScaleX</a>], new_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5aad52f91fb41da1ce46b0b832f1c5a04b">RingbufScaleY</a>],</div>
<div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;        old_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5ad4065c2ecefa3f3486ff44e2e409008d">RingbufX</a>] - new_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5ad4065c2ecefa3f3486ff44e2e409008d">RingbufX</a>], old_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5a647afa6f628f3817a6923cfcafe6779a">RingbufY</a>] - new_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5a647afa6f628f3817a6923cfcafe6779a">RingbufY</a>],</div>
<div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;        old_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5a7071a06d4f6642fd037c82dd101a3321">RingbufRot</a>] * (180.0 / <a class="code" href="mathematics_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>) - new_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5a7071a06d4f6642fd037c82dd101a3321">RingbufRot</a>] * (180.0 / <a class="code" href="mathematics_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>),</div>
<div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;        new_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5a3271fdb76ac77fd9c6a61011c51e6f8e">RingbufScaleX</a>] / old_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5a3271fdb76ac77fd9c6a61011c51e6f8e">RingbufScaleX</a>], new_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5aad52f91fb41da1ce46b0b832f1c5a04b">RingbufScaleY</a>] / old_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5aad52f91fb41da1ce46b0b832f1c5a04b">RingbufScaleY</a>]</div>
<div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;    );</div>
<div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;}</div>
<div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160; </div>
<div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;<span class="comment">// Uses the buffered motion information to determine a transform that smooths the</span></div>
<div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;<span class="comment">// given frame and applies it</span></div>
<div class="line"><a name="l01385"></a><span class="lineno"><a class="line" href="vf__deshake__opencl_8c.html#a38f6bd6727ead1dc7a8c6abf741dc413"> 1385</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="vf__deshake__opencl_8c.html#a38f6bd6727ead1dc7a8c6abf741dc413">filter_frame</a>(<a class="code" href="struct_a_v_filter_link.html">AVFilterLink</a> *<a class="code" href="filter__design_8txt.html#a11a6a594845d2b9bf51b9ccc8a83c83d">link</a>, <a class="code" href="struct_a_v_frame.html">AVFrame</a> *input_frame)</div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;{</div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;    <a class="code" href="struct_a_v_filter_context.html">AVFilterContext</a> *avctx = <a class="code" href="filter__design_8txt.html#a11a6a594845d2b9bf51b9ccc8a83c83d">link</a>-&gt;dst;</div>
<div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;    <a class="code" href="struct_a_v_filter_link.html">AVFilterLink</a> *outlink = avctx-&gt;<a class="code" href="struct_a_v_filter_context.html#ae9e65e98275f789bb5fbb72c52d4f3ad">outputs</a>[0];</div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;    <a class="code" href="struct_deshake_open_c_l_context.html">DeshakeOpenCLContext</a> *deshake_ctx = avctx-&gt;<a class="code" href="struct_a_v_filter_context.html#ab0858b4059e67889c7f27c5cc9e258eb">priv</a>;</div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;    <a class="code" href="struct_a_v_frame.html">AVFrame</a> *cropped_frame = <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, *transformed_frame = <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;    <span class="keywordtype">int</span> err;</div>
<div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;    cl_int cle;</div>
<div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;    <span class="keywordtype">float</span> new_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5a9113457a0b099555ded29c2f6a521cb7">RingbufCount</a>];</div>
<div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;    <span class="keywordtype">float</span> old_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5a9113457a0b099555ded29c2f6a521cb7">RingbufCount</a>];</div>
<div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;    <span class="comment">// Luma (in the case of YUV) transform, or just the transform in the case of RGB</span></div>
<div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;    <span class="keywordtype">float</span> transform_y[9];</div>
<div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;    <span class="comment">// Chroma transform</span></div>
<div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;    <span class="keywordtype">float</span> transform_uv[9];</div>
<div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;    <span class="comment">// Luma crop transform (or RGB)</span></div>
<div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;    <span class="keywordtype">float</span> transform_crop_y[9];</div>
<div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;    <span class="comment">// Chroma crop transform</span></div>
<div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;    <span class="keywordtype">float</span> transform_crop_uv[9];</div>
<div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;    <span class="keywordtype">float</span> transform_debug_rgb[9];</div>
<div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;    <span class="keywordtype">size_t</span> global_work[2];</div>
<div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;    int64_t <a class="code" href="tests_2movenc_8c.html#a1f342e4e3615abc9314684ce6b4819c0">duration</a>;</div>
<div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;    cl_mem <a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>, transformed, dst;</div>
<div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;    cl_mem <a class="code" href="indeo4_8c.html#acffe83926a70c9305e903c3618758ca9">transforms</a>[3];</div>
<div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;    <a class="code" href="struct_crop_info.html">CropInfo</a> crops[3];</div>
<div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;    cl_event transform_event, crop_upscale_event;</div>
<div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;    <a class="code" href="struct_debug_matches.html">DebugMatches</a> debug_matches;</div>
<div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;    cl_int num_model_matches;</div>
<div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160; </div>
<div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">float</span> center_w = (float)input_frame-&gt;<a class="code" href="struct_a_v_frame.html#a1e71ce60cedd5f3b6811714a9f7f9e0a">width</a> / 2;</div>
<div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">float</span> center_h = (<span class="keywordtype">float</span>)input_frame-&gt;<a class="code" href="struct_a_v_frame.html#a3f89733f429c98ba5bc64373fb0a3f13">height</a> / 2;</div>
<div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160; </div>
<div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;    <span class="keyword">const</span> <a class="code" href="struct_a_v_pix_fmt_descriptor.html">AVPixFmtDescriptor</a> *<a class="code" href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a> = <a class="code" href="pixdesc_8c.html#afe0c3e8aef5173de28bbdaea4298f5f0">av_pix_fmt_desc_get</a>(deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#a29fa9c662ba310cab97432efefc706ff">sw_format</a>);</div>
<div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> chroma_width  = <a class="code" href="common_8h.html#a5d13452b0fac0d41b08ea2e49ea6eaa5">AV_CEIL_RSHIFT</a>(input_frame-&gt;<a class="code" href="struct_a_v_frame.html#a1e71ce60cedd5f3b6811714a9f7f9e0a">width</a>, <a class="code" href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a>-&gt;log2_chroma_w);</div>
<div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> chroma_height = <a class="code" href="common_8h.html#a5d13452b0fac0d41b08ea2e49ea6eaa5">AV_CEIL_RSHIFT</a>(input_frame-&gt;<a class="code" href="struct_a_v_frame.html#a3f89733f429c98ba5bc64373fb0a3f13">height</a>, <a class="code" href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a>-&gt;log2_chroma_h);</div>
<div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160; </div>
<div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">float</span> center_w_chroma = (float)chroma_width / 2;</div>
<div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">float</span> center_h_chroma = (float)chroma_height / 2;</div>
<div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160; </div>
<div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">float</span> luma_w_over_chroma_w = ((float)input_frame-&gt;<a class="code" href="struct_a_v_frame.html#a1e71ce60cedd5f3b6811714a9f7f9e0a">width</a> / (<span class="keywordtype">float</span>)chroma_width);</div>
<div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">float</span> luma_h_over_chroma_h = ((float)input_frame-&gt;<a class="code" href="struct_a_v_frame.html#a3f89733f429c98ba5bc64373fb0a3f13">height</a> / (<span class="keywordtype">float</span>)chroma_height);</div>
<div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160; </div>
<div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;    <span class="keywordflow">if</span> (deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#af53b59cc19d39adb77f6337cbc132b07">debug_on</a>) {</div>
<div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;        <a class="code" href="libavutil_2fifo_8c.html#ab708d2f19b7a9592caa278256787adb6">av_fifo_generic_read</a>(</div>
<div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;            deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#af41b236ec464389c9700936e54260726">abs_motion</a>.<a class="code" href="struct_absolute_frame_motion.html#aebd12b2e7d7a0ceaa9e02f19f8aca9dc">debug_matches</a>,</div>
<div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;            &amp;debug_matches,</div>
<div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;            <span class="keyword">sizeof</span>(<a class="code" href="struct_debug_matches.html">DebugMatches</a>),</div>
<div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;            <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div>
<div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;        );</div>
<div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;    }</div>
<div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160; </div>
<div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;    <span class="keywordflow">if</span> (input_frame-&gt;<a class="code" href="struct_a_v_frame.html#a385c44d7cafe80cad82fe46e25cab221">pkt_duration</a>) {</div>
<div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a1f342e4e3615abc9314684ce6b4819c0">duration</a> = input_frame-&gt;<a class="code" href="struct_a_v_frame.html#a385c44d7cafe80cad82fe46e25cab221">pkt_duration</a>;</div>
<div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a1f342e4e3615abc9314684ce6b4819c0">duration</a> = <a class="code" href="group__lavu__math.html#gaf02994a8bbeaa91d4757df179cbe567f">av_rescale_q</a>(1, <a class="code" href="group__lavu__math__rational.html#gab646f0a7cc30af543ba4a91b37f9de6e">av_inv_q</a>(outlink-&gt;<a class="code" href="struct_a_v_filter_link.html#a9711515003bff06b74d02adb751e8c78">frame_rate</a>), outlink-&gt;<a class="code" href="struct_a_v_filter_link.html#a5d947aa9541b02e25db472656d69ea53">time_base</a>);</div>
<div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;    }</div>
<div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;    deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#ac7aef1ea8edc37e98f593dfcd91dad84">duration</a> = input_frame-&gt;<a class="code" href="struct_a_v_frame.html#a0452833e3ab6ddd7acbf82817a7818a4">pts</a> + <a class="code" href="tests_2movenc_8c.html#a1f342e4e3615abc9314684ce6b4819c0">duration</a>;</div>
<div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160; </div>
<div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;    <span class="comment">// Get the absolute transform data for this frame</span></div>
<div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5a9113457a0b099555ded29c2f6a521cb7">RingbufCount</a>; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;        <a class="code" href="libavutil_2fifo_8c.html#ae44de4980b66c0695a4cf7808c140181">av_fifo_generic_peek_at</a>(</div>
<div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;            deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#af41b236ec464389c9700936e54260726">abs_motion</a>.<a class="code" href="struct_absolute_frame_motion.html#a8cfe39ca16b5020b5aa3d0c67cb20bbb">ringbuffers</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>],</div>
<div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;            &amp;old_vals[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>],</div>
<div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;            deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#af41b236ec464389c9700936e54260726">abs_motion</a>.<a class="code" href="struct_absolute_frame_motion.html#ac0255cf0b9279f9a94b98e318380243e">curr_frame_offset</a> * <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>),</div>
<div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;            <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>),</div>
<div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;            <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div>
<div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;        );</div>
<div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;    }</div>
<div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160; </div>
<div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;    <span class="keywordflow">if</span> (deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#a7ae5c4772bc57a251f3cd25c5ba955be">tripod_mode</a>) {</div>
<div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;        <span class="comment">// If tripod mode is turned on we simply undo all motion relative to the</span></div>
<div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;        <span class="comment">// first frame</span></div>
<div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160; </div>
<div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;        new_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5ad4065c2ecefa3f3486ff44e2e409008d">RingbufX</a>] = 0.0f;</div>
<div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;        new_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5a647afa6f628f3817a6923cfcafe6779a">RingbufY</a>] = 0.0f;</div>
<div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;        new_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5a7071a06d4f6642fd037c82dd101a3321">RingbufRot</a>] = 0.0f;</div>
<div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;        new_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5a3271fdb76ac77fd9c6a61011c51e6f8e">RingbufScaleX</a>] = 1.0f;</div>
<div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;        new_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5aad52f91fb41da1ce46b0b832f1c5a04b">RingbufScaleY</a>] = 1.0f;</div>
<div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;        <span class="comment">// Tripod mode is off and we need to smooth a moving camera</span></div>
<div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160; </div>
<div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;        new_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5ad4065c2ecefa3f3486ff44e2e409008d">RingbufX</a>] = <a class="code" href="vf__deshake__opencl_8c.html#a32fee6ebcc3bc066f425852915a5bed6">smooth</a>(</div>
<div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;            deshake_ctx,</div>
<div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;            deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#a26f185755b7d230c5304b70c3369bff2">gauss_kernel</a>,</div>
<div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;            deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#a4b73a586695575b9a355baae0432be1e">smooth_window</a>,</div>
<div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;            input_frame-&gt;<a class="code" href="struct_a_v_frame.html#a1e71ce60cedd5f3b6811714a9f7f9e0a">width</a>,</div>
<div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;            deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#af41b236ec464389c9700936e54260726">abs_motion</a>.<a class="code" href="struct_absolute_frame_motion.html#a8cfe39ca16b5020b5aa3d0c67cb20bbb">ringbuffers</a>[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5ad4065c2ecefa3f3486ff44e2e409008d">RingbufX</a>]</div>
<div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;        );</div>
<div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;        new_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5a647afa6f628f3817a6923cfcafe6779a">RingbufY</a>] = <a class="code" href="vf__deshake__opencl_8c.html#a32fee6ebcc3bc066f425852915a5bed6">smooth</a>(</div>
<div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;            deshake_ctx,</div>
<div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;            deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#a26f185755b7d230c5304b70c3369bff2">gauss_kernel</a>,</div>
<div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;            deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#a4b73a586695575b9a355baae0432be1e">smooth_window</a>,</div>
<div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;            input_frame-&gt;<a class="code" href="struct_a_v_frame.html#a3f89733f429c98ba5bc64373fb0a3f13">height</a>,</div>
<div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;            deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#af41b236ec464389c9700936e54260726">abs_motion</a>.<a class="code" href="struct_absolute_frame_motion.html#a8cfe39ca16b5020b5aa3d0c67cb20bbb">ringbuffers</a>[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5a647afa6f628f3817a6923cfcafe6779a">RingbufY</a>]</div>
<div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;        );</div>
<div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;        new_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5a7071a06d4f6642fd037c82dd101a3321">RingbufRot</a>] = <a class="code" href="vf__deshake__opencl_8c.html#a32fee6ebcc3bc066f425852915a5bed6">smooth</a>(</div>
<div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;            deshake_ctx,</div>
<div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;            deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#a26f185755b7d230c5304b70c3369bff2">gauss_kernel</a>,</div>
<div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;            deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#a4b73a586695575b9a355baae0432be1e">smooth_window</a>,</div>
<div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;            <a class="code" href="mathematics_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a> / 4,</div>
<div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;            deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#af41b236ec464389c9700936e54260726">abs_motion</a>.<a class="code" href="struct_absolute_frame_motion.html#a8cfe39ca16b5020b5aa3d0c67cb20bbb">ringbuffers</a>[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5a7071a06d4f6642fd037c82dd101a3321">RingbufRot</a>]</div>
<div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;        );</div>
<div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;        new_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5a3271fdb76ac77fd9c6a61011c51e6f8e">RingbufScaleX</a>] = <a class="code" href="vf__deshake__opencl_8c.html#a32fee6ebcc3bc066f425852915a5bed6">smooth</a>(</div>
<div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;            deshake_ctx,</div>
<div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;            deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#a26f185755b7d230c5304b70c3369bff2">gauss_kernel</a>,</div>
<div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;            deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#a4b73a586695575b9a355baae0432be1e">smooth_window</a>,</div>
<div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;            2.0f,</div>
<div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;            deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#af41b236ec464389c9700936e54260726">abs_motion</a>.<a class="code" href="struct_absolute_frame_motion.html#a8cfe39ca16b5020b5aa3d0c67cb20bbb">ringbuffers</a>[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5a3271fdb76ac77fd9c6a61011c51e6f8e">RingbufScaleX</a>]</div>
<div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;        );</div>
<div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;        new_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5aad52f91fb41da1ce46b0b832f1c5a04b">RingbufScaleY</a>] = <a class="code" href="vf__deshake__opencl_8c.html#a32fee6ebcc3bc066f425852915a5bed6">smooth</a>(</div>
<div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;            deshake_ctx,</div>
<div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;            deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#a26f185755b7d230c5304b70c3369bff2">gauss_kernel</a>,</div>
<div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;            deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#a4b73a586695575b9a355baae0432be1e">smooth_window</a>,</div>
<div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;            2.0f,</div>
<div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;            deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#af41b236ec464389c9700936e54260726">abs_motion</a>.<a class="code" href="struct_absolute_frame_motion.html#a8cfe39ca16b5020b5aa3d0c67cb20bbb">ringbuffers</a>[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5aad52f91fb41da1ce46b0b832f1c5a04b">RingbufScaleY</a>]</div>
<div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;        );</div>
<div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;    }</div>
<div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160; </div>
<div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;    <a class="code" href="vf__deshake__opencl_8c.html#a9163aad0cd348b8b75c90b4ee5b675d5">transform_center_scale</a>(</div>
<div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;        old_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5ad4065c2ecefa3f3486ff44e2e409008d">RingbufX</a>] - new_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5ad4065c2ecefa3f3486ff44e2e409008d">RingbufX</a>],</div>
<div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;        old_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5a647afa6f628f3817a6923cfcafe6779a">RingbufY</a>] - new_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5a647afa6f628f3817a6923cfcafe6779a">RingbufY</a>],</div>
<div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;        old_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5a7071a06d4f6642fd037c82dd101a3321">RingbufRot</a>] - new_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5a7071a06d4f6642fd037c82dd101a3321">RingbufRot</a>],</div>
<div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;        new_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5a3271fdb76ac77fd9c6a61011c51e6f8e">RingbufScaleX</a>] / old_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5a3271fdb76ac77fd9c6a61011c51e6f8e">RingbufScaleX</a>],</div>
<div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;        new_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5aad52f91fb41da1ce46b0b832f1c5a04b">RingbufScaleY</a>] / old_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5aad52f91fb41da1ce46b0b832f1c5a04b">RingbufScaleY</a>],</div>
<div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;        center_w,</div>
<div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;        center_h,</div>
<div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;        transform_y</div>
<div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;    );</div>
<div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160; </div>
<div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;    <a class="code" href="vf__deshake__opencl_8c.html#a9163aad0cd348b8b75c90b4ee5b675d5">transform_center_scale</a>(</div>
<div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;        (old_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5ad4065c2ecefa3f3486ff44e2e409008d">RingbufX</a>] - new_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5ad4065c2ecefa3f3486ff44e2e409008d">RingbufX</a>]) / luma_w_over_chroma_w,</div>
<div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;        (old_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5a647afa6f628f3817a6923cfcafe6779a">RingbufY</a>] - new_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5a647afa6f628f3817a6923cfcafe6779a">RingbufY</a>]) / luma_h_over_chroma_h,</div>
<div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;        old_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5a7071a06d4f6642fd037c82dd101a3321">RingbufRot</a>] - new_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5a7071a06d4f6642fd037c82dd101a3321">RingbufRot</a>],</div>
<div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;        new_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5a3271fdb76ac77fd9c6a61011c51e6f8e">RingbufScaleX</a>] / old_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5a3271fdb76ac77fd9c6a61011c51e6f8e">RingbufScaleX</a>],</div>
<div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;        new_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5aad52f91fb41da1ce46b0b832f1c5a04b">RingbufScaleY</a>] / old_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5aad52f91fb41da1ce46b0b832f1c5a04b">RingbufScaleY</a>],</div>
<div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;        center_w_chroma,</div>
<div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;        center_h_chroma,</div>
<div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;        transform_uv</div>
<div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;    );</div>
<div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160; </div>
<div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;    <a class="code" href="opencl_8h.html#ae14f51396b9977520ef5b2fcc102bce2">CL_BLOCKING_WRITE_BUFFER</a>(deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#a79d104439a1735bbfeaef639bf340b4e">command_queue</a>, deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#a72e0fa2b3833d4b58438839e33d9cb38">transform_y</a>, 9 * <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>), transform_y, <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;    <a class="code" href="opencl_8h.html#ae14f51396b9977520ef5b2fcc102bce2">CL_BLOCKING_WRITE_BUFFER</a>(deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#a79d104439a1735bbfeaef639bf340b4e">command_queue</a>, deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#a5eac23c56e1fa82a5383b9399cbc6a28">transform_uv</a>, 9 * <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>), transform_uv, <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160; </div>
<div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;    <span class="keywordflow">if</span> (deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#af53b59cc19d39adb77f6337cbc132b07">debug_on</a>)</div>
<div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;        <a class="code" href="vf__deshake__opencl_8c.html#ae0e802e85b29e3ce507e66df45884676">transform_debug</a>(avctx, new_vals, old_vals, deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#a385c7d3da418f0a685ecc00756fcd4cf">curr_frame</a>);</div>
<div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160; </div>
<div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;    cropped_frame = <a class="code" href="video_8c.html#a7f0f699d7689ef551622672dcd39a96a">ff_get_video_buffer</a>(outlink, outlink-&gt;<a class="code" href="struct_a_v_filter_link.html#a08e3e25929bb29d5f6ef768343ff7f57">w</a>, outlink-&gt;<a class="code" href="struct_a_v_filter_link.html#a1efd10db9d097b6d27054da46e06e133">h</a>);</div>
<div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;    <span class="keywordflow">if</span> (!cropped_frame) {</div>
<div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;        err = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;    }</div>
<div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160; </div>
<div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;    transformed_frame = <a class="code" href="video_8c.html#a7f0f699d7689ef551622672dcd39a96a">ff_get_video_buffer</a>(outlink, outlink-&gt;<a class="code" href="struct_a_v_filter_link.html#a08e3e25929bb29d5f6ef768343ff7f57">w</a>, outlink-&gt;<a class="code" href="struct_a_v_filter_link.html#a1efd10db9d097b6d27054da46e06e133">h</a>);</div>
<div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;    <span class="keywordflow">if</span> (!transformed_frame) {</div>
<div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;        err = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;    }</div>
<div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160; </div>
<div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;    <a class="code" href="indeo4_8c.html#acffe83926a70c9305e903c3618758ca9">transforms</a>[0] = deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#a72e0fa2b3833d4b58438839e33d9cb38">transform_y</a>;</div>
<div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;    <a class="code" href="indeo4_8c.html#acffe83926a70c9305e903c3618758ca9">transforms</a>[1] = <a class="code" href="indeo4_8c.html#acffe83926a70c9305e903c3618758ca9">transforms</a>[2] = deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#a5eac23c56e1fa82a5383b9399cbc6a28">transform_uv</a>;</div>
<div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160; </div>
<div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> p = 0; p &lt; <a class="code" href="sinewin__tablegen__template_8c.html#a3508a98d3ee7e2c9a4841fe264cf70f7">FF_ARRAY_ELEMS</a>(transformed_frame-&gt;data); p++) {</div>
<div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;        <span class="comment">// Transform all of the planes appropriately</span></div>
<div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;        <a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a> = (cl_mem)input_frame-&gt;<a class="code" href="struct_a_v_frame.html#a1d0f65014a8d1bf78cec8cbed2304992">data</a>[p];</div>
<div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;        transformed = (cl_mem)transformed_frame-&gt;data[p];</div>
<div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160; </div>
<div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;        <span class="keywordflow">if</span> (!transformed)</div>
<div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160; </div>
<div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;        err = <a class="code" href="opencl_8c.html#ac3682727463fb0797a3c11add9053c1d">ff_opencl_filter_work_size_from_image</a>(avctx, global_work, input_frame, p, 0);</div>
<div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;        <span class="keywordflow">if</span> (err &lt; 0)</div>
<div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;            <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160; </div>
<div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;        <a class="code" href="opencl_8h.html#a2233c01864860abf420194b0a662a39e">CL_RUN_KERNEL_WITH_ARGS</a>(</div>
<div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;            deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#a79d104439a1735bbfeaef639bf340b4e">command_queue</a>,</div>
<div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;            deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#a229dd8f8447b313ed366581b8683a141">kernel_transform</a>,</div>
<div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;            global_work,</div>
<div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;            <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;            &amp;transform_event,</div>
<div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;            { sizeof(cl_mem), &amp;src },</div>
<div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;            { sizeof(cl_mem), &amp;transformed },</div>
<div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;            { sizeof(cl_mem), &amp;transforms[p] },</div>
<div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;        );</div>
<div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;    }</div>
<div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160; </div>
<div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;    <span class="keywordflow">if</span> (deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#af53b59cc19d39adb77f6337cbc132b07">debug_on</a> &amp;&amp; !deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#a988296689039b7ea4a63b4a2bdc1ca30">is_yuv</a> &amp;&amp; debug_matches.<a class="code" href="struct_debug_matches.html#ac7258324928e2eee6652aeaac94a53f1">num_matches</a> &gt; 0) {</div>
<div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;        <a class="code" href="opencl_8h.html#ae14f51396b9977520ef5b2fcc102bce2">CL_BLOCKING_WRITE_BUFFER</a>(</div>
<div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;            deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#a79d104439a1735bbfeaef639bf340b4e">command_queue</a>,</div>
<div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;            deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#ac220506f512606ac340a1c006b242d9c">debug_matches</a>,</div>
<div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;            debug_matches.<a class="code" href="struct_debug_matches.html#ac7258324928e2eee6652aeaac94a53f1">num_matches</a> * <span class="keyword">sizeof</span>(<a class="code" href="struct_motion_vector.html">MotionVector</a>),</div>
<div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;            debug_matches.<a class="code" href="struct_debug_matches.html#ab0ec0dc3ed944615f4828998616e2387">matches</a>,</div>
<div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;            <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div>
<div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;        );</div>
<div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160; </div>
<div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;        <a class="code" href="opencl_8h.html#ae14f51396b9977520ef5b2fcc102bce2">CL_BLOCKING_WRITE_BUFFER</a>(</div>
<div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;            deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#a79d104439a1735bbfeaef639bf340b4e">command_queue</a>,</div>
<div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;            deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#a57027e4f486537b2be43c331122e1012">debug_model_matches</a>,</div>
<div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;            debug_matches.<a class="code" href="struct_debug_matches.html#a1445bdc06f80d04a082a8ca170665b93">num_model_matches</a> * <span class="keyword">sizeof</span>(<a class="code" href="struct_motion_vector.html">MotionVector</a>),</div>
<div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;            debug_matches.<a class="code" href="struct_debug_matches.html#abd79e59e862cfd147ea9dbff77881c1e">model_matches</a>,</div>
<div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;            <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div>
<div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;        );</div>
<div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160; </div>
<div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;        num_model_matches = debug_matches.<a class="code" href="struct_debug_matches.html#a1445bdc06f80d04a082a8ca170665b93">num_model_matches</a>;</div>
<div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160; </div>
<div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;        <span class="comment">// Invert the transform</span></div>
<div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;        <a class="code" href="vf__deshake__opencl_8c.html#a9163aad0cd348b8b75c90b4ee5b675d5">transform_center_scale</a>(</div>
<div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;            new_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5ad4065c2ecefa3f3486ff44e2e409008d">RingbufX</a>] - old_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5ad4065c2ecefa3f3486ff44e2e409008d">RingbufX</a>],</div>
<div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;            new_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5a647afa6f628f3817a6923cfcafe6779a">RingbufY</a>] - old_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5a647afa6f628f3817a6923cfcafe6779a">RingbufY</a>],</div>
<div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;            new_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5a7071a06d4f6642fd037c82dd101a3321">RingbufRot</a>] - old_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5a7071a06d4f6642fd037c82dd101a3321">RingbufRot</a>],</div>
<div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;            old_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5a3271fdb76ac77fd9c6a61011c51e6f8e">RingbufScaleX</a>] / new_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5a3271fdb76ac77fd9c6a61011c51e6f8e">RingbufScaleX</a>],</div>
<div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;            old_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5aad52f91fb41da1ce46b0b832f1c5a04b">RingbufScaleY</a>] / new_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5aad52f91fb41da1ce46b0b832f1c5a04b">RingbufScaleY</a>],</div>
<div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;            center_w,</div>
<div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;            center_h,</div>
<div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;            transform_debug_rgb</div>
<div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;        );</div>
<div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160; </div>
<div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;        <a class="code" href="opencl_8h.html#ae14f51396b9977520ef5b2fcc102bce2">CL_BLOCKING_WRITE_BUFFER</a>(deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#a79d104439a1735bbfeaef639bf340b4e">command_queue</a>, deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#a72e0fa2b3833d4b58438839e33d9cb38">transform_y</a>, 9 * <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>), transform_debug_rgb, <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160; </div>
<div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;        transformed = (cl_mem)transformed_frame-&gt;data[0];</div>
<div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;        <a class="code" href="opencl_8h.html#a2233c01864860abf420194b0a662a39e">CL_RUN_KERNEL_WITH_ARGS</a>(</div>
<div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;            deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#a79d104439a1735bbfeaef639bf340b4e">command_queue</a>,</div>
<div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;            deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#aa3332ab582d637e85277c04f340b8fa6">kernel_draw_debug_info</a>,</div>
<div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;            (<span class="keywordtype">size_t</span>[]){ debug_matches.<a class="code" href="struct_debug_matches.html#ac7258324928e2eee6652aeaac94a53f1">num_matches</a> },</div>
<div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;            <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;            <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;            { <span class="keyword">sizeof</span>(cl_mem), &amp;transformed },</div>
<div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;            { <span class="keyword">sizeof</span>(cl_mem), &amp;deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#ac220506f512606ac340a1c006b242d9c">debug_matches</a> },</div>
<div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;            { <span class="keyword">sizeof</span>(cl_mem), &amp;deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#a57027e4f486537b2be43c331122e1012">debug_model_matches</a> },</div>
<div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;            { <span class="keyword">sizeof</span>(cl_int), &amp;num_model_matches },</div>
<div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;            { <span class="keyword">sizeof</span>(cl_mem), &amp;deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#a72e0fa2b3833d4b58438839e33d9cb38">transform_y</a> }</div>
<div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;        );</div>
<div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;    }</div>
<div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160; </div>
<div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;    <span class="keywordflow">if</span> (deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#afebbd432ac813cb40ddfe331b4437d89">should_crop</a>) {</div>
<div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;        <span class="comment">// Generate transforms for cropping</span></div>
<div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;        <a class="code" href="vf__deshake__opencl_8c.html#a9163aad0cd348b8b75c90b4ee5b675d5">transform_center_scale</a>(</div>
<div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;            (old_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5ad4065c2ecefa3f3486ff44e2e409008d">RingbufX</a>] - new_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5ad4065c2ecefa3f3486ff44e2e409008d">RingbufX</a>]) / 5,</div>
<div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;            (old_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5a647afa6f628f3817a6923cfcafe6779a">RingbufY</a>] - new_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5a647afa6f628f3817a6923cfcafe6779a">RingbufY</a>]) / 5,</div>
<div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;            (old_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5a7071a06d4f6642fd037c82dd101a3321">RingbufRot</a>] - new_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5a7071a06d4f6642fd037c82dd101a3321">RingbufRot</a>]) / 5,</div>
<div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;            new_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5a3271fdb76ac77fd9c6a61011c51e6f8e">RingbufScaleX</a>] / old_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5a3271fdb76ac77fd9c6a61011c51e6f8e">RingbufScaleX</a>],</div>
<div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;            new_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5aad52f91fb41da1ce46b0b832f1c5a04b">RingbufScaleY</a>] / old_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5aad52f91fb41da1ce46b0b832f1c5a04b">RingbufScaleY</a>],</div>
<div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;            center_w,</div>
<div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;            center_h,</div>
<div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;            transform_crop_y</div>
<div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;        );</div>
<div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;        <a class="code" href="vf__deshake__opencl_8c.html#aaeed07069929ebdb0d7ad7af57290562">update_needed_crop</a>(&amp;deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#a3a60dbef2cdb99207de33b4eb6e56701">crop_y</a>, transform_crop_y, input_frame-&gt;<a class="code" href="struct_a_v_frame.html#a1e71ce60cedd5f3b6811714a9f7f9e0a">width</a>, input_frame-&gt;<a class="code" href="struct_a_v_frame.html#a3f89733f429c98ba5bc64373fb0a3f13">height</a>);</div>
<div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160; </div>
<div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;        <a class="code" href="vf__deshake__opencl_8c.html#a9163aad0cd348b8b75c90b4ee5b675d5">transform_center_scale</a>(</div>
<div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;            (old_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5ad4065c2ecefa3f3486ff44e2e409008d">RingbufX</a>] - new_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5ad4065c2ecefa3f3486ff44e2e409008d">RingbufX</a>]) / (5 * luma_w_over_chroma_w),</div>
<div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;            (old_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5a647afa6f628f3817a6923cfcafe6779a">RingbufY</a>] - new_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5a647afa6f628f3817a6923cfcafe6779a">RingbufY</a>]) / (5 * luma_h_over_chroma_h),</div>
<div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;            (old_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5a7071a06d4f6642fd037c82dd101a3321">RingbufRot</a>] - new_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5a7071a06d4f6642fd037c82dd101a3321">RingbufRot</a>]) / 5,</div>
<div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;            new_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5a3271fdb76ac77fd9c6a61011c51e6f8e">RingbufScaleX</a>] / old_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5a3271fdb76ac77fd9c6a61011c51e6f8e">RingbufScaleX</a>],</div>
<div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;            new_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5aad52f91fb41da1ce46b0b832f1c5a04b">RingbufScaleY</a>] / old_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5aad52f91fb41da1ce46b0b832f1c5a04b">RingbufScaleY</a>],</div>
<div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;            center_w_chroma,</div>
<div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;            center_h_chroma,</div>
<div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;            transform_crop_uv</div>
<div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;        );</div>
<div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;        <a class="code" href="vf__deshake__opencl_8c.html#aaeed07069929ebdb0d7ad7af57290562">update_needed_crop</a>(&amp;deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#ac5cdb80350d15e89f5d04821774dda35">crop_uv</a>, transform_crop_uv, chroma_width, chroma_height);</div>
<div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160; </div>
<div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;        crops[0] = deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#a3a60dbef2cdb99207de33b4eb6e56701">crop_y</a>;</div>
<div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;        crops[1] = crops[2] = deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#ac5cdb80350d15e89f5d04821774dda35">crop_uv</a>;</div>
<div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160; </div>
<div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> p = 0; p &lt; <a class="code" href="sinewin__tablegen__template_8c.html#a3508a98d3ee7e2c9a4841fe264cf70f7">FF_ARRAY_ELEMS</a>(cropped_frame-&gt;<a class="code" href="struct_a_v_frame.html#a1d0f65014a8d1bf78cec8cbed2304992">data</a>); p++) {</div>
<div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;            <span class="comment">// Crop all of the planes appropriately</span></div>
<div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;            dst = (cl_mem)cropped_frame-&gt;<a class="code" href="struct_a_v_frame.html#a1d0f65014a8d1bf78cec8cbed2304992">data</a>[p];</div>
<div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;            transformed = (cl_mem)transformed_frame-&gt;data[p];</div>
<div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160; </div>
<div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;            <span class="keywordflow">if</span> (!dst)</div>
<div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160; </div>
<div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;            err = <a class="code" href="opencl_8c.html#ac3682727463fb0797a3c11add9053c1d">ff_opencl_filter_work_size_from_image</a>(avctx, global_work, input_frame, p, 0);</div>
<div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;            <span class="keywordflow">if</span> (err &lt; 0)</div>
<div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;                <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160; </div>
<div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;            <a class="code" href="opencl_8h.html#a2233c01864860abf420194b0a662a39e">CL_RUN_KERNEL_WITH_ARGS</a>(</div>
<div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;                deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#a79d104439a1735bbfeaef639bf340b4e">command_queue</a>,</div>
<div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;                deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#a8192eb89bbb66932516c6d383a65ac94">kernel_crop_upscale</a>,</div>
<div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;                global_work,</div>
<div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;                <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;                &amp;crop_upscale_event,</div>
<div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;                { sizeof(cl_mem), &amp;transformed },</div>
<div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;                { sizeof(cl_mem), &amp;dst },</div>
<div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;                { sizeof(cl_float2), &amp;crops[p].top_left },</div>
<div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;                { sizeof(cl_float2), &amp;crops[p].bottom_right },</div>
<div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;            );</div>
<div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;        }</div>
<div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;    }</div>
<div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160; </div>
<div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;    <span class="keywordflow">if</span> (deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#a385c7d3da418f0a685ecc00756fcd4cf">curr_frame</a> &lt; deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#a4b73a586695575b9a355baae0432be1e">smooth_window</a> / 2) {</div>
<div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;        <span class="comment">// This means we are somewhere at the start of the video. We need to</span></div>
<div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;        <span class="comment">// increment the current frame offset until it reaches the center of</span></div>
<div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;        <span class="comment">// the ringbuffers (as the current frame will be located there for</span></div>
<div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;        <span class="comment">// the rest of the video).</span></div>
<div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;        <span class="comment">//</span></div>
<div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;        <span class="comment">// The end of the video is taken care of by draining motion data</span></div>
<div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;        <span class="comment">// one-by-one out of the buffer, causing the (at that point fixed)</span></div>
<div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;        <span class="comment">// offset to move towards later frames&#39; data.</span></div>
<div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;        ++deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#af41b236ec464389c9700936e54260726">abs_motion</a>.<a class="code" href="struct_absolute_frame_motion.html#ac0255cf0b9279f9a94b98e318380243e">curr_frame_offset</a>;</div>
<div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;    }</div>
<div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160; </div>
<div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;    <span class="keywordflow">if</span> (deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#af41b236ec464389c9700936e54260726">abs_motion</a>.<a class="code" href="struct_absolute_frame_motion.html#af13ee6297ce6688742784267660cb911">data_end_offset</a> != -1) {</div>
<div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;        <span class="comment">// Keep the end offset in sync with the frame it&#39;s supposed to be</span></div>
<div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;        <span class="comment">// positioned at</span></div>
<div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;        --deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#af41b236ec464389c9700936e54260726">abs_motion</a>.<a class="code" href="struct_absolute_frame_motion.html#af13ee6297ce6688742784267660cb911">data_end_offset</a>;</div>
<div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160; </div>
<div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;        <span class="keywordflow">if</span> (deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#af41b236ec464389c9700936e54260726">abs_motion</a>.<a class="code" href="struct_absolute_frame_motion.html#af13ee6297ce6688742784267660cb911">data_end_offset</a> == deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#af41b236ec464389c9700936e54260726">abs_motion</a>.<a class="code" href="struct_absolute_frame_motion.html#ac0255cf0b9279f9a94b98e318380243e">curr_frame_offset</a> - 1) {</div>
<div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;            <span class="comment">// The end offset would be the start of the new video sequence; flip to</span></div>
<div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;            <span class="comment">// start offset</span></div>
<div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;            deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#af41b236ec464389c9700936e54260726">abs_motion</a>.<a class="code" href="struct_absolute_frame_motion.html#af13ee6297ce6688742784267660cb911">data_end_offset</a> = -1;</div>
<div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;            deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#af41b236ec464389c9700936e54260726">abs_motion</a>.<a class="code" href="struct_absolute_frame_motion.html#ae3114642778302fa1dce520054e222c5">data_start_offset</a> = deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#af41b236ec464389c9700936e54260726">abs_motion</a>.<a class="code" href="struct_absolute_frame_motion.html#ac0255cf0b9279f9a94b98e318380243e">curr_frame_offset</a>;</div>
<div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;        }</div>
<div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#af41b236ec464389c9700936e54260726">abs_motion</a>.<a class="code" href="struct_absolute_frame_motion.html#ae3114642778302fa1dce520054e222c5">data_start_offset</a> != -1) {</div>
<div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;        <span class="comment">// Keep the start offset in sync with the frame it&#39;s supposed to be</span></div>
<div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;        <span class="comment">// positioned at</span></div>
<div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;        --deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#af41b236ec464389c9700936e54260726">abs_motion</a>.<a class="code" href="struct_absolute_frame_motion.html#ae3114642778302fa1dce520054e222c5">data_start_offset</a>;</div>
<div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;    }</div>
<div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160; </div>
<div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;    <span class="keywordflow">if</span> (deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#af53b59cc19d39adb77f6337cbc132b07">debug_on</a>) {</div>
<div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;        deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#a96d94e25fb2446f405147a0c9a46a769">transform_time</a> += <a class="code" href="opencl_8c.html#abb2ed9501a29a5fbfed7971fefabf291">ff_opencl_get_event_time</a>(transform_event);</div>
<div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;        <span class="keywordflow">if</span> (deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#afebbd432ac813cb40ddfe331b4437d89">should_crop</a>) {</div>
<div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;            deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#ae96c83d6273eedf2402e2b59b2ff7905">crop_upscale_time</a> += <a class="code" href="opencl_8c.html#abb2ed9501a29a5fbfed7971fefabf291">ff_opencl_get_event_time</a>(crop_upscale_event);</div>
<div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;        }</div>
<div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;    }</div>
<div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160; </div>
<div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;    ++deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#a385c7d3da418f0a685ecc00756fcd4cf">curr_frame</a>;</div>
<div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160; </div>
<div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;    <span class="keywordflow">if</span> (deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#af53b59cc19d39adb77f6337cbc132b07">debug_on</a>)</div>
<div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#adba82e1bcd02de510a858fcbedf79ef1">av_freep</a>(&amp;debug_matches.<a class="code" href="struct_debug_matches.html#ab0ec0dc3ed944615f4828998616e2387">matches</a>);</div>
<div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160; </div>
<div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;    <span class="keywordflow">if</span> (deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#afebbd432ac813cb40ddfe331b4437d89">should_crop</a>) {</div>
<div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;        err = <a class="code" href="group__lavu__frame.html#gab9b275b114ace0db95c5796bc71f3012">av_frame_copy_props</a>(cropped_frame, input_frame);</div>
<div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;        <span class="keywordflow">if</span> (err &lt; 0)</div>
<div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;            <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160; </div>
<div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;        <a class="code" href="group__lavu__frame.html#ga979d73f3228814aee56aeca0636e37cc">av_frame_free</a>(&amp;transformed_frame);</div>
<div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;        <a class="code" href="group__lavu__frame.html#ga979d73f3228814aee56aeca0636e37cc">av_frame_free</a>(&amp;input_frame);</div>
<div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="avfilter_8c.html#a65d6e9755eadf69367843dfc738143b4">ff_filter_frame</a>(outlink, cropped_frame);</div>
<div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160; </div>
<div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;        err = <a class="code" href="group__lavu__frame.html#gab9b275b114ace0db95c5796bc71f3012">av_frame_copy_props</a>(transformed_frame, input_frame);</div>
<div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;        <span class="keywordflow">if</span> (err &lt; 0)</div>
<div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;            <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160; </div>
<div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;        <a class="code" href="group__lavu__frame.html#ga979d73f3228814aee56aeca0636e37cc">av_frame_free</a>(&amp;cropped_frame);</div>
<div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;        <a class="code" href="group__lavu__frame.html#ga979d73f3228814aee56aeca0636e37cc">av_frame_free</a>(&amp;input_frame);</div>
<div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="avfilter_8c.html#a65d6e9755eadf69367843dfc738143b4">ff_filter_frame</a>(outlink, transformed_frame);</div>
<div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;    }</div>
<div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160; </div>
<div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;<a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>:</div>
<div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;    clFinish(deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#a79d104439a1735bbfeaef639bf340b4e">command_queue</a>);</div>
<div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160; </div>
<div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;    <span class="keywordflow">if</span> (deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#af53b59cc19d39adb77f6337cbc132b07">debug_on</a>)</div>
<div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;        <span class="keywordflow">if</span> (debug_matches.<a class="code" href="struct_debug_matches.html#ab0ec0dc3ed944615f4828998616e2387">matches</a>)</div>
<div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#adba82e1bcd02de510a858fcbedf79ef1">av_freep</a>(&amp;debug_matches.<a class="code" href="struct_debug_matches.html#ab0ec0dc3ed944615f4828998616e2387">matches</a>);</div>
<div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160; </div>
<div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;    <a class="code" href="group__lavu__frame.html#ga979d73f3228814aee56aeca0636e37cc">av_frame_free</a>(&amp;input_frame);</div>
<div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;    <a class="code" href="group__lavu__frame.html#ga979d73f3228814aee56aeca0636e37cc">av_frame_free</a>(&amp;transformed_frame);</div>
<div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;    <a class="code" href="group__lavu__frame.html#ga979d73f3228814aee56aeca0636e37cc">av_frame_free</a>(&amp;cropped_frame);</div>
<div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;    <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;}</div>
<div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160; </div>
<div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;<span class="comment">// Add the given frame to the frame queue to eventually be processed.</span></div>
<div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;<span class="comment">// Also determines the motion from the previous frame and updates the stored</span></div>
<div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;<span class="comment">// motion information accordingly.</span></div>
<div class="line"><a name="l01749"></a><span class="lineno"><a class="line" href="vf__deshake__opencl_8c.html#a4a2c3e7952056207a49b44440a141977"> 1749</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="vf__deshake__opencl_8c.html#a4a2c3e7952056207a49b44440a141977">queue_frame</a>(<a class="code" href="struct_a_v_filter_link.html">AVFilterLink</a> *<a class="code" href="filter__design_8txt.html#a11a6a594845d2b9bf51b9ccc8a83c83d">link</a>, <a class="code" href="struct_a_v_frame.html">AVFrame</a> *input_frame)</div>
<div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;{</div>
<div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;    <a class="code" href="struct_a_v_filter_context.html">AVFilterContext</a> *avctx = <a class="code" href="filter__design_8txt.html#a11a6a594845d2b9bf51b9ccc8a83c83d">link</a>-&gt;dst;</div>
<div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;    <a class="code" href="struct_deshake_open_c_l_context.html">DeshakeOpenCLContext</a> *deshake_ctx = avctx-&gt;<a class="code" href="struct_a_v_filter_context.html#ab0858b4059e67889c7f27c5cc9e258eb">priv</a>;</div>
<div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;    <span class="keywordtype">int</span> err;</div>
<div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;    <span class="keywordtype">int</span> num_vectors;</div>
<div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;    <span class="keywordtype">int</span> num_inliers = 0;</div>
<div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;    cl_int cle;</div>
<div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;    <a class="code" href="struct_frame_delta.html">FrameDelta</a> relative;</div>
<div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;    <a class="code" href="struct_similarity_matrix.html">SimilarityMatrix</a> model;</div>
<div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;    <span class="keywordtype">size_t</span> global_work[2];</div>
<div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;    <span class="keywordtype">size_t</span> harris_global_work[2];</div>
<div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;    <span class="keywordtype">size_t</span> grid_32_global_work[2];</div>
<div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;    <span class="keywordtype">int</span> grid_32_h, grid_32_w;</div>
<div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;    <span class="keywordtype">size_t</span> local_work[2];</div>
<div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;    cl_mem <a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>, <a class="code" href="vf__mcdeint_8c.html#a0b90bc971fe5188fc4d32fe8177a64a5">temp</a>;</div>
<div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;    <span class="keywordtype">float</span> prev_vals[5];</div>
<div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;    <span class="keywordtype">float</span> new_vals[5];</div>
<div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;    cl_event grayscale_event, harris_response_event, refine_features_event,</div>
<div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;             brief_event, match_descriptors_event, read_buf_event;</div>
<div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;    <a class="code" href="struct_debug_matches.html">DebugMatches</a> debug_matches;</div>
<div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160; </div>
<div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;    num_vectors = 0;</div>
<div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160; </div>
<div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;    local_work[0] = 8;</div>
<div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;    local_work[1] = 8;</div>
<div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160; </div>
<div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;    err = <a class="code" href="opencl_8c.html#ac3682727463fb0797a3c11add9053c1d">ff_opencl_filter_work_size_from_image</a>(avctx, global_work, input_frame, 0, 0);</div>
<div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;    <span class="keywordflow">if</span> (err &lt; 0)</div>
<div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160; </div>
<div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;    err = <a class="code" href="opencl_8c.html#ac3682727463fb0797a3c11add9053c1d">ff_opencl_filter_work_size_from_image</a>(avctx, harris_global_work, input_frame, 0, 8);</div>
<div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;    <span class="keywordflow">if</span> (err &lt; 0)</div>
<div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160; </div>
<div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;    err = <a class="code" href="opencl_8c.html#ac3682727463fb0797a3c11add9053c1d">ff_opencl_filter_work_size_from_image</a>(avctx, grid_32_global_work, input_frame, 0, 32);</div>
<div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;    <span class="keywordflow">if</span> (err &lt; 0)</div>
<div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160; </div>
<div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;    <span class="comment">// We want a single work-item for each 32x32 block of pixels in the input frame</span></div>
<div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;    grid_32_global_work[0] /= 32;</div>
<div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;    grid_32_global_work[1] /= 32;</div>
<div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160; </div>
<div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;    grid_32_h = <a class="code" href="vf__deshake__opencl_8c.html#a85ec8441a811e55d823408e0b8d5bfd0">ROUNDED_UP_DIV</a>(input_frame-&gt;<a class="code" href="struct_a_v_frame.html#a3f89733f429c98ba5bc64373fb0a3f13">height</a>, 32);</div>
<div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;    grid_32_w = <a class="code" href="vf__deshake__opencl_8c.html#a85ec8441a811e55d823408e0b8d5bfd0">ROUNDED_UP_DIV</a>(input_frame-&gt;<a class="code" href="struct_a_v_frame.html#a1e71ce60cedd5f3b6811714a9f7f9e0a">width</a>, 32);</div>
<div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160; </div>
<div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;    <span class="keywordflow">if</span> (deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#a988296689039b7ea4a63b4a2bdc1ca30">is_yuv</a>) {</div>
<div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;        deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#a0f48467a039b920eba5ede7e9061a665">grayscale</a> = (cl_mem)input_frame-&gt;<a class="code" href="struct_a_v_frame.html#a1d0f65014a8d1bf78cec8cbed2304992">data</a>[0];</div>
<div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;        <a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a> = (cl_mem)input_frame-&gt;<a class="code" href="struct_a_v_frame.html#a1d0f65014a8d1bf78cec8cbed2304992">data</a>[0];</div>
<div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160; </div>
<div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;        <a class="code" href="opencl_8h.html#a2233c01864860abf420194b0a662a39e">CL_RUN_KERNEL_WITH_ARGS</a>(</div>
<div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;            deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#a79d104439a1735bbfeaef639bf340b4e">command_queue</a>,</div>
<div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;            deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#ad68588f3779e87462e9460c60c5ecd63">kernel_grayscale</a>,</div>
<div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;            global_work,</div>
<div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;            <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;            &amp;grayscale_event,</div>
<div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;            { <span class="keyword">sizeof</span>(cl_mem), &amp;<a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a> },</div>
<div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;            { <span class="keyword">sizeof</span>(cl_mem), &amp;deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#a0f48467a039b920eba5ede7e9061a665">grayscale</a> }</div>
<div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;        );</div>
<div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;    }</div>
<div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160; </div>
<div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;    <a class="code" href="opencl_8h.html#a2233c01864860abf420194b0a662a39e">CL_RUN_KERNEL_WITH_ARGS</a>(</div>
<div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;        deshake_ctx-&gt;command_queue,</div>
<div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;        deshake_ctx-&gt;kernel_harris_response,</div>
<div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;        harris_global_work,</div>
<div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;        local_work,</div>
<div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;        &amp;harris_response_event,</div>
<div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;        { sizeof(cl_mem), &amp;deshake_ctx-&gt;grayscale },</div>
<div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;        { sizeof(cl_mem), &amp;deshake_ctx-&gt;harris_buf }</div>
<div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;    );</div>
<div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160; </div>
<div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;    <a class="code" href="opencl_8h.html#a2233c01864860abf420194b0a662a39e">CL_RUN_KERNEL_WITH_ARGS</a>(</div>
<div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;        deshake_ctx-&gt;command_queue,</div>
<div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;        deshake_ctx-&gt;kernel_refine_features,</div>
<div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;        grid_32_global_work,</div>
<div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;        <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;        &amp;refine_features_event,</div>
<div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;        { sizeof(cl_mem), &amp;deshake_ctx-&gt;grayscale },</div>
<div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;        { sizeof(cl_mem), &amp;deshake_ctx-&gt;harris_buf },</div>
<div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;        { sizeof(cl_mem), &amp;deshake_ctx-&gt;refined_features },</div>
<div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;        { sizeof(cl_int), &amp;deshake_ctx-&gt;refine_features }</div>
<div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;    );</div>
<div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160; </div>
<div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;    <a class="code" href="opencl_8h.html#a2233c01864860abf420194b0a662a39e">CL_RUN_KERNEL_WITH_ARGS</a>(</div>
<div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;        deshake_ctx-&gt;command_queue,</div>
<div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;        deshake_ctx-&gt;kernel_brief_descriptors,</div>
<div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;        grid_32_global_work,</div>
<div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;        <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;        &amp;brief_event,</div>
<div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;        { sizeof(cl_mem), &amp;deshake_ctx-&gt;grayscale },</div>
<div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;        { sizeof(cl_mem), &amp;deshake_ctx-&gt;refined_features },</div>
<div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;        { sizeof(cl_mem), &amp;deshake_ctx-&gt;descriptors },</div>
<div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;        { sizeof(cl_mem), &amp;deshake_ctx-&gt;brief_pattern}</div>
<div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;    );</div>
<div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160; </div>
<div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="libavutil_2fifo_8c.html#a81f4cea70d96846df7111daccc5ecce2">av_fifo_size</a>(deshake_ctx-&gt;abs_motion.ringbuffers[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5ad4065c2ecefa3f3486ff44e2e409008d">RingbufX</a>]) == 0) {</div>
<div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;        <span class="comment">// This is the first frame we&#39;ve been given to queue, meaning there is</span></div>
<div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;        <span class="comment">// no previous frame to match descriptors to</span></div>
<div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160; </div>
<div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;        <span class="keywordflow">goto</span> no_motion_data;</div>
<div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;    }</div>
<div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160; </div>
<div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;    <a class="code" href="opencl_8h.html#a2233c01864860abf420194b0a662a39e">CL_RUN_KERNEL_WITH_ARGS</a>(</div>
<div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;        deshake_ctx-&gt;command_queue,</div>
<div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;        deshake_ctx-&gt;kernel_match_descriptors,</div>
<div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;        grid_32_global_work,</div>
<div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;        <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;        &amp;match_descriptors_event,</div>
<div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;        { sizeof(cl_mem), &amp;deshake_ctx-&gt;prev_refined_features },</div>
<div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;        { sizeof(cl_mem), &amp;deshake_ctx-&gt;refined_features },</div>
<div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;        { sizeof(cl_mem), &amp;deshake_ctx-&gt;descriptors },</div>
<div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;        { sizeof(cl_mem), &amp;deshake_ctx-&gt;prev_descriptors },</div>
<div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;        { sizeof(cl_mem), &amp;deshake_ctx-&gt;matches }</div>
<div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;    );</div>
<div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160; </div>
<div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;    cle = clEnqueueReadBuffer(</div>
<div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;        deshake_ctx-&gt;command_queue,</div>
<div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;        deshake_ctx-&gt;matches,</div>
<div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;        CL_TRUE,</div>
<div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;        0,</div>
<div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;        grid_32_h * grid_32_w * <span class="keyword">sizeof</span>(<a class="code" href="struct_motion_vector.html">MotionVector</a>),</div>
<div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;        deshake_ctx-&gt;matches_host,</div>
<div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;        0,</div>
<div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;        <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;        &amp;read_buf_event</div>
<div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;    );</div>
<div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;    <a class="code" href="opencl_8h.html#aff23105528b325d213e0fbf7300e1980">CL_FAIL_ON_ERROR</a>(<a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EIO), <span class="stringliteral">&quot;Failed to read matches to host: %d.\n&quot;</span>, cle);</div>
<div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160; </div>
<div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;    num_vectors = <a class="code" href="vf__deshake__opencl_8c.html#a6f2f1655956e19d07d703031b77393bd">make_vectors_contig</a>(deshake_ctx, grid_32_h, grid_32_w);</div>
<div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160; </div>
<div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;    <span class="keywordflow">if</span> (num_vectors &lt; 10) {</div>
<div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;        <span class="comment">// Not enough matches to get reliable motion data for this frame</span></div>
<div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;        <span class="comment">//</span></div>
<div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;        <span class="comment">// From this point on all data is relative to this frame rather than the</span></div>
<div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;        <span class="comment">// original frame. We have to make sure that we don&#39;t mix values that were</span></div>
<div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;        <span class="comment">// relative to the original frame with the new values relative to this</span></div>
<div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;        <span class="comment">// frame when doing the gaussian smoothing. We keep track of where the old</span></div>
<div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;        <span class="comment">// values end using this data_end_offset field in order to accomplish</span></div>
<div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;        <span class="comment">// that goal.</span></div>
<div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;        <span class="comment">//</span></div>
<div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;        <span class="comment">// If no motion data is present for multiple frames in a short window of</span></div>
<div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;        <span class="comment">// time, we leave the end where it was to avoid mixing 0s in with the</span></div>
<div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;        <span class="comment">// old data (and just treat them all as part of the new values)</span></div>
<div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;        <span class="keywordflow">if</span> (deshake_ctx-&gt;abs_motion.data_end_offset == -1) {</div>
<div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;            deshake_ctx-&gt;abs_motion.data_end_offset =</div>
<div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;                <a class="code" href="libavutil_2fifo_8c.html#a81f4cea70d96846df7111daccc5ecce2">av_fifo_size</a>(deshake_ctx-&gt;abs_motion.ringbuffers[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5ad4065c2ecefa3f3486ff44e2e409008d">RingbufX</a>]) / <span class="keyword">sizeof</span>(float) - 1;</div>
<div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;        }</div>
<div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160; </div>
<div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;        <span class="keywordflow">goto</span> no_motion_data;</div>
<div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;    }</div>
<div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160; </div>
<div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="vf__deshake__opencl_8c.html#aac759b3a3a896f0967ba64248283d22b">estimate_affine_2d</a>(</div>
<div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;        deshake_ctx,</div>
<div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;        deshake_ctx-&gt;matches_contig_host,</div>
<div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;        &amp;debug_matches,</div>
<div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;        num_vectors,</div>
<div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;        model.matrix,</div>
<div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;        10.0,</div>
<div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;        3000,</div>
<div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;        0.999999999999</div>
<div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;    )) {</div>
<div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;        <span class="keywordflow">goto</span> no_motion_data;</div>
<div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;    }</div>
<div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160; </div>
<div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; num_vectors; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;        <span class="keywordflow">if</span> (deshake_ctx-&gt;matches_contig_host[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].should_consider) {</div>
<div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;            deshake_ctx-&gt;inliers[num_inliers] = deshake_ctx-&gt;matches_contig_host[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;            num_inliers++;</div>
<div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;        }</div>
<div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;    }</div>
<div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160; </div>
<div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="vf__deshake__opencl_8c.html#a478b505dff6bf71827cc70437b0515b0">minimize_error</a>(</div>
<div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;        deshake_ctx,</div>
<div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;        deshake_ctx-&gt;inliers,</div>
<div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;        &amp;debug_matches,</div>
<div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;        num_inliers,</div>
<div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;        model.matrix,</div>
<div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;        400</div>
<div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;    )) {</div>
<div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;        <span class="keywordflow">goto</span> no_motion_data;</div>
<div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;    }</div>
<div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160; </div>
<div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160; </div>
<div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;    relative = <a class="code" href="vf__deshake__opencl_8c.html#a29f077a9126bf10d4893bb1750c36c91">decompose_transform</a>(model.matrix);</div>
<div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160; </div>
<div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;    <span class="comment">// Get the absolute transform data for the previous frame</span></div>
<div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5a9113457a0b099555ded29c2f6a521cb7">RingbufCount</a>; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;        <a class="code" href="libavutil_2fifo_8c.html#ae44de4980b66c0695a4cf7808c140181">av_fifo_generic_peek_at</a>(</div>
<div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;            deshake_ctx-&gt;abs_motion.ringbuffers[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>],</div>
<div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;            &amp;prev_vals[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>],</div>
<div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;            <a class="code" href="libavutil_2fifo_8c.html#a81f4cea70d96846df7111daccc5ecce2">av_fifo_size</a>(deshake_ctx-&gt;abs_motion.ringbuffers[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>]) - <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>),</div>
<div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;            <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>),</div>
<div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;            <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div>
<div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;        );</div>
<div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;    }</div>
<div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160; </div>
<div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;    new_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5ad4065c2ecefa3f3486ff44e2e409008d">RingbufX</a>]      = prev_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5ad4065c2ecefa3f3486ff44e2e409008d">RingbufX</a>] + relative.translation.s[0];</div>
<div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;    new_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5a647afa6f628f3817a6923cfcafe6779a">RingbufY</a>]      = prev_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5a647afa6f628f3817a6923cfcafe6779a">RingbufY</a>] + relative.translation.s[1];</div>
<div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;    new_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5a7071a06d4f6642fd037c82dd101a3321">RingbufRot</a>]    = prev_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5a7071a06d4f6642fd037c82dd101a3321">RingbufRot</a>] + relative.rotation;</div>
<div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;    new_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5a3271fdb76ac77fd9c6a61011c51e6f8e">RingbufScaleX</a>] = prev_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5a3271fdb76ac77fd9c6a61011c51e6f8e">RingbufScaleX</a>] / relative.scale.s[0];</div>
<div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;    new_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5aad52f91fb41da1ce46b0b832f1c5a04b">RingbufScaleY</a>] = prev_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5aad52f91fb41da1ce46b0b832f1c5a04b">RingbufScaleY</a>] / relative.scale.s[1];</div>
<div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160; </div>
<div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;    <span class="keywordflow">if</span> (deshake_ctx-&gt;debug_on) {</div>
<div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;        <span class="keywordflow">if</span> (!deshake_ctx-&gt;is_yuv) {</div>
<div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;            deshake_ctx-&gt;grayscale_time     += <a class="code" href="opencl_8c.html#abb2ed9501a29a5fbfed7971fefabf291">ff_opencl_get_event_time</a>(grayscale_event);</div>
<div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;        }</div>
<div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;        deshake_ctx-&gt;harris_response_time   += <a class="code" href="opencl_8c.html#abb2ed9501a29a5fbfed7971fefabf291">ff_opencl_get_event_time</a>(harris_response_event);</div>
<div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;        deshake_ctx-&gt;refine_features_time   += <a class="code" href="opencl_8c.html#abb2ed9501a29a5fbfed7971fefabf291">ff_opencl_get_event_time</a>(refine_features_event);</div>
<div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;        deshake_ctx-&gt;brief_descriptors_time += <a class="code" href="opencl_8c.html#abb2ed9501a29a5fbfed7971fefabf291">ff_opencl_get_event_time</a>(brief_event);</div>
<div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;        deshake_ctx-&gt;match_descriptors_time += <a class="code" href="opencl_8c.html#abb2ed9501a29a5fbfed7971fefabf291">ff_opencl_get_event_time</a>(match_descriptors_event);</div>
<div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;        deshake_ctx-&gt;read_buf_time          += <a class="code" href="opencl_8c.html#abb2ed9501a29a5fbfed7971fefabf291">ff_opencl_get_event_time</a>(read_buf_event);</div>
<div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;    }</div>
<div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160; </div>
<div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;    <span class="keywordflow">goto</span> <a class="code" href="avrndec_8c.html#a13191ba45577b1d4f9b37d64df91eb55">end</a>;</div>
<div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160; </div>
<div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;no_motion_data:</div>
<div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;    new_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5ad4065c2ecefa3f3486ff44e2e409008d">RingbufX</a>]      = 0.0f;</div>
<div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;    new_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5a647afa6f628f3817a6923cfcafe6779a">RingbufY</a>]      = 0.0f;</div>
<div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;    new_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5a7071a06d4f6642fd037c82dd101a3321">RingbufRot</a>]    = 0.0f;</div>
<div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;    new_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5a3271fdb76ac77fd9c6a61011c51e6f8e">RingbufScaleX</a>] = 1.0f;</div>
<div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;    new_vals[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5aad52f91fb41da1ce46b0b832f1c5a04b">RingbufScaleY</a>] = 1.0f;</div>
<div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160; </div>
<div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; num_vectors; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;        deshake_ctx-&gt;matches_contig_host[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].should_consider = 0;</div>
<div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;    }</div>
<div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;    debug_matches.num_model_matches = 0;</div>
<div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160; </div>
<div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;    <span class="keywordflow">if</span> (deshake_ctx-&gt;debug_on) {</div>
<div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga9b58b28e2d429b930b69db19877f76a8">AV_LOG_VERBOSE</a>,</div>
<div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;            <span class="stringliteral">&quot;\n[ALERT] No motion data found in queue_frame, motion reset to 0\n\n&quot;</span></div>
<div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;        );</div>
<div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;    }</div>
<div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160; </div>
<div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;    <span class="keywordflow">goto</span> <a class="code" href="avrndec_8c.html#a13191ba45577b1d4f9b37d64df91eb55">end</a>;</div>
<div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160; </div>
<div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;<a class="code" href="avrndec_8c.html#a13191ba45577b1d4f9b37d64df91eb55">end</a>:</div>
<div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;    <span class="comment">// Swap the descriptor buffers (we don&#39;t need the previous frame&#39;s descriptors</span></div>
<div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;    <span class="comment">// again so we will use that space for the next frame&#39;s descriptors)</span></div>
<div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;    <a class="code" href="vf__mcdeint_8c.html#a0b90bc971fe5188fc4d32fe8177a64a5">temp</a> = deshake_ctx-&gt;prev_descriptors;</div>
<div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;    deshake_ctx-&gt;prev_descriptors = deshake_ctx-&gt;descriptors;</div>
<div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;    deshake_ctx-&gt;descriptors = <a class="code" href="vf__mcdeint_8c.html#a0b90bc971fe5188fc4d32fe8177a64a5">temp</a>;</div>
<div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160; </div>
<div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;    <span class="comment">// Same for the refined features</span></div>
<div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;    <a class="code" href="vf__mcdeint_8c.html#a0b90bc971fe5188fc4d32fe8177a64a5">temp</a> = deshake_ctx-&gt;prev_refined_features;</div>
<div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;    deshake_ctx-&gt;prev_refined_features = deshake_ctx-&gt;refined_features;</div>
<div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;    deshake_ctx-&gt;refined_features = <a class="code" href="vf__mcdeint_8c.html#a0b90bc971fe5188fc4d32fe8177a64a5">temp</a>;</div>
<div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160; </div>
<div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;    <span class="keywordflow">if</span> (deshake_ctx-&gt;debug_on) {</div>
<div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;        <span class="keywordflow">if</span> (num_vectors == 0) {</div>
<div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;            debug_matches.matches = <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;            debug_matches.matches = <a class="code" href="mem_8c.html#a254f3455439c15a2c8a75b8f0235fdbd">av_malloc_array</a>(num_vectors, <span class="keyword">sizeof</span>(<a class="code" href="struct_motion_vector.html">MotionVector</a>));</div>
<div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160; </div>
<div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;            <span class="keywordflow">if</span> (!debug_matches.matches) {</div>
<div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;                err = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;                <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;            }</div>
<div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;        }</div>
<div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160; </div>
<div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; num_vectors; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;            debug_matches.matches[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>] = deshake_ctx-&gt;matches_contig_host[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;        }</div>
<div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;        debug_matches.num_matches = num_vectors;</div>
<div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160; </div>
<div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;        <a class="code" href="libavutil_2fifo_8c.html#ae95c15dcdd266b4005f8919e4f571180">av_fifo_generic_write</a>(</div>
<div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;            deshake_ctx-&gt;abs_motion.debug_matches,</div>
<div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;            &amp;debug_matches,</div>
<div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;            <span class="keyword">sizeof</span>(<a class="code" href="struct_debug_matches.html">DebugMatches</a>),</div>
<div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;            <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div>
<div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;        );</div>
<div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;    }</div>
<div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160; </div>
<div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5a9113457a0b099555ded29c2f6a521cb7">RingbufCount</a>; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;        <a class="code" href="libavutil_2fifo_8c.html#ae95c15dcdd266b4005f8919e4f571180">av_fifo_generic_write</a>(</div>
<div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;            deshake_ctx-&gt;abs_motion.ringbuffers[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>],</div>
<div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;            &amp;new_vals[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>],</div>
<div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;            <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>),</div>
<div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;            <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div>
<div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;        );</div>
<div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;    }</div>
<div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160; </div>
<div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="framequeue_8c.html#aa1571338eb6b210d4053c8a435f24068">ff_framequeue_add</a>(&amp;deshake_ctx-&gt;fq, input_frame);</div>
<div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160; </div>
<div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;<a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>:</div>
<div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;    clFinish(deshake_ctx-&gt;command_queue);</div>
<div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;    <a class="code" href="group__lavu__frame.html#ga979d73f3228814aee56aeca0636e37cc">av_frame_free</a>(&amp;input_frame);</div>
<div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;    <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;}</div>
<div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160; </div>
<div class="line"><a name="l02039"></a><span class="lineno"><a class="line" href="vf__deshake__opencl_8c.html#ab5283561721ad2970de4e2d569100dac"> 2039</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="vf__deshake__opencl_8c.html#ab5283561721ad2970de4e2d569100dac">activate</a>(<a class="code" href="struct_a_v_filter_context.html">AVFilterContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>)</div>
<div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;{</div>
<div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;    <a class="code" href="struct_a_v_filter_link.html">AVFilterLink</a> *<a class="code" href="filter__design_8txt.html#a720b17cc89203cfc793b5d7e17a6ca88">inlink</a> = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;inputs[0];</div>
<div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;    <a class="code" href="struct_a_v_filter_link.html">AVFilterLink</a> *outlink = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;outputs[0];</div>
<div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;    <a class="code" href="struct_deshake_open_c_l_context.html">DeshakeOpenCLContext</a> *deshake_ctx = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;priv;</div>
<div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;    <a class="code" href="struct_a_v_frame.html">AVFrame</a> *<a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a> = <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>, <a class="code" href="filter__design_8txt.html#ad6a339ae538717b3e99082a8016207df">status</a>;</div>
<div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;    int64_t <a class="code" href="transcode__aac_8c.html#a4fbb704fb96c36a78a36eee010306ce7">pts</a>;</div>
<div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160; </div>
<div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;    <a class="code" href="filters_8h.html#ab82b9a98da3d2483b5b5457d5e8570fc">FF_FILTER_FORWARD_STATUS_BACK</a>(outlink, <a class="code" href="filter__design_8txt.html#a720b17cc89203cfc793b5d7e17a6ca88">inlink</a>);</div>
<div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160; </div>
<div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;    <span class="keywordflow">if</span> (!deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#ac859d628df2ed7cd622905fdb6365b33">eof</a>) {</div>
<div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;        <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = <a class="code" href="avfilter_8c.html#ac1daee38f363044775732a960441861c">ff_inlink_consume_frame</a>(<a class="code" href="filter__design_8txt.html#a720b17cc89203cfc793b5d7e17a6ca88">inlink</a>, &amp;<a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>);</div>
<div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> &lt; 0)</div>
<div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>;</div>
<div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> &gt; 0) {</div>
<div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;            <span class="keywordflow">if</span> (!<a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>-&gt;hw_frames_ctx)</div>
<div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EINVAL);</div>
<div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160; </div>
<div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;            <span class="keywordflow">if</span> (!deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#a460f3b6df63381875e9b8750a04fd925">initialized</a>) {</div>
<div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;                <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = <a class="code" href="vf__deshake__opencl_8c.html#a129d88019af4c9f6579da1bb0b2aab3d">deshake_opencl_init</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>);</div>
<div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> &lt; 0)</div>
<div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;                    <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>;</div>
<div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;            }</div>
<div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160; </div>
<div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;            <span class="comment">// If there is no more space in the ringbuffers, remove the oldest</span></div>
<div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;            <span class="comment">// values to make room for the new ones</span></div>
<div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="libavutil_2fifo_8c.html#ac1e0d8ee7f1568cb40fa95a740c60f13">av_fifo_space</a>(deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#af41b236ec464389c9700936e54260726">abs_motion</a>.<a class="code" href="struct_absolute_frame_motion.html#a8cfe39ca16b5020b5aa3d0c67cb20bbb">ringbuffers</a>[<a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5ad4065c2ecefa3f3486ff44e2e409008d">RingbufX</a>]) == 0) {</div>
<div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5a9113457a0b099555ded29c2f6a521cb7">RingbufCount</a>; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;                    <a class="code" href="libavutil_2fifo_8c.html#a037f66cc2b92aebbc363617387d39f6f">av_fifo_drain</a>(deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#af41b236ec464389c9700936e54260726">abs_motion</a>.<a class="code" href="struct_absolute_frame_motion.html#a8cfe39ca16b5020b5aa3d0c67cb20bbb">ringbuffers</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>], <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));</div>
<div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;                }</div>
<div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;            }</div>
<div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;            <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = <a class="code" href="vf__deshake__opencl_8c.html#a4a2c3e7952056207a49b44440a141977">queue_frame</a>(<a class="code" href="filter__design_8txt.html#a720b17cc89203cfc793b5d7e17a6ca88">inlink</a>, <a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>);</div>
<div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> &lt; 0)</div>
<div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>;</div>
<div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> &gt;= 0) {</div>
<div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;                <span class="comment">// See if we have enough buffered frames to process one</span></div>
<div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;                <span class="comment">//</span></div>
<div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;                <span class="comment">// &quot;enough&quot; is half the smooth window of queued frames into the future</span></div>
<div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="framequeue_8h.html#ac41263ba7691b6c83fd3af99920206cd">ff_framequeue_queued_frames</a>(&amp;deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#a776fbef11213f42fc88a93f39cf7d3f3">fq</a>) &gt;= deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#a4b73a586695575b9a355baae0432be1e">smooth_window</a> / 2) {</div>
<div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;                    <span class="keywordflow">return</span> <a class="code" href="vf__deshake__opencl_8c.html#a38f6bd6727ead1dc7a8c6abf741dc413">filter_frame</a>(<a class="code" href="filter__design_8txt.html#a720b17cc89203cfc793b5d7e17a6ca88">inlink</a>, <a class="code" href="framequeue_8c.html#a153444cc22b19e36a5a5680d4bf50930">ff_framequeue_take</a>(&amp;deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#a776fbef11213f42fc88a93f39cf7d3f3">fq</a>));</div>
<div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;                }</div>
<div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;            }</div>
<div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;        }</div>
<div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;    }</div>
<div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160; </div>
<div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;    <span class="keywordflow">if</span> (!deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#ac859d628df2ed7cd622905fdb6365b33">eof</a> &amp;&amp; <a class="code" href="avfilter_8c.html#a489a38152dc91a0394eb556a7a7805c2">ff_inlink_acknowledge_status</a>(<a class="code" href="filter__design_8txt.html#a720b17cc89203cfc793b5d7e17a6ca88">inlink</a>, &amp;<a class="code" href="filter__design_8txt.html#ad6a339ae538717b3e99082a8016207df">status</a>, &amp;<a class="code" href="transcode__aac_8c.html#a4fbb704fb96c36a78a36eee010306ce7">pts</a>)) {</div>
<div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="filter__design_8txt.html#ad6a339ae538717b3e99082a8016207df">status</a> == <a class="code" href="group__lavu__error.html#gab4faa0afdf35076914824200331defff">AVERROR_EOF</a>) {</div>
<div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;            deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#ac859d628df2ed7cd622905fdb6365b33">eof</a> = 1;</div>
<div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;        }</div>
<div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;    }</div>
<div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160; </div>
<div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;    <span class="keywordflow">if</span> (deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#ac859d628df2ed7cd622905fdb6365b33">eof</a>) {</div>
<div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;        <span class="comment">// Finish processing the rest of the frames in the queue.</span></div>
<div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;        <span class="keywordflow">while</span>(<a class="code" href="framequeue_8h.html#ac41263ba7691b6c83fd3af99920206cd">ff_framequeue_queued_frames</a>(&amp;deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#a776fbef11213f42fc88a93f39cf7d3f3">fq</a>) != 0) {</div>
<div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5a9113457a0b099555ded29c2f6a521cb7">RingbufCount</a>; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;                <a class="code" href="libavutil_2fifo_8c.html#a037f66cc2b92aebbc363617387d39f6f">av_fifo_drain</a>(deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#af41b236ec464389c9700936e54260726">abs_motion</a>.<a class="code" href="struct_absolute_frame_motion.html#a8cfe39ca16b5020b5aa3d0c67cb20bbb">ringbuffers</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>], <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));</div>
<div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;            }</div>
<div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160; </div>
<div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;            <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = <a class="code" href="vf__deshake__opencl_8c.html#a38f6bd6727ead1dc7a8c6abf741dc413">filter_frame</a>(<a class="code" href="filter__design_8txt.html#a720b17cc89203cfc793b5d7e17a6ca88">inlink</a>, <a class="code" href="framequeue_8c.html#a153444cc22b19e36a5a5680d4bf50930">ff_framequeue_take</a>(&amp;deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#a776fbef11213f42fc88a93f39cf7d3f3">fq</a>));</div>
<div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> &lt; 0) {</div>
<div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>;</div>
<div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;            }</div>
<div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;        }</div>
<div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160; </div>
<div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;        <span class="keywordflow">if</span> (deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#af53b59cc19d39adb77f6337cbc132b07">debug_on</a>) {</div>
<div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, <a class="code" href="group__lavu__log__constants.html#ga9b58b28e2d429b930b69db19877f76a8">AV_LOG_VERBOSE</a>,</div>
<div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;                <span class="stringliteral">&quot;Average kernel execution times:\n&quot;</span></div>
<div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;                <span class="stringliteral">&quot;\t        grayscale: %0.3f ms\n&quot;</span></div>
<div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;                <span class="stringliteral">&quot;\t  harris_response: %0.3f ms\n&quot;</span></div>
<div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;                <span class="stringliteral">&quot;\t  refine_features: %0.3f ms\n&quot;</span></div>
<div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;                <span class="stringliteral">&quot;\tbrief_descriptors: %0.3f ms\n&quot;</span></div>
<div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;                <span class="stringliteral">&quot;\tmatch_descriptors: %0.3f ms\n&quot;</span></div>
<div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;                <span class="stringliteral">&quot;\t        transform: %0.3f ms\n&quot;</span></div>
<div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;                <span class="stringliteral">&quot;\t     crop_upscale: %0.3f ms\n&quot;</span></div>
<div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;                <span class="stringliteral">&quot;Average buffer read times:\n&quot;</span></div>
<div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;                <span class="stringliteral">&quot;\t     features buf: %0.3f ms\n&quot;</span>,</div>
<div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;                <a class="code" href="vf__deshake__opencl_8c.html#a842030a6e61b33e1dfebf260817e112a">averaged_event_time_ms</a>(deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#a47dadaea7e4fbae9dbcfc22c935eada8">grayscale_time</a>, deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#a385c7d3da418f0a685ecc00756fcd4cf">curr_frame</a>),</div>
<div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;                <a class="code" href="vf__deshake__opencl_8c.html#a842030a6e61b33e1dfebf260817e112a">averaged_event_time_ms</a>(deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#a0dc75da84837a440352d277911b7ac2f">harris_response_time</a>, deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#a385c7d3da418f0a685ecc00756fcd4cf">curr_frame</a>),</div>
<div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;                <a class="code" href="vf__deshake__opencl_8c.html#a842030a6e61b33e1dfebf260817e112a">averaged_event_time_ms</a>(deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#a3a240a85dceb2b2336bf3230bd4ebc36">refine_features_time</a>, deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#a385c7d3da418f0a685ecc00756fcd4cf">curr_frame</a>),</div>
<div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;                <a class="code" href="vf__deshake__opencl_8c.html#a842030a6e61b33e1dfebf260817e112a">averaged_event_time_ms</a>(deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#a1cd26a8dce26c3f5cbdbbf19ca88c6c3">brief_descriptors_time</a>, deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#a385c7d3da418f0a685ecc00756fcd4cf">curr_frame</a>),</div>
<div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;                <a class="code" href="vf__deshake__opencl_8c.html#a842030a6e61b33e1dfebf260817e112a">averaged_event_time_ms</a>(deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#a6994522939118f1aff64407eccc75261">match_descriptors_time</a>, deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#a385c7d3da418f0a685ecc00756fcd4cf">curr_frame</a>),</div>
<div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;                <a class="code" href="vf__deshake__opencl_8c.html#a842030a6e61b33e1dfebf260817e112a">averaged_event_time_ms</a>(deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#a96d94e25fb2446f405147a0c9a46a769">transform_time</a>, deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#a385c7d3da418f0a685ecc00756fcd4cf">curr_frame</a>),</div>
<div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;                <a class="code" href="vf__deshake__opencl_8c.html#a842030a6e61b33e1dfebf260817e112a">averaged_event_time_ms</a>(deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#ae96c83d6273eedf2402e2b59b2ff7905">crop_upscale_time</a>, deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#a385c7d3da418f0a685ecc00756fcd4cf">curr_frame</a>),</div>
<div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;                <a class="code" href="vf__deshake__opencl_8c.html#a842030a6e61b33e1dfebf260817e112a">averaged_event_time_ms</a>(deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#a2d119e5475c47905ac57b5289cc7798b">read_buf_time</a>, deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#a385c7d3da418f0a685ecc00756fcd4cf">curr_frame</a>)</div>
<div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;            );</div>
<div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;        }</div>
<div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160; </div>
<div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;        <a class="code" href="filters_8h.html#a8f0a6162fb5fb55d4c4a30f509781dd0">ff_outlink_set_status</a>(outlink, <a class="code" href="group__lavu__error.html#gab4faa0afdf35076914824200331defff">AVERROR_EOF</a>, deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#ac7aef1ea8edc37e98f593dfcd91dad84">duration</a>);</div>
<div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;    }</div>
<div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160; </div>
<div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;    <span class="keywordflow">if</span> (!deshake_ctx-&gt;<a class="code" href="struct_deshake_open_c_l_context.html#ac859d628df2ed7cd622905fdb6365b33">eof</a>) {</div>
<div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;        <a class="code" href="filter__design_8txt.html#adcd13caad2025930d784c1fb557e5cb2">FF_FILTER_FORWARD_WANTED</a>(outlink, <a class="code" href="filter__design_8txt.html#a720b17cc89203cfc793b5d7e17a6ca88">inlink</a>);</div>
<div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;    }</div>
<div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160; </div>
<div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#a1252070a891d5f1bbcadf6b10d5d0745">FFERROR_NOT_READY</a>;</div>
<div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;}</div>
<div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160; </div>
<div class="line"><a name="l02138"></a><span class="lineno"><a class="line" href="vf__deshake__opencl_8c.html#ac60905ad96d6077cf7a6469dbbf4f775"> 2138</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="struct_a_v_filter_pad.html">AVFilterPad</a> <a class="code" href="vf__deshake__opencl_8c.html#ac60905ad96d6077cf7a6469dbbf4f775">deshake_opencl_inputs</a>[] = {</div>
<div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;    {</div>
<div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;        .<a class="code" href="struct_a_v_filter_pad.html#afc112061a6035639934e0135aab7d425">name</a> = <span class="stringliteral">&quot;default&quot;</span>,</div>
<div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;        .type = <a class="code" href="group__lavu__misc.html#gga9a84bba4713dfced21a1a56163be1f48ac1a46f59be5c6c2d3412ab172d6b8cf5">AVMEDIA_TYPE_VIDEO</a>,</div>
<div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;        .config_props = &amp;<a class="code" href="opencl_8c.html#a5fae8f981f497850faaf71344969efe3">ff_opencl_filter_config_input</a>,</div>
<div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;    },</div>
<div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;    { <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> }</div>
<div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;};</div>
<div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160; </div>
<div class="line"><a name="l02147"></a><span class="lineno"><a class="line" href="vf__deshake__opencl_8c.html#a33a9c7758d9d8ac84f56b42bf1205b12"> 2147</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="struct_a_v_filter_pad.html">AVFilterPad</a> <a class="code" href="vf__deshake__opencl_8c.html#a33a9c7758d9d8ac84f56b42bf1205b12">deshake_opencl_outputs</a>[] = {</div>
<div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;    {</div>
<div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;        .<a class="code" href="struct_a_v_filter_pad.html#afc112061a6035639934e0135aab7d425">name</a> = <span class="stringliteral">&quot;default&quot;</span>,</div>
<div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;        .type = <a class="code" href="group__lavu__misc.html#gga9a84bba4713dfced21a1a56163be1f48ac1a46f59be5c6c2d3412ab172d6b8cf5">AVMEDIA_TYPE_VIDEO</a>,</div>
<div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;        .config_props = &amp;<a class="code" href="opencl_8c.html#aca05daad3ec60d3cff401c6dedc80836">ff_opencl_filter_config_output</a>,</div>
<div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;    },</div>
<div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;    { <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> }</div>
<div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;};</div>
<div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160; </div>
<div class="line"><a name="l02156"></a><span class="lineno"><a class="line" href="vf__deshake__opencl_8c.html#ad12dce0a7bf9d908b172a28155b3d261"> 2156</a></span>&#160;<span class="preprocessor">#define OFFSET(x) offsetof(DeshakeOpenCLContext, x)</span></div>
<div class="line"><a name="l02157"></a><span class="lineno"><a class="line" href="vf__deshake__opencl_8c.html#a6ccad09b4a2a06ae178418fdccf5940d"> 2157</a></span>&#160;<span class="preprocessor">#define FLAGS AV_OPT_FLAG_FILTERING_PARAM|AV_OPT_FLAG_VIDEO_PARAM</span></div>
<div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160; </div>
<div class="line"><a name="l02159"></a><span class="lineno"><a class="line" href="vf__deshake__opencl_8c.html#a705710e10ca1ee7f8e8160ffed51f5ba"> 2159</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="struct_a_v_option.html">AVOption</a> <a class="code" href="vf__deshake__opencl_8c.html#a705710e10ca1ee7f8e8160ffed51f5ba">deshake_opencl_options</a>[] = {</div>
<div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;    {</div>
<div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;        <span class="stringliteral">&quot;tripod&quot;</span>, <span class="stringliteral">&quot;simulates a tripod by preventing any camera movement whatsoever &quot;</span></div>
<div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;        <span class="stringliteral">&quot;from the original frame&quot;</span>,</div>
<div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;        <a class="code" href="vf__deshake__opencl_8c.html#ad12dce0a7bf9d908b172a28155b3d261">OFFSET</a>(tripod_mode), <a class="code" href="group__avoptions.html#ggabd75aa30eb8ad6387672df9a1fa79444af3898696f46dc79b74b708d8fa4b52a7">AV_OPT_TYPE_BOOL</a>, {.i64 = 0}, 0, 1, <a class="code" href="vf__deshake__opencl_8c.html#a6ccad09b4a2a06ae178418fdccf5940d">FLAGS</a></div>
<div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;    },</div>
<div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;    {</div>
<div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;        <span class="stringliteral">&quot;debug&quot;</span>, <span class="stringliteral">&quot;turn on additional debugging information&quot;</span>,</div>
<div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;        <a class="code" href="vf__deshake__opencl_8c.html#ad12dce0a7bf9d908b172a28155b3d261">OFFSET</a>(debug_on), <a class="code" href="group__avoptions.html#ggabd75aa30eb8ad6387672df9a1fa79444af3898696f46dc79b74b708d8fa4b52a7">AV_OPT_TYPE_BOOL</a>, {.i64 = 0}, 0, 1, <a class="code" href="vf__deshake__opencl_8c.html#a6ccad09b4a2a06ae178418fdccf5940d">FLAGS</a></div>
<div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;    },</div>
<div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;    {</div>
<div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;        <span class="stringliteral">&quot;adaptive_crop&quot;</span>, <span class="stringliteral">&quot;attempt to subtly crop borders to reduce mirrored content&quot;</span>,</div>
<div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;        <a class="code" href="vf__deshake__opencl_8c.html#ad12dce0a7bf9d908b172a28155b3d261">OFFSET</a>(should_crop), <a class="code" href="group__avoptions.html#ggabd75aa30eb8ad6387672df9a1fa79444af3898696f46dc79b74b708d8fa4b52a7">AV_OPT_TYPE_BOOL</a>, {.i64 = 1}, 0, 1, <a class="code" href="vf__deshake__opencl_8c.html#a6ccad09b4a2a06ae178418fdccf5940d">FLAGS</a></div>
<div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;    },</div>
<div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;    {</div>
<div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;        <span class="stringliteral">&quot;refine_features&quot;</span>, <span class="stringliteral">&quot;refine feature point locations at a sub-pixel level&quot;</span>,</div>
<div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;        <a class="code" href="vf__deshake__opencl_8c.html#ad12dce0a7bf9d908b172a28155b3d261">OFFSET</a>(refine_features), <a class="code" href="group__avoptions.html#ggabd75aa30eb8ad6387672df9a1fa79444af3898696f46dc79b74b708d8fa4b52a7">AV_OPT_TYPE_BOOL</a>, {.i64 = 1}, 0, 1, <a class="code" href="vf__deshake__opencl_8c.html#a6ccad09b4a2a06ae178418fdccf5940d">FLAGS</a></div>
<div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;    },</div>
<div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;    {</div>
<div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;        <span class="stringliteral">&quot;smooth_strength&quot;</span>, <span class="stringliteral">&quot;smoothing strength (0 attempts to adaptively determine optimal strength)&quot;</span>,</div>
<div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;        <a class="code" href="vf__deshake__opencl_8c.html#ad12dce0a7bf9d908b172a28155b3d261">OFFSET</a>(smooth_percent), <a class="code" href="group__avoptions.html#ggabd75aa30eb8ad6387672df9a1fa79444ae91d3f6cbac4a4de2a6e880ac2a52d1a">AV_OPT_TYPE_FLOAT</a>, {.dbl = 0.0f}, 0.0f, 1.0f, <a class="code" href="vf__deshake__opencl_8c.html#a6ccad09b4a2a06ae178418fdccf5940d">FLAGS</a></div>
<div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;    },</div>
<div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;    {</div>
<div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;        <span class="stringliteral">&quot;smooth_window_multiplier&quot;</span>, <span class="stringliteral">&quot;multiplier for number of frames to buffer for motion data&quot;</span>,</div>
<div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;        <a class="code" href="vf__deshake__opencl_8c.html#ad12dce0a7bf9d908b172a28155b3d261">OFFSET</a>(smooth_window_multiplier), <a class="code" href="group__avoptions.html#ggabd75aa30eb8ad6387672df9a1fa79444ae91d3f6cbac4a4de2a6e880ac2a52d1a">AV_OPT_TYPE_FLOAT</a>, {.dbl = 2.0}, 0.1, 10.0, <a class="code" href="vf__deshake__opencl_8c.html#a6ccad09b4a2a06ae178418fdccf5940d">FLAGS</a></div>
<div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;    },</div>
<div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;    { <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> }</div>
<div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;};</div>
<div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160; </div>
<div class="line"><a name="l02188"></a><span class="lineno"><a class="line" href="vf__deshake__opencl_8c.html#aa02e7bfd9e5b6abc19ae39804c7c7fbe"> 2188</a></span>&#160;<a class="code" href="vf__deshake__opencl_8c.html#aa02e7bfd9e5b6abc19ae39804c7c7fbe">AVFILTER_DEFINE_CLASS</a>(deshake_opencl);</div>
<div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160; </div>
<div class="line"><a name="l02190"></a><span class="lineno"><a class="line" href="vf__deshake__opencl_8c.html#abd3951fc06f51de0aefb0ef72cc3aa4a"> 2190</a></span>&#160;<a class="code" href="struct_a_v_filter.html">AVFilter</a> <a class="code" href="vf__deshake__opencl_8c.html#abd3951fc06f51de0aefb0ef72cc3aa4a">ff_vf_deshake_opencl</a> = {</div>
<div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;    .<a class="code" href="struct_a_v_filter.html#a28a4776f344f91055f42a4c2a1b15c0c">name</a>           = <span class="stringliteral">&quot;deshake_opencl&quot;</span>,</div>
<div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;    .description    = <a class="code" href="libavutil_2internal_8h.html#a3c0fa12fafe59c44d4b16e60d8385637">NULL_IF_CONFIG_SMALL</a>(<span class="stringliteral">&quot;Feature-point based video stabilization filter&quot;</span>),</div>
<div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;    .priv_size      = <span class="keyword">sizeof</span>(<a class="code" href="vf__deshake__opencl_8c.html#a1e2fb9d8afcc831ea361958b31cc3eb2">DeshakeOpenCLContext</a>),</div>
<div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;    .priv_class     = &amp;deshake_opencl_class,</div>
<div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;    .<a class="code" href="avrndec_8c.html#a41c0c9c8aa8e1fd12d65b18dd6948b09">init</a>           = &amp;<a class="code" href="opencl_8c.html#a78e70e71221ecf678d4c3f2756f5682b">ff_opencl_filter_init</a>,</div>
<div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;    .<a class="code" href="crystalhd_8c.html#a47e28e6ea289d3f83ad1883ddde5a422">uninit</a>         = &amp;<a class="code" href="vf__deshake__opencl_8c.html#a8a3ec369b17de7aad4fa5b00f8270411">deshake_opencl_uninit</a>,</div>
<div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;    .<a class="code" href="aeval_8c.html#a5b4e302dfe4b2ee5369f0278621acd5f">query_formats</a>  = &amp;<a class="code" href="opencl_8c.html#ad0424e96c8176309c6743fd1a8b84bdc">ff_opencl_filter_query_formats</a>,</div>
<div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;    .<a class="code" href="vf__deshake__opencl_8c.html#ab5283561721ad2970de4e2d569100dac">activate</a>       = <a class="code" href="vf__deshake__opencl_8c.html#ab5283561721ad2970de4e2d569100dac">activate</a>,</div>
<div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;    .<a class="code" href="filter__design_8txt.html#a45917ba5e6c8b798c6e2ba6ca7301a5d">inputs</a>         = <a class="code" href="vf__deshake__opencl_8c.html#ac60905ad96d6077cf7a6469dbbf4f775">deshake_opencl_inputs</a>,</div>
<div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;    .<a class="code" href="af__acontrast_8c.html#a7ddb0b5ac76101c5bee71e9840bf1698">outputs</a>        = <a class="code" href="vf__deshake__opencl_8c.html#a33a9c7758d9d8ac84f56b42bf1205b12">deshake_opencl_outputs</a>,</div>
<div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;    .flags_internal = <a class="code" href="libavfilter_2internal_8h.html#a58d239fb5092965f79256de6e903ed8a">FF_FILTER_FLAG_HWFRAME_AWARE</a></div>
<div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;};</div>
</div><!-- fragment --></div><!-- contents -->
<div class="ttc" id="avf__deshake__opencl_8c_html_ac60905ad96d6077cf7a6469dbbf4f775"><div class="ttname"><a href="vf__deshake__opencl_8c.html#ac60905ad96d6077cf7a6469dbbf4f775">deshake_opencl_inputs</a></div><div class="ttdeci">static const AVFilterPad deshake_opencl_inputs[]</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l02138">vf_deshake_opencl.c:2138</a></div></div>
<div class="ttc" id="avf__deshake__opencl_8c_html_aa02e7bfd9e5b6abc19ae39804c7c7fbe"><div class="ttname"><a href="vf__deshake__opencl_8c.html#aa02e7bfd9e5b6abc19ae39804c7c7fbe">AVFILTER_DEFINE_CLASS</a></div><div class="ttdeci">AVFILTER_DEFINE_CLASS(deshake_opencl)</div></div>
<div class="ttc" id="avf__deshake__opencl_8c_html_a204a81d3183522f258d69d430fe4122e"><div class="ttname"><a href="vf__deshake__opencl_8c.html#a204a81d3183522f258d69d430fe4122e">MATCHES_CONTIG_SIZE</a></div><div class="ttdeci">#define MATCHES_CONTIG_SIZE</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00093">vf_deshake_opencl.c:93</a></div></div>
<div class="ttc" id="avideo_8c_html_a7f0f699d7689ef551622672dcd39a96a"><div class="ttname"><a href="video_8c.html#a7f0f699d7689ef551622672dcd39a96a">ff_get_video_buffer</a></div><div class="ttdeci">AVFrame * ff_get_video_buffer(AVFilterLink *link, int w, int h)</div><div class="ttdef"><b>Definition:</b> <a href="video_8c_source.html#l00099">video.c:99</a></div></div>
<div class="ttc" id="astruct_deshake_open_c_l_context_html_a1cd26a8dce26c3f5cbdbbf19ca88c6c3"><div class="ttname"><a href="struct_deshake_open_c_l_context.html#a1cd26a8dce26c3f5cbdbbf19ca88c6c3">DeshakeOpenCLContext::brief_descriptors_time</a></div><div class="ttdeci">unsigned long long brief_descriptors_time</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00303">vf_deshake_opencl.c:303</a></div></div>
<div class="ttc" id="astruct_deshake_open_c_l_context_html_a54085661b99c1e0c7034c6c0cad3be52"><div class="ttname"><a href="struct_deshake_open_c_l_context.html#a54085661b99c1e0c7034c6c0cad3be52">DeshakeOpenCLContext::smooth_percent</a></div><div class="ttdeci">float smooth_percent</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00288">vf_deshake_opencl.c:288</a></div></div>
<div class="ttc" id="aopencl_8h_html_a2233c01864860abf420194b0a662a39e"><div class="ttname"><a href="opencl_8h.html#a2233c01864860abf420194b0a662a39e">CL_RUN_KERNEL_WITH_ARGS</a></div><div class="ttdeci">#define CL_RUN_KERNEL_WITH_ARGS(queue, kernel, global_work_size, local_work_size, event,...)</div><div class="ttdef"><b>Definition:</b> <a href="opencl_8h_source.html#l00180">opencl.h:180</a></div></div>
<div class="ttc" id="astruct_deshake_open_c_l_context_html_a229dd8f8447b313ed366581b8683a141"><div class="ttname"><a href="struct_deshake_open_c_l_context.html#a229dd8f8447b313ed366581b8683a141">DeshakeOpenCLContext::kernel_transform</a></div><div class="ttdeci">cl_kernel kernel_transform</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00251">vf_deshake_opencl.c:251</a></div></div>
<div class="ttc" id="acast5_8c_html_ab685025d5c2360da7a29094ccab00ad5"><div class="ttname"><a href="cast5_8c.html#ab685025d5c2360da7a29094ccab00ad5">F2</a></div><div class="ttdeci">#define F2(l, r, i)</div><div class="ttdef"><b>Definition:</b> <a href="cast5_8c_source.html#l00040">cast5.c:40</a></div></div>
<div class="ttc" id="apixfmt_8h_html_a9a8e335cf3be472042bc9f0cf80cd4c5"><div class="ttname"><a href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5">AVPixelFormat</a></div><div class="ttdeci">AVPixelFormat</div><div class="ttdef"><b>Definition:</b> <a href="pixfmt_8h_source.html#l00064">pixfmt.h:64</a></div></div>
<div class="ttc" id="avf__deshake__opencl_8c_html_adc33dfb26baa854c039955d7439fe8c0"><div class="ttname"><a href="vf__deshake__opencl_8c.html#adc33dfb26baa854c039955d7439fe8c0">free_debug_matches</a></div><div class="ttdeci">static void free_debug_matches(AbsoluteFrameMotion *afm)</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00152">vf_deshake_opencl.c:152</a></div></div>
<div class="ttc" id="avf__deshake__opencl_8c_html_a1ed197b9ba0435de2e69f24203e2c75a"><div class="ttname"><a href="vf__deshake__opencl_8c.html#a1ed197b9ba0435de2e69f24203e2c75a">SimilarityMatrix</a></div><div class="ttdeci">struct SimilarityMatrix SimilarityMatrix</div></div>
<div class="ttc" id="afilter__design_8txt_html_ad6a339ae538717b3e99082a8016207df"><div class="ttname"><a href="filter__design_8txt.html#ad6a339ae538717b3e99082a8016207df">status</a></div><div class="ttdeci">they must not be accessed directly The fifo field contains the frames that are queued in the input for processing by the filter The status_in and status_out fields contains the queued status(EOF or error) of the link</div></div>
<div class="ttc" id="aavrndec_8c_html_a41c0c9c8aa8e1fd12d65b18dd6948b09"><div class="ttname"><a href="avrndec_8c.html#a41c0c9c8aa8e1fd12d65b18dd6948b09">init</a></div><div class="ttdeci">static av_cold int init(AVCodecContext *avctx)</div><div class="ttdef"><b>Definition:</b> <a href="avrndec_8c_source.html#l00035">avrndec.c:35</a></div></div>
<div class="ttc" id="astruct_open_c_l_filter_context_html"><div class="ttname"><a href="struct_open_c_l_filter_context.html">OpenCLFilterContext</a></div><div class="ttdef"><b>Definition:</b> <a href="opencl_8h_source.html#l00036">opencl.h:36</a></div></div>
<div class="ttc" id="avf__curves_8c_html_a33ac7b8ce37a3a60855883424fcf8b62"><div class="ttname"><a href="vf__curves_8c.html#a33ac7b8ce37a3a60855883424fcf8b62">r</a></div><div class="ttdeci">const char * r</div><div class="ttdef"><b>Definition:</b> <a href="vf__curves_8c_source.html#l00114">vf_curves.c:114</a></div></div>
<div class="ttc" id="afilter__design_8txt_html_adf2fb515710d47541f7150ecd2950e76"><div class="ttname"><a href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a></div><div class="ttdeci">Filter the word frame indicates either a video frame or a group of audio as stored in an AVFrame structure Format for each input and each output the list of supported formats For video that means pixel format For audio that means channel sample they are references to shared objects When the negotiation mechanism computes the intersection of the formats supported at each end of a all references to both lists are replaced with a reference to the intersection And when a single format is eventually chosen for a link amongst the remaining all references to the list are updated That means that if a filter requires that its input and output have the same format amongst a supported all it has to do is use a reference to the same list of formats query_formats can leave some formats unset and return AVERROR(EAGAIN) to cause the negotiation mechanism toagain later. That can be used by filters with complex requirements to use the format negotiated on one link to set the formats supported on another. Frame references ownership and permissions</div></div>
<div class="ttc" id="aopt_8h_html"><div class="ttname"><a href="opt_8h.html">opt.h</a></div></div>
<div class="ttc" id="astruct_deshake_open_c_l_context_html_a2abcf1be5e0e345a6bb0be190fbe0378"><div class="ttname"><a href="struct_deshake_open_c_l_context.html#a2abcf1be5e0e345a6bb0be190fbe0378">DeshakeOpenCLContext::prev_descriptors</a></div><div class="ttdeci">cl_mem prev_descriptors</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00269">vf_deshake_opencl.c:269</a></div></div>
<div class="ttc" id="astruct_a_v_filter_link_html_a9711515003bff06b74d02adb751e8c78"><div class="ttname"><a href="struct_a_v_filter_link.html#a9711515003bff06b74d02adb751e8c78">AVFilterLink::frame_rate</a></div><div class="ttdeci">AVRational frame_rate</div><div class="ttdef"><b>Definition:</b> <a href="avfilter_8h_source.html#l00557">avfilter.h:557</a></div></div>
<div class="ttc" id="astruct_deshake_open_c_l_context_html_a7ae5c4772bc57a251f3cd25c5ba955be"><div class="ttname"><a href="struct_deshake_open_c_l_context.html#a7ae5c4772bc57a251f3cd25c5ba955be">DeshakeOpenCLContext::tripod_mode</a></div><div class="ttdeci">int tripod_mode</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00280">vf_deshake_opencl.c:280</a></div></div>
<div class="ttc" id="avf__deshake__opencl_8c_html_a3e5ef8037d7bb11051e90e3922aa3697"><div class="ttname"><a href="vf__deshake__opencl_8c.html#a3e5ef8037d7bb11051e90e3922aa3697">IterIndices</a></div><div class="ttdeci">struct IterIndices IterIndices</div></div>
<div class="ttc" id="avf__deshake__opencl_8c_html_a129d88019af4c9f6579da1bb0b2aab3d"><div class="ttname"><a href="vf__deshake__opencl_8c.html#a129d88019af4c9f6579da1bb0b2aab3d">deshake_opencl_init</a></div><div class="ttdeci">static int deshake_opencl_init(AVFilterContext *avctx)</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l01125">vf_deshake_opencl.c:1125</a></div></div>
<div class="ttc" id="astruct_a_v_filter_link_html"><div class="ttname"><a href="struct_a_v_filter_link.html">AVFilterLink</a></div><div class="ttdef"><b>Definition:</b> <a href="avfilter_8h_source.html#l00471">avfilter.h:471</a></div></div>
<div class="ttc" id="avf__deshake__opencl_8c_html_aac759b3a3a896f0967ba64248283d22b"><div class="ttname"><a href="vf__deshake__opencl_8c.html#aac759b3a3a896f0967ba64248283d22b">estimate_affine_2d</a></div><div class="ttdeci">static int estimate_affine_2d(DeshakeOpenCLContext *deshake_ctx, MotionVector *point_pairs, DebugMatches *debug_matches, const int num_point_pairs, double *model_out, const double threshold, const int max_iters, const double confidence)</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00527">vf_deshake_opencl.c:527</a></div></div>
<div class="ttc" id="alibavutil_2fifo_8c_html_ae95c15dcdd266b4005f8919e4f571180"><div class="ttname"><a href="libavutil_2fifo_8c.html#ae95c15dcdd266b4005f8919e4f571180">av_fifo_generic_write</a></div><div class="ttdeci">int av_fifo_generic_write(AVFifoBuffer *f, void *src, int size, int(*func)(void *, void *, int))</div><div class="ttdef"><b>Definition:</b> <a href="libavutil_2fifo_8c_source.html#l00122">fifo.c:122</a></div></div>
<div class="ttc" id="avf__deshake__opencl_8c_html_a478b505dff6bf71827cc70437b0515b0"><div class="ttname"><a href="vf__deshake__opencl_8c.html#a478b505dff6bf71827cc70437b0515b0">minimize_error</a></div><div class="ttdeci">static int minimize_error(DeshakeOpenCLContext *deshake_ctx, MotionVector *inliers, DebugMatches *debug_matches, const int num_inliers, double *model_out, const int max_iters)</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00683">vf_deshake_opencl.c:683</a></div></div>
<div class="ttc" id="avf__deshake__opencl_8c_html_ad12dce0a7bf9d908b172a28155b3d261"><div class="ttname"><a href="vf__deshake__opencl_8c.html#ad12dce0a7bf9d908b172a28155b3d261">OFFSET</a></div><div class="ttdeci">#define OFFSET(x)</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l02156">vf_deshake_opencl.c:2156</a></div></div>
<div class="ttc" id="alfg_8c_html_aa8cc657d3dca15bc50a94730a4346d58"><div class="ttname"><a href="lfg_8c.html#aa8cc657d3dca15bc50a94730a4346d58">av_lfg_init</a></div><div class="ttdeci">av_cold void av_lfg_init(AVLFG *c, unsigned int seed)</div><div class="ttdef"><b>Definition:</b> <a href="lfg_8c_source.html#l00032">lfg.c:32</a></div></div>
<div class="ttc" id="alibavfilter_2internal_8h_html_a58d239fb5092965f79256de6e903ed8a"><div class="ttname"><a href="libavfilter_2internal_8h.html#a58d239fb5092965f79256de6e903ed8a">FF_FILTER_FLAG_HWFRAME_AWARE</a></div><div class="ttdeci">#define FF_FILTER_FLAG_HWFRAME_AWARE</div><div class="ttdef"><b>Definition:</b> <a href="libavfilter_2internal_8h_source.html#l00339">internal.h:339</a></div></div>
<div class="ttc" id="astruct_a_v_filter_context_html"><div class="ttname"><a href="struct_a_v_filter_context.html">AVFilterContext</a></div><div class="ttdef"><b>Definition:</b> <a href="avfilter_8h_source.html#l00341">avfilter.h:341</a></div></div>
<div class="ttc" id="apixfmt_8h_html_a9a8e335cf3be472042bc9f0cf80cd4c5a9f08094c04f14344b51de97003ab0d54"><div class="ttname"><a href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a9f08094c04f14344b51de97003ab0d54">AV_PIX_FMT_GBRP16BE</a></div><div class="ttdeci">@ AV_PIX_FMT_GBRP16BE</div><div class="ttdoc">planar GBR 4:4:4 48bpp, big-endian</div><div class="ttdef"><b>Definition:</b> <a href="pixfmt_8h_source.html#l00174">pixfmt.h:174</a></div></div>
<div class="ttc" id="aavfilter_8c_html_a65d6e9755eadf69367843dfc738143b4"><div class="ttname"><a href="avfilter_8c.html#a65d6e9755eadf69367843dfc738143b4">ff_filter_frame</a></div><div class="ttdeci">int ff_filter_frame(AVFilterLink *link, AVFrame *frame)</div><div class="ttdef"><b>Definition:</b> <a href="avfilter_8c_source.html#l01091">avfilter.c:1091</a></div></div>
<div class="ttc" id="apixfmt_8h_html_a9a8e335cf3be472042bc9f0cf80cd4c5a15336747ffbc548ea27471d333cdf0e6"><div class="ttname"><a href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a15336747ffbc548ea27471d333cdf0e6">AV_PIX_FMT_GBRP10BE</a></div><div class="ttdeci">@ AV_PIX_FMT_GBRP10BE</div><div class="ttdoc">planar GBR 4:4:4 30bpp, big-endian</div><div class="ttdef"><b>Definition:</b> <a href="pixfmt_8h_source.html#l00172">pixfmt.h:172</a></div></div>
<div class="ttc" id="apixdesc_8c_html_afe0c3e8aef5173de28bbdaea4298f5f0"><div class="ttname"><a href="pixdesc_8c.html#afe0c3e8aef5173de28bbdaea4298f5f0">av_pix_fmt_desc_get</a></div><div class="ttdeci">const AVPixFmtDescriptor * av_pix_fmt_desc_get(enum AVPixelFormat pix_fmt)</div><div class="ttdef"><b>Definition:</b> <a href="pixdesc_8c_source.html#l02573">pixdesc.c:2573</a></div></div>
<div class="ttc" id="agroup__lavu__error_html_gab4faa0afdf35076914824200331defff"><div class="ttname"><a href="group__lavu__error.html#gab4faa0afdf35076914824200331defff">AVERROR_EOF</a></div><div class="ttdeci">#define AVERROR_EOF</div><div class="ttdoc">End of file.</div><div class="ttdef"><b>Definition:</b> <a href="error_8h_source.html#l00055">error.h:55</a></div></div>
<div class="ttc" id="astruct_debug_matches_html_ab0ec0dc3ed944615f4828998616e2387"><div class="ttname"><a href="struct_debug_matches.html#ab0ec0dc3ed944615f4828998616e2387">DebugMatches::matches</a></div><div class="ttdeci">MotionVector * matches</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00124">vf_deshake_opencl.c:124</a></div></div>
<div class="ttc" id="astruct_frame_delta_html_adf861bed13cca1a3d2aba10c6e74e3ba"><div class="ttname"><a href="struct_frame_delta.html#adf861bed13cca1a3d2aba10c6e74e3ba">FrameDelta::scale</a></div><div class="ttdeci">cl_float2 scale</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00177">vf_deshake_opencl.c:177</a></div></div>
<div class="ttc" id="amem_8c_html_a254f3455439c15a2c8a75b8f0235fdbd"><div class="ttname"><a href="mem_8c.html#a254f3455439c15a2c8a75b8f0235fdbd">av_malloc_array</a></div><div class="ttdeci">void * av_malloc_array(size_t nmemb, size_t size)</div><div class="ttdef"><b>Definition:</b> <a href="mem_8c_source.html#l00182">mem.c:182</a></div></div>
<div class="ttc" id="afilter__design_8txt_html_a1252070a891d5f1bbcadf6b10d5d0745"><div class="ttname"><a href="filter__design_8txt.html#a1252070a891d5f1bbcadf6b10d5d0745">FFERROR_NOT_READY</a></div><div class="ttdeci">return FFERROR_NOT_READY</div><div class="ttdef"><b>Definition:</b> <a href="filter__design_8txt_source.html#l00204">filter_design.txt:204</a></div></div>
<div class="ttc" id="astruct_point_pair_html_a2723179bf26cf06740f47f174a26dd4d"><div class="ttname"><a href="struct_point_pair.html#a2723179bf26cf06740f47f174a26dd4d">PointPair::p1</a></div><div class="ttdeci">cl_float2 p1</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00099">vf_deshake_opencl.c:99</a></div></div>
<div class="ttc" id="afilter__design_8txt_html_a720b17cc89203cfc793b5d7e17a6ca88"><div class="ttname"><a href="filter__design_8txt.html#a720b17cc89203cfc793b5d7e17a6ca88">inlink</a></div><div class="ttdeci">The exact code depends on how similar the blocks are and how related they are to the and needs to apply these operations to the correct inlink or outlink if there are several Macros are available to factor that when no extra processing is inlink</div><div class="ttdef"><b>Definition:</b> <a href="filter__design_8txt_source.html#l00212">filter_design.txt:212</a></div></div>
<div class="ttc" id="astruct_motion_vector_html_acb7c81a18a7fcdafce38520f1794ad92"><div class="ttname"><a href="struct_motion_vector.html#acb7c81a18a7fcdafce38520f1794ad92">MotionVector::p</a></div><div class="ttdeci">PointPair p</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00105">vf_deshake_opencl.c:105</a></div></div>
<div class="ttc" id="astruct_absolute_frame_motion_html_ae3114642778302fa1dce520054e222c5"><div class="ttname"><a href="struct_absolute_frame_motion.html#ae3114642778302fa1dce520054e222c5">AbsoluteFrameMotion::data_start_offset</a></div><div class="ttdeci">int data_start_offset</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00144">vf_deshake_opencl.c:144</a></div></div>
<div class="ttc" id="agroup__lavu__frame_html_ga979d73f3228814aee56aeca0636e37cc"><div class="ttname"><a href="group__lavu__frame.html#ga979d73f3228814aee56aeca0636e37cc">av_frame_free</a></div><div class="ttdeci">void av_frame_free(AVFrame **frame)</div><div class="ttdef"><b>Definition:</b> <a href="frame_8c_source.html#l00203">frame.c:203</a></div></div>
<div class="ttc" id="aavrndec_8c_html_a13191ba45577b1d4f9b37d64df91eb55"><div class="ttname"><a href="avrndec_8c.html#a13191ba45577b1d4f9b37d64df91eb55">end</a></div><div class="ttdeci">static av_cold int end(AVCodecContext *avctx)</div><div class="ttdef"><b>Definition:</b> <a href="avrndec_8c_source.html#l00092">avrndec.c:92</a></div></div>
<div class="ttc" id="astruct_deshake_open_c_l_context_html_a3a240a85dceb2b2336bf3230bd4ebc36"><div class="ttname"><a href="struct_deshake_open_c_l_context.html#a3a240a85dceb2b2336bf3230bd4ebc36">DeshakeOpenCLContext::refine_features_time</a></div><div class="ttdeci">unsigned long long refine_features_time</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00302">vf_deshake_opencl.c:302</a></div></div>
<div class="ttc" id="astruct_deshake_open_c_l_context_html_ab292157fd24053079954dea475bcc415"><div class="ttname"><a href="struct_deshake_open_c_l_context.html#ab292157fd24053079954dea475bcc415">DeshakeOpenCLContext::ocf</a></div><div class="ttdeci">OpenCLFilterContext ocf</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00201">vf_deshake_opencl.c:201</a></div></div>
<div class="ttc" id="astruct_deshake_open_c_l_context_html_a77d66a199ea18b038f9df75d5b5ca312"><div class="ttname"><a href="struct_deshake_open_c_l_context.html#a77d66a199ea18b038f9df75d5b5ca312">DeshakeOpenCLContext::descriptors</a></div><div class="ttdeci">cl_mem descriptors</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00267">vf_deshake_opencl.c:267</a></div></div>
<div class="ttc" id="astruct_iter_indices_html"><div class="ttname"><a href="struct_iter_indices.html">IterIndices</a></div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00195">vf_deshake_opencl.c:195</a></div></div>
<div class="ttc" id="astruct_deshake_open_c_l_context_html_a45f1a5b89a64cc7c95df393b2ab082a7"><div class="ttname"><a href="struct_deshake_open_c_l_context.html#a45f1a5b89a64cc7c95df393b2ab082a7">DeshakeOpenCLContext::refined_features</a></div><div class="ttdeci">cl_mem refined_features</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00260">vf_deshake_opencl.c:260</a></div></div>
<div class="ttc" id="astruct_deshake_open_c_l_context_html_ac5cdb80350d15e89f5d04821774dda35"><div class="ttname"><a href="struct_deshake_open_c_l_context.html#ac5cdb80350d15e89f5d04821774dda35">DeshakeOpenCLContext::crop_uv</a></div><div class="ttdeci">CropInfo crop_uv</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00232">vf_deshake_opencl.c:232</a></div></div>
<div class="ttc" id="aopencl_8h_html"><div class="ttname"><a href="opencl_8h.html">opencl.h</a></div></div>
<div class="ttc" id="ainput_8c_html_ad6cdb6a14abe3eab42eaaadc93409aec"><div class="ttname"><a href="input_8c.html#ad6cdb6a14abe3eab42eaaadc93409aec">b</a></div><div class="ttdeci">#define b</div><div class="ttdef"><b>Definition:</b> <a href="input_8c_source.html#l00041">input.c:41</a></div></div>
<div class="ttc" id="avf__deshake__opencl_8c_html_a1579ea8319abda6b1f90db17716333b5ad4065c2ecefa3f3486ff44e2e409008d"><div class="ttname"><a href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5ad4065c2ecefa3f3486ff44e2e409008d">RingbufX</a></div><div class="ttdeci">@ RingbufX</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00112">vf_deshake_opencl.c:112</a></div></div>
<div class="ttc" id="avf__deshake__opencl_8c_html_a1579ea8319abda6b1f90db17716333b5a7071a06d4f6642fd037c82dd101a3321"><div class="ttname"><a href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5a7071a06d4f6642fd037c82dd101a3321">RingbufRot</a></div><div class="ttdeci">@ RingbufRot</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00114">vf_deshake_opencl.c:114</a></div></div>
<div class="ttc" id="astruct_deshake_open_c_l_context_html_a988296689039b7ea4a63b4a2bdc1ca30"><div class="ttname"><a href="struct_deshake_open_c_l_context.html#a988296689039b7ea4a63b4a2bdc1ca30">DeshakeOpenCLContext::is_yuv</a></div><div class="ttdeci">int is_yuv</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00235">vf_deshake_opencl.c:235</a></div></div>
<div class="ttc" id="alibm_8h_html_a70609775e8ac20380d4382942f88c7b4"><div class="ttname"><a href="libm_8h.html#a70609775e8ac20380d4382942f88c7b4">expf</a></div><div class="ttdeci">#define expf(x)</div><div class="ttdef"><b>Definition:</b> <a href="libm_8h_source.html#l00283">libm.h:283</a></div></div>
<div class="ttc" id="astruct_deshake_open_c_l_context_html_a26f185755b7d230c5304b70c3369bff2"><div class="ttname"><a href="struct_deshake_open_c_l_context.html#a26f185755b7d230c5304b70c3369bff2">DeshakeOpenCLContext::gauss_kernel</a></div><div class="ttdeci">float * gauss_kernel</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00224">vf_deshake_opencl.c:224</a></div></div>
<div class="ttc" id="astruct_a_v_filter_pad_html"><div class="ttname"><a href="struct_a_v_filter_pad.html">AVFilterPad</a></div><div class="ttdef"><b>Definition:</b> <a href="libavfilter_2internal_8h_source.html#l00054">internal.h:54</a></div></div>
<div class="ttc" id="agroup__lavu__log__constants_html_ga9b58b28e2d429b930b69db19877f76a8"><div class="ttname"><a href="group__lavu__log__constants.html#ga9b58b28e2d429b930b69db19877f76a8">AV_LOG_VERBOSE</a></div><div class="ttdeci">#define AV_LOG_VERBOSE</div><div class="ttdef"><b>Definition:</b> <a href="log_8h_source.html#l00210">log.h:210</a></div></div>
<div class="ttc" id="afloat_8h_html"><div class="ttname"><a href="float_8h.html">float.h</a></div></div>
<div class="ttc" id="astruct_absolute_frame_motion_html_ac0255cf0b9279f9a94b98e318380243e"><div class="ttname"><a href="struct_absolute_frame_motion.html#ac0255cf0b9279f9a94b98e318380243e">AbsoluteFrameMotion::curr_frame_offset</a></div><div class="ttdeci">int curr_frame_offset</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00141">vf_deshake_opencl.c:141</a></div></div>
<div class="ttc" id="astruct_deshake_open_c_l_context_html_a385c7d3da418f0a685ecc00756fcd4cf"><div class="ttname"><a href="struct_deshake_open_c_l_context.html#a385c7d3da418f0a685ecc00756fcd4cf">DeshakeOpenCLContext::curr_frame</a></div><div class="ttdeci">int curr_frame</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00221">vf_deshake_opencl.c:221</a></div></div>
<div class="ttc" id="aopencl_8c_html_a5b53a58b993ccb639121edcb93950585"><div class="ttname"><a href="opencl_8c.html#a5b53a58b993ccb639121edcb93950585">ff_opencl_filter_load_program</a></div><div class="ttdeci">int ff_opencl_filter_load_program(AVFilterContext *avctx, const char **program_source_array, int nb_strings)</div><div class="ttdef"><b>Definition:</b> <a href="opencl_8c_source.html#l00171">opencl.c:171</a></div></div>
<div class="ttc" id="avf__deshake__opencl_8c_html_aaeed07069929ebdb0d7ad7af57290562"><div class="ttname"><a href="vf__deshake__opencl_8c.html#aaeed07069929ebdb0d7ad7af57290562">update_needed_crop</a></div><div class="ttdeci">static void update_needed_crop(CropInfo *crop, float *transform, float frame_width, float frame_height)</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l01005">vf_deshake_opencl.c:1005</a></div></div>
<div class="ttc" id="aframequeue_8c_html_a7615fa0fc44ab6394a354c5f152faf93"><div class="ttname"><a href="framequeue_8c.html#a7615fa0fc44ab6394a354c5f152faf93">ff_framequeue_init</a></div><div class="ttdeci">void ff_framequeue_init(FFFrameQueue *fq, FFFrameQueueGlobal *fqg)</div><div class="ttdef"><b>Definition:</b> <a href="framequeue_8c_source.html#l00047">framequeue.c:47</a></div></div>
<div class="ttc" id="astruct_absolute_frame_motion_html_a8cfe39ca16b5020b5aa3d0c67cb20bbb"><div class="ttname"><a href="struct_absolute_frame_motion.html#a8cfe39ca16b5020b5aa3d0c67cb20bbb">AbsoluteFrameMotion::ringbuffers</a></div><div class="ttdeci">AVFifoBuffer * ringbuffers[RingbufCount]</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00137">vf_deshake_opencl.c:137</a></div></div>
<div class="ttc" id="astruct_a_v_fifo_buffer_html"><div class="ttname"><a href="struct_a_v_fifo_buffer.html">AVFifoBuffer</a></div><div class="ttdef"><b>Definition:</b> <a href="fifo_8h_source.html#l00031">fifo.h:31</a></div></div>
<div class="ttc" id="alibavutil_2fifo_8c_html_ab708d2f19b7a9592caa278256787adb6"><div class="ttname"><a href="libavutil_2fifo_8c.html#ab708d2f19b7a9592caa278256787adb6">av_fifo_generic_read</a></div><div class="ttdeci">int av_fifo_generic_read(AVFifoBuffer *f, void *dest, int buf_size, void(*func)(void *, void *, int))</div><div class="ttdef"><b>Definition:</b> <a href="libavutil_2fifo_8c_source.html#l00213">fifo.c:213</a></div></div>
<div class="ttc" id="astruct_a_v_filter_link_html_a1efd10db9d097b6d27054da46e06e133"><div class="ttname"><a href="struct_a_v_filter_link.html#a1efd10db9d097b6d27054da46e06e133">AVFilterLink::h</a></div><div class="ttdeci">int h</div><div class="ttdoc">agreed upon image height</div><div class="ttdef"><b>Definition:</b> <a href="avfilter_8h_source.html#l00482">avfilter.h:482</a></div></div>
<div class="ttc" id="avf__deshake__opencl_8c_html_a6a14a9679af60a3b5b6c9ac778290864"><div class="ttname"><a href="vf__deshake__opencl_8c.html#a6a14a9679af60a3b5b6c9ac778290864">points_not_collinear</a></div><div class="ttdeci">static int points_not_collinear(const cl_float2 **points)</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00359">vf_deshake_opencl.c:359</a></div></div>
<div class="ttc" id="avideo_8h_html"><div class="ttname"><a href="video_8h.html">video.h</a></div></div>
<div class="ttc" id="afilters_8h_html_ab82b9a98da3d2483b5b5457d5e8570fc"><div class="ttname"><a href="filters_8h.html#ab82b9a98da3d2483b5b5457d5e8570fc">FF_FILTER_FORWARD_STATUS_BACK</a></div><div class="ttdeci">#define FF_FILTER_FORWARD_STATUS_BACK(outlink, inlink)</div><div class="ttdef"><b>Definition:</b> <a href="filters_8h_source.html#l00199">filters.h:199</a></div></div>
<div class="ttc" id="astruct_deshake_open_c_l_context_html_ae6a887d019eba0c61fb9c40d2c773b06"><div class="ttname"><a href="struct_deshake_open_c_l_context.html#ae6a887d019eba0c61fb9c40d2c773b06">DeshakeOpenCLContext::matches_contig_host</a></div><div class="ttdeci">MotionVector * matches_contig_host</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00241">vf_deshake_opencl.c:241</a></div></div>
<div class="ttc" id="aopencl_8h_html_a6a3ab40c09685f9b3bf4113ac480b085"><div class="ttname"><a href="opencl_8h.html#a6a3ab40c09685f9b3bf4113ac480b085">CL_CREATE_KERNEL</a></div><div class="ttdeci">#define CL_CREATE_KERNEL(ctx, kernel_name)</div><div class="ttdef"><b>Definition:</b> <a href="opencl_8h_source.html#l00093">opencl.h:93</a></div></div>
<div class="ttc" id="astruct_deshake_open_c_l_context_html_ac859d628df2ed7cd622905fdb6365b33"><div class="ttname"><a href="struct_deshake_open_c_l_context.html#ac859d628df2ed7cd622905fdb6365b33">DeshakeOpenCLContext::eof</a></div><div class="ttdeci">int eof</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00207">vf_deshake_opencl.c:207</a></div></div>
<div class="ttc" id="alibavutil_2fifo_8c_html_a037f66cc2b92aebbc363617387d39f6f"><div class="ttname"><a href="libavutil_2fifo_8c.html#a037f66cc2b92aebbc363617387d39f6f">av_fifo_drain</a></div><div class="ttdeci">void av_fifo_drain(AVFifoBuffer *f, int size)</div><div class="ttdef"><b>Definition:</b> <a href="libavutil_2fifo_8c_source.html#l00233">fifo.c:233</a></div></div>
<div class="ttc" id="aopencl_8h_html_ac82f71ad703bd52fa1929111fa1953ec"><div class="ttname"><a href="opencl_8h.html#ac82f71ad703bd52fa1929111fa1953ec">CL_CREATE_BUFFER</a></div><div class="ttdeci">#define CL_CREATE_BUFFER(ctx, buffer_name, size)</div><div class="ttdef"><b>Definition:</b> <a href="opencl_8h_source.html#l00237">opencl.h:237</a></div></div>
<div class="ttc" id="avf__deshake__opencl_8c_html_a07687e6cde9d1396ff2004e76d37d473"><div class="ttname"><a href="vf__deshake__opencl_8c.html#a07687e6cde9d1396ff2004e76d37d473">BRIEF_PATCH_SIZE_HALF</a></div><div class="ttdeci">#define BRIEF_PATCH_SIZE_HALF</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00091">vf_deshake_opencl.c:91</a></div></div>
<div class="ttc" id="aformats_8h_html"><div class="ttname"><a href="formats_8h.html">formats.h</a></div></div>
<div class="ttc" id="apixfmt_8h_html_a9a8e335cf3be472042bc9f0cf80cd4c5aa102709a993e4f42934630bc8b27ff52"><div class="ttname"><a href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5aa102709a993e4f42934630bc8b27ff52">AV_PIX_FMT_GBRAP12LE</a></div><div class="ttdeci">@ AV_PIX_FMT_GBRAP12LE</div><div class="ttdoc">planar GBR 4:4:4:4 48bpp, little-endian</div><div class="ttdef"><b>Definition:</b> <a href="pixfmt_8h_source.html#l00288">pixfmt.h:288</a></div></div>
<div class="ttc" id="astruct_deshake_open_c_l_context_html_a20f13310a4da88501cb8a82136e12624"><div class="ttname"><a href="struct_deshake_open_c_l_context.html#a20f13310a4da88501cb8a82136e12624">DeshakeOpenCLContext::kernel_brief_descriptors</a></div><div class="ttdeci">cl_kernel kernel_brief_descriptors</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00249">vf_deshake_opencl.c:249</a></div></div>
<div class="ttc" id="astruct_deshake_open_c_l_context_html_a0544d6baadfae49479dfac27deb26631"><div class="ttname"><a href="struct_deshake_open_c_l_context.html#a0544d6baadfae49479dfac27deb26631">DeshakeOpenCLContext::kernel_refine_features</a></div><div class="ttdeci">cl_kernel kernel_refine_features</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00248">vf_deshake_opencl.c:248</a></div></div>
<div class="ttc" id="aavfilter_8c_html_ac1daee38f363044775732a960441861c"><div class="ttname"><a href="avfilter_8c.html#ac1daee38f363044775732a960441861c">ff_inlink_consume_frame</a></div><div class="ttdeci">int ff_inlink_consume_frame(AVFilterLink *link, AVFrame **rframe)</div><div class="ttdef"><b>Definition:</b> <a href="avfilter_8c_source.html#l01489">avfilter.c:1489</a></div></div>
<div class="ttc" id="aopencl_8c_html_ac3682727463fb0797a3c11add9053c1d"><div class="ttname"><a href="opencl_8c.html#ac3682727463fb0797a3c11add9053c1d">ff_opencl_filter_work_size_from_image</a></div><div class="ttdeci">int ff_opencl_filter_work_size_from_image(AVFilterContext *avctx, size_t *work_size, AVFrame *frame, int plane, int block_alignment)</div><div class="ttdef"><b>Definition:</b> <a href="opencl_8c_source.html#l00278">opencl.c:278</a></div></div>
<div class="ttc" id="afifo_8h_html"><div class="ttname"><a href="fifo_8h.html">fifo.h</a></div></div>
<div class="ttc" id="avf__deshake__opencl_8c_html_adadd946e759c992e1c18f108285f09a6"><div class="ttname"><a href="vf__deshake__opencl_8c.html#adadd946e759c992e1c18f108285f09a6">AbsoluteFrameMotion</a></div><div class="ttdeci">struct AbsoluteFrameMotion AbsoluteFrameMotion</div></div>
<div class="ttc" id="astruct_a_v_l_f_g_html"><div class="ttname"><a href="struct_a_v_l_f_g.html">AVLFG</a></div><div class="ttdef"><b>Definition:</b> <a href="lfg_8h_source.html#l00033">lfg.h:33</a></div></div>
<div class="ttc" id="astruct_debug_matches_html_abd79e59e862cfd147ea9dbff77881c1e"><div class="ttname"><a href="struct_debug_matches.html#abd79e59e862cfd147ea9dbff77881c1e">DebugMatches::model_matches</a></div><div class="ttdeci">MotionVector model_matches[3]</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00126">vf_deshake_opencl.c:126</a></div></div>
<div class="ttc" id="apixfmt_8h_html_a9a8e335cf3be472042bc9f0cf80cd4c5a87ab52104aeac9b13a39da1a09835bbc"><div class="ttname"><a href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a87ab52104aeac9b13a39da1a09835bbc">AV_PIX_FMT_GBRAP</a></div><div class="ttdeci">@ AV_PIX_FMT_GBRAP</div><div class="ttdoc">planar GBRA 4:4:4:4 32bpp</div><div class="ttdef"><b>Definition:</b> <a href="pixfmt_8h_source.html#l00215">pixfmt.h:215</a></div></div>
<div class="ttc" id="astruct_deshake_open_c_l_context_html"><div class="ttname"><a href="struct_deshake_open_c_l_context.html">DeshakeOpenCLContext</a></div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00200">vf_deshake_opencl.c:200</a></div></div>
<div class="ttc" id="acheckasm_8h_html_a73a3b169ac8c3419cbe15327e75ffcfd"><div class="ttname"><a href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a></div><div class="ttdeci">#define fail()</div><div class="ttdef"><b>Definition:</b> <a href="checkasm_8h_source.html#l00123">checkasm.h:123</a></div></div>
<div class="ttc" id="acommon_8h_html_af5e4ff7761996bc901e59bd59756268d"><div class="ttname"><a href="common_8h.html#af5e4ff7761996bc901e59bd59756268d">FFSIGN</a></div><div class="ttdeci">#define FFSIGN(a)</div><div class="ttdef"><b>Definition:</b> <a href="common_8h_source.html#l00073">common.h:73</a></div></div>
<div class="ttc" id="astruct_deshake_open_c_l_context_html_a72e0fa2b3833d4b58438839e33d9cb38"><div class="ttname"><a href="struct_deshake_open_c_l_context.html#a72e0fa2b3833d4b58438839e33d9cb38">DeshakeOpenCLContext::transform_y</a></div><div class="ttdeci">cl_mem transform_y</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00274">vf_deshake_opencl.c:274</a></div></div>
<div class="ttc" id="avf__deshake__opencl_8c_html_a1579ea8319abda6b1f90db17716333b5aad52f91fb41da1ce46b0b832f1c5a04b"><div class="ttname"><a href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5aad52f91fb41da1ce46b0b832f1c5a04b">RingbufScaleY</a></div><div class="ttdeci">@ RingbufScaleY</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00116">vf_deshake_opencl.c:116</a></div></div>
<div class="ttc" id="aaeval_8c_html_a16aca557f352132b55bbc3c4769daa8b"><div class="ttname"><a href="aeval_8c.html#a16aca557f352132b55bbc3c4769daa8b">val</a></div><div class="ttdeci">static double val(void *priv, double ch)</div><div class="ttdef"><b>Definition:</b> <a href="aeval_8c_source.html#l00076">aeval.c:76</a></div></div>
<div class="ttc" id="avf__deshake__opencl_8c_html_a33a9c7758d9d8ac84f56b42bf1205b12"><div class="ttname"><a href="vf__deshake__opencl_8c.html#a33a9c7758d9d8ac84f56b42bf1205b12">deshake_opencl_outputs</a></div><div class="ttdeci">static const AVFilterPad deshake_opencl_outputs[]</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l02147">vf_deshake_opencl.c:2147</a></div></div>
<div class="ttc" id="atranscode__aac_8c_html_a4fbb704fb96c36a78a36eee010306ce7"><div class="ttname"><a href="transcode__aac_8c.html#a4fbb704fb96c36a78a36eee010306ce7">pts</a></div><div class="ttdeci">static int64_t pts</div><div class="ttdef"><b>Definition:</b> <a href="transcode__aac_8c_source.html#l00647">transcode_aac.c:647</a></div></div>
<div class="ttc" id="avf__deshake__opencl_8c_html_abd3951fc06f51de0aefb0ef72cc3aa4a"><div class="ttname"><a href="vf__deshake__opencl_8c.html#abd3951fc06f51de0aefb0ef72cc3aa4a">ff_vf_deshake_opencl</a></div><div class="ttdeci">AVFilter ff_vf_deshake_opencl</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l02190">vf_deshake_opencl.c:2190</a></div></div>
<div class="ttc" id="acommon_8h_html_af6afbffa12562b076c34055bdcb3ad65"><div class="ttname"><a href="common_8h.html#af6afbffa12562b076c34055bdcb3ad65">FFMIN3</a></div><div class="ttdeci">#define FFMIN3(a, b, c)</div><div class="ttdef"><b>Definition:</b> <a href="common_8h_source.html#l00097">common.h:97</a></div></div>
<div class="ttc" id="acuda__runtime_8h_html_a59c4f558e259b7fd968f8626da9187f7"><div class="ttname"><a href="cuda__runtime_8h.html#a59c4f558e259b7fd968f8626da9187f7">fabsf</a></div><div class="ttdeci">static __device__ float fabsf(float a)</div><div class="ttdef"><b>Definition:</b> <a href="cuda__runtime_8h_source.html#l00181">cuda_runtime.h:181</a></div></div>
<div class="ttc" id="avf__deshake__opencl_8c_html_a1579ea8319abda6b1f90db17716333b5a3271fdb76ac77fd9c6a61011c51e6f8e"><div class="ttname"><a href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5a3271fdb76ac77fd9c6a61011c51e6f8e">RingbufScaleX</a></div><div class="ttdeci">@ RingbufScaleX</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00115">vf_deshake_opencl.c:115</a></div></div>
<div class="ttc" id="aopencl_8c_html_aca05daad3ec60d3cff401c6dedc80836"><div class="ttname"><a href="opencl_8c.html#aca05daad3ec60d3cff401c6dedc80836">ff_opencl_filter_config_output</a></div><div class="ttdeci">int ff_opencl_filter_config_output(AVFilterLink *outlink)</div><div class="ttdef"><b>Definition:</b> <a href="opencl_8c_source.html#l00096">opencl.c:96</a></div></div>
<div class="ttc" id="aavassert_8h_html"><div class="ttname"><a href="avassert_8h.html">avassert.h</a></div></div>
<div class="ttc" id="agroup__lavu__log__constants_html_gaffe151ff4cd8a24b2e77ac8d9616c85c"><div class="ttname"><a href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a></div><div class="ttdeci">#define AV_LOG_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="log_8h_source.html#l00194">log.h:194</a></div></div>
<div class="ttc" id="alibavutil_2fifo_8c_html_ac1e0d8ee7f1568cb40fa95a740c60f13"><div class="ttname"><a href="libavutil_2fifo_8c.html#ac1e0d8ee7f1568cb40fa95a740c60f13">av_fifo_space</a></div><div class="ttdeci">int av_fifo_space(const AVFifoBuffer *f)</div><div class="ttdef"><b>Definition:</b> <a href="libavutil_2fifo_8c_source.html#l00082">fifo.c:82</a></div></div>
<div class="ttc" id="aattributes_8h_html_abeeb324fff79a5335d36774704e2475c"><div class="ttname"><a href="attributes_8h.html#abeeb324fff79a5335d36774704e2475c">av_cold</a></div><div class="ttdeci">#define av_cold</div><div class="ttdef"><b>Definition:</b> <a href="attributes_8h_source.html#l00090">attributes.h:90</a></div></div>
<div class="ttc" id="atests_2movenc_8c_html_a1f342e4e3615abc9314684ce6b4819c0"><div class="ttname"><a href="tests_2movenc_8c.html#a1f342e4e3615abc9314684ce6b4819c0">duration</a></div><div class="ttdeci">int64_t duration</div><div class="ttdef"><b>Definition:</b> <a href="tests_2movenc_8c_source.html#l00063">movenc.c:63</a></div></div>
<div class="ttc" id="apixfmt_8h_html_a9a8e335cf3be472042bc9f0cf80cd4c5a6e4c926d3610ee2b013f037d4b22373f"><div class="ttname"><a href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a6e4c926d3610ee2b013f037d4b22373f">AV_PIX_FMT_GBRAP16BE</a></div><div class="ttdeci">@ AV_PIX_FMT_GBRAP16BE</div><div class="ttdoc">planar GBRA 4:4:4:4 64bpp, big-endian</div><div class="ttdef"><b>Definition:</b> <a href="pixfmt_8h_source.html#l00216">pixfmt.h:216</a></div></div>
<div class="ttc" id="afilters_8h_html_a8f0a6162fb5fb55d4c4a30f509781dd0"><div class="ttname"><a href="filters_8h.html#a8f0a6162fb5fb55d4c4a30f509781dd0">ff_outlink_set_status</a></div><div class="ttdeci">static void ff_outlink_set_status(AVFilterLink *link, int status, int64_t pts)</div><div class="ttdef"><b>Definition:</b> <a href="filters_8h_source.html#l00189">filters.h:189</a></div></div>
<div class="ttc" id="acommon_8h_html_a013fdaa079045ec5632fe121e211e516"><div class="ttname"><a href="common_8h.html#a013fdaa079045ec5632fe121e211e516">FFMAX3</a></div><div class="ttdeci">#define FFMAX3(a, b, c)</div><div class="ttdef"><b>Definition:</b> <a href="common_8h_source.html#l00095">common.h:95</a></div></div>
<div class="ttc" id="acbs__vp9_8c_html_a5950eda76c8ffc67651de936cd8c79ec"><div class="ttname"><a href="cbs__vp9_8c.html#a5950eda76c8ffc67651de936cd8c79ec">s</a></div><div class="ttdeci">#define s(width, name)</div><div class="ttdef"><b>Definition:</b> <a href="cbs__vp9_8c_source.html#l00257">cbs_vp9.c:257</a></div></div>
<div class="ttc" id="apixfmt_8h_html_a9a8e335cf3be472042bc9f0cf80cd4c5aeb3f768331ce18fd5c6477a989a3ad37"><div class="ttname"><a href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5aeb3f768331ce18fd5c6477a989a3ad37">AV_PIX_FMT_GBRP16LE</a></div><div class="ttdeci">@ AV_PIX_FMT_GBRP16LE</div><div class="ttdoc">planar GBR 4:4:4 48bpp, little-endian</div><div class="ttdef"><b>Definition:</b> <a href="pixfmt_8h_source.html#l00175">pixfmt.h:175</a></div></div>
<div class="ttc" id="avf__deshake__opencl_8c_html_a1579ea8319abda6b1f90db17716333b5a647afa6f628f3817a6923cfcafe6779a"><div class="ttname"><a href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5a647afa6f628f3817a6923cfcafe6779a">RingbufY</a></div><div class="ttdeci">@ RingbufY</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00113">vf_deshake_opencl.c:113</a></div></div>
<div class="ttc" id="alfg_8h_html_a58feb242e560adee0b7a16e11cce43e9"><div class="ttname"><a href="lfg_8h.html#a58feb242e560adee0b7a16e11cce43e9">av_lfg_get</a></div><div class="ttdeci">static unsigned int av_lfg_get(AVLFG *c)</div><div class="ttdef"><b>Definition:</b> <a href="lfg_8h_source.html#l00053">lfg.h:53</a></div></div>
<div class="ttc" id="acommon_8h_html_a5d13452b0fac0d41b08ea2e49ea6eaa5"><div class="ttname"><a href="common_8h.html#a5d13452b0fac0d41b08ea2e49ea6eaa5">AV_CEIL_RSHIFT</a></div><div class="ttdeci">#define AV_CEIL_RSHIFT(a, b)</div><div class="ttdef"><b>Definition:</b> <a href="common_8h_source.html#l00058">common.h:58</a></div></div>
<div class="ttc" id="avf__colormatrix_8c_html_a9652b617fc0258128c53a9a98e5e9289"><div class="ttname"><a href="vf__colormatrix_8c.html#a9652b617fc0258128c53a9a98e5e9289">mi</a></div><div class="ttdeci">#define mi</div><div class="ttdef"><b>Definition:</b> <a href="vf__colormatrix_8c_source.html#l00108">vf_colormatrix.c:108</a></div></div>
<div class="ttc" id="agroup__lavu__math__rational_html_ga935dbbf6bde8dfe5fa7ddb1da582eb07"><div class="ttname"><a href="group__lavu__math__rational.html#ga935dbbf6bde8dfe5fa7ddb1da582eb07">av_q2d</a></div><div class="ttdeci">static double av_q2d(AVRational a)</div><div class="ttdef"><b>Definition:</b> <a href="rational_8h_source.html#l00104">rational.h:104</a></div></div>
<div class="ttc" id="astruct_motion_vector_html_a9575b5b2610bb21eeb2550f2c13d922e"><div class="ttname"><a href="struct_motion_vector.html#a9575b5b2610bb21eeb2550f2c13d922e">MotionVector::should_consider</a></div><div class="ttdeci">cl_int should_consider</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00107">vf_deshake_opencl.c:107</a></div></div>
<div class="ttc" id="astruct_frame_delta_html_af3b70c3f8624b139e8e935d6a464fcfe"><div class="ttname"><a href="struct_frame_delta.html#af3b70c3f8624b139e8e935d6a464fcfe">FrameDelta::rotation</a></div><div class="ttdeci">float rotation</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00176">vf_deshake_opencl.c:176</a></div></div>
<div class="ttc" id="alfg_8h_html"><div class="ttname"><a href="lfg_8h.html">lfg.h</a></div></div>
<div class="ttc" id="avf__deshake__opencl_8c_html_a8a3ec369b17de7aad4fa5b00f8270411"><div class="ttname"><a href="vf__deshake__opencl_8c.html#a8a3ec369b17de7aad4fa5b00f8270411">deshake_opencl_uninit</a></div><div class="ttdeci">static av_cold void deshake_opencl_uninit(AVFilterContext *avctx)</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l01066">vf_deshake_opencl.c:1066</a></div></div>
<div class="ttc" id="aavassert_8h_html_aae204192396f78cc8c5cd7ad5c57c23f"><div class="ttname"><a href="avassert_8h.html#aae204192396f78cc8c5cd7ad5c57c23f">av_assert0</a></div><div class="ttdeci">#define av_assert0(cond)</div><div class="ttdef"><b>Definition:</b> <a href="avassert_8h_source.html#l00037">avassert.h:37</a></div></div>
<div class="ttc" id="astruct_deshake_open_c_l_context_html_a05a20833a17dd7d1ed5cda9f3cb9e393"><div class="ttname"><a href="struct_deshake_open_c_l_context.html#a05a20833a17dd7d1ed5cda9f3cb9e393">DeshakeOpenCLContext::matches</a></div><div class="ttdeci">cl_mem matches</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00271">vf_deshake_opencl.c:271</a></div></div>
<div class="ttc" id="aaf__acontrast_8c_html_a7ddb0b5ac76101c5bee71e9840bf1698"><div class="ttname"><a href="af__acontrast_8c.html#a7ddb0b5ac76101c5bee71e9840bf1698">outputs</a></div><div class="ttdeci">static const AVFilterPad outputs[]</div><div class="ttdef"><b>Definition:</b> <a href="af__acontrast_8c_source.html#l00203">af_acontrast.c:203</a></div></div>
<div class="ttc" id="afilters_8h_html"><div class="ttname"><a href="filters_8h.html">filters.h</a></div></div>
<div class="ttc" id="astruct_deshake_open_c_l_context_html_a0f48467a039b920eba5ede7e9061a665"><div class="ttname"><a href="struct_deshake_open_c_l_context.html#a0f48467a039b920eba5ede7e9061a665">DeshakeOpenCLContext::grayscale</a></div><div class="ttdeci">cl_mem grayscale</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00255">vf_deshake_opencl.c:255</a></div></div>
<div class="ttc" id="astruct_a_v_option_html"><div class="ttname"><a href="struct_a_v_option.html">AVOption</a></div><div class="ttdef"><b>Definition:</b> <a href="opt_8h_source.html#l00248">opt.h:248</a></div></div>
<div class="ttc" id="atests_2movenc_8c_html_a93cc7296f13f507c1fd7abd0db36b898"><div class="ttname"><a href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a></div><div class="ttdeci">AVFormatContext * ctx</div><div class="ttdef"><b>Definition:</b> <a href="tests_2movenc_8c_source.html#l00048">movenc.c:48</a></div></div>
<div class="ttc" id="agroup__lavu__math_html_gaf02994a8bbeaa91d4757df179cbe567f"><div class="ttname"><a href="group__lavu__math.html#gaf02994a8bbeaa91d4757df179cbe567f">av_rescale_q</a></div><div class="ttdeci">int64_t av_rescale_q(int64_t a, AVRational bq, AVRational cq)</div><div class="ttdef"><b>Definition:</b> <a href="mathematics_8c_source.html#l00142">mathematics.c:142</a></div></div>
<div class="ttc" id="avf__deshake__opencl_8c_html_a1e2fb9d8afcc831ea361958b31cc3eb2"><div class="ttname"><a href="vf__deshake__opencl_8c.html#a1e2fb9d8afcc831ea361958b31cc3eb2">DeshakeOpenCLContext</a></div><div class="ttdeci">struct DeshakeOpenCLContext DeshakeOpenCLContext</div></div>
<div class="ttc" id="apixfmt_8h_html_a9a8e335cf3be472042bc9f0cf80cd4c5abad40e8c2ef081c630395e08593bffe4"><div class="ttname"><a href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5abad40e8c2ef081c630395e08593bffe4">AV_PIX_FMT_GBRP10LE</a></div><div class="ttdeci">@ AV_PIX_FMT_GBRP10LE</div><div class="ttdoc">planar GBR 4:4:4 30bpp, little-endian</div><div class="ttdef"><b>Definition:</b> <a href="pixfmt_8h_source.html#l00173">pixfmt.h:173</a></div></div>
<div class="ttc" id="astruct_deshake_open_c_l_context_html_a47dadaea7e4fbae9dbcfc22c935eada8"><div class="ttname"><a href="struct_deshake_open_c_l_context.html#a47dadaea7e4fbae9dbcfc22c935eada8">DeshakeOpenCLContext::grayscale_time</a></div><div class="ttdeci">unsigned long long grayscale_time</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00300">vf_deshake_opencl.c:300</a></div></div>
<div class="ttc" id="acbs__vp9_8c_html_a67e4f69aaf2fe15c3d298d0a2de865a3"><div class="ttname"><a href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a></div><div class="ttdeci">#define f(width, name)</div><div class="ttdef"><b>Definition:</b> <a href="cbs__vp9_8c_source.html#l00255">cbs_vp9.c:255</a></div></div>
<div class="ttc" id="afilter__design_8txt_html_a11a6a594845d2b9bf51b9ccc8a83c83d"><div class="ttname"><a href="filter__design_8txt.html#a11a6a594845d2b9bf51b9ccc8a83c83d">link</a></div><div class="ttdeci">Filter the word frame indicates either a video frame or a group of audio as stored in an AVFrame structure Format for each input and each output the list of supported formats For video that means pixel format For audio that means channel sample they are references to shared objects When the negotiation mechanism computes the intersection of the formats supported at each end of a link</div><div class="ttdef"><b>Definition:</b> <a href="filter__design_8txt_source.html#l00023">filter_design.txt:23</a></div></div>
<div class="ttc" id="aopencl_8h_html_a077a2c6a5e3fbd18f15ab3b7d1a5e157"><div class="ttname"><a href="opencl_8h.html#a077a2c6a5e3fbd18f15ab3b7d1a5e157">CL_RELEASE_KERNEL</a></div><div class="ttdeci">#define CL_RELEASE_KERNEL(k)</div><div class="ttdef"><b>Definition:</b> <a href="opencl_8h_source.html#l00101">opencl.h:101</a></div></div>
<div class="ttc" id="aframequeue_8c_html_a153444cc22b19e36a5a5680d4bf50930"><div class="ttname"><a href="framequeue_8c.html#a153444cc22b19e36a5a5680d4bf50930">ff_framequeue_take</a></div><div class="ttdeci">AVFrame * ff_framequeue_take(FFFrameQueue *fq)</div><div class="ttdef"><b>Definition:</b> <a href="framequeue_8c_source.html#l00098">framequeue.c:98</a></div></div>
<div class="ttc" id="avf__deshake__opencl_8c_html_a1579ea8319abda6b1f90db17716333b5"><div class="ttname"><a href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5">RingbufferIndices</a></div><div class="ttdeci">RingbufferIndices</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00111">vf_deshake_opencl.c:111</a></div></div>
<div class="ttc" id="avf__deshake__opencl_8c_html_a4ddbb86b2eab99c51940e4ea6bdc5af4"><div class="ttname"><a href="vf__deshake__opencl_8c.html#a4ddbb86b2eab99c51940e4ea6bdc5af4">rand_in</a></div><div class="ttdeci">static int rand_in(int low, int high, AVLFG *alfg)</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00313">vf_deshake_opencl.c:313</a></div></div>
<div class="ttc" id="avf__deshake__opencl_8c_html_a842030a6e61b33e1dfebf260817e112a"><div class="ttname"><a href="vf__deshake__opencl_8c.html#a842030a6e61b33e1dfebf260817e112a">averaged_event_time_ms</a></div><div class="ttdeci">static double averaged_event_time_ms(unsigned long long total_time, int num_frames)</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00319">vf_deshake_opencl.c:319</a></div></div>
<div class="ttc" id="astruct_absolute_frame_motion_html_aebd12b2e7d7a0ceaa9e02f19f8aca9dc"><div class="ttname"><a href="struct_absolute_frame_motion.html#aebd12b2e7d7a0ceaa9e02f19f8aca9dc">AbsoluteFrameMotion::debug_matches</a></div><div class="ttdeci">AVFifoBuffer * debug_matches</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00147">vf_deshake_opencl.c:147</a></div></div>
<div class="ttc" id="avf__deshake__opencl_8c_html_a38f6bd6727ead1dc7a8c6abf741dc413"><div class="ttname"><a href="vf__deshake__opencl_8c.html#a38f6bd6727ead1dc7a8c6abf741dc413">filter_frame</a></div><div class="ttdeci">static int filter_frame(AVFilterLink *link, AVFrame *input_frame)</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l01385">vf_deshake_opencl.c:1385</a></div></div>
<div class="ttc" id="astruct_deshake_open_c_l_context_html_a0dc75da84837a440352d277911b7ac2f"><div class="ttname"><a href="struct_deshake_open_c_l_context.html#a0dc75da84837a440352d277911b7ac2f">DeshakeOpenCLContext::harris_response_time</a></div><div class="ttdeci">unsigned long long harris_response_time</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00301">vf_deshake_opencl.c:301</a></div></div>
<div class="ttc" id="afilter__design_8txt_html_adf51c0fafb1c1b683c7f943c2a349904"><div class="ttname"><a href="filter__design_8txt.html#adf51c0fafb1c1b683c7f943c2a349904">result</a></div><div class="ttdeci">and forward the result(frame or status change) to the corresponding input. If nothing is possible</div></div>
<div class="ttc" id="astruct_deshake_open_c_l_context_html_a8ac38dcf0b23b1e13eee252d5c0ac3fc"><div class="ttname"><a href="struct_deshake_open_c_l_context.html#a8ac38dcf0b23b1e13eee252d5c0ac3fc">DeshakeOpenCLContext::ransac_err</a></div><div class="ttdeci">float * ransac_err</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00227">vf_deshake_opencl.c:227</a></div></div>
<div class="ttc" id="apixfmt_8h_html_a9a8e335cf3be472042bc9f0cf80cd4c5a412fb859c0c7de66dc0fee2464881927"><div class="ttname"><a href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a412fb859c0c7de66dc0fee2464881927">AV_PIX_FMT_GBRAP12BE</a></div><div class="ttdeci">@ AV_PIX_FMT_GBRAP12BE</div><div class="ttdoc">planar GBR 4:4:4:4 48bpp, big-endian</div><div class="ttdef"><b>Definition:</b> <a href="pixfmt_8h_source.html#l00287">pixfmt.h:287</a></div></div>
<div class="ttc" id="acuda__runtime_8h_html_a7a87cd25426a228ce8ecbef48ab00de8"><div class="ttname"><a href="cuda__runtime_8h.html#a7a87cd25426a228ce8ecbef48ab00de8">fabs</a></div><div class="ttdeci">static __device__ float fabs(float a)</div><div class="ttdef"><b>Definition:</b> <a href="cuda__runtime_8h_source.html#l00182">cuda_runtime.h:182</a></div></div>
<div class="ttc" id="acoverity_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="coverity_8c_source.html#l00032">coverity.c:32</a></div></div>
<div class="ttc" id="agroup__lavu__frame_html_gab9b275b114ace0db95c5796bc71f3012"><div class="ttname"><a href="group__lavu__frame.html#gab9b275b114ace0db95c5796bc71f3012">av_frame_copy_props</a></div><div class="ttdeci">int av_frame_copy_props(AVFrame *dst, const AVFrame *src)</div><div class="ttdef"><b>Definition:</b> <a href="frame_8c_source.html#l00658">frame.c:658</a></div></div>
<div class="ttc" id="avf__deshake__opencl_8c_html_a9163aad0cd348b8b75c90b4ee5b675d5"><div class="ttname"><a href="vf__deshake__opencl_8c.html#a9163aad0cd348b8b75c90b4ee5b675d5">transform_center_scale</a></div><div class="ttdeci">static void transform_center_scale(float x_shift, float y_shift, float angle, float scale_x, float scale_y, float center_w, float center_h, float *matrix)</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00967">vf_deshake_opencl.c:967</a></div></div>
<div class="ttc" id="aframequeue_8c_html_aa1571338eb6b210d4053c8a435f24068"><div class="ttname"><a href="framequeue_8c.html#aa1571338eb6b210d4053c8a435f24068">ff_framequeue_add</a></div><div class="ttdeci">int ff_framequeue_add(FFFrameQueue *fq, AVFrame *frame)</div><div class="ttdef"><b>Definition:</b> <a href="framequeue_8c_source.html#l00063">framequeue.c:63</a></div></div>
<div class="ttc" id="aframequeue_8c_html_ab667d4232d2fc65cc5e2766d3cbf4a44"><div class="ttname"><a href="framequeue_8c.html#ab667d4232d2fc65cc5e2766d3cbf4a44">ff_framequeue_free</a></div><div class="ttdeci">void ff_framequeue_free(FFFrameQueue *fq)</div><div class="ttdef"><b>Definition:</b> <a href="framequeue_8c_source.html#l00053">framequeue.c:53</a></div></div>
<div class="ttc" id="astruct_a_v_h_w_frames_context_html"><div class="ttname"><a href="struct_a_v_h_w_frames_context.html">AVHWFramesContext</a></div><div class="ttdef"><b>Definition:</b> <a href="hwcontext_8h_source.html#l00124">hwcontext.h:124</a></div></div>
<div class="ttc" id="aframequeue_8h_html"><div class="ttname"><a href="framequeue_8h.html">framequeue.h</a></div></div>
<div class="ttc" id="ahevcdsp_8c_html_aa4607c9f8c7507415c1c10c59a2141b6"><div class="ttname"><a href="hevcdsp_8c.html#aa4607c9f8c7507415c1c10c59a2141b6">transform</a></div><div class="ttdeci">static const int8_t transform[32][32]</div><div class="ttdef"><b>Definition:</b> <a href="hevcdsp_8c_source.html#l00027">hevcdsp.c:27</a></div></div>
<div class="ttc" id="astruct_deshake_open_c_l_context_html_a61c2fbcc1ab251c2eb4a71043d98b53f"><div class="ttname"><a href="struct_deshake_open_c_l_context.html#a61c2fbcc1ab251c2eb4a71043d98b53f">DeshakeOpenCLContext::harris_buf</a></div><div class="ttdeci">cl_mem harris_buf</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00257">vf_deshake_opencl.c:257</a></div></div>
<div class="ttc" id="astruct_deshake_open_c_l_context_html_a9c380b1b1aa8527f665473a651e5a1c4"><div class="ttname"><a href="struct_deshake_open_c_l_context.html#a9c380b1b1aa8527f665473a651e5a1c4">DeshakeOpenCLContext::refine_features</a></div><div class="ttdeci">cl_int refine_features</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00285">vf_deshake_opencl.c:285</a></div></div>
<div class="ttc" id="astruct_deshake_open_c_l_context_html_a96d94e25fb2446f405147a0c9a46a769"><div class="ttname"><a href="struct_deshake_open_c_l_context.html#a96d94e25fb2446f405147a0c9a46a769">DeshakeOpenCLContext::transform_time</a></div><div class="ttdeci">unsigned long long transform_time</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00305">vf_deshake_opencl.c:305</a></div></div>
<div class="ttc" id="atests_2checkasm_2vp8dsp_8c_html_a858376c0918f93e656c8c0d76c63dbe8"><div class="ttname"><a href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a></div><div class="ttdeci">#define src</div><div class="ttdef"><b>Definition:</b> <a href="tests_2checkasm_2vp8dsp_8c_source.html#l00254">vp8dsp.c:254</a></div></div>
<div class="ttc" id="avf__deshake__opencl_8c_html_aaf257d81ebf7bdf695dc018cffba2da7"><div class="ttname"><a href="vf__deshake__opencl_8c.html#aaf257d81ebf7bdf695dc018cffba2da7">start_end_for</a></div><div class="ttdeci">static IterIndices start_end_for(DeshakeOpenCLContext *deshake_ctx, int length)</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00843">vf_deshake_opencl.c:843</a></div></div>
<div class="ttc" id="astruct_deshake_open_c_l_context_html_a66a35be6a8a0c0cbef246a136257b673"><div class="ttname"><a href="struct_deshake_open_c_l_context.html#a66a35be6a8a0c0cbef246a136257b673">DeshakeOpenCLContext::matches_contig</a></div><div class="ttdeci">cl_mem matches_contig</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00272">vf_deshake_opencl.c:272</a></div></div>
<div class="ttc" id="astruct_deshake_open_c_l_context_html_a79d104439a1735bbfeaef639bf340b4e"><div class="ttname"><a href="struct_deshake_open_c_l_context.html#a79d104439a1735bbfeaef639bf340b4e">DeshakeOpenCLContext::command_queue</a></div><div class="ttdeci">cl_command_queue command_queue</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00245">vf_deshake_opencl.c:245</a></div></div>
<div class="ttc" id="astruct_a_v_filter_link_html_a5d947aa9541b02e25db472656d69ea53"><div class="ttname"><a href="struct_a_v_filter_link.html#a5d947aa9541b02e25db472656d69ea53">AVFilterLink::time_base</a></div><div class="ttdeci">AVRational time_base</div><div class="ttdef"><b>Definition:</b> <a href="avfilter_8h_source.html#l00497">avfilter.h:497</a></div></div>
<div class="ttc" id="astruct_a_v_pix_fmt_descriptor_html"><div class="ttname"><a href="struct_a_v_pix_fmt_descriptor.html">AVPixFmtDescriptor</a></div><div class="ttdef"><b>Definition:</b> <a href="pixdesc_8h_source.html#l00081">pixdesc.h:81</a></div></div>
<div class="ttc" id="afilter__design_8txt_html_a45917ba5e6c8b798c6e2ba6ca7301a5d"><div class="ttname"><a href="filter__design_8txt.html#a45917ba5e6c8b798c6e2ba6ca7301a5d">inputs</a></div><div class="ttdeci">these buffered frames must be flushed immediately if a new input produces new the filter must not call request_frame to get more It must just process the frame or queue it The task of requesting more frames is left to the filter s request_frame method or the application If a filter has several inputs</div><div class="ttdef"><b>Definition:</b> <a href="filter__design_8txt_source.html#l00243">filter_design.txt:243</a></div></div>
<div class="ttc" id="astruct_deshake_open_c_l_context_html_af53b59cc19d39adb77f6337cbc132b07"><div class="ttname"><a href="struct_deshake_open_c_l_context.html#af53b59cc19d39adb77f6337cbc132b07">DeshakeOpenCLContext::debug_on</a></div><div class="ttdeci">int debug_on</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00281">vf_deshake_opencl.c:281</a></div></div>
<div class="ttc" id="avf__deshake__opencl_8c_html_abc57895720c42e4d87775275b391a9f8"><div class="ttname"><a href="vf__deshake__opencl_8c.html#abc57895720c42e4d87775275b391a9f8">PointPair</a></div><div class="ttdeci">struct PointPair PointPair</div></div>
<div class="ttc" id="astruct_deshake_open_c_l_context_html_a5eac23c56e1fa82a5383b9399cbc6a28"><div class="ttname"><a href="struct_deshake_open_c_l_context.html#a5eac23c56e1fa82a5383b9399cbc6a28">DeshakeOpenCLContext::transform_uv</a></div><div class="ttdeci">cl_mem transform_uv</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00276">vf_deshake_opencl.c:276</a></div></div>
<div class="ttc" id="aavfilter_8c_html_a489a38152dc91a0394eb556a7a7805c2"><div class="ttname"><a href="avfilter_8c.html#a489a38152dc91a0394eb556a7a7805c2">ff_inlink_acknowledge_status</a></div><div class="ttdeci">int ff_inlink_acknowledge_status(AVFilterLink *link, int *rstatus, int64_t *rpts)</div><div class="ttdef"><b>Definition:</b> <a href="avfilter_8c_source.html#l01444">avfilter.c:1444</a></div></div>
<div class="ttc" id="aundefined_8txt_html_a12d8853991e25cc8d069554379c29ef6"><div class="ttname"><a href="undefined_8txt.html#a12d8853991e25cc8d069554379c29ef6">c</a></div><div class="ttdeci">Undefined Behavior In the C some operations are like signed integer dereferencing freed accessing outside allocated Undefined Behavior must not occur in a C it is not safe even if the output of undefined operations is unused The unsafety may seem nit picking but Optimizing compilers have in fact optimized code on the assumption that no undefined Behavior occurs Optimizing code based on wrong assumptions can and has in some cases lead to effects beyond the output of computations The signed integer overflow problem in speed critical code Code which is highly optimized and works with signed integers sometimes has the problem that often the output of the computation does not c</div><div class="ttdef"><b>Definition:</b> <a href="undefined_8txt_source.html#l00032">undefined.txt:32</a></div></div>
<div class="ttc" id="avf__deshake__opencl_8c_html_af0745919fd99886bb935d32cc2c8dbb8"><div class="ttname"><a href="vf__deshake__opencl_8c.html#af0745919fd99886bb935d32cc2c8dbb8">transformed_point</a></div><div class="ttdeci">static cl_float2 transformed_point(float x, float y, float *transform)</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00957">vf_deshake_opencl.c:957</a></div></div>
<div class="ttc" id="avf__deshake__opencl_8c_html_ad194e43933f3a2b31606a3152198eae4"><div class="ttname"><a href="vf__deshake__opencl_8c.html#ad194e43933f3a2b31606a3152198eae4">make_gauss_kernel</a></div><div class="ttdeci">static void make_gauss_kernel(float *gauss_kernel, float length, float sigma)</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00819">vf_deshake_opencl.c:819</a></div></div>
<div class="ttc" id="astruct_deshake_open_c_l_context_html_a29fa9c662ba310cab97432efefc706ff"><div class="ttname"><a href="struct_deshake_open_c_l_context.html#a29fa9c662ba310cab97432efefc706ff">DeshakeOpenCLContext::sw_format</a></div><div class="ttdeci">int sw_format</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00237">vf_deshake_opencl.c:237</a></div></div>
<div class="ttc" id="astruct_a_v_frame_html_a3f89733f429c98ba5bc64373fb0a3f13"><div class="ttname"><a href="struct_a_v_frame.html#a3f89733f429c98ba5bc64373fb0a3f13">AVFrame::height</a></div><div class="ttdeci">int height</div><div class="ttdef"><b>Definition:</b> <a href="frame_8h_source.html#l00366">frame.h:366</a></div></div>
<div class="ttc" id="astruct_point_pair_html_a38dcabbd5cea915755b9eba77ebc5427"><div class="ttname"><a href="struct_point_pair.html#a38dcabbd5cea915755b9eba77ebc5427">PointPair::p2</a></div><div class="ttdeci">cl_float2 p2</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00101">vf_deshake_opencl.c:101</a></div></div>
<div class="ttc" id="astruct_a_v_filter_pad_html_afc112061a6035639934e0135aab7d425"><div class="ttname"><a href="struct_a_v_filter_pad.html#afc112061a6035639934e0135aab7d425">AVFilterPad::name</a></div><div class="ttdeci">const char * name</div><div class="ttdef"><b>Definition:</b> <a href="libavfilter_2internal_8h_source.html#l00060">internal.h:60</a></div></div>
<div class="ttc" id="astruct_a_v_frame_html_a385c44d7cafe80cad82fe46e25cab221"><div class="ttname"><a href="struct_a_v_frame.html#a385c44d7cafe80cad82fe46e25cab221">AVFrame::pkt_duration</a></div><div class="ttdeci">int64_t pkt_duration</div><div class="ttdef"><b>Definition:</b> <a href="frame_8h_source.html#l00587">frame.h:587</a></div></div>
<div class="ttc" id="astruct_deshake_open_c_l_context_html_ae96c83d6273eedf2402e2b59b2ff7905"><div class="ttname"><a href="struct_deshake_open_c_l_context.html#ae96c83d6273eedf2402e2b59b2ff7905">DeshakeOpenCLContext::crop_upscale_time</a></div><div class="ttdeci">unsigned long long crop_upscale_time</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00306">vf_deshake_opencl.c:306</a></div></div>
<div class="ttc" id="acast5_8c_html_aff7f98e5c83f59e0dd7abca3e5702904"><div class="ttname"><a href="cast5_8c.html#aff7f98e5c83f59e0dd7abca3e5702904">F3</a></div><div class="ttdeci">#define F3(l, r, i)</div><div class="ttdef"><b>Definition:</b> <a href="cast5_8c_source.html#l00033">cast5.c:33</a></div></div>
<div class="ttc" id="alibavutil_2internal_8h_html_a3c0fa12fafe59c44d4b16e60d8385637"><div class="ttname"><a href="libavutil_2internal_8h.html#a3c0fa12fafe59c44d4b16e60d8385637">NULL_IF_CONFIG_SMALL</a></div><div class="ttdeci">#define NULL_IF_CONFIG_SMALL(x)</div><div class="ttdef"><b>Definition:</b> <a href="libavutil_2internal_8h_source.html#l00153">internal.h:153</a></div></div>
<div class="ttc" id="alibm_8h_html_ad1eb6660c7377c9b02883d77c5bf91e6"><div class="ttname"><a href="libm_8h.html#ad1eb6660c7377c9b02883d77c5bf91e6">powf</a></div><div class="ttdeci">#define powf(x, y)</div><div class="ttdef"><b>Definition:</b> <a href="libm_8h_source.html#l00050">libm.h:50</a></div></div>
<div class="ttc" id="aopencl_8h_html_aef0b96d45ea8cd517300a8309f673221"><div class="ttname"><a href="opencl_8h.html#aef0b96d45ea8cd517300a8309f673221">CL_RELEASE_MEMORY</a></div><div class="ttdeci">#define CL_RELEASE_MEMORY(m)</div><div class="ttdef"><b>Definition:</b> <a href="opencl_8h_source.html#l00114">opencl.h:114</a></div></div>
<div class="ttc" id="apixdesc_8h_html_a4c4e95f659b1e131480c1e98d70c57de"><div class="ttname"><a href="pixdesc_8h.html#a4c4e95f659b1e131480c1e98d70c57de">AV_PIX_FMT_FLAG_RGB</a></div><div class="ttdeci">#define AV_PIX_FMT_FLAG_RGB</div><div class="ttdef"><b>Definition:</b> <a href="pixdesc_8h_source.html#l00148">pixdesc.h:148</a></div></div>
<div class="ttc" id="astruct_absolute_frame_motion_html_af13ee6297ce6688742784267660cb911"><div class="ttname"><a href="struct_absolute_frame_motion.html#af13ee6297ce6688742784267660cb911">AbsoluteFrameMotion::data_end_offset</a></div><div class="ttdeci">int data_end_offset</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00145">vf_deshake_opencl.c:145</a></div></div>
<div class="ttc" id="astruct_frame_delta_html_aed2e326e2da42c7e94ac8ffb3ae76956"><div class="ttname"><a href="struct_frame_delta.html#aed2e326e2da42c7e94ac8ffb3ae76956">FrameDelta::skew</a></div><div class="ttdeci">cl_float2 skew</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00178">vf_deshake_opencl.c:178</a></div></div>
<div class="ttc" id="avf__deshake__opencl_8c_html_a303d52aeabfba761c6e331861983fb82"><div class="ttname"><a href="vf__deshake__opencl_8c.html#a303d52aeabfba761c6e331861983fb82">DebugMatches</a></div><div class="ttdeci">struct DebugMatches DebugMatches</div></div>
<div class="ttc" id="acommon_8h_html_a9960bd6780a9b16a216a57be1ee04359"><div class="ttname"><a href="common_8h.html#a9960bd6780a9b16a216a57be1ee04359">FFMAX</a></div><div class="ttdeci">#define FFMAX(a, b)</div><div class="ttdef"><b>Definition:</b> <a href="common_8h_source.html#l00094">common.h:94</a></div></div>
<div class="ttc" id="astruct_deshake_open_c_l_context_html_a4852f1eeba2faa364c27908db1f59d14"><div class="ttname"><a href="struct_deshake_open_c_l_context.html#a4852f1eeba2faa364c27908db1f59d14">DeshakeOpenCLContext::brief_pattern</a></div><div class="ttdeci">cl_mem brief_pattern</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00265">vf_deshake_opencl.c:265</a></div></div>
<div class="ttc" id="alibm_8h_html_a364edfcde984bdfbc031ae0b2ddd6e38"><div class="ttname"><a href="libm_8h.html#a364edfcde984bdfbc031ae0b2ddd6e38">hypot</a></div><div class="ttdeci">static av_const double hypot(double x, double y)</div><div class="ttdef"><b>Definition:</b> <a href="libm_8h_source.html#l00366">libm.h:366</a></div></div>
<div class="ttc" id="astruct_point_pair_html"><div class="ttname"><a href="struct_point_pair.html">PointPair</a></div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00097">vf_deshake_opencl.c:97</a></div></div>
<div class="ttc" id="apixfmt_8h_html_a9a8e335cf3be472042bc9f0cf80cd4c5aa1a4fd66f1f4d17ffcf23f360a010538"><div class="ttname"><a href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5aa1a4fd66f1f4d17ffcf23f360a010538">AV_PIX_FMT_GBRP9BE</a></div><div class="ttdeci">@ AV_PIX_FMT_GBRP9BE</div><div class="ttdoc">planar GBR 4:4:4 27bpp, big-endian</div><div class="ttdef"><b>Definition:</b> <a href="pixfmt_8h_source.html#l00170">pixfmt.h:170</a></div></div>
<div class="ttc" id="avf__deshake__opencl_8c_html_acbbb850b53fb0195ed72a25734e1609f"><div class="ttname"><a href="vf__deshake__opencl_8c.html#acbbb850b53fb0195ed72a25734e1609f">get_subset</a></div><div class="ttdeci">static int get_subset(AVLFG *alfg, const MotionVector *point_pairs, const int num_point_pairs, MotionVector *pairs_subset, int max_attempts)</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00403">vf_deshake_opencl.c:403</a></div></div>
<div class="ttc" id="avf__deshake__opencl_8c_html_a85ec8441a811e55d823408e0b8d5bfd0"><div class="ttname"><a href="vf__deshake__opencl_8c.html#a85ec8441a811e55d823408e0b8d5bfd0">ROUNDED_UP_DIV</a></div><div class="ttdeci">#define ROUNDED_UP_DIV(a, b)</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00095">vf_deshake_opencl.c:95</a></div></div>
<div class="ttc" id="aindeo4_8c_html_acffe83926a70c9305e903c3618758ca9"><div class="ttname"><a href="indeo4_8c.html#acffe83926a70c9305e903c3618758ca9">transforms</a></div><div class="ttdeci">static const struct @0 transforms[18]</div></div>
<div class="ttc" id="astruct_deshake_open_c_l_context_html_a460f3b6df63381875e9b8750a04fd925"><div class="ttname"><a href="struct_deshake_open_c_l_context.html#a460f3b6df63381875e9b8750a04fd925">DeshakeOpenCLContext::initialized</a></div><div class="ttdeci">int initialized</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00203">vf_deshake_opencl.c:203</a></div></div>
<div class="ttc" id="apixfmt_8h_html_a9a8e335cf3be472042bc9f0cf80cd4c5a268f2be72d6a73c49a4ecc672b5f4628"><div class="ttname"><a href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a268f2be72d6a73c49a4ecc672b5f4628">AV_PIX_FMT_GBRP9LE</a></div><div class="ttdeci">@ AV_PIX_FMT_GBRP9LE</div><div class="ttdoc">planar GBR 4:4:4 27bpp, little-endian</div><div class="ttdef"><b>Definition:</b> <a href="pixfmt_8h_source.html#l00171">pixfmt.h:171</a></div></div>
<div class="ttc" id="avf__deshake__opencl_8c_html_a6ccad09b4a2a06ae178418fdccf5940d"><div class="ttname"><a href="vf__deshake__opencl_8c.html#a6ccad09b4a2a06ae178418fdccf5940d">FLAGS</a></div><div class="ttdeci">#define FLAGS</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l02157">vf_deshake_opencl.c:2157</a></div></div>
<div class="ttc" id="aundefined_8txt_html_ad99f336d4c117c453fef82993434eb4d"><div class="ttname"><a href="undefined_8txt.html#ad99f336d4c117c453fef82993434eb4d">a</a></div><div class="ttdeci">The reader does not expect b to be semantically here and if the code is changed by maybe adding a a division or other the signedness will almost certainly be mistaken To avoid this confusion a new type was SUINT is the C unsigned type but it holds a signed int to use the same example SUINT a</div><div class="ttdef"><b>Definition:</b> <a href="undefined_8txt_source.html#l00041">undefined.txt:41</a></div></div>
<div class="ttc" id="astruct_deshake_open_c_l_context_html_a8e05cd678122da9b5845b977e3222737"><div class="ttname"><a href="struct_deshake_open_c_l_context.html#a8e05cd678122da9b5845b977e3222737">DeshakeOpenCLContext::matches_host</a></div><div class="ttdeci">MotionVector * matches_host</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00240">vf_deshake_opencl.c:240</a></div></div>
<div class="ttc" id="apixfmt_8h_html_a9a8e335cf3be472042bc9f0cf80cd4c5ac4c14311e40e6fba55adb3ade5d62bd9"><div class="ttname"><a href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5ac4c14311e40e6fba55adb3ade5d62bd9">AV_PIX_FMT_GBRAP10LE</a></div><div class="ttdeci">@ AV_PIX_FMT_GBRAP10LE</div><div class="ttdoc">planar GBR 4:4:4:4 40bpp, little-endian</div><div class="ttdef"><b>Definition:</b> <a href="pixfmt_8h_source.html#l00291">pixfmt.h:291</a></div></div>
<div class="ttc" id="awriting__filters_8txt_html_ae1df9c886af8e844bb8849d403b76663"><div class="ttname"><a href="writing__filters_8txt.html#ae1df9c886af8e844bb8849d403b76663">offset</a></div><div class="ttdeci">it s the only field you need to keep assuming you have a context There is some magic you don t need to care about around this just let it vf offset</div><div class="ttdef"><b>Definition:</b> <a href="writing__filters_8txt_source.html#l00086">writing_filters.txt:86</a></div></div>
<div class="ttc" id="afilter__design_8txt_html_adcd13caad2025930d784c1fb557e5cb2"><div class="ttname"><a href="filter__design_8txt.html#adcd13caad2025930d784c1fb557e5cb2">FF_FILTER_FORWARD_WANTED</a></div><div class="ttdeci">FF_FILTER_FORWARD_WANTED(outlink, inlink)</div></div>
<div class="ttc" id="astruct_deshake_open_c_l_context_html_a6994522939118f1aff64407eccc75261"><div class="ttname"><a href="struct_deshake_open_c_l_context.html#a6994522939118f1aff64407eccc75261">DeshakeOpenCLContext::match_descriptors_time</a></div><div class="ttdeci">unsigned long long match_descriptors_time</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00304">vf_deshake_opencl.c:304</a></div></div>
<div class="ttc" id="astruct_f_f_frame_queue_html"><div class="ttname"><a href="struct_f_f_frame_queue.html">FFFrameQueue</a></div><div class="ttdef"><b>Definition:</b> <a href="framequeue_8h_source.html#l00053">framequeue.h:53</a></div></div>
<div class="ttc" id="astruct_a_v_frame_html_a1e71ce60cedd5f3b6811714a9f7f9e0a"><div class="ttname"><a href="struct_a_v_frame.html#a1e71ce60cedd5f3b6811714a9f7f9e0a">AVFrame::width</a></div><div class="ttdeci">int width</div><div class="ttdef"><b>Definition:</b> <a href="frame_8h_source.html#l00366">frame.h:366</a></div></div>
<div class="ttc" id="astruct_motion_vector_html"><div class="ttname"><a href="struct_motion_vector.html">MotionVector</a></div><div class="ttdef"><b>Definition:</b> <a href="agm_8c_source.html#l00054">agm.c:54</a></div></div>
<div class="ttc" id="aopencl__source_8h_html"><div class="ttname"><a href="opencl__source_8h.html">opencl_source.h</a></div></div>
<div class="ttc" id="amathematics_8h_html_ae71449b1cc6e6250b91f539153a7a0d3"><div class="ttname"><a href="mathematics_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a></div><div class="ttdeci">#define M_PI</div><div class="ttdef"><b>Definition:</b> <a href="mathematics_8h_source.html#l00052">mathematics.h:52</a></div></div>
<div class="ttc" id="aopencl__source_8h_html_a61d55fe4f61022cf69c5d7a8674847da"><div class="ttname"><a href="opencl__source_8h.html#a61d55fe4f61022cf69c5d7a8674847da">ff_opencl_source_deshake</a></div><div class="ttdeci">const char * ff_opencl_source_deshake</div></div>
<div class="ttc" id="astruct_similarity_matrix_html"><div class="ttname"><a href="struct_similarity_matrix.html">SimilarityMatrix</a></div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00181">vf_deshake_opencl.c:181</a></div></div>
<div class="ttc" id="aopencl_8c_html_a5fae8f981f497850faaf71344969efe3"><div class="ttname"><a href="opencl_8c.html#a5fae8f981f497850faaf71344969efe3">ff_opencl_filter_config_input</a></div><div class="ttdeci">int ff_opencl_filter_config_input(AVFilterLink *inlink)</div><div class="ttdef"><b>Definition:</b> <a href="opencl_8c_source.html#l00060">opencl.c:60</a></div></div>
<div class="ttc" id="avf__deshake__opencl_8c_html_aced7f52e0aab311d0b7138336653a536"><div class="ttname"><a href="vf__deshake__opencl_8c.html#aced7f52e0aab311d0b7138336653a536">FrameDelta</a></div><div class="ttdeci">struct FrameDelta FrameDelta</div></div>
<div class="ttc" id="agroup__avoptions_html_ggabd75aa30eb8ad6387672df9a1fa79444ae91d3f6cbac4a4de2a6e880ac2a52d1a"><div class="ttname"><a href="group__avoptions.html#ggabd75aa30eb8ad6387672df9a1fa79444ae91d3f6cbac4a4de2a6e880ac2a52d1a">AV_OPT_TYPE_FLOAT</a></div><div class="ttdeci">@ AV_OPT_TYPE_FLOAT</div><div class="ttdef"><b>Definition:</b> <a href="opt_8h_source.html#l00228">opt.h:228</a></div></div>
<div class="ttc" id="astruct_deshake_open_c_l_context_html_aa3332ab582d637e85277c04f340b8fa6"><div class="ttname"><a href="struct_deshake_open_c_l_context.html#aa3332ab582d637e85277c04f340b8fa6">DeshakeOpenCLContext::kernel_draw_debug_info</a></div><div class="ttdeci">cl_kernel kernel_draw_debug_info</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00295">vf_deshake_opencl.c:295</a></div></div>
<div class="ttc" id="astruct_deshake_open_c_l_context_html_a2d119e5475c47905ac57b5289cc7798b"><div class="ttname"><a href="struct_deshake_open_c_l_context.html#a2d119e5475c47905ac57b5289cc7798b">DeshakeOpenCLContext::read_buf_time</a></div><div class="ttdeci">unsigned long long read_buf_time</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00309">vf_deshake_opencl.c:309</a></div></div>
<div class="ttc" id="ainput_8c_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="input_8c_source.html#l00407">input.c:407</a></div></div>
<div class="ttc" id="atransform_8c_html_a33249c4342a334d41b1c124ef28031cb"><div class="ttname"><a href="transform_8c.html#a33249c4342a334d41b1c124ef28031cb">ff_get_matrix</a></div><div class="ttdeci">void ff_get_matrix(float x_shift, float y_shift, float angle, float scale_x, float scale_y, float *matrix)</div><div class="ttdef"><b>Definition:</b> <a href="transform_8c_source.html#l00106">transform.c:106</a></div></div>
<div class="ttc" id="astruct_deshake_open_c_l_context_html_ad59ba220d72a4f17d367860c85a1c4b8"><div class="ttname"><a href="struct_deshake_open_c_l_context.html#ad59ba220d72a4f17d367860c85a1c4b8">DeshakeOpenCLContext::kernel_harris_response</a></div><div class="ttdeci">cl_kernel kernel_harris_response</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00247">vf_deshake_opencl.c:247</a></div></div>
<div class="ttc" id="avf__deshake__opencl_8c_html_a4a2c3e7952056207a49b44440a141977"><div class="ttname"><a href="vf__deshake__opencl_8c.html#a4a2c3e7952056207a49b44440a141977">queue_frame</a></div><div class="ttdeci">static int queue_frame(AVFilterLink *link, AVFrame *input_frame)</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l01749">vf_deshake_opencl.c:1749</a></div></div>
<div class="ttc" id="alibm_8h_html_a7ddd290acf3fe2961676053dbbc2cec3"><div class="ttname"><a href="libm_8h.html#a7ddd290acf3fe2961676053dbbc2cec3">round</a></div><div class="ttdeci">static av_always_inline av_const double round(double x)</div><div class="ttdef"><b>Definition:</b> <a href="libm_8h_source.html#l00444">libm.h:444</a></div></div>
<div class="ttc" id="astruct_deshake_open_c_l_context_html_a588f6e97b0bc1508d365e126a724028f"><div class="ttname"><a href="struct_deshake_open_c_l_context.html#a588f6e97b0bc1508d365e126a724028f">DeshakeOpenCLContext::prev_refined_features</a></div><div class="ttdeci">cl_mem prev_refined_features</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00262">vf_deshake_opencl.c:262</a></div></div>
<div class="ttc" id="avf__deshake__opencl_8c_html_ae0e802e85b29e3ce507e66df45884676"><div class="ttname"><a href="vf__deshake__opencl_8c.html#ae0e802e85b29e3ce507e66df45884676">transform_debug</a></div><div class="ttdeci">static void transform_debug(AVFilterContext *avctx, float *new_vals, float *old_vals, int curr_frame)</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l01357">vf_deshake_opencl.c:1357</a></div></div>
<div class="ttc" id="astruct_debug_matches_html"><div class="ttname"><a href="struct_debug_matches.html">DebugMatches</a></div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00123">vf_deshake_opencl.c:123</a></div></div>
<div class="ttc" id="alibavutil_2internal_8h_html"><div class="ttname"><a href="libavutil_2internal_8h.html">internal.h</a></div></div>
<div class="ttc" id="astruct_crop_info_html_a021b9999edc9cb446f56c8d9ed44e8d5"><div class="ttname"><a href="struct_crop_info.html#a021b9999edc9cb446f56c8d9ed44e8d5">CropInfo::bottom_right</a></div><div class="ttdeci">cl_float2 bottom_right</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00190">vf_deshake_opencl.c:190</a></div></div>
<div class="ttc" id="acommon_8h_html"><div class="ttname"><a href="common_8h.html">common.h</a></div></div>
<div class="ttc" id="alibavutil_2fifo_8c_html_ada874c149988db27a46f8f5447cef478"><div class="ttname"><a href="libavutil_2fifo_8c.html#ada874c149988db27a46f8f5447cef478">av_fifo_alloc_array</a></div><div class="ttdeci">AVFifoBuffer * av_fifo_alloc_array(size_t nmemb, size_t size)</div><div class="ttdef"><b>Definition:</b> <a href="libavutil_2fifo_8c_source.html#l00049">fifo.c:49</a></div></div>
<div class="ttc" id="avf__deshake__opencl_8c_html_a6f2f1655956e19d07d703031b77393bd"><div class="ttname"><a href="vf__deshake__opencl_8c.html#a6f2f1655956e19d07d703031b77393bd">make_vectors_contig</a></div><div class="ttdeci">static int make_vectors_contig(DeshakeOpenCLContext *deshake_ctx, int size_y, int size_x)</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00787">vf_deshake_opencl.c:787</a></div></div>
<div class="ttc" id="avorbis__enc__data_8h_html_a1ee4a05b54419bfadd66ee351d05812e"><div class="ttname"><a href="vorbis__enc__data_8h.html#a1ee4a05b54419bfadd66ee351d05812e">delta</a></div><div class="ttdeci">float delta</div><div class="ttdef"><b>Definition:</b> <a href="vorbis__enc__data_8h_source.html#l00457">vorbis_enc_data.h:457</a></div></div>
<div class="ttc" id="avf__deshake__opencl_8c_html_ab5283561721ad2970de4e2d569100dac"><div class="ttname"><a href="vf__deshake__opencl_8c.html#ab5283561721ad2970de4e2d569100dac">activate</a></div><div class="ttdeci">static int activate(AVFilterContext *ctx)</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l02039">vf_deshake_opencl.c:2039</a></div></div>
<div class="ttc" id="astruct_iter_indices_html_aff2a431f9d303a170a41bd9546e70cde"><div class="ttname"><a href="struct_iter_indices.html#aff2a431f9d303a170a41bd9546e70cde">IterIndices::end</a></div><div class="ttdeci">int end</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00197">vf_deshake_opencl.c:197</a></div></div>
<div class="ttc" id="astruct_deshake_open_c_l_context_html_afebbd432ac813cb40ddfe331b4437d89"><div class="ttname"><a href="struct_deshake_open_c_l_context.html#afebbd432ac813cb40ddfe331b4437d89">DeshakeOpenCLContext::should_crop</a></div><div class="ttdeci">int should_crop</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00282">vf_deshake_opencl.c:282</a></div></div>
<div class="ttc" id="agroup__lavu__math__rational_html_gab646f0a7cc30af543ba4a91b37f9de6e"><div class="ttname"><a href="group__lavu__math__rational.html#gab646f0a7cc30af543ba4a91b37f9de6e">av_inv_q</a></div><div class="ttdeci">static av_always_inline AVRational av_inv_q(AVRational q)</div><div class="ttdef"><b>Definition:</b> <a href="rational_8h_source.html#l00159">rational.h:159</a></div></div>
<div class="ttc" id="avf__deshake__opencl_8c_html_a1579ea8319abda6b1f90db17716333b5a9113457a0b099555ded29c2f6a521cb7"><div class="ttname"><a href="vf__deshake__opencl_8c.html#a1579ea8319abda6b1f90db17716333b5a9113457a0b099555ded29c2f6a521cb7">RingbufCount</a></div><div class="ttdeci">@ RingbufCount</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00120">vf_deshake_opencl.c:119</a></div></div>
<div class="ttc" id="avf__deshake__opencl_8c_html_a32fee6ebcc3bc066f425852915a5bed6"><div class="ttname"><a href="vf__deshake__opencl_8c.html#a32fee6ebcc3bc066f425852915a5bed6">smooth</a></div><div class="ttdeci">static float smooth(DeshakeOpenCLContext *deshake_ctx, float *gauss_kernel, int length, float max_val, AVFifoBuffer *values)</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00903">vf_deshake_opencl.c:903</a></div></div>
<div class="ttc" id="astruct_debug_matches_html_ac7258324928e2eee6652aeaac94a53f1"><div class="ttname"><a href="struct_debug_matches.html#ac7258324928e2eee6652aeaac94a53f1">DebugMatches::num_matches</a></div><div class="ttdeci">int num_matches</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00128">vf_deshake_opencl.c:128</a></div></div>
<div class="ttc" id="apixfmt_8h_html_a9a8e335cf3be472042bc9f0cf80cd4c5ad1af728e834504b8eb63f5560b7c8246"><div class="ttname"><a href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5ad1af728e834504b8eb63f5560b7c8246">AV_PIX_FMT_GBRAP16LE</a></div><div class="ttdeci">@ AV_PIX_FMT_GBRAP16LE</div><div class="ttdoc">planar GBRA 4:4:4:4 64bpp, little-endian</div><div class="ttdef"><b>Definition:</b> <a href="pixfmt_8h_source.html#l00217">pixfmt.h:217</a></div></div>
<div class="ttc" id="aopencl_8c_html_a78e70e71221ecf678d4c3f2756f5682b"><div class="ttname"><a href="opencl_8c.html#a78e70e71221ecf678d4c3f2756f5682b">ff_opencl_filter_init</a></div><div class="ttdeci">int ff_opencl_filter_init(AVFilterContext *avctx)</div><div class="ttdef"><b>Definition:</b> <a href="opencl_8c_source.html#l00147">opencl.c:147</a></div></div>
<div class="ttc" id="aopencl_8h_html_ae14f51396b9977520ef5b2fcc102bce2"><div class="ttname"><a href="opencl_8h.html#ae14f51396b9977520ef5b2fcc102bce2">CL_BLOCKING_WRITE_BUFFER</a></div><div class="ttdeci">#define CL_BLOCKING_WRITE_BUFFER(queue, buffer, size, host_ptr, event)</div><div class="ttdef"><b>Definition:</b> <a href="opencl_8h_source.html#l00214">opencl.h:214</a></div></div>
<div class="ttc" id="afilter__design_8txt_html_af1ec77bdca1b30e8153fc5da88f603db"><div class="ttname"><a href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a></div><div class="ttdeci">ret</div><div class="ttdef"><b>Definition:</b> <a href="filter__design_8txt_source.html#l00187">filter_design.txt:187</a></div></div>
<div class="ttc" id="avf__deshake__opencl_8c_html_a36f9cda70f2c32011a7370118a8a3877"><div class="ttname"><a href="vf__deshake__opencl_8c.html#a36f9cda70f2c32011a7370118a8a3877">compute_error</a></div><div class="ttdeci">static void compute_error(const MotionVector *point_pairs, const int num_point_pairs, const double *model, float *err)</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00445">vf_deshake_opencl.c:445</a></div></div>
<div class="ttc" id="avf__deshake__opencl_8c_html_a9a86aeb5adfa66197a646bf68cc17346"><div class="ttname"><a href="vf__deshake__opencl_8c.html#a9a86aeb5adfa66197a646bf68cc17346">ransac_update_num_iters</a></div><div class="ttdeci">static int ransac_update_num_iters(double confidence, double num_outliers, int max_iters)</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00505">vf_deshake_opencl.c:505</a></div></div>
<div class="ttc" id="apixfmt_8h_html"><div class="ttname"><a href="pixfmt_8h.html">pixfmt.h</a></div></div>
<div class="ttc" id="afilter__design_8txt_html_a48ad71a5b40cdd5f23c601f33665a953"><div class="ttname"><a href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a></div><div class="ttdeci">these buffered frames must be flushed immediately if a new input produces new the filter must not call request_frame to get more It must just process the frame or queue it The task of requesting more frames is left to the filter s request_frame method or the application If a filter has several the filter must be ready for frames arriving randomly on any input any filter with several inputs will most likely require some kind of queuing mechanism It is perfectly acceptable to have a limited queue and to drop frames when the inputs are too unbalanced request_frame For filters that do not use the this method is called when a frame is wanted on an output For a it should directly call filter_frame on the corresponding output For a if there are queued frames already one of these frames should be pushed If the filter should request a frame on one of its repeatedly until at least one frame has been pushed Return or at least make progress towards producing a frame</div><div class="ttdef"><b>Definition:</b> <a href="filter__design_8txt_source.html#l00264">filter_design.txt:264</a></div></div>
<div class="ttc" id="astruct_deshake_open_c_l_context_html_af41b236ec464389c9700936e54260726"><div class="ttname"><a href="struct_deshake_open_c_l_context.html#af41b236ec464389c9700936e54260726">DeshakeOpenCLContext::abs_motion</a></div><div class="ttdeci">AbsoluteFrameMotion abs_motion</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00215">vf_deshake_opencl.c:215</a></div></div>
<div class="ttc" id="atransform_8h_html"><div class="ttname"><a href="transform_8h.html">transform.h</a></div></div>
<div class="ttc" id="asinewin__tablegen__template_8c_html_a3508a98d3ee7e2c9a4841fe264cf70f7"><div class="ttname"><a href="sinewin__tablegen__template_8c.html#a3508a98d3ee7e2c9a4841fe264cf70f7">FF_ARRAY_ELEMS</a></div><div class="ttdeci">#define FF_ARRAY_ELEMS(a)</div><div class="ttdef"><b>Definition:</b> <a href="sinewin__tablegen__template_8c_source.html#l00038">sinewin_tablegen_template.c:38</a></div></div>
<div class="ttc" id="avf__deshake__opencl_8c_html_a8ddfbb6d84d415a436ea86ae840b81fd"><div class="ttname"><a href="vf__deshake__opencl_8c.html#a8ddfbb6d84d415a436ea86ae840b81fd">check_subset</a></div><div class="ttdeci">static int check_subset(const MotionVector *pairs_subset)</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00385">vf_deshake_opencl.c:385</a></div></div>
<div class="ttc" id="aframequeue_8h_html_ac41263ba7691b6c83fd3af99920206cd"><div class="ttname"><a href="framequeue_8h.html#ac41263ba7691b6c83fd3af99920206cd">ff_framequeue_queued_frames</a></div><div class="ttdeci">static size_t ff_framequeue_queued_frames(const FFFrameQueue *fq)</div><div class="ttdef"><b>Definition:</b> <a href="framequeue_8h_source.html#l00146">framequeue.h:146</a></div></div>
<div class="ttc" id="avf__deshake__opencl_8c_html_a30cc92ce8ade04802bd88bb82bb0405d"><div class="ttname"><a href="vf__deshake__opencl_8c.html#a30cc92ce8ade04802bd88bb82bb0405d">run_estimate_kernel</a></div><div class="ttdeci">static void run_estimate_kernel(const MotionVector *point_pairs, double *model)</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00329">vf_deshake_opencl.c:329</a></div></div>
<div class="ttc" id="astruct_f_f_frame_queue_global_html"><div class="ttname"><a href="struct_f_f_frame_queue_global.html">FFFrameQueueGlobal</a></div><div class="ttdef"><b>Definition:</b> <a href="framequeue_8h_source.html#l00046">framequeue.h:46</a></div></div>
<div class="ttc" id="astruct_a_v_frame_html_a1d0f65014a8d1bf78cec8cbed2304992"><div class="ttname"><a href="struct_a_v_frame.html#a1d0f65014a8d1bf78cec8cbed2304992">AVFrame::data</a></div><div class="ttdeci">uint8_t * data[AV_NUM_DATA_POINTERS]</div><div class="ttdef"><b>Definition:</b> <a href="frame_8h_source.html#l00322">frame.h:322</a></div></div>
<div class="ttc" id="astruct_frame_delta_html_a62cbcfdd88ecf0d96220bb61f2106907"><div class="ttname"><a href="struct_frame_delta.html#a62cbcfdd88ecf0d96220bb61f2106907">FrameDelta::translation</a></div><div class="ttdeci">cl_float2 translation</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00175">vf_deshake_opencl.c:175</a></div></div>
<div class="ttc" id="aframequeue_8c_html_abc3da492dbf358e6ab2520b6e3665ada"><div class="ttname"><a href="framequeue_8c.html#abc3da492dbf358e6ab2520b6e3665ada">ff_framequeue_global_init</a></div><div class="ttdeci">void ff_framequeue_global_init(FFFrameQueueGlobal *fqg)</div><div class="ttdef"><b>Definition:</b> <a href="framequeue_8c_source.html#l00030">framequeue.c:30</a></div></div>
<div class="ttc" id="astruct_crop_info_html_ae1943b8a3e6b5faca15573d739f83226"><div class="ttname"><a href="struct_crop_info.html#ae1943b8a3e6b5faca15573d739f83226">CropInfo::top_left</a></div><div class="ttdeci">cl_float2 top_left</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00188">vf_deshake_opencl.c:188</a></div></div>
<div class="ttc" id="astruct_frame_delta_html"><div class="ttname"><a href="struct_frame_delta.html">FrameDelta</a></div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00174">vf_deshake_opencl.c:174</a></div></div>
<div class="ttc" id="aavfilter_8h_html"><div class="ttname"><a href="avfilter_8h.html">avfilter.h</a></div></div>
<div class="ttc" id="astruct_absolute_frame_motion_html"><div class="ttname"><a href="struct_absolute_frame_motion.html">AbsoluteFrameMotion</a></div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00135">vf_deshake_opencl.c:135</a></div></div>
<div class="ttc" id="avf__deshake__opencl_8c_html_a21d8250cfd99b8b03c3e7798fc86ff94"><div class="ttname"><a href="vf__deshake__opencl_8c.html#a21d8250cfd99b8b03c3e7798fc86ff94">gaussian_for</a></div><div class="ttdeci">static float gaussian_for(int x, float sigma)</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00813">vf_deshake_opencl.c:813</a></div></div>
<div class="ttc" id="astruct_a_v_filter_context_html_ae9e65e98275f789bb5fbb72c52d4f3ad"><div class="ttname"><a href="struct_a_v_filter_context.html#ae9e65e98275f789bb5fbb72c52d4f3ad">AVFilterContext::outputs</a></div><div class="ttdeci">AVFilterLink ** outputs</div><div class="ttdoc">array of pointers to output links</div><div class="ttdef"><b>Definition:</b> <a href="avfilter_8h_source.html#l00353">avfilter.h:353</a></div></div>
<div class="ttc" id="afilter__design_8txt_html_ad283c679febe22c5a4d36e3764daf32b"><div class="ttname"><a href="filter__design_8txt.html#ad283c679febe22c5a4d36e3764daf32b">values</a></div><div class="ttdeci">these buffered frames must be flushed immediately if a new input produces new the filter must not call request_frame to get more It must just process the frame or queue it The task of requesting more frames is left to the filter s request_frame method or the application If a filter has several the filter must be ready for frames arriving randomly on any input any filter with several inputs will most likely require some kind of queuing mechanism It is perfectly acceptable to have a limited queue and to drop frames when the inputs are too unbalanced request_frame For filters that do not use the this method is called when a frame is wanted on an output For a it should directly call filter_frame on the corresponding output For a if there are queued frames already one of these frames should be pushed If the filter should request a frame on one of its repeatedly until at least one frame has been pushed Return values</div><div class="ttdef"><b>Definition:</b> <a href="filter__design_8txt_source.html#l00262">filter_design.txt:263</a></div></div>
<div class="ttc" id="avf__mcdeint_8c_html_a0b90bc971fe5188fc4d32fe8177a64a5"><div class="ttname"><a href="vf__mcdeint_8c.html#a0b90bc971fe5188fc4d32fe8177a64a5">temp</a></div><div class="ttdeci">else temp</div><div class="ttdef"><b>Definition:</b> <a href="vf__mcdeint_8c_source.html#l00256">vf_mcdeint.c:256</a></div></div>
<div class="ttc" id="aopencl_8c_html_a36157d270f671e8d98d9c5a952eae5cd"><div class="ttname"><a href="opencl_8c.html#a36157d270f671e8d98d9c5a952eae5cd">ff_opencl_filter_uninit</a></div><div class="ttdeci">void ff_opencl_filter_uninit(AVFilterContext *avctx)</div><div class="ttdef"><b>Definition:</b> <a href="opencl_8c_source.html#l00156">opencl.c:156</a></div></div>
<div class="ttc" id="astruct_deshake_open_c_l_context_html_ad68588f3779e87462e9460c60c5ecd63"><div class="ttname"><a href="struct_deshake_open_c_l_context.html#ad68588f3779e87462e9460c60c5ecd63">DeshakeOpenCLContext::kernel_grayscale</a></div><div class="ttdeci">cl_kernel kernel_grayscale</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00246">vf_deshake_opencl.c:246</a></div></div>
<div class="ttc" id="aopencl_8h_html_af9c68815882f76b60a7b66529e0d5007"><div class="ttname"><a href="opencl_8h.html#af9c68815882f76b60a7b66529e0d5007">CL_RELEASE_QUEUE</a></div><div class="ttdeci">#define CL_RELEASE_QUEUE(q)</div><div class="ttdef"><b>Definition:</b> <a href="opencl_8h_source.html#l00127">opencl.h:127</a></div></div>
<div class="ttc" id="astruct_similarity_matrix_html_a46c459590caaeb90c6c7c9e7559004c4"><div class="ttname"><a href="struct_similarity_matrix.html#a46c459590caaeb90c6c7c9e7559004c4">SimilarityMatrix::matrix</a></div><div class="ttdeci">double matrix[6]</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00183">vf_deshake_opencl.c:183</a></div></div>
<div class="ttc" id="apixfmt_8h_html_a9a8e335cf3be472042bc9f0cf80cd4c5ad000ae47faa5fbe8d4b3b375151694ef"><div class="ttname"><a href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5ad000ae47faa5fbe8d4b3b375151694ef">AV_PIX_FMT_GBRP</a></div><div class="ttdeci">@ AV_PIX_FMT_GBRP</div><div class="ttdoc">planar GBR 4:4:4 24bpp</div><div class="ttdef"><b>Definition:</b> <a href="pixfmt_8h_source.html#l00168">pixfmt.h:168</a></div></div>
<div class="ttc" id="alibsvtav1_8c_html_a710bce51374aba96ab04912897666c35"><div class="ttname"><a href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a></div><div class="ttdeci">const char * desc</div><div class="ttdef"><b>Definition:</b> <a href="libsvtav1_8c_source.html#l00079">libsvtav1.c:79</a></div></div>
<div class="ttc" id="avf__deshake__opencl_8c_html_af57797dd476bb0971eb7a7444d67e4e1"><div class="ttname"><a href="vf__deshake__opencl_8c.html#af57797dd476bb0971eb7a7444d67e4e1">find_inliers</a></div><div class="ttdeci">static int find_inliers(MotionVector *point_pairs, const int num_point_pairs, const double *model, float *err, double thresh)</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00469">vf_deshake_opencl.c:469</a></div></div>
<div class="ttc" id="agroup__lavu__misc_html_gga9a84bba4713dfced21a1a56163be1f48ac1a46f59be5c6c2d3412ab172d6b8cf5"><div class="ttname"><a href="group__lavu__misc.html#gga9a84bba4713dfced21a1a56163be1f48ac1a46f59be5c6c2d3412ab172d6b8cf5">AVMEDIA_TYPE_VIDEO</a></div><div class="ttdeci">@ AVMEDIA_TYPE_VIDEO</div><div class="ttdef"><b>Definition:</b> <a href="avutil_8h_source.html#l00201">avutil.h:201</a></div></div>
<div class="ttc" id="astruct_deshake_open_c_l_context_html_a4b73a586695575b9a355baae0432be1e"><div class="ttname"><a href="struct_deshake_open_c_l_context.html#a4b73a586695575b9a355baae0432be1e">DeshakeOpenCLContext::smooth_window</a></div><div class="ttdeci">int smooth_window</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00219">vf_deshake_opencl.c:219</a></div></div>
<div class="ttc" id="avf__deshake__opencl_8c_html_a705710e10ca1ee7f8e8160ffed51f5ba"><div class="ttname"><a href="vf__deshake__opencl_8c.html#a705710e10ca1ee7f8e8160ffed51f5ba">deshake_opencl_options</a></div><div class="ttdeci">static const AVOption deshake_opencl_options[]</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l02159">vf_deshake_opencl.c:2159</a></div></div>
<div class="ttc" id="amem_8h_html"><div class="ttname"><a href="mem_8h.html">mem.h</a></div></div>
<div class="ttc" id="astruct_a_v_filter_html"><div class="ttname"><a href="struct_a_v_filter.html">AVFilter</a></div><div class="ttdef"><b>Definition:</b> <a href="avfilter_8h_source.html#l00145">avfilter.h:145</a></div></div>
<div class="ttc" id="alibavutil_2fifo_8c_html_a81f4cea70d96846df7111daccc5ecce2"><div class="ttname"><a href="libavutil_2fifo_8c.html#a81f4cea70d96846df7111daccc5ecce2">av_fifo_size</a></div><div class="ttdeci">int av_fifo_size(const AVFifoBuffer *f)</div><div class="ttdef"><b>Definition:</b> <a href="libavutil_2fifo_8c_source.html#l00077">fifo.c:77</a></div></div>
<div class="ttc" id="alibavutil_2fifo_8c_html_ae44de4980b66c0695a4cf7808c140181"><div class="ttname"><a href="libavutil_2fifo_8c.html#ae44de4980b66c0695a4cf7808c140181">av_fifo_generic_peek_at</a></div><div class="ttdeci">int av_fifo_generic_peek_at(AVFifoBuffer *f, void *dest, int offset, int buf_size, void(*func)(void *, void *, int))</div><div class="ttdef"><b>Definition:</b> <a href="libavutil_2fifo_8c_source.html#l00151">fifo.c:151</a></div></div>
<div class="ttc" id="astruct_a_v_frame_html_a0452833e3ab6ddd7acbf82817a7818a4"><div class="ttname"><a href="struct_a_v_frame.html#a0452833e3ab6ddd7acbf82817a7818a4">AVFrame::pts</a></div><div class="ttdeci">int64_t pts</div><div class="ttdef"><b>Definition:</b> <a href="frame_8h_source.html#l00401">frame.h:401</a></div></div>
<div class="ttc" id="aopencl_8c_html_abb2ed9501a29a5fbfed7971fefabf291"><div class="ttname"><a href="opencl_8c.html#abb2ed9501a29a5fbfed7971fefabf291">ff_opencl_get_event_time</a></div><div class="ttdeci">cl_ulong ff_opencl_get_event_time(cl_event event)</div><div class="ttdef"><b>Definition:</b> <a href="opencl_8c_source.html#l00354">opencl.c:354</a></div></div>
<div class="ttc" id="astruct_deshake_open_c_l_context_html_a4643b2df679a01bf1bd670e97445fca3"><div class="ttname"><a href="struct_deshake_open_c_l_context.html#a4643b2df679a01bf1bd670e97445fca3">DeshakeOpenCLContext::kernel_match_descriptors</a></div><div class="ttdeci">cl_kernel kernel_match_descriptors</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00250">vf_deshake_opencl.c:250</a></div></div>
<div class="ttc" id="astruct_crop_info_html"><div class="ttname"><a href="struct_crop_info.html">CropInfo</a></div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00186">vf_deshake_opencl.c:186</a></div></div>
<div class="ttc" id="alibavutil_2fifo_8c_html_a612be59edb6ab388a82d1487d1bd0c4d"><div class="ttname"><a href="libavutil_2fifo_8c.html#a612be59edb6ab388a82d1487d1bd0c4d">av_fifo_freep</a></div><div class="ttdeci">void av_fifo_freep(AVFifoBuffer **f)</div><div class="ttdef"><b>Definition:</b> <a href="libavutil_2fifo_8c_source.html#l00063">fifo.c:63</a></div></div>
<div class="ttc" id="avf__deshake__opencl_8c_html_a4ed190bdc1f71da7f7bf78aaec510882"><div class="ttname"><a href="vf__deshake__opencl_8c.html#a4ed190bdc1f71da7f7bf78aaec510882">ringbuf_float_at</a></div><div class="ttdeci">static void ringbuf_float_at(DeshakeOpenCLContext *deshake_ctx, AVFifoBuffer *values, float *val, int offset)</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00854">vf_deshake_opencl.c:854</a></div></div>
<div class="ttc" id="agroup__avoptions_html_ggabd75aa30eb8ad6387672df9a1fa79444af3898696f46dc79b74b708d8fa4b52a7"><div class="ttname"><a href="group__avoptions.html#ggabd75aa30eb8ad6387672df9a1fa79444af3898696f46dc79b74b708d8fa4b52a7">AV_OPT_TYPE_BOOL</a></div><div class="ttdeci">@ AV_OPT_TYPE_BOOL</div><div class="ttdef"><b>Definition:</b> <a href="opt_8h_source.html#l00242">opt.h:242</a></div></div>
<div class="ttc" id="atableprint__vlc_8h_html_adba82e1bcd02de510a858fcbedf79ef1"><div class="ttname"><a href="tableprint__vlc_8h.html#adba82e1bcd02de510a858fcbedf79ef1">av_freep</a></div><div class="ttdeci">#define av_freep(p)</div><div class="ttdef"><b>Definition:</b> <a href="tableprint__vlc_8h_source.html#l00035">tableprint_vlc.h:35</a></div></div>
<div class="ttc" id="astruct_deshake_open_c_l_context_html_ac7aef1ea8edc37e98f593dfcd91dad84"><div class="ttname"><a href="struct_deshake_open_c_l_context.html#ac7aef1ea8edc37e98f593dfcd91dad84">DeshakeOpenCLContext::duration</a></div><div class="ttdeci">int64_t duration</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00206">vf_deshake_opencl.c:206</a></div></div>
<div class="ttc" id="aaeval_8c_html_a5b4e302dfe4b2ee5369f0278621acd5f"><div class="ttname"><a href="aeval_8c.html#a5b4e302dfe4b2ee5369f0278621acd5f">query_formats</a></div><div class="ttdeci">static int query_formats(AVFilterContext *ctx)</div><div class="ttdef"><b>Definition:</b> <a href="aeval_8c_source.html#l00244">aeval.c:244</a></div></div>
<div class="ttc" id="aimgutils_8h_html"><div class="ttname"><a href="imgutils_8h.html">imgutils.h</a></div></div>
<div class="ttc" id="aopencl_8h_html_aaa280f44bed54bca1bf9644bc18cb89a"><div class="ttname"><a href="opencl_8h.html#aaa280f44bed54bca1bf9644bc18cb89a">CL_CREATE_BUFFER_FLAGS</a></div><div class="ttdeci">#define CL_CREATE_BUFFER_FLAGS(ctx, buffer_name, flags, size, host_ptr)</div><div class="ttdef"><b>Definition:</b> <a href="opencl_8h_source.html#l00197">opencl.h:197</a></div></div>
<div class="ttc" id="astruct_deshake_open_c_l_context_html_a57027e4f486537b2be43c331122e1012"><div class="ttname"><a href="struct_deshake_open_c_l_context.html#a57027e4f486537b2be43c331122e1012">DeshakeOpenCLContext::debug_model_matches</a></div><div class="ttdeci">cl_mem debug_model_matches</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00297">vf_deshake_opencl.c:297</a></div></div>
<div class="ttc" id="atableprint__vlc_8h_html_af38b91523053c244564a94f1ef862c2c"><div class="ttname"><a href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a></div><div class="ttdeci">#define av_log(a,...)</div><div class="ttdef"><b>Definition:</b> <a href="tableprint__vlc_8h_source.html#l00028">tableprint_vlc.h:28</a></div></div>
<div class="ttc" id="aopencl_8h_html_aff23105528b325d213e0fbf7300e1980"><div class="ttname"><a href="opencl_8h.html#aff23105528b325d213e0fbf7300e1980">CL_FAIL_ON_ERROR</a></div><div class="ttdeci">#define CL_FAIL_ON_ERROR(errcode,...)</div><div class="ttdef"><b>Definition:</b> <a href="opencl_8h_source.html#l00074">opencl.h:74</a></div></div>
<div class="ttc" id="apixfmt_8h_html_a9a8e335cf3be472042bc9f0cf80cd4c5abd01a2f02df929264d07dc2c003a537e"><div class="ttname"><a href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5abd01a2f02df929264d07dc2c003a537e">AV_PIX_FMT_GBRAP10BE</a></div><div class="ttdeci">@ AV_PIX_FMT_GBRAP10BE</div><div class="ttdoc">planar GBR 4:4:4:4 40bpp, big-endian</div><div class="ttdef"><b>Definition:</b> <a href="pixfmt_8h_source.html#l00290">pixfmt.h:290</a></div></div>
<div class="ttc" id="astruct_deshake_open_c_l_context_html_a776fbef11213f42fc88a93f39cf7d3f3"><div class="ttname"><a href="struct_deshake_open_c_l_context.html#a776fbef11213f42fc88a93f39cf7d3f3">DeshakeOpenCLContext::fq</a></div><div class="ttdeci">FFFrameQueue fq</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00213">vf_deshake_opencl.c:213</a></div></div>
<div class="ttc" id="astruct_deshake_open_c_l_context_html_a3a60dbef2cdb99207de33b4eb6e56701"><div class="ttname"><a href="struct_deshake_open_c_l_context.html#a3a60dbef2cdb99207de33b4eb6e56701">DeshakeOpenCLContext::crop_y</a></div><div class="ttdeci">CropInfo crop_y</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00230">vf_deshake_opencl.c:230</a></div></div>
<div class="ttc" id="acrystalhd_8c_html_a47e28e6ea289d3f83ad1883ddde5a422"><div class="ttname"><a href="crystalhd_8c.html#a47e28e6ea289d3f83ad1883ddde5a422">uninit</a></div><div class="ttdeci">static av_cold int uninit(AVCodecContext *avctx)</div><div class="ttdef"><b>Definition:</b> <a href="crystalhd_8c_source.html#l00279">crystalhd.c:279</a></div></div>
<div class="ttc" id="avf__deshake__opencl_8c_html_ae9687f8b93a6b320cd8c7ab4b5bf5dab"><div class="ttname"><a href="vf__deshake__opencl_8c.html#ae9687f8b93a6b320cd8c7ab4b5bf5dab">MotionVector</a></div><div class="ttdeci">struct MotionVector MotionVector</div></div>
<div class="ttc" id="avf__deshake__opencl_8c_html_a8e8a6f5abd69302d0de8fd00be2ece98"><div class="ttname"><a href="vf__deshake__opencl_8c.html#a8e8a6f5abd69302d0de8fd00be2ece98">CropInfo</a></div><div class="ttdeci">struct CropInfo CropInfo</div></div>
<div class="ttc" id="astruct_a_v_filter_html_a28a4776f344f91055f42a4c2a1b15c0c"><div class="ttname"><a href="struct_a_v_filter.html#a28a4776f344f91055f42a4c2a1b15c0c">AVFilter::name</a></div><div class="ttdeci">const char * name</div><div class="ttdef"><b>Definition:</b> <a href="avfilter_8h_source.html#l00149">avfilter.h:149</a></div></div>
<div class="ttc" id="astruct_a_v_frame_html"><div class="ttname"><a href="struct_a_v_frame.html">AVFrame</a></div><div class="ttdef"><b>Definition:</b> <a href="frame_8h_source.html#l00308">frame.h:308</a></div></div>
<div class="ttc" id="astruct_deshake_open_c_l_context_html_a8192eb89bbb66932516c6d383a65ac94"><div class="ttname"><a href="struct_deshake_open_c_l_context.html#a8192eb89bbb66932516c6d383a65ac94">DeshakeOpenCLContext::kernel_crop_upscale</a></div><div class="ttdeci">cl_kernel kernel_crop_upscale</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00252">vf_deshake_opencl.c:252</a></div></div>
<div class="ttc" id="astruct_a_v_filter_context_html_a6837bf4b3d70c0a2bd3122f9daadc0d4"><div class="ttname"><a href="struct_a_v_filter_context.html#a6837bf4b3d70c0a2bd3122f9daadc0d4">AVFilterContext::inputs</a></div><div class="ttdeci">AVFilterLink ** inputs</div><div class="ttdoc">array of pointers to input links</div><div class="ttdef"><b>Definition:</b> <a href="avfilter_8h_source.html#l00349">avfilter.h:349</a></div></div>
<div class="ttc" id="affmpeg__filter_8c_html_a61569f2965b7a369eb10b6d75d410d11"><div class="ttname"><a href="ffmpeg__filter_8c.html#a61569f2965b7a369eb10b6d75d410d11">int</a></div><div class="ttdeci">int</div><div class="ttdef"><b>Definition:</b> <a href="ffmpeg__filter_8c_source.html#l00193">ffmpeg_filter.c:193</a></div></div>
<div class="ttc" id="astruct_a_v_filter_link_html_a08e3e25929bb29d5f6ef768343ff7f57"><div class="ttname"><a href="struct_a_v_filter_link.html#a08e3e25929bb29d5f6ef768343ff7f57">AVFilterLink::w</a></div><div class="ttdeci">int w</div><div class="ttdoc">agreed upon image width</div><div class="ttdef"><b>Definition:</b> <a href="avfilter_8h_source.html#l00481">avfilter.h:481</a></div></div>
<div class="ttc" id="astruct_deshake_open_c_l_context_html_ad524792607e91fe68042dbe400d0a4de"><div class="ttname"><a href="struct_deshake_open_c_l_context.html#ad524792607e91fe68042dbe400d0a4de">DeshakeOpenCLContext::alfg</a></div><div class="ttdeci">AVLFG alfg</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00210">vf_deshake_opencl.c:210</a></div></div>
<div class="ttc" id="avf__deshake__opencl_8c_html_aa906eb01e76896e3890b54fecddc8ffc"><div class="ttname"><a href="vf__deshake__opencl_8c.html#aa906eb01e76896e3890b54fecddc8ffc">BREIFN</a></div><div class="ttdeci">#define BREIFN</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00087">vf_deshake_opencl.c:87</a></div></div>
<div class="ttc" id="astruct_deshake_open_c_l_context_html_a8f9da09912ebcdbb1bc59a5d75f74e86"><div class="ttname"><a href="struct_deshake_open_c_l_context.html#a8f9da09912ebcdbb1bc59a5d75f74e86">DeshakeOpenCLContext::smooth_window_multiplier</a></div><div class="ttdeci">float smooth_window_multiplier</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00291">vf_deshake_opencl.c:291</a></div></div>
<div class="ttc" id="astruct_deshake_open_c_l_context_html_af31e5026ce59c775a51e5f65d46c3931"><div class="ttname"><a href="struct_deshake_open_c_l_context.html#af31e5026ce59c775a51e5f65d46c3931">DeshakeOpenCLContext::inliers</a></div><div class="ttdeci">MotionVector * inliers</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00243">vf_deshake_opencl.c:243</a></div></div>
<div class="ttc" id="astruct_a_v_filter_context_html_ab0858b4059e67889c7f27c5cc9e258eb"><div class="ttname"><a href="struct_a_v_filter_context.html#ab0858b4059e67889c7f27c5cc9e258eb">AVFilterContext::priv</a></div><div class="ttdeci">void * priv</div><div class="ttdoc">private data for use by the filter</div><div class="ttdef"><b>Definition:</b> <a href="avfilter_8h_source.html#l00356">avfilter.h:356</a></div></div>
<div class="ttc" id="astruct_debug_matches_html_a1445bdc06f80d04a082a8ca170665b93"><div class="ttname"><a href="struct_debug_matches.html#a1445bdc06f80d04a082a8ca170665b93">DebugMatches::num_model_matches</a></div><div class="ttdeci">int num_model_matches</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00130">vf_deshake_opencl.c:130</a></div></div>
<div class="ttc" id="avf__deshake__opencl_8c_html_a00885c773e3a47ac0abf8ada377685dc"><div class="ttname"><a href="vf__deshake__opencl_8c.html#a00885c773e3a47ac0abf8ada377685dc">optimize_model</a></div><div class="ttdeci">static void optimize_model(DeshakeOpenCLContext *deshake_ctx, MotionVector *best_pairs, MotionVector *inliers, const int num_inliers, float best_err, double *model_out)</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00610">vf_deshake_opencl.c:610</a></div></div>
<div class="ttc" id="astruct_iter_indices_html_ae39d58c5950929136c2422c6617a041d"><div class="ttname"><a href="struct_iter_indices.html#ae39d58c5950929136c2422c6617a041d">IterIndices::start</a></div><div class="ttdeci">int start</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00196">vf_deshake_opencl.c:196</a></div></div>
<div class="ttc" id="aopencl_8c_html_ad0424e96c8176309c6743fd1a8b84bdc"><div class="ttname"><a href="opencl_8c.html#ad0424e96c8176309c6743fd1a8b84bdc">ff_opencl_filter_query_formats</a></div><div class="ttdeci">int ff_opencl_filter_query_formats(AVFilterContext *avctx)</div><div class="ttdef"><b>Definition:</b> <a href="opencl_8c_source.html#l00028">opencl.c:28</a></div></div>
<div class="ttc" id="avf__deshake__opencl_8c_html_a29f077a9126bf10d4893bb1750c36c91"><div class="ttname"><a href="vf__deshake__opencl_8c.html#a29f077a9126bf10d4893bb1750c36c91">decompose_transform</a></div><div class="ttdeci">static FrameDelta decompose_transform(double *model)</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00747">vf_deshake_opencl.c:747</a></div></div>
<div class="ttc" id="astruct_deshake_open_c_l_context_html_ac220506f512606ac340a1c006b242d9c"><div class="ttname"><a href="struct_deshake_open_c_l_context.html#ac220506f512606ac340a1c006b242d9c">DeshakeOpenCLContext::debug_matches</a></div><div class="ttdeci">cl_mem debug_matches</div><div class="ttdef"><b>Definition:</b> <a href="vf__deshake__opencl_8c_source.html#l00296">vf_deshake_opencl.c:296</a></div></div>
<div class="ttc" id="acast5_8c_html_a0e9ed946a7660c126bbd39b503794ef7"><div class="ttname"><a href="cast5_8c.html#a0e9ed946a7660c126bbd39b503794ef7">F1</a></div><div class="ttdeci">#define F1(l, r, i)</div><div class="ttdef"><b>Definition:</b> <a href="cast5_8c_source.html#l00047">cast5.c:47</a></div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.8.20
</small></address>
</body>
</html>
