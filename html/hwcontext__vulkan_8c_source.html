<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>My Project: E:/github/ffmpeg/libavutil/hwcontext_vulkan.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">My Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_737c44b861ba7ee498141742fb455fa8.html">ffmpeg</a></li><li class="navelem"><a class="el" href="dir_d766145af7397866e2c8608f9b7b90ce.html">libavutil</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">hwcontext_vulkan.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="hwcontext__vulkan_8c.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> * This file is part of FFmpeg.</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> * FFmpeg is free software; you can redistribute it and/or</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> * modify it under the terms of the GNU Lesser General Public</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> * License as published by the Free Software Foundation; either</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> * version 2.1 of the License, or (at your option) any later version.</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> * FFmpeg is distributed in the hope that it will be useful,</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> * Lesser General Public License for more details.</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"> * You should have received a copy of the GNU Lesser General Public</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"> * License along with FFmpeg; if not, write to the Free Software</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"> * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160; </div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#include &quot;config.h&quot;</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="pixdesc_8h.html">pixdesc.h</a>&quot;</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="avstring_8h.html">avstring.h</a>&quot;</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="imgutils_8h.html">imgutils.h</a>&quot;</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="hwcontext_8h.html">hwcontext.h</a>&quot;</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="hwcontext__internal_8h.html">hwcontext_internal.h</a>&quot;</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="hwcontext__vulkan_8h.html">hwcontext_vulkan.h</a>&quot;</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160; </div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#if CONFIG_LIBDRM</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#include &lt;unistd.h&gt;</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#include &lt;xf86drm.h&gt;</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#include &lt;drm_fourcc.h&gt;</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="hwcontext__drm_8h.html">hwcontext_drm.h</a>&quot;</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#if CONFIG_VAAPI</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor">#include &lt;va/va_drmcommon.h&gt;</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="hwcontext__vaapi_8h.html">hwcontext_vaapi.h</a>&quot;</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160; </div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="preprocessor">#if CONFIG_CUDA</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="hwcontext__cuda__internal_8h.html">hwcontext_cuda_internal.h</a>&quot;</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="cuda__check_8h.html">cuda_check.h</a>&quot;</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="preprocessor">#define CHECK_CU(x) FF_CUDA_CHECK_DL(cuda_cu, cu, x)</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160; </div>
<div class="line"><a name="l00044"></a><span class="lineno"><a class="line" href="struct_vulkan_queue_ctx.html">   44</a></span>&#160;<span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="struct_vulkan_queue_ctx.html">VulkanQueueCtx</a> {</div>
<div class="line"><a name="l00045"></a><span class="lineno"><a class="line" href="struct_vulkan_queue_ctx.html#a0235250212cf181a69d5a89b27e7f9b2">   45</a></span>&#160;    VkFence <a class="code" href="struct_vulkan_queue_ctx.html#a0235250212cf181a69d5a89b27e7f9b2">fence</a>;</div>
<div class="line"><a name="l00046"></a><span class="lineno"><a class="line" href="struct_vulkan_queue_ctx.html#a6fc206cde8912427b37eebfa5cae659a">   46</a></span>&#160;    VkQueue <a class="code" href="struct_vulkan_queue_ctx.html#a6fc206cde8912427b37eebfa5cae659a">queue</a>;</div>
<div class="line"><a name="l00047"></a><span class="lineno"><a class="line" href="struct_vulkan_queue_ctx.html#ab75c31fe085f99dc7193f8c7674ea69b">   47</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="struct_vulkan_queue_ctx.html#ab75c31fe085f99dc7193f8c7674ea69b">was_synchronous</a>;</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160; </div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    <span class="comment">/* Buffer dependencies */</span></div>
<div class="line"><a name="l00050"></a><span class="lineno"><a class="line" href="struct_vulkan_queue_ctx.html#a1f21f90d4f4cfd8e8b7c381258a8d88d">   50</a></span>&#160;    <a class="code" href="struct_a_v_buffer_ref.html">AVBufferRef</a> **<a class="code" href="struct_vulkan_queue_ctx.html#a1f21f90d4f4cfd8e8b7c381258a8d88d">buf_deps</a>;</div>
<div class="line"><a name="l00051"></a><span class="lineno"><a class="line" href="struct_vulkan_queue_ctx.html#a65ce96bd602e35abbdc0e69677e23fd3">   51</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="struct_vulkan_queue_ctx.html#a65ce96bd602e35abbdc0e69677e23fd3">nb_buf_deps</a>;</div>
<div class="line"><a name="l00052"></a><span class="lineno"><a class="line" href="struct_vulkan_queue_ctx.html#a67052152ec8f1bdfb4be3c56f07447e4">   52</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="struct_vulkan_queue_ctx.html#a67052152ec8f1bdfb4be3c56f07447e4">buf_deps_alloc_size</a>;</div>
<div class="line"><a name="l00053"></a><span class="lineno"><a class="line" href="hwcontext__vulkan_8c.html#a4a588bd57da8107f10f0a0fcf623351f">   53</a></span>&#160;} <a class="code" href="hwcontext__vulkan_8c.html#a4a588bd57da8107f10f0a0fcf623351f">VulkanQueueCtx</a>;</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160; </div>
<div class="line"><a name="l00055"></a><span class="lineno"><a class="line" href="struct_vulkan_exec_ctx.html">   55</a></span>&#160;<span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="struct_vulkan_exec_ctx.html">VulkanExecCtx</a> {</div>
<div class="line"><a name="l00056"></a><span class="lineno"><a class="line" href="struct_vulkan_exec_ctx.html#a83f8db5f77669ac659bb6569bb4eef4f">   56</a></span>&#160;    VkCommandPool <a class="code" href="struct_vulkan_exec_ctx.html#a83f8db5f77669ac659bb6569bb4eef4f">pool</a>;</div>
<div class="line"><a name="l00057"></a><span class="lineno"><a class="line" href="struct_vulkan_exec_ctx.html#acee0bf4f2264075d3eeefedc29c58b53">   57</a></span>&#160;    VkCommandBuffer *<a class="code" href="struct_vulkan_exec_ctx.html#acee0bf4f2264075d3eeefedc29c58b53">bufs</a>;</div>
<div class="line"><a name="l00058"></a><span class="lineno"><a class="line" href="struct_vulkan_exec_ctx.html#ad467710035a59f14d1c6544cd60912e2">   58</a></span>&#160;    <a class="code" href="struct_vulkan_queue_ctx.html">VulkanQueueCtx</a> *<a class="code" href="struct_vulkan_exec_ctx.html#ad467710035a59f14d1c6544cd60912e2">queues</a>;</div>
<div class="line"><a name="l00059"></a><span class="lineno"><a class="line" href="struct_vulkan_exec_ctx.html#a2947aa835fe688e37d446fb6be093b25">   59</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="struct_vulkan_exec_ctx.html#a2947aa835fe688e37d446fb6be093b25">nb_queues</a>;</div>
<div class="line"><a name="l00060"></a><span class="lineno"><a class="line" href="struct_vulkan_exec_ctx.html#ac2a4fc7e6372cfc350905f539a37ab36">   60</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="struct_vulkan_exec_ctx.html#ac2a4fc7e6372cfc350905f539a37ab36">cur_queue_idx</a>;</div>
<div class="line"><a name="l00061"></a><span class="lineno"><a class="line" href="hwcontext__vulkan_8c.html#a201c5c9114b6443ce63a0e7662a4b36e">   61</a></span>&#160;} <a class="code" href="hwcontext__vulkan_8c.html#a201c5c9114b6443ce63a0e7662a4b36e">VulkanExecCtx</a>;</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160; </div>
<div class="line"><a name="l00063"></a><span class="lineno"><a class="line" href="struct_vulkan_device_priv.html">   63</a></span>&#160;<span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="struct_vulkan_device_priv.html">VulkanDevicePriv</a> {</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    <span class="comment">/* Properties */</span></div>
<div class="line"><a name="l00065"></a><span class="lineno"><a class="line" href="struct_vulkan_device_priv.html#a93919fc0c25c1a74251fc14bccc70188">   65</a></span>&#160;    VkPhysicalDeviceProperties2 <a class="code" href="struct_vulkan_device_priv.html#a93919fc0c25c1a74251fc14bccc70188">props</a>;</div>
<div class="line"><a name="l00066"></a><span class="lineno"><a class="line" href="struct_vulkan_device_priv.html#a69a23c1466b2c96396f30ba67410f51e">   66</a></span>&#160;    VkPhysicalDeviceMemoryProperties <a class="code" href="struct_vulkan_device_priv.html#a69a23c1466b2c96396f30ba67410f51e">mprops</a>;</div>
<div class="line"><a name="l00067"></a><span class="lineno"><a class="line" href="struct_vulkan_device_priv.html#a7a17ab5ea90b05229be6b998d7010327">   67</a></span>&#160;    VkPhysicalDeviceExternalMemoryHostPropertiesEXT <a class="code" href="struct_vulkan_device_priv.html#a7a17ab5ea90b05229be6b998d7010327">hprops</a>;</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160; </div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <span class="comment">/* Queues */</span></div>
<div class="line"><a name="l00070"></a><span class="lineno"><a class="line" href="struct_vulkan_device_priv.html#a753f96a767abb4f8a8b92aff3cbfb5e4">   70</a></span>&#160;    uint32_t <a class="code" href="struct_vulkan_device_priv.html#a753f96a767abb4f8a8b92aff3cbfb5e4">qfs</a>[3];</div>
<div class="line"><a name="l00071"></a><span class="lineno"><a class="line" href="struct_vulkan_device_priv.html#a90b5a426b5114eca5015d387b7288e07">   71</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="struct_vulkan_device_priv.html#a90b5a426b5114eca5015d387b7288e07">num_qfs</a>;</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160; </div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    <span class="comment">/* Debug callback */</span></div>
<div class="line"><a name="l00074"></a><span class="lineno"><a class="line" href="struct_vulkan_device_priv.html#aa95fb956d32713a16c1874fcaad18f2e">   74</a></span>&#160;    VkDebugUtilsMessengerEXT <a class="code" href="struct_vulkan_device_priv.html#aa95fb956d32713a16c1874fcaad18f2e">debug_ctx</a>;</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160; </div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    <span class="comment">/* Extensions */</span></div>
<div class="line"><a name="l00077"></a><span class="lineno"><a class="line" href="struct_vulkan_device_priv.html#a895a041d77f8253cb0842c23e54593f2">   77</a></span>&#160;    uint64_t <a class="code" href="struct_vulkan_device_priv.html#a895a041d77f8253cb0842c23e54593f2">extensions</a>;</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160; </div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    <span class="comment">/* Settings */</span></div>
<div class="line"><a name="l00080"></a><span class="lineno"><a class="line" href="struct_vulkan_device_priv.html#a456ab09798ca379b6534a172a9245dba">   80</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="struct_vulkan_device_priv.html#a456ab09798ca379b6534a172a9245dba">use_linear_images</a>;</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160; </div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    <span class="comment">/* Nvidia */</span></div>
<div class="line"><a name="l00083"></a><span class="lineno"><a class="line" href="struct_vulkan_device_priv.html#a1cdadbcb5d3249c2b7873dd538c18794">   83</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="struct_vulkan_device_priv.html#a1cdadbcb5d3249c2b7873dd538c18794">dev_is_nvidia</a>;</div>
<div class="line"><a name="l00084"></a><span class="lineno"><a class="line" href="hwcontext__vulkan_8c.html#a5f0c7a8e1af12cc8bf2652dc30c219bd">   84</a></span>&#160;} <a class="code" href="hwcontext__vulkan_8c.html#a5f0c7a8e1af12cc8bf2652dc30c219bd">VulkanDevicePriv</a>;</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160; </div>
<div class="line"><a name="l00086"></a><span class="lineno"><a class="line" href="struct_vulkan_frames_priv.html">   86</a></span>&#160;<span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="struct_vulkan_frames_priv.html">VulkanFramesPriv</a> {</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <span class="comment">/* Image conversions */</span></div>
<div class="line"><a name="l00088"></a><span class="lineno"><a class="line" href="struct_vulkan_frames_priv.html#a718e58f35681599327c47525888792ac">   88</a></span>&#160;    <a class="code" href="struct_vulkan_exec_ctx.html">VulkanExecCtx</a> <a class="code" href="struct_vulkan_frames_priv.html#a718e58f35681599327c47525888792ac">conv_ctx</a>;</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160; </div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    <span class="comment">/* Image transfers */</span></div>
<div class="line"><a name="l00091"></a><span class="lineno"><a class="line" href="struct_vulkan_frames_priv.html#a9756b08f0899fa9fcd16ee9a57061875">   91</a></span>&#160;    <a class="code" href="struct_vulkan_exec_ctx.html">VulkanExecCtx</a> <a class="code" href="struct_vulkan_frames_priv.html#a9756b08f0899fa9fcd16ee9a57061875">upload_ctx</a>;</div>
<div class="line"><a name="l00092"></a><span class="lineno"><a class="line" href="hwcontext__vulkan_8c.html#ab482f514ab017799e2ac45d666537564">   92</a></span>&#160;    <a class="code" href="struct_vulkan_exec_ctx.html">VulkanExecCtx</a> <a class="code" href="struct_vulkan_frames_priv.html#a376d8b4245677718bd2682839e2d4de1">download_ctx</a>;</div>
<div class="line"><a name="l00093"></a><span class="lineno"><a class="line" href="hwcontext__vulkan_8c.html#a22fadc076ea559115af8b3adde63b276">   93</a></span>&#160;} <a class="code" href="hwcontext__vulkan_8c.html#a22fadc076ea559115af8b3adde63b276">VulkanFramesPriv</a>;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160; </div>
<div class="line"><a name="l00095"></a><span class="lineno"><a class="line" href="struct_a_v_vk_frame_internal.html">   95</a></span>&#160;<span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="struct_a_v_vk_frame_internal.html">AVVkFrameInternal</a> {</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="preprocessor">#if CONFIG_CUDA</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    <span class="comment">/* Importing external memory into cuda is really expensive so we keep the</span></div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="comment">     * memory imported all the time */</span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    <a class="code" href="struct_a_v_buffer_ref.html">AVBufferRef</a> *cuda_fc_ref; <span class="comment">/* Need to keep it around for uninit */</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    CUexternalMemory ext_mem[<a class="code" href="frame_8h.html#add80189702cf0f5ea82718576fb43201">AV_NUM_DATA_POINTERS</a>];</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    CUmipmappedArray cu_mma[<a class="code" href="frame_8h.html#add80189702cf0f5ea82718576fb43201">AV_NUM_DATA_POINTERS</a>];</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    CUarray cu_array[<a class="code" href="frame_8h.html#add80189702cf0f5ea82718576fb43201">AV_NUM_DATA_POINTERS</a>];</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    CUexternalSemaphore cu_sem[<a class="code" href="frame_8h.html#add80189702cf0f5ea82718576fb43201">AV_NUM_DATA_POINTERS</a>];</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00105"></a><span class="lineno"><a class="line" href="hwcontext__vulkan_8c.html#ac5a7d789e9a765a8575799d50a0f39e4">  105</a></span>&#160;} <a class="code" href="hwcontext__vulkan_8c.html#ac5a7d789e9a765a8575799d50a0f39e4">AVVkFrameInternal</a>;</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160; </div>
<div class="line"><a name="l00107"></a><span class="lineno"><a class="line" href="hwcontext__vulkan_8c.html#abee363c2a4179bacdf2706a5969c949a">  107</a></span>&#160;<span class="preprocessor">#define GET_QUEUE_COUNT(hwctx, graph, comp, tx) (                   \</span></div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="preprocessor">    graph ?  hwctx-&gt;nb_graphics_queues :                            \</span></div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="preprocessor">    comp  ? (hwctx-&gt;nb_comp_queues ?                                \</span></div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="preprocessor">             hwctx-&gt;nb_comp_queues : hwctx-&gt;nb_graphics_queues) :   \</span></div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="preprocessor">    tx    ? (hwctx-&gt;nb_tx_queues ? hwctx-&gt;nb_tx_queues :            \</span></div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="preprocessor">             (hwctx-&gt;nb_comp_queues ?                               \</span></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="preprocessor">              hwctx-&gt;nb_comp_queues : hwctx-&gt;nb_graphics_queues)) : \</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="preprocessor">    0                                                               \</span></div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="preprocessor">)</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160; </div>
<div class="line"><a name="l00117"></a><span class="lineno"><a class="line" href="hwcontext__vulkan_8c.html#acc25b1e67c50a452aa1965aaca0acf88">  117</a></span>&#160;<span class="preprocessor">#define VK_LOAD_PFN(inst, name) PFN_##name pfn_##name = (PFN_##name)           \</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="preprocessor">                                              vkGetInstanceProcAddr(inst, #name)</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160; </div>
<div class="line"><a name="l00120"></a><span class="lineno"><a class="line" href="hwcontext__vulkan_8c.html#afbcde1018fdc1e8bfca60ead7cf50191">  120</a></span>&#160;<span class="preprocessor">#define DEFAULT_USAGE_FLAGS (VK_IMAGE_USAGE_SAMPLED_BIT      |                 \</span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="preprocessor">                             VK_IMAGE_USAGE_STORAGE_BIT      |                 \</span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="preprocessor">                             VK_IMAGE_USAGE_TRANSFER_SRC_BIT |                 \</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="preprocessor">                             VK_IMAGE_USAGE_TRANSFER_DST_BIT)</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160; </div>
<div class="line"><a name="l00125"></a><span class="lineno"><a class="line" href="hwcontext__vulkan_8c.html#a5bee6da8a9536d7e905a366ca49b0abb">  125</a></span>&#160;<span class="preprocessor">#define ADD_VAL_TO_LIST(list, count, val)                                      \</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="preprocessor">    do {                                                                       \</span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;<span class="preprocessor">        list = av_realloc_array(list, sizeof(*list), ++count);                 \</span></div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="preprocessor">        if (!list) {                                                           \</span></div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="preprocessor">            err = AVERROR(ENOMEM);                                             \</span></div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="preprocessor">            goto fail;                                                         \</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="preprocessor">        }                                                                      \</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="preprocessor">        list[count - 1] = av_strdup(val);                                      \</span></div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="preprocessor">        if (!list[count - 1]) {                                                \</span></div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="preprocessor">            err = AVERROR(ENOMEM);                                             \</span></div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="preprocessor">            goto fail;                                                         \</span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="preprocessor">        }                                                                      \</span></div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;<span class="preprocessor">    } while(0)</span></div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160; </div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">struct </span>{</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    <span class="keyword">enum</span> <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5">AVPixelFormat</a> <a class="code" href="hwcontext__vulkan_8c.html#ab482f514ab017799e2ac45d666537564">pixfmt</a>;</div>
<div class="line"><a name="l00141"></a><span class="lineno"><a class="line" href="hwcontext__vulkan_8c.html#a2c95bc38a9d106e007afb65b5fcbb230">  141</a></span>&#160;    <span class="keyword">const</span> VkFormat <a class="code" href="hwcontext__vulkan_8c.html#a2c95bc38a9d106e007afb65b5fcbb230">vkfmts</a>[3];</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;} <a class="code" href="hwcontext__vulkan_8c.html#a72c7a0f881dcbb6bf1b88136ab995831">vk_pixfmt_map</a>[] = {</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    { <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a4616a6eaaf5419e2aa7dcb03031d500e">AV_PIX_FMT_GRAY8</a>,   { VK_FORMAT_R8_UNORM } },</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    { <a class="code" href="pixfmt_8h.html#ace4d36d981b86af5f0dc2d6429701684">AV_PIX_FMT_GRAY16</a>,  { VK_FORMAT_R16_UNORM } },</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    { <a class="code" href="pixfmt_8h.html#a934b37a072574ad04c2e7dab500e860a">AV_PIX_FMT_GRAYF32</a>, { VK_FORMAT_R32_SFLOAT } },</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160; </div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    { <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a0b271df0acd125218c1e365a0f754022">AV_PIX_FMT_NV12</a>, { VK_FORMAT_R8_UNORM, VK_FORMAT_R8G8_UNORM } },</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    { <a class="code" href="pixfmt_8h.html#a6265531cbe491ec34449e3769e545f1f">AV_PIX_FMT_P010</a>, { VK_FORMAT_R16_UNORM, VK_FORMAT_R16G16_UNORM } },</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    { <a class="code" href="pixfmt_8h.html#a6506505b35c1afd66c10cd537369cdd6">AV_PIX_FMT_P016</a>, { VK_FORMAT_R16_UNORM, VK_FORMAT_R16G16_UNORM } },</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160; </div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    { <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a1aa7677092740d8def31655b5d7f0cc2">AV_PIX_FMT_YUV420P</a>, { VK_FORMAT_R8_UNORM, VK_FORMAT_R8_UNORM, VK_FORMAT_R8_UNORM } },</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    { <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a332444d991855c9667b786f6f7bb6051">AV_PIX_FMT_YUV422P</a>, { VK_FORMAT_R8_UNORM, VK_FORMAT_R8_UNORM, VK_FORMAT_R8_UNORM } },</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    { <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a82034006e681cddbb7b1d5cb7045626a">AV_PIX_FMT_YUV444P</a>, { VK_FORMAT_R8_UNORM, VK_FORMAT_R8_UNORM, VK_FORMAT_R8_UNORM } },</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160; </div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    { <a class="code" href="pixfmt_8h.html#a0a2608337c1116f843a0155e7a574a4d">AV_PIX_FMT_YUV420P16</a>, { VK_FORMAT_R16_UNORM, VK_FORMAT_R16_UNORM, VK_FORMAT_R16_UNORM } },</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    { <a class="code" href="pixfmt_8h.html#ac9e00af924c2f96085b44642b1fbc076">AV_PIX_FMT_YUV422P16</a>, { VK_FORMAT_R16_UNORM, VK_FORMAT_R16_UNORM, VK_FORMAT_R16_UNORM } },</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    { <a class="code" href="pixfmt_8h.html#ae7920607c5cf9a219cc94b5c7efc457d">AV_PIX_FMT_YUV444P16</a>, { VK_FORMAT_R16_UNORM, VK_FORMAT_R16_UNORM, VK_FORMAT_R16_UNORM } },</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160; </div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    { <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a5110926011394bc4f6066145314a5330">AV_PIX_FMT_ABGR</a>,   { VK_FORMAT_A8B8G8R8_UNORM_PACK32 } },</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    { <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a41c64e3682529dd5caca6f7d5d3c19c7">AV_PIX_FMT_BGRA</a>,   { VK_FORMAT_B8G8R8A8_UNORM } },</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    { <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a7ffbd399b88a48196e3cba416eec4dac">AV_PIX_FMT_RGBA</a>,   { VK_FORMAT_R8G8B8A8_UNORM } },</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    { <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a107eadfcfe8c9fc751289eeb7744a6d3">AV_PIX_FMT_RGB24</a>,  { VK_FORMAT_R8G8B8_UNORM } },</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    { <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5acc582ddd3f60d4cd3ddffb48116fb154">AV_PIX_FMT_BGR24</a>,  { VK_FORMAT_B8G8R8_UNORM } },</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    { <a class="code" href="pixfmt_8h.html#a8aa3ddf224cba014fb9eac404498046a">AV_PIX_FMT_RGB48</a>,  { VK_FORMAT_R16G16B16_UNORM } },</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    { <a class="code" href="pixfmt_8h.html#a79f0cce2e796a9e51f75fea1695c9160">AV_PIX_FMT_RGBA64</a>, { VK_FORMAT_R16G16B16A16_UNORM } },</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    { <a class="code" href="pixfmt_8h.html#ac006ecccd336ce7280ef0155568ebfb6">AV_PIX_FMT_RGB565</a>, { VK_FORMAT_R5G6B5_UNORM_PACK16 } },</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    { <a class="code" href="pixfmt_8h.html#ab0749a06130381634569b1cb479cab79">AV_PIX_FMT_BGR565</a>, { VK_FORMAT_B5G6R5_UNORM_PACK16 } },</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    { <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a258e7e59a7f956604b743c14032906b0">AV_PIX_FMT_BGR0</a>,   { VK_FORMAT_B8G8R8A8_UNORM } },</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    { <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a698dbf894ce405d3775c6cf440debf65">AV_PIX_FMT_0BGR</a>,   { VK_FORMAT_A8B8G8R8_UNORM_PACK32 } },</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    { <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5ab9fcc01ba1689d75e4bc2080a347e1d0">AV_PIX_FMT_RGB0</a>,   { VK_FORMAT_R8G8B8A8_UNORM } },</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160; </div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    { <a class="code" href="pixfmt_8h.html#a0a627303cd665a88b342c29f6bc89c8c">AV_PIX_FMT_GBRPF32</a>, { VK_FORMAT_R32_SFLOAT, VK_FORMAT_R32_SFLOAT, VK_FORMAT_R32_SFLOAT } },</div>
<div class="line"><a name="l00173"></a><span class="lineno"><a class="line" href="hwcontext__vulkan_8c.html#a72c7a0f881dcbb6bf1b88136ab995831">  173</a></span>&#160;};</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160; </div>
<div class="line"><a name="l00175"></a><span class="lineno"><a class="line" href="hwcontext__vulkan_8h.html#ac3dce3efdada0dab3fd7fca01e374871">  175</a></span>&#160;<span class="keyword">const</span> VkFormat *<a class="code" href="hwcontext__vulkan_8c.html#ac3dce3efdada0dab3fd7fca01e374871">av_vkfmt_from_pixfmt</a>(<span class="keyword">enum</span> <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5">AVPixelFormat</a> p)</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;{</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">enum</span> <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5">AVPixelFormat</a> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="sinewin__tablegen__template_8c.html#a3508a98d3ee7e2c9a4841fe264cf70f7">FF_ARRAY_ELEMS</a>(<a class="code" href="hwcontext__vulkan_8c.html#a72c7a0f881dcbb6bf1b88136ab995831">vk_pixfmt_map</a>); <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="hwcontext__vulkan_8c.html#a72c7a0f881dcbb6bf1b88136ab995831">vk_pixfmt_map</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="hwcontext__vulkan_8c.html#ab482f514ab017799e2ac45d666537564">pixfmt</a> == p)</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="hwcontext__vulkan_8c.html#a72c7a0f881dcbb6bf1b88136ab995831">vk_pixfmt_map</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].vkfmts;</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;}</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160; </div>
<div class="line"><a name="l00183"></a><span class="lineno"><a class="line" href="hwcontext__vulkan_8c.html#ad0bb1569b556eddc44f41df7c1b70937">  183</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="hwcontext__vulkan_8c.html#ad0bb1569b556eddc44f41df7c1b70937">pixfmt_is_supported</a>(<a class="code" href="struct_a_v_vulkan_device_context.html">AVVulkanDeviceContext</a> *hwctx, <span class="keyword">enum</span> <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5">AVPixelFormat</a> p,</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;                               <span class="keywordtype">int</span> <a class="code" href="interplayacm_8c.html#a552efe53b811f3855f53f59129cf34af">linear</a>)</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;{</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    <span class="keyword">const</span> VkFormat *fmt = <a class="code" href="hwcontext__vulkan_8c.html#ac3dce3efdada0dab3fd7fca01e374871">av_vkfmt_from_pixfmt</a>(p);</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="llviddspenc_8c.html#a39de7029a33bc3271ae437de0a38c343">planes</a> = <a class="code" href="pixdesc_8c.html#a118df1d607abd7484f874b3d7ea8823a">av_pix_fmt_count_planes</a>(p);</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160; </div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    <span class="keywordflow">if</span> (!fmt)</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160; </div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="llviddspenc_8c.html#a39de7029a33bc3271ae437de0a38c343">planes</a>; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;        VkFormatFeatureFlags <a class="code" href="cbs__av1_8c.html#a67119bce106892b6dade1dc5aa405ac9">flags</a>;</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;        VkFormatProperties2 prop = {</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;            .sType = VK_STRUCTURE_TYPE_FORMAT_PROPERTIES_2,</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;        };</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;        vkGetPhysicalDeviceFormatProperties2(hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a154f2a1f99a153cdb9a801b2504d6637">phys_dev</a>, fmt[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>], &amp;prop);</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;        <a class="code" href="cbs__av1_8c.html#a67119bce106892b6dade1dc5aa405ac9">flags</a> = <a class="code" href="interplayacm_8c.html#a552efe53b811f3855f53f59129cf34af">linear</a> ? prop.formatProperties.linearTilingFeatures :</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;                         prop.formatProperties.optimalTilingFeatures;</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;        <span class="keywordflow">if</span> (!(<a class="code" href="cbs__av1_8c.html#a67119bce106892b6dade1dc5aa405ac9">flags</a> &amp; <a class="code" href="hwcontext__vulkan_8c.html#afbcde1018fdc1e8bfca60ead7cf50191">DEFAULT_USAGE_FLAGS</a>))</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;            <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    }</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160; </div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;}</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160; </div>
<div class="line"><a name="l00207"></a><span class="lineno"><a class="line" href="hwcontext__vulkan_8c.html#adfa9f1974c8c5348db6b4034e3aa7b4e">  207</a></span>&#160;<span class="keyword">enum</span> <a class="code" href="hwcontext__vulkan_8c.html#adfa9f1974c8c5348db6b4034e3aa7b4e">VulkanExtensions</a> {</div>
<div class="line"><a name="l00208"></a><span class="lineno"><a class="line" href="hwcontext__vulkan_8c.html#adfa9f1974c8c5348db6b4034e3aa7b4ead055cca16ae2cf28b4e1ab34de136147">  208</a></span>&#160;    <a class="code" href="hwcontext__vulkan_8c.html#adfa9f1974c8c5348db6b4034e3aa7b4ead055cca16ae2cf28b4e1ab34de136147">EXT_EXTERNAL_DMABUF_MEMORY</a> = 1ULL &lt;&lt;  0, <span class="comment">/* VK_EXT_external_memory_dma_buf */</span></div>
<div class="line"><a name="l00209"></a><span class="lineno"><a class="line" href="hwcontext__vulkan_8c.html#adfa9f1974c8c5348db6b4034e3aa7b4eac76edadb3f30757d5ba92676482f578a">  209</a></span>&#160;    <a class="code" href="hwcontext__vulkan_8c.html#adfa9f1974c8c5348db6b4034e3aa7b4eac76edadb3f30757d5ba92676482f578a">EXT_DRM_MODIFIER_FLAGS</a>     = 1ULL &lt;&lt;  1, <span class="comment">/* VK_EXT_image_drm_format_modifier */</span></div>
<div class="line"><a name="l00210"></a><span class="lineno"><a class="line" href="hwcontext__vulkan_8c.html#adfa9f1974c8c5348db6b4034e3aa7b4ea498c8e07b8e37d27d1ce7bc1e4e9e4f7">  210</a></span>&#160;    <a class="code" href="hwcontext__vulkan_8c.html#adfa9f1974c8c5348db6b4034e3aa7b4ea498c8e07b8e37d27d1ce7bc1e4e9e4f7">EXT_EXTERNAL_FD_MEMORY</a>     = 1ULL &lt;&lt;  2, <span class="comment">/* VK_KHR_external_memory_fd */</span></div>
<div class="line"><a name="l00211"></a><span class="lineno"><a class="line" href="hwcontext__vulkan_8c.html#adfa9f1974c8c5348db6b4034e3aa7b4eaeeeb9df365a55ef16cfca45352cf84c4">  211</a></span>&#160;    <a class="code" href="hwcontext__vulkan_8c.html#adfa9f1974c8c5348db6b4034e3aa7b4eaeeeb9df365a55ef16cfca45352cf84c4">EXT_EXTERNAL_FD_SEM</a>        = 1ULL &lt;&lt;  3, <span class="comment">/* VK_KHR_external_semaphore_fd */</span></div>
<div class="line"><a name="l00212"></a><span class="lineno"><a class="line" href="hwcontext__vulkan_8c.html#adfa9f1974c8c5348db6b4034e3aa7b4ea2c5db237d3d2464a020222e5a328c9df">  212</a></span>&#160;    <a class="code" href="hwcontext__vulkan_8c.html#adfa9f1974c8c5348db6b4034e3aa7b4ea2c5db237d3d2464a020222e5a328c9df">EXT_EXTERNAL_HOST_MEMORY</a>   = 1ULL &lt;&lt;  4, <span class="comment">/* VK_EXT_external_memory_host */</span></div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160; </div>
<div class="line"><a name="l00214"></a><span class="lineno"><a class="line" href="hwcontext__vulkan_8c.html#adfa9f1974c8c5348db6b4034e3aa7b4eadce24ee642ce4f5e0dcd9921d44eae64">  214</a></span>&#160;    <a class="code" href="hwcontext__vulkan_8c.html#adfa9f1974c8c5348db6b4034e3aa7b4eadce24ee642ce4f5e0dcd9921d44eae64">EXT_NO_FLAG</a>                = 1ULL &lt;&lt; 63,</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;};</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160; </div>
<div class="line"><a name="l00217"></a><span class="lineno"><a class="line" href="struct_vulkan_opt_extension.html">  217</a></span>&#160;<span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="struct_vulkan_opt_extension.html">VulkanOptExtension</a> {</div>
<div class="line"><a name="l00218"></a><span class="lineno"><a class="line" href="struct_vulkan_opt_extension.html#a3014adf868a1bb91d76e8ca0e78506e2">  218</a></span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="struct_vulkan_opt_extension.html#a3014adf868a1bb91d76e8ca0e78506e2">name</a>;</div>
<div class="line"><a name="l00219"></a><span class="lineno"><a class="line" href="struct_vulkan_opt_extension.html#ac74c961b27b14719ec404146433c3651">  219</a></span>&#160;    uint64_t <a class="code" href="struct_vulkan_opt_extension.html#ac74c961b27b14719ec404146433c3651">flag</a>;</div>
<div class="line"><a name="l00220"></a><span class="lineno"><a class="line" href="hwcontext__vulkan_8c.html#a173b3a1190f9fb5fd5fcd4a0fb64d4c1">  220</a></span>&#160;} <a class="code" href="hwcontext__vulkan_8c.html#a173b3a1190f9fb5fd5fcd4a0fb64d4c1">VulkanOptExtension</a>;</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160; </div>
<div class="line"><a name="l00222"></a><span class="lineno"><a class="line" href="hwcontext__vulkan_8c.html#ad8f648073ec78aa454bb9892fdaba8fa">  222</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="struct_vulkan_opt_extension.html">VulkanOptExtension</a> <a class="code" href="hwcontext__vulkan_8c.html#ad8f648073ec78aa454bb9892fdaba8fa">optional_instance_exts</a>[] = {</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    <span class="comment">/* For future use */</span></div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;};</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160; </div>
<div class="line"><a name="l00226"></a><span class="lineno"><a class="line" href="hwcontext__vulkan_8c.html#af5612db90300a41736bc6573c96e900c">  226</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="struct_vulkan_opt_extension.html">VulkanOptExtension</a> <a class="code" href="hwcontext__vulkan_8c.html#af5612db90300a41736bc6573c96e900c">optional_device_exts</a>[] = {</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    { VK_KHR_EXTERNAL_MEMORY_FD_EXTENSION_NAME,               <a class="code" href="hwcontext__vulkan_8c.html#adfa9f1974c8c5348db6b4034e3aa7b4ea498c8e07b8e37d27d1ce7bc1e4e9e4f7">EXT_EXTERNAL_FD_MEMORY</a>,     },</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    { VK_EXT_EXTERNAL_MEMORY_DMA_BUF_EXTENSION_NAME,          <a class="code" href="hwcontext__vulkan_8c.html#adfa9f1974c8c5348db6b4034e3aa7b4ead055cca16ae2cf28b4e1ab34de136147">EXT_EXTERNAL_DMABUF_MEMORY</a>, },</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    { VK_EXT_IMAGE_DRM_FORMAT_MODIFIER_EXTENSION_NAME,        <a class="code" href="hwcontext__vulkan_8c.html#adfa9f1974c8c5348db6b4034e3aa7b4eac76edadb3f30757d5ba92676482f578a">EXT_DRM_MODIFIER_FLAGS</a>,     },</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    { VK_KHR_EXTERNAL_SEMAPHORE_FD_EXTENSION_NAME,            <a class="code" href="hwcontext__vulkan_8c.html#adfa9f1974c8c5348db6b4034e3aa7b4eaeeeb9df365a55ef16cfca45352cf84c4">EXT_EXTERNAL_FD_SEM</a>,        },</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    { VK_EXT_EXTERNAL_MEMORY_HOST_EXTENSION_NAME,             <a class="code" href="hwcontext__vulkan_8c.html#adfa9f1974c8c5348db6b4034e3aa7b4ea2c5db237d3d2464a020222e5a328c9df">EXT_EXTERNAL_HOST_MEMORY</a>,   },</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;};</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160; </div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<span class="comment">/* Converts return values to strings */</span></div>
<div class="line"><a name="l00235"></a><span class="lineno"><a class="line" href="hwcontext__vulkan_8c.html#ab4395598042453295899a91b26ad013b">  235</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="hwcontext__vulkan_8c.html#ab4395598042453295899a91b26ad013b">vk_ret2str</a>(VkResult res)</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;{</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;<span class="preprocessor">#define CASE(VAL) case VAL: return #VAL</span></div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    <span class="keywordflow">switch</span> (res) {</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    <a class="code" href="hwcontext__vulkan_8c.html#a12d922a26bb56fefdaeb3731d7edab73">CASE</a>(VK_SUCCESS);</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    <a class="code" href="hwcontext__vulkan_8c.html#a12d922a26bb56fefdaeb3731d7edab73">CASE</a>(VK_NOT_READY);</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    <a class="code" href="hwcontext__vulkan_8c.html#a12d922a26bb56fefdaeb3731d7edab73">CASE</a>(VK_TIMEOUT);</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    <a class="code" href="hwcontext__vulkan_8c.html#a12d922a26bb56fefdaeb3731d7edab73">CASE</a>(VK_EVENT_SET);</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    <a class="code" href="hwcontext__vulkan_8c.html#a12d922a26bb56fefdaeb3731d7edab73">CASE</a>(VK_EVENT_RESET);</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    <a class="code" href="hwcontext__vulkan_8c.html#a12d922a26bb56fefdaeb3731d7edab73">CASE</a>(VK_INCOMPLETE);</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    <a class="code" href="hwcontext__vulkan_8c.html#a12d922a26bb56fefdaeb3731d7edab73">CASE</a>(VK_ERROR_OUT_OF_HOST_MEMORY);</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    <a class="code" href="hwcontext__vulkan_8c.html#a12d922a26bb56fefdaeb3731d7edab73">CASE</a>(VK_ERROR_OUT_OF_DEVICE_MEMORY);</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    <a class="code" href="hwcontext__vulkan_8c.html#a12d922a26bb56fefdaeb3731d7edab73">CASE</a>(VK_ERROR_INITIALIZATION_FAILED);</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    <a class="code" href="hwcontext__vulkan_8c.html#a12d922a26bb56fefdaeb3731d7edab73">CASE</a>(VK_ERROR_DEVICE_LOST);</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    <a class="code" href="hwcontext__vulkan_8c.html#a12d922a26bb56fefdaeb3731d7edab73">CASE</a>(VK_ERROR_MEMORY_MAP_FAILED);</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    <a class="code" href="hwcontext__vulkan_8c.html#a12d922a26bb56fefdaeb3731d7edab73">CASE</a>(VK_ERROR_LAYER_NOT_PRESENT);</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    <a class="code" href="hwcontext__vulkan_8c.html#a12d922a26bb56fefdaeb3731d7edab73">CASE</a>(VK_ERROR_EXTENSION_NOT_PRESENT);</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    <a class="code" href="hwcontext__vulkan_8c.html#a12d922a26bb56fefdaeb3731d7edab73">CASE</a>(VK_ERROR_FEATURE_NOT_PRESENT);</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    <a class="code" href="hwcontext__vulkan_8c.html#a12d922a26bb56fefdaeb3731d7edab73">CASE</a>(VK_ERROR_INCOMPATIBLE_DRIVER);</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    <a class="code" href="hwcontext__vulkan_8c.html#a12d922a26bb56fefdaeb3731d7edab73">CASE</a>(VK_ERROR_TOO_MANY_OBJECTS);</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    <a class="code" href="hwcontext__vulkan_8c.html#a12d922a26bb56fefdaeb3731d7edab73">CASE</a>(VK_ERROR_FORMAT_NOT_SUPPORTED);</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    <a class="code" href="hwcontext__vulkan_8c.html#a12d922a26bb56fefdaeb3731d7edab73">CASE</a>(VK_ERROR_FRAGMENTED_POOL);</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    <a class="code" href="hwcontext__vulkan_8c.html#a12d922a26bb56fefdaeb3731d7edab73">CASE</a>(VK_ERROR_SURFACE_LOST_KHR);</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    <a class="code" href="hwcontext__vulkan_8c.html#a12d922a26bb56fefdaeb3731d7edab73">CASE</a>(VK_ERROR_NATIVE_WINDOW_IN_USE_KHR);</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    <a class="code" href="hwcontext__vulkan_8c.html#a12d922a26bb56fefdaeb3731d7edab73">CASE</a>(VK_SUBOPTIMAL_KHR);</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    <a class="code" href="hwcontext__vulkan_8c.html#a12d922a26bb56fefdaeb3731d7edab73">CASE</a>(VK_ERROR_OUT_OF_DATE_KHR);</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    <a class="code" href="hwcontext__vulkan_8c.html#a12d922a26bb56fefdaeb3731d7edab73">CASE</a>(VK_ERROR_INCOMPATIBLE_DISPLAY_KHR);</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    <a class="code" href="hwcontext__vulkan_8c.html#a12d922a26bb56fefdaeb3731d7edab73">CASE</a>(VK_ERROR_VALIDATION_FAILED_EXT);</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    <a class="code" href="hwcontext__vulkan_8c.html#a12d922a26bb56fefdaeb3731d7edab73">CASE</a>(VK_ERROR_INVALID_SHADER_NV);</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    <a class="code" href="hwcontext__vulkan_8c.html#a12d922a26bb56fefdaeb3731d7edab73">CASE</a>(VK_ERROR_OUT_OF_POOL_MEMORY);</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    <a class="code" href="hwcontext__vulkan_8c.html#a12d922a26bb56fefdaeb3731d7edab73">CASE</a>(VK_ERROR_INVALID_EXTERNAL_HANDLE);</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    <a class="code" href="hwcontext__vulkan_8c.html#a12d922a26bb56fefdaeb3731d7edab73">CASE</a>(VK_ERROR_NOT_PERMITTED_EXT);</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    <a class="code" href="hwcontext__vulkan_8c.html#a12d922a26bb56fefdaeb3731d7edab73">CASE</a>(VK_ERROR_INVALID_DRM_FORMAT_MODIFIER_PLANE_LAYOUT_EXT);</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    <a class="code" href="hwcontext__vulkan_8c.html#a12d922a26bb56fefdaeb3731d7edab73">CASE</a>(VK_ERROR_INVALID_DEVICE_ADDRESS_EXT);</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    <a class="code" href="hwcontext__vulkan_8c.html#a12d922a26bb56fefdaeb3731d7edab73">CASE</a>(VK_ERROR_FULL_SCREEN_EXCLUSIVE_MODE_LOST_EXT);</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    <span class="keywordflow">default</span>: <span class="keywordflow">return</span> <span class="stringliteral">&quot;Unknown error&quot;</span>;</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    }</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;<span class="preprocessor">#undef CASE</span></div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;}</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160; </div>
<div class="line"><a name="l00275"></a><span class="lineno"><a class="line" href="hwcontext__vulkan_8c.html#a9d87f944e7bd755011ce1a492d2d6754">  275</a></span>&#160;<span class="keyword">static</span> VkBool32 <a class="code" href="hwcontext__vulkan_8c.html#a9d87f944e7bd755011ce1a492d2d6754">vk_dbg_callback</a>(VkDebugUtilsMessageSeverityFlagBitsEXT severity,</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;                                VkDebugUtilsMessageTypeFlagsEXT messageType,</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;                                <span class="keyword">const</span> VkDebugUtilsMessengerCallbackDataEXT *<a class="code" href="mxf_8c.html#a084824fc871e38157790c99ae1240842">data</a>,</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;                                <span class="keywordtype">void</span> *priv)</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;{</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    <span class="keywordtype">int</span> l;</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    <a class="code" href="struct_a_v_h_w_device_context.html">AVHWDeviceContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a> = priv;</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160; </div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;    <span class="keywordflow">switch</span> (severity) {</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    <span class="keywordflow">case</span> VK_DEBUG_UTILS_MESSAGE_SEVERITY_VERBOSE_BIT_EXT: l = <a class="code" href="group__lavu__log__constants.html#ga9b58b28e2d429b930b69db19877f76a8">AV_LOG_VERBOSE</a>; <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    <span class="keywordflow">case</span> VK_DEBUG_UTILS_MESSAGE_SEVERITY_INFO_BIT_EXT:    l = <a class="code" href="group__lavu__log__constants.html#gad172eacfed8653e454c6fdcbe53baab3">AV_LOG_INFO</a>;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    <span class="keywordflow">case</span> VK_DEBUG_UTILS_MESSAGE_SEVERITY_WARNING_BIT_EXT: l = <a class="code" href="group__lavu__log__constants.html#ga85b57516ca703cc47d9bbe5f4658c716">AV_LOG_WARNING</a>; <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    <span class="keywordflow">case</span> VK_DEBUG_UTILS_MESSAGE_SEVERITY_ERROR_BIT_EXT:   l = <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>;   <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    <span class="keywordflow">default</span>:                                              l = <a class="code" href="group__lavu__log__constants.html#ga5b7221c3afd06848486776bd834a58a5">AV_LOG_DEBUG</a>;   <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    }</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160; </div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, l, <span class="stringliteral">&quot;%s\n&quot;</span>, <a class="code" href="mxf_8c.html#a084824fc871e38157790c99ae1240842">data</a>-&gt;pMessage);</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="mxf_8c.html#a084824fc871e38157790c99ae1240842">data</a>-&gt;cmdBufLabelCount; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, l, <span class="stringliteral">&quot;\t%i: %s\n&quot;</span>, <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="code" href="mxf_8c.html#a084824fc871e38157790c99ae1240842">data</a>-&gt;pCmdBufLabels[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].pLabelName);</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160; </div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;}</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160; </div>
<div class="line"><a name="l00298"></a><span class="lineno"><a class="line" href="hwcontext__vulkan_8c.html#a64891fa46e2b44b3e1667d354c9028ae">  298</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="hwcontext__vulkan_8c.html#a64891fa46e2b44b3e1667d354c9028ae">check_extensions</a>(<a class="code" href="struct_a_v_h_w_device_context.html">AVHWDeviceContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, <span class="keywordtype">int</span> dev, <a class="code" href="struct_a_v_dictionary.html">AVDictionary</a> *<a class="code" href="tests_2movenc_8c.html#af540b728145b614e34c4e10930354b93">opts</a>,</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;                            <span class="keyword">const</span> <span class="keywordtype">char</span> * <span class="keyword">const</span> **dst, uint32_t *num, <span class="keywordtype">int</span> debug)</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;{</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *tstr;</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> **extension_names = <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    <a class="code" href="struct_vulkan_device_priv.html">VulkanDevicePriv</a> *p = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;<a class="code" href="struct_a_v_format_context.html#a8a8bec51da36db65ff864f88a85805d9">internal</a>-&gt;priv;</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    <a class="code" href="struct_a_v_vulkan_device_context.html">AVVulkanDeviceContext</a> *hwctx = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;hwctx;</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    <span class="keywordtype">int</span> err = 0, found, extensions_found = 0;</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160; </div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="vf__v360_8c.html#af712be1a84bfcf29a5914cde089b4047">mod</a>;</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    <span class="keywordtype">int</span> optional_exts_num;</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    uint32_t sup_ext_count;</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    <span class="keywordtype">char</span> *user_exts_str = <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    <a class="code" href="struct_a_v_dictionary_entry.html">AVDictionaryEntry</a> *user_exts;</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    VkExtensionProperties *sup_ext;</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    <span class="keyword">const</span> <a class="code" href="struct_vulkan_opt_extension.html">VulkanOptExtension</a> *optional_exts;</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160; </div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    <span class="keywordflow">if</span> (!dev) {</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;        <a class="code" href="vf__v360_8c.html#af712be1a84bfcf29a5914cde089b4047">mod</a> = <span class="stringliteral">&quot;instance&quot;</span>;</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;        optional_exts = <a class="code" href="hwcontext__vulkan_8c.html#ad8f648073ec78aa454bb9892fdaba8fa">optional_instance_exts</a>;</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;        optional_exts_num = <a class="code" href="sinewin__tablegen__template_8c.html#a3508a98d3ee7e2c9a4841fe264cf70f7">FF_ARRAY_ELEMS</a>(<a class="code" href="hwcontext__vulkan_8c.html#ad8f648073ec78aa454bb9892fdaba8fa">optional_instance_exts</a>);</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;        user_exts = <a class="code" href="group__lavu__dict.html#gae67f143237b2cb2936c9b147aa6dfde3">av_dict_get</a>(<a class="code" href="tests_2movenc_8c.html#af540b728145b614e34c4e10930354b93">opts</a>, <span class="stringliteral">&quot;instance_extensions&quot;</span>, <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0);</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;        <span class="keywordflow">if</span> (user_exts) {</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;            user_exts_str = <a class="code" href="group__lavu__mem__funcs.html#ga7c352f4cff02184f005323691375fea9">av_strdup</a>(user_exts-&gt;<a class="code" href="struct_a_v_dictionary_entry.html#aa38678f2cad36f120d42e56449c5edb4">value</a>);</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;            <span class="keywordflow">if</span> (!user_exts_str) {</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;                err = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;                <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;            }</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;        }</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;        vkEnumerateInstanceExtensionProperties(<a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, &amp;sup_ext_count, <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;        sup_ext = <a class="code" href="mem_8c.html#a254f3455439c15a2c8a75b8f0235fdbd">av_malloc_array</a>(sup_ext_count, <span class="keyword">sizeof</span>(VkExtensionProperties));</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;        <span class="keywordflow">if</span> (!sup_ext)</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;        vkEnumerateInstanceExtensionProperties(<a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, &amp;sup_ext_count, sup_ext);</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;        <a class="code" href="vf__v360_8c.html#af712be1a84bfcf29a5914cde089b4047">mod</a> = <span class="stringliteral">&quot;device&quot;</span>;</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;        optional_exts = <a class="code" href="hwcontext__vulkan_8c.html#af5612db90300a41736bc6573c96e900c">optional_device_exts</a>;</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;        optional_exts_num = <a class="code" href="sinewin__tablegen__template_8c.html#a3508a98d3ee7e2c9a4841fe264cf70f7">FF_ARRAY_ELEMS</a>(<a class="code" href="hwcontext__vulkan_8c.html#af5612db90300a41736bc6573c96e900c">optional_device_exts</a>);</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;        user_exts = <a class="code" href="group__lavu__dict.html#gae67f143237b2cb2936c9b147aa6dfde3">av_dict_get</a>(<a class="code" href="tests_2movenc_8c.html#af540b728145b614e34c4e10930354b93">opts</a>, <span class="stringliteral">&quot;device_extensions&quot;</span>, <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0);</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;        <span class="keywordflow">if</span> (user_exts) {</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;            user_exts_str = <a class="code" href="group__lavu__mem__funcs.html#ga7c352f4cff02184f005323691375fea9">av_strdup</a>(user_exts-&gt;<a class="code" href="struct_a_v_dictionary_entry.html#aa38678f2cad36f120d42e56449c5edb4">value</a>);</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;            <span class="keywordflow">if</span> (!user_exts_str) {</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;                err = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;                <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;            }</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;        }</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;        vkEnumerateDeviceExtensionProperties(hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a154f2a1f99a153cdb9a801b2504d6637">phys_dev</a>, <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;                                             &amp;sup_ext_count, <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;        sup_ext = <a class="code" href="mem_8c.html#a254f3455439c15a2c8a75b8f0235fdbd">av_malloc_array</a>(sup_ext_count, <span class="keyword">sizeof</span>(VkExtensionProperties));</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;        <span class="keywordflow">if</span> (!sup_ext)</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;        vkEnumerateDeviceExtensionProperties(hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a154f2a1f99a153cdb9a801b2504d6637">phys_dev</a>, <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;                                             &amp;sup_ext_count, sup_ext);</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    }</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160; </div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; optional_exts_num; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;        tstr = optional_exts[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="struct_vulkan_opt_extension.html#a3014adf868a1bb91d76e8ca0e78506e2">name</a>;</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;        found = 0;</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; sup_ext_count; j++) {</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;            <span class="keywordflow">if</span> (!strcmp(tstr, sup_ext[j].extensionName)) {</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;                found = 1;</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;            }</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;        }</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;        <span class="keywordflow">if</span> (!found)</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160; </div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, <a class="code" href="group__lavu__log__constants.html#ga9b58b28e2d429b930b69db19877f76a8">AV_LOG_VERBOSE</a>, <span class="stringliteral">&quot;Using %s extension \&quot;%s\&quot;\n&quot;</span>, <a class="code" href="vf__v360_8c.html#af712be1a84bfcf29a5914cde089b4047">mod</a>, tstr);</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;        p-&gt;<a class="code" href="struct_vulkan_device_priv.html#a895a041d77f8253cb0842c23e54593f2">extensions</a> |= optional_exts[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="struct_vulkan_opt_extension.html#ac74c961b27b14719ec404146433c3651">flag</a>;</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;        <a class="code" href="hwcontext__vulkan_8c.html#a5bee6da8a9536d7e905a366ca49b0abb">ADD_VAL_TO_LIST</a>(extension_names, extensions_found, tstr);</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;    }</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160; </div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    <span class="keywordflow">if</span> (debug &amp;&amp; !dev) {</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;        tstr = VK_EXT_DEBUG_UTILS_EXTENSION_NAME;</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;        found = 0;</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; sup_ext_count; j++) {</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;            <span class="keywordflow">if</span> (!strcmp(tstr, sup_ext[j].extensionName)) {</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;                found = 1;</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;            }</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;        }</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;        <span class="keywordflow">if</span> (found) {</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, <a class="code" href="group__lavu__log__constants.html#ga9b58b28e2d429b930b69db19877f76a8">AV_LOG_VERBOSE</a>, <span class="stringliteral">&quot;Using %s extension \&quot;%s\&quot;\n&quot;</span>, <a class="code" href="vf__v360_8c.html#af712be1a84bfcf29a5914cde089b4047">mod</a>, tstr);</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;            <a class="code" href="hwcontext__vulkan_8c.html#a5bee6da8a9536d7e905a366ca49b0abb">ADD_VAL_TO_LIST</a>(extension_names, extensions_found, tstr);</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Debug extension \&quot;%s\&quot; not found!\n&quot;</span>,</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;                   tstr);</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;            err = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EINVAL);</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;            <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;        }</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;    }</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160; </div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    <span class="keywordflow">if</span> (user_exts_str) {</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;        <span class="keywordtype">char</span> *save, *token = <a class="code" href="group__lavu__string.html#ga3d4270f4ed651c414e2850090b9b77c4">av_strtok</a>(user_exts_str, <span class="stringliteral">&quot;+&quot;</span>, &amp;save);</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;        <span class="keywordflow">while</span> (token) {</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;            found = 0;</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; sup_ext_count; j++) {</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;                <span class="keywordflow">if</span> (!strcmp(token, sup_ext[j].extensionName)) {</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;                    found = 1;</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;                }</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;            }</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;            <span class="keywordflow">if</span> (found) {</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;                <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, <a class="code" href="group__lavu__log__constants.html#ga9b58b28e2d429b930b69db19877f76a8">AV_LOG_VERBOSE</a>, <span class="stringliteral">&quot;Using %s extension \&quot;%s\&quot;\n&quot;</span>, <a class="code" href="vf__v360_8c.html#af712be1a84bfcf29a5914cde089b4047">mod</a>, token);</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;                <a class="code" href="hwcontext__vulkan_8c.html#a5bee6da8a9536d7e905a366ca49b0abb">ADD_VAL_TO_LIST</a>(extension_names, extensions_found, token);</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;                <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, <a class="code" href="group__lavu__log__constants.html#ga85b57516ca703cc47d9bbe5f4658c716">AV_LOG_WARNING</a>, <span class="stringliteral">&quot;%s extension \&quot;%s\&quot; not found, excluding.\n&quot;</span>,</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;                       <a class="code" href="vf__v360_8c.html#af712be1a84bfcf29a5914cde089b4047">mod</a>, token);</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;            }</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;            token = <a class="code" href="group__lavu__string.html#ga3d4270f4ed651c414e2850090b9b77c4">av_strtok</a>(<a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="stringliteral">&quot;+&quot;</span>, &amp;save);</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;        }</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    }</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160; </div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    *dst = extension_names;</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;    *num = extensions_found;</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160; </div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#a079eab092887563f2bef9106c6120089">av_free</a>(user_exts_str);</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#a079eab092887563f2bef9106c6120089">av_free</a>(sup_ext);</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160; </div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;<a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>:</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;    <span class="keywordflow">if</span> (extension_names)</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; extensions_found; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#a079eab092887563f2bef9106c6120089">av_free</a>((<span class="keywordtype">void</span> *)extension_names[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#a079eab092887563f2bef9106c6120089">av_free</a>(extension_names);</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#a079eab092887563f2bef9106c6120089">av_free</a>(user_exts_str);</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#a079eab092887563f2bef9106c6120089">av_free</a>(sup_ext);</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;}</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160; </div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;<span class="comment">/* Creates a VkInstance */</span></div>
<div class="line"><a name="l00429"></a><span class="lineno"><a class="line" href="hwcontext__vulkan_8c.html#a459a21f7cefa1c26fb62002a20e251b7">  429</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="hwcontext__vulkan_8c.html#a459a21f7cefa1c26fb62002a20e251b7">create_instance</a>(<a class="code" href="struct_a_v_h_w_device_context.html">AVHWDeviceContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, <a class="code" href="struct_a_v_dictionary.html">AVDictionary</a> *<a class="code" href="tests_2movenc_8c.html#af540b728145b614e34c4e10930354b93">opts</a>)</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;{</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    <span class="keywordtype">int</span> err = 0;</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    VkResult <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>;</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    <a class="code" href="struct_vulkan_device_priv.html">VulkanDevicePriv</a> *p = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;<a class="code" href="struct_a_v_format_context.html#a8a8bec51da36db65ff864f88a85805d9">internal</a>-&gt;priv;</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    <a class="code" href="struct_a_v_vulkan_device_context.html">AVVulkanDeviceContext</a> *hwctx = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;hwctx;</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;    <a class="code" href="struct_a_v_dictionary_entry.html">AVDictionaryEntry</a> *debug_opt = <a class="code" href="group__lavu__dict.html#gae67f143237b2cb2936c9b147aa6dfde3">av_dict_get</a>(<a class="code" href="tests_2movenc_8c.html#af540b728145b614e34c4e10930354b93">opts</a>, <span class="stringliteral">&quot;debug&quot;</span>, <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0);</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> debug_mode = debug_opt &amp;&amp; strtol(debug_opt-&gt;<a class="code" href="struct_a_v_dictionary_entry.html#aa38678f2cad36f120d42e56449c5edb4">value</a>, <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 10);</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;    VkApplicationInfo application_info = {</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;        .sType              = VK_STRUCTURE_TYPE_APPLICATION_INFO,</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;        .pEngineName        = <span class="stringliteral">&quot;libavutil&quot;</span>,</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;        .apiVersion         = VK_API_VERSION_1_1,</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;        .engineVersion      = VK_MAKE_VERSION(<a class="code" href="group__lavu__ver.html#gaa29a3ad3376b8050d9ef4779045f745e">LIBAVUTIL_VERSION_MAJOR</a>,</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;                                              <a class="code" href="group__lavu__ver.html#ga9848c90e4ea707cb0732db0de569452a">LIBAVUTIL_VERSION_MINOR</a>,</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;                                              <a class="code" href="group__lavu__ver.html#gad5484c7f1208de134ba538874d2c04fd">LIBAVUTIL_VERSION_MICRO</a>),</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;    };</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    VkInstanceCreateInfo inst_props = {</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;        .sType            = VK_STRUCTURE_TYPE_INSTANCE_CREATE_INFO,</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;        .pApplicationInfo = &amp;application_info,</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    };</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160; </div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    <span class="comment">/* Check for present/missing extensions */</span></div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    err = <a class="code" href="hwcontext__vulkan_8c.html#a64891fa46e2b44b3e1667d354c9028ae">check_extensions</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, 0, <a class="code" href="tests_2movenc_8c.html#af540b728145b614e34c4e10930354b93">opts</a>, &amp;inst_props.ppEnabledExtensionNames,</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;                           &amp;inst_props.enabledExtensionCount, debug_mode);</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    <span class="keywordflow">if</span> (err &lt; 0)</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;        <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160; </div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;    <span class="keywordflow">if</span> (debug_mode) {</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;        <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *layers[] = { <span class="stringliteral">&quot;VK_LAYER_KHRONOS_validation&quot;</span> };</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;        inst_props.ppEnabledLayerNames = layers;</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;        inst_props.enabledLayerCount = <a class="code" href="sinewin__tablegen__template_8c.html#a3508a98d3ee7e2c9a4841fe264cf70f7">FF_ARRAY_ELEMS</a>(layers);</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;    }</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160; </div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;    <span class="comment">/* Try to create the instance */</span></div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = vkCreateInstance(&amp;inst_props, hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a4a617020274526c26e265781aefcd22c">alloc</a>, &amp;hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#abb0e7a4336731e84eb1b25571635d243">inst</a>);</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160; </div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;    <span class="comment">/* Check for errors */</span></div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> != VK_SUCCESS) {</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Instance creation failure: %s\n&quot;</span>,</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;               <a class="code" href="hwcontext__vulkan_8c.html#ab4395598042453295899a91b26ad013b">vk_ret2str</a>(<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>));</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; inst_props.enabledExtensionCount; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#a079eab092887563f2bef9106c6120089">av_free</a>((<span class="keywordtype">void</span> *)inst_props.ppEnabledExtensionNames[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#a079eab092887563f2bef9106c6120089">av_free</a>((<span class="keywordtype">void</span> *)inst_props.ppEnabledExtensionNames);</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="group__lavu__error.html#ga9c520e483ba8648495620ffdb4c491f2">AVERROR_EXTERNAL</a>;</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    }</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160; </div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    <span class="keywordflow">if</span> (debug_mode) {</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;        VkDebugUtilsMessengerCreateInfoEXT dbg = {</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;            .sType = VK_STRUCTURE_TYPE_DEBUG_UTILS_MESSENGER_CREATE_INFO_EXT,</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;            .messageSeverity = VK_DEBUG_UTILS_MESSAGE_SEVERITY_VERBOSE_BIT_EXT |</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;                               VK_DEBUG_UTILS_MESSAGE_SEVERITY_INFO_BIT_EXT    |</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;                               VK_DEBUG_UTILS_MESSAGE_SEVERITY_WARNING_BIT_EXT |</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;                               VK_DEBUG_UTILS_MESSAGE_SEVERITY_ERROR_BIT_EXT,</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;            .messageType = VK_DEBUG_UTILS_MESSAGE_TYPE_GENERAL_BIT_EXT    |</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;                           VK_DEBUG_UTILS_MESSAGE_TYPE_VALIDATION_BIT_EXT |</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;                           VK_DEBUG_UTILS_MESSAGE_TYPE_PERFORMANCE_BIT_EXT,</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;            .pfnUserCallback = <a class="code" href="hwcontext__vulkan_8c.html#a9d87f944e7bd755011ce1a492d2d6754">vk_dbg_callback</a>,</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;            .pUserData = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>,</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;        };</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;        <a class="code" href="hwcontext__vulkan_8c.html#acc25b1e67c50a452aa1965aaca0acf88">VK_LOAD_PFN</a>(hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#abb0e7a4336731e84eb1b25571635d243">inst</a>, vkCreateDebugUtilsMessengerEXT);</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160; </div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;        pfn_vkCreateDebugUtilsMessengerEXT(hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#abb0e7a4336731e84eb1b25571635d243">inst</a>, &amp;dbg,</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;                                           hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a4a617020274526c26e265781aefcd22c">alloc</a>, &amp;p-&gt;<a class="code" href="struct_vulkan_device_priv.html#aa95fb956d32713a16c1874fcaad18f2e">debug_ctx</a>);</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;    }</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160; </div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;    hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a8d68b5373defea792ad340e698d9b409">enabled_inst_extensions</a> = inst_props.ppEnabledExtensionNames;</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;    hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a371a0b0216b2e8a56cecbc1e496c04d5">nb_enabled_inst_extensions</a> = inst_props.enabledExtensionCount;</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160; </div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;}</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160; </div>
<div class="line"><a name="l00500"></a><span class="lineno"><a class="line" href="struct_vulkan_device_selection.html">  500</a></span>&#160;<span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="struct_vulkan_device_selection.html">VulkanDeviceSelection</a> {</div>
<div class="line"><a name="l00501"></a><span class="lineno"><a class="line" href="struct_vulkan_device_selection.html#a54ed0b03971571644c78c16d6b667378">  501</a></span>&#160;    <a class="code" href="audio__convert_8c.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> <a class="code" href="struct_vulkan_device_selection.html#a54ed0b03971571644c78c16d6b667378">uuid</a>[VK_UUID_SIZE]; <span class="comment">/* Will use this first unless !has_uuid */</span></div>
<div class="line"><a name="l00502"></a><span class="lineno"><a class="line" href="struct_vulkan_device_selection.html#af92cca9ef38a16fc40df91fe56ea1cb1">  502</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="struct_vulkan_device_selection.html#af92cca9ef38a16fc40df91fe56ea1cb1">has_uuid</a>;</div>
<div class="line"><a name="l00503"></a><span class="lineno"><a class="line" href="struct_vulkan_device_selection.html#a9b5f385cc4254f561c938df960227a01">  503</a></span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="struct_vulkan_device_selection.html#a9b5f385cc4254f561c938df960227a01">name</a>; <span class="comment">/* Will use this second unless NULL */</span></div>
<div class="line"><a name="l00504"></a><span class="lineno"><a class="line" href="struct_vulkan_device_selection.html#aa98f77aebfa3ac887f58b9a781d27848">  504</a></span>&#160;    uint32_t <a class="code" href="struct_vulkan_device_selection.html#aa98f77aebfa3ac887f58b9a781d27848">pci_device</a>; <span class="comment">/* Will use this third unless 0x0 */</span></div>
<div class="line"><a name="l00505"></a><span class="lineno"><a class="line" href="struct_vulkan_device_selection.html#a00c84ad57cd25ebf2384a055d6fc5959">  505</a></span>&#160;    uint32_t <a class="code" href="struct_vulkan_device_selection.html#a00c84ad57cd25ebf2384a055d6fc5959">vendor_id</a>; <span class="comment">/* Last resort to find something deterministic */</span></div>
<div class="line"><a name="l00506"></a><span class="lineno"><a class="line" href="struct_vulkan_device_selection.html#a55e3a84ddb9faa07c308fc4d5acd8046">  506</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="struct_vulkan_device_selection.html#a55e3a84ddb9faa07c308fc4d5acd8046">index</a>; <span class="comment">/* Finally fall back to index */</span></div>
<div class="line"><a name="l00507"></a><span class="lineno"><a class="line" href="hwcontext__vulkan_8c.html#a3d954a40a07e0386b08db15860a0d4fc">  507</a></span>&#160;} <a class="code" href="hwcontext__vulkan_8c.html#a3d954a40a07e0386b08db15860a0d4fc">VulkanDeviceSelection</a>;</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160; </div>
<div class="line"><a name="l00509"></a><span class="lineno"><a class="line" href="hwcontext__vulkan_8c.html#ab53825bc22709ed0fa2dde67ad0e7ffe">  509</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="hwcontext__vulkan_8c.html#ab53825bc22709ed0fa2dde67ad0e7ffe">vk_dev_type</a>(<span class="keyword">enum</span> VkPhysicalDeviceType <a class="code" href="writing__filters_8txt.html#a860450fba1f740387dc082792ad89517">type</a>)</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;{</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;    <span class="keywordflow">switch</span> (<a class="code" href="writing__filters_8txt.html#a860450fba1f740387dc082792ad89517">type</a>) {</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;    <span class="keywordflow">case</span> VK_PHYSICAL_DEVICE_TYPE_INTEGRATED_GPU: <span class="keywordflow">return</span> <span class="stringliteral">&quot;integrated&quot;</span>;</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;    <span class="keywordflow">case</span> VK_PHYSICAL_DEVICE_TYPE_DISCRETE_GPU:   <span class="keywordflow">return</span> <span class="stringliteral">&quot;discrete&quot;</span>;</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;    <span class="keywordflow">case</span> VK_PHYSICAL_DEVICE_TYPE_VIRTUAL_GPU:    <span class="keywordflow">return</span> <span class="stringliteral">&quot;virtual&quot;</span>;</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;    <span class="keywordflow">case</span> VK_PHYSICAL_DEVICE_TYPE_CPU:            <span class="keywordflow">return</span> <span class="stringliteral">&quot;software&quot;</span>;</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;    <span class="keywordflow">default</span>:                                     <span class="keywordflow">return</span> <span class="stringliteral">&quot;unknown&quot;</span>;</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;    }</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;}</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160; </div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;<span class="comment">/* Finds a device */</span></div>
<div class="line"><a name="l00521"></a><span class="lineno"><a class="line" href="hwcontext__vulkan_8c.html#a57b768eebd26861b5e548b6b230d9f30">  521</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="hwcontext__vulkan_8c.html#a57b768eebd26861b5e548b6b230d9f30">find_device</a>(<a class="code" href="struct_a_v_h_w_device_context.html">AVHWDeviceContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, <a class="code" href="struct_vulkan_device_selection.html">VulkanDeviceSelection</a> *select)</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;{</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;    <span class="keywordtype">int</span> err = 0, choice = -1;</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;    uint32_t num;</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;    VkResult <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>;</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;    VkPhysicalDevice *devices = <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;    VkPhysicalDeviceIDProperties *idp = <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;    VkPhysicalDeviceProperties2 *prop = <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;    <a class="code" href="struct_a_v_vulkan_device_context.html">AVVulkanDeviceContext</a> *hwctx = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;hwctx;</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160; </div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;    <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = vkEnumeratePhysicalDevices(hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#abb0e7a4336731e84eb1b25571635d243">inst</a>, &amp;num, <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> != VK_SUCCESS || !num) {</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;No devices found: %s!\n&quot;</span>, <a class="code" href="hwcontext__vulkan_8c.html#ab4395598042453295899a91b26ad013b">vk_ret2str</a>(<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>));</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENODEV);</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;    }</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160; </div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;    devices = <a class="code" href="mem_8c.html#a254f3455439c15a2c8a75b8f0235fdbd">av_malloc_array</a>(num, <span class="keyword">sizeof</span>(VkPhysicalDevice));</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;    <span class="keywordflow">if</span> (!devices)</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160; </div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;    <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = vkEnumeratePhysicalDevices(hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#abb0e7a4336731e84eb1b25571635d243">inst</a>, &amp;num, devices);</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> != VK_SUCCESS) {</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Failed enumerating devices: %s\n&quot;</span>,</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;               <a class="code" href="hwcontext__vulkan_8c.html#ab4395598042453295899a91b26ad013b">vk_ret2str</a>(<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>));</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;        err = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENODEV);</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="avrndec_8c.html#a13191ba45577b1d4f9b37d64df91eb55">end</a>;</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;    }</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160; </div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;    prop = <a class="code" href="mem_8c.html#aedc3761897b7e9ea8ae1222b3d013c94">av_mallocz_array</a>(num, <span class="keyword">sizeof</span>(*prop));</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;    <span class="keywordflow">if</span> (!prop) {</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;        err = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="avrndec_8c.html#a13191ba45577b1d4f9b37d64df91eb55">end</a>;</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;    }</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160; </div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;    idp = <a class="code" href="mem_8c.html#aedc3761897b7e9ea8ae1222b3d013c94">av_mallocz_array</a>(num, <span class="keyword">sizeof</span>(*idp));</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;    <span class="keywordflow">if</span> (!idp) {</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;        err = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="avrndec_8c.html#a13191ba45577b1d4f9b37d64df91eb55">end</a>;</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;    }</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160; </div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, <a class="code" href="group__lavu__log__constants.html#ga9b58b28e2d429b930b69db19877f76a8">AV_LOG_VERBOSE</a>, <span class="stringliteral">&quot;GPU listing:\n&quot;</span>);</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; num; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;        idp[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].sType = VK_STRUCTURE_TYPE_PHYSICAL_DEVICE_ID_PROPERTIES;</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;        prop[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].sType = VK_STRUCTURE_TYPE_PHYSICAL_DEVICE_PROPERTIES_2;</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;        prop[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].pNext = &amp;idp[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160; </div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;        vkGetPhysicalDeviceProperties2(devices[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>], &amp;prop[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, <a class="code" href="group__lavu__log__constants.html#ga9b58b28e2d429b930b69db19877f76a8">AV_LOG_VERBOSE</a>, <span class="stringliteral">&quot;    %d: %s (%s) (0x%x)\n&quot;</span>, <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>,</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;               prop[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].properties.deviceName,</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;               <a class="code" href="hwcontext__vulkan_8c.html#ab53825bc22709ed0fa2dde67ad0e7ffe">vk_dev_type</a>(prop[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].properties.deviceType),</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;               prop[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].properties.deviceID);</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;    }</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160; </div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;    <span class="keywordflow">if</span> (select-&gt;<a class="code" href="struct_vulkan_device_selection.html#af92cca9ef38a16fc40df91fe56ea1cb1">has_uuid</a>) {</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; num; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;            <span class="keywordflow">if</span> (!strncmp(idp[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].deviceUUID, select-&gt;<a class="code" href="struct_vulkan_device_selection.html#a54ed0b03971571644c78c16d6b667378">uuid</a>, VK_UUID_SIZE)) {</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;                choice = <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;                <span class="keywordflow">goto</span> <a class="code" href="avrndec_8c.html#a13191ba45577b1d4f9b37d64df91eb55">end</a>;</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;             }</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;        }</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to find device by given UUID!\n&quot;</span>);</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;        err = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENODEV);</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="avrndec_8c.html#a13191ba45577b1d4f9b37d64df91eb55">end</a>;</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (select-&gt;<a class="code" href="struct_vulkan_device_selection.html#a9b5f385cc4254f561c938df960227a01">name</a>) {</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, <a class="code" href="group__lavu__log__constants.html#ga9b58b28e2d429b930b69db19877f76a8">AV_LOG_VERBOSE</a>, <span class="stringliteral">&quot;Requested device: %s\n&quot;</span>, select-&gt;<a class="code" href="struct_vulkan_device_selection.html#a9b5f385cc4254f561c938df960227a01">name</a>);</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; num; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;            <span class="keywordflow">if</span> (strstr(prop[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].properties.deviceName, select-&gt;<a class="code" href="struct_vulkan_device_selection.html#a9b5f385cc4254f561c938df960227a01">name</a>)) {</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;                choice = <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;                <span class="keywordflow">goto</span> <a class="code" href="avrndec_8c.html#a13191ba45577b1d4f9b37d64df91eb55">end</a>;</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;             }</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;        }</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to find device \&quot;%s\&quot;!\n&quot;</span>,</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;               select-&gt;<a class="code" href="struct_vulkan_device_selection.html#a9b5f385cc4254f561c938df960227a01">name</a>);</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;        err = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENODEV);</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="avrndec_8c.html#a13191ba45577b1d4f9b37d64df91eb55">end</a>;</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (select-&gt;<a class="code" href="struct_vulkan_device_selection.html#aa98f77aebfa3ac887f58b9a781d27848">pci_device</a>) {</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, <a class="code" href="group__lavu__log__constants.html#ga9b58b28e2d429b930b69db19877f76a8">AV_LOG_VERBOSE</a>, <span class="stringliteral">&quot;Requested device: 0x%x\n&quot;</span>, select-&gt;<a class="code" href="struct_vulkan_device_selection.html#aa98f77aebfa3ac887f58b9a781d27848">pci_device</a>);</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; num; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;            <span class="keywordflow">if</span> (select-&gt;<a class="code" href="struct_vulkan_device_selection.html#aa98f77aebfa3ac887f58b9a781d27848">pci_device</a> == prop[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].properties.deviceID) {</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;                choice = <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;                <span class="keywordflow">goto</span> <a class="code" href="avrndec_8c.html#a13191ba45577b1d4f9b37d64df91eb55">end</a>;</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;            }</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;        }</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to find device with PCI ID 0x%x!\n&quot;</span>,</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;               select-&gt;<a class="code" href="struct_vulkan_device_selection.html#aa98f77aebfa3ac887f58b9a781d27848">pci_device</a>);</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;        err = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EINVAL);</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="avrndec_8c.html#a13191ba45577b1d4f9b37d64df91eb55">end</a>;</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (select-&gt;<a class="code" href="struct_vulkan_device_selection.html#a00c84ad57cd25ebf2384a055d6fc5959">vendor_id</a>) {</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, <a class="code" href="group__lavu__log__constants.html#ga9b58b28e2d429b930b69db19877f76a8">AV_LOG_VERBOSE</a>, <span class="stringliteral">&quot;Requested vendor: 0x%x\n&quot;</span>, select-&gt;<a class="code" href="struct_vulkan_device_selection.html#a00c84ad57cd25ebf2384a055d6fc5959">vendor_id</a>);</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; num; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;            <span class="keywordflow">if</span> (select-&gt;<a class="code" href="struct_vulkan_device_selection.html#a00c84ad57cd25ebf2384a055d6fc5959">vendor_id</a> == prop[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].properties.vendorID) {</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;                choice = <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;                <span class="keywordflow">goto</span> <a class="code" href="avrndec_8c.html#a13191ba45577b1d4f9b37d64df91eb55">end</a>;</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;            }</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;        }</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to find device with Vendor ID 0x%x!\n&quot;</span>,</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;               select-&gt;<a class="code" href="struct_vulkan_device_selection.html#a00c84ad57cd25ebf2384a055d6fc5959">vendor_id</a>);</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;        err = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENODEV);</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="avrndec_8c.html#a13191ba45577b1d4f9b37d64df91eb55">end</a>;</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;        <span class="keywordflow">if</span> (select-&gt;<a class="code" href="struct_vulkan_device_selection.html#a55e3a84ddb9faa07c308fc4d5acd8046">index</a> &lt; num) {</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;            choice = select-&gt;<a class="code" href="struct_vulkan_device_selection.html#a55e3a84ddb9faa07c308fc4d5acd8046">index</a>;</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;            <span class="keywordflow">goto</span> <a class="code" href="avrndec_8c.html#a13191ba45577b1d4f9b37d64df91eb55">end</a>;</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;        }</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to find device with index %i!\n&quot;</span>,</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;               select-&gt;<a class="code" href="struct_vulkan_device_selection.html#a55e3a84ddb9faa07c308fc4d5acd8046">index</a>);</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;        err = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENODEV);</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="avrndec_8c.html#a13191ba45577b1d4f9b37d64df91eb55">end</a>;</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;    }</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160; </div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;<a class="code" href="avrndec_8c.html#a13191ba45577b1d4f9b37d64df91eb55">end</a>:</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;    <span class="keywordflow">if</span> (choice &gt; -1)</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;        hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a154f2a1f99a153cdb9a801b2504d6637">phys_dev</a> = devices[choice];</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160; </div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#a079eab092887563f2bef9106c6120089">av_free</a>(devices);</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#a079eab092887563f2bef9106c6120089">av_free</a>(prop);</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#a079eab092887563f2bef9106c6120089">av_free</a>(idp);</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160; </div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;    <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;}</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160; </div>
<div class="line"><a name="l00642"></a><span class="lineno"><a class="line" href="hwcontext__vulkan_8c.html#a7265940524076da3611c08653214e578">  642</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="hwcontext__vulkan_8c.html#a7265940524076da3611c08653214e578">search_queue_families</a>(<a class="code" href="struct_a_v_h_w_device_context.html">AVHWDeviceContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, VkDeviceCreateInfo *cd)</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;{</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;    uint32_t num;</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;    <span class="keywordtype">float</span> *weights;</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;    VkQueueFamilyProperties *qs = <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;    <a class="code" href="struct_a_v_vulkan_device_context.html">AVVulkanDeviceContext</a> *hwctx = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;hwctx;</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;    <span class="keywordtype">int</span> graph_index = -1, comp_index = -1, tx_index = -1;</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;    VkDeviceQueueCreateInfo *pc = (VkDeviceQueueCreateInfo *)cd-&gt;pQueueCreateInfos;</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160; </div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;    <span class="comment">/* First get the number of queue families */</span></div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;    vkGetPhysicalDeviceQueueFamilyProperties(hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a154f2a1f99a153cdb9a801b2504d6637">phys_dev</a>, &amp;num, <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;    <span class="keywordflow">if</span> (!num) {</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to get queues!\n&quot;</span>);</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="group__lavu__error.html#ga9c520e483ba8648495620ffdb4c491f2">AVERROR_EXTERNAL</a>;</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;    }</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160; </div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;    <span class="comment">/* Then allocate memory */</span></div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;    qs = <a class="code" href="mem_8c.html#a254f3455439c15a2c8a75b8f0235fdbd">av_malloc_array</a>(num, <span class="keyword">sizeof</span>(VkQueueFamilyProperties));</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;    <span class="keywordflow">if</span> (!qs)</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160; </div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;    <span class="comment">/* Finally retrieve the queue families */</span></div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;    vkGetPhysicalDeviceQueueFamilyProperties(hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a154f2a1f99a153cdb9a801b2504d6637">phys_dev</a>, &amp;num, qs);</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160; </div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;<span class="preprocessor">#define SEARCH_FLAGS(expr, out)                                                \</span></div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;<span class="preprocessor">    for (int i = 0; i &lt; num; i++) {                                            \</span></div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;<span class="preprocessor">        const VkQueueFlagBits flags = qs[i].queueFlags;                        \</span></div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;<span class="preprocessor">        if (expr) {                                                            \</span></div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;<span class="preprocessor">            out = i;                                                           \</span></div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;<span class="preprocessor">            break;                                                             \</span></div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;<span class="preprocessor">        }                                                                      \</span></div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;<span class="preprocessor">    }</span></div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160; </div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;    <a class="code" href="hwcontext__vulkan_8c.html#a17625fb48ab3e129591594e4352a24aa">SEARCH_FLAGS</a>(<a class="code" href="cbs__av1_8c.html#a67119bce106892b6dade1dc5aa405ac9">flags</a> &amp; VK_QUEUE_GRAPHICS_BIT, graph_index)</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160; </div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;    <a class="code" href="hwcontext__vulkan_8c.html#a17625fb48ab3e129591594e4352a24aa">SEARCH_FLAGS</a>((<a class="code" href="cbs__av1_8c.html#a67119bce106892b6dade1dc5aa405ac9">flags</a> &amp;  VK_QUEUE_COMPUTE_BIT) &amp;&amp; (<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> != graph_index),</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;                 comp_index)</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160; </div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;    <a class="code" href="hwcontext__vulkan_8c.html#a17625fb48ab3e129591594e4352a24aa">SEARCH_FLAGS</a>((<a class="code" href="cbs__av1_8c.html#a67119bce106892b6dade1dc5aa405ac9">flags</a> &amp; VK_QUEUE_TRANSFER_BIT) &amp;&amp; (<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> != graph_index) &amp;&amp;</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;                 (<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> != comp_index), tx_index)</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160; </div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;<span class="preprocessor">#undef SEARCH_FLAGS</span></div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;<span class="preprocessor">#define ADD_QUEUE(fidx, graph, comp, tx)                                                 \</span></div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;<span class="preprocessor">    av_log(ctx, AV_LOG_VERBOSE, &quot;Using queue family %i (total queues: %i) for %s%s%s\n&quot;, \</span></div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;<span class="preprocessor">           fidx, qs[fidx].queueCount, graph ? &quot;graphics &quot; : &quot;&quot;,                          \</span></div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;<span class="preprocessor">           comp ? &quot;compute &quot; : &quot;&quot;, tx ? &quot;transfers &quot; : &quot;&quot;);                              \</span></div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;<span class="preprocessor">    av_log(ctx, AV_LOG_VERBOSE, &quot;    QF %i flags: %s%s%s%s\n&quot;, fidx,                     \</span></div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;<span class="preprocessor">           ((qs[fidx].queueFlags) &amp; VK_QUEUE_GRAPHICS_BIT) ? &quot;(graphics) &quot; : &quot;&quot;,         \</span></div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;<span class="preprocessor">           ((qs[fidx].queueFlags) &amp; VK_QUEUE_COMPUTE_BIT) ? &quot;(compute) &quot; : &quot;&quot;,           \</span></div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;<span class="preprocessor">           ((qs[fidx].queueFlags) &amp; VK_QUEUE_TRANSFER_BIT) ? &quot;(transfers) &quot; : &quot;&quot;,        \</span></div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;<span class="preprocessor">           ((qs[fidx].queueFlags) &amp; VK_QUEUE_SPARSE_BINDING_BIT) ? &quot;(sparse) &quot; : &quot;&quot;);    \</span></div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;<span class="preprocessor">    pc[cd-&gt;queueCreateInfoCount].queueFamilyIndex = fidx;                                \</span></div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;<span class="preprocessor">    pc[cd-&gt;queueCreateInfoCount].queueCount = qs[fidx].queueCount;                       \</span></div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;<span class="preprocessor">    weights = av_malloc(qs[fidx].queueCount * sizeof(float));                            \</span></div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;<span class="preprocessor">    pc[cd-&gt;queueCreateInfoCount].pQueuePriorities = weights;                             \</span></div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;<span class="preprocessor">    if (!weights)                                                                        \</span></div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;<span class="preprocessor">        goto fail;                                                                       \</span></div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;<span class="preprocessor">    for (int i = 0; i &lt; qs[fidx].queueCount; i++)                                        \</span></div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;<span class="preprocessor">        weights[i] = 1.0f;                                                               \</span></div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;<span class="preprocessor">    cd-&gt;queueCreateInfoCount++;</span></div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160; </div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;    <a class="code" href="hwcontext__vulkan_8c.html#ac6f57bda1d022f5fc8524a051409e0da">ADD_QUEUE</a>(graph_index, 1, comp_index &lt; 0, tx_index &lt; 0 &amp;&amp; comp_index &lt; 0)</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;    hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a1ae83abcaab148c5ad0278cacf26834e">queue_family_index</a>      = graph_index;</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;    hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a7adbed71081998a80f83e92ed72e2821">queue_family_comp_index</a> = graph_index;</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;    hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a160efd57925b2bf9c75c94b1aafad629">queue_family_tx_index</a>   = graph_index;</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;    hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#aa7908b8833b8c3fee7fc18fab9fcf0d0">nb_graphics_queues</a>      = qs[graph_index].queueCount;</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160; </div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;    <span class="keywordflow">if</span> (comp_index != -1) {</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;        <a class="code" href="hwcontext__vulkan_8c.html#ac6f57bda1d022f5fc8524a051409e0da">ADD_QUEUE</a>(comp_index, 0, 1, tx_index &lt; 0)</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;        hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a160efd57925b2bf9c75c94b1aafad629">queue_family_tx_index</a>   = comp_index;</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;        hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a7adbed71081998a80f83e92ed72e2821">queue_family_comp_index</a> = comp_index;</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;        hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#ab612ea6b23014d1c38fc99793595f7aa">nb_comp_queues</a>          = qs[comp_index].queueCount;</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;    }</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160; </div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;    <span class="keywordflow">if</span> (tx_index != -1) {</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;        <a class="code" href="hwcontext__vulkan_8c.html#ac6f57bda1d022f5fc8524a051409e0da">ADD_QUEUE</a>(tx_index, 0, 0, 1)</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;        hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a160efd57925b2bf9c75c94b1aafad629">queue_family_tx_index</a> = tx_index;</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;        hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#adac78554fd3d354a93df1abd7943953a">nb_tx_queues</a>          = qs[tx_index].queueCount;</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;    }</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160; </div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;<span class="preprocessor">#undef ADD_QUEUE</span></div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#a079eab092887563f2bef9106c6120089">av_free</a>(qs);</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160; </div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160; </div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;<a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>:</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#adba82e1bcd02de510a858fcbedf79ef1">av_freep</a>(&amp;pc[0].pQueuePriorities);</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#adba82e1bcd02de510a858fcbedf79ef1">av_freep</a>(&amp;pc[1].pQueuePriorities);</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#adba82e1bcd02de510a858fcbedf79ef1">av_freep</a>(&amp;pc[2].pQueuePriorities);</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#a079eab092887563f2bef9106c6120089">av_free</a>(qs);</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160; </div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;}</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160; </div>
<div class="line"><a name="l00736"></a><span class="lineno"><a class="line" href="hwcontext__vulkan_8c.html#a8ec94342a3a8351bd61eacacd1dedf4b">  736</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="hwcontext__vulkan_8c.html#a8ec94342a3a8351bd61eacacd1dedf4b">create_exec_ctx</a>(<a class="code" href="struct_a_v_h_w_frames_context.html">AVHWFramesContext</a> *hwfc, <a class="code" href="struct_vulkan_exec_ctx.html">VulkanExecCtx</a> *cmd,</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;                           <span class="keywordtype">int</span> queue_family_index, <span class="keywordtype">int</span> num_queues)</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;{</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;    VkResult <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>;</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;    <a class="code" href="struct_a_v_vulkan_device_context.html">AVVulkanDeviceContext</a> *hwctx = hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#ac9a7dbd0cbfcabc0b1529cb34cf53b6d">device_ctx</a>-&gt;<a class="code" href="struct_a_v_h_w_device_context.html#a46055b48d1a40445d775b4ae24f77f20">hwctx</a>;</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160; </div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;    VkCommandPoolCreateInfo <a class="code" href="af__dynaudnorm_8c.html#a098e07c895cd144e457198846bf64a8f">cqueue_create</a> = {</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;        .sType              = VK_STRUCTURE_TYPE_COMMAND_POOL_CREATE_INFO,</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;        .flags              = VK_COMMAND_POOL_CREATE_RESET_COMMAND_BUFFER_BIT,</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;        .queueFamilyIndex   = queue_family_index,</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;    };</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;    VkCommandBufferAllocateInfo cbuf_create = {</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;        .sType              = VK_STRUCTURE_TYPE_COMMAND_BUFFER_ALLOCATE_INFO,</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;        .level              = VK_COMMAND_BUFFER_LEVEL_PRIMARY,</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;        .commandBufferCount = num_queues,</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;    };</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160; </div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;    cmd-&gt;<a class="code" href="struct_vulkan_exec_ctx.html#a2947aa835fe688e37d446fb6be093b25">nb_queues</a> = num_queues;</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160; </div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;    cmd-&gt;<a class="code" href="struct_vulkan_exec_ctx.html#ad467710035a59f14d1c6544cd60912e2">queues</a> = <a class="code" href="group__lavu__mem__funcs.html#gaf143ecab33a3868b57345466c39de7c1">av_mallocz</a>(num_queues * <span class="keyword">sizeof</span>(*cmd-&gt;<a class="code" href="struct_vulkan_exec_ctx.html#ad467710035a59f14d1c6544cd60912e2">queues</a>));</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;    <span class="keywordflow">if</span> (!cmd-&gt;<a class="code" href="struct_vulkan_exec_ctx.html#ad467710035a59f14d1c6544cd60912e2">queues</a>)</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160; </div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;    cmd-&gt;<a class="code" href="struct_vulkan_exec_ctx.html#acee0bf4f2264075d3eeefedc29c58b53">bufs</a> = <a class="code" href="group__lavu__mem__funcs.html#gaf143ecab33a3868b57345466c39de7c1">av_mallocz</a>(num_queues * <span class="keyword">sizeof</span>(*cmd-&gt;<a class="code" href="struct_vulkan_exec_ctx.html#acee0bf4f2264075d3eeefedc29c58b53">bufs</a>));</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;    <span class="keywordflow">if</span> (!cmd-&gt;<a class="code" href="struct_vulkan_exec_ctx.html#acee0bf4f2264075d3eeefedc29c58b53">bufs</a>)</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160; </div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;    <span class="comment">/* Create command pool */</span></div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;    <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = vkCreateCommandPool(hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a53a07d4474261e4e14ec03c5d15f71da">act_dev</a>, &amp;<a class="code" href="af__dynaudnorm_8c.html#a098e07c895cd144e457198846bf64a8f">cqueue_create</a>,</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;                              hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a4a617020274526c26e265781aefcd22c">alloc</a>, &amp;cmd-&gt;<a class="code" href="struct_vulkan_exec_ctx.html#a83f8db5f77669ac659bb6569bb4eef4f">pool</a>);</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> != VK_SUCCESS) {</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(hwfc, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Command pool creation failure: %s\n&quot;</span>,</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;               <a class="code" href="hwcontext__vulkan_8c.html#ab4395598042453295899a91b26ad013b">vk_ret2str</a>(<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>));</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="group__lavu__error.html#ga9c520e483ba8648495620ffdb4c491f2">AVERROR_EXTERNAL</a>;</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;    }</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160; </div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;    cbuf_create.commandPool = cmd-&gt;<a class="code" href="struct_vulkan_exec_ctx.html#a83f8db5f77669ac659bb6569bb4eef4f">pool</a>;</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160; </div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;    <span class="comment">/* Allocate command buffer */</span></div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;    <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = vkAllocateCommandBuffers(hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a53a07d4474261e4e14ec03c5d15f71da">act_dev</a>, &amp;cbuf_create, cmd-&gt;<a class="code" href="struct_vulkan_exec_ctx.html#acee0bf4f2264075d3eeefedc29c58b53">bufs</a>);</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> != VK_SUCCESS) {</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(hwfc, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Command buffer alloc failure: %s\n&quot;</span>,</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;               <a class="code" href="hwcontext__vulkan_8c.html#ab4395598042453295899a91b26ad013b">vk_ret2str</a>(<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>));</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="group__lavu__error.html#ga9c520e483ba8648495620ffdb4c491f2">AVERROR_EXTERNAL</a>;</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;    }</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160; </div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; num_queues; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;        <a class="code" href="struct_vulkan_queue_ctx.html">VulkanQueueCtx</a> *q = &amp;cmd-&gt;<a class="code" href="struct_vulkan_exec_ctx.html#ad467710035a59f14d1c6544cd60912e2">queues</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;        vkGetDeviceQueue(hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a53a07d4474261e4e14ec03c5d15f71da">act_dev</a>, queue_family_index, <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>, &amp;q-&gt;<a class="code" href="struct_vulkan_queue_ctx.html#a6fc206cde8912427b37eebfa5cae659a">queue</a>);</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;        q-&gt;<a class="code" href="struct_vulkan_queue_ctx.html#ab75c31fe085f99dc7193f8c7674ea69b">was_synchronous</a> = 1;</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;    }</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160; </div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;}</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160; </div>
<div class="line"><a name="l00791"></a><span class="lineno"><a class="line" href="hwcontext__vulkan_8c.html#afd623dfe84458032bb583efe3fb748e5">  791</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="hwcontext__vulkan_8c.html#afd623dfe84458032bb583efe3fb748e5">free_exec_ctx</a>(<a class="code" href="struct_a_v_h_w_frames_context.html">AVHWFramesContext</a> *hwfc, <a class="code" href="struct_vulkan_exec_ctx.html">VulkanExecCtx</a> *cmd)</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;{</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;    <a class="code" href="struct_a_v_vulkan_device_context.html">AVVulkanDeviceContext</a> *hwctx = hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#ac9a7dbd0cbfcabc0b1529cb34cf53b6d">device_ctx</a>-&gt;<a class="code" href="struct_a_v_h_w_device_context.html#a46055b48d1a40445d775b4ae24f77f20">hwctx</a>;</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160; </div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;    <span class="comment">/* Make sure all queues have finished executing */</span></div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; cmd-&gt;<a class="code" href="struct_vulkan_exec_ctx.html#a2947aa835fe688e37d446fb6be093b25">nb_queues</a>; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;        <a class="code" href="struct_vulkan_queue_ctx.html">VulkanQueueCtx</a> *q = &amp;cmd-&gt;<a class="code" href="struct_vulkan_exec_ctx.html#ad467710035a59f14d1c6544cd60912e2">queues</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160; </div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;        <span class="keywordflow">if</span> (q-&gt;<a class="code" href="struct_vulkan_queue_ctx.html#a0235250212cf181a69d5a89b27e7f9b2">fence</a> &amp;&amp; !q-&gt;<a class="code" href="struct_vulkan_queue_ctx.html#ab75c31fe085f99dc7193f8c7674ea69b">was_synchronous</a>) {</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;            vkWaitForFences(hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a53a07d4474261e4e14ec03c5d15f71da">act_dev</a>, 1, &amp;q-&gt;<a class="code" href="struct_vulkan_queue_ctx.html#a0235250212cf181a69d5a89b27e7f9b2">fence</a>, VK_TRUE, UINT64_MAX);</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;            vkResetFences(hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a53a07d4474261e4e14ec03c5d15f71da">act_dev</a>, 1, &amp;q-&gt;<a class="code" href="struct_vulkan_queue_ctx.html#a0235250212cf181a69d5a89b27e7f9b2">fence</a>);</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;        }</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160; </div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;        <span class="comment">/* Free the fence */</span></div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;        <span class="keywordflow">if</span> (q-&gt;<a class="code" href="struct_vulkan_queue_ctx.html#a0235250212cf181a69d5a89b27e7f9b2">fence</a>)</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;            vkDestroyFence(hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a53a07d4474261e4e14ec03c5d15f71da">act_dev</a>, q-&gt;<a class="code" href="struct_vulkan_queue_ctx.html#a0235250212cf181a69d5a89b27e7f9b2">fence</a>, hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a4a617020274526c26e265781aefcd22c">alloc</a>);</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160; </div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;        <span class="comment">/* Free buffer dependencies */</span></div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; q-&gt;<a class="code" href="struct_vulkan_queue_ctx.html#a65ce96bd602e35abbdc0e69677e23fd3">nb_buf_deps</a>; j++)</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;            <a class="code" href="group__lavu__buffer.html#ga135e9e929b5033bb8f68322497b2effc">av_buffer_unref</a>(&amp;q-&gt;<a class="code" href="struct_vulkan_queue_ctx.html#a1f21f90d4f4cfd8e8b7c381258a8d88d">buf_deps</a>[j]);</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#a079eab092887563f2bef9106c6120089">av_free</a>(q-&gt;<a class="code" href="struct_vulkan_queue_ctx.html#a1f21f90d4f4cfd8e8b7c381258a8d88d">buf_deps</a>);</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;    }</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160; </div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;    <span class="keywordflow">if</span> (cmd-&gt;<a class="code" href="struct_vulkan_exec_ctx.html#acee0bf4f2264075d3eeefedc29c58b53">bufs</a>)</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;        vkFreeCommandBuffers(hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a53a07d4474261e4e14ec03c5d15f71da">act_dev</a>, cmd-&gt;<a class="code" href="struct_vulkan_exec_ctx.html#a83f8db5f77669ac659bb6569bb4eef4f">pool</a>, cmd-&gt;<a class="code" href="struct_vulkan_exec_ctx.html#a2947aa835fe688e37d446fb6be093b25">nb_queues</a>, cmd-&gt;<a class="code" href="struct_vulkan_exec_ctx.html#acee0bf4f2264075d3eeefedc29c58b53">bufs</a>);</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;    <span class="keywordflow">if</span> (cmd-&gt;<a class="code" href="struct_vulkan_exec_ctx.html#a83f8db5f77669ac659bb6569bb4eef4f">pool</a>)</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;        vkDestroyCommandPool(hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a53a07d4474261e4e14ec03c5d15f71da">act_dev</a>, cmd-&gt;<a class="code" href="struct_vulkan_exec_ctx.html#a83f8db5f77669ac659bb6569bb4eef4f">pool</a>, hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a4a617020274526c26e265781aefcd22c">alloc</a>);</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160; </div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#adba82e1bcd02de510a858fcbedf79ef1">av_freep</a>(&amp;cmd-&gt;<a class="code" href="struct_vulkan_exec_ctx.html#acee0bf4f2264075d3eeefedc29c58b53">bufs</a>);</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#adba82e1bcd02de510a858fcbedf79ef1">av_freep</a>(&amp;cmd-&gt;<a class="code" href="struct_vulkan_exec_ctx.html#ad467710035a59f14d1c6544cd60912e2">queues</a>);</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;}</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160; </div>
<div class="line"><a name="l00823"></a><span class="lineno"><a class="line" href="hwcontext__vulkan_8c.html#a4b19998e390caea2fbdeb64a7313de9f">  823</a></span>&#160;<span class="keyword">static</span> VkCommandBuffer <a class="code" href="hwcontext__vulkan_8c.html#a4b19998e390caea2fbdeb64a7313de9f">get_buf_exec_ctx</a>(<a class="code" href="struct_a_v_h_w_frames_context.html">AVHWFramesContext</a> *hwfc, <a class="code" href="struct_vulkan_exec_ctx.html">VulkanExecCtx</a> *cmd)</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;{</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;    <span class="keywordflow">return</span> cmd-&gt;<a class="code" href="struct_vulkan_exec_ctx.html#acee0bf4f2264075d3eeefedc29c58b53">bufs</a>[cmd-&gt;<a class="code" href="struct_vulkan_exec_ctx.html#ac2a4fc7e6372cfc350905f539a37ab36">cur_queue_idx</a>];</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;}</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160; </div>
<div class="line"><a name="l00828"></a><span class="lineno"><a class="line" href="hwcontext__vulkan_8c.html#a4c405e1f7bc1a8d840e1f39c9877e1a0">  828</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="hwcontext__vulkan_8c.html#a4c405e1f7bc1a8d840e1f39c9877e1a0">unref_exec_ctx_deps</a>(<a class="code" href="struct_a_v_h_w_frames_context.html">AVHWFramesContext</a> *hwfc, <a class="code" href="struct_vulkan_exec_ctx.html">VulkanExecCtx</a> *cmd)</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;{</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;    <a class="code" href="struct_vulkan_queue_ctx.html">VulkanQueueCtx</a> *q = &amp;cmd-&gt;<a class="code" href="struct_vulkan_exec_ctx.html#ad467710035a59f14d1c6544cd60912e2">queues</a>[cmd-&gt;<a class="code" href="struct_vulkan_exec_ctx.html#ac2a4fc7e6372cfc350905f539a37ab36">cur_queue_idx</a>];</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160; </div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; q-&gt;<a class="code" href="struct_vulkan_queue_ctx.html#a65ce96bd602e35abbdc0e69677e23fd3">nb_buf_deps</a>; j++)</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;        <a class="code" href="group__lavu__buffer.html#ga135e9e929b5033bb8f68322497b2effc">av_buffer_unref</a>(&amp;q-&gt;<a class="code" href="struct_vulkan_queue_ctx.html#a1f21f90d4f4cfd8e8b7c381258a8d88d">buf_deps</a>[j]);</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;    q-&gt;<a class="code" href="struct_vulkan_queue_ctx.html#a65ce96bd602e35abbdc0e69677e23fd3">nb_buf_deps</a> = 0;</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;}</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160; </div>
<div class="line"><a name="l00837"></a><span class="lineno"><a class="line" href="hwcontext__vulkan_8c.html#a0c938954f0b293626efb96e7fc161e1f">  837</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="hwcontext__vulkan_8c.html#a0c938954f0b293626efb96e7fc161e1f">wait_start_exec_ctx</a>(<a class="code" href="struct_a_v_h_w_frames_context.html">AVHWFramesContext</a> *hwfc, <a class="code" href="struct_vulkan_exec_ctx.html">VulkanExecCtx</a> *cmd)</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;{</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;    VkResult <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>;</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;    <a class="code" href="struct_a_v_vulkan_device_context.html">AVVulkanDeviceContext</a> *hwctx = hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#ac9a7dbd0cbfcabc0b1529cb34cf53b6d">device_ctx</a>-&gt;<a class="code" href="struct_a_v_h_w_device_context.html#a46055b48d1a40445d775b4ae24f77f20">hwctx</a>;</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;    <a class="code" href="struct_vulkan_queue_ctx.html">VulkanQueueCtx</a> *q = &amp;cmd-&gt;<a class="code" href="struct_vulkan_exec_ctx.html#ad467710035a59f14d1c6544cd60912e2">queues</a>[cmd-&gt;<a class="code" href="struct_vulkan_exec_ctx.html#ac2a4fc7e6372cfc350905f539a37ab36">cur_queue_idx</a>];</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160; </div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;    VkCommandBufferBeginInfo cmd_start = {</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;        .sType = VK_STRUCTURE_TYPE_COMMAND_BUFFER_BEGIN_INFO,</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;        .flags = VK_COMMAND_BUFFER_USAGE_ONE_TIME_SUBMIT_BIT,</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;    };</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160; </div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;    <span class="comment">/* Create the fence and don&#39;t wait for it initially */</span></div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;    <span class="keywordflow">if</span> (!q-&gt;<a class="code" href="struct_vulkan_queue_ctx.html#a0235250212cf181a69d5a89b27e7f9b2">fence</a>) {</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;        VkFenceCreateInfo fence_spawn = {</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;            .sType = VK_STRUCTURE_TYPE_FENCE_CREATE_INFO,</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;        };</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;        <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = vkCreateFence(hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a53a07d4474261e4e14ec03c5d15f71da">act_dev</a>, &amp;fence_spawn, hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a4a617020274526c26e265781aefcd22c">alloc</a>,</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;                            &amp;q-&gt;<a class="code" href="struct_vulkan_queue_ctx.html#a0235250212cf181a69d5a89b27e7f9b2">fence</a>);</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> != VK_SUCCESS) {</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(hwfc, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to queue frame fence: %s\n&quot;</span>,</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;                   <a class="code" href="hwcontext__vulkan_8c.html#ab4395598042453295899a91b26ad013b">vk_ret2str</a>(<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>));</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="group__lavu__error.html#ga9c520e483ba8648495620ffdb4c491f2">AVERROR_EXTERNAL</a>;</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;        }</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!q-&gt;<a class="code" href="struct_vulkan_queue_ctx.html#ab75c31fe085f99dc7193f8c7674ea69b">was_synchronous</a>) {</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;        vkWaitForFences(hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a53a07d4474261e4e14ec03c5d15f71da">act_dev</a>, 1, &amp;q-&gt;<a class="code" href="struct_vulkan_queue_ctx.html#a0235250212cf181a69d5a89b27e7f9b2">fence</a>, VK_TRUE, UINT64_MAX);</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;        vkResetFences(hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a53a07d4474261e4e14ec03c5d15f71da">act_dev</a>, 1, &amp;q-&gt;<a class="code" href="struct_vulkan_queue_ctx.html#a0235250212cf181a69d5a89b27e7f9b2">fence</a>);</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;    }</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160; </div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;    <span class="comment">/* Discard queue dependencies */</span></div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;    <a class="code" href="hwcontext__vulkan_8c.html#a4c405e1f7bc1a8d840e1f39c9877e1a0">unref_exec_ctx_deps</a>(hwfc, cmd);</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160; </div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;    <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = vkBeginCommandBuffer(cmd-&gt;<a class="code" href="struct_vulkan_exec_ctx.html#acee0bf4f2264075d3eeefedc29c58b53">bufs</a>[cmd-&gt;<a class="code" href="struct_vulkan_exec_ctx.html#ac2a4fc7e6372cfc350905f539a37ab36">cur_queue_idx</a>], &amp;cmd_start);</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> != VK_SUCCESS) {</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(hwfc, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to init command buffer: %s\n&quot;</span>,</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;               <a class="code" href="hwcontext__vulkan_8c.html#ab4395598042453295899a91b26ad013b">vk_ret2str</a>(<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>));</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="group__lavu__error.html#ga9c520e483ba8648495620ffdb4c491f2">AVERROR_EXTERNAL</a>;</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;    }</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160; </div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;}</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160; </div>
<div class="line"><a name="l00878"></a><span class="lineno"><a class="line" href="hwcontext__vulkan_8c.html#ad6e72ce85a1f47714711415d1e336a04">  878</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="hwcontext__vulkan_8c.html#ad6e72ce85a1f47714711415d1e336a04">add_buf_dep_exec_ctx</a>(<a class="code" href="struct_a_v_h_w_frames_context.html">AVHWFramesContext</a> *hwfc, <a class="code" href="struct_vulkan_exec_ctx.html">VulkanExecCtx</a> *cmd,</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;                                <a class="code" href="struct_a_v_buffer_ref.html">AVBufferRef</a> * <span class="keyword">const</span> *deps, <span class="keywordtype">int</span> nb_deps)</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;{</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;    <a class="code" href="struct_a_v_buffer_ref.html">AVBufferRef</a> **dst;</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;    <a class="code" href="struct_vulkan_queue_ctx.html">VulkanQueueCtx</a> *q = &amp;cmd-&gt;<a class="code" href="struct_vulkan_exec_ctx.html#ad467710035a59f14d1c6544cd60912e2">queues</a>[cmd-&gt;<a class="code" href="struct_vulkan_exec_ctx.html#ac2a4fc7e6372cfc350905f539a37ab36">cur_queue_idx</a>];</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160; </div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;    <span class="keywordflow">if</span> (!deps || !nb_deps)</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160; </div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;    dst = <a class="code" href="group__lavu__mem__funcs.html#ga869fd8884d8d29a7a4910d879926d94a">av_fast_realloc</a>(q-&gt;<a class="code" href="struct_vulkan_queue_ctx.html#a1f21f90d4f4cfd8e8b7c381258a8d88d">buf_deps</a>, &amp;q-&gt;<a class="code" href="struct_vulkan_queue_ctx.html#a67052152ec8f1bdfb4be3c56f07447e4">buf_deps_alloc_size</a>,</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;                          (q-&gt;<a class="code" href="struct_vulkan_queue_ctx.html#a65ce96bd602e35abbdc0e69677e23fd3">nb_buf_deps</a> + nb_deps) * <span class="keyword">sizeof</span>(*dst));</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;    <span class="keywordflow">if</span> (!dst)</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;        <span class="keywordflow">goto</span> err;</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160; </div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;    q-&gt;<a class="code" href="struct_vulkan_queue_ctx.html#a1f21f90d4f4cfd8e8b7c381258a8d88d">buf_deps</a> = dst;</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160; </div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; nb_deps; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;        q-&gt;<a class="code" href="struct_vulkan_queue_ctx.html#a1f21f90d4f4cfd8e8b7c381258a8d88d">buf_deps</a>[q-&gt;<a class="code" href="struct_vulkan_queue_ctx.html#a65ce96bd602e35abbdc0e69677e23fd3">nb_buf_deps</a>] = <a class="code" href="group__lavu__buffer.html#gaa40ce7d3ede946a89d03323bbd7268c1">av_buffer_ref</a>(deps[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;        <span class="keywordflow">if</span> (!q-&gt;<a class="code" href="struct_vulkan_queue_ctx.html#a1f21f90d4f4cfd8e8b7c381258a8d88d">buf_deps</a>[q-&gt;<a class="code" href="struct_vulkan_queue_ctx.html#a65ce96bd602e35abbdc0e69677e23fd3">nb_buf_deps</a>])</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;            <span class="keywordflow">goto</span> err;</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;        q-&gt;<a class="code" href="struct_vulkan_queue_ctx.html#a65ce96bd602e35abbdc0e69677e23fd3">nb_buf_deps</a>++;</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;    }</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160; </div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160; </div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;err:</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;    <a class="code" href="hwcontext__vulkan_8c.html#a4c405e1f7bc1a8d840e1f39c9877e1a0">unref_exec_ctx_deps</a>(hwfc, cmd);</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;}</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160; </div>
<div class="line"><a name="l00908"></a><span class="lineno"><a class="line" href="hwcontext__vulkan_8c.html#a0040d6813ae4cb493e185f6ba869742c">  908</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="hwcontext__vulkan_8c.html#a0040d6813ae4cb493e185f6ba869742c">submit_exec_ctx</a>(<a class="code" href="struct_a_v_h_w_frames_context.html">AVHWFramesContext</a> *hwfc, <a class="code" href="struct_vulkan_exec_ctx.html">VulkanExecCtx</a> *cmd,</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;                           VkSubmitInfo *s_info, <span class="keywordtype">int</span> synchronous)</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;{</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;    VkResult <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>;</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;    <a class="code" href="struct_vulkan_queue_ctx.html">VulkanQueueCtx</a> *q = &amp;cmd-&gt;<a class="code" href="struct_vulkan_exec_ctx.html#ad467710035a59f14d1c6544cd60912e2">queues</a>[cmd-&gt;<a class="code" href="struct_vulkan_exec_ctx.html#ac2a4fc7e6372cfc350905f539a37ab36">cur_queue_idx</a>];</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160; </div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;    <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = vkEndCommandBuffer(cmd-&gt;<a class="code" href="struct_vulkan_exec_ctx.html#acee0bf4f2264075d3eeefedc29c58b53">bufs</a>[cmd-&gt;<a class="code" href="struct_vulkan_exec_ctx.html#ac2a4fc7e6372cfc350905f539a37ab36">cur_queue_idx</a>]);</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> != VK_SUCCESS) {</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(hwfc, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to finish command buffer: %s\n&quot;</span>,</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;               <a class="code" href="hwcontext__vulkan_8c.html#ab4395598042453295899a91b26ad013b">vk_ret2str</a>(<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>));</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;        <a class="code" href="hwcontext__vulkan_8c.html#a4c405e1f7bc1a8d840e1f39c9877e1a0">unref_exec_ctx_deps</a>(hwfc, cmd);</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="group__lavu__error.html#ga9c520e483ba8648495620ffdb4c491f2">AVERROR_EXTERNAL</a>;</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;    }</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160; </div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;    s_info-&gt;pCommandBuffers = &amp;cmd-&gt;<a class="code" href="struct_vulkan_exec_ctx.html#acee0bf4f2264075d3eeefedc29c58b53">bufs</a>[cmd-&gt;<a class="code" href="struct_vulkan_exec_ctx.html#ac2a4fc7e6372cfc350905f539a37ab36">cur_queue_idx</a>];</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;    s_info-&gt;commandBufferCount = 1;</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160; </div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;    <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = vkQueueSubmit(q-&gt;<a class="code" href="struct_vulkan_queue_ctx.html#a6fc206cde8912427b37eebfa5cae659a">queue</a>, 1, s_info, q-&gt;<a class="code" href="struct_vulkan_queue_ctx.html#a0235250212cf181a69d5a89b27e7f9b2">fence</a>);</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> != VK_SUCCESS) {</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;        <a class="code" href="hwcontext__vulkan_8c.html#a4c405e1f7bc1a8d840e1f39c9877e1a0">unref_exec_ctx_deps</a>(hwfc, cmd);</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="group__lavu__error.html#ga9c520e483ba8648495620ffdb4c491f2">AVERROR_EXTERNAL</a>;</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;    }</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160; </div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;    q-&gt;<a class="code" href="struct_vulkan_queue_ctx.html#ab75c31fe085f99dc7193f8c7674ea69b">was_synchronous</a> = synchronous;</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160; </div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;    <span class="keywordflow">if</span> (synchronous) {</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;        <a class="code" href="struct_a_v_vulkan_device_context.html">AVVulkanDeviceContext</a> *hwctx = hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#ac9a7dbd0cbfcabc0b1529cb34cf53b6d">device_ctx</a>-&gt;<a class="code" href="struct_a_v_h_w_device_context.html#a46055b48d1a40445d775b4ae24f77f20">hwctx</a>;</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;        vkWaitForFences(hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a53a07d4474261e4e14ec03c5d15f71da">act_dev</a>, 1, &amp;q-&gt;<a class="code" href="struct_vulkan_queue_ctx.html#a0235250212cf181a69d5a89b27e7f9b2">fence</a>, VK_TRUE, UINT64_MAX);</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;        vkResetFences(hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a53a07d4474261e4e14ec03c5d15f71da">act_dev</a>, 1, &amp;q-&gt;<a class="code" href="struct_vulkan_queue_ctx.html#a0235250212cf181a69d5a89b27e7f9b2">fence</a>);</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;        <a class="code" href="hwcontext__vulkan_8c.html#a4c405e1f7bc1a8d840e1f39c9877e1a0">unref_exec_ctx_deps</a>(hwfc, cmd);</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;    } <span class="keywordflow">else</span> { <span class="comment">/* Rotate queues */</span></div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;        cmd-&gt;<a class="code" href="struct_vulkan_exec_ctx.html#ac2a4fc7e6372cfc350905f539a37ab36">cur_queue_idx</a> = (cmd-&gt;<a class="code" href="struct_vulkan_exec_ctx.html#ac2a4fc7e6372cfc350905f539a37ab36">cur_queue_idx</a> + 1) % cmd-&gt;<a class="code" href="struct_vulkan_exec_ctx.html#a2947aa835fe688e37d446fb6be093b25">nb_queues</a>;</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;    }</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160; </div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;}</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160; </div>
<div class="line"><a name="l00945"></a><span class="lineno"><a class="line" href="hwcontext__vulkan_8c.html#ab57a578da41251022426566488e0d6da">  945</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="hwcontext__vulkan_8c.html#ab57a578da41251022426566488e0d6da">vulkan_device_free</a>(<a class="code" href="struct_a_v_h_w_device_context.html">AVHWDeviceContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>)</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;{</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;    <a class="code" href="struct_vulkan_device_priv.html">VulkanDevicePriv</a> *p = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;<a class="code" href="struct_a_v_format_context.html#a8a8bec51da36db65ff864f88a85805d9">internal</a>-&gt;priv;</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;    <a class="code" href="struct_a_v_vulkan_device_context.html">AVVulkanDeviceContext</a> *hwctx = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;hwctx;</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160; </div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;    vkDestroyDevice(hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a53a07d4474261e4e14ec03c5d15f71da">act_dev</a>, hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a4a617020274526c26e265781aefcd22c">alloc</a>);</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160; </div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;    <span class="keywordflow">if</span> (p-&gt;<a class="code" href="struct_vulkan_device_priv.html#aa95fb956d32713a16c1874fcaad18f2e">debug_ctx</a>) {</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;        <a class="code" href="hwcontext__vulkan_8c.html#acc25b1e67c50a452aa1965aaca0acf88">VK_LOAD_PFN</a>(hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#abb0e7a4336731e84eb1b25571635d243">inst</a>, vkDestroyDebugUtilsMessengerEXT);</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;        pfn_vkDestroyDebugUtilsMessengerEXT(hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#abb0e7a4336731e84eb1b25571635d243">inst</a>, p-&gt;<a class="code" href="struct_vulkan_device_priv.html#aa95fb956d32713a16c1874fcaad18f2e">debug_ctx</a>,</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;                                            hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a4a617020274526c26e265781aefcd22c">alloc</a>);</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;    }</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160; </div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;    vkDestroyInstance(hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#abb0e7a4336731e84eb1b25571635d243">inst</a>, hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a4a617020274526c26e265781aefcd22c">alloc</a>);</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160; </div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a371a0b0216b2e8a56cecbc1e496c04d5">nb_enabled_inst_extensions</a>; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#a079eab092887563f2bef9106c6120089">av_free</a>((<span class="keywordtype">void</span> *)hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a8d68b5373defea792ad340e698d9b409">enabled_inst_extensions</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#a079eab092887563f2bef9106c6120089">av_free</a>((<span class="keywordtype">void</span> *)hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a8d68b5373defea792ad340e698d9b409">enabled_inst_extensions</a>);</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160; </div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#ac40732ea5eeffe1b231d21d9df10e658">nb_enabled_dev_extensions</a>; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#a079eab092887563f2bef9106c6120089">av_free</a>((<span class="keywordtype">void</span> *)hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a38e84a1e98b06831031e7abb915f4190">enabled_dev_extensions</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#a079eab092887563f2bef9106c6120089">av_free</a>((<span class="keywordtype">void</span> *)hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a38e84a1e98b06831031e7abb915f4190">enabled_dev_extensions</a>);</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;}</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160; </div>
<div class="line"><a name="l00969"></a><span class="lineno"><a class="line" href="hwcontext__vulkan_8c.html#a632fcea203c8b3b46846667ebb33d304">  969</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="hwcontext__vulkan_8c.html#a632fcea203c8b3b46846667ebb33d304">vulkan_device_create_internal</a>(<a class="code" href="struct_a_v_h_w_device_context.html">AVHWDeviceContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>,</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;                                         <a class="code" href="struct_vulkan_device_selection.html">VulkanDeviceSelection</a> *dev_select,</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;                                         <a class="code" href="struct_a_v_dictionary.html">AVDictionary</a> *<a class="code" href="tests_2movenc_8c.html#af540b728145b614e34c4e10930354b93">opts</a>, <span class="keywordtype">int</span> <a class="code" href="cbs__av1_8c.html#a67119bce106892b6dade1dc5aa405ac9">flags</a>)</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;{</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;    <span class="keywordtype">int</span> err = 0;</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;    VkResult <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>;</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;    <a class="code" href="struct_a_v_dictionary_entry.html">AVDictionaryEntry</a> *opt_d;</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;    <a class="code" href="struct_vulkan_device_priv.html">VulkanDevicePriv</a> *p = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;<a class="code" href="struct_a_v_format_context.html#a8a8bec51da36db65ff864f88a85805d9">internal</a>-&gt;priv;</div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;    <a class="code" href="struct_a_v_vulkan_device_context.html">AVVulkanDeviceContext</a> *hwctx = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;hwctx;</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;    VkPhysicalDeviceFeatures dev_features = { 0 };</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;    VkDeviceQueueCreateInfo queue_create_info[3] = {</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;        { .sType = VK_STRUCTURE_TYPE_DEVICE_QUEUE_CREATE_INFO, },</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;        { .sType = VK_STRUCTURE_TYPE_DEVICE_QUEUE_CREATE_INFO, },</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;        { .sType = VK_STRUCTURE_TYPE_DEVICE_QUEUE_CREATE_INFO, },</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;    };</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160; </div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;    VkDeviceCreateInfo dev_info = {</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;        .sType                = VK_STRUCTURE_TYPE_DEVICE_CREATE_INFO,</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;        .pNext                = &amp;hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#ac1d0d46b238c76cc4d66ddab7180e7ef">device_features</a>,</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;        .pQueueCreateInfos    = queue_create_info,</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;        .queueCreateInfoCount = 0,</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;    };</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160; </div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;    hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#ac1d0d46b238c76cc4d66ddab7180e7ef">device_features</a>.sType = VK_STRUCTURE_TYPE_PHYSICAL_DEVICE_FEATURES_2;</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;free = <a class="code" href="hwcontext__vulkan_8c.html#ab57a578da41251022426566488e0d6da">vulkan_device_free</a>;</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160; </div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;    <span class="comment">/* Create an instance if not given one */</span></div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;    <span class="keywordflow">if</span> ((err = <a class="code" href="hwcontext__vulkan_8c.html#a459a21f7cefa1c26fb62002a20e251b7">create_instance</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, <a class="code" href="tests_2movenc_8c.html#af540b728145b614e34c4e10930354b93">opts</a>)))</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="avrndec_8c.html#a13191ba45577b1d4f9b37d64df91eb55">end</a>;</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160; </div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;    <span class="comment">/* Find a device (if not given one) */</span></div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;    <span class="keywordflow">if</span> ((err = <a class="code" href="hwcontext__vulkan_8c.html#a57b768eebd26861b5e548b6b230d9f30">find_device</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, dev_select)))</div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="avrndec_8c.html#a13191ba45577b1d4f9b37d64df91eb55">end</a>;</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160; </div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;    vkGetPhysicalDeviceFeatures(hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a154f2a1f99a153cdb9a801b2504d6637">phys_dev</a>, &amp;dev_features);</div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;<span class="preprocessor">#define COPY_FEATURE(DST, NAME) (DST).features.NAME = dev_features.NAME;</span></div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;    <a class="code" href="hwcontext__vulkan_8c.html#acd70049ecb5fd2af24dd63fa06cb69ec">COPY_FEATURE</a>(hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#ac1d0d46b238c76cc4d66ddab7180e7ef">device_features</a>, shaderImageGatherExtended)</div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;    <a class="code" href="hwcontext__vulkan_8c.html#acd70049ecb5fd2af24dd63fa06cb69ec">COPY_FEATURE</a>(hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#ac1d0d46b238c76cc4d66ddab7180e7ef">device_features</a>, fragmentStoresAndAtomics)</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;    <a class="code" href="hwcontext__vulkan_8c.html#acd70049ecb5fd2af24dd63fa06cb69ec">COPY_FEATURE</a>(hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#ac1d0d46b238c76cc4d66ddab7180e7ef">device_features</a>, vertexPipelineStoresAndAtomics)</div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;    <a class="code" href="hwcontext__vulkan_8c.html#acd70049ecb5fd2af24dd63fa06cb69ec">COPY_FEATURE</a>(hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#ac1d0d46b238c76cc4d66ddab7180e7ef">device_features</a>, shaderInt64)</div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;<span class="preprocessor">#undef COPY_FEATURE</span></div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160; </div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;    <span class="comment">/* Search queue family */</span></div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;    <span class="keywordflow">if</span> ((err = <a class="code" href="hwcontext__vulkan_8c.html#a7265940524076da3611c08653214e578">search_queue_families</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, &amp;dev_info)))</div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="avrndec_8c.html#a13191ba45577b1d4f9b37d64df91eb55">end</a>;</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160; </div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;    <span class="keywordflow">if</span> ((err = <a class="code" href="hwcontext__vulkan_8c.html#a64891fa46e2b44b3e1667d354c9028ae">check_extensions</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, 1, <a class="code" href="tests_2movenc_8c.html#af540b728145b614e34c4e10930354b93">opts</a>, &amp;dev_info.ppEnabledExtensionNames,</div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;                                &amp;dev_info.enabledExtensionCount, 0))) {</div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#a079eab092887563f2bef9106c6120089">av_free</a>((<span class="keywordtype">void</span> *)queue_create_info[0].pQueuePriorities);</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#a079eab092887563f2bef9106c6120089">av_free</a>((<span class="keywordtype">void</span> *)queue_create_info[1].pQueuePriorities);</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#a079eab092887563f2bef9106c6120089">av_free</a>((<span class="keywordtype">void</span> *)queue_create_info[2].pQueuePriorities);</div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="avrndec_8c.html#a13191ba45577b1d4f9b37d64df91eb55">end</a>;</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;    }</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160; </div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;    <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = vkCreateDevice(hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a154f2a1f99a153cdb9a801b2504d6637">phys_dev</a>, &amp;dev_info, hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a4a617020274526c26e265781aefcd22c">alloc</a>,</div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;                         &amp;hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a53a07d4474261e4e14ec03c5d15f71da">act_dev</a>);</div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160; </div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#a079eab092887563f2bef9106c6120089">av_free</a>((<span class="keywordtype">void</span> *)queue_create_info[0].pQueuePriorities);</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#a079eab092887563f2bef9106c6120089">av_free</a>((<span class="keywordtype">void</span> *)queue_create_info[1].pQueuePriorities);</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#a079eab092887563f2bef9106c6120089">av_free</a>((<span class="keywordtype">void</span> *)queue_create_info[2].pQueuePriorities);</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160; </div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> != VK_SUCCESS) {</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Device creation failure: %s\n&quot;</span>,</div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;               <a class="code" href="hwcontext__vulkan_8c.html#ab4395598042453295899a91b26ad013b">vk_ret2str</a>(<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>));</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; dev_info.enabledExtensionCount; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#a079eab092887563f2bef9106c6120089">av_free</a>((<span class="keywordtype">void</span> *)dev_info.ppEnabledExtensionNames[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#a079eab092887563f2bef9106c6120089">av_free</a>((<span class="keywordtype">void</span> *)dev_info.ppEnabledExtensionNames);</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;        err = <a class="code" href="group__lavu__error.html#ga9c520e483ba8648495620ffdb4c491f2">AVERROR_EXTERNAL</a>;</div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="avrndec_8c.html#a13191ba45577b1d4f9b37d64df91eb55">end</a>;</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;    }</div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160; </div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;    <span class="comment">/* Tiled images setting, use them by default */</span></div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;    opt_d = <a class="code" href="group__lavu__dict.html#gae67f143237b2cb2936c9b147aa6dfde3">av_dict_get</a>(<a class="code" href="tests_2movenc_8c.html#af540b728145b614e34c4e10930354b93">opts</a>, <span class="stringliteral">&quot;linear_images&quot;</span>, <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0);</div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;    <span class="keywordflow">if</span> (opt_d)</div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;        p-&gt;<a class="code" href="struct_vulkan_device_priv.html#a456ab09798ca379b6534a172a9245dba">use_linear_images</a> = strtol(opt_d-&gt;<a class="code" href="struct_a_v_dictionary_entry.html#aa38678f2cad36f120d42e56449c5edb4">value</a>, <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 10);</div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160; </div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;    hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a38e84a1e98b06831031e7abb915f4190">enabled_dev_extensions</a> = dev_info.ppEnabledExtensionNames;</div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;    hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#ac40732ea5eeffe1b231d21d9df10e658">nb_enabled_dev_extensions</a> = dev_info.enabledExtensionCount;</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160; </div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;<a class="code" href="avrndec_8c.html#a13191ba45577b1d4f9b37d64df91eb55">end</a>:</div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;    <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;}</div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160; </div>
<div class="line"><a name="l01052"></a><span class="lineno"><a class="line" href="hwcontext__vulkan_8c.html#a81c381d28e904d708c3ba142e7656a27"> 1052</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="hwcontext__vulkan_8c.html#a81c381d28e904d708c3ba142e7656a27">vulkan_device_init</a>(<a class="code" href="struct_a_v_h_w_device_context.html">AVHWDeviceContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>)</div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;{</div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;    uint32_t queue_num;</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;    <a class="code" href="struct_a_v_vulkan_device_context.html">AVVulkanDeviceContext</a> *hwctx = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;hwctx;</div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;    <a class="code" href="struct_vulkan_device_priv.html">VulkanDevicePriv</a> *p = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;<a class="code" href="struct_a_v_format_context.html#a8a8bec51da36db65ff864f88a85805d9">internal</a>-&gt;priv;</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160; </div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;    <span class="comment">/* Set device extension flags */</span></div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#ac40732ea5eeffe1b231d21d9df10e658">nb_enabled_dev_extensions</a>; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; <a class="code" href="sinewin__tablegen__template_8c.html#a3508a98d3ee7e2c9a4841fe264cf70f7">FF_ARRAY_ELEMS</a>(<a class="code" href="hwcontext__vulkan_8c.html#af5612db90300a41736bc6573c96e900c">optional_device_exts</a>); j++) {</div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;            <span class="keywordflow">if</span> (!strcmp(hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a38e84a1e98b06831031e7abb915f4190">enabled_dev_extensions</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>],</div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;                        <a class="code" href="hwcontext__vulkan_8c.html#af5612db90300a41736bc6573c96e900c">optional_device_exts</a>[j].<a class="code" href="struct_vulkan_opt_extension.html#a3014adf868a1bb91d76e8ca0e78506e2">name</a>)) {</div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;                <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, <a class="code" href="group__lavu__log__constants.html#ga9b58b28e2d429b930b69db19877f76a8">AV_LOG_VERBOSE</a>, <span class="stringliteral">&quot;Using device extension %s\n&quot;</span>,</div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;                       hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a38e84a1e98b06831031e7abb915f4190">enabled_dev_extensions</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;                p-&gt;<a class="code" href="struct_vulkan_device_priv.html#a895a041d77f8253cb0842c23e54593f2">extensions</a> |= <a class="code" href="hwcontext__vulkan_8c.html#af5612db90300a41736bc6573c96e900c">optional_device_exts</a>[j].<a class="code" href="struct_vulkan_opt_extension.html#ac74c961b27b14719ec404146433c3651">flag</a>;</div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;            }</div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;        }</div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;    }</div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160; </div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;    p-&gt;<a class="code" href="struct_vulkan_device_priv.html#a93919fc0c25c1a74251fc14bccc70188">props</a>.sType = VK_STRUCTURE_TYPE_PHYSICAL_DEVICE_PROPERTIES_2;</div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;    p-&gt;<a class="code" href="struct_vulkan_device_priv.html#a93919fc0c25c1a74251fc14bccc70188">props</a>.pNext = &amp;p-&gt;<a class="code" href="struct_vulkan_device_priv.html#a7a17ab5ea90b05229be6b998d7010327">hprops</a>;</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;    p-&gt;<a class="code" href="struct_vulkan_device_priv.html#a7a17ab5ea90b05229be6b998d7010327">hprops</a>.sType = VK_STRUCTURE_TYPE_PHYSICAL_DEVICE_EXTERNAL_MEMORY_HOST_PROPERTIES_EXT;</div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160; </div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;    vkGetPhysicalDeviceProperties2(hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a154f2a1f99a153cdb9a801b2504d6637">phys_dev</a>, &amp;p-&gt;<a class="code" href="struct_vulkan_device_priv.html#a93919fc0c25c1a74251fc14bccc70188">props</a>);</div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, <a class="code" href="group__lavu__log__constants.html#ga9b58b28e2d429b930b69db19877f76a8">AV_LOG_VERBOSE</a>, <span class="stringliteral">&quot;Using device: %s\n&quot;</span>,</div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;           p-&gt;<a class="code" href="struct_vulkan_device_priv.html#a93919fc0c25c1a74251fc14bccc70188">props</a>.properties.deviceName);</div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, <a class="code" href="group__lavu__log__constants.html#ga9b58b28e2d429b930b69db19877f76a8">AV_LOG_VERBOSE</a>, <span class="stringliteral">&quot;Alignments:\n&quot;</span>);</div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, <a class="code" href="group__lavu__log__constants.html#ga9b58b28e2d429b930b69db19877f76a8">AV_LOG_VERBOSE</a>, <span class="stringliteral">&quot;    optimalBufferCopyRowPitchAlignment: %li\n&quot;</span>,</div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;           p-&gt;<a class="code" href="struct_vulkan_device_priv.html#a93919fc0c25c1a74251fc14bccc70188">props</a>.properties.limits.optimalBufferCopyRowPitchAlignment);</div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, <a class="code" href="group__lavu__log__constants.html#ga9b58b28e2d429b930b69db19877f76a8">AV_LOG_VERBOSE</a>, <span class="stringliteral">&quot;    minMemoryMapAlignment:              %li\n&quot;</span>,</div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;           p-&gt;<a class="code" href="struct_vulkan_device_priv.html#a93919fc0c25c1a74251fc14bccc70188">props</a>.properties.limits.minMemoryMapAlignment);</div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;    <span class="keywordflow">if</span> (p-&gt;<a class="code" href="struct_vulkan_device_priv.html#a895a041d77f8253cb0842c23e54593f2">extensions</a> &amp; <a class="code" href="hwcontext__vulkan_8c.html#adfa9f1974c8c5348db6b4034e3aa7b4ea2c5db237d3d2464a020222e5a328c9df">EXT_EXTERNAL_HOST_MEMORY</a>)</div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, <a class="code" href="group__lavu__log__constants.html#ga9b58b28e2d429b930b69db19877f76a8">AV_LOG_VERBOSE</a>, <span class="stringliteral">&quot;    minImportedHostPointerAlignment:    %li\n&quot;</span>,</div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;               p-&gt;<a class="code" href="struct_vulkan_device_priv.html#a7a17ab5ea90b05229be6b998d7010327">hprops</a>.minImportedHostPointerAlignment);</div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160; </div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;    p-&gt;<a class="code" href="struct_vulkan_device_priv.html#a1cdadbcb5d3249c2b7873dd538c18794">dev_is_nvidia</a> = (p-&gt;<a class="code" href="struct_vulkan_device_priv.html#a93919fc0c25c1a74251fc14bccc70188">props</a>.properties.vendorID == 0x10de);</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160; </div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;    vkGetPhysicalDeviceQueueFamilyProperties(hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a154f2a1f99a153cdb9a801b2504d6637">phys_dev</a>, &amp;queue_num, <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;    <span class="keywordflow">if</span> (!queue_num) {</div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to get queues!\n&quot;</span>);</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="group__lavu__error.html#ga9c520e483ba8648495620ffdb4c491f2">AVERROR_EXTERNAL</a>;</div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;    }</div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160; </div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;<span class="preprocessor">#define CHECK_QUEUE(type, n)                                                         \</span></div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;<span class="preprocessor">if (n &gt;= queue_num) {                                                                \</span></div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;<span class="preprocessor">    av_log(ctx, AV_LOG_ERROR, &quot;Invalid %s queue index %i (device has %i queues)!\n&quot;, \</span></div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;<span class="preprocessor">           type, n, queue_num);                                                      \</span></div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;<span class="preprocessor">    return AVERROR(EINVAL);                                                          \</span></div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;<span class="preprocessor">}</span></div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160; </div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;    <a class="code" href="hwcontext__vulkan_8c.html#a2921e76e6b12d6926b08c25bd2803ced">CHECK_QUEUE</a>(<span class="stringliteral">&quot;graphics&quot;</span>, hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a1ae83abcaab148c5ad0278cacf26834e">queue_family_index</a>)</div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;    <a class="code" href="hwcontext__vulkan_8c.html#a2921e76e6b12d6926b08c25bd2803ced">CHECK_QUEUE</a>(<span class="stringliteral">&quot;upload&quot;</span>,   hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a160efd57925b2bf9c75c94b1aafad629">queue_family_tx_index</a>)</div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;    <a class="code" href="hwcontext__vulkan_8c.html#a2921e76e6b12d6926b08c25bd2803ced">CHECK_QUEUE</a>(<span class="stringliteral">&quot;compute&quot;</span>,  hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a7adbed71081998a80f83e92ed72e2821">queue_family_comp_index</a>)</div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160; </div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;<span class="preprocessor">#undef CHECK_QUEUE</span></div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160; </div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;    p-&gt;<a class="code" href="struct_vulkan_device_priv.html#a753f96a767abb4f8a8b92aff3cbfb5e4">qfs</a>[p-&gt;<a class="code" href="struct_vulkan_device_priv.html#a90b5a426b5114eca5015d387b7288e07">num_qfs</a>++] = hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a1ae83abcaab148c5ad0278cacf26834e">queue_family_index</a>;</div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;    <span class="keywordflow">if</span> ((hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a160efd57925b2bf9c75c94b1aafad629">queue_family_tx_index</a> != hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a1ae83abcaab148c5ad0278cacf26834e">queue_family_index</a>) &amp;&amp;</div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;        (hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a160efd57925b2bf9c75c94b1aafad629">queue_family_tx_index</a> != hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a7adbed71081998a80f83e92ed72e2821">queue_family_comp_index</a>))</div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;        p-&gt;<a class="code" href="struct_vulkan_device_priv.html#a753f96a767abb4f8a8b92aff3cbfb5e4">qfs</a>[p-&gt;<a class="code" href="struct_vulkan_device_priv.html#a90b5a426b5114eca5015d387b7288e07">num_qfs</a>++] = hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a160efd57925b2bf9c75c94b1aafad629">queue_family_tx_index</a>;</div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;    <span class="keywordflow">if</span> ((hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a7adbed71081998a80f83e92ed72e2821">queue_family_comp_index</a> != hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a1ae83abcaab148c5ad0278cacf26834e">queue_family_index</a>) &amp;&amp;</div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;        (hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a7adbed71081998a80f83e92ed72e2821">queue_family_comp_index</a> != hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a160efd57925b2bf9c75c94b1aafad629">queue_family_tx_index</a>))</div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;        p-&gt;<a class="code" href="struct_vulkan_device_priv.html#a753f96a767abb4f8a8b92aff3cbfb5e4">qfs</a>[p-&gt;<a class="code" href="struct_vulkan_device_priv.html#a90b5a426b5114eca5015d387b7288e07">num_qfs</a>++] = hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a7adbed71081998a80f83e92ed72e2821">queue_family_comp_index</a>;</div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160; </div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;    <span class="comment">/* Get device capabilities */</span></div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;    vkGetPhysicalDeviceMemoryProperties(hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a154f2a1f99a153cdb9a801b2504d6637">phys_dev</a>, &amp;p-&gt;<a class="code" href="struct_vulkan_device_priv.html#a69a23c1466b2c96396f30ba67410f51e">mprops</a>);</div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160; </div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;}</div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160; </div>
<div class="line"><a name="l01122"></a><span class="lineno"><a class="line" href="hwcontext__vulkan_8c.html#a8c2e24eefe7b3b9a36fb8c48b1a19f26"> 1122</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="hwcontext__vulkan_8c.html#a8c2e24eefe7b3b9a36fb8c48b1a19f26">vulkan_device_create</a>(<a class="code" href="struct_a_v_h_w_device_context.html">AVHWDeviceContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *device,</div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;                                <a class="code" href="struct_a_v_dictionary.html">AVDictionary</a> *<a class="code" href="tests_2movenc_8c.html#af540b728145b614e34c4e10930354b93">opts</a>, <span class="keywordtype">int</span> <a class="code" href="cbs__av1_8c.html#a67119bce106892b6dade1dc5aa405ac9">flags</a>)</div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;{</div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;    <a class="code" href="struct_vulkan_device_selection.html">VulkanDeviceSelection</a> dev_select = { 0 };</div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;    <span class="keywordflow">if</span> (device &amp;&amp; device[0]) {</div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;        <span class="keywordtype">char</span> *<a class="code" href="avrndec_8c.html#a13191ba45577b1d4f9b37d64df91eb55">end</a> = <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;        dev_select.<a class="code" href="struct_vulkan_device_selection.html#a55e3a84ddb9faa07c308fc4d5acd8046">index</a> = strtol(device, &amp;<a class="code" href="avrndec_8c.html#a13191ba45577b1d4f9b37d64df91eb55">end</a>, 10);</div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="avrndec_8c.html#a13191ba45577b1d4f9b37d64df91eb55">end</a> == device) {</div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;            dev_select.<a class="code" href="struct_vulkan_device_selection.html#a55e3a84ddb9faa07c308fc4d5acd8046">index</a> = 0;</div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;            dev_select.<a class="code" href="struct_vulkan_device_selection.html#a9b5f385cc4254f561c938df960227a01">name</a>  = device;</div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;        }</div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;    }</div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160; </div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="hwcontext__vulkan_8c.html#a632fcea203c8b3b46846667ebb33d304">vulkan_device_create_internal</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, &amp;dev_select, <a class="code" href="tests_2movenc_8c.html#af540b728145b614e34c4e10930354b93">opts</a>, <a class="code" href="cbs__av1_8c.html#a67119bce106892b6dade1dc5aa405ac9">flags</a>);</div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;}</div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160; </div>
<div class="line"><a name="l01138"></a><span class="lineno"><a class="line" href="hwcontext__vulkan_8c.html#a7b7516ac11f4ce2194aba2467268534e"> 1138</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="hwcontext__vulkan_8c.html#a7b7516ac11f4ce2194aba2467268534e">vulkan_device_derive</a>(<a class="code" href="struct_a_v_h_w_device_context.html">AVHWDeviceContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>,</div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;                                <a class="code" href="struct_a_v_h_w_device_context.html">AVHWDeviceContext</a> *src_ctx,</div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;                                <a class="code" href="struct_a_v_dictionary.html">AVDictionary</a> *<a class="code" href="tests_2movenc_8c.html#af540b728145b614e34c4e10930354b93">opts</a>, <span class="keywordtype">int</span> <a class="code" href="cbs__av1_8c.html#a67119bce106892b6dade1dc5aa405ac9">flags</a>)</div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;{</div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;    <a class="code" href="attributes_8h.html#a7ca8a3900269f92fcc7b68235dea7787">av_unused</a> <a class="code" href="struct_vulkan_device_selection.html">VulkanDeviceSelection</a> dev_select = { 0 };</div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160; </div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;    <span class="comment">/* If there&#39;s only one device on the system, then even if its not covered</span></div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;<span class="comment">     * by the following checks (e.g. non-PCIe ARM GPU), having an empty</span></div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;<span class="comment">     * dev_select will mean it&#39;ll get picked. */</span></div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;    <span class="keywordflow">switch</span>(src_ctx-&gt;<a class="code" href="struct_a_v_h_w_device_context.html#abc92603a11768828ef3aea1f9d089308">type</a>) {</div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;<span class="preprocessor">#if CONFIG_LIBDRM</span></div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;<span class="preprocessor">#if CONFIG_VAAPI</span></div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="hwcontext_8h.html#acf25724be4b066a51ad86aa9214b0d34af5dfa6181a3a6efb0f4a0c5f38d76b95">AV_HWDEVICE_TYPE_VAAPI</a>: {</div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;        <a class="code" href="struct_a_v_v_a_a_p_i_device_context.html">AVVAAPIDeviceContext</a> *src_hwctx = src_ctx-&gt;<a class="code" href="struct_a_v_h_w_device_context.html#a46055b48d1a40445d775b4ae24f77f20">hwctx</a>;</div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160; </div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">char</span> *vendor = vaQueryVendorString(src_hwctx-&gt;<a class="code" href="struct_a_v_v_a_a_p_i_device_context.html#a89951d5ccfad53ce81444773ea9f774e">display</a>);</div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;        <span class="keywordflow">if</span> (!vendor) {</div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to get device info from VAAPI!\n&quot;</span>);</div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="group__lavu__error.html#ga9c520e483ba8648495620ffdb4c491f2">AVERROR_EXTERNAL</a>;</div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;        }</div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160; </div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;        <span class="keywordflow">if</span> (strstr(vendor, <span class="stringliteral">&quot;Intel&quot;</span>))</div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;            dev_select.vendor_id = 0x8086;</div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;        <span class="keywordflow">if</span> (strstr(vendor, <span class="stringliteral">&quot;AMD&quot;</span>))</div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;            dev_select.vendor_id = 0x1002;</div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160; </div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="hwcontext__vulkan_8c.html#a632fcea203c8b3b46846667ebb33d304">vulkan_device_create_internal</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, &amp;dev_select, <a class="code" href="tests_2movenc_8c.html#af540b728145b614e34c4e10930354b93">opts</a>, <a class="code" href="cbs__av1_8c.html#a67119bce106892b6dade1dc5aa405ac9">flags</a>);</div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;    }</div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="hwcontext_8h.html#acf25724be4b066a51ad86aa9214b0d34aa04ac36fb964a5c191566a8e809de743">AV_HWDEVICE_TYPE_DRM</a>: {</div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;        <a class="code" href="struct_a_v_d_r_m_device_context.html">AVDRMDeviceContext</a> *src_hwctx = src_ctx-&gt;<a class="code" href="struct_a_v_h_w_device_context.html#a46055b48d1a40445d775b4ae24f77f20">hwctx</a>;</div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160; </div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;        drmDevice *drm_dev_info;</div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;        <span class="keywordtype">int</span> err = drmGetDevice(src_hwctx-&gt;<a class="code" href="struct_a_v_d_r_m_device_context.html#a22790a8cbf5681bbdee76a6bc99f02f5">fd</a>, &amp;drm_dev_info);</div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;        <span class="keywordflow">if</span> (err) {</div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to get device info from DRM fd!\n&quot;</span>);</div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="group__lavu__error.html#ga9c520e483ba8648495620ffdb4c491f2">AVERROR_EXTERNAL</a>;</div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;        }</div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160; </div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;        <span class="keywordflow">if</span> (drm_dev_info-&gt;bustype == DRM_BUS_PCI)</div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;            dev_select.pci_device = drm_dev_info-&gt;deviceinfo.pci-&gt;device_id;</div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160; </div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;        drmFreeDevice(&amp;drm_dev_info);</div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160; </div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="hwcontext__vulkan_8c.html#a632fcea203c8b3b46846667ebb33d304">vulkan_device_create_internal</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, &amp;dev_select, <a class="code" href="tests_2movenc_8c.html#af540b728145b614e34c4e10930354b93">opts</a>, <a class="code" href="cbs__av1_8c.html#a67119bce106892b6dade1dc5aa405ac9">flags</a>);</div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;    }</div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;<span class="preprocessor">#if CONFIG_CUDA</span></div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="hwcontext_8h.html#acf25724be4b066a51ad86aa9214b0d34a8447d4488b0fc4113c281cbdc6e7334e">AV_HWDEVICE_TYPE_CUDA</a>: {</div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;        <a class="code" href="struct_a_v_h_w_device_context.html">AVHWDeviceContext</a> *cuda_cu = src_ctx;</div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;        <a class="code" href="struct_a_v_c_u_d_a_device_context.html">AVCUDADeviceContext</a> *src_hwctx = src_ctx-&gt;<a class="code" href="struct_a_v_h_w_device_context.html#a46055b48d1a40445d775b4ae24f77f20">hwctx</a>;</div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;        <a class="code" href="struct_a_v_c_u_d_a_device_context_internal.html">AVCUDADeviceContextInternal</a> *cu_internal = src_hwctx-&gt;<a class="code" href="struct_a_v_c_u_d_a_device_context.html#ae6172fe56bd91f73d50837bdf1434aa7">internal</a>;</div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;        CudaFunctions *cu = cu_internal-&gt;<a class="code" href="struct_a_v_c_u_d_a_device_context_internal.html#a73041ed3506f9ce333218b4728b5d737">cuda_dl</a>;</div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160; </div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;        <span class="keywordtype">int</span> <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = <a class="code" href="cuviddec_8c.html#aabb147a1f2a98d37cb3ce0dd6d50b78d">CHECK_CU</a>(cu-&gt;cuDeviceGetUuid((CUuuid *)&amp;dev_select.uuid,</div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;                                               cu_internal-&gt;<a class="code" href="struct_a_v_c_u_d_a_device_context_internal.html#a5ea5820f647fa81dacff438c309810ab">cuda_device</a>));</div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> &lt; 0) {</div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to get UUID from CUDA!\n&quot;</span>);</div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="group__lavu__error.html#ga9c520e483ba8648495620ffdb4c491f2">AVERROR_EXTERNAL</a>;</div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;        }</div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160; </div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;        dev_select.has_uuid = 1;</div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160; </div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="hwcontext__vulkan_8c.html#a632fcea203c8b3b46846667ebb33d304">vulkan_device_create_internal</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, &amp;dev_select, <a class="code" href="tests_2movenc_8c.html#af540b728145b614e34c4e10930354b93">opts</a>, <a class="code" href="cbs__av1_8c.html#a67119bce106892b6dade1dc5aa405ac9">flags</a>);</div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;    }</div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;    <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOSYS);</div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;    }</div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;}</div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160; </div>
<div class="line"><a name="l01209"></a><span class="lineno"><a class="line" href="hwcontext__vulkan_8c.html#a74b57b57031e5cfdb9e471fac48ea99b"> 1209</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="hwcontext__vulkan_8c.html#a74b57b57031e5cfdb9e471fac48ea99b">vulkan_frames_get_constraints</a>(<a class="code" href="struct_a_v_h_w_device_context.html">AVHWDeviceContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>,</div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;                                         <span class="keyword">const</span> <span class="keywordtype">void</span> *hwconfig,</div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;                                         <a class="code" href="struct_a_v_h_w_frames_constraints.html">AVHWFramesConstraints</a> *constraints)</div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;{</div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;    <span class="keywordtype">int</span> count = 0;</div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;    <a class="code" href="struct_a_v_vulkan_device_context.html">AVVulkanDeviceContext</a> *hwctx = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;hwctx;</div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;    <a class="code" href="struct_vulkan_device_priv.html">VulkanDevicePriv</a> *p = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;<a class="code" href="struct_a_v_format_context.html#a8a8bec51da36db65ff864f88a85805d9">internal</a>-&gt;priv;</div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160; </div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">enum</span> <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5">AVPixelFormat</a> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a28369916d5c0317168b7d1b6c22e3ba6">AV_PIX_FMT_NB</a>; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;        count += <a class="code" href="hwcontext__vulkan_8c.html#ad0bb1569b556eddc44f41df7c1b70937">pixfmt_is_supported</a>(hwctx, <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>, p-&gt;<a class="code" href="struct_vulkan_device_priv.html#a456ab09798ca379b6534a172a9245dba">use_linear_images</a>);</div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160; </div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;<span class="preprocessor">#if CONFIG_CUDA</span></div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;    <span class="keywordflow">if</span> (p-&gt;<a class="code" href="struct_vulkan_device_priv.html#a1cdadbcb5d3249c2b7873dd538c18794">dev_is_nvidia</a>)</div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;        count++;</div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160; </div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;    constraints-&gt;<a class="code" href="struct_a_v_h_w_frames_constraints.html#aabea88093c6f85d6185ffb0852a2217f">valid_sw_formats</a> = <a class="code" href="mem_8c.html#a254f3455439c15a2c8a75b8f0235fdbd">av_malloc_array</a>(count + 1,</div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;                                                    <span class="keyword">sizeof</span>(<span class="keyword">enum</span> <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5">AVPixelFormat</a>));</div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;    <span class="keywordflow">if</span> (!constraints-&gt;<a class="code" href="struct_a_v_h_w_frames_constraints.html#aabea88093c6f85d6185ffb0852a2217f">valid_sw_formats</a>)</div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160; </div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;    count = 0;</div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">enum</span> <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5">AVPixelFormat</a> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a28369916d5c0317168b7d1b6c22e3ba6">AV_PIX_FMT_NB</a>; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="hwcontext__vulkan_8c.html#ad0bb1569b556eddc44f41df7c1b70937">pixfmt_is_supported</a>(hwctx, <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>, p-&gt;<a class="code" href="struct_vulkan_device_priv.html#a456ab09798ca379b6534a172a9245dba">use_linear_images</a>))</div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;            constraints-&gt;<a class="code" href="struct_a_v_h_w_frames_constraints.html#aabea88093c6f85d6185ffb0852a2217f">valid_sw_formats</a>[count++] = <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160; </div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;<span class="preprocessor">#if CONFIG_CUDA</span></div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;    <span class="keywordflow">if</span> (p-&gt;<a class="code" href="struct_vulkan_device_priv.html#a1cdadbcb5d3249c2b7873dd538c18794">dev_is_nvidia</a>)</div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;        constraints-&gt;<a class="code" href="struct_a_v_h_w_frames_constraints.html#aabea88093c6f85d6185ffb0852a2217f">valid_sw_formats</a>[count++] = <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a5ab95e18c0c9e5335f29121418eab314">AV_PIX_FMT_CUDA</a>;</div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;    constraints-&gt;<a class="code" href="struct_a_v_h_w_frames_constraints.html#aabea88093c6f85d6185ffb0852a2217f">valid_sw_formats</a>[count++] = <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a0e08f8a5d0fa21c3e258816a9dcce7c3">AV_PIX_FMT_NONE</a>;</div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160; </div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;    constraints-&gt;<a class="code" href="struct_a_v_h_w_frames_constraints.html#af220776925452091085139081d5d7251">min_width</a>  = 0;</div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;    constraints-&gt;<a class="code" href="struct_a_v_h_w_frames_constraints.html#a3f1aec6d1c90f77837875c2a3598be46">min_height</a> = 0;</div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;    constraints-&gt;<a class="code" href="struct_a_v_h_w_frames_constraints.html#a34e06e3397af2b83de9d78f893bf4168">max_width</a>  = p-&gt;<a class="code" href="struct_vulkan_device_priv.html#a93919fc0c25c1a74251fc14bccc70188">props</a>.properties.limits.maxImageDimension2D;</div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;    constraints-&gt;<a class="code" href="struct_a_v_h_w_frames_constraints.html#af5d3a683727f7b92abca7b7114d4e15c">max_height</a> = p-&gt;<a class="code" href="struct_vulkan_device_priv.html#a93919fc0c25c1a74251fc14bccc70188">props</a>.properties.limits.maxImageDimension2D;</div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160; </div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;    constraints-&gt;<a class="code" href="struct_a_v_h_w_frames_constraints.html#a4258bbe81f927b76b7ca5af44ba7ef6b">valid_hw_formats</a> = <a class="code" href="mem_8c.html#a254f3455439c15a2c8a75b8f0235fdbd">av_malloc_array</a>(2, <span class="keyword">sizeof</span>(<span class="keyword">enum</span> <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5">AVPixelFormat</a>));</div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;    <span class="keywordflow">if</span> (!constraints-&gt;<a class="code" href="struct_a_v_h_w_frames_constraints.html#a4258bbe81f927b76b7ca5af44ba7ef6b">valid_hw_formats</a>)</div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160; </div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;    constraints-&gt;<a class="code" href="struct_a_v_h_w_frames_constraints.html#a4258bbe81f927b76b7ca5af44ba7ef6b">valid_hw_formats</a>[0] = <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a0f77c711dcbc9a4acdea48b6b5bc50c7">AV_PIX_FMT_VULKAN</a>;</div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;    constraints-&gt;<a class="code" href="struct_a_v_h_w_frames_constraints.html#a4258bbe81f927b76b7ca5af44ba7ef6b">valid_hw_formats</a>[1] = <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a0e08f8a5d0fa21c3e258816a9dcce7c3">AV_PIX_FMT_NONE</a>;</div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160; </div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;}</div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160; </div>
<div class="line"><a name="l01256"></a><span class="lineno"><a class="line" href="hwcontext__vulkan_8c.html#a1bc9deeeb2378022c6deaf235ab97fe8"> 1256</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="hwcontext__vulkan_8c.html#a1bc9deeeb2378022c6deaf235ab97fe8">alloc_mem</a>(<a class="code" href="struct_a_v_h_w_device_context.html">AVHWDeviceContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, VkMemoryRequirements *req,</div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;                     VkMemoryPropertyFlagBits req_flags, <span class="keyword">const</span> <span class="keywordtype">void</span> *alloc_extension,</div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;                     VkMemoryPropertyFlagBits *mem_flags, VkDeviceMemory *mem)</div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;{</div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;    VkResult <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>;</div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="gxfenc_8c.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a> = -1;</div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;    <a class="code" href="struct_vulkan_device_priv.html">VulkanDevicePriv</a> *p = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;<a class="code" href="struct_a_v_format_context.html#a8a8bec51da36db65ff864f88a85805d9">internal</a>-&gt;priv;</div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;    <a class="code" href="struct_a_v_vulkan_device_context.html">AVVulkanDeviceContext</a> *dev_hwctx = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;hwctx;</div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;    VkMemoryAllocateInfo alloc_info = {</div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;        .sType          = VK_STRUCTURE_TYPE_MEMORY_ALLOCATE_INFO,</div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;        .pNext          = alloc_extension,</div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;        .allocationSize = req-&gt;size,</div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;    };</div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160; </div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;    <span class="comment">/* The vulkan spec requires memory types to be sorted in the &quot;optimal&quot;</span></div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;<span class="comment">     * order, so the first matching type we find will be the best/fastest one */</span></div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; p-&gt;<a class="code" href="struct_vulkan_device_priv.html#a69a23c1466b2c96396f30ba67410f51e">mprops</a>.memoryTypeCount; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;        <span class="comment">/* The memory type must be supported by the requirements (bitfield) */</span></div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;        <span class="keywordflow">if</span> (!(req-&gt;memoryTypeBits &amp; (1 &lt;&lt; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)))</div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160; </div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;        <span class="comment">/* The memory type flags must include our properties */</span></div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;        <span class="keywordflow">if</span> ((p-&gt;<a class="code" href="struct_vulkan_device_priv.html#a69a23c1466b2c96396f30ba67410f51e">mprops</a>.memoryTypes[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].propertyFlags &amp; req_flags) != req_flags)</div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160; </div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;        <span class="comment">/* Found a suitable memory type */</span></div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;        <a class="code" href="gxfenc_8c.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a> = <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;    }</div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160; </div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="gxfenc_8c.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a> &lt; 0) {</div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;No memory type found for flags 0x%x\n&quot;</span>,</div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;               req_flags);</div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EINVAL);</div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;    }</div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160; </div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;    alloc_info.memoryTypeIndex = <a class="code" href="gxfenc_8c.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a>;</div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160; </div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;    <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = vkAllocateMemory(dev_hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a53a07d4474261e4e14ec03c5d15f71da">act_dev</a>, &amp;alloc_info,</div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;                           dev_hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a4a617020274526c26e265781aefcd22c">alloc</a>, mem);</div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> != VK_SUCCESS) {</div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to allocate memory: %s\n&quot;</span>,</div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;               <a class="code" href="hwcontext__vulkan_8c.html#ab4395598042453295899a91b26ad013b">vk_ret2str</a>(<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>));</div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;    }</div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160; </div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;    *mem_flags |= p-&gt;<a class="code" href="struct_vulkan_device_priv.html#a69a23c1466b2c96396f30ba67410f51e">mprops</a>.memoryTypes[<a class="code" href="gxfenc_8c.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a>].propertyFlags;</div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160; </div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;}</div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160; </div>
<div class="line"><a name="l01307"></a><span class="lineno"><a class="line" href="hwcontext__vulkan_8c.html#adcb9e9e10aa62d9ffc1ff49bf8fea423"> 1307</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="hwcontext__vulkan_8c.html#adcb9e9e10aa62d9ffc1ff49bf8fea423">vulkan_free_internal</a>(<a class="code" href="struct_a_v_vk_frame_internal.html">AVVkFrameInternal</a> *<span class="keyword">internal</span>)</div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;{</div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;    <span class="keywordflow">if</span> (!<span class="keyword">internal</span>)</div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160; </div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;<span class="preprocessor">#if CONFIG_CUDA</span></div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;    <span class="keywordflow">if</span> (internal-&gt;cuda_fc_ref) {</div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;        <a class="code" href="struct_a_v_h_w_frames_context.html">AVHWFramesContext</a> *cuda_fc = (<a class="code" href="struct_a_v_h_w_frames_context.html">AVHWFramesContext</a> *)internal-&gt;cuda_fc_ref-&gt;data;</div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;        <span class="keywordtype">int</span> <a class="code" href="llviddspenc_8c.html#a39de7029a33bc3271ae437de0a38c343">planes</a> = <a class="code" href="pixdesc_8c.html#a118df1d607abd7484f874b3d7ea8823a">av_pix_fmt_count_planes</a>(cuda_fc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#a663a9aceca97aa7b2426c9aba6543e4a">sw_format</a>);</div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;        <a class="code" href="struct_a_v_h_w_device_context.html">AVHWDeviceContext</a> *cuda_cu = cuda_fc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#ac9a7dbd0cbfcabc0b1529cb34cf53b6d">device_ctx</a>;</div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;        <a class="code" href="struct_a_v_c_u_d_a_device_context.html">AVCUDADeviceContext</a> *cuda_dev = cuda_cu-&gt;<a class="code" href="struct_a_v_h_w_device_context.html#a46055b48d1a40445d775b4ae24f77f20">hwctx</a>;</div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;        <a class="code" href="struct_a_v_c_u_d_a_device_context_internal.html">AVCUDADeviceContextInternal</a> *cu_internal = cuda_dev-&gt;<a class="code" href="struct_a_v_c_u_d_a_device_context.html#ae6172fe56bd91f73d50837bdf1434aa7">internal</a>;</div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;        CudaFunctions *cu = cu_internal-&gt;<a class="code" href="struct_a_v_c_u_d_a_device_context_internal.html#a73041ed3506f9ce333218b4728b5d737">cuda_dl</a>;</div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160; </div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="llviddspenc_8c.html#a39de7029a33bc3271ae437de0a38c343">planes</a>; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;            <span class="keywordflow">if</span> (internal-&gt;cu_sem[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>])</div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;                <a class="code" href="cuviddec_8c.html#aabb147a1f2a98d37cb3ce0dd6d50b78d">CHECK_CU</a>(cu-&gt;cuDestroyExternalSemaphore(internal-&gt;cu_sem[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>]));</div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;            <span class="keywordflow">if</span> (internal-&gt;cu_mma[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>])</div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;                <a class="code" href="cuviddec_8c.html#aabb147a1f2a98d37cb3ce0dd6d50b78d">CHECK_CU</a>(cu-&gt;cuMipmappedArrayDestroy(internal-&gt;cu_mma[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>]));</div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;            <span class="keywordflow">if</span> (internal-&gt;ext_mem[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>])</div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;                <a class="code" href="cuviddec_8c.html#aabb147a1f2a98d37cb3ce0dd6d50b78d">CHECK_CU</a>(cu-&gt;cuDestroyExternalMemory(internal-&gt;ext_mem[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>]));</div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;        }</div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160; </div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;        <a class="code" href="group__lavu__buffer.html#ga135e9e929b5033bb8f68322497b2effc">av_buffer_unref</a>(&amp;internal-&gt;cuda_fc_ref);</div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;    }</div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160; </div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#a079eab092887563f2bef9106c6120089">av_free</a>(<span class="keyword">internal</span>);</div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;}</div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160; </div>
<div class="line"><a name="l01337"></a><span class="lineno"><a class="line" href="hwcontext__vulkan_8c.html#a608f002433583fc02957e4884c9bb981"> 1337</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="hwcontext__vulkan_8c.html#a608f002433583fc02957e4884c9bb981">vulkan_frame_free</a>(<span class="keywordtype">void</span> *opaque, <a class="code" href="audio__convert_8c.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> *<a class="code" href="mxf_8c.html#a084824fc871e38157790c99ae1240842">data</a>)</div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;{</div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;    <a class="code" href="struct_a_v_vk_frame.html">AVVkFrame</a> *<a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a> = (<a class="code" href="struct_a_v_vk_frame.html">AVVkFrame</a> *)<a class="code" href="mxf_8c.html#a084824fc871e38157790c99ae1240842">data</a>;</div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;    <a class="code" href="struct_a_v_h_w_frames_context.html">AVHWFramesContext</a> *hwfc = opaque;</div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;    <a class="code" href="struct_a_v_vulkan_device_context.html">AVVulkanDeviceContext</a> *hwctx = hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#ac9a7dbd0cbfcabc0b1529cb34cf53b6d">device_ctx</a>-&gt;<a class="code" href="struct_a_v_h_w_device_context.html#a46055b48d1a40445d775b4ae24f77f20">hwctx</a>;</div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="llviddspenc_8c.html#a39de7029a33bc3271ae437de0a38c343">planes</a> = <a class="code" href="pixdesc_8c.html#a118df1d607abd7484f874b3d7ea8823a">av_pix_fmt_count_planes</a>(hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#a663a9aceca97aa7b2426c9aba6543e4a">sw_format</a>);</div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160; </div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;    <a class="code" href="hwcontext__vulkan_8c.html#adcb9e9e10aa62d9ffc1ff49bf8fea423">vulkan_free_internal</a>(<a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a>-&gt;internal);</div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160; </div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="llviddspenc_8c.html#a39de7029a33bc3271ae437de0a38c343">planes</a>; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;        vkDestroyImage(hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a53a07d4474261e4e14ec03c5d15f71da">act_dev</a>, <a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a>-&gt;img[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>], hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a4a617020274526c26e265781aefcd22c">alloc</a>);</div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;        vkFreeMemory(hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a53a07d4474261e4e14ec03c5d15f71da">act_dev</a>, <a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a>-&gt;mem[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>], hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a4a617020274526c26e265781aefcd22c">alloc</a>);</div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;        vkDestroySemaphore(hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a53a07d4474261e4e14ec03c5d15f71da">act_dev</a>, <a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a>-&gt;sem[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>], hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a4a617020274526c26e265781aefcd22c">alloc</a>);</div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;    }</div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160; </div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#a079eab092887563f2bef9106c6120089">av_free</a>(<a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a>);</div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;}</div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160; </div>
<div class="line"><a name="l01355"></a><span class="lineno"><a class="line" href="hwcontext__vulkan_8c.html#a333a3a6e9768bf43163090416c7608ad"> 1355</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="hwcontext__vulkan_8c.html#a333a3a6e9768bf43163090416c7608ad">alloc_bind_mem</a>(<a class="code" href="struct_a_v_h_w_frames_context.html">AVHWFramesContext</a> *hwfc, <a class="code" href="struct_a_v_vk_frame.html">AVVkFrame</a> *<a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a>,</div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;                          <span class="keywordtype">void</span> *alloc_pnext, <span class="keywordtype">size_t</span> alloc_pnext_stride)</div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;{</div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;    <span class="keywordtype">int</span> err;</div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;    VkResult <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>;</div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;    <a class="code" href="struct_a_v_h_w_device_context.html">AVHWDeviceContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a> = hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#ac9a7dbd0cbfcabc0b1529cb34cf53b6d">device_ctx</a>;</div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;    <a class="code" href="struct_vulkan_device_priv.html">VulkanDevicePriv</a> *p = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;<a class="code" href="struct_a_v_format_context.html#a8a8bec51da36db65ff864f88a85805d9">internal</a>-&gt;priv;</div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="llviddspenc_8c.html#a39de7029a33bc3271ae437de0a38c343">planes</a> = <a class="code" href="pixdesc_8c.html#a118df1d607abd7484f874b3d7ea8823a">av_pix_fmt_count_planes</a>(hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#a663a9aceca97aa7b2426c9aba6543e4a">sw_format</a>);</div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;    VkBindImageMemoryInfo bind_info[<a class="code" href="frame_8h.html#add80189702cf0f5ea82718576fb43201">AV_NUM_DATA_POINTERS</a>] = { { 0 } };</div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160; </div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;    <a class="code" href="struct_a_v_vulkan_device_context.html">AVVulkanDeviceContext</a> *hwctx = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;hwctx;</div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160; </div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="llviddspenc_8c.html#a39de7029a33bc3271ae437de0a38c343">planes</a>; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;        <span class="keywordtype">int</span> use_ded_mem;</div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;        VkImageMemoryRequirementsInfo2 req_desc = {</div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;            .sType = VK_STRUCTURE_TYPE_IMAGE_MEMORY_REQUIREMENTS_INFO_2,</div>
<div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;            .image = <a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a>-&gt;img[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>],</div>
<div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;        };</div>
<div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;        VkMemoryDedicatedAllocateInfo ded_alloc = {</div>
<div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;            .sType = VK_STRUCTURE_TYPE_MEMORY_DEDICATED_ALLOCATE_INFO,</div>
<div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;            .pNext = (<span class="keywordtype">void</span> *)(((<a class="code" href="audio__convert_8c.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> *)alloc_pnext) + <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>*alloc_pnext_stride),</div>
<div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;        };</div>
<div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;        VkMemoryDedicatedRequirements ded_req = {</div>
<div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;            .sType = VK_STRUCTURE_TYPE_MEMORY_DEDICATED_REQUIREMENTS,</div>
<div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;        };</div>
<div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;        VkMemoryRequirements2 req = {</div>
<div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;            .sType = VK_STRUCTURE_TYPE_MEMORY_REQUIREMENTS_2,</div>
<div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;            .pNext = &amp;ded_req,</div>
<div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;        };</div>
<div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160; </div>
<div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;        vkGetImageMemoryRequirements2(hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a53a07d4474261e4e14ec03c5d15f71da">act_dev</a>, &amp;req_desc, &amp;req);</div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160; </div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a>-&gt;tiling == VK_IMAGE_TILING_LINEAR)</div>
<div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;            req.memoryRequirements.size = <a class="code" href="macros_8h.html#acae4ba605b3a7d535b7ac058ffe96892">FFALIGN</a>(req.memoryRequirements.size,</div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;                                                  p-&gt;<a class="code" href="struct_vulkan_device_priv.html#a93919fc0c25c1a74251fc14bccc70188">props</a>.properties.limits.minMemoryMapAlignment);</div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160; </div>
<div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;        <span class="comment">/* In case the implementation prefers/requires dedicated allocation */</span></div>
<div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;        use_ded_mem = ded_req.prefersDedicatedAllocation |</div>
<div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;                      ded_req.requiresDedicatedAllocation;</div>
<div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;        <span class="keywordflow">if</span> (use_ded_mem)</div>
<div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;            ded_alloc.image = <a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a>-&gt;img[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160; </div>
<div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;        <span class="comment">/* Allocate memory */</span></div>
<div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;        <span class="keywordflow">if</span> ((err = <a class="code" href="hwcontext__vulkan_8c.html#a1bc9deeeb2378022c6deaf235ab97fe8">alloc_mem</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, &amp;req.memoryRequirements,</div>
<div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;                             <a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a>-&gt;tiling == VK_IMAGE_TILING_LINEAR ?</div>
<div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;                             VK_MEMORY_PROPERTY_HOST_VISIBLE_BIT :</div>
<div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;                             VK_MEMORY_PROPERTY_DEVICE_LOCAL_BIT,</div>
<div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;                             use_ded_mem ? &amp;ded_alloc : (<span class="keywordtype">void</span> *)ded_alloc.pNext,</div>
<div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;                             &amp;<a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a>-&gt;flags, &amp;<a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a>-&gt;mem[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>])))</div>
<div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;            <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160; </div>
<div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;        <a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a>-&gt;size[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>] = req.memoryRequirements.size;</div>
<div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;        bind_info[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].sType  = VK_STRUCTURE_TYPE_BIND_IMAGE_MEMORY_INFO;</div>
<div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;        bind_info[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].image  = <a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a>-&gt;img[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;        bind_info[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].memory = <a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a>-&gt;mem[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;    }</div>
<div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160; </div>
<div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;    <span class="comment">/* Bind the allocated memory to the images */</span></div>
<div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;    <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = vkBindImageMemory2(hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a53a07d4474261e4e14ec03c5d15f71da">act_dev</a>, <a class="code" href="llviddspenc_8c.html#a39de7029a33bc3271ae437de0a38c343">planes</a>, bind_info);</div>
<div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> != VK_SUCCESS) {</div>
<div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to bind memory: %s\n&quot;</span>,</div>
<div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;               <a class="code" href="hwcontext__vulkan_8c.html#ab4395598042453295899a91b26ad013b">vk_ret2str</a>(<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>));</div>
<div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="group__lavu__error.html#ga9c520e483ba8648495620ffdb4c491f2">AVERROR_EXTERNAL</a>;</div>
<div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;    }</div>
<div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160; </div>
<div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;}</div>
<div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160; </div>
<div class="line"><a name="l01423"></a><span class="lineno"><a class="line" href="hwcontext__vulkan_8c.html#af94790aab5b000aa1b44ce817563076f"> 1423</a></span>&#160;<span class="keyword">enum</span> <a class="code" href="hwcontext__vulkan_8c.html#af94790aab5b000aa1b44ce817563076f">PrepMode</a> {</div>
<div class="line"><a name="l01424"></a><span class="lineno"><a class="line" href="hwcontext__vulkan_8c.html#af94790aab5b000aa1b44ce817563076fa33f0896bb2828e1ee77b85224f4f658d"> 1424</a></span>&#160;    <a class="code" href="hwcontext__vulkan_8c.html#af94790aab5b000aa1b44ce817563076fa33f0896bb2828e1ee77b85224f4f658d">PREP_MODE_WRITE</a>,</div>
<div class="line"><a name="l01425"></a><span class="lineno"><a class="line" href="hwcontext__vulkan_8c.html#af94790aab5b000aa1b44ce817563076fa8d525c0ec6b8968069e12896b3658f13"> 1425</a></span>&#160;    <a class="code" href="hwcontext__vulkan_8c.html#af94790aab5b000aa1b44ce817563076fa8d525c0ec6b8968069e12896b3658f13">PREP_MODE_RO_SHADER</a>,</div>
<div class="line"><a name="l01426"></a><span class="lineno"><a class="line" href="hwcontext__vulkan_8c.html#af94790aab5b000aa1b44ce817563076faa880fb96e7667415366a5b8ac8525090"> 1426</a></span>&#160;    <a class="code" href="hwcontext__vulkan_8c.html#af94790aab5b000aa1b44ce817563076faa880fb96e7667415366a5b8ac8525090">PREP_MODE_EXTERNAL_EXPORT</a>,</div>
<div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;};</div>
<div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160; </div>
<div class="line"><a name="l01429"></a><span class="lineno"><a class="line" href="hwcontext__vulkan_8c.html#aa2579750bda1abdf414c2f3f7de6d9fc"> 1429</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="hwcontext__vulkan_8c.html#aa2579750bda1abdf414c2f3f7de6d9fc">prepare_frame</a>(<a class="code" href="struct_a_v_h_w_frames_context.html">AVHWFramesContext</a> *hwfc, <a class="code" href="struct_vulkan_exec_ctx.html">VulkanExecCtx</a> *ectx,</div>
<div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;                         <a class="code" href="struct_a_v_vk_frame.html">AVVkFrame</a> *<a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>, <span class="keyword">enum</span> <a class="code" href="hwcontext__vulkan_8c.html#af94790aab5b000aa1b44ce817563076f">PrepMode</a> pmode)</div>
<div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;{</div>
<div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;    <span class="keywordtype">int</span> err;</div>
<div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;    uint32_t dst_qf;</div>
<div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;    VkImageLayout new_layout;</div>
<div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;    VkAccessFlags new_access;</div>
<div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="llviddspenc_8c.html#a39de7029a33bc3271ae437de0a38c343">planes</a> = <a class="code" href="pixdesc_8c.html#a118df1d607abd7484f874b3d7ea8823a">av_pix_fmt_count_planes</a>(hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#a663a9aceca97aa7b2426c9aba6543e4a">sw_format</a>);</div>
<div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160; </div>
<div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;    VkImageMemoryBarrier img_bar[<a class="code" href="frame_8h.html#add80189702cf0f5ea82718576fb43201">AV_NUM_DATA_POINTERS</a>] = { 0 };</div>
<div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160; </div>
<div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;    VkSubmitInfo s_info = {</div>
<div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;        .sType                = VK_STRUCTURE_TYPE_SUBMIT_INFO,</div>
<div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;        .pSignalSemaphores    = <a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>-&gt;sem,</div>
<div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;        .signalSemaphoreCount = <a class="code" href="llviddspenc_8c.html#a39de7029a33bc3271ae437de0a38c343">planes</a>,</div>
<div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;    };</div>
<div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160; </div>
<div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;    VkPipelineStageFlagBits wait_st[<a class="code" href="frame_8h.html#add80189702cf0f5ea82718576fb43201">AV_NUM_DATA_POINTERS</a>];</div>
<div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="llviddspenc_8c.html#a39de7029a33bc3271ae437de0a38c343">planes</a>; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;        wait_st[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>] = VK_PIPELINE_STAGE_TOP_OF_PIPE_BIT;</div>
<div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160; </div>
<div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;    <span class="keywordflow">switch</span> (pmode) {</div>
<div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="hwcontext__vulkan_8c.html#af94790aab5b000aa1b44ce817563076fa33f0896bb2828e1ee77b85224f4f658d">PREP_MODE_WRITE</a>:</div>
<div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;        new_layout = VK_IMAGE_LAYOUT_TRANSFER_DST_OPTIMAL;</div>
<div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;        new_access = VK_ACCESS_TRANSFER_WRITE_BIT;</div>
<div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;        dst_qf     = VK_QUEUE_FAMILY_IGNORED;</div>
<div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="hwcontext__vulkan_8c.html#af94790aab5b000aa1b44ce817563076fa8d525c0ec6b8968069e12896b3658f13">PREP_MODE_RO_SHADER</a>:</div>
<div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;        new_layout = VK_IMAGE_LAYOUT_TRANSFER_SRC_OPTIMAL;</div>
<div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;        new_access = VK_ACCESS_TRANSFER_READ_BIT;</div>
<div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;        dst_qf     = VK_QUEUE_FAMILY_IGNORED;</div>
<div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="hwcontext__vulkan_8c.html#af94790aab5b000aa1b44ce817563076faa880fb96e7667415366a5b8ac8525090">PREP_MODE_EXTERNAL_EXPORT</a>:</div>
<div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;        new_layout = VK_IMAGE_LAYOUT_GENERAL;</div>
<div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;        new_access = VK_ACCESS_MEMORY_READ_BIT | VK_ACCESS_MEMORY_WRITE_BIT;</div>
<div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;        dst_qf     = VK_QUEUE_FAMILY_EXTERNAL_KHR;</div>
<div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;        s_info.pWaitSemaphores = <a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>-&gt;sem;</div>
<div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;        s_info.pWaitDstStageMask = wait_st;</div>
<div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;        s_info.waitSemaphoreCount = <a class="code" href="llviddspenc_8c.html#a39de7029a33bc3271ae437de0a38c343">planes</a>;</div>
<div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;    }</div>
<div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160; </div>
<div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;    <span class="keywordflow">if</span> ((err = <a class="code" href="hwcontext__vulkan_8c.html#a0c938954f0b293626efb96e7fc161e1f">wait_start_exec_ctx</a>(hwfc, ectx)))</div>
<div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;        <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160; </div>
<div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;    <span class="comment">/* Change the image layout to something more optimal for writes.</span></div>
<div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;<span class="comment">     * This also signals the newly created semaphore, making it usable</span></div>
<div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;<span class="comment">     * for synchronization */</span></div>
<div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="llviddspenc_8c.html#a39de7029a33bc3271ae437de0a38c343">planes</a>; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;        img_bar[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].sType = VK_STRUCTURE_TYPE_IMAGE_MEMORY_BARRIER;</div>
<div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;        img_bar[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].srcAccessMask = 0x0;</div>
<div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;        img_bar[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].dstAccessMask = new_access;</div>
<div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;        img_bar[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].oldLayout = <a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>-&gt;layout[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;        img_bar[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].newLayout = new_layout;</div>
<div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;        img_bar[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].srcQueueFamilyIndex = VK_QUEUE_FAMILY_IGNORED;</div>
<div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;        img_bar[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].dstQueueFamilyIndex = dst_qf;</div>
<div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;        img_bar[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].image = <a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>-&gt;img[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;        img_bar[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].subresourceRange.levelCount = 1;</div>
<div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;        img_bar[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].subresourceRange.layerCount = 1;</div>
<div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;        img_bar[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].subresourceRange.aspectMask = VK_IMAGE_ASPECT_COLOR_BIT;</div>
<div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160; </div>
<div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;        <a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>-&gt;layout[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>] = img_bar[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].newLayout;</div>
<div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;        <a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>-&gt;access[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>] = img_bar[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].dstAccessMask;</div>
<div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;    }</div>
<div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160; </div>
<div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;    vkCmdPipelineBarrier(<a class="code" href="hwcontext__vulkan_8c.html#a4b19998e390caea2fbdeb64a7313de9f">get_buf_exec_ctx</a>(hwfc, ectx),</div>
<div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;                         VK_PIPELINE_STAGE_TOP_OF_PIPE_BIT,</div>
<div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;                         VK_PIPELINE_STAGE_TRANSFER_BIT,</div>
<div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;                         0, 0, <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0, <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="llviddspenc_8c.html#a39de7029a33bc3271ae437de0a38c343">planes</a>, img_bar);</div>
<div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160; </div>
<div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="hwcontext__vulkan_8c.html#a0040d6813ae4cb493e185f6ba869742c">submit_exec_ctx</a>(hwfc, ectx, &amp;s_info, 0);</div>
<div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;}</div>
<div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160; </div>
<div class="line"><a name="l01502"></a><span class="lineno"><a class="line" href="hwcontext__vulkan_8c.html#af9240320c6e8aa3c937ffe82c77be676"> 1502</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="hwcontext__vulkan_8c.html#af9240320c6e8aa3c937ffe82c77be676">create_frame</a>(<a class="code" href="struct_a_v_h_w_frames_context.html">AVHWFramesContext</a> *hwfc, <a class="code" href="struct_a_v_vk_frame.html">AVVkFrame</a> **<a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>,</div>
<div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;                        VkImageTiling tiling, VkImageUsageFlagBits <a class="code" href="floatimg__cmp_8c.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a>,</div>
<div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;                        <span class="keywordtype">void</span> *create_pnext)</div>
<div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;{</div>
<div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;    <span class="keywordtype">int</span> err;</div>
<div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;    VkResult <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>;</div>
<div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;    <a class="code" href="struct_a_v_h_w_device_context.html">AVHWDeviceContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a> = hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#ac9a7dbd0cbfcabc0b1529cb34cf53b6d">device_ctx</a>;</div>
<div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;    <a class="code" href="struct_vulkan_device_priv.html">VulkanDevicePriv</a> *p = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;<a class="code" href="struct_a_v_format_context.html#a8a8bec51da36db65ff864f88a85805d9">internal</a>-&gt;priv;</div>
<div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;    <a class="code" href="struct_a_v_vulkan_device_context.html">AVVulkanDeviceContext</a> *hwctx = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;hwctx;</div>
<div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;    <span class="keyword">enum</span> <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5">AVPixelFormat</a> <a class="code" href="filter__design_8txt.html#a7d537039ea0e18164d9edb0b5ca984dd">format</a> = hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#a663a9aceca97aa7b2426c9aba6543e4a">sw_format</a>;</div>
<div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;    <span class="keyword">const</span> VkFormat *img_fmts = <a class="code" href="hwcontext__vulkan_8c.html#ac3dce3efdada0dab3fd7fca01e374871">av_vkfmt_from_pixfmt</a>(<a class="code" href="filter__design_8txt.html#a7d537039ea0e18164d9edb0b5ca984dd">format</a>);</div>
<div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="llviddspenc_8c.html#a39de7029a33bc3271ae437de0a38c343">planes</a> = <a class="code" href="pixdesc_8c.html#a118df1d607abd7484f874b3d7ea8823a">av_pix_fmt_count_planes</a>(<a class="code" href="filter__design_8txt.html#a7d537039ea0e18164d9edb0b5ca984dd">format</a>);</div>
<div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160; </div>
<div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;    VkExportSemaphoreCreateInfo ext_sem_info = {</div>
<div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;        .sType = VK_STRUCTURE_TYPE_EXPORT_SEMAPHORE_CREATE_INFO,</div>
<div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;        .handleTypes = VK_EXTERNAL_SEMAPHORE_HANDLE_TYPE_OPAQUE_FD_BIT,</div>
<div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;    };</div>
<div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160; </div>
<div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;    VkSemaphoreCreateInfo sem_spawn = {</div>
<div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;        .sType = VK_STRUCTURE_TYPE_SEMAPHORE_CREATE_INFO,</div>
<div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;        .pNext = p-&gt;<a class="code" href="struct_vulkan_device_priv.html#a895a041d77f8253cb0842c23e54593f2">extensions</a> &amp; <a class="code" href="hwcontext__vulkan_8c.html#adfa9f1974c8c5348db6b4034e3aa7b4eaeeeb9df365a55ef16cfca45352cf84c4">EXT_EXTERNAL_FD_SEM</a> ? &amp;ext_sem_info : <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;    };</div>
<div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160; </div>
<div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;    <a class="code" href="struct_a_v_vk_frame.html">AVVkFrame</a> *<a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a> = <a class="code" href="hwcontext__vulkan_8c.html#a951b6233520dcb4be94fd7d4e58a39af">av_vk_frame_alloc</a>();</div>
<div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a>) {</div>
<div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to allocate memory for AVVkFrame!\n&quot;</span>);</div>
<div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;    }</div>
<div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160; </div>
<div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;    <span class="comment">/* Create the images */</span></div>
<div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="llviddspenc_8c.html#a39de7029a33bc3271ae437de0a38c343">planes</a>; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;        <span class="keyword">const</span> <a class="code" href="struct_a_v_pix_fmt_descriptor.html">AVPixFmtDescriptor</a> *<a class="code" href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a> = <a class="code" href="pixdesc_8c.html#afe0c3e8aef5173de28bbdaea4298f5f0">av_pix_fmt_desc_get</a>(<a class="code" href="filter__design_8txt.html#a7d537039ea0e18164d9edb0b5ca984dd">format</a>);</div>
<div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;        <span class="keywordtype">int</span> <a class="code" href="llviddspenc_8c.html#aba9ed0487b0aa23eba534648df8384c0">w</a> = hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#a9e6f29d0f744930cdd0e8bdff8771520">width</a>;</div>
<div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;        <span class="keywordtype">int</span> <a class="code" href="vp9dsp__template_8c.html#a5e36941b3d856737e81516acd45edc50">h</a> = hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#ae61bbe1d8645a0c573085e29f1d0a58f">height</a>;</div>
<div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> p_w = <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &gt; 0 ? <a class="code" href="common_8h.html#a5d13452b0fac0d41b08ea2e49ea6eaa5">AV_CEIL_RSHIFT</a>(<a class="code" href="llviddspenc_8c.html#aba9ed0487b0aa23eba534648df8384c0">w</a>, <a class="code" href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a>-&gt;log2_chroma_w) : <a class="code" href="llviddspenc_8c.html#aba9ed0487b0aa23eba534648df8384c0">w</a>;</div>
<div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> p_h = <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &gt; 0 ? <a class="code" href="common_8h.html#a5d13452b0fac0d41b08ea2e49ea6eaa5">AV_CEIL_RSHIFT</a>(<a class="code" href="vp9dsp__template_8c.html#a5e36941b3d856737e81516acd45edc50">h</a>, <a class="code" href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a>-&gt;log2_chroma_h) : <a class="code" href="vp9dsp__template_8c.html#a5e36941b3d856737e81516acd45edc50">h</a>;</div>
<div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160; </div>
<div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;        VkImageCreateInfo image_create_info = {</div>
<div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;            .sType                 = VK_STRUCTURE_TYPE_IMAGE_CREATE_INFO,</div>
<div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;            .pNext                 = create_pnext,</div>
<div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;            .imageType             = VK_IMAGE_TYPE_2D,</div>
<div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;            .format                = img_fmts[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>],</div>
<div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;            .extent.width          = p_w,</div>
<div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;            .extent.height         = p_h,</div>
<div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;            .extent.depth          = 1,</div>
<div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;            .mipLevels             = 1,</div>
<div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;            .arrayLayers           = 1,</div>
<div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;            .flags                 = VK_IMAGE_CREATE_ALIAS_BIT,</div>
<div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;            .tiling                = tiling,</div>
<div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;            .initialLayout         = VK_IMAGE_LAYOUT_UNDEFINED,</div>
<div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;            .usage                 = <a class="code" href="floatimg__cmp_8c.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a>,</div>
<div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;            .samples               = VK_SAMPLE_COUNT_1_BIT,</div>
<div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;            .pQueueFamilyIndices   = p-&gt;<a class="code" href="struct_vulkan_device_priv.html#a753f96a767abb4f8a8b92aff3cbfb5e4">qfs</a>,</div>
<div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;            .queueFamilyIndexCount = p-&gt;<a class="code" href="struct_vulkan_device_priv.html#a90b5a426b5114eca5015d387b7288e07">num_qfs</a>,</div>
<div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;            .sharingMode           = p-&gt;<a class="code" href="struct_vulkan_device_priv.html#a90b5a426b5114eca5015d387b7288e07">num_qfs</a> &gt; 1 ? VK_SHARING_MODE_CONCURRENT :</div>
<div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;                                                      VK_SHARING_MODE_EXCLUSIVE,</div>
<div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;        };</div>
<div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160; </div>
<div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;        <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = vkCreateImage(hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a53a07d4474261e4e14ec03c5d15f71da">act_dev</a>, &amp;image_create_info,</div>
<div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;                            hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a4a617020274526c26e265781aefcd22c">alloc</a>, &amp;<a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a>-&gt;img[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div>
<div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> != VK_SUCCESS) {</div>
<div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Image creation failure: %s\n&quot;</span>,</div>
<div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;                   <a class="code" href="hwcontext__vulkan_8c.html#ab4395598042453295899a91b26ad013b">vk_ret2str</a>(<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>));</div>
<div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;            err = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EINVAL);</div>
<div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;            <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;        }</div>
<div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160; </div>
<div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;        <span class="comment">/* Create semaphore */</span></div>
<div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;        <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = vkCreateSemaphore(hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a53a07d4474261e4e14ec03c5d15f71da">act_dev</a>, &amp;sem_spawn,</div>
<div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;                                hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a4a617020274526c26e265781aefcd22c">alloc</a>, &amp;<a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a>-&gt;sem[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div>
<div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> != VK_SUCCESS) {</div>
<div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(hwctx, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to create semaphore: %s\n&quot;</span>,</div>
<div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;                   <a class="code" href="hwcontext__vulkan_8c.html#ab4395598042453295899a91b26ad013b">vk_ret2str</a>(<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>));</div>
<div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="group__lavu__error.html#ga9c520e483ba8648495620ffdb4c491f2">AVERROR_EXTERNAL</a>;</div>
<div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;        }</div>
<div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160; </div>
<div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;        <a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a>-&gt;layout[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>] = image_create_info.initialLayout;</div>
<div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;        <a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a>-&gt;access[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>] = 0x0;</div>
<div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;    }</div>
<div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160; </div>
<div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;    <a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a>-&gt;flags     = 0x0;</div>
<div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;    <a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a>-&gt;tiling    = tiling;</div>
<div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160; </div>
<div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;    *<a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a> = <a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a>;</div>
<div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160; </div>
<div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;<a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>:</div>
<div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;    <a class="code" href="hwcontext__vulkan_8c.html#a608f002433583fc02957e4884c9bb981">vulkan_frame_free</a>(hwfc, (<a class="code" href="audio__convert_8c.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> *)<a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a>);</div>
<div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;    <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;}</div>
<div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160; </div>
<div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;<span class="comment">/* Checks if an export flag is enabled, and if it is ORs it with *iexp */</span></div>
<div class="line"><a name="l01594"></a><span class="lineno"><a class="line" href="hwcontext__vulkan_8c.html#a481ad49d98f76838642e2f30dd01b8d7"> 1594</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="hwcontext__vulkan_8c.html#a481ad49d98f76838642e2f30dd01b8d7">try_export_flags</a>(<a class="code" href="struct_a_v_h_w_frames_context.html">AVHWFramesContext</a> *hwfc,</div>
<div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;                             VkExternalMemoryHandleTypeFlags *comp_handle_types,</div>
<div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;                             VkExternalMemoryHandleTypeFlagBits *iexp,</div>
<div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;                             VkExternalMemoryHandleTypeFlagBits <a class="code" href="eval_8c.html#afc05d41e1a0fc024ac21072d11d4f263">exp</a>)</div>
<div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;{</div>
<div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;    VkResult <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>;</div>
<div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;    <a class="code" href="struct_a_v_vulkan_frames_context.html">AVVulkanFramesContext</a> *hwctx = hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#a54e38c3e4355321e23e0f4c7411cb8ee">hwctx</a>;</div>
<div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;    <a class="code" href="struct_a_v_vulkan_device_context.html">AVVulkanDeviceContext</a> *dev_hwctx = hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#ac9a7dbd0cbfcabc0b1529cb34cf53b6d">device_ctx</a>-&gt;<a class="code" href="struct_a_v_h_w_device_context.html#a46055b48d1a40445d775b4ae24f77f20">hwctx</a>;</div>
<div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;    VkExternalImageFormatProperties eprops = {</div>
<div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;        .sType = VK_STRUCTURE_TYPE_EXTERNAL_IMAGE_FORMAT_PROPERTIES_KHR,</div>
<div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;    };</div>
<div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;    VkImageFormatProperties2 props = {</div>
<div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;        .sType = VK_STRUCTURE_TYPE_IMAGE_FORMAT_PROPERTIES_2,</div>
<div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;        .pNext = &amp;eprops,</div>
<div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;    };</div>
<div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;    VkPhysicalDeviceExternalImageFormatInfo enext = {</div>
<div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;        .sType = VK_STRUCTURE_TYPE_PHYSICAL_DEVICE_EXTERNAL_IMAGE_FORMAT_INFO,</div>
<div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;        .handleType = <a class="code" href="eval_8c.html#afc05d41e1a0fc024ac21072d11d4f263">exp</a>,</div>
<div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;    };</div>
<div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;    VkPhysicalDeviceImageFormatInfo2 pinfo = {</div>
<div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;        .sType  = VK_STRUCTURE_TYPE_PHYSICAL_DEVICE_IMAGE_FORMAT_INFO_2,</div>
<div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;        .pNext  = !<a class="code" href="eval_8c.html#afc05d41e1a0fc024ac21072d11d4f263">exp</a> ? <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> : &amp;enext,</div>
<div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;        .format = <a class="code" href="hwcontext__vulkan_8c.html#ac3dce3efdada0dab3fd7fca01e374871">av_vkfmt_from_pixfmt</a>(hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#a663a9aceca97aa7b2426c9aba6543e4a">sw_format</a>)[0],</div>
<div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;        .type   = VK_IMAGE_TYPE_2D,</div>
<div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;        .tiling = hwctx-&gt;<a class="code" href="struct_a_v_vulkan_frames_context.html#a1d59cf40209ed27b210f8b755c0250fa">tiling</a>,</div>
<div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;        .usage  = hwctx-&gt;<a class="code" href="struct_a_v_vulkan_frames_context.html#a6bf14758921612c1aad1a5d8332200bb">usage</a>,</div>
<div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;        .flags  = VK_IMAGE_CREATE_ALIAS_BIT,</div>
<div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;    };</div>
<div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160; </div>
<div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;    <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = vkGetPhysicalDeviceImageFormatProperties2(dev_hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a154f2a1f99a153cdb9a801b2504d6637">phys_dev</a>,</div>
<div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;                                                    &amp;pinfo, &amp;props);</div>
<div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> == VK_SUCCESS) {</div>
<div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;        *iexp |= <a class="code" href="eval_8c.html#afc05d41e1a0fc024ac21072d11d4f263">exp</a>;</div>
<div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;        *comp_handle_types |= eprops.externalMemoryProperties.compatibleHandleTypes;</div>
<div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;    }</div>
<div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;}</div>
<div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160; </div>
<div class="line"><a name="l01631"></a><span class="lineno"><a class="line" href="hwcontext__vulkan_8c.html#ab4c32719f720cf93422ef9685183c0f4"> 1631</a></span>&#160;<span class="keyword">static</span> <a class="code" href="struct_a_v_buffer_ref.html">AVBufferRef</a> *<a class="code" href="hwcontext__vulkan_8c.html#ab4c32719f720cf93422ef9685183c0f4">vulkan_pool_alloc</a>(<span class="keywordtype">void</span> *opaque, <span class="keywordtype">int</span> <a class="code" href="group__lavu__mem__funcs.html#ga34e10fdac079a9ca4512b8ccd7f20b8a">size</a>)</div>
<div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;{</div>
<div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;    <span class="keywordtype">int</span> err;</div>
<div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;    <a class="code" href="struct_a_v_vk_frame.html">AVVkFrame</a> *<a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a>;</div>
<div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;    <a class="code" href="struct_a_v_buffer_ref.html">AVBufferRef</a> *avbuf = <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;    <a class="code" href="struct_a_v_h_w_frames_context.html">AVHWFramesContext</a> *hwfc = opaque;</div>
<div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;    <a class="code" href="struct_a_v_vulkan_frames_context.html">AVVulkanFramesContext</a> *hwctx = hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#a54e38c3e4355321e23e0f4c7411cb8ee">hwctx</a>;</div>
<div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;    <a class="code" href="struct_vulkan_device_priv.html">VulkanDevicePriv</a> *p = hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#ac9a7dbd0cbfcabc0b1529cb34cf53b6d">device_ctx</a>-&gt;<a class="code" href="struct_a_v_h_w_device_context.html#a9c3758c73b0f29925ccb2f60b5c1a803">internal</a>-&gt;<a class="code" href="struct_a_v_h_w_device_internal.html#ae7425663cca9541964518c66974a20bf">priv</a>;</div>
<div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;    <a class="code" href="struct_vulkan_frames_priv.html">VulkanFramesPriv</a> *<a class="code" href="regdef_8h.html#ae771351dd440a8640270282362e338d0">fp</a> = hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#a69e956e8d2d73d65d015c4ed895ec642">internal</a>-&gt;<a class="code" href="struct_a_v_h_w_frames_internal.html#a503cfeb391ed69856344768fd641a489">priv</a>;</div>
<div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;    VkExportMemoryAllocateInfo eminfo[<a class="code" href="frame_8h.html#add80189702cf0f5ea82718576fb43201">AV_NUM_DATA_POINTERS</a>];</div>
<div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;    VkExternalMemoryHandleTypeFlags e = 0x0;</div>
<div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160; </div>
<div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;    VkExternalMemoryImageCreateInfo eiinfo = {</div>
<div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;        .sType       = VK_STRUCTURE_TYPE_EXTERNAL_MEMORY_IMAGE_CREATE_INFO,</div>
<div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;        .pNext       = hwctx-&gt;<a class="code" href="struct_a_v_vulkan_frames_context.html#a18537e64f52d484a81bfb258cbfe39be">create_pnext</a>,</div>
<div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;    };</div>
<div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160; </div>
<div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;    <span class="keywordflow">if</span> (p-&gt;<a class="code" href="struct_vulkan_device_priv.html#a895a041d77f8253cb0842c23e54593f2">extensions</a> &amp; <a class="code" href="hwcontext__vulkan_8c.html#adfa9f1974c8c5348db6b4034e3aa7b4ea498c8e07b8e37d27d1ce7bc1e4e9e4f7">EXT_EXTERNAL_FD_MEMORY</a>)</div>
<div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;        <a class="code" href="hwcontext__vulkan_8c.html#a481ad49d98f76838642e2f30dd01b8d7">try_export_flags</a>(hwfc, &amp;eiinfo.handleTypes, &amp;e,</div>
<div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;                         VK_EXTERNAL_MEMORY_HANDLE_TYPE_OPAQUE_FD_BIT);</div>
<div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160; </div>
<div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;    <span class="keywordflow">if</span> (p-&gt;<a class="code" href="struct_vulkan_device_priv.html#a895a041d77f8253cb0842c23e54593f2">extensions</a> &amp; <a class="code" href="hwcontext__vulkan_8c.html#adfa9f1974c8c5348db6b4034e3aa7b4ead055cca16ae2cf28b4e1ab34de136147">EXT_EXTERNAL_DMABUF_MEMORY</a>)</div>
<div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;        <a class="code" href="hwcontext__vulkan_8c.html#a481ad49d98f76838642e2f30dd01b8d7">try_export_flags</a>(hwfc, &amp;eiinfo.handleTypes, &amp;e,</div>
<div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;                         VK_EXTERNAL_MEMORY_HANDLE_TYPE_DMA_BUF_BIT_EXT);</div>
<div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160; </div>
<div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="pixdesc_8c.html#a118df1d607abd7484f874b3d7ea8823a">av_pix_fmt_count_planes</a>(hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#a663a9aceca97aa7b2426c9aba6543e4a">sw_format</a>); <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;        eminfo[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].sType       = VK_STRUCTURE_TYPE_EXPORT_MEMORY_ALLOCATE_INFO;</div>
<div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;        eminfo[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].pNext       = hwctx-&gt;<a class="code" href="struct_a_v_vulkan_frames_context.html#a35850b6049c9766ce28576a7b4c52c14">alloc_pnext</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;        eminfo[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].handleTypes = e;</div>
<div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;    }</div>
<div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160; </div>
<div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;    err = <a class="code" href="hwcontext__vulkan_8c.html#af9240320c6e8aa3c937ffe82c77be676">create_frame</a>(hwfc, &amp;<a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a>, hwctx-&gt;<a class="code" href="struct_a_v_vulkan_frames_context.html#a1d59cf40209ed27b210f8b755c0250fa">tiling</a>, hwctx-&gt;<a class="code" href="struct_a_v_vulkan_frames_context.html#a6bf14758921612c1aad1a5d8332200bb">usage</a>,</div>
<div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;                       eiinfo.handleTypes ? &amp;eiinfo : <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;    <span class="keywordflow">if</span> (err)</div>
<div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160; </div>
<div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;    err = <a class="code" href="hwcontext__vulkan_8c.html#a333a3a6e9768bf43163090416c7608ad">alloc_bind_mem</a>(hwfc, <a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a>, eminfo, <span class="keyword">sizeof</span>(*eminfo));</div>
<div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;    <span class="keywordflow">if</span> (err)</div>
<div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160; </div>
<div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;    err = <a class="code" href="hwcontext__vulkan_8c.html#aa2579750bda1abdf414c2f3f7de6d9fc">prepare_frame</a>(hwfc, &amp;<a class="code" href="regdef_8h.html#ae771351dd440a8640270282362e338d0">fp</a>-&gt;conv_ctx, <a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a>, <a class="code" href="hwcontext__vulkan_8c.html#af94790aab5b000aa1b44ce817563076fa33f0896bb2828e1ee77b85224f4f658d">PREP_MODE_WRITE</a>);</div>
<div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;    <span class="keywordflow">if</span> (err)</div>
<div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160; </div>
<div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;    avbuf = <a class="code" href="group__lavu__buffer.html#ga3e7f4c92db85ccba0b2a16dd0069842a">av_buffer_create</a>((<a class="code" href="audio__convert_8c.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> *)<a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a>, <span class="keyword">sizeof</span>(<a class="code" href="struct_a_v_vk_frame.html">AVVkFrame</a>),</div>
<div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;                             <a class="code" href="hwcontext__vulkan_8c.html#a608f002433583fc02957e4884c9bb981">vulkan_frame_free</a>, hwfc, 0);</div>
<div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;    <span class="keywordflow">if</span> (!avbuf)</div>
<div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160; </div>
<div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;    <span class="keywordflow">return</span> avbuf;</div>
<div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160; </div>
<div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;<a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>:</div>
<div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;    <a class="code" href="hwcontext__vulkan_8c.html#a608f002433583fc02957e4884c9bb981">vulkan_frame_free</a>(hwfc, (<a class="code" href="audio__convert_8c.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> *)<a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a>);</div>
<div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;}</div>
<div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160; </div>
<div class="line"><a name="l01687"></a><span class="lineno"><a class="line" href="hwcontext__vulkan_8c.html#ace458c3b8c27631b00e72b0c8a5609ef"> 1687</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="hwcontext__vulkan_8c.html#ace458c3b8c27631b00e72b0c8a5609ef">vulkan_frames_uninit</a>(<a class="code" href="struct_a_v_h_w_frames_context.html">AVHWFramesContext</a> *hwfc)</div>
<div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;{</div>
<div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;    <a class="code" href="struct_vulkan_frames_priv.html">VulkanFramesPriv</a> *<a class="code" href="regdef_8h.html#ae771351dd440a8640270282362e338d0">fp</a> = hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#a69e956e8d2d73d65d015c4ed895ec642">internal</a>-&gt;<a class="code" href="struct_a_v_h_w_frames_internal.html#a503cfeb391ed69856344768fd641a489">priv</a>;</div>
<div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160; </div>
<div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;    <a class="code" href="hwcontext__vulkan_8c.html#afd623dfe84458032bb583efe3fb748e5">free_exec_ctx</a>(hwfc, &amp;<a class="code" href="regdef_8h.html#ae771351dd440a8640270282362e338d0">fp</a>-&gt;conv_ctx);</div>
<div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;    <a class="code" href="hwcontext__vulkan_8c.html#afd623dfe84458032bb583efe3fb748e5">free_exec_ctx</a>(hwfc, &amp;<a class="code" href="regdef_8h.html#ae771351dd440a8640270282362e338d0">fp</a>-&gt;upload_ctx);</div>
<div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;    <a class="code" href="hwcontext__vulkan_8c.html#afd623dfe84458032bb583efe3fb748e5">free_exec_ctx</a>(hwfc, &amp;<a class="code" href="regdef_8h.html#ae771351dd440a8640270282362e338d0">fp</a>-&gt;download_ctx);</div>
<div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;}</div>
<div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160; </div>
<div class="line"><a name="l01696"></a><span class="lineno"><a class="line" href="hwcontext__vulkan_8c.html#a149c5f31e2b5aecf1c9fd2c2f5f159fa"> 1696</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="hwcontext__vulkan_8c.html#a149c5f31e2b5aecf1c9fd2c2f5f159fa">vulkan_frames_init</a>(<a class="code" href="struct_a_v_h_w_frames_context.html">AVHWFramesContext</a> *hwfc)</div>
<div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;{</div>
<div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;    <span class="keywordtype">int</span> err;</div>
<div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;    <a class="code" href="struct_a_v_vk_frame.html">AVVkFrame</a> *<a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a>;</div>
<div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;    <a class="code" href="struct_a_v_vulkan_frames_context.html">AVVulkanFramesContext</a> *hwctx = hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#a54e38c3e4355321e23e0f4c7411cb8ee">hwctx</a>;</div>
<div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;    <a class="code" href="struct_vulkan_frames_priv.html">VulkanFramesPriv</a> *<a class="code" href="regdef_8h.html#ae771351dd440a8640270282362e338d0">fp</a> = hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#a69e956e8d2d73d65d015c4ed895ec642">internal</a>-&gt;<a class="code" href="struct_a_v_h_w_frames_internal.html#a503cfeb391ed69856344768fd641a489">priv</a>;</div>
<div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;    <a class="code" href="struct_a_v_vulkan_device_context.html">AVVulkanDeviceContext</a> *dev_hwctx = hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#ac9a7dbd0cbfcabc0b1529cb34cf53b6d">device_ctx</a>-&gt;<a class="code" href="struct_a_v_h_w_device_context.html#a46055b48d1a40445d775b4ae24f77f20">hwctx</a>;</div>
<div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;    <a class="code" href="struct_vulkan_device_priv.html">VulkanDevicePriv</a> *p = hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#ac9a7dbd0cbfcabc0b1529cb34cf53b6d">device_ctx</a>-&gt;<a class="code" href="struct_a_v_h_w_device_context.html#a9c3758c73b0f29925ccb2f60b5c1a803">internal</a>-&gt;<a class="code" href="struct_a_v_h_w_device_internal.html#ae7425663cca9541964518c66974a20bf">priv</a>;</div>
<div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160; </div>
<div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;    <span class="comment">/* Default pool flags */</span></div>
<div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;    hwctx-&gt;<a class="code" href="struct_a_v_vulkan_frames_context.html#a1d59cf40209ed27b210f8b755c0250fa">tiling</a> = hwctx-&gt;<a class="code" href="struct_a_v_vulkan_frames_context.html#a1d59cf40209ed27b210f8b755c0250fa">tiling</a> ? hwctx-&gt;<a class="code" href="struct_a_v_vulkan_frames_context.html#a1d59cf40209ed27b210f8b755c0250fa">tiling</a> : p-&gt;<a class="code" href="struct_vulkan_device_priv.html#a456ab09798ca379b6534a172a9245dba">use_linear_images</a> ?</div>
<div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;                    VK_IMAGE_TILING_LINEAR : VK_IMAGE_TILING_OPTIMAL;</div>
<div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160; </div>
<div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;    <span class="keywordflow">if</span> (!hwctx-&gt;<a class="code" href="struct_a_v_vulkan_frames_context.html#a6bf14758921612c1aad1a5d8332200bb">usage</a>)</div>
<div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;        hwctx-&gt;<a class="code" href="struct_a_v_vulkan_frames_context.html#a6bf14758921612c1aad1a5d8332200bb">usage</a> = <a class="code" href="hwcontext__vulkan_8c.html#afbcde1018fdc1e8bfca60ead7cf50191">DEFAULT_USAGE_FLAGS</a>;</div>
<div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160; </div>
<div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;    err = <a class="code" href="hwcontext__vulkan_8c.html#a8ec94342a3a8351bd61eacacd1dedf4b">create_exec_ctx</a>(hwfc, &amp;<a class="code" href="regdef_8h.html#ae771351dd440a8640270282362e338d0">fp</a>-&gt;conv_ctx,</div>
<div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;                          dev_hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a7adbed71081998a80f83e92ed72e2821">queue_family_comp_index</a>,</div>
<div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;                          <a class="code" href="hwcontext__vulkan_8c.html#abee363c2a4179bacdf2706a5969c949a">GET_QUEUE_COUNT</a>(dev_hwctx, 0, 1, 0));</div>
<div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;    <span class="keywordflow">if</span> (err)</div>
<div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160; </div>
<div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;    err = <a class="code" href="hwcontext__vulkan_8c.html#a8ec94342a3a8351bd61eacacd1dedf4b">create_exec_ctx</a>(hwfc, &amp;<a class="code" href="regdef_8h.html#ae771351dd440a8640270282362e338d0">fp</a>-&gt;upload_ctx,</div>
<div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;                          dev_hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a160efd57925b2bf9c75c94b1aafad629">queue_family_tx_index</a>,</div>
<div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;                          <a class="code" href="hwcontext__vulkan_8c.html#abee363c2a4179bacdf2706a5969c949a">GET_QUEUE_COUNT</a>(dev_hwctx, 0, 0, 1));</div>
<div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;    <span class="keywordflow">if</span> (err)</div>
<div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160; </div>
<div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;    err = <a class="code" href="hwcontext__vulkan_8c.html#a8ec94342a3a8351bd61eacacd1dedf4b">create_exec_ctx</a>(hwfc, &amp;<a class="code" href="regdef_8h.html#ae771351dd440a8640270282362e338d0">fp</a>-&gt;download_ctx,</div>
<div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;                          dev_hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a160efd57925b2bf9c75c94b1aafad629">queue_family_tx_index</a>, 1);</div>
<div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;    <span class="keywordflow">if</span> (err)</div>
<div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160; </div>
<div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;    <span class="comment">/* Test to see if allocation will fail */</span></div>
<div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;    err = <a class="code" href="hwcontext__vulkan_8c.html#af9240320c6e8aa3c937ffe82c77be676">create_frame</a>(hwfc, &amp;<a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a>, hwctx-&gt;<a class="code" href="struct_a_v_vulkan_frames_context.html#a1d59cf40209ed27b210f8b755c0250fa">tiling</a>, hwctx-&gt;<a class="code" href="struct_a_v_vulkan_frames_context.html#a6bf14758921612c1aad1a5d8332200bb">usage</a>,</div>
<div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;                       hwctx-&gt;<a class="code" href="struct_a_v_vulkan_frames_context.html#a18537e64f52d484a81bfb258cbfe39be">create_pnext</a>);</div>
<div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;    <span class="keywordflow">if</span> (err)</div>
<div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160; </div>
<div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;    <a class="code" href="hwcontext__vulkan_8c.html#a608f002433583fc02957e4884c9bb981">vulkan_frame_free</a>(hwfc, (<a class="code" href="audio__convert_8c.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> *)<a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a>);</div>
<div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160; </div>
<div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;    <span class="comment">/* If user did not specify a pool, hwfc-&gt;pool will be set to the internal one</span></div>
<div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;<span class="comment">     * in hwcontext.c just after this gets called */</span></div>
<div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;    <span class="keywordflow">if</span> (!hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#ad67ff3a5828a611d1b1cddd64fc1de71">pool</a>) {</div>
<div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;        hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#a69e956e8d2d73d65d015c4ed895ec642">internal</a>-&gt;<a class="code" href="struct_a_v_h_w_frames_internal.html#a2858e1cd83082cc8bcbbf581283e7af2">pool_internal</a> = <a class="code" href="group__lavu__bufferpool.html#ga615151c8889d5be39d17bce4d8c65117">av_buffer_pool_init2</a>(<span class="keyword">sizeof</span>(<a class="code" href="struct_a_v_vk_frame.html">AVVkFrame</a>),</div>
<div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;                                                             hwfc, <a class="code" href="hwcontext__vulkan_8c.html#ab4c32719f720cf93422ef9685183c0f4">vulkan_pool_alloc</a>,</div>
<div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;                                                             <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;        <span class="keywordflow">if</span> (!hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#a69e956e8d2d73d65d015c4ed895ec642">internal</a>-&gt;<a class="code" href="struct_a_v_h_w_frames_internal.html#a2858e1cd83082cc8bcbbf581283e7af2">pool_internal</a>) {</div>
<div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;            err = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;            <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;        }</div>
<div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;    }</div>
<div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160; </div>
<div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160; </div>
<div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;<a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>:</div>
<div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;    <a class="code" href="hwcontext__vulkan_8c.html#afd623dfe84458032bb583efe3fb748e5">free_exec_ctx</a>(hwfc, &amp;<a class="code" href="regdef_8h.html#ae771351dd440a8640270282362e338d0">fp</a>-&gt;conv_ctx);</div>
<div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;    <a class="code" href="hwcontext__vulkan_8c.html#afd623dfe84458032bb583efe3fb748e5">free_exec_ctx</a>(hwfc, &amp;<a class="code" href="regdef_8h.html#ae771351dd440a8640270282362e338d0">fp</a>-&gt;upload_ctx);</div>
<div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;    <a class="code" href="hwcontext__vulkan_8c.html#afd623dfe84458032bb583efe3fb748e5">free_exec_ctx</a>(hwfc, &amp;<a class="code" href="regdef_8h.html#ae771351dd440a8640270282362e338d0">fp</a>-&gt;download_ctx);</div>
<div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160; </div>
<div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;    <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;}</div>
<div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160; </div>
<div class="line"><a name="l01759"></a><span class="lineno"><a class="line" href="hwcontext__vulkan_8c.html#ae5894c7eff36f0e19741dab7f14964c8"> 1759</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="hwcontext__vulkan_8c.html#ae5894c7eff36f0e19741dab7f14964c8">vulkan_get_buffer</a>(<a class="code" href="struct_a_v_h_w_frames_context.html">AVHWFramesContext</a> *hwfc, <a class="code" href="struct_a_v_frame.html">AVFrame</a> *<a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>)</div>
<div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;{</div>
<div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;    <a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>-&gt;buf[0] = <a class="code" href="group__lavu__bufferpool.html#ga2c745ecb4001452423e775b06b20fb7c">av_buffer_pool_get</a>(hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#ad67ff3a5828a611d1b1cddd64fc1de71">pool</a>);</div>
<div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>-&gt;buf[0])</div>
<div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160; </div>
<div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;    <a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>-&gt;data[0] = <a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>-&gt;buf[0]-&gt;data;</div>
<div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;    <a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>-&gt;format  = <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a0f77c711dcbc9a4acdea48b6b5bc50c7">AV_PIX_FMT_VULKAN</a>;</div>
<div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;    <a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>-&gt;width   = hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#a9e6f29d0f744930cdd0e8bdff8771520">width</a>;</div>
<div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;    <a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>-&gt;height  = hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#ae61bbe1d8645a0c573085e29f1d0a58f">height</a>;</div>
<div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160; </div>
<div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;}</div>
<div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160; </div>
<div class="line"><a name="l01773"></a><span class="lineno"><a class="line" href="hwcontext__vulkan_8c.html#a78cecfa14fbe7d736376b5147adc68cc"> 1773</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="hwcontext__vulkan_8c.html#a78cecfa14fbe7d736376b5147adc68cc">vulkan_transfer_get_formats</a>(<a class="code" href="struct_a_v_h_w_frames_context.html">AVHWFramesContext</a> *hwfc,</div>
<div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;                                       <span class="keyword">enum</span> <a class="code" href="hwcontext_8h.html#aba8d70ed754b2536ca497d7d50ec7b1e">AVHWFrameTransferDirection</a> dir,</div>
<div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;                                       <span class="keyword">enum</span> <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5">AVPixelFormat</a> **<a class="code" href="signature_8h.html#a12f58149bb2cdab504621ba5b390ef64">formats</a>)</div>
<div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;{</div>
<div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;    <span class="keyword">enum</span> <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5">AVPixelFormat</a> *fmts = <a class="code" href="mem_8c.html#a254f3455439c15a2c8a75b8f0235fdbd">av_malloc_array</a>(2, <span class="keyword">sizeof</span>(*fmts));</div>
<div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;    <span class="keywordflow">if</span> (!fmts)</div>
<div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160; </div>
<div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;    fmts[0] = hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#a663a9aceca97aa7b2426c9aba6543e4a">sw_format</a>;</div>
<div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;    fmts[1] = <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a0e08f8a5d0fa21c3e258816a9dcce7c3">AV_PIX_FMT_NONE</a>;</div>
<div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160; </div>
<div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;    *<a class="code" href="signature_8h.html#a12f58149bb2cdab504621ba5b390ef64">formats</a> = fmts;</div>
<div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;}</div>
<div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160; </div>
<div class="line"><a name="l01788"></a><span class="lineno"><a class="line" href="struct_vulkan_mapping.html"> 1788</a></span>&#160;<span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="struct_vulkan_mapping.html">VulkanMapping</a> {</div>
<div class="line"><a name="l01789"></a><span class="lineno"><a class="line" href="struct_vulkan_mapping.html#aef5c0d75c498aebde60d07f9c3caa732"> 1789</a></span>&#160;    <a class="code" href="struct_a_v_vk_frame.html">AVVkFrame</a> *<a class="code" href="struct_vulkan_mapping.html#aef5c0d75c498aebde60d07f9c3caa732">frame</a>;</div>
<div class="line"><a name="l01790"></a><span class="lineno"><a class="line" href="struct_vulkan_mapping.html#a0686e69e55cc173855e141d69001b4c2"> 1790</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="struct_vulkan_mapping.html#a0686e69e55cc173855e141d69001b4c2">flags</a>;</div>
<div class="line"><a name="l01791"></a><span class="lineno"><a class="line" href="hwcontext__vulkan_8c.html#a7ca6de581010532102af77fb6ad4cb19"> 1791</a></span>&#160;} <a class="code" href="hwcontext__vulkan_8c.html#a7ca6de581010532102af77fb6ad4cb19">VulkanMapping</a>;</div>
<div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160; </div>
<div class="line"><a name="l01793"></a><span class="lineno"><a class="line" href="hwcontext__vulkan_8c.html#adffcfb8928e039e795cf18fa2a7ac3d6"> 1793</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="hwcontext__vulkan_8c.html#adffcfb8928e039e795cf18fa2a7ac3d6">vulkan_unmap_frame</a>(<a class="code" href="struct_a_v_h_w_frames_context.html">AVHWFramesContext</a> *hwfc, <a class="code" href="struct_h_w_map_descriptor.html">HWMapDescriptor</a> *hwmap)</div>
<div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;{</div>
<div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;    <a class="code" href="struct_vulkan_mapping.html">VulkanMapping</a> *<a class="code" href="hwcontext__vdpau_8c.html#a2996cc16b36e13c9010705bad768e866">map</a> = hwmap-&gt;<a class="code" href="struct_h_w_map_descriptor.html#a7ecea93e498181196f2121b85c07411d">priv</a>;</div>
<div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;    <a class="code" href="struct_a_v_vulkan_device_context.html">AVVulkanDeviceContext</a> *hwctx = hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#ac9a7dbd0cbfcabc0b1529cb34cf53b6d">device_ctx</a>-&gt;<a class="code" href="struct_a_v_h_w_device_context.html#a46055b48d1a40445d775b4ae24f77f20">hwctx</a>;</div>
<div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="llviddspenc_8c.html#a39de7029a33bc3271ae437de0a38c343">planes</a> = <a class="code" href="pixdesc_8c.html#a118df1d607abd7484f874b3d7ea8823a">av_pix_fmt_count_planes</a>(hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#a663a9aceca97aa7b2426c9aba6543e4a">sw_format</a>);</div>
<div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160; </div>
<div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;    <span class="comment">/* Check if buffer needs flushing */</span></div>
<div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;    <span class="keywordflow">if</span> ((<a class="code" href="hwcontext__vdpau_8c.html#a2996cc16b36e13c9010705bad768e866">map</a>-&gt;flags &amp; <a class="code" href="group__avoptions.html#gga06fc87d81c62e9abb8790b6e5713c55bab2e22cc927a3d88fe833b50bf3d71948">AV_HWFRAME_MAP_WRITE</a>) &amp;&amp;</div>
<div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;        !(<a class="code" href="hwcontext__vdpau_8c.html#a2996cc16b36e13c9010705bad768e866">map</a>-&gt;frame-&gt;flags &amp; VK_MEMORY_PROPERTY_HOST_COHERENT_BIT)) {</div>
<div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;        VkResult <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>;</div>
<div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;        VkMappedMemoryRange flush_ranges[<a class="code" href="frame_8h.html#add80189702cf0f5ea82718576fb43201">AV_NUM_DATA_POINTERS</a>] = { { 0 } };</div>
<div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160; </div>
<div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="llviddspenc_8c.html#a39de7029a33bc3271ae437de0a38c343">planes</a>; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;            flush_ranges[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].sType  = VK_STRUCTURE_TYPE_MAPPED_MEMORY_RANGE;</div>
<div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;            flush_ranges[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].memory = <a class="code" href="hwcontext__vdpau_8c.html#a2996cc16b36e13c9010705bad768e866">map</a>-&gt;frame-&gt;mem[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;            flush_ranges[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].size   = VK_WHOLE_SIZE;</div>
<div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;        }</div>
<div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160; </div>
<div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;        <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = vkFlushMappedMemoryRanges(hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a53a07d4474261e4e14ec03c5d15f71da">act_dev</a>, <a class="code" href="llviddspenc_8c.html#a39de7029a33bc3271ae437de0a38c343">planes</a>,</div>
<div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;                                        flush_ranges);</div>
<div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> != VK_SUCCESS) {</div>
<div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(hwfc, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to flush memory: %s\n&quot;</span>,</div>
<div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;                   <a class="code" href="hwcontext__vulkan_8c.html#ab4395598042453295899a91b26ad013b">vk_ret2str</a>(<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>));</div>
<div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;        }</div>
<div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;    }</div>
<div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160; </div>
<div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="llviddspenc_8c.html#a39de7029a33bc3271ae437de0a38c343">planes</a>; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;        vkUnmapMemory(hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a53a07d4474261e4e14ec03c5d15f71da">act_dev</a>, <a class="code" href="hwcontext__vdpau_8c.html#a2996cc16b36e13c9010705bad768e866">map</a>-&gt;frame-&gt;mem[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div>
<div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160; </div>
<div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#a079eab092887563f2bef9106c6120089">av_free</a>(<a class="code" href="hwcontext__vdpau_8c.html#a2996cc16b36e13c9010705bad768e866">map</a>);</div>
<div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;}</div>
<div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160; </div>
<div class="line"><a name="l01825"></a><span class="lineno"><a class="line" href="hwcontext__vulkan_8c.html#a213d14a16ccf5f6f6e9e5ac88824e17d"> 1825</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="hwcontext__vulkan_8c.html#a213d14a16ccf5f6f6e9e5ac88824e17d">vulkan_map_frame_to_mem</a>(<a class="code" href="struct_a_v_h_w_frames_context.html">AVHWFramesContext</a> *hwfc, <a class="code" href="struct_a_v_frame.html">AVFrame</a> *dst,</div>
<div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;                                   <span class="keyword">const</span> <a class="code" href="struct_a_v_frame.html">AVFrame</a> *<a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>, <span class="keywordtype">int</span> <a class="code" href="cbs__av1_8c.html#a67119bce106892b6dade1dc5aa405ac9">flags</a>)</div>
<div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;{</div>
<div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;    VkResult <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>;</div>
<div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;    <span class="keywordtype">int</span> err, mapped_mem_count = 0;</div>
<div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;    <a class="code" href="struct_a_v_vk_frame.html">AVVkFrame</a> *<a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a> = (<a class="code" href="struct_a_v_vk_frame.html">AVVkFrame</a> *)<a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>-&gt;data[0];</div>
<div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;    <a class="code" href="struct_a_v_vulkan_device_context.html">AVVulkanDeviceContext</a> *hwctx = hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#ac9a7dbd0cbfcabc0b1529cb34cf53b6d">device_ctx</a>-&gt;<a class="code" href="struct_a_v_h_w_device_context.html#a46055b48d1a40445d775b4ae24f77f20">hwctx</a>;</div>
<div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="llviddspenc_8c.html#a39de7029a33bc3271ae437de0a38c343">planes</a> = <a class="code" href="pixdesc_8c.html#a118df1d607abd7484f874b3d7ea8823a">av_pix_fmt_count_planes</a>(hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#a663a9aceca97aa7b2426c9aba6543e4a">sw_format</a>);</div>
<div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160; </div>
<div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;    <a class="code" href="struct_vulkan_mapping.html">VulkanMapping</a> *<a class="code" href="hwcontext__vdpau_8c.html#a2996cc16b36e13c9010705bad768e866">map</a> = <a class="code" href="group__lavu__mem__funcs.html#gaf143ecab33a3868b57345466c39de7c1">av_mallocz</a>(<span class="keyword">sizeof</span>(<a class="code" href="struct_vulkan_mapping.html">VulkanMapping</a>));</div>
<div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="hwcontext__vdpau_8c.html#a2996cc16b36e13c9010705bad768e866">map</a>)</div>
<div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EINVAL);</div>
<div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160; </div>
<div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>-&gt;format != <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a0f77c711dcbc9a4acdea48b6b5bc50c7">AV_PIX_FMT_VULKAN</a>) {</div>
<div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(hwfc, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Cannot map from pixel format %s!\n&quot;</span>,</div>
<div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;               <a class="code" href="pixdesc_8c.html#ab92e2a8a9b58c982560c49df9f01e47e">av_get_pix_fmt_name</a>(<a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>-&gt;format));</div>
<div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;        err = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EINVAL);</div>
<div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;    }</div>
<div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160; </div>
<div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;    <span class="keywordflow">if</span> (!(<a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a>-&gt;flags &amp; VK_MEMORY_PROPERTY_HOST_VISIBLE_BIT) ||</div>
<div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;        !(<a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a>-&gt;tiling == VK_IMAGE_TILING_LINEAR)) {</div>
<div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(hwfc, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to map frame, not host visible &quot;</span></div>
<div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;               <span class="stringliteral">&quot;and linear!\n&quot;</span>);</div>
<div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;        err = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EINVAL);</div>
<div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;    }</div>
<div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160; </div>
<div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;    dst-&gt;<a class="code" href="struct_a_v_frame.html#a1e71ce60cedd5f3b6811714a9f7f9e0a">width</a>  = <a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>-&gt;width;</div>
<div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;    dst-&gt;<a class="code" href="struct_a_v_frame.html#a3f89733f429c98ba5bc64373fb0a3f13">height</a> = <a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>-&gt;height;</div>
<div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160; </div>
<div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="llviddspenc_8c.html#a39de7029a33bc3271ae437de0a38c343">planes</a>; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;        <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = vkMapMemory(hwctx-&gt;act_dev, <a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a>-&gt;mem[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>], 0,</div>
<div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;                          VK_WHOLE_SIZE, 0, (<span class="keywordtype">void</span> **)&amp;dst-&gt;<a class="code" href="struct_a_v_frame.html#a1d0f65014a8d1bf78cec8cbed2304992">data</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div>
<div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> != VK_SUCCESS) {</div>
<div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(hwfc, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to map image memory: %s\n&quot;</span>,</div>
<div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;                <a class="code" href="hwcontext__vulkan_8c.html#ab4395598042453295899a91b26ad013b">vk_ret2str</a>(<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>));</div>
<div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;            err = <a class="code" href="group__lavu__error.html#ga9c520e483ba8648495620ffdb4c491f2">AVERROR_EXTERNAL</a>;</div>
<div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;            <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;        }</div>
<div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;        mapped_mem_count++;</div>
<div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;    }</div>
<div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160; </div>
<div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;    <span class="comment">/* Check if the memory contents matter */</span></div>
<div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;    <span class="keywordflow">if</span> (((<a class="code" href="cbs__av1_8c.html#a67119bce106892b6dade1dc5aa405ac9">flags</a> &amp; <a class="code" href="group__avoptions.html#gga06fc87d81c62e9abb8790b6e5713c55ba236262031fe4c5503b2611c2c8fb520b">AV_HWFRAME_MAP_READ</a>) || !(<a class="code" href="cbs__av1_8c.html#a67119bce106892b6dade1dc5aa405ac9">flags</a> &amp; <a class="code" href="group__avoptions.html#gga06fc87d81c62e9abb8790b6e5713c55bac12b0a2a379fe4b4b00353aac56ed9f4">AV_HWFRAME_MAP_OVERWRITE</a>)) &amp;&amp;</div>
<div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;        !(<a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a>-&gt;flags &amp; VK_MEMORY_PROPERTY_HOST_COHERENT_BIT)) {</div>
<div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;        VkMappedMemoryRange map_mem_ranges[<a class="code" href="frame_8h.html#add80189702cf0f5ea82718576fb43201">AV_NUM_DATA_POINTERS</a>] = { { 0 } };</div>
<div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="llviddspenc_8c.html#a39de7029a33bc3271ae437de0a38c343">planes</a>; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;            map_mem_ranges[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].sType = VK_STRUCTURE_TYPE_MAPPED_MEMORY_RANGE;</div>
<div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;            map_mem_ranges[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].size = VK_WHOLE_SIZE;</div>
<div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;            map_mem_ranges[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].memory = <a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a>-&gt;mem[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;        }</div>
<div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160; </div>
<div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;        <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = vkInvalidateMappedMemoryRanges(hwctx-&gt;act_dev, <a class="code" href="llviddspenc_8c.html#a39de7029a33bc3271ae437de0a38c343">planes</a>,</div>
<div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;                                             map_mem_ranges);</div>
<div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> != VK_SUCCESS) {</div>
<div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(hwfc, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to invalidate memory: %s\n&quot;</span>,</div>
<div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;                   <a class="code" href="hwcontext__vulkan_8c.html#ab4395598042453295899a91b26ad013b">vk_ret2str</a>(<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>));</div>
<div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;            err = <a class="code" href="group__lavu__error.html#ga9c520e483ba8648495620ffdb4c491f2">AVERROR_EXTERNAL</a>;</div>
<div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;            <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;        }</div>
<div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;    }</div>
<div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160; </div>
<div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="llviddspenc_8c.html#a39de7029a33bc3271ae437de0a38c343">planes</a>; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;        VkImageSubresource <a class="code" href="dnn__backend__native__layer__mathbinary_8c.html#aec238e230db0cd41b80558db403931dd">sub</a> = {</div>
<div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;            .aspectMask = VK_IMAGE_ASPECT_COLOR_BIT,</div>
<div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;        };</div>
<div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;        VkSubresourceLayout <a class="code" href="filter__design_8txt.html#a669858250c93520fd944ba5d6eb1884d">layout</a>;</div>
<div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;        vkGetImageSubresourceLayout(hwctx-&gt;act_dev, <a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a>-&gt;img[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>], &amp;<a class="code" href="dnn__backend__native__layer__mathbinary_8c.html#aec238e230db0cd41b80558db403931dd">sub</a>, &amp;<a class="code" href="filter__design_8txt.html#a669858250c93520fd944ba5d6eb1884d">layout</a>);</div>
<div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;        dst-&gt;<a class="code" href="struct_a_v_frame.html#aa52bfc6605f6a3059a0c3226cc0f6567">linesize</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code" href="filter__design_8txt.html#a669858250c93520fd944ba5d6eb1884d">layout</a>.rowPitch;</div>
<div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;    }</div>
<div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160; </div>
<div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;    <a class="code" href="hwcontext__vdpau_8c.html#a2996cc16b36e13c9010705bad768e866">map</a>-&gt;frame = <a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a>;</div>
<div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;    <a class="code" href="hwcontext__vdpau_8c.html#a2996cc16b36e13c9010705bad768e866">map</a>-&gt;flags = <a class="code" href="cbs__av1_8c.html#a67119bce106892b6dade1dc5aa405ac9">flags</a>;</div>
<div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160; </div>
<div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;    err = <a class="code" href="hwcontext_8c.html#a76e0387f519b3f1bd1b162e91b54b182">ff_hwframe_map_create</a>(<a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>-&gt;hw_frames_ctx, dst, <a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>,</div>
<div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;                                &amp;<a class="code" href="hwcontext__vulkan_8c.html#adffcfb8928e039e795cf18fa2a7ac3d6">vulkan_unmap_frame</a>, <a class="code" href="hwcontext__vdpau_8c.html#a2996cc16b36e13c9010705bad768e866">map</a>);</div>
<div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;    <span class="keywordflow">if</span> (err &lt; 0)</div>
<div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160; </div>
<div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160; </div>
<div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;<a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>:</div>
<div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; mapped_mem_count; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;        vkUnmapMemory(hwctx-&gt;act_dev, <a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a>-&gt;mem[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div>
<div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160; </div>
<div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#a079eab092887563f2bef9106c6120089">av_free</a>(<a class="code" href="hwcontext__vdpau_8c.html#a2996cc16b36e13c9010705bad768e866">map</a>);</div>
<div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;    <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;}</div>
<div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160; </div>
<div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;<span class="preprocessor">#if CONFIG_LIBDRM</span></div>
<div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> vulkan_unmap_from(<a class="code" href="struct_a_v_h_w_frames_context.html">AVHWFramesContext</a> *hwfc, <a class="code" href="struct_h_w_map_descriptor.html">HWMapDescriptor</a> *hwmap)</div>
<div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;{</div>
<div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;    <a class="code" href="struct_vulkan_mapping.html">VulkanMapping</a> *<a class="code" href="hwcontext__vdpau_8c.html#a2996cc16b36e13c9010705bad768e866">map</a> = hwmap-&gt;<a class="code" href="struct_h_w_map_descriptor.html#a7ecea93e498181196f2121b85c07411d">priv</a>;</div>
<div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;    <a class="code" href="struct_a_v_vulkan_device_context.html">AVVulkanDeviceContext</a> *hwctx = hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#ac9a7dbd0cbfcabc0b1529cb34cf53b6d">device_ctx</a>-&gt;<a class="code" href="struct_a_v_h_w_device_context.html#a46055b48d1a40445d775b4ae24f77f20">hwctx</a>;</div>
<div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="llviddspenc_8c.html#a39de7029a33bc3271ae437de0a38c343">planes</a> = <a class="code" href="pixdesc_8c.html#a118df1d607abd7484f874b3d7ea8823a">av_pix_fmt_count_planes</a>(hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#a663a9aceca97aa7b2426c9aba6543e4a">sw_format</a>);</div>
<div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160; </div>
<div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="llviddspenc_8c.html#a39de7029a33bc3271ae437de0a38c343">planes</a>; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;        vkDestroyImage(hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a53a07d4474261e4e14ec03c5d15f71da">act_dev</a>, <a class="code" href="hwcontext__vdpau_8c.html#a2996cc16b36e13c9010705bad768e866">map</a>-&gt;frame-&gt;img[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>], hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a4a617020274526c26e265781aefcd22c">alloc</a>);</div>
<div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;        vkFreeMemory(hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a53a07d4474261e4e14ec03c5d15f71da">act_dev</a>, <a class="code" href="hwcontext__vdpau_8c.html#a2996cc16b36e13c9010705bad768e866">map</a>-&gt;frame-&gt;mem[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>], hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a4a617020274526c26e265781aefcd22c">alloc</a>);</div>
<div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;        vkDestroySemaphore(hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a53a07d4474261e4e14ec03c5d15f71da">act_dev</a>, <a class="code" href="hwcontext__vdpau_8c.html#a2996cc16b36e13c9010705bad768e866">map</a>-&gt;frame-&gt;sem[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>], hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a4a617020274526c26e265781aefcd22c">alloc</a>);</div>
<div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;    }</div>
<div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160; </div>
<div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#adba82e1bcd02de510a858fcbedf79ef1">av_freep</a>(&amp;<a class="code" href="hwcontext__vdpau_8c.html#a2996cc16b36e13c9010705bad768e866">map</a>-&gt;frame);</div>
<div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;}</div>
<div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160; </div>
<div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">struct </span>{</div>
<div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;    uint32_t drm_fourcc;</div>
<div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;    VkFormat vk_format;</div>
<div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;} vulkan_drm_format_map[] = {</div>
<div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;    { DRM_FORMAT_R8,       VK_FORMAT_R8_UNORM       },</div>
<div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;    { DRM_FORMAT_R16,      VK_FORMAT_R16_UNORM      },</div>
<div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;    { DRM_FORMAT_GR88,     VK_FORMAT_R8G8_UNORM     },</div>
<div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;    { DRM_FORMAT_RG88,     VK_FORMAT_R8G8_UNORM     },</div>
<div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;    { DRM_FORMAT_GR1616,   VK_FORMAT_R16G16_UNORM   },</div>
<div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;    { DRM_FORMAT_RG1616,   VK_FORMAT_R16G16_UNORM   },</div>
<div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;    { DRM_FORMAT_ARGB8888, VK_FORMAT_B8G8R8A8_UNORM },</div>
<div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;    { DRM_FORMAT_XRGB8888, VK_FORMAT_B8G8R8A8_UNORM },</div>
<div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;    { DRM_FORMAT_ABGR8888, VK_FORMAT_R8G8B8A8_UNORM },</div>
<div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;    { DRM_FORMAT_XBGR8888, VK_FORMAT_R8G8B8A8_UNORM },</div>
<div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;};</div>
<div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160; </div>
<div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;<span class="keyword">static</span> <span class="keyword">inline</span> VkFormat drm_to_vulkan_fmt(uint32_t drm_fourcc)</div>
<div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;{</div>
<div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="sinewin__tablegen__template_8c.html#a3508a98d3ee7e2c9a4841fe264cf70f7">FF_ARRAY_ELEMS</a>(vulkan_drm_format_map); <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;        <span class="keywordflow">if</span> (vulkan_drm_format_map[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].drm_fourcc == drm_fourcc)</div>
<div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;            <span class="keywordflow">return</span> vulkan_drm_format_map[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].vk_format;</div>
<div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;    <span class="keywordflow">return</span> VK_FORMAT_UNDEFINED;</div>
<div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;}</div>
<div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160; </div>
<div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> vulkan_map_from_drm_frame_desc(<a class="code" href="struct_a_v_h_w_frames_context.html">AVHWFramesContext</a> *hwfc, <a class="code" href="struct_a_v_vk_frame.html">AVVkFrame</a> **<a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>,</div>
<div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;                                          <a class="code" href="struct_a_v_d_r_m_frame_descriptor.html">AVDRMFrameDescriptor</a> *<a class="code" href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a>)</div>
<div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;{</div>
<div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;    <span class="keywordtype">int</span> err = 0;</div>
<div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;    VkResult <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>;</div>
<div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;    <a class="code" href="struct_a_v_vk_frame.html">AVVkFrame</a> *<a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a>;</div>
<div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;    <span class="keywordtype">int</span> bind_counts = 0;</div>
<div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;    <a class="code" href="struct_a_v_h_w_device_context.html">AVHWDeviceContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a> = hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#ac9a7dbd0cbfcabc0b1529cb34cf53b6d">device_ctx</a>;</div>
<div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;    <a class="code" href="struct_a_v_vulkan_device_context.html">AVVulkanDeviceContext</a> *hwctx = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;hwctx;</div>
<div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;    <a class="code" href="struct_vulkan_device_priv.html">VulkanDevicePriv</a> *p = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;<a class="code" href="struct_a_v_format_context.html#a8a8bec51da36db65ff864f88a85805d9">internal</a>-&gt;priv;</div>
<div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;    <a class="code" href="struct_vulkan_frames_priv.html">VulkanFramesPriv</a> *<a class="code" href="regdef_8h.html#ae771351dd440a8640270282362e338d0">fp</a> = hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#a69e956e8d2d73d65d015c4ed895ec642">internal</a>-&gt;<a class="code" href="struct_a_v_h_w_frames_internal.html#a503cfeb391ed69856344768fd641a489">priv</a>;</div>
<div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;    <a class="code" href="struct_a_v_vulkan_frames_context.html">AVVulkanFramesContext</a> *frames_hwctx = hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#a54e38c3e4355321e23e0f4c7411cb8ee">hwctx</a>;</div>
<div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;    <span class="keyword">const</span> <a class="code" href="struct_a_v_pix_fmt_descriptor.html">AVPixFmtDescriptor</a> *fmt_desc = <a class="code" href="pixdesc_8c.html#afe0c3e8aef5173de28bbdaea4298f5f0">av_pix_fmt_desc_get</a>(hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#a663a9aceca97aa7b2426c9aba6543e4a">sw_format</a>);</div>
<div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> has_modifiers = p-&gt;<a class="code" href="struct_vulkan_device_priv.html#a895a041d77f8253cb0842c23e54593f2">extensions</a> &amp; <a class="code" href="hwcontext__vulkan_8c.html#adfa9f1974c8c5348db6b4034e3aa7b4eac76edadb3f30757d5ba92676482f578a">EXT_DRM_MODIFIER_FLAGS</a>;</div>
<div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;    VkSubresourceLayout plane_data[<a class="code" href="frame_8h.html#add80189702cf0f5ea82718576fb43201">AV_NUM_DATA_POINTERS</a>] = { 0 };</div>
<div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;    VkBindImageMemoryInfo bind_info[<a class="code" href="frame_8h.html#add80189702cf0f5ea82718576fb43201">AV_NUM_DATA_POINTERS</a>] = { 0 };</div>
<div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;    VkBindImagePlaneMemoryInfo <a class="code" href="structplane__info.html">plane_info</a>[<a class="code" href="frame_8h.html#add80189702cf0f5ea82718576fb43201">AV_NUM_DATA_POINTERS</a>] = { 0 };</div>
<div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;    VkExternalMemoryHandleTypeFlagBits <a class="code" href="median__template_8c.html#a31b077f963aa01b89165bc79dadf3af4">htype</a> = VK_EXTERNAL_MEMORY_HANDLE_TYPE_DMA_BUF_BIT_EXT;</div>
<div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160; </div>
<div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;    <a class="code" href="hwcontext__vulkan_8c.html#acc25b1e67c50a452aa1965aaca0acf88">VK_LOAD_PFN</a>(hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#abb0e7a4336731e84eb1b25571635d243">inst</a>, vkGetMemoryFdPropertiesKHR);</div>
<div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160; </div>
<div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a>-&gt;nb_layers; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;        <span class="keywordflow">if</span> (drm_to_vulkan_fmt(<a class="code" href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a>-&gt;layers[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].format) == VK_FORMAT_UNDEFINED) {</div>
<div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Unsupported DMABUF layer format %#08x!\n&quot;</span>,</div>
<div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;                   <a class="code" href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a>-&gt;layers[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].format);</div>
<div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EINVAL);</div>
<div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;        }</div>
<div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;    }</div>
<div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160; </div>
<div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;    <span class="keywordflow">if</span> (!(<a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a> = <a class="code" href="hwcontext__vulkan_8c.html#a951b6233520dcb4be94fd7d4e58a39af">av_vk_frame_alloc</a>())) {</div>
<div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to allocate memory for AVVkFrame!\n&quot;</span>);</div>
<div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;        err = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;    }</div>
<div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160; </div>
<div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;    <a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a>-&gt;tiling = has_modifiers ? VK_IMAGE_TILING_DRM_FORMAT_MODIFIER_EXT :</div>
<div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;                <a class="code" href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a>-&gt;objects[0].format_modifier == DRM_FORMAT_MOD_LINEAR ?</div>
<div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;                VK_IMAGE_TILING_LINEAR : VK_IMAGE_TILING_OPTIMAL;</div>
<div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160; </div>
<div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a>-&gt;nb_layers; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="llviddspenc_8c.html#a39de7029a33bc3271ae437de0a38c343">planes</a> = <a class="code" href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a>-&gt;layers[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].nb_planes;</div>
<div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;        VkImageDrmFormatModifierExplicitCreateInfoEXT drm_info = {</div>
<div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;            .sType = VK_STRUCTURE_TYPE_IMAGE_DRM_FORMAT_MODIFIER_EXPLICIT_CREATE_INFO_EXT,</div>
<div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;            .drmFormatModifier = <a class="code" href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a>-&gt;objects[0].format_modifier,</div>
<div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;            .drmFormatModifierPlaneCount = <a class="code" href="llviddspenc_8c.html#a39de7029a33bc3271ae437de0a38c343">planes</a>,</div>
<div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;            .pPlaneLayouts = (<span class="keyword">const</span> VkSubresourceLayout *)&amp;plane_data,</div>
<div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;        };</div>
<div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160; </div>
<div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;        VkExternalMemoryImageCreateInfo einfo = {</div>
<div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;            .sType       = VK_STRUCTURE_TYPE_EXTERNAL_MEMORY_IMAGE_CREATE_INFO,</div>
<div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;            .pNext       = has_modifiers ? &amp;drm_info : <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;            .handleTypes = <a class="code" href="median__template_8c.html#a31b077f963aa01b89165bc79dadf3af4">htype</a>,</div>
<div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;        };</div>
<div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160; </div>
<div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;        VkSemaphoreCreateInfo sem_spawn = {</div>
<div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;            .sType = VK_STRUCTURE_TYPE_SEMAPHORE_CREATE_INFO,</div>
<div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;        };</div>
<div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160; </div>
<div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> p_w = <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &gt; 0 ? <a class="code" href="common_8h.html#a5d13452b0fac0d41b08ea2e49ea6eaa5">AV_CEIL_RSHIFT</a>(hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#a9e6f29d0f744930cdd0e8bdff8771520">width</a>, fmt_desc-&gt;<a class="code" href="struct_a_v_pix_fmt_descriptor.html#a4abca4534188ff94627e88c0d8362058">log2_chroma_w</a>) : hwfc-&gt;<a class="code" href="tests_2snowenc_8c.html#a667b04d7fb6ef46db4da4af554c5b6f7">width</a>;</div>
<div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> p_h = <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &gt; 0 ? <a class="code" href="common_8h.html#a5d13452b0fac0d41b08ea2e49ea6eaa5">AV_CEIL_RSHIFT</a>(hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#ae61bbe1d8645a0c573085e29f1d0a58f">height</a>, fmt_desc-&gt;<a class="code" href="struct_a_v_pix_fmt_descriptor.html#abea8ed308fe00644fc066a00018afa95">log2_chroma_h</a>) : hwfc-&gt;<a class="code" href="tests_2snowenc_8c.html#a64f9f90ece96c7bab4aee3deacf170e0">height</a>;</div>
<div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160; </div>
<div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;        VkImageCreateInfo image_create_info = {</div>
<div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;            .sType                 = VK_STRUCTURE_TYPE_IMAGE_CREATE_INFO,</div>
<div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;            .pNext                 = &amp;einfo,</div>
<div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;            .imageType             = VK_IMAGE_TYPE_2D,</div>
<div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;            .format                = drm_to_vulkan_fmt(<a class="code" href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a>-&gt;layers[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].format),</div>
<div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;            .extent.width          = p_w,</div>
<div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;            .extent.height         = p_h,</div>
<div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;            .extent.depth          = 1,</div>
<div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;            .mipLevels             = 1,</div>
<div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;            .arrayLayers           = 1,</div>
<div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;            .flags                 = VK_IMAGE_CREATE_ALIAS_BIT,</div>
<div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;            .tiling                = <a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a>-&gt;tiling,</div>
<div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;            .initialLayout         = VK_IMAGE_LAYOUT_UNDEFINED, <span class="comment">/* specs say so */</span></div>
<div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;            .usage                 = frames_hwctx-&gt;<a class="code" href="struct_a_v_vulkan_frames_context.html#a6bf14758921612c1aad1a5d8332200bb">usage</a>,</div>
<div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;            .samples               = VK_SAMPLE_COUNT_1_BIT,</div>
<div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;            .pQueueFamilyIndices   = p-&gt;<a class="code" href="struct_vulkan_device_priv.html#a753f96a767abb4f8a8b92aff3cbfb5e4">qfs</a>,</div>
<div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;            .queueFamilyIndexCount = p-&gt;<a class="code" href="struct_vulkan_device_priv.html#a90b5a426b5114eca5015d387b7288e07">num_qfs</a>,</div>
<div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;            .sharingMode           = p-&gt;<a class="code" href="struct_vulkan_device_priv.html#a90b5a426b5114eca5015d387b7288e07">num_qfs</a> &gt; 1 ? VK_SHARING_MODE_CONCURRENT :</div>
<div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;                                                      VK_SHARING_MODE_EXCLUSIVE,</div>
<div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;        };</div>
<div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160; </div>
<div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; <a class="code" href="llviddspenc_8c.html#a39de7029a33bc3271ae437de0a38c343">planes</a>; j++) {</div>
<div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;            plane_data[j].offset     = <a class="code" href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a>-&gt;layers[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].planes[j].offset;</div>
<div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;            plane_data[j].rowPitch   = <a class="code" href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a>-&gt;layers[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].planes[j].pitch;</div>
<div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;            plane_data[j].size       = 0; <span class="comment">/* The specs say so for all 3 */</span></div>
<div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;            plane_data[j].arrayPitch = 0;</div>
<div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;            plane_data[j].depthPitch = 0;</div>
<div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;        }</div>
<div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160; </div>
<div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;        <span class="comment">/* Create image */</span></div>
<div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;        <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = vkCreateImage(hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a53a07d4474261e4e14ec03c5d15f71da">act_dev</a>, &amp;image_create_info,</div>
<div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;                            hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a4a617020274526c26e265781aefcd22c">alloc</a>, &amp;<a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a>-&gt;img[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div>
<div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> != VK_SUCCESS) {</div>
<div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Image creation failure: %s\n&quot;</span>,</div>
<div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;                   <a class="code" href="hwcontext__vulkan_8c.html#ab4395598042453295899a91b26ad013b">vk_ret2str</a>(<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>));</div>
<div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;            err = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EINVAL);</div>
<div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;            <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;        }</div>
<div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160; </div>
<div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;        <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = vkCreateSemaphore(hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a53a07d4474261e4e14ec03c5d15f71da">act_dev</a>, &amp;sem_spawn,</div>
<div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;                                hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a4a617020274526c26e265781aefcd22c">alloc</a>, &amp;<a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a>-&gt;sem[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div>
<div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> != VK_SUCCESS) {</div>
<div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(hwctx, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to create semaphore: %s\n&quot;</span>,</div>
<div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;                   <a class="code" href="hwcontext__vulkan_8c.html#ab4395598042453295899a91b26ad013b">vk_ret2str</a>(<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>));</div>
<div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="group__lavu__error.html#ga9c520e483ba8648495620ffdb4c491f2">AVERROR_EXTERNAL</a>;</div>
<div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;        }</div>
<div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160; </div>
<div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;        <span class="comment">/* We&#39;d import a semaphore onto the one we created using</span></div>
<div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;<span class="comment">         * vkImportSemaphoreFdKHR but unfortunately neither DRM nor VAAPI</span></div>
<div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;<span class="comment">         * offer us anything we could import and sync with, so instead</span></div>
<div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;<span class="comment">         * just signal the semaphore we created. */</span></div>
<div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160; </div>
<div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;        <a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a>-&gt;layout[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>] = image_create_info.initialLayout;</div>
<div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;        <a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a>-&gt;access[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>] = 0x0;</div>
<div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;    }</div>
<div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160; </div>
<div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a>-&gt;nb_objects; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;        <span class="keywordtype">int</span> use_ded_mem = 0;</div>
<div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;        VkMemoryFdPropertiesKHR fdmp = {</div>
<div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;            .sType = VK_STRUCTURE_TYPE_MEMORY_FD_PROPERTIES_KHR,</div>
<div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;        };</div>
<div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;        VkMemoryRequirements req = {</div>
<div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;            .size = <a class="code" href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a>-&gt;objects[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].size,</div>
<div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;        };</div>
<div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;        VkImportMemoryFdInfoKHR idesc = {</div>
<div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;            .sType      = VK_STRUCTURE_TYPE_IMPORT_MEMORY_FD_INFO_KHR,</div>
<div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;            .handleType = <a class="code" href="median__template_8c.html#a31b077f963aa01b89165bc79dadf3af4">htype</a>,</div>
<div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;            .fd         = dup(<a class="code" href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a>-&gt;objects[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].fd),</div>
<div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;        };</div>
<div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;        VkMemoryDedicatedAllocateInfo ded_alloc = {</div>
<div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;            .sType = VK_STRUCTURE_TYPE_MEMORY_DEDICATED_ALLOCATE_INFO,</div>
<div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;            .pNext = &amp;idesc,</div>
<div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;        };</div>
<div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160; </div>
<div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;        <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = pfn_vkGetMemoryFdPropertiesKHR(hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a53a07d4474261e4e14ec03c5d15f71da">act_dev</a>, <a class="code" href="median__template_8c.html#a31b077f963aa01b89165bc79dadf3af4">htype</a>,</div>
<div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;                                             idesc.fd, &amp;fdmp);</div>
<div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> != VK_SUCCESS) {</div>
<div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(hwfc, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to get FD properties: %s\n&quot;</span>,</div>
<div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;                   <a class="code" href="hwcontext__vulkan_8c.html#ab4395598042453295899a91b26ad013b">vk_ret2str</a>(<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>));</div>
<div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;            err = <a class="code" href="group__lavu__error.html#ga9c520e483ba8648495620ffdb4c491f2">AVERROR_EXTERNAL</a>;</div>
<div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;            close(idesc.fd);</div>
<div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;            <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;        }</div>
<div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160; </div>
<div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;        req.memoryTypeBits = fdmp.memoryTypeBits;</div>
<div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160; </div>
<div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;        <span class="comment">/* Dedicated allocation only makes sense if there&#39;s a one to one mapping</span></div>
<div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;<span class="comment">         * between images and the memory backing them, so only check in this</span></div>
<div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;<span class="comment">         * case. */</span></div>
<div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a>-&gt;nb_layers == <a class="code" href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a>-&gt;nb_objects) {</div>
<div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;            VkImageMemoryRequirementsInfo2 req_desc = {</div>
<div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;                .sType = VK_STRUCTURE_TYPE_IMAGE_MEMORY_REQUIREMENTS_INFO_2,</div>
<div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;                .image = <a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a>-&gt;img[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>],</div>
<div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;            };</div>
<div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;            VkMemoryDedicatedRequirements ded_req = {</div>
<div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;                .sType = VK_STRUCTURE_TYPE_MEMORY_DEDICATED_REQUIREMENTS,</div>
<div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;            };</div>
<div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;            VkMemoryRequirements2 req2 = {</div>
<div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;                .sType = VK_STRUCTURE_TYPE_MEMORY_REQUIREMENTS_2,</div>
<div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;                .pNext = &amp;ded_req,</div>
<div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;            };</div>
<div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160; </div>
<div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;            vkGetImageMemoryRequirements2(hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a53a07d4474261e4e14ec03c5d15f71da">act_dev</a>, &amp;req_desc, &amp;req2);</div>
<div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160; </div>
<div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;            use_ded_mem = ded_req.prefersDedicatedAllocation |</div>
<div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;                          ded_req.requiresDedicatedAllocation;</div>
<div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;            <span class="keywordflow">if</span> (use_ded_mem)</div>
<div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;                ded_alloc.image = <a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a>-&gt;img[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;        }</div>
<div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160; </div>
<div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;        err = <a class="code" href="hwcontext__vulkan_8c.html#a1bc9deeeb2378022c6deaf235ab97fe8">alloc_mem</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, &amp;req, VK_MEMORY_PROPERTY_DEVICE_LOCAL_BIT,</div>
<div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;                        use_ded_mem ? &amp;ded_alloc : ded_alloc.pNext,</div>
<div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;                        &amp;<a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a>-&gt;flags, &amp;<a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a>-&gt;mem[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div>
<div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;        <span class="keywordflow">if</span> (err) {</div>
<div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;            close(idesc.fd);</div>
<div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;            <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;        }</div>
<div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160; </div>
<div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;        <a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a>-&gt;size[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code" href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a>-&gt;objects[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].size;</div>
<div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;    }</div>
<div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160; </div>
<div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a>-&gt;nb_layers; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="llviddspenc_8c.html#a39de7029a33bc3271ae437de0a38c343">planes</a> = <a class="code" href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a>-&gt;layers[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].nb_planes;</div>
<div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> signal_p = has_modifiers &amp;&amp; (<a class="code" href="llviddspenc_8c.html#a39de7029a33bc3271ae437de0a38c343">planes</a> &gt; 1);</div>
<div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; <a class="code" href="llviddspenc_8c.html#a39de7029a33bc3271ae437de0a38c343">planes</a>; j++) {</div>
<div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;            VkImageAspectFlagBits aspect = j == 0 ? VK_IMAGE_ASPECT_MEMORY_PLANE_0_BIT_EXT :</div>
<div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;                                           j == 1 ? VK_IMAGE_ASPECT_MEMORY_PLANE_1_BIT_EXT :</div>
<div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;                                                    VK_IMAGE_ASPECT_MEMORY_PLANE_2_BIT_EXT;</div>
<div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160; </div>
<div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;            <a class="code" href="structplane__info.html">plane_info</a>[bind_counts].sType = VK_STRUCTURE_TYPE_BIND_IMAGE_PLANE_MEMORY_INFO;</div>
<div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;            <a class="code" href="structplane__info.html">plane_info</a>[bind_counts].planeAspect = aspect;</div>
<div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160; </div>
<div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;            bind_info[bind_counts].sType  = VK_STRUCTURE_TYPE_BIND_IMAGE_MEMORY_INFO;</div>
<div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;            bind_info[bind_counts].pNext  = signal_p ? &amp;<a class="code" href="structplane__info.html">plane_info</a>[bind_counts] : <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;            bind_info[bind_counts].image  = <a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a>-&gt;img[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;            bind_info[bind_counts].memory = <a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a>-&gt;mem[<a class="code" href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a>-&gt;layers[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].planes[j].object_index];</div>
<div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;            bind_info[bind_counts].memoryOffset = <a class="code" href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a>-&gt;layers[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].planes[j].offset;</div>
<div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;            bind_counts++;</div>
<div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;        }</div>
<div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;    }</div>
<div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160; </div>
<div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;    <span class="comment">/* Bind the allocated memory to the images */</span></div>
<div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;    <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = vkBindImageMemory2(hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a53a07d4474261e4e14ec03c5d15f71da">act_dev</a>, bind_counts, bind_info);</div>
<div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> != VK_SUCCESS) {</div>
<div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to bind memory: %s\n&quot;</span>,</div>
<div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;               <a class="code" href="hwcontext__vulkan_8c.html#ab4395598042453295899a91b26ad013b">vk_ret2str</a>(<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>));</div>
<div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="group__lavu__error.html#ga9c520e483ba8648495620ffdb4c491f2">AVERROR_EXTERNAL</a>;</div>
<div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;    }</div>
<div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160; </div>
<div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;    <span class="comment">/* NOTE: This is completely uneccesary and unneeded once we can import</span></div>
<div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;<span class="comment">     * semaphores from DRM. Otherwise we have to activate the semaphores.</span></div>
<div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;<span class="comment">     * We&#39;re reusing the exec context that&#39;s also used for uploads/downloads. */</span></div>
<div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;    err = <a class="code" href="hwcontext__vulkan_8c.html#aa2579750bda1abdf414c2f3f7de6d9fc">prepare_frame</a>(hwfc, &amp;<a class="code" href="regdef_8h.html#ae771351dd440a8640270282362e338d0">fp</a>-&gt;conv_ctx, <a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a>, <a class="code" href="hwcontext__vulkan_8c.html#af94790aab5b000aa1b44ce817563076fa8d525c0ec6b8968069e12896b3658f13">PREP_MODE_RO_SHADER</a>);</div>
<div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;    <span class="keywordflow">if</span> (err)</div>
<div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160; </div>
<div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;    *<a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a> = <a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a>;</div>
<div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160; </div>
<div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160; </div>
<div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;<a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>:</div>
<div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a>-&gt;nb_layers; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;        vkDestroyImage(hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a53a07d4474261e4e14ec03c5d15f71da">act_dev</a>, <a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a>-&gt;img[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>], hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a4a617020274526c26e265781aefcd22c">alloc</a>);</div>
<div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;        vkDestroySemaphore(hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a53a07d4474261e4e14ec03c5d15f71da">act_dev</a>, <a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a>-&gt;sem[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>], hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a4a617020274526c26e265781aefcd22c">alloc</a>);</div>
<div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;    }</div>
<div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a>-&gt;nb_objects; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;        vkFreeMemory(hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a53a07d4474261e4e14ec03c5d15f71da">act_dev</a>, <a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a>-&gt;mem[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>], hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a4a617020274526c26e265781aefcd22c">alloc</a>);</div>
<div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160; </div>
<div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#a079eab092887563f2bef9106c6120089">av_free</a>(<a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a>);</div>
<div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160; </div>
<div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;    <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;}</div>
<div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160; </div>
<div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> vulkan_map_from_drm(<a class="code" href="struct_a_v_h_w_frames_context.html">AVHWFramesContext</a> *hwfc, <a class="code" href="struct_a_v_frame.html">AVFrame</a> *dst,</div>
<div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;                               <span class="keyword">const</span> <a class="code" href="struct_a_v_frame.html">AVFrame</a> *<a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>, <span class="keywordtype">int</span> <a class="code" href="cbs__av1_8c.html#a67119bce106892b6dade1dc5aa405ac9">flags</a>)</div>
<div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;{</div>
<div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;    <span class="keywordtype">int</span> err = 0;</div>
<div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;    <a class="code" href="struct_a_v_vk_frame.html">AVVkFrame</a> *<a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a>;</div>
<div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;    <a class="code" href="struct_vulkan_mapping.html">VulkanMapping</a> *<a class="code" href="hwcontext__vdpau_8c.html#a2996cc16b36e13c9010705bad768e866">map</a> = <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160; </div>
<div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;    err = vulkan_map_from_drm_frame_desc(hwfc, &amp;<a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a>,</div>
<div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;                                         (<a class="code" href="struct_a_v_d_r_m_frame_descriptor.html">AVDRMFrameDescriptor</a> *)<a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>-&gt;data[0]);</div>
<div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;    <span class="keywordflow">if</span> (err)</div>
<div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;        <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160; </div>
<div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;    <span class="comment">/* The unmapping function will free this */</span></div>
<div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;    dst-&gt;<a class="code" href="struct_a_v_frame.html#a1d0f65014a8d1bf78cec8cbed2304992">data</a>[0] = (<a class="code" href="audio__convert_8c.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> *)<a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a>;</div>
<div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;    dst-&gt;<a class="code" href="struct_a_v_frame.html#a1e71ce60cedd5f3b6811714a9f7f9e0a">width</a>   = <a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>-&gt;width;</div>
<div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;    dst-&gt;<a class="code" href="struct_a_v_frame.html#a3f89733f429c98ba5bc64373fb0a3f13">height</a>  = <a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>-&gt;height;</div>
<div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160; </div>
<div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;    <a class="code" href="hwcontext__vdpau_8c.html#a2996cc16b36e13c9010705bad768e866">map</a> = <a class="code" href="group__lavu__mem__funcs.html#gaf143ecab33a3868b57345466c39de7c1">av_mallocz</a>(<span class="keyword">sizeof</span>(<a class="code" href="struct_vulkan_mapping.html">VulkanMapping</a>));</div>
<div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="hwcontext__vdpau_8c.html#a2996cc16b36e13c9010705bad768e866">map</a>)</div>
<div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160; </div>
<div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;    <a class="code" href="hwcontext__vdpau_8c.html#a2996cc16b36e13c9010705bad768e866">map</a>-&gt;frame = <a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a>;</div>
<div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;    <a class="code" href="hwcontext__vdpau_8c.html#a2996cc16b36e13c9010705bad768e866">map</a>-&gt;flags = <a class="code" href="cbs__av1_8c.html#a67119bce106892b6dade1dc5aa405ac9">flags</a>;</div>
<div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160; </div>
<div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;    err = <a class="code" href="hwcontext_8c.html#a76e0387f519b3f1bd1b162e91b54b182">ff_hwframe_map_create</a>(dst-&gt;<a class="code" href="struct_a_v_frame.html#a29493fbfabaa21432c360a090426aa8e">hw_frames_ctx</a>, dst, <a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>,</div>
<div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;                                &amp;vulkan_unmap_from, <a class="code" href="hwcontext__vdpau_8c.html#a2996cc16b36e13c9010705bad768e866">map</a>);</div>
<div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;    <span class="keywordflow">if</span> (err &lt; 0)</div>
<div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160; </div>
<div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(hwfc, <a class="code" href="group__lavu__log__constants.html#ga5b7221c3afd06848486776bd834a58a5">AV_LOG_DEBUG</a>, <span class="stringliteral">&quot;Mapped DRM object to Vulkan!\n&quot;</span>);</div>
<div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160; </div>
<div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160; </div>
<div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;<a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>:</div>
<div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;    <a class="code" href="hwcontext__vulkan_8c.html#a608f002433583fc02957e4884c9bb981">vulkan_frame_free</a>(hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#ac9a7dbd0cbfcabc0b1529cb34cf53b6d">device_ctx</a>-&gt;<a class="code" href="struct_a_v_h_w_device_context.html#a46055b48d1a40445d775b4ae24f77f20">hwctx</a>, (<a class="code" href="audio__convert_8c.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> *)<a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a>);</div>
<div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#a079eab092887563f2bef9106c6120089">av_free</a>(<a class="code" href="hwcontext__vdpau_8c.html#a2996cc16b36e13c9010705bad768e866">map</a>);</div>
<div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;    <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;}</div>
<div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160; </div>
<div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;<span class="preprocessor">#if CONFIG_VAAPI</span></div>
<div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> vulkan_map_from_vaapi(<a class="code" href="struct_a_v_h_w_frames_context.html">AVHWFramesContext</a> *dst_fc,</div>
<div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;                                 <a class="code" href="struct_a_v_frame.html">AVFrame</a> *dst, <span class="keyword">const</span> <a class="code" href="struct_a_v_frame.html">AVFrame</a> *<a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>,</div>
<div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;                                 <span class="keywordtype">int</span> <a class="code" href="cbs__av1_8c.html#a67119bce106892b6dade1dc5aa405ac9">flags</a>)</div>
<div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;{</div>
<div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;    <span class="keywordtype">int</span> err;</div>
<div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;    <a class="code" href="struct_a_v_frame.html">AVFrame</a> *tmp = <a class="code" href="group__lavu__frame.html#gac700017c5270c79c1e1befdeeb008b2f">av_frame_alloc</a>();</div>
<div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;    <a class="code" href="struct_a_v_h_w_frames_context.html">AVHWFramesContext</a> *vaapi_fc = (<a class="code" href="struct_a_v_h_w_frames_context.html">AVHWFramesContext</a>*)<a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>-&gt;hw_frames_ctx-&gt;data;</div>
<div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;    <a class="code" href="struct_a_v_v_a_a_p_i_device_context.html">AVVAAPIDeviceContext</a> *vaapi_ctx = vaapi_fc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#ac9a7dbd0cbfcabc0b1529cb34cf53b6d">device_ctx</a>-&gt;<a class="code" href="struct_a_v_h_w_device_context.html#a46055b48d1a40445d775b4ae24f77f20">hwctx</a>;</div>
<div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;    VASurfaceID surface_id = (VASurfaceID)(uintptr_t)<a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>-&gt;data[3];</div>
<div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160; </div>
<div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;    <a class="code" href="filter__design_8txt.html#a0e82f1088fdc24c14bf175d2ac77523f">if</a> (!tmp)</div>
<div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160; </div>
<div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;    <span class="comment">/* We have to sync since like the previous comment said, no semaphores */</span></div>
<div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160;    vaSyncSurface(vaapi_ctx-&gt;display, surface_id);</div>
<div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160; </div>
<div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;    tmp-&gt;<a class="code" href="struct_a_v_frame.html#aed14fa772ce46881020fd1545c86432c">format</a> = <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a76a05fccc6f58f7ab655deefd794713e">AV_PIX_FMT_DRM_PRIME</a>;</div>
<div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160; </div>
<div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;    err = <a class="code" href="hwcontext_8c.html#a99e028453fba7e66483c2189439219d2">av_hwframe_map</a>(tmp, <a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>, <a class="code" href="cbs__av1_8c.html#a67119bce106892b6dade1dc5aa405ac9">flags</a>);</div>
<div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160;    <span class="keywordflow">if</span> (err &lt; 0)</div>
<div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160; </div>
<div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;    err = vulkan_map_from_drm(dst_fc, dst, tmp, <a class="code" href="cbs__av1_8c.html#a67119bce106892b6dade1dc5aa405ac9">flags</a>);</div>
<div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;    <span class="keywordflow">if</span> (err &lt; 0)</div>
<div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160; </div>
<div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;    err = <a class="code" href="hwcontext_8c.html#af42d5b3b23a1d521e6457276e2cd0a53">ff_hwframe_map_replace</a>(dst, <a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>);</div>
<div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160; </div>
<div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;<a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>:</div>
<div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160;    <a class="code" href="group__lavu__frame.html#ga979d73f3228814aee56aeca0636e37cc">av_frame_free</a>(&amp;tmp);</div>
<div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;    <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;}</div>
<div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160; </div>
<div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;<span class="preprocessor">#if CONFIG_CUDA</span></div>
<div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> vulkan_export_to_cuda(<a class="code" href="struct_a_v_h_w_frames_context.html">AVHWFramesContext</a> *hwfc,</div>
<div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160;                                 <a class="code" href="struct_a_v_buffer_ref.html">AVBufferRef</a> *cuda_hwfc,</div>
<div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;                                 <span class="keyword">const</span> <a class="code" href="struct_a_v_frame.html">AVFrame</a> *<a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>)</div>
<div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;{</div>
<div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;    <span class="keywordtype">int</span> err;</div>
<div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;    VkResult <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>;</div>
<div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;    <a class="code" href="struct_a_v_vk_frame.html">AVVkFrame</a> *dst_f;</div>
<div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;    <a class="code" href="struct_a_v_vk_frame_internal.html">AVVkFrameInternal</a> *dst_int;</div>
<div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160;    <a class="code" href="struct_a_v_h_w_device_context.html">AVHWDeviceContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a> = hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#ac9a7dbd0cbfcabc0b1529cb34cf53b6d">device_ctx</a>;</div>
<div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;    <a class="code" href="struct_a_v_vulkan_device_context.html">AVVulkanDeviceContext</a> *hwctx = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;hwctx;</div>
<div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="llviddspenc_8c.html#a39de7029a33bc3271ae437de0a38c343">planes</a> = <a class="code" href="pixdesc_8c.html#a118df1d607abd7484f874b3d7ea8823a">av_pix_fmt_count_planes</a>(hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#a663a9aceca97aa7b2426c9aba6543e4a">sw_format</a>);</div>
<div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;    <span class="keyword">const</span> <a class="code" href="struct_a_v_pix_fmt_descriptor.html">AVPixFmtDescriptor</a> *<a class="code" href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a> = <a class="code" href="pixdesc_8c.html#afe0c3e8aef5173de28bbdaea4298f5f0">av_pix_fmt_desc_get</a>(hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#a663a9aceca97aa7b2426c9aba6543e4a">sw_format</a>);</div>
<div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;    <a class="code" href="hwcontext__vulkan_8c.html#acc25b1e67c50a452aa1965aaca0acf88">VK_LOAD_PFN</a>(hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#abb0e7a4336731e84eb1b25571635d243">inst</a>, vkGetMemoryFdKHR);</div>
<div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;    <a class="code" href="hwcontext__vulkan_8c.html#acc25b1e67c50a452aa1965aaca0acf88">VK_LOAD_PFN</a>(hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#abb0e7a4336731e84eb1b25571635d243">inst</a>, vkGetSemaphoreFdKHR);</div>
<div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160; </div>
<div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;    <a class="code" href="struct_a_v_h_w_frames_context.html">AVHWFramesContext</a> *cuda_fc = (<a class="code" href="struct_a_v_h_w_frames_context.html">AVHWFramesContext</a>*)cuda_hwfc-&gt;<a class="code" href="struct_a_v_buffer_ref.html#acb8452e99cd75074b93800b532c6ea4b">data</a>;</div>
<div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;    <a class="code" href="struct_a_v_h_w_device_context.html">AVHWDeviceContext</a> *cuda_cu = cuda_fc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#ac9a7dbd0cbfcabc0b1529cb34cf53b6d">device_ctx</a>;</div>
<div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;    <a class="code" href="struct_a_v_c_u_d_a_device_context.html">AVCUDADeviceContext</a> *cuda_dev = cuda_cu-&gt;hwctx;</div>
<div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;    <a class="code" href="struct_a_v_c_u_d_a_device_context_internal.html">AVCUDADeviceContextInternal</a> *cu_internal = cuda_dev-&gt;internal;</div>
<div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;    CudaFunctions *cu = cu_internal-&gt;<a class="code" href="struct_a_v_c_u_d_a_device_context_internal.html#a73041ed3506f9ce333218b4728b5d737">cuda_dl</a>;</div>
<div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160;    CUarray_format cufmt = <a class="code" href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a>-&gt;comp[0].depth &gt; 8 ? CU_AD_FORMAT_UNSIGNED_INT16 :</div>
<div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;                                                     CU_AD_FORMAT_UNSIGNED_INT8;</div>
<div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160; </div>
<div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;    dst_f = (<a class="code" href="struct_a_v_vk_frame.html">AVVkFrame</a> *)<a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>-&gt;data[0];</div>
<div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160; </div>
<div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;    dst_int = dst_f-&gt;<a class="code" href="struct_a_v_vk_frame.html#a9f76026dce756dc1134df7771829a5c3">internal</a>;</div>
<div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;    <span class="keywordflow">if</span> (!dst_int || !dst_int-&gt;cuda_fc_ref) {</div>
<div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;        <span class="keywordflow">if</span> (!dst_f-&gt;<a class="code" href="struct_a_v_vk_frame.html#a9f76026dce756dc1134df7771829a5c3">internal</a>)</div>
<div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;            dst_f-&gt;<a class="code" href="struct_a_v_vk_frame.html#a9f76026dce756dc1134df7771829a5c3">internal</a> = dst_int = <a class="code" href="group__lavu__mem__funcs.html#gaf143ecab33a3868b57345466c39de7c1">av_mallocz</a>(<span class="keyword">sizeof</span>(*dst_f-&gt;<a class="code" href="struct_a_v_vk_frame.html#a9f76026dce756dc1134df7771829a5c3">internal</a>));</div>
<div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160; </div>
<div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;        <span class="keywordflow">if</span> (!dst_int) {</div>
<div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;            err = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;            <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160;        }</div>
<div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160; </div>
<div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160;        dst_int-&gt;cuda_fc_ref = <a class="code" href="group__lavu__buffer.html#gaa40ce7d3ede946a89d03323bbd7268c1">av_buffer_ref</a>(cuda_hwfc);</div>
<div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;        <span class="keywordflow">if</span> (!dst_int-&gt;cuda_fc_ref) {</div>
<div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;            err = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;            <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160;        }</div>
<div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160; </div>
<div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="llviddspenc_8c.html#a39de7029a33bc3271ae437de0a38c343">planes</a>; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l02307"></a><span class="lineno"> 2307</span>&#160;            CUDA_EXTERNAL_MEMORY_MIPMAPPED_ARRAY_DESC tex_desc = {</div>
<div class="line"><a name="l02308"></a><span class="lineno"> 2308</span>&#160;                .offset = 0,</div>
<div class="line"><a name="l02309"></a><span class="lineno"> 2309</span>&#160;                .arrayDesc = {</div>
<div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;                    .Width  = <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &gt; 0 ? <a class="code" href="common_8h.html#a5d13452b0fac0d41b08ea2e49ea6eaa5">AV_CEIL_RSHIFT</a>(hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#a9e6f29d0f744930cdd0e8bdff8771520">width</a>, <a class="code" href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a>-&gt;log2_chroma_w)</div>
<div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160;                                    : hwfc-&gt;<a class="code" href="tests_2snowenc_8c.html#a667b04d7fb6ef46db4da4af554c5b6f7">width</a>,</div>
<div class="line"><a name="l02312"></a><span class="lineno"> 2312</span>&#160;                    .Height = <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &gt; 0 ? <a class="code" href="common_8h.html#a5d13452b0fac0d41b08ea2e49ea6eaa5">AV_CEIL_RSHIFT</a>(hwfc-&gt;<a class="code" href="tests_2snowenc_8c.html#a64f9f90ece96c7bab4aee3deacf170e0">height</a>, <a class="code" href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a>-&gt;log2_chroma_h)</div>
<div class="line"><a name="l02313"></a><span class="lineno"> 2313</span>&#160;                                    : hwfc-&gt;<a class="code" href="tests_2snowenc_8c.html#a64f9f90ece96c7bab4aee3deacf170e0">height</a>,</div>
<div class="line"><a name="l02314"></a><span class="lineno"> 2314</span>&#160;                    .Depth = 0,</div>
<div class="line"><a name="l02315"></a><span class="lineno"> 2315</span>&#160;                    .Format = cufmt,</div>
<div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;                    .NumChannels = 1 + ((<a class="code" href="llviddspenc_8c.html#a39de7029a33bc3271ae437de0a38c343">planes</a> == 2) &amp;&amp; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>),</div>
<div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160;                    .Flags = 0,</div>
<div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160;                },</div>
<div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160;                .numLevels = 1,</div>
<div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160;            };</div>
<div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160;            CUDA_EXTERNAL_MEMORY_HANDLE_DESC ext_desc = {</div>
<div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160;                .type = CU_EXTERNAL_MEMORY_HANDLE_TYPE_OPAQUE_FD,</div>
<div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160;                .size = dst_f-&gt;<a class="code" href="struct_a_v_vk_frame.html#a0f5b937247d6cbbda0ac9ee3e8f1ac15">size</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>],</div>
<div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160;            };</div>
<div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160;            VkMemoryGetFdInfoKHR export_info = {</div>
<div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;                .sType      = VK_STRUCTURE_TYPE_MEMORY_GET_FD_INFO_KHR,</div>
<div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160;                .memory     = dst_f-&gt;<a class="code" href="struct_a_v_vk_frame.html#aee75c3f6f575c5d9380cfcc4b1264338">mem</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>],</div>
<div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160;                .handleType = VK_EXTERNAL_MEMORY_HANDLE_TYPE_OPAQUE_FD_BIT_KHR,</div>
<div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160;            };</div>
<div class="line"><a name="l02330"></a><span class="lineno"> 2330</span>&#160;            VkSemaphoreGetFdInfoKHR sem_export = {</div>
<div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160;                .sType = VK_STRUCTURE_TYPE_SEMAPHORE_GET_FD_INFO_KHR,</div>
<div class="line"><a name="l02332"></a><span class="lineno"> 2332</span>&#160;                .semaphore = dst_f-&gt;<a class="code" href="struct_a_v_vk_frame.html#a2879b0cac663bb604635a2bfb6d06fea">sem</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>],</div>
<div class="line"><a name="l02333"></a><span class="lineno"> 2333</span>&#160;                .handleType = VK_EXTERNAL_SEMAPHORE_HANDLE_TYPE_OPAQUE_FD_BIT,</div>
<div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160;            };</div>
<div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160;            CUDA_EXTERNAL_SEMAPHORE_HANDLE_DESC ext_sem_desc = {</div>
<div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160;                .type = CU_EXTERNAL_SEMAPHORE_HANDLE_TYPE_OPAQUE_FD,</div>
<div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;            };</div>
<div class="line"><a name="l02338"></a><span class="lineno"> 2338</span>&#160; </div>
<div class="line"><a name="l02339"></a><span class="lineno"> 2339</span>&#160;            <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = pfn_vkGetMemoryFdKHR(hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a53a07d4474261e4e14ec03c5d15f71da">act_dev</a>, &amp;export_info,</div>
<div class="line"><a name="l02340"></a><span class="lineno"> 2340</span>&#160;                                       &amp;ext_desc.handle.fd);</div>
<div class="line"><a name="l02341"></a><span class="lineno"> 2341</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> != VK_SUCCESS) {</div>
<div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160;                <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(hwfc, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to export the image as a FD!\n&quot;</span>);</div>
<div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160;                err = <a class="code" href="group__lavu__error.html#ga9c520e483ba8648495620ffdb4c491f2">AVERROR_EXTERNAL</a>;</div>
<div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160;                <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160;            }</div>
<div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160; </div>
<div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;            <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = <a class="code" href="cuviddec_8c.html#aabb147a1f2a98d37cb3ce0dd6d50b78d">CHECK_CU</a>(cu-&gt;cuImportExternalMemory(&amp;dst_int-&gt;ext_mem[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>], &amp;ext_desc));</div>
<div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> &lt; 0) {</div>
<div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;                err = <a class="code" href="group__lavu__error.html#ga9c520e483ba8648495620ffdb4c491f2">AVERROR_EXTERNAL</a>;</div>
<div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160;                <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;            }</div>
<div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160; </div>
<div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160;            <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = <a class="code" href="cuviddec_8c.html#aabb147a1f2a98d37cb3ce0dd6d50b78d">CHECK_CU</a>(cu-&gt;cuExternalMemoryGetMappedMipmappedArray(&amp;dst_int-&gt;cu_mma[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>],</div>
<div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160;                                                                       dst_int-&gt;ext_mem[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>],</div>
<div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;                                                                       &amp;tex_desc));</div>
<div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> &lt; 0) {</div>
<div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160;                err = <a class="code" href="group__lavu__error.html#ga9c520e483ba8648495620ffdb4c491f2">AVERROR_EXTERNAL</a>;</div>
<div class="line"><a name="l02358"></a><span class="lineno"> 2358</span>&#160;                <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l02359"></a><span class="lineno"> 2359</span>&#160;            }</div>
<div class="line"><a name="l02360"></a><span class="lineno"> 2360</span>&#160; </div>
<div class="line"><a name="l02361"></a><span class="lineno"> 2361</span>&#160;            <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = <a class="code" href="cuviddec_8c.html#aabb147a1f2a98d37cb3ce0dd6d50b78d">CHECK_CU</a>(cu-&gt;cuMipmappedArrayGetLevel(&amp;dst_int-&gt;cu_array[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>],</div>
<div class="line"><a name="l02362"></a><span class="lineno"> 2362</span>&#160;                                                        dst_int-&gt;cu_mma[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>], 0));</div>
<div class="line"><a name="l02363"></a><span class="lineno"> 2363</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> &lt; 0) {</div>
<div class="line"><a name="l02364"></a><span class="lineno"> 2364</span>&#160;                err = <a class="code" href="group__lavu__error.html#ga9c520e483ba8648495620ffdb4c491f2">AVERROR_EXTERNAL</a>;</div>
<div class="line"><a name="l02365"></a><span class="lineno"> 2365</span>&#160;                <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l02366"></a><span class="lineno"> 2366</span>&#160;            }</div>
<div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160; </div>
<div class="line"><a name="l02368"></a><span class="lineno"> 2368</span>&#160;            <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = pfn_vkGetSemaphoreFdKHR(hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a53a07d4474261e4e14ec03c5d15f71da">act_dev</a>, &amp;sem_export,</div>
<div class="line"><a name="l02369"></a><span class="lineno"> 2369</span>&#160;                                          &amp;ext_sem_desc.handle.fd);</div>
<div class="line"><a name="l02370"></a><span class="lineno"> 2370</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> != VK_SUCCESS) {</div>
<div class="line"><a name="l02371"></a><span class="lineno"> 2371</span>&#160;                <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to export semaphore: %s\n&quot;</span>,</div>
<div class="line"><a name="l02372"></a><span class="lineno"> 2372</span>&#160;                       <a class="code" href="hwcontext__vulkan_8c.html#ab4395598042453295899a91b26ad013b">vk_ret2str</a>(<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>));</div>
<div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160;                err = <a class="code" href="group__lavu__error.html#ga9c520e483ba8648495620ffdb4c491f2">AVERROR_EXTERNAL</a>;</div>
<div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160;                <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l02375"></a><span class="lineno"> 2375</span>&#160;            }</div>
<div class="line"><a name="l02376"></a><span class="lineno"> 2376</span>&#160; </div>
<div class="line"><a name="l02377"></a><span class="lineno"> 2377</span>&#160;            <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = <a class="code" href="cuviddec_8c.html#aabb147a1f2a98d37cb3ce0dd6d50b78d">CHECK_CU</a>(cu-&gt;cuImportExternalSemaphore(&amp;dst_int-&gt;cu_sem[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>],</div>
<div class="line"><a name="l02378"></a><span class="lineno"> 2378</span>&#160;                                                         &amp;ext_sem_desc));</div>
<div class="line"><a name="l02379"></a><span class="lineno"> 2379</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> &lt; 0) {</div>
<div class="line"><a name="l02380"></a><span class="lineno"> 2380</span>&#160;                err = <a class="code" href="group__lavu__error.html#ga9c520e483ba8648495620ffdb4c491f2">AVERROR_EXTERNAL</a>;</div>
<div class="line"><a name="l02381"></a><span class="lineno"> 2381</span>&#160;                <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l02382"></a><span class="lineno"> 2382</span>&#160;            }</div>
<div class="line"><a name="l02383"></a><span class="lineno"> 2383</span>&#160;        }</div>
<div class="line"><a name="l02384"></a><span class="lineno"> 2384</span>&#160;    }</div>
<div class="line"><a name="l02385"></a><span class="lineno"> 2385</span>&#160; </div>
<div class="line"><a name="l02386"></a><span class="lineno"> 2386</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l02387"></a><span class="lineno"> 2387</span>&#160; </div>
<div class="line"><a name="l02388"></a><span class="lineno"> 2388</span>&#160;<a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>:</div>
<div class="line"><a name="l02389"></a><span class="lineno"> 2389</span>&#160;    <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l02390"></a><span class="lineno"> 2390</span>&#160;}</div>
<div class="line"><a name="l02391"></a><span class="lineno"> 2391</span>&#160; </div>
<div class="line"><a name="l02392"></a><span class="lineno"> 2392</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> vulkan_transfer_data_from_cuda(<a class="code" href="struct_a_v_h_w_frames_context.html">AVHWFramesContext</a> *hwfc,</div>
<div class="line"><a name="l02393"></a><span class="lineno"> 2393</span>&#160;                                          <a class="code" href="struct_a_v_frame.html">AVFrame</a> *dst, <span class="keyword">const</span> <a class="code" href="struct_a_v_frame.html">AVFrame</a> *<a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>)</div>
<div class="line"><a name="l02394"></a><span class="lineno"> 2394</span>&#160;{</div>
<div class="line"><a name="l02395"></a><span class="lineno"> 2395</span>&#160;    <span class="keywordtype">int</span> err;</div>
<div class="line"><a name="l02396"></a><span class="lineno"> 2396</span>&#160;    VkResult <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>;</div>
<div class="line"><a name="l02397"></a><span class="lineno"> 2397</span>&#160;    CUcontext <a class="code" href="motion_8c.html#a7c1d654b7b6114d7a0abc8d351dd1bcd">dummy</a>;</div>
<div class="line"><a name="l02398"></a><span class="lineno"> 2398</span>&#160;    <a class="code" href="struct_a_v_vk_frame.html">AVVkFrame</a> *dst_f;</div>
<div class="line"><a name="l02399"></a><span class="lineno"> 2399</span>&#160;    <a class="code" href="struct_a_v_vk_frame_internal.html">AVVkFrameInternal</a> *dst_int;</div>
<div class="line"><a name="l02400"></a><span class="lineno"> 2400</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="llviddspenc_8c.html#a39de7029a33bc3271ae437de0a38c343">planes</a> = <a class="code" href="pixdesc_8c.html#a118df1d607abd7484f874b3d7ea8823a">av_pix_fmt_count_planes</a>(hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#a663a9aceca97aa7b2426c9aba6543e4a">sw_format</a>);</div>
<div class="line"><a name="l02401"></a><span class="lineno"> 2401</span>&#160;    <span class="keyword">const</span> <a class="code" href="struct_a_v_pix_fmt_descriptor.html">AVPixFmtDescriptor</a> *<a class="code" href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a> = <a class="code" href="pixdesc_8c.html#afe0c3e8aef5173de28bbdaea4298f5f0">av_pix_fmt_desc_get</a>(hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#a663a9aceca97aa7b2426c9aba6543e4a">sw_format</a>);</div>
<div class="line"><a name="l02402"></a><span class="lineno"> 2402</span>&#160; </div>
<div class="line"><a name="l02403"></a><span class="lineno"> 2403</span>&#160;    <a class="code" href="struct_a_v_h_w_frames_context.html">AVHWFramesContext</a> *cuda_fc = (<a class="code" href="struct_a_v_h_w_frames_context.html">AVHWFramesContext</a>*)<a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>-&gt;hw_frames_ctx-&gt;data;</div>
<div class="line"><a name="l02404"></a><span class="lineno"> 2404</span>&#160;    <a class="code" href="struct_a_v_h_w_device_context.html">AVHWDeviceContext</a> *cuda_cu = cuda_fc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#ac9a7dbd0cbfcabc0b1529cb34cf53b6d">device_ctx</a>;</div>
<div class="line"><a name="l02405"></a><span class="lineno"> 2405</span>&#160;    <a class="code" href="struct_a_v_c_u_d_a_device_context.html">AVCUDADeviceContext</a> *cuda_dev = cuda_cu-&gt;hwctx;</div>
<div class="line"><a name="l02406"></a><span class="lineno"> 2406</span>&#160;    <a class="code" href="struct_a_v_c_u_d_a_device_context_internal.html">AVCUDADeviceContextInternal</a> *cu_internal = cuda_dev-&gt;internal;</div>
<div class="line"><a name="l02407"></a><span class="lineno"> 2407</span>&#160;    CudaFunctions *cu = cu_internal-&gt;<a class="code" href="struct_a_v_c_u_d_a_device_context_internal.html#a73041ed3506f9ce333218b4728b5d737">cuda_dl</a>;</div>
<div class="line"><a name="l02408"></a><span class="lineno"> 2408</span>&#160;    CUDA_EXTERNAL_SEMAPHORE_WAIT_PARAMS s_w_par[<a class="code" href="frame_8h.html#add80189702cf0f5ea82718576fb43201">AV_NUM_DATA_POINTERS</a>] = { 0 };</div>
<div class="line"><a name="l02409"></a><span class="lineno"> 2409</span>&#160;    CUDA_EXTERNAL_SEMAPHORE_SIGNAL_PARAMS s_s_par[<a class="code" href="frame_8h.html#add80189702cf0f5ea82718576fb43201">AV_NUM_DATA_POINTERS</a>] = { 0 };</div>
<div class="line"><a name="l02410"></a><span class="lineno"> 2410</span>&#160; </div>
<div class="line"><a name="l02411"></a><span class="lineno"> 2411</span>&#160;    <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = <a class="code" href="cuviddec_8c.html#aabb147a1f2a98d37cb3ce0dd6d50b78d">CHECK_CU</a>(cu-&gt;cuCtxPushCurrent(cuda_dev-&gt;cuda_ctx));</div>
<div class="line"><a name="l02412"></a><span class="lineno"> 2412</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> &lt; 0) {</div>
<div class="line"><a name="l02413"></a><span class="lineno"> 2413</span>&#160;        err = <a class="code" href="group__lavu__error.html#ga9c520e483ba8648495620ffdb4c491f2">AVERROR_EXTERNAL</a>;</div>
<div class="line"><a name="l02414"></a><span class="lineno"> 2414</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l02415"></a><span class="lineno"> 2415</span>&#160;    }</div>
<div class="line"><a name="l02416"></a><span class="lineno"> 2416</span>&#160; </div>
<div class="line"><a name="l02417"></a><span class="lineno"> 2417</span>&#160;    dst_f = (<a class="code" href="struct_a_v_vk_frame.html">AVVkFrame</a> *)dst-&gt;<a class="code" href="struct_a_v_frame.html#a1d0f65014a8d1bf78cec8cbed2304992">data</a>[0];</div>
<div class="line"><a name="l02418"></a><span class="lineno"> 2418</span>&#160; </div>
<div class="line"><a name="l02419"></a><span class="lineno"> 2419</span>&#160;    <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = vulkan_export_to_cuda(hwfc, <a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>-&gt;hw_frames_ctx, dst);</div>
<div class="line"><a name="l02420"></a><span class="lineno"> 2420</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> &lt; 0) {</div>
<div class="line"><a name="l02421"></a><span class="lineno"> 2421</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l02422"></a><span class="lineno"> 2422</span>&#160;    }</div>
<div class="line"><a name="l02423"></a><span class="lineno"> 2423</span>&#160;    dst_int = dst_f-&gt;<a class="code" href="struct_a_v_vk_frame.html#a9f76026dce756dc1134df7771829a5c3">internal</a>;</div>
<div class="line"><a name="l02424"></a><span class="lineno"> 2424</span>&#160; </div>
<div class="line"><a name="l02425"></a><span class="lineno"> 2425</span>&#160;    <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = <a class="code" href="cuviddec_8c.html#aabb147a1f2a98d37cb3ce0dd6d50b78d">CHECK_CU</a>(cu-&gt;cuWaitExternalSemaphoresAsync(dst_int-&gt;cu_sem, s_w_par,</div>
<div class="line"><a name="l02426"></a><span class="lineno"> 2426</span>&#160;                                                     <a class="code" href="llviddspenc_8c.html#a39de7029a33bc3271ae437de0a38c343">planes</a>, cuda_dev-&gt;stream));</div>
<div class="line"><a name="l02427"></a><span class="lineno"> 2427</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> &lt; 0) {</div>
<div class="line"><a name="l02428"></a><span class="lineno"> 2428</span>&#160;        err = <a class="code" href="group__lavu__error.html#ga9c520e483ba8648495620ffdb4c491f2">AVERROR_EXTERNAL</a>;</div>
<div class="line"><a name="l02429"></a><span class="lineno"> 2429</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l02430"></a><span class="lineno"> 2430</span>&#160;    }</div>
<div class="line"><a name="l02431"></a><span class="lineno"> 2431</span>&#160; </div>
<div class="line"><a name="l02432"></a><span class="lineno"> 2432</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="llviddspenc_8c.html#a39de7029a33bc3271ae437de0a38c343">planes</a>; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l02433"></a><span class="lineno"> 2433</span>&#160;        CUDA_MEMCPY2D cpy = {</div>
<div class="line"><a name="l02434"></a><span class="lineno"> 2434</span>&#160;            .srcMemoryType = CU_MEMORYTYPE_DEVICE,</div>
<div class="line"><a name="l02435"></a><span class="lineno"> 2435</span>&#160;            .srcDevice     = (CUdeviceptr)<a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>-&gt;data[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>],</div>
<div class="line"><a name="l02436"></a><span class="lineno"> 2436</span>&#160;            .srcPitch      = <a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>-&gt;linesize[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>],</div>
<div class="line"><a name="l02437"></a><span class="lineno"> 2437</span>&#160;            .srcY          = 0,</div>
<div class="line"><a name="l02438"></a><span class="lineno"> 2438</span>&#160; </div>
<div class="line"><a name="l02439"></a><span class="lineno"> 2439</span>&#160;            .dstMemoryType = CU_MEMORYTYPE_ARRAY,</div>
<div class="line"><a name="l02440"></a><span class="lineno"> 2440</span>&#160;            .dstArray      = dst_int-&gt;cu_array[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>],</div>
<div class="line"><a name="l02441"></a><span class="lineno"> 2441</span>&#160;            .WidthInBytes  = (<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &gt; 0 ? <a class="code" href="common_8h.html#a5d13452b0fac0d41b08ea2e49ea6eaa5">AV_CEIL_RSHIFT</a>(hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#a9e6f29d0f744930cdd0e8bdff8771520">width</a>, <a class="code" href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a>-&gt;log2_chroma_w)</div>
<div class="line"><a name="l02442"></a><span class="lineno"> 2442</span>&#160;                                    : hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#a9e6f29d0f744930cdd0e8bdff8771520">width</a>) * <a class="code" href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a>-&gt;comp[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].step,</div>
<div class="line"><a name="l02443"></a><span class="lineno"> 2443</span>&#160;            .Height        = <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &gt; 0 ? <a class="code" href="common_8h.html#a5d13452b0fac0d41b08ea2e49ea6eaa5">AV_CEIL_RSHIFT</a>(hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#ae61bbe1d8645a0c573085e29f1d0a58f">height</a>, <a class="code" href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a>-&gt;log2_chroma_h)</div>
<div class="line"><a name="l02444"></a><span class="lineno"> 2444</span>&#160;                                   : hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#ae61bbe1d8645a0c573085e29f1d0a58f">height</a>,</div>
<div class="line"><a name="l02445"></a><span class="lineno"> 2445</span>&#160;        };</div>
<div class="line"><a name="l02446"></a><span class="lineno"> 2446</span>&#160; </div>
<div class="line"><a name="l02447"></a><span class="lineno"> 2447</span>&#160;        <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = <a class="code" href="cuviddec_8c.html#aabb147a1f2a98d37cb3ce0dd6d50b78d">CHECK_CU</a>(cu-&gt;cuMemcpy2DAsync(&amp;cpy, cuda_dev-&gt;stream));</div>
<div class="line"><a name="l02448"></a><span class="lineno"> 2448</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> &lt; 0) {</div>
<div class="line"><a name="l02449"></a><span class="lineno"> 2449</span>&#160;            err = <a class="code" href="group__lavu__error.html#ga9c520e483ba8648495620ffdb4c491f2">AVERROR_EXTERNAL</a>;</div>
<div class="line"><a name="l02450"></a><span class="lineno"> 2450</span>&#160;            <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l02451"></a><span class="lineno"> 2451</span>&#160;        }</div>
<div class="line"><a name="l02452"></a><span class="lineno"> 2452</span>&#160;    }</div>
<div class="line"><a name="l02453"></a><span class="lineno"> 2453</span>&#160; </div>
<div class="line"><a name="l02454"></a><span class="lineno"> 2454</span>&#160;    <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = <a class="code" href="cuviddec_8c.html#aabb147a1f2a98d37cb3ce0dd6d50b78d">CHECK_CU</a>(cu-&gt;cuSignalExternalSemaphoresAsync(dst_int-&gt;cu_sem, s_s_par,</div>
<div class="line"><a name="l02455"></a><span class="lineno"> 2455</span>&#160;                                                       <a class="code" href="llviddspenc_8c.html#a39de7029a33bc3271ae437de0a38c343">planes</a>, cuda_dev-&gt;stream));</div>
<div class="line"><a name="l02456"></a><span class="lineno"> 2456</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> &lt; 0) {</div>
<div class="line"><a name="l02457"></a><span class="lineno"> 2457</span>&#160;        err = <a class="code" href="group__lavu__error.html#ga9c520e483ba8648495620ffdb4c491f2">AVERROR_EXTERNAL</a>;</div>
<div class="line"><a name="l02458"></a><span class="lineno"> 2458</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l02459"></a><span class="lineno"> 2459</span>&#160;    }</div>
<div class="line"><a name="l02460"></a><span class="lineno"> 2460</span>&#160; </div>
<div class="line"><a name="l02461"></a><span class="lineno"> 2461</span>&#160;    <a class="code" href="cuviddec_8c.html#aabb147a1f2a98d37cb3ce0dd6d50b78d">CHECK_CU</a>(cu-&gt;cuCtxPopCurrent(&amp;<a class="code" href="motion_8c.html#a7c1d654b7b6114d7a0abc8d351dd1bcd">dummy</a>));</div>
<div class="line"><a name="l02462"></a><span class="lineno"> 2462</span>&#160; </div>
<div class="line"><a name="l02463"></a><span class="lineno"> 2463</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(hwfc, <a class="code" href="group__lavu__log__constants.html#ga9b58b28e2d429b930b69db19877f76a8">AV_LOG_VERBOSE</a>, <span class="stringliteral">&quot;Transfered CUDA image to Vulkan!\n&quot;</span>);</div>
<div class="line"><a name="l02464"></a><span class="lineno"> 2464</span>&#160; </div>
<div class="line"><a name="l02465"></a><span class="lineno"> 2465</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l02466"></a><span class="lineno"> 2466</span>&#160; </div>
<div class="line"><a name="l02467"></a><span class="lineno"> 2467</span>&#160;<a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>:</div>
<div class="line"><a name="l02468"></a><span class="lineno"> 2468</span>&#160;    <a class="code" href="cuviddec_8c.html#aabb147a1f2a98d37cb3ce0dd6d50b78d">CHECK_CU</a>(cu-&gt;cuCtxPopCurrent(&amp;<a class="code" href="motion_8c.html#a7c1d654b7b6114d7a0abc8d351dd1bcd">dummy</a>));</div>
<div class="line"><a name="l02469"></a><span class="lineno"> 2469</span>&#160;    <a class="code" href="hwcontext__vulkan_8c.html#adcb9e9e10aa62d9ffc1ff49bf8fea423">vulkan_free_internal</a>(dst_int);</div>
<div class="line"><a name="l02470"></a><span class="lineno"> 2470</span>&#160;    dst_f-&gt;<a class="code" href="struct_a_v_vk_frame.html#a9f76026dce756dc1134df7771829a5c3">internal</a> = <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l02471"></a><span class="lineno"> 2471</span>&#160;    <a class="code" href="group__lavu__buffer.html#ga135e9e929b5033bb8f68322497b2effc">av_buffer_unref</a>(&amp;dst-&gt;<a class="code" href="struct_a_v_frame.html#a4a64d05cc676bfa8e18bf22d16c8a51f">buf</a>[0]);</div>
<div class="line"><a name="l02472"></a><span class="lineno"> 2472</span>&#160;    <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l02473"></a><span class="lineno"> 2473</span>&#160;}</div>
<div class="line"><a name="l02474"></a><span class="lineno"> 2474</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02475"></a><span class="lineno"> 2475</span>&#160; </div>
<div class="line"><a name="l02476"></a><span class="lineno"><a class="line" href="hwcontext__vulkan_8c.html#af99e98fc6db03e4a7becac050fb248dd"> 2476</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="hwcontext__vulkan_8c.html#af99e98fc6db03e4a7becac050fb248dd">vulkan_map_to</a>(<a class="code" href="struct_a_v_h_w_frames_context.html">AVHWFramesContext</a> *hwfc, <a class="code" href="struct_a_v_frame.html">AVFrame</a> *dst,</div>
<div class="line"><a name="l02477"></a><span class="lineno"> 2477</span>&#160;                         <span class="keyword">const</span> <a class="code" href="struct_a_v_frame.html">AVFrame</a> *<a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>, <span class="keywordtype">int</span> <a class="code" href="cbs__av1_8c.html#a67119bce106892b6dade1dc5aa405ac9">flags</a>)</div>
<div class="line"><a name="l02478"></a><span class="lineno"> 2478</span>&#160;{</div>
<div class="line"><a name="l02479"></a><span class="lineno"> 2479</span>&#160;    <a class="code" href="attributes_8h.html#a7ca8a3900269f92fcc7b68235dea7787">av_unused</a> <a class="code" href="struct_vulkan_device_priv.html">VulkanDevicePriv</a> *p = hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#ac9a7dbd0cbfcabc0b1529cb34cf53b6d">device_ctx</a>-&gt;<a class="code" href="struct_a_v_h_w_device_context.html#a9c3758c73b0f29925ccb2f60b5c1a803">internal</a>-&gt;<a class="code" href="struct_a_v_h_w_device_internal.html#ae7425663cca9541964518c66974a20bf">priv</a>;</div>
<div class="line"><a name="l02480"></a><span class="lineno"> 2480</span>&#160; </div>
<div class="line"><a name="l02481"></a><span class="lineno"> 2481</span>&#160;    <span class="keywordflow">switch</span> (<a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>-&gt;format) {</div>
<div class="line"><a name="l02482"></a><span class="lineno"> 2482</span>&#160;<span class="preprocessor">#if CONFIG_LIBDRM</span></div>
<div class="line"><a name="l02483"></a><span class="lineno"> 2483</span>&#160;<span class="preprocessor">#if CONFIG_VAAPI</span></div>
<div class="line"><a name="l02484"></a><span class="lineno"> 2484</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5abb09cadf3b2d6b5ce5980401bcf638a8">AV_PIX_FMT_VAAPI</a>:</div>
<div class="line"><a name="l02485"></a><span class="lineno"> 2485</span>&#160;        <span class="keywordflow">if</span> (p-&gt;extensions &amp; <a class="code" href="hwcontext__vulkan_8c.html#adfa9f1974c8c5348db6b4034e3aa7b4ead055cca16ae2cf28b4e1ab34de136147">EXT_EXTERNAL_DMABUF_MEMORY</a>)</div>
<div class="line"><a name="l02486"></a><span class="lineno"> 2486</span>&#160;            <span class="keywordflow">return</span> vulkan_map_from_vaapi(hwfc, dst, <a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>, <a class="code" href="cbs__av1_8c.html#a67119bce106892b6dade1dc5aa405ac9">flags</a>);</div>
<div class="line"><a name="l02487"></a><span class="lineno"> 2487</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02488"></a><span class="lineno"> 2488</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a76a05fccc6f58f7ab655deefd794713e">AV_PIX_FMT_DRM_PRIME</a>:</div>
<div class="line"><a name="l02489"></a><span class="lineno"> 2489</span>&#160;        <span class="keywordflow">if</span> (p-&gt;extensions &amp; <a class="code" href="hwcontext__vulkan_8c.html#adfa9f1974c8c5348db6b4034e3aa7b4ead055cca16ae2cf28b4e1ab34de136147">EXT_EXTERNAL_DMABUF_MEMORY</a>)</div>
<div class="line"><a name="l02490"></a><span class="lineno"> 2490</span>&#160;            <span class="keywordflow">return</span> vulkan_map_from_drm(hwfc, dst, <a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>, <a class="code" href="cbs__av1_8c.html#a67119bce106892b6dade1dc5aa405ac9">flags</a>);</div>
<div class="line"><a name="l02491"></a><span class="lineno"> 2491</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02492"></a><span class="lineno"> 2492</span>&#160;    <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l02493"></a><span class="lineno"> 2493</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOSYS);</div>
<div class="line"><a name="l02494"></a><span class="lineno"> 2494</span>&#160;    }</div>
<div class="line"><a name="l02495"></a><span class="lineno"> 2495</span>&#160;}</div>
<div class="line"><a name="l02496"></a><span class="lineno"> 2496</span>&#160; </div>
<div class="line"><a name="l02497"></a><span class="lineno"> 2497</span>&#160;<span class="preprocessor">#if CONFIG_LIBDRM</span></div>
<div class="line"><a name="l02498"></a><span class="lineno"> 2498</span>&#160;<span class="keyword">typedef</span> <span class="keyword">struct </span>VulkanDRMMapping {</div>
<div class="line"><a name="l02499"></a><span class="lineno"> 2499</span>&#160;    <a class="code" href="struct_a_v_d_r_m_frame_descriptor.html">AVDRMFrameDescriptor</a> drm_desc;</div>
<div class="line"><a name="l02500"></a><span class="lineno"> 2500</span>&#160;    <a class="code" href="struct_a_v_vk_frame.html">AVVkFrame</a> *<a class="code" href="filter__design_8txt.html#a5235deffb07ad7b49c2b5fed063388e3">source</a>;</div>
<div class="line"><a name="l02501"></a><span class="lineno"> 2501</span>&#160;} VulkanDRMMapping;</div>
<div class="line"><a name="l02502"></a><span class="lineno"> 2502</span>&#160; </div>
<div class="line"><a name="l02503"></a><span class="lineno"> 2503</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> vulkan_unmap_to_drm(<a class="code" href="struct_a_v_h_w_frames_context.html">AVHWFramesContext</a> *hwfc, <a class="code" href="struct_h_w_map_descriptor.html">HWMapDescriptor</a> *hwmap)</div>
<div class="line"><a name="l02504"></a><span class="lineno"> 2504</span>&#160;{</div>
<div class="line"><a name="l02505"></a><span class="lineno"> 2505</span>&#160;    <a class="code" href="struct_a_v_d_r_m_frame_descriptor.html">AVDRMFrameDescriptor</a> *drm_desc = hwmap-&gt;<a class="code" href="struct_h_w_map_descriptor.html#a7ecea93e498181196f2121b85c07411d">priv</a>;</div>
<div class="line"><a name="l02506"></a><span class="lineno"> 2506</span>&#160; </div>
<div class="line"><a name="l02507"></a><span class="lineno"> 2507</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; drm_desc-&gt;<a class="code" href="struct_a_v_d_r_m_frame_descriptor.html#a5a11bc1854bb6cee2f5b0f9d514d0c4f">nb_objects</a>; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l02508"></a><span class="lineno"> 2508</span>&#160;        close(drm_desc-&gt;<a class="code" href="struct_a_v_d_r_m_frame_descriptor.html#a0a757137c80a528953645ab11f31e6b7">objects</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="struct_a_v_d_r_m_object_descriptor.html#a3732e73e288f10965cae373c70e8402e">fd</a>);</div>
<div class="line"><a name="l02509"></a><span class="lineno"> 2509</span>&#160; </div>
<div class="line"><a name="l02510"></a><span class="lineno"> 2510</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#a079eab092887563f2bef9106c6120089">av_free</a>(drm_desc);</div>
<div class="line"><a name="l02511"></a><span class="lineno"> 2511</span>&#160;}</div>
<div class="line"><a name="l02512"></a><span class="lineno"> 2512</span>&#160; </div>
<div class="line"><a name="l02513"></a><span class="lineno"> 2513</span>&#160;<span class="keyword">static</span> <span class="keyword">inline</span> uint32_t vulkan_fmt_to_drm(VkFormat vkfmt)</div>
<div class="line"><a name="l02514"></a><span class="lineno"> 2514</span>&#160;{</div>
<div class="line"><a name="l02515"></a><span class="lineno"> 2515</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="sinewin__tablegen__template_8c.html#a3508a98d3ee7e2c9a4841fe264cf70f7">FF_ARRAY_ELEMS</a>(vulkan_drm_format_map); <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l02516"></a><span class="lineno"> 2516</span>&#160;        <span class="keywordflow">if</span> (vulkan_drm_format_map[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].vk_format == vkfmt)</div>
<div class="line"><a name="l02517"></a><span class="lineno"> 2517</span>&#160;            <span class="keywordflow">return</span> vulkan_drm_format_map[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].drm_fourcc;</div>
<div class="line"><a name="l02518"></a><span class="lineno"> 2518</span>&#160;    <span class="keywordflow">return</span> DRM_FORMAT_INVALID;</div>
<div class="line"><a name="l02519"></a><span class="lineno"> 2519</span>&#160;}</div>
<div class="line"><a name="l02520"></a><span class="lineno"> 2520</span>&#160; </div>
<div class="line"><a name="l02521"></a><span class="lineno"> 2521</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> vulkan_map_to_drm(<a class="code" href="struct_a_v_h_w_frames_context.html">AVHWFramesContext</a> *hwfc, <a class="code" href="struct_a_v_frame.html">AVFrame</a> *dst,</div>
<div class="line"><a name="l02522"></a><span class="lineno"> 2522</span>&#160;                             <span class="keyword">const</span> <a class="code" href="struct_a_v_frame.html">AVFrame</a> *<a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>, <span class="keywordtype">int</span> <a class="code" href="cbs__av1_8c.html#a67119bce106892b6dade1dc5aa405ac9">flags</a>)</div>
<div class="line"><a name="l02523"></a><span class="lineno"> 2523</span>&#160;{</div>
<div class="line"><a name="l02524"></a><span class="lineno"> 2524</span>&#160;    <span class="keywordtype">int</span> err = 0;</div>
<div class="line"><a name="l02525"></a><span class="lineno"> 2525</span>&#160;    VkResult <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>;</div>
<div class="line"><a name="l02526"></a><span class="lineno"> 2526</span>&#160;    <a class="code" href="struct_a_v_vk_frame.html">AVVkFrame</a> *<a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a> = (<a class="code" href="struct_a_v_vk_frame.html">AVVkFrame</a> *)<a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>-&gt;data[0];</div>
<div class="line"><a name="l02527"></a><span class="lineno"> 2527</span>&#160;    <a class="code" href="struct_vulkan_device_priv.html">VulkanDevicePriv</a> *p = hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#ac9a7dbd0cbfcabc0b1529cb34cf53b6d">device_ctx</a>-&gt;<a class="code" href="struct_a_v_h_w_device_context.html#a9c3758c73b0f29925ccb2f60b5c1a803">internal</a>-&gt;<a class="code" href="struct_a_v_h_w_device_internal.html#ae7425663cca9541964518c66974a20bf">priv</a>;</div>
<div class="line"><a name="l02528"></a><span class="lineno"> 2528</span>&#160;    <a class="code" href="struct_vulkan_frames_priv.html">VulkanFramesPriv</a> *<a class="code" href="regdef_8h.html#ae771351dd440a8640270282362e338d0">fp</a> = hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#a69e956e8d2d73d65d015c4ed895ec642">internal</a>-&gt;<a class="code" href="struct_a_v_h_w_frames_internal.html#a503cfeb391ed69856344768fd641a489">priv</a>;</div>
<div class="line"><a name="l02529"></a><span class="lineno"> 2529</span>&#160;    <a class="code" href="struct_a_v_vulkan_device_context.html">AVVulkanDeviceContext</a> *hwctx = hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#ac9a7dbd0cbfcabc0b1529cb34cf53b6d">device_ctx</a>-&gt;<a class="code" href="struct_a_v_h_w_device_context.html#a46055b48d1a40445d775b4ae24f77f20">hwctx</a>;</div>
<div class="line"><a name="l02530"></a><span class="lineno"> 2530</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="llviddspenc_8c.html#a39de7029a33bc3271ae437de0a38c343">planes</a> = <a class="code" href="pixdesc_8c.html#a118df1d607abd7484f874b3d7ea8823a">av_pix_fmt_count_planes</a>(hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#a663a9aceca97aa7b2426c9aba6543e4a">sw_format</a>);</div>
<div class="line"><a name="l02531"></a><span class="lineno"> 2531</span>&#160;    <a class="code" href="hwcontext__vulkan_8c.html#acc25b1e67c50a452aa1965aaca0acf88">VK_LOAD_PFN</a>(hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#abb0e7a4336731e84eb1b25571635d243">inst</a>, vkGetMemoryFdKHR);</div>
<div class="line"><a name="l02532"></a><span class="lineno"> 2532</span>&#160;    VkImageDrmFormatModifierPropertiesEXT drm_mod = {</div>
<div class="line"><a name="l02533"></a><span class="lineno"> 2533</span>&#160;        .sType = VK_STRUCTURE_TYPE_IMAGE_DRM_FORMAT_MODIFIER_PROPERTIES_EXT,</div>
<div class="line"><a name="l02534"></a><span class="lineno"> 2534</span>&#160;    };</div>
<div class="line"><a name="l02535"></a><span class="lineno"> 2535</span>&#160; </div>
<div class="line"><a name="l02536"></a><span class="lineno"> 2536</span>&#160;    <a class="code" href="struct_a_v_d_r_m_frame_descriptor.html">AVDRMFrameDescriptor</a> *drm_desc = <a class="code" href="group__lavu__mem__funcs.html#gaf143ecab33a3868b57345466c39de7c1">av_mallocz</a>(<span class="keyword">sizeof</span>(*drm_desc));</div>
<div class="line"><a name="l02537"></a><span class="lineno"> 2537</span>&#160;    <span class="keywordflow">if</span> (!drm_desc)</div>
<div class="line"><a name="l02538"></a><span class="lineno"> 2538</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l02539"></a><span class="lineno"> 2539</span>&#160; </div>
<div class="line"><a name="l02540"></a><span class="lineno"> 2540</span>&#160;    err = <a class="code" href="hwcontext__vulkan_8c.html#aa2579750bda1abdf414c2f3f7de6d9fc">prepare_frame</a>(hwfc, &amp;<a class="code" href="regdef_8h.html#ae771351dd440a8640270282362e338d0">fp</a>-&gt;conv_ctx, <a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a>, <a class="code" href="hwcontext__vulkan_8c.html#af94790aab5b000aa1b44ce817563076faa880fb96e7667415366a5b8ac8525090">PREP_MODE_EXTERNAL_EXPORT</a>);</div>
<div class="line"><a name="l02541"></a><span class="lineno"> 2541</span>&#160;    <span class="keywordflow">if</span> (err &lt; 0)</div>
<div class="line"><a name="l02542"></a><span class="lineno"> 2542</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="avrndec_8c.html#a13191ba45577b1d4f9b37d64df91eb55">end</a>;</div>
<div class="line"><a name="l02543"></a><span class="lineno"> 2543</span>&#160; </div>
<div class="line"><a name="l02544"></a><span class="lineno"> 2544</span>&#160;    err = <a class="code" href="hwcontext_8c.html#a76e0387f519b3f1bd1b162e91b54b182">ff_hwframe_map_create</a>(<a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>-&gt;hw_frames_ctx, dst, <a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>, &amp;vulkan_unmap_to_drm, drm_desc);</div>
<div class="line"><a name="l02545"></a><span class="lineno"> 2545</span>&#160;    <span class="keywordflow">if</span> (err &lt; 0)</div>
<div class="line"><a name="l02546"></a><span class="lineno"> 2546</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="avrndec_8c.html#a13191ba45577b1d4f9b37d64df91eb55">end</a>;</div>
<div class="line"><a name="l02547"></a><span class="lineno"> 2547</span>&#160; </div>
<div class="line"><a name="l02548"></a><span class="lineno"> 2548</span>&#160;    <span class="keywordflow">if</span> (p-&gt;<a class="code" href="struct_vulkan_device_priv.html#a895a041d77f8253cb0842c23e54593f2">extensions</a> &amp; <a class="code" href="hwcontext__vulkan_8c.html#adfa9f1974c8c5348db6b4034e3aa7b4eac76edadb3f30757d5ba92676482f578a">EXT_DRM_MODIFIER_FLAGS</a>) {</div>
<div class="line"><a name="l02549"></a><span class="lineno"> 2549</span>&#160;        <a class="code" href="hwcontext__vulkan_8c.html#acc25b1e67c50a452aa1965aaca0acf88">VK_LOAD_PFN</a>(hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#abb0e7a4336731e84eb1b25571635d243">inst</a>, vkGetImageDrmFormatModifierPropertiesEXT);</div>
<div class="line"><a name="l02550"></a><span class="lineno"> 2550</span>&#160;        <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = pfn_vkGetImageDrmFormatModifierPropertiesEXT(hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a53a07d4474261e4e14ec03c5d15f71da">act_dev</a>, <a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a>-&gt;img[0],</div>
<div class="line"><a name="l02551"></a><span class="lineno"> 2551</span>&#160;                                                           &amp;drm_mod);</div>
<div class="line"><a name="l02552"></a><span class="lineno"> 2552</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> != VK_SUCCESS) {</div>
<div class="line"><a name="l02553"></a><span class="lineno"> 2553</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(hwfc, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to retrieve DRM format modifier!\n&quot;</span>);</div>
<div class="line"><a name="l02554"></a><span class="lineno"> 2554</span>&#160;            err = <a class="code" href="group__lavu__error.html#ga9c520e483ba8648495620ffdb4c491f2">AVERROR_EXTERNAL</a>;</div>
<div class="line"><a name="l02555"></a><span class="lineno"> 2555</span>&#160;            <span class="keywordflow">goto</span> <a class="code" href="avrndec_8c.html#a13191ba45577b1d4f9b37d64df91eb55">end</a>;</div>
<div class="line"><a name="l02556"></a><span class="lineno"> 2556</span>&#160;        }</div>
<div class="line"><a name="l02557"></a><span class="lineno"> 2557</span>&#160;    }</div>
<div class="line"><a name="l02558"></a><span class="lineno"> 2558</span>&#160; </div>
<div class="line"><a name="l02559"></a><span class="lineno"> 2559</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; (<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="llviddspenc_8c.html#a39de7029a33bc3271ae437de0a38c343">planes</a>) &amp;&amp; (<a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a>-&gt;mem[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>]); <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l02560"></a><span class="lineno"> 2560</span>&#160;        VkMemoryGetFdInfoKHR export_info = {</div>
<div class="line"><a name="l02561"></a><span class="lineno"> 2561</span>&#160;            .sType      = VK_STRUCTURE_TYPE_MEMORY_GET_FD_INFO_KHR,</div>
<div class="line"><a name="l02562"></a><span class="lineno"> 2562</span>&#160;            .memory     = <a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a>-&gt;mem[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>],</div>
<div class="line"><a name="l02563"></a><span class="lineno"> 2563</span>&#160;            .handleType = VK_EXTERNAL_MEMORY_HANDLE_TYPE_DMA_BUF_BIT_EXT,</div>
<div class="line"><a name="l02564"></a><span class="lineno"> 2564</span>&#160;        };</div>
<div class="line"><a name="l02565"></a><span class="lineno"> 2565</span>&#160; </div>
<div class="line"><a name="l02566"></a><span class="lineno"> 2566</span>&#160;        <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = pfn_vkGetMemoryFdKHR(hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a53a07d4474261e4e14ec03c5d15f71da">act_dev</a>, &amp;export_info,</div>
<div class="line"><a name="l02567"></a><span class="lineno"> 2567</span>&#160;                                   &amp;drm_desc-&gt;<a class="code" href="struct_a_v_d_r_m_frame_descriptor.html#a0a757137c80a528953645ab11f31e6b7">objects</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="struct_a_v_d_r_m_object_descriptor.html#a3732e73e288f10965cae373c70e8402e">fd</a>);</div>
<div class="line"><a name="l02568"></a><span class="lineno"> 2568</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> != VK_SUCCESS) {</div>
<div class="line"><a name="l02569"></a><span class="lineno"> 2569</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(hwfc, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to export the image as a FD!\n&quot;</span>);</div>
<div class="line"><a name="l02570"></a><span class="lineno"> 2570</span>&#160;            err = <a class="code" href="group__lavu__error.html#ga9c520e483ba8648495620ffdb4c491f2">AVERROR_EXTERNAL</a>;</div>
<div class="line"><a name="l02571"></a><span class="lineno"> 2571</span>&#160;            <span class="keywordflow">goto</span> <a class="code" href="avrndec_8c.html#a13191ba45577b1d4f9b37d64df91eb55">end</a>;</div>
<div class="line"><a name="l02572"></a><span class="lineno"> 2572</span>&#160;        }</div>
<div class="line"><a name="l02573"></a><span class="lineno"> 2573</span>&#160; </div>
<div class="line"><a name="l02574"></a><span class="lineno"> 2574</span>&#160;        drm_desc-&gt;<a class="code" href="struct_a_v_d_r_m_frame_descriptor.html#a5a11bc1854bb6cee2f5b0f9d514d0c4f">nb_objects</a>++;</div>
<div class="line"><a name="l02575"></a><span class="lineno"> 2575</span>&#160;        drm_desc-&gt;<a class="code" href="struct_a_v_d_r_m_frame_descriptor.html#a0a757137c80a528953645ab11f31e6b7">objects</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="struct_a_v_d_r_m_object_descriptor.html#a4eeb1aad28f187c3c3e4f9d547a55a3d">size</a> = <a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a>-&gt;size[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l02576"></a><span class="lineno"> 2576</span>&#160;        drm_desc-&gt;<a class="code" href="struct_a_v_d_r_m_frame_descriptor.html#a0a757137c80a528953645ab11f31e6b7">objects</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="struct_a_v_d_r_m_object_descriptor.html#ab193fb14460d5a5f90578a80608e82ae">format_modifier</a> = drm_mod.drmFormatModifier;</div>
<div class="line"><a name="l02577"></a><span class="lineno"> 2577</span>&#160;    }</div>
<div class="line"><a name="l02578"></a><span class="lineno"> 2578</span>&#160; </div>
<div class="line"><a name="l02579"></a><span class="lineno"> 2579</span>&#160;    drm_desc-&gt;<a class="code" href="struct_a_v_d_r_m_frame_descriptor.html#a228800d9ce195e776833e58ee307a6ec">nb_layers</a> = <a class="code" href="llviddspenc_8c.html#a39de7029a33bc3271ae437de0a38c343">planes</a>;</div>
<div class="line"><a name="l02580"></a><span class="lineno"> 2580</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; drm_desc-&gt;<a class="code" href="struct_a_v_d_r_m_frame_descriptor.html#a228800d9ce195e776833e58ee307a6ec">nb_layers</a>; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l02581"></a><span class="lineno"> 2581</span>&#160;        VkSubresourceLayout <a class="code" href="filter__design_8txt.html#a669858250c93520fd944ba5d6eb1884d">layout</a>;</div>
<div class="line"><a name="l02582"></a><span class="lineno"> 2582</span>&#160;        VkImageSubresource <a class="code" href="dnn__backend__native__layer__mathbinary_8c.html#aec238e230db0cd41b80558db403931dd">sub</a> = {</div>
<div class="line"><a name="l02583"></a><span class="lineno"> 2583</span>&#160;            .aspectMask = p-&gt;<a class="code" href="struct_vulkan_device_priv.html#a895a041d77f8253cb0842c23e54593f2">extensions</a> &amp; <a class="code" href="hwcontext__vulkan_8c.html#adfa9f1974c8c5348db6b4034e3aa7b4eac76edadb3f30757d5ba92676482f578a">EXT_DRM_MODIFIER_FLAGS</a> ?</div>
<div class="line"><a name="l02584"></a><span class="lineno"> 2584</span>&#160;                          VK_IMAGE_ASPECT_MEMORY_PLANE_0_BIT_EXT :</div>
<div class="line"><a name="l02585"></a><span class="lineno"> 2585</span>&#160;                          VK_IMAGE_ASPECT_COLOR_BIT,</div>
<div class="line"><a name="l02586"></a><span class="lineno"> 2586</span>&#160;        };</div>
<div class="line"><a name="l02587"></a><span class="lineno"> 2587</span>&#160;        VkFormat plane_vkfmt = <a class="code" href="hwcontext__vulkan_8c.html#ac3dce3efdada0dab3fd7fca01e374871">av_vkfmt_from_pixfmt</a>(hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#a663a9aceca97aa7b2426c9aba6543e4a">sw_format</a>)[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l02588"></a><span class="lineno"> 2588</span>&#160; </div>
<div class="line"><a name="l02589"></a><span class="lineno"> 2589</span>&#160;        drm_desc-&gt;<a class="code" href="struct_a_v_d_r_m_frame_descriptor.html#ad19d258e1771ef833d7e3bd873b91906">layers</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="struct_a_v_d_r_m_layer_descriptor.html#abe9b4585e3ad357cf058dada850c3226">format</a>    = vulkan_fmt_to_drm(plane_vkfmt);</div>
<div class="line"><a name="l02590"></a><span class="lineno"> 2590</span>&#160;        drm_desc-&gt;<a class="code" href="struct_a_v_d_r_m_frame_descriptor.html#ad19d258e1771ef833d7e3bd873b91906">layers</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="struct_a_v_d_r_m_layer_descriptor.html#aa71ce914f53563be8207d8bc08fbfe92">nb_planes</a> = 1;</div>
<div class="line"><a name="l02591"></a><span class="lineno"> 2591</span>&#160; </div>
<div class="line"><a name="l02592"></a><span class="lineno"> 2592</span>&#160;        <span class="keywordflow">if</span> (drm_desc-&gt;<a class="code" href="struct_a_v_d_r_m_frame_descriptor.html#ad19d258e1771ef833d7e3bd873b91906">layers</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="struct_a_v_d_r_m_layer_descriptor.html#abe9b4585e3ad357cf058dada850c3226">format</a> == DRM_FORMAT_INVALID) {</div>
<div class="line"><a name="l02593"></a><span class="lineno"> 2593</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(hwfc, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Cannot map to DRM layer, unsupported!\n&quot;</span>);</div>
<div class="line"><a name="l02594"></a><span class="lineno"> 2594</span>&#160;            err = <a class="code" href="group__lavu__error.html#ga67a27567a9e5b7037fee072fbcc34dbf">AVERROR_PATCHWELCOME</a>;</div>
<div class="line"><a name="l02595"></a><span class="lineno"> 2595</span>&#160;            <span class="keywordflow">goto</span> <a class="code" href="avrndec_8c.html#a13191ba45577b1d4f9b37d64df91eb55">end</a>;</div>
<div class="line"><a name="l02596"></a><span class="lineno"> 2596</span>&#160;        }</div>
<div class="line"><a name="l02597"></a><span class="lineno"> 2597</span>&#160; </div>
<div class="line"><a name="l02598"></a><span class="lineno"> 2598</span>&#160;        drm_desc-&gt;<a class="code" href="struct_a_v_d_r_m_frame_descriptor.html#ad19d258e1771ef833d7e3bd873b91906">layers</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="struct_a_v_d_r_m_layer_descriptor.html#a7fbaf03f401c451e82021487fefef159">planes</a>[0].<a class="code" href="struct_a_v_d_r_m_plane_descriptor.html#af07fe11d604e0a3b5fd934f9626c008b">object_index</a> = <a class="code" href="common_8h.html#a0f84cbd7fd810cd678157c98cbfad4b0">FFMIN</a>(<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>, drm_desc-&gt;<a class="code" href="struct_a_v_d_r_m_frame_descriptor.html#a5a11bc1854bb6cee2f5b0f9d514d0c4f">nb_objects</a> - 1);</div>
<div class="line"><a name="l02599"></a><span class="lineno"> 2599</span>&#160; </div>
<div class="line"><a name="l02600"></a><span class="lineno"> 2600</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a>-&gt;tiling == VK_IMAGE_TILING_OPTIMAL)</div>
<div class="line"><a name="l02601"></a><span class="lineno"> 2601</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02602"></a><span class="lineno"> 2602</span>&#160; </div>
<div class="line"><a name="l02603"></a><span class="lineno"> 2603</span>&#160;        vkGetImageSubresourceLayout(hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a53a07d4474261e4e14ec03c5d15f71da">act_dev</a>, <a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a>-&gt;img[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>], &amp;<a class="code" href="dnn__backend__native__layer__mathbinary_8c.html#aec238e230db0cd41b80558db403931dd">sub</a>, &amp;<a class="code" href="filter__design_8txt.html#a669858250c93520fd944ba5d6eb1884d">layout</a>);</div>
<div class="line"><a name="l02604"></a><span class="lineno"> 2604</span>&#160;        drm_desc-&gt;<a class="code" href="struct_a_v_d_r_m_frame_descriptor.html#ad19d258e1771ef833d7e3bd873b91906">layers</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="struct_a_v_d_r_m_layer_descriptor.html#a7fbaf03f401c451e82021487fefef159">planes</a>[0].<a class="code" href="struct_a_v_d_r_m_plane_descriptor.html#af1a0839b02055445257d431d946d96a7">offset</a>       = <a class="code" href="filter__design_8txt.html#a669858250c93520fd944ba5d6eb1884d">layout</a>.offset;</div>
<div class="line"><a name="l02605"></a><span class="lineno"> 2605</span>&#160;        drm_desc-&gt;<a class="code" href="struct_a_v_d_r_m_frame_descriptor.html#ad19d258e1771ef833d7e3bd873b91906">layers</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="struct_a_v_d_r_m_layer_descriptor.html#a7fbaf03f401c451e82021487fefef159">planes</a>[0].<a class="code" href="struct_a_v_d_r_m_plane_descriptor.html#aa4eaa5a37f40dd7301ce1b8194eefc0a">pitch</a>        = <a class="code" href="filter__design_8txt.html#a669858250c93520fd944ba5d6eb1884d">layout</a>.rowPitch;</div>
<div class="line"><a name="l02606"></a><span class="lineno"> 2606</span>&#160;    }</div>
<div class="line"><a name="l02607"></a><span class="lineno"> 2607</span>&#160; </div>
<div class="line"><a name="l02608"></a><span class="lineno"> 2608</span>&#160;    dst-&gt;<a class="code" href="struct_a_v_frame.html#a1e71ce60cedd5f3b6811714a9f7f9e0a">width</a>   = <a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>-&gt;width;</div>
<div class="line"><a name="l02609"></a><span class="lineno"> 2609</span>&#160;    dst-&gt;<a class="code" href="struct_a_v_frame.html#a3f89733f429c98ba5bc64373fb0a3f13">height</a>  = <a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>-&gt;height;</div>
<div class="line"><a name="l02610"></a><span class="lineno"> 2610</span>&#160;    dst-&gt;<a class="code" href="struct_a_v_frame.html#a1d0f65014a8d1bf78cec8cbed2304992">data</a>[0] = (<a class="code" href="audio__convert_8c.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> *)drm_desc;</div>
<div class="line"><a name="l02611"></a><span class="lineno"> 2611</span>&#160; </div>
<div class="line"><a name="l02612"></a><span class="lineno"> 2612</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(hwfc, <a class="code" href="group__lavu__log__constants.html#ga9b58b28e2d429b930b69db19877f76a8">AV_LOG_VERBOSE</a>, <span class="stringliteral">&quot;Mapped AVVkFrame to a DRM object!\n&quot;</span>);</div>
<div class="line"><a name="l02613"></a><span class="lineno"> 2613</span>&#160; </div>
<div class="line"><a name="l02614"></a><span class="lineno"> 2614</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l02615"></a><span class="lineno"> 2615</span>&#160; </div>
<div class="line"><a name="l02616"></a><span class="lineno"> 2616</span>&#160;<a class="code" href="avrndec_8c.html#a13191ba45577b1d4f9b37d64df91eb55">end</a>:</div>
<div class="line"><a name="l02617"></a><span class="lineno"> 2617</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#a079eab092887563f2bef9106c6120089">av_free</a>(drm_desc);</div>
<div class="line"><a name="l02618"></a><span class="lineno"> 2618</span>&#160;    <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l02619"></a><span class="lineno"> 2619</span>&#160;}</div>
<div class="line"><a name="l02620"></a><span class="lineno"> 2620</span>&#160; </div>
<div class="line"><a name="l02621"></a><span class="lineno"> 2621</span>&#160;<span class="preprocessor">#if CONFIG_VAAPI</span></div>
<div class="line"><a name="l02622"></a><span class="lineno"> 2622</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> vulkan_map_to_vaapi(<a class="code" href="struct_a_v_h_w_frames_context.html">AVHWFramesContext</a> *hwfc, <a class="code" href="struct_a_v_frame.html">AVFrame</a> *dst,</div>
<div class="line"><a name="l02623"></a><span class="lineno"> 2623</span>&#160;                               <span class="keyword">const</span> <a class="code" href="struct_a_v_frame.html">AVFrame</a> *<a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>, <span class="keywordtype">int</span> <a class="code" href="cbs__av1_8c.html#a67119bce106892b6dade1dc5aa405ac9">flags</a>)</div>
<div class="line"><a name="l02624"></a><span class="lineno"> 2624</span>&#160;{</div>
<div class="line"><a name="l02625"></a><span class="lineno"> 2625</span>&#160;    <span class="keywordtype">int</span> err;</div>
<div class="line"><a name="l02626"></a><span class="lineno"> 2626</span>&#160;    <a class="code" href="struct_a_v_frame.html">AVFrame</a> *tmp = <a class="code" href="group__lavu__frame.html#gac700017c5270c79c1e1befdeeb008b2f">av_frame_alloc</a>();</div>
<div class="line"><a name="l02627"></a><span class="lineno"> 2627</span>&#160;    <span class="keywordflow">if</span> (!tmp)</div>
<div class="line"><a name="l02628"></a><span class="lineno"> 2628</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l02629"></a><span class="lineno"> 2629</span>&#160; </div>
<div class="line"><a name="l02630"></a><span class="lineno"> 2630</span>&#160;    tmp-&gt;<a class="code" href="struct_a_v_frame.html#aed14fa772ce46881020fd1545c86432c">format</a> = <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a76a05fccc6f58f7ab655deefd794713e">AV_PIX_FMT_DRM_PRIME</a>;</div>
<div class="line"><a name="l02631"></a><span class="lineno"> 2631</span>&#160; </div>
<div class="line"><a name="l02632"></a><span class="lineno"> 2632</span>&#160;    err = vulkan_map_to_drm(hwfc, tmp, <a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>, <a class="code" href="cbs__av1_8c.html#a67119bce106892b6dade1dc5aa405ac9">flags</a>);</div>
<div class="line"><a name="l02633"></a><span class="lineno"> 2633</span>&#160;    <span class="keywordflow">if</span> (err &lt; 0)</div>
<div class="line"><a name="l02634"></a><span class="lineno"> 2634</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l02635"></a><span class="lineno"> 2635</span>&#160; </div>
<div class="line"><a name="l02636"></a><span class="lineno"> 2636</span>&#160;    err = <a class="code" href="hwcontext_8c.html#a99e028453fba7e66483c2189439219d2">av_hwframe_map</a>(dst, tmp, <a class="code" href="cbs__av1_8c.html#a67119bce106892b6dade1dc5aa405ac9">flags</a>);</div>
<div class="line"><a name="l02637"></a><span class="lineno"> 2637</span>&#160;    <span class="keywordflow">if</span> (err &lt; 0)</div>
<div class="line"><a name="l02638"></a><span class="lineno"> 2638</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l02639"></a><span class="lineno"> 2639</span>&#160; </div>
<div class="line"><a name="l02640"></a><span class="lineno"> 2640</span>&#160;    err = <a class="code" href="hwcontext_8c.html#af42d5b3b23a1d521e6457276e2cd0a53">ff_hwframe_map_replace</a>(dst, <a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>);</div>
<div class="line"><a name="l02641"></a><span class="lineno"> 2641</span>&#160; </div>
<div class="line"><a name="l02642"></a><span class="lineno"> 2642</span>&#160;<a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>:</div>
<div class="line"><a name="l02643"></a><span class="lineno"> 2643</span>&#160;    <a class="code" href="group__lavu__frame.html#ga979d73f3228814aee56aeca0636e37cc">av_frame_free</a>(&amp;tmp);</div>
<div class="line"><a name="l02644"></a><span class="lineno"> 2644</span>&#160;    <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l02645"></a><span class="lineno"> 2645</span>&#160;}</div>
<div class="line"><a name="l02646"></a><span class="lineno"> 2646</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02647"></a><span class="lineno"> 2647</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02648"></a><span class="lineno"> 2648</span>&#160; </div>
<div class="line"><a name="l02649"></a><span class="lineno"><a class="line" href="hwcontext__vulkan_8c.html#a8d06ffcc7812858be5d3ba5d4b11c3fb"> 2649</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="hwcontext__vulkan_8c.html#a8d06ffcc7812858be5d3ba5d4b11c3fb">vulkan_map_from</a>(<a class="code" href="struct_a_v_h_w_frames_context.html">AVHWFramesContext</a> *hwfc, <a class="code" href="struct_a_v_frame.html">AVFrame</a> *dst,</div>
<div class="line"><a name="l02650"></a><span class="lineno"> 2650</span>&#160;                           <span class="keyword">const</span> <a class="code" href="struct_a_v_frame.html">AVFrame</a> *<a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>, <span class="keywordtype">int</span> <a class="code" href="cbs__av1_8c.html#a67119bce106892b6dade1dc5aa405ac9">flags</a>)</div>
<div class="line"><a name="l02651"></a><span class="lineno"> 2651</span>&#160;{</div>
<div class="line"><a name="l02652"></a><span class="lineno"> 2652</span>&#160;    <a class="code" href="attributes_8h.html#a7ca8a3900269f92fcc7b68235dea7787">av_unused</a> <a class="code" href="struct_vulkan_device_priv.html">VulkanDevicePriv</a> *p = hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#ac9a7dbd0cbfcabc0b1529cb34cf53b6d">device_ctx</a>-&gt;<a class="code" href="struct_a_v_h_w_device_context.html#a9c3758c73b0f29925ccb2f60b5c1a803">internal</a>-&gt;<a class="code" href="struct_a_v_h_w_device_internal.html#ae7425663cca9541964518c66974a20bf">priv</a>;</div>
<div class="line"><a name="l02653"></a><span class="lineno"> 2653</span>&#160; </div>
<div class="line"><a name="l02654"></a><span class="lineno"> 2654</span>&#160;    <span class="keywordflow">switch</span> (dst-&gt;<a class="code" href="struct_a_v_frame.html#aed14fa772ce46881020fd1545c86432c">format</a>) {</div>
<div class="line"><a name="l02655"></a><span class="lineno"> 2655</span>&#160;<span class="preprocessor">#if CONFIG_LIBDRM</span></div>
<div class="line"><a name="l02656"></a><span class="lineno"> 2656</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a76a05fccc6f58f7ab655deefd794713e">AV_PIX_FMT_DRM_PRIME</a>:</div>
<div class="line"><a name="l02657"></a><span class="lineno"> 2657</span>&#160;        <span class="keywordflow">if</span> (p-&gt;extensions &amp; <a class="code" href="hwcontext__vulkan_8c.html#adfa9f1974c8c5348db6b4034e3aa7b4ead055cca16ae2cf28b4e1ab34de136147">EXT_EXTERNAL_DMABUF_MEMORY</a>)</div>
<div class="line"><a name="l02658"></a><span class="lineno"> 2658</span>&#160;            <span class="keywordflow">return</span> vulkan_map_to_drm(hwfc, dst, <a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>, <a class="code" href="cbs__av1_8c.html#a67119bce106892b6dade1dc5aa405ac9">flags</a>);</div>
<div class="line"><a name="l02659"></a><span class="lineno"> 2659</span>&#160;<span class="preprocessor">#if CONFIG_VAAPI</span></div>
<div class="line"><a name="l02660"></a><span class="lineno"> 2660</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5abb09cadf3b2d6b5ce5980401bcf638a8">AV_PIX_FMT_VAAPI</a>:</div>
<div class="line"><a name="l02661"></a><span class="lineno"> 2661</span>&#160;        <span class="keywordflow">if</span> (p-&gt;extensions &amp; <a class="code" href="hwcontext__vulkan_8c.html#adfa9f1974c8c5348db6b4034e3aa7b4ead055cca16ae2cf28b4e1ab34de136147">EXT_EXTERNAL_DMABUF_MEMORY</a>)</div>
<div class="line"><a name="l02662"></a><span class="lineno"> 2662</span>&#160;            <span class="keywordflow">return</span> vulkan_map_to_vaapi(hwfc, dst, <a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>, <a class="code" href="cbs__av1_8c.html#a67119bce106892b6dade1dc5aa405ac9">flags</a>);</div>
<div class="line"><a name="l02663"></a><span class="lineno"> 2663</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02664"></a><span class="lineno"> 2664</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02665"></a><span class="lineno"> 2665</span>&#160;    <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l02666"></a><span class="lineno"> 2666</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="hwcontext__vulkan_8c.html#a213d14a16ccf5f6f6e9e5ac88824e17d">vulkan_map_frame_to_mem</a>(hwfc, dst, <a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>, <a class="code" href="cbs__av1_8c.html#a67119bce106892b6dade1dc5aa405ac9">flags</a>);</div>
<div class="line"><a name="l02667"></a><span class="lineno"> 2667</span>&#160;    }</div>
<div class="line"><a name="l02668"></a><span class="lineno"> 2668</span>&#160;}</div>
<div class="line"><a name="l02669"></a><span class="lineno"> 2669</span>&#160; </div>
<div class="line"><a name="l02670"></a><span class="lineno"><a class="line" href="struct_image_buffer.html"> 2670</a></span>&#160;<span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="struct_image_buffer.html">ImageBuffer</a> {</div>
<div class="line"><a name="l02671"></a><span class="lineno"><a class="line" href="struct_image_buffer.html#a299da0e5749c00f1f2d00c4f28e4e279"> 2671</a></span>&#160;    VkBuffer <a class="code" href="struct_image_buffer.html#a299da0e5749c00f1f2d00c4f28e4e279">buf</a>;</div>
<div class="line"><a name="l02672"></a><span class="lineno"><a class="line" href="struct_image_buffer.html#abd90eaa49258fc976bf1270c1ef7d87e"> 2672</a></span>&#160;    VkDeviceMemory <a class="code" href="struct_image_buffer.html#abd90eaa49258fc976bf1270c1ef7d87e">mem</a>;</div>
<div class="line"><a name="l02673"></a><span class="lineno"><a class="line" href="struct_image_buffer.html#a3a7d8a5633569cbb8fb3e794d015de14"> 2673</a></span>&#160;    VkMemoryPropertyFlagBits <a class="code" href="struct_image_buffer.html#a3a7d8a5633569cbb8fb3e794d015de14">flags</a>;</div>
<div class="line"><a name="l02674"></a><span class="lineno"><a class="line" href="struct_image_buffer.html#aeda7e486d290d8e58f429bc80ec7674a"> 2674</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="struct_image_buffer.html#aeda7e486d290d8e58f429bc80ec7674a">mapped_mem</a>;</div>
<div class="line"><a name="l02675"></a><span class="lineno"><a class="line" href="hwcontext__vulkan_8c.html#a7d5cec728363ce6d6720b465027585c1"> 2675</a></span>&#160;} <a class="code" href="hwcontext__vulkan_8c.html#a7d5cec728363ce6d6720b465027585c1">ImageBuffer</a>;</div>
<div class="line"><a name="l02676"></a><span class="lineno"> 2676</span>&#160; </div>
<div class="line"><a name="l02677"></a><span class="lineno"><a class="line" href="hwcontext__vulkan_8c.html#a2014da36c681525c5f5565596bdb4ad3"> 2677</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="hwcontext__vulkan_8c.html#a2014da36c681525c5f5565596bdb4ad3">free_buf</a>(<span class="keywordtype">void</span> *opaque, <a class="code" href="audio__convert_8c.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> *<a class="code" href="mxf_8c.html#a084824fc871e38157790c99ae1240842">data</a>)</div>
<div class="line"><a name="l02678"></a><span class="lineno"> 2678</span>&#160;{</div>
<div class="line"><a name="l02679"></a><span class="lineno"> 2679</span>&#160;    <a class="code" href="struct_a_v_h_w_device_context.html">AVHWDeviceContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a> = opaque;</div>
<div class="line"><a name="l02680"></a><span class="lineno"> 2680</span>&#160;    <a class="code" href="struct_a_v_vulkan_device_context.html">AVVulkanDeviceContext</a> *hwctx = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;hwctx;</div>
<div class="line"><a name="l02681"></a><span class="lineno"> 2681</span>&#160;    <a class="code" href="struct_image_buffer.html">ImageBuffer</a> *vkbuf = (<a class="code" href="struct_image_buffer.html">ImageBuffer</a> *)<a class="code" href="mxf_8c.html#a084824fc871e38157790c99ae1240842">data</a>;</div>
<div class="line"><a name="l02682"></a><span class="lineno"> 2682</span>&#160; </div>
<div class="line"><a name="l02683"></a><span class="lineno"> 2683</span>&#160;    <span class="keywordflow">if</span> (vkbuf-&gt;<a class="code" href="struct_image_buffer.html#a299da0e5749c00f1f2d00c4f28e4e279">buf</a>)</div>
<div class="line"><a name="l02684"></a><span class="lineno"> 2684</span>&#160;        vkDestroyBuffer(hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a53a07d4474261e4e14ec03c5d15f71da">act_dev</a>, vkbuf-&gt;<a class="code" href="struct_image_buffer.html#a299da0e5749c00f1f2d00c4f28e4e279">buf</a>, hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a4a617020274526c26e265781aefcd22c">alloc</a>);</div>
<div class="line"><a name="l02685"></a><span class="lineno"> 2685</span>&#160;    <span class="keywordflow">if</span> (vkbuf-&gt;<a class="code" href="struct_image_buffer.html#abd90eaa49258fc976bf1270c1ef7d87e">mem</a>)</div>
<div class="line"><a name="l02686"></a><span class="lineno"> 2686</span>&#160;        vkFreeMemory(hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a53a07d4474261e4e14ec03c5d15f71da">act_dev</a>, vkbuf-&gt;<a class="code" href="struct_image_buffer.html#abd90eaa49258fc976bf1270c1ef7d87e">mem</a>, hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a4a617020274526c26e265781aefcd22c">alloc</a>);</div>
<div class="line"><a name="l02687"></a><span class="lineno"> 2687</span>&#160; </div>
<div class="line"><a name="l02688"></a><span class="lineno"> 2688</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#a079eab092887563f2bef9106c6120089">av_free</a>(<a class="code" href="mxf_8c.html#a084824fc871e38157790c99ae1240842">data</a>);</div>
<div class="line"><a name="l02689"></a><span class="lineno"> 2689</span>&#160;}</div>
<div class="line"><a name="l02690"></a><span class="lineno"> 2690</span>&#160; </div>
<div class="line"><a name="l02691"></a><span class="lineno"><a class="line" href="hwcontext__vulkan_8c.html#a6497b212ff94fbc7983213312c97ef97"> 2691</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="hwcontext__vulkan_8c.html#a6497b212ff94fbc7983213312c97ef97">create_buf</a>(<a class="code" href="struct_a_v_h_w_device_context.html">AVHWDeviceContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, <a class="code" href="struct_a_v_buffer_ref.html">AVBufferRef</a> **buf, <span class="keywordtype">size_t</span> imp_size,</div>
<div class="line"><a name="l02692"></a><span class="lineno"> 2692</span>&#160;                      <span class="keywordtype">int</span> <a class="code" href="tests_2snowenc_8c.html#a64f9f90ece96c7bab4aee3deacf170e0">height</a>, <span class="keywordtype">int</span> *<a class="code" href="mace_8c.html#a08f66a6870d87afcd5dc1b60d1019692">stride</a>, VkBufferUsageFlags <a class="code" href="floatimg__cmp_8c.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a>,</div>
<div class="line"><a name="l02693"></a><span class="lineno"> 2693</span>&#160;                      VkMemoryPropertyFlagBits <a class="code" href="cbs__av1_8c.html#a67119bce106892b6dade1dc5aa405ac9">flags</a>, <span class="keywordtype">void</span> *create_pnext,</div>
<div class="line"><a name="l02694"></a><span class="lineno"> 2694</span>&#160;                      <span class="keywordtype">void</span> *alloc_pnext)</div>
<div class="line"><a name="l02695"></a><span class="lineno"> 2695</span>&#160;{</div>
<div class="line"><a name="l02696"></a><span class="lineno"> 2696</span>&#160;    <span class="keywordtype">int</span> err;</div>
<div class="line"><a name="l02697"></a><span class="lineno"> 2697</span>&#160;    VkResult <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>;</div>
<div class="line"><a name="l02698"></a><span class="lineno"> 2698</span>&#160;    <span class="keywordtype">int</span> use_ded_mem;</div>
<div class="line"><a name="l02699"></a><span class="lineno"> 2699</span>&#160;    <a class="code" href="struct_a_v_vulkan_device_context.html">AVVulkanDeviceContext</a> *hwctx = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;hwctx;</div>
<div class="line"><a name="l02700"></a><span class="lineno"> 2700</span>&#160;    <a class="code" href="struct_vulkan_device_priv.html">VulkanDevicePriv</a> *p = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;<a class="code" href="struct_a_v_format_context.html#a8a8bec51da36db65ff864f88a85805d9">internal</a>-&gt;priv;</div>
<div class="line"><a name="l02701"></a><span class="lineno"> 2701</span>&#160; </div>
<div class="line"><a name="l02702"></a><span class="lineno"> 2702</span>&#160;    VkBufferCreateInfo buf_spawn = {</div>
<div class="line"><a name="l02703"></a><span class="lineno"> 2703</span>&#160;        .sType       = VK_STRUCTURE_TYPE_BUFFER_CREATE_INFO,</div>
<div class="line"><a name="l02704"></a><span class="lineno"> 2704</span>&#160;        .pNext       = create_pnext,</div>
<div class="line"><a name="l02705"></a><span class="lineno"> 2705</span>&#160;        .usage       = <a class="code" href="floatimg__cmp_8c.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a>,</div>
<div class="line"><a name="l02706"></a><span class="lineno"> 2706</span>&#160;        .sharingMode = VK_SHARING_MODE_EXCLUSIVE,</div>
<div class="line"><a name="l02707"></a><span class="lineno"> 2707</span>&#160;    };</div>
<div class="line"><a name="l02708"></a><span class="lineno"> 2708</span>&#160; </div>
<div class="line"><a name="l02709"></a><span class="lineno"> 2709</span>&#160;    VkBufferMemoryRequirementsInfo2 req_desc = {</div>
<div class="line"><a name="l02710"></a><span class="lineno"> 2710</span>&#160;        .sType = VK_STRUCTURE_TYPE_BUFFER_MEMORY_REQUIREMENTS_INFO_2,</div>
<div class="line"><a name="l02711"></a><span class="lineno"> 2711</span>&#160;    };</div>
<div class="line"><a name="l02712"></a><span class="lineno"> 2712</span>&#160;    VkMemoryDedicatedAllocateInfo ded_alloc = {</div>
<div class="line"><a name="l02713"></a><span class="lineno"> 2713</span>&#160;        .sType = VK_STRUCTURE_TYPE_MEMORY_DEDICATED_ALLOCATE_INFO,</div>
<div class="line"><a name="l02714"></a><span class="lineno"> 2714</span>&#160;        .pNext = alloc_pnext,</div>
<div class="line"><a name="l02715"></a><span class="lineno"> 2715</span>&#160;    };</div>
<div class="line"><a name="l02716"></a><span class="lineno"> 2716</span>&#160;    VkMemoryDedicatedRequirements ded_req = {</div>
<div class="line"><a name="l02717"></a><span class="lineno"> 2717</span>&#160;        .sType = VK_STRUCTURE_TYPE_MEMORY_DEDICATED_REQUIREMENTS,</div>
<div class="line"><a name="l02718"></a><span class="lineno"> 2718</span>&#160;    };</div>
<div class="line"><a name="l02719"></a><span class="lineno"> 2719</span>&#160;    VkMemoryRequirements2 req = {</div>
<div class="line"><a name="l02720"></a><span class="lineno"> 2720</span>&#160;        .sType = VK_STRUCTURE_TYPE_MEMORY_REQUIREMENTS_2,</div>
<div class="line"><a name="l02721"></a><span class="lineno"> 2721</span>&#160;        .pNext = &amp;ded_req,</div>
<div class="line"><a name="l02722"></a><span class="lineno"> 2722</span>&#160;    };</div>
<div class="line"><a name="l02723"></a><span class="lineno"> 2723</span>&#160; </div>
<div class="line"><a name="l02724"></a><span class="lineno"> 2724</span>&#160;    <a class="code" href="struct_image_buffer.html">ImageBuffer</a> *vkbuf = <a class="code" href="group__lavu__mem__funcs.html#gaf143ecab33a3868b57345466c39de7c1">av_mallocz</a>(<span class="keyword">sizeof</span>(*vkbuf));</div>
<div class="line"><a name="l02725"></a><span class="lineno"> 2725</span>&#160;    <span class="keywordflow">if</span> (!vkbuf)</div>
<div class="line"><a name="l02726"></a><span class="lineno"> 2726</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l02727"></a><span class="lineno"> 2727</span>&#160; </div>
<div class="line"><a name="l02728"></a><span class="lineno"> 2728</span>&#160;    vkbuf-&gt;<a class="code" href="struct_image_buffer.html#aeda7e486d290d8e58f429bc80ec7674a">mapped_mem</a> = !!imp_size;</div>
<div class="line"><a name="l02729"></a><span class="lineno"> 2729</span>&#160; </div>
<div class="line"><a name="l02730"></a><span class="lineno"> 2730</span>&#160;    <span class="keywordflow">if</span> (!vkbuf-&gt;<a class="code" href="struct_image_buffer.html#aeda7e486d290d8e58f429bc80ec7674a">mapped_mem</a>) {</div>
<div class="line"><a name="l02731"></a><span class="lineno"> 2731</span>&#160;        *<a class="code" href="mace_8c.html#a08f66a6870d87afcd5dc1b60d1019692">stride</a> = <a class="code" href="macros_8h.html#acae4ba605b3a7d535b7ac058ffe96892">FFALIGN</a>(*<a class="code" href="mace_8c.html#a08f66a6870d87afcd5dc1b60d1019692">stride</a>, p-&gt;<a class="code" href="struct_vulkan_device_priv.html#a93919fc0c25c1a74251fc14bccc70188">props</a>.properties.limits.optimalBufferCopyRowPitchAlignment);</div>
<div class="line"><a name="l02732"></a><span class="lineno"> 2732</span>&#160;        buf_spawn.size = <a class="code" href="tests_2snowenc_8c.html#a64f9f90ece96c7bab4aee3deacf170e0">height</a>*(*stride);</div>
<div class="line"><a name="l02733"></a><span class="lineno"> 2733</span>&#160;        buf_spawn.size = <a class="code" href="macros_8h.html#acae4ba605b3a7d535b7ac058ffe96892">FFALIGN</a>(buf_spawn.size, p-&gt;<a class="code" href="struct_vulkan_device_priv.html#a93919fc0c25c1a74251fc14bccc70188">props</a>.properties.limits.minMemoryMapAlignment);</div>
<div class="line"><a name="l02734"></a><span class="lineno"> 2734</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02735"></a><span class="lineno"> 2735</span>&#160;        buf_spawn.size = imp_size;</div>
<div class="line"><a name="l02736"></a><span class="lineno"> 2736</span>&#160;    }</div>
<div class="line"><a name="l02737"></a><span class="lineno"> 2737</span>&#160; </div>
<div class="line"><a name="l02738"></a><span class="lineno"> 2738</span>&#160;    <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = vkCreateBuffer(hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a53a07d4474261e4e14ec03c5d15f71da">act_dev</a>, &amp;buf_spawn, <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, &amp;vkbuf-&gt;<a class="code" href="struct_image_buffer.html#a299da0e5749c00f1f2d00c4f28e4e279">buf</a>);</div>
<div class="line"><a name="l02739"></a><span class="lineno"> 2739</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> != VK_SUCCESS) {</div>
<div class="line"><a name="l02740"></a><span class="lineno"> 2740</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to create buffer: %s\n&quot;</span>,</div>
<div class="line"><a name="l02741"></a><span class="lineno"> 2741</span>&#160;               <a class="code" href="hwcontext__vulkan_8c.html#ab4395598042453295899a91b26ad013b">vk_ret2str</a>(<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>));</div>
<div class="line"><a name="l02742"></a><span class="lineno"> 2742</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="group__lavu__error.html#ga9c520e483ba8648495620ffdb4c491f2">AVERROR_EXTERNAL</a>;</div>
<div class="line"><a name="l02743"></a><span class="lineno"> 2743</span>&#160;    }</div>
<div class="line"><a name="l02744"></a><span class="lineno"> 2744</span>&#160; </div>
<div class="line"><a name="l02745"></a><span class="lineno"> 2745</span>&#160;    req_desc.buffer = vkbuf-&gt;<a class="code" href="struct_image_buffer.html#a299da0e5749c00f1f2d00c4f28e4e279">buf</a>;</div>
<div class="line"><a name="l02746"></a><span class="lineno"> 2746</span>&#160; </div>
<div class="line"><a name="l02747"></a><span class="lineno"> 2747</span>&#160;    vkGetBufferMemoryRequirements2(hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a53a07d4474261e4e14ec03c5d15f71da">act_dev</a>, &amp;req_desc, &amp;req);</div>
<div class="line"><a name="l02748"></a><span class="lineno"> 2748</span>&#160; </div>
<div class="line"><a name="l02749"></a><span class="lineno"> 2749</span>&#160;    <span class="comment">/* In case the implementation prefers/requires dedicated allocation */</span></div>
<div class="line"><a name="l02750"></a><span class="lineno"> 2750</span>&#160;    use_ded_mem = ded_req.prefersDedicatedAllocation |</div>
<div class="line"><a name="l02751"></a><span class="lineno"> 2751</span>&#160;                  ded_req.requiresDedicatedAllocation;</div>
<div class="line"><a name="l02752"></a><span class="lineno"> 2752</span>&#160;    <span class="keywordflow">if</span> (use_ded_mem)</div>
<div class="line"><a name="l02753"></a><span class="lineno"> 2753</span>&#160;        ded_alloc.buffer = vkbuf-&gt;<a class="code" href="struct_image_buffer.html#a299da0e5749c00f1f2d00c4f28e4e279">buf</a>;</div>
<div class="line"><a name="l02754"></a><span class="lineno"> 2754</span>&#160; </div>
<div class="line"><a name="l02755"></a><span class="lineno"> 2755</span>&#160;    err = <a class="code" href="hwcontext__vulkan_8c.html#a1bc9deeeb2378022c6deaf235ab97fe8">alloc_mem</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, &amp;req.memoryRequirements, <a class="code" href="cbs__av1_8c.html#a67119bce106892b6dade1dc5aa405ac9">flags</a>,</div>
<div class="line"><a name="l02756"></a><span class="lineno"> 2756</span>&#160;                    use_ded_mem ? &amp;ded_alloc : (<span class="keywordtype">void</span> *)ded_alloc.pNext,</div>
<div class="line"><a name="l02757"></a><span class="lineno"> 2757</span>&#160;                    &amp;vkbuf-&gt;<a class="code" href="struct_image_buffer.html#a3a7d8a5633569cbb8fb3e794d015de14">flags</a>, &amp;vkbuf-&gt;<a class="code" href="struct_image_buffer.html#abd90eaa49258fc976bf1270c1ef7d87e">mem</a>);</div>
<div class="line"><a name="l02758"></a><span class="lineno"> 2758</span>&#160;    <span class="keywordflow">if</span> (err)</div>
<div class="line"><a name="l02759"></a><span class="lineno"> 2759</span>&#160;        <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l02760"></a><span class="lineno"> 2760</span>&#160; </div>
<div class="line"><a name="l02761"></a><span class="lineno"> 2761</span>&#160;    <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = vkBindBufferMemory(hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a53a07d4474261e4e14ec03c5d15f71da">act_dev</a>, vkbuf-&gt;<a class="code" href="struct_image_buffer.html#a299da0e5749c00f1f2d00c4f28e4e279">buf</a>, vkbuf-&gt;<a class="code" href="struct_image_buffer.html#abd90eaa49258fc976bf1270c1ef7d87e">mem</a>, 0);</div>
<div class="line"><a name="l02762"></a><span class="lineno"> 2762</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> != VK_SUCCESS) {</div>
<div class="line"><a name="l02763"></a><span class="lineno"> 2763</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to bind memory to buffer: %s\n&quot;</span>,</div>
<div class="line"><a name="l02764"></a><span class="lineno"> 2764</span>&#160;               <a class="code" href="hwcontext__vulkan_8c.html#ab4395598042453295899a91b26ad013b">vk_ret2str</a>(<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>));</div>
<div class="line"><a name="l02765"></a><span class="lineno"> 2765</span>&#160;        <a class="code" href="hwcontext__vulkan_8c.html#a2014da36c681525c5f5565596bdb4ad3">free_buf</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, (<a class="code" href="audio__convert_8c.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> *)vkbuf);</div>
<div class="line"><a name="l02766"></a><span class="lineno"> 2766</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="group__lavu__error.html#ga9c520e483ba8648495620ffdb4c491f2">AVERROR_EXTERNAL</a>;</div>
<div class="line"><a name="l02767"></a><span class="lineno"> 2767</span>&#160;    }</div>
<div class="line"><a name="l02768"></a><span class="lineno"> 2768</span>&#160; </div>
<div class="line"><a name="l02769"></a><span class="lineno"> 2769</span>&#160;    *buf = <a class="code" href="group__lavu__buffer.html#ga3e7f4c92db85ccba0b2a16dd0069842a">av_buffer_create</a>((<a class="code" href="audio__convert_8c.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> *)vkbuf, <span class="keyword">sizeof</span>(*vkbuf), <a class="code" href="hwcontext__vulkan_8c.html#a2014da36c681525c5f5565596bdb4ad3">free_buf</a>, <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, 0);</div>
<div class="line"><a name="l02770"></a><span class="lineno"> 2770</span>&#160;    <span class="keywordflow">if</span> (!(*buf)) {</div>
<div class="line"><a name="l02771"></a><span class="lineno"> 2771</span>&#160;        <a class="code" href="hwcontext__vulkan_8c.html#a2014da36c681525c5f5565596bdb4ad3">free_buf</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, (<a class="code" href="audio__convert_8c.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> *)vkbuf);</div>
<div class="line"><a name="l02772"></a><span class="lineno"> 2772</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l02773"></a><span class="lineno"> 2773</span>&#160;    }</div>
<div class="line"><a name="l02774"></a><span class="lineno"> 2774</span>&#160; </div>
<div class="line"><a name="l02775"></a><span class="lineno"> 2775</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l02776"></a><span class="lineno"> 2776</span>&#160;}</div>
<div class="line"><a name="l02777"></a><span class="lineno"> 2777</span>&#160; </div>
<div class="line"><a name="l02778"></a><span class="lineno"> 2778</span>&#160;<span class="comment">/* Skips mapping of host mapped buffers but still invalidates them */</span></div>
<div class="line"><a name="l02779"></a><span class="lineno"><a class="line" href="hwcontext__vulkan_8c.html#a9c616d5ef6c9cc6fd7d7fe30c4c13aaa"> 2779</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="hwcontext__vulkan_8c.html#a9c616d5ef6c9cc6fd7d7fe30c4c13aaa">map_buffers</a>(<a class="code" href="struct_a_v_h_w_device_context.html">AVHWDeviceContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, <a class="code" href="struct_a_v_buffer_ref.html">AVBufferRef</a> **bufs, <a class="code" href="audio__convert_8c.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> *mem[],</div>
<div class="line"><a name="l02780"></a><span class="lineno"> 2780</span>&#160;                       <span class="keywordtype">int</span> nb_buffers, <span class="keywordtype">int</span> invalidate)</div>
<div class="line"><a name="l02781"></a><span class="lineno"> 2781</span>&#160;{</div>
<div class="line"><a name="l02782"></a><span class="lineno"> 2782</span>&#160;    VkResult <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>;</div>
<div class="line"><a name="l02783"></a><span class="lineno"> 2783</span>&#160;    <a class="code" href="struct_a_v_vulkan_device_context.html">AVVulkanDeviceContext</a> *hwctx = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;hwctx;</div>
<div class="line"><a name="l02784"></a><span class="lineno"> 2784</span>&#160;    VkMappedMemoryRange invalidate_ctx[<a class="code" href="frame_8h.html#add80189702cf0f5ea82718576fb43201">AV_NUM_DATA_POINTERS</a>];</div>
<div class="line"><a name="l02785"></a><span class="lineno"> 2785</span>&#160;    <span class="keywordtype">int</span> invalidate_count = 0;</div>
<div class="line"><a name="l02786"></a><span class="lineno"> 2786</span>&#160; </div>
<div class="line"><a name="l02787"></a><span class="lineno"> 2787</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; nb_buffers; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l02788"></a><span class="lineno"> 2788</span>&#160;        <a class="code" href="struct_image_buffer.html">ImageBuffer</a> *vkbuf = (<a class="code" href="struct_image_buffer.html">ImageBuffer</a> *)bufs[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;<a class="code" href="mxf_8c.html#a084824fc871e38157790c99ae1240842">data</a>;</div>
<div class="line"><a name="l02789"></a><span class="lineno"> 2789</span>&#160;        <span class="keywordflow">if</span> (vkbuf-&gt;<a class="code" href="struct_image_buffer.html#aeda7e486d290d8e58f429bc80ec7674a">mapped_mem</a>)</div>
<div class="line"><a name="l02790"></a><span class="lineno"> 2790</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02791"></a><span class="lineno"> 2791</span>&#160; </div>
<div class="line"><a name="l02792"></a><span class="lineno"> 2792</span>&#160;        <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = vkMapMemory(hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a53a07d4474261e4e14ec03c5d15f71da">act_dev</a>, vkbuf-&gt;<a class="code" href="struct_image_buffer.html#abd90eaa49258fc976bf1270c1ef7d87e">mem</a>, 0,</div>
<div class="line"><a name="l02793"></a><span class="lineno"> 2793</span>&#160;                          VK_WHOLE_SIZE, 0, (<span class="keywordtype">void</span> **)&amp;mem[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div>
<div class="line"><a name="l02794"></a><span class="lineno"> 2794</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> != VK_SUCCESS) {</div>
<div class="line"><a name="l02795"></a><span class="lineno"> 2795</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to map buffer memory: %s\n&quot;</span>,</div>
<div class="line"><a name="l02796"></a><span class="lineno"> 2796</span>&#160;                   <a class="code" href="hwcontext__vulkan_8c.html#ab4395598042453295899a91b26ad013b">vk_ret2str</a>(<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>));</div>
<div class="line"><a name="l02797"></a><span class="lineno"> 2797</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="group__lavu__error.html#ga9c520e483ba8648495620ffdb4c491f2">AVERROR_EXTERNAL</a>;</div>
<div class="line"><a name="l02798"></a><span class="lineno"> 2798</span>&#160;        }</div>
<div class="line"><a name="l02799"></a><span class="lineno"> 2799</span>&#160;    }</div>
<div class="line"><a name="l02800"></a><span class="lineno"> 2800</span>&#160; </div>
<div class="line"><a name="l02801"></a><span class="lineno"> 2801</span>&#160;    <span class="keywordflow">if</span> (!invalidate)</div>
<div class="line"><a name="l02802"></a><span class="lineno"> 2802</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l02803"></a><span class="lineno"> 2803</span>&#160; </div>
<div class="line"><a name="l02804"></a><span class="lineno"> 2804</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; nb_buffers; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l02805"></a><span class="lineno"> 2805</span>&#160;        <a class="code" href="struct_image_buffer.html">ImageBuffer</a> *vkbuf = (<a class="code" href="struct_image_buffer.html">ImageBuffer</a> *)bufs[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;<a class="code" href="mxf_8c.html#a084824fc871e38157790c99ae1240842">data</a>;</div>
<div class="line"><a name="l02806"></a><span class="lineno"> 2806</span>&#160;        <span class="keyword">const</span> VkMappedMemoryRange ival_buf = {</div>
<div class="line"><a name="l02807"></a><span class="lineno"> 2807</span>&#160;            .sType  = VK_STRUCTURE_TYPE_MAPPED_MEMORY_RANGE,</div>
<div class="line"><a name="l02808"></a><span class="lineno"> 2808</span>&#160;            .memory = vkbuf-&gt;<a class="code" href="struct_image_buffer.html#abd90eaa49258fc976bf1270c1ef7d87e">mem</a>,</div>
<div class="line"><a name="l02809"></a><span class="lineno"> 2809</span>&#160;            .size   = VK_WHOLE_SIZE,</div>
<div class="line"><a name="l02810"></a><span class="lineno"> 2810</span>&#160;        };</div>
<div class="line"><a name="l02811"></a><span class="lineno"> 2811</span>&#160;        <span class="keywordflow">if</span> (vkbuf-&gt;<a class="code" href="struct_image_buffer.html#a3a7d8a5633569cbb8fb3e794d015de14">flags</a> &amp; VK_MEMORY_PROPERTY_HOST_COHERENT_BIT)</div>
<div class="line"><a name="l02812"></a><span class="lineno"> 2812</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02813"></a><span class="lineno"> 2813</span>&#160;        invalidate_ctx[invalidate_count++] = ival_buf;</div>
<div class="line"><a name="l02814"></a><span class="lineno"> 2814</span>&#160;    }</div>
<div class="line"><a name="l02815"></a><span class="lineno"> 2815</span>&#160; </div>
<div class="line"><a name="l02816"></a><span class="lineno"> 2816</span>&#160;    <span class="keywordflow">if</span> (invalidate_count) {</div>
<div class="line"><a name="l02817"></a><span class="lineno"> 2817</span>&#160;        <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = vkInvalidateMappedMemoryRanges(hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a53a07d4474261e4e14ec03c5d15f71da">act_dev</a>, invalidate_count,</div>
<div class="line"><a name="l02818"></a><span class="lineno"> 2818</span>&#160;                                             invalidate_ctx);</div>
<div class="line"><a name="l02819"></a><span class="lineno"> 2819</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> != VK_SUCCESS)</div>
<div class="line"><a name="l02820"></a><span class="lineno"> 2820</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, <a class="code" href="group__lavu__log__constants.html#ga85b57516ca703cc47d9bbe5f4658c716">AV_LOG_WARNING</a>, <span class="stringliteral">&quot;Failed to invalidate memory: %s\n&quot;</span>,</div>
<div class="line"><a name="l02821"></a><span class="lineno"> 2821</span>&#160;                   <a class="code" href="hwcontext__vulkan_8c.html#ab4395598042453295899a91b26ad013b">vk_ret2str</a>(<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>));</div>
<div class="line"><a name="l02822"></a><span class="lineno"> 2822</span>&#160;    }</div>
<div class="line"><a name="l02823"></a><span class="lineno"> 2823</span>&#160; </div>
<div class="line"><a name="l02824"></a><span class="lineno"> 2824</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l02825"></a><span class="lineno"> 2825</span>&#160;}</div>
<div class="line"><a name="l02826"></a><span class="lineno"> 2826</span>&#160; </div>
<div class="line"><a name="l02827"></a><span class="lineno"><a class="line" href="hwcontext__vulkan_8c.html#a49245cfc6715426a872bd949205d6f0b"> 2827</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="hwcontext__vulkan_8c.html#a49245cfc6715426a872bd949205d6f0b">unmap_buffers</a>(<a class="code" href="struct_a_v_h_w_device_context.html">AVHWDeviceContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, <a class="code" href="struct_a_v_buffer_ref.html">AVBufferRef</a> **bufs,</div>
<div class="line"><a name="l02828"></a><span class="lineno"> 2828</span>&#160;                         <span class="keywordtype">int</span> nb_buffers, <span class="keywordtype">int</span> <a class="code" href="aacdec__template_8c.html#affa0ccbe2ef7fd24bb8c61e28d1a6631">flush</a>)</div>
<div class="line"><a name="l02829"></a><span class="lineno"> 2829</span>&#160;{</div>
<div class="line"><a name="l02830"></a><span class="lineno"> 2830</span>&#160;    <span class="keywordtype">int</span> err = 0;</div>
<div class="line"><a name="l02831"></a><span class="lineno"> 2831</span>&#160;    VkResult <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>;</div>
<div class="line"><a name="l02832"></a><span class="lineno"> 2832</span>&#160;    <a class="code" href="struct_a_v_vulkan_device_context.html">AVVulkanDeviceContext</a> *hwctx = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;hwctx;</div>
<div class="line"><a name="l02833"></a><span class="lineno"> 2833</span>&#160;    VkMappedMemoryRange flush_ctx[<a class="code" href="frame_8h.html#add80189702cf0f5ea82718576fb43201">AV_NUM_DATA_POINTERS</a>];</div>
<div class="line"><a name="l02834"></a><span class="lineno"> 2834</span>&#160;    <span class="keywordtype">int</span> flush_count = 0;</div>
<div class="line"><a name="l02835"></a><span class="lineno"> 2835</span>&#160; </div>
<div class="line"><a name="l02836"></a><span class="lineno"> 2836</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="aacdec__template_8c.html#affa0ccbe2ef7fd24bb8c61e28d1a6631">flush</a>) {</div>
<div class="line"><a name="l02837"></a><span class="lineno"> 2837</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; nb_buffers; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l02838"></a><span class="lineno"> 2838</span>&#160;            <a class="code" href="struct_image_buffer.html">ImageBuffer</a> *vkbuf = (<a class="code" href="struct_image_buffer.html">ImageBuffer</a> *)bufs[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;<a class="code" href="mxf_8c.html#a084824fc871e38157790c99ae1240842">data</a>;</div>
<div class="line"><a name="l02839"></a><span class="lineno"> 2839</span>&#160;            <span class="keyword">const</span> VkMappedMemoryRange flush_buf = {</div>
<div class="line"><a name="l02840"></a><span class="lineno"> 2840</span>&#160;                .sType  = VK_STRUCTURE_TYPE_MAPPED_MEMORY_RANGE,</div>
<div class="line"><a name="l02841"></a><span class="lineno"> 2841</span>&#160;                .memory = vkbuf-&gt;<a class="code" href="struct_image_buffer.html#abd90eaa49258fc976bf1270c1ef7d87e">mem</a>,</div>
<div class="line"><a name="l02842"></a><span class="lineno"> 2842</span>&#160;                .size   = VK_WHOLE_SIZE,</div>
<div class="line"><a name="l02843"></a><span class="lineno"> 2843</span>&#160;            };</div>
<div class="line"><a name="l02844"></a><span class="lineno"> 2844</span>&#160;            <span class="keywordflow">if</span> (vkbuf-&gt;<a class="code" href="struct_image_buffer.html#a3a7d8a5633569cbb8fb3e794d015de14">flags</a> &amp; VK_MEMORY_PROPERTY_HOST_COHERENT_BIT)</div>
<div class="line"><a name="l02845"></a><span class="lineno"> 2845</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02846"></a><span class="lineno"> 2846</span>&#160;            flush_ctx[flush_count++] = flush_buf;</div>
<div class="line"><a name="l02847"></a><span class="lineno"> 2847</span>&#160;        }</div>
<div class="line"><a name="l02848"></a><span class="lineno"> 2848</span>&#160;    }</div>
<div class="line"><a name="l02849"></a><span class="lineno"> 2849</span>&#160; </div>
<div class="line"><a name="l02850"></a><span class="lineno"> 2850</span>&#160;    <span class="keywordflow">if</span> (flush_count) {</div>
<div class="line"><a name="l02851"></a><span class="lineno"> 2851</span>&#160;        <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = vkFlushMappedMemoryRanges(hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a53a07d4474261e4e14ec03c5d15f71da">act_dev</a>, flush_count, flush_ctx);</div>
<div class="line"><a name="l02852"></a><span class="lineno"> 2852</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> != VK_SUCCESS) {</div>
<div class="line"><a name="l02853"></a><span class="lineno"> 2853</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to flush memory: %s\n&quot;</span>,</div>
<div class="line"><a name="l02854"></a><span class="lineno"> 2854</span>&#160;                    <a class="code" href="hwcontext__vulkan_8c.html#ab4395598042453295899a91b26ad013b">vk_ret2str</a>(<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>));</div>
<div class="line"><a name="l02855"></a><span class="lineno"> 2855</span>&#160;            err = <a class="code" href="group__lavu__error.html#ga9c520e483ba8648495620ffdb4c491f2">AVERROR_EXTERNAL</a>; <span class="comment">/* We still want to try to unmap them */</span></div>
<div class="line"><a name="l02856"></a><span class="lineno"> 2856</span>&#160;        }</div>
<div class="line"><a name="l02857"></a><span class="lineno"> 2857</span>&#160;    }</div>
<div class="line"><a name="l02858"></a><span class="lineno"> 2858</span>&#160; </div>
<div class="line"><a name="l02859"></a><span class="lineno"> 2859</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; nb_buffers; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l02860"></a><span class="lineno"> 2860</span>&#160;        <a class="code" href="struct_image_buffer.html">ImageBuffer</a> *vkbuf = (<a class="code" href="struct_image_buffer.html">ImageBuffer</a> *)bufs[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;<a class="code" href="mxf_8c.html#a084824fc871e38157790c99ae1240842">data</a>;</div>
<div class="line"><a name="l02861"></a><span class="lineno"> 2861</span>&#160;        <span class="keywordflow">if</span> (vkbuf-&gt;<a class="code" href="struct_image_buffer.html#aeda7e486d290d8e58f429bc80ec7674a">mapped_mem</a>)</div>
<div class="line"><a name="l02862"></a><span class="lineno"> 2862</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02863"></a><span class="lineno"> 2863</span>&#160; </div>
<div class="line"><a name="l02864"></a><span class="lineno"> 2864</span>&#160;        vkUnmapMemory(hwctx-&gt;<a class="code" href="struct_a_v_vulkan_device_context.html#a53a07d4474261e4e14ec03c5d15f71da">act_dev</a>, vkbuf-&gt;<a class="code" href="struct_image_buffer.html#abd90eaa49258fc976bf1270c1ef7d87e">mem</a>);</div>
<div class="line"><a name="l02865"></a><span class="lineno"> 2865</span>&#160;    }</div>
<div class="line"><a name="l02866"></a><span class="lineno"> 2866</span>&#160; </div>
<div class="line"><a name="l02867"></a><span class="lineno"> 2867</span>&#160;    <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l02868"></a><span class="lineno"> 2868</span>&#160;}</div>
<div class="line"><a name="l02869"></a><span class="lineno"> 2869</span>&#160; </div>
<div class="line"><a name="l02870"></a><span class="lineno"><a class="line" href="hwcontext__vulkan_8c.html#a5994e70261f372c6e8eef65bd9f30dd1"> 2870</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="hwcontext__vulkan_8c.html#a5994e70261f372c6e8eef65bd9f30dd1">transfer_image_buf</a>(<a class="code" href="struct_a_v_h_w_frames_context.html">AVHWFramesContext</a> *hwfc, <span class="keyword">const</span> <a class="code" href="struct_a_v_frame.html">AVFrame</a> *<a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a>,</div>
<div class="line"><a name="l02871"></a><span class="lineno"> 2871</span>&#160;                              <a class="code" href="struct_a_v_buffer_ref.html">AVBufferRef</a> **bufs, <span class="keyword">const</span> <span class="keywordtype">int</span> *buf_stride, <span class="keywordtype">int</span> <a class="code" href="llviddspenc_8c.html#aba9ed0487b0aa23eba534648df8384c0">w</a>,</div>
<div class="line"><a name="l02872"></a><span class="lineno"> 2872</span>&#160;                              <span class="keywordtype">int</span> <a class="code" href="vp9dsp__template_8c.html#a5e36941b3d856737e81516acd45edc50">h</a>, <span class="keyword">enum</span> <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5">AVPixelFormat</a> <a class="code" href="demuxing__decoding_8c.html#a7331e302ea7bb48e0b605a069576e135">pix_fmt</a>, <span class="keywordtype">int</span> to_buf)</div>
<div class="line"><a name="l02873"></a><span class="lineno"> 2873</span>&#160;{</div>
<div class="line"><a name="l02874"></a><span class="lineno"> 2874</span>&#160;    <span class="keywordtype">int</span> err;</div>
<div class="line"><a name="l02875"></a><span class="lineno"> 2875</span>&#160;    <a class="code" href="struct_a_v_vk_frame.html">AVVkFrame</a> *<a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a> = (<a class="code" href="struct_a_v_vk_frame.html">AVVkFrame</a> *)<a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a>-&gt;data[0];</div>
<div class="line"><a name="l02876"></a><span class="lineno"> 2876</span>&#160;    <a class="code" href="struct_vulkan_frames_priv.html">VulkanFramesPriv</a> *<a class="code" href="regdef_8h.html#ae771351dd440a8640270282362e338d0">fp</a> = hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#a69e956e8d2d73d65d015c4ed895ec642">internal</a>-&gt;<a class="code" href="struct_a_v_h_w_frames_internal.html#a503cfeb391ed69856344768fd641a489">priv</a>;</div>
<div class="line"><a name="l02877"></a><span class="lineno"> 2877</span>&#160; </div>
<div class="line"><a name="l02878"></a><span class="lineno"> 2878</span>&#160;    <span class="keywordtype">int</span> bar_num = 0;</div>
<div class="line"><a name="l02879"></a><span class="lineno"> 2879</span>&#160;    VkPipelineStageFlagBits sem_wait_dst[<a class="code" href="frame_8h.html#add80189702cf0f5ea82718576fb43201">AV_NUM_DATA_POINTERS</a>];</div>
<div class="line"><a name="l02880"></a><span class="lineno"> 2880</span>&#160; </div>
<div class="line"><a name="l02881"></a><span class="lineno"> 2881</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="llviddspenc_8c.html#a39de7029a33bc3271ae437de0a38c343">planes</a> = <a class="code" href="pixdesc_8c.html#a118df1d607abd7484f874b3d7ea8823a">av_pix_fmt_count_planes</a>(<a class="code" href="demuxing__decoding_8c.html#a7331e302ea7bb48e0b605a069576e135">pix_fmt</a>);</div>
<div class="line"><a name="l02882"></a><span class="lineno"> 2882</span>&#160;    <span class="keyword">const</span> <a class="code" href="struct_a_v_pix_fmt_descriptor.html">AVPixFmtDescriptor</a> *<a class="code" href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a> = <a class="code" href="pixdesc_8c.html#afe0c3e8aef5173de28bbdaea4298f5f0">av_pix_fmt_desc_get</a>(<a class="code" href="demuxing__decoding_8c.html#a7331e302ea7bb48e0b605a069576e135">pix_fmt</a>);</div>
<div class="line"><a name="l02883"></a><span class="lineno"> 2883</span>&#160; </div>
<div class="line"><a name="l02884"></a><span class="lineno"> 2884</span>&#160;    VkImageMemoryBarrier img_bar[<a class="code" href="frame_8h.html#add80189702cf0f5ea82718576fb43201">AV_NUM_DATA_POINTERS</a>] = { 0 };</div>
<div class="line"><a name="l02885"></a><span class="lineno"> 2885</span>&#160;    <a class="code" href="struct_vulkan_exec_ctx.html">VulkanExecCtx</a> *ectx = to_buf ? &amp;<a class="code" href="regdef_8h.html#ae771351dd440a8640270282362e338d0">fp</a>-&gt;download_ctx : &amp;<a class="code" href="regdef_8h.html#ae771351dd440a8640270282362e338d0">fp</a>-&gt;upload_ctx;</div>
<div class="line"><a name="l02886"></a><span class="lineno"> 2886</span>&#160;    VkCommandBuffer cmd_buf = <a class="code" href="hwcontext__vulkan_8c.html#a4b19998e390caea2fbdeb64a7313de9f">get_buf_exec_ctx</a>(hwfc, ectx);</div>
<div class="line"><a name="l02887"></a><span class="lineno"> 2887</span>&#160; </div>
<div class="line"><a name="l02888"></a><span class="lineno"> 2888</span>&#160;    VkSubmitInfo s_info = {</div>
<div class="line"><a name="l02889"></a><span class="lineno"> 2889</span>&#160;        .sType                = VK_STRUCTURE_TYPE_SUBMIT_INFO,</div>
<div class="line"><a name="l02890"></a><span class="lineno"> 2890</span>&#160;        .pSignalSemaphores    = <a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>-&gt;sem,</div>
<div class="line"><a name="l02891"></a><span class="lineno"> 2891</span>&#160;        .pWaitSemaphores      = <a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>-&gt;sem,</div>
<div class="line"><a name="l02892"></a><span class="lineno"> 2892</span>&#160;        .pWaitDstStageMask    = sem_wait_dst,</div>
<div class="line"><a name="l02893"></a><span class="lineno"> 2893</span>&#160;        .signalSemaphoreCount = <a class="code" href="llviddspenc_8c.html#a39de7029a33bc3271ae437de0a38c343">planes</a>,</div>
<div class="line"><a name="l02894"></a><span class="lineno"> 2894</span>&#160;        .waitSemaphoreCount   = <a class="code" href="llviddspenc_8c.html#a39de7029a33bc3271ae437de0a38c343">planes</a>,</div>
<div class="line"><a name="l02895"></a><span class="lineno"> 2895</span>&#160;    };</div>
<div class="line"><a name="l02896"></a><span class="lineno"> 2896</span>&#160; </div>
<div class="line"><a name="l02897"></a><span class="lineno"> 2897</span>&#160;    <span class="keywordflow">if</span> ((err = <a class="code" href="hwcontext__vulkan_8c.html#a0c938954f0b293626efb96e7fc161e1f">wait_start_exec_ctx</a>(hwfc, ectx)))</div>
<div class="line"><a name="l02898"></a><span class="lineno"> 2898</span>&#160;        <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l02899"></a><span class="lineno"> 2899</span>&#160; </div>
<div class="line"><a name="l02900"></a><span class="lineno"> 2900</span>&#160;    <span class="comment">/* Change the image layout to something more optimal for transfers */</span></div>
<div class="line"><a name="l02901"></a><span class="lineno"> 2901</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="llviddspenc_8c.html#a39de7029a33bc3271ae437de0a38c343">planes</a>; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l02902"></a><span class="lineno"> 2902</span>&#160;        VkImageLayout new_layout = to_buf ? VK_IMAGE_LAYOUT_TRANSFER_SRC_OPTIMAL :</div>
<div class="line"><a name="l02903"></a><span class="lineno"> 2903</span>&#160;                                            VK_IMAGE_LAYOUT_TRANSFER_DST_OPTIMAL;</div>
<div class="line"><a name="l02904"></a><span class="lineno"> 2904</span>&#160;        VkAccessFlags new_access = to_buf ? VK_ACCESS_TRANSFER_READ_BIT :</div>
<div class="line"><a name="l02905"></a><span class="lineno"> 2905</span>&#160;                                            VK_ACCESS_TRANSFER_WRITE_BIT;</div>
<div class="line"><a name="l02906"></a><span class="lineno"> 2906</span>&#160; </div>
<div class="line"><a name="l02907"></a><span class="lineno"> 2907</span>&#160;        sem_wait_dst[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>] = VK_PIPELINE_STAGE_TOP_OF_PIPE_BIT;</div>
<div class="line"><a name="l02908"></a><span class="lineno"> 2908</span>&#160; </div>
<div class="line"><a name="l02909"></a><span class="lineno"> 2909</span>&#160;        <span class="comment">/* If the layout matches and we have read access skip the barrier */</span></div>
<div class="line"><a name="l02910"></a><span class="lineno"> 2910</span>&#160;        <span class="keywordflow">if</span> ((<a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>-&gt;layout[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>] == new_layout) &amp;&amp; (<a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>-&gt;access[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>] &amp; new_access))</div>
<div class="line"><a name="l02911"></a><span class="lineno"> 2911</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02912"></a><span class="lineno"> 2912</span>&#160; </div>
<div class="line"><a name="l02913"></a><span class="lineno"> 2913</span>&#160;        img_bar[bar_num].sType = VK_STRUCTURE_TYPE_IMAGE_MEMORY_BARRIER;</div>
<div class="line"><a name="l02914"></a><span class="lineno"> 2914</span>&#160;        img_bar[bar_num].srcAccessMask = 0x0;</div>
<div class="line"><a name="l02915"></a><span class="lineno"> 2915</span>&#160;        img_bar[bar_num].dstAccessMask = new_access;</div>
<div class="line"><a name="l02916"></a><span class="lineno"> 2916</span>&#160;        img_bar[bar_num].oldLayout = <a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>-&gt;layout[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l02917"></a><span class="lineno"> 2917</span>&#160;        img_bar[bar_num].newLayout = new_layout;</div>
<div class="line"><a name="l02918"></a><span class="lineno"> 2918</span>&#160;        img_bar[bar_num].srcQueueFamilyIndex = VK_QUEUE_FAMILY_IGNORED;</div>
<div class="line"><a name="l02919"></a><span class="lineno"> 2919</span>&#160;        img_bar[bar_num].dstQueueFamilyIndex = VK_QUEUE_FAMILY_IGNORED;</div>
<div class="line"><a name="l02920"></a><span class="lineno"> 2920</span>&#160;        img_bar[bar_num].image = <a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>-&gt;img[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l02921"></a><span class="lineno"> 2921</span>&#160;        img_bar[bar_num].subresourceRange.levelCount = 1;</div>
<div class="line"><a name="l02922"></a><span class="lineno"> 2922</span>&#160;        img_bar[bar_num].subresourceRange.layerCount = 1;</div>
<div class="line"><a name="l02923"></a><span class="lineno"> 2923</span>&#160;        img_bar[bar_num].subresourceRange.aspectMask = VK_IMAGE_ASPECT_COLOR_BIT;</div>
<div class="line"><a name="l02924"></a><span class="lineno"> 2924</span>&#160; </div>
<div class="line"><a name="l02925"></a><span class="lineno"> 2925</span>&#160;        <a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>-&gt;layout[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>] = img_bar[bar_num].newLayout;</div>
<div class="line"><a name="l02926"></a><span class="lineno"> 2926</span>&#160;        <a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>-&gt;access[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>] = img_bar[bar_num].dstAccessMask;</div>
<div class="line"><a name="l02927"></a><span class="lineno"> 2927</span>&#160; </div>
<div class="line"><a name="l02928"></a><span class="lineno"> 2928</span>&#160;        bar_num++;</div>
<div class="line"><a name="l02929"></a><span class="lineno"> 2929</span>&#160;    }</div>
<div class="line"><a name="l02930"></a><span class="lineno"> 2930</span>&#160; </div>
<div class="line"><a name="l02931"></a><span class="lineno"> 2931</span>&#160;    <span class="keywordflow">if</span> (bar_num)</div>
<div class="line"><a name="l02932"></a><span class="lineno"> 2932</span>&#160;        vkCmdPipelineBarrier(cmd_buf, VK_PIPELINE_STAGE_TOP_OF_PIPE_BIT,</div>
<div class="line"><a name="l02933"></a><span class="lineno"> 2933</span>&#160;                             VK_PIPELINE_STAGE_TRANSFER_BIT, 0,</div>
<div class="line"><a name="l02934"></a><span class="lineno"> 2934</span>&#160;                             0, <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0, <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, bar_num, img_bar);</div>
<div class="line"><a name="l02935"></a><span class="lineno"> 2935</span>&#160; </div>
<div class="line"><a name="l02936"></a><span class="lineno"> 2936</span>&#160;    <span class="comment">/* Schedule a copy for each plane */</span></div>
<div class="line"><a name="l02937"></a><span class="lineno"> 2937</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="llviddspenc_8c.html#a39de7029a33bc3271ae437de0a38c343">planes</a>; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l02938"></a><span class="lineno"> 2938</span>&#160;        <a class="code" href="struct_image_buffer.html">ImageBuffer</a> *vkbuf = (<a class="code" href="struct_image_buffer.html">ImageBuffer</a> *)bufs[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;<a class="code" href="mxf_8c.html#a084824fc871e38157790c99ae1240842">data</a>;</div>
<div class="line"><a name="l02939"></a><span class="lineno"> 2939</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> p_w = <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &gt; 0 ? <a class="code" href="common_8h.html#a5d13452b0fac0d41b08ea2e49ea6eaa5">AV_CEIL_RSHIFT</a>(<a class="code" href="llviddspenc_8c.html#aba9ed0487b0aa23eba534648df8384c0">w</a>, <a class="code" href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a>-&gt;log2_chroma_w) : <a class="code" href="llviddspenc_8c.html#aba9ed0487b0aa23eba534648df8384c0">w</a>;</div>
<div class="line"><a name="l02940"></a><span class="lineno"> 2940</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> p_h = <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &gt; 0 ? <a class="code" href="common_8h.html#a5d13452b0fac0d41b08ea2e49ea6eaa5">AV_CEIL_RSHIFT</a>(<a class="code" href="vp9dsp__template_8c.html#a5e36941b3d856737e81516acd45edc50">h</a>, <a class="code" href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a>-&gt;log2_chroma_h) : <a class="code" href="vp9dsp__template_8c.html#a5e36941b3d856737e81516acd45edc50">h</a>;</div>
<div class="line"><a name="l02941"></a><span class="lineno"> 2941</span>&#160;        VkBufferImageCopy buf_reg = {</div>
<div class="line"><a name="l02942"></a><span class="lineno"> 2942</span>&#160;            .bufferOffset = 0,</div>
<div class="line"><a name="l02943"></a><span class="lineno"> 2943</span>&#160;            <span class="comment">/* Buffer stride isn&#39;t in bytes, it&#39;s in samples, the implementation</span></div>
<div class="line"><a name="l02944"></a><span class="lineno"> 2944</span>&#160;<span class="comment">             * uses the image&#39;s VkFormat to know how many bytes per sample</span></div>
<div class="line"><a name="l02945"></a><span class="lineno"> 2945</span>&#160;<span class="comment">             * the buffer has. So we have to convert by dividing. Stupid.</span></div>
<div class="line"><a name="l02946"></a><span class="lineno"> 2946</span>&#160;<span class="comment">             * Won&#39;t work with YUVA or other planar formats with alpha. */</span></div>
<div class="line"><a name="l02947"></a><span class="lineno"> 2947</span>&#160;            .bufferRowLength = buf_stride[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>] / <a class="code" href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a>-&gt;comp[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].step,</div>
<div class="line"><a name="l02948"></a><span class="lineno"> 2948</span>&#160;            .bufferImageHeight = p_h,</div>
<div class="line"><a name="l02949"></a><span class="lineno"> 2949</span>&#160;            .imageSubresource.layerCount = 1,</div>
<div class="line"><a name="l02950"></a><span class="lineno"> 2950</span>&#160;            .imageSubresource.aspectMask = VK_IMAGE_ASPECT_COLOR_BIT,</div>
<div class="line"><a name="l02951"></a><span class="lineno"> 2951</span>&#160;            .imageOffset = { 0, 0, 0, },</div>
<div class="line"><a name="l02952"></a><span class="lineno"> 2952</span>&#160;            .imageExtent = { p_w, p_h, 1, },</div>
<div class="line"><a name="l02953"></a><span class="lineno"> 2953</span>&#160;        };</div>
<div class="line"><a name="l02954"></a><span class="lineno"> 2954</span>&#160; </div>
<div class="line"><a name="l02955"></a><span class="lineno"> 2955</span>&#160;        <span class="keywordflow">if</span> (to_buf)</div>
<div class="line"><a name="l02956"></a><span class="lineno"> 2956</span>&#160;            vkCmdCopyImageToBuffer(cmd_buf, <a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>-&gt;img[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>], <a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>-&gt;layout[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>],</div>
<div class="line"><a name="l02957"></a><span class="lineno"> 2957</span>&#160;                                   vkbuf-&gt;<a class="code" href="struct_image_buffer.html#a299da0e5749c00f1f2d00c4f28e4e279">buf</a>, 1, &amp;buf_reg);</div>
<div class="line"><a name="l02958"></a><span class="lineno"> 2958</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l02959"></a><span class="lineno"> 2959</span>&#160;            vkCmdCopyBufferToImage(cmd_buf, vkbuf-&gt;<a class="code" href="struct_image_buffer.html#a299da0e5749c00f1f2d00c4f28e4e279">buf</a>, <a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>-&gt;img[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>],</div>
<div class="line"><a name="l02960"></a><span class="lineno"> 2960</span>&#160;                                   <a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>-&gt;layout[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>], 1, &amp;buf_reg);</div>
<div class="line"><a name="l02961"></a><span class="lineno"> 2961</span>&#160;    }</div>
<div class="line"><a name="l02962"></a><span class="lineno"> 2962</span>&#160; </div>
<div class="line"><a name="l02963"></a><span class="lineno"> 2963</span>&#160;    <span class="comment">/* When uploading, do this asynchronously if the source is refcounted by</span></div>
<div class="line"><a name="l02964"></a><span class="lineno"> 2964</span>&#160;<span class="comment">     * keeping the buffers as a submission dependency.</span></div>
<div class="line"><a name="l02965"></a><span class="lineno"> 2965</span>&#160;<span class="comment">     * The hwcontext is guaranteed to not be freed until all frames are freed</span></div>
<div class="line"><a name="l02966"></a><span class="lineno"> 2966</span>&#160;<span class="comment">     * in the frames_unint function.</span></div>
<div class="line"><a name="l02967"></a><span class="lineno"> 2967</span>&#160;<span class="comment">     * When downloading to buffer, do this synchronously and wait for the</span></div>
<div class="line"><a name="l02968"></a><span class="lineno"> 2968</span>&#160;<span class="comment">     * queue submission to finish executing */</span></div>
<div class="line"><a name="l02969"></a><span class="lineno"> 2969</span>&#160;    <span class="keywordflow">if</span> (!to_buf) {</div>
<div class="line"><a name="l02970"></a><span class="lineno"> 2970</span>&#160;        <span class="keywordtype">int</span> <a class="code" href="tests_2jpeg2000dwt_8c.html#a5cabdd8be5af41f675fed06498e094b7">ref</a>;</div>
<div class="line"><a name="l02971"></a><span class="lineno"> 2971</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="tests_2jpeg2000dwt_8c.html#a5cabdd8be5af41f675fed06498e094b7">ref</a> = 0; <a class="code" href="tests_2jpeg2000dwt_8c.html#a5cabdd8be5af41f675fed06498e094b7">ref</a> &lt; <a class="code" href="frame_8h.html#add80189702cf0f5ea82718576fb43201">AV_NUM_DATA_POINTERS</a>; <a class="code" href="tests_2jpeg2000dwt_8c.html#a5cabdd8be5af41f675fed06498e094b7">ref</a>++) {</div>
<div class="line"><a name="l02972"></a><span class="lineno"> 2972</span>&#160;            <span class="keywordflow">if</span> (!<a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a>-&gt;buf[<a class="code" href="tests_2jpeg2000dwt_8c.html#a5cabdd8be5af41f675fed06498e094b7">ref</a>])</div>
<div class="line"><a name="l02973"></a><span class="lineno"> 2973</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02974"></a><span class="lineno"> 2974</span>&#160;            <span class="keywordflow">if</span> ((err = <a class="code" href="hwcontext__vulkan_8c.html#ad6e72ce85a1f47714711415d1e336a04">add_buf_dep_exec_ctx</a>(hwfc, ectx, &amp;<a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a>-&gt;buf[<a class="code" href="tests_2jpeg2000dwt_8c.html#a5cabdd8be5af41f675fed06498e094b7">ref</a>], 1)))</div>
<div class="line"><a name="l02975"></a><span class="lineno"> 2975</span>&#160;                <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l02976"></a><span class="lineno"> 2976</span>&#160;        }</div>
<div class="line"><a name="l02977"></a><span class="lineno"> 2977</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="tests_2jpeg2000dwt_8c.html#a5cabdd8be5af41f675fed06498e094b7">ref</a> &amp;&amp; (err = <a class="code" href="hwcontext__vulkan_8c.html#ad6e72ce85a1f47714711415d1e336a04">add_buf_dep_exec_ctx</a>(hwfc, ectx, bufs, <a class="code" href="llviddspenc_8c.html#a39de7029a33bc3271ae437de0a38c343">planes</a>)))</div>
<div class="line"><a name="l02978"></a><span class="lineno"> 2978</span>&#160;            <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l02979"></a><span class="lineno"> 2979</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="hwcontext__vulkan_8c.html#a0040d6813ae4cb493e185f6ba869742c">submit_exec_ctx</a>(hwfc, ectx, &amp;s_info, !<a class="code" href="tests_2jpeg2000dwt_8c.html#a5cabdd8be5af41f675fed06498e094b7">ref</a>);</div>
<div class="line"><a name="l02980"></a><span class="lineno"> 2980</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02981"></a><span class="lineno"> 2981</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="hwcontext__vulkan_8c.html#a0040d6813ae4cb493e185f6ba869742c">submit_exec_ctx</a>(hwfc, ectx, &amp;s_info,    1);</div>
<div class="line"><a name="l02982"></a><span class="lineno"> 2982</span>&#160;    }</div>
<div class="line"><a name="l02983"></a><span class="lineno"> 2983</span>&#160;}</div>
<div class="line"><a name="l02984"></a><span class="lineno"> 2984</span>&#160; </div>
<div class="line"><a name="l02985"></a><span class="lineno"><a class="line" href="hwcontext__vulkan_8c.html#a93ceeb027a9c060a1790651862619fb5"> 2985</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="hwcontext__vulkan_8c.html#a93ceeb027a9c060a1790651862619fb5">vulkan_transfer_data_from_mem</a>(<a class="code" href="struct_a_v_h_w_frames_context.html">AVHWFramesContext</a> *hwfc, <a class="code" href="struct_a_v_frame.html">AVFrame</a> *dst,</div>
<div class="line"><a name="l02986"></a><span class="lineno"> 2986</span>&#160;                                         <span class="keyword">const</span> <a class="code" href="struct_a_v_frame.html">AVFrame</a> *<a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>)</div>
<div class="line"><a name="l02987"></a><span class="lineno"> 2987</span>&#160;{</div>
<div class="line"><a name="l02988"></a><span class="lineno"> 2988</span>&#160;    <span class="keywordtype">int</span> err = 0;</div>
<div class="line"><a name="l02989"></a><span class="lineno"> 2989</span>&#160;    <a class="code" href="struct_a_v_frame.html">AVFrame</a> tmp;</div>
<div class="line"><a name="l02990"></a><span class="lineno"> 2990</span>&#160;    <a class="code" href="struct_a_v_vk_frame.html">AVVkFrame</a> *<a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a> = (<a class="code" href="struct_a_v_vk_frame.html">AVVkFrame</a> *)dst-&gt;<a class="code" href="struct_a_v_frame.html#a1d0f65014a8d1bf78cec8cbed2304992">data</a>[0];</div>
<div class="line"><a name="l02991"></a><span class="lineno"> 2991</span>&#160;    <a class="code" href="struct_a_v_h_w_device_context.html">AVHWDeviceContext</a> *dev_ctx = hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#ac9a7dbd0cbfcabc0b1529cb34cf53b6d">device_ctx</a>;</div>
<div class="line"><a name="l02992"></a><span class="lineno"> 2992</span>&#160;    <a class="code" href="struct_a_v_buffer_ref.html">AVBufferRef</a> *bufs[<a class="code" href="frame_8h.html#add80189702cf0f5ea82718576fb43201">AV_NUM_DATA_POINTERS</a>] = { 0 };</div>
<div class="line"><a name="l02993"></a><span class="lineno"> 2993</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="llviddspenc_8c.html#a39de7029a33bc3271ae437de0a38c343">planes</a> = <a class="code" href="pixdesc_8c.html#a118df1d607abd7484f874b3d7ea8823a">av_pix_fmt_count_planes</a>(<a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>-&gt;format);</div>
<div class="line"><a name="l02994"></a><span class="lineno"> 2994</span>&#160;    <span class="keywordtype">int</span> log2_chroma = <a class="code" href="pixdesc_8c.html#afe0c3e8aef5173de28bbdaea4298f5f0">av_pix_fmt_desc_get</a>(<a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>-&gt;format)-&gt;<a class="code" href="struct_a_v_pix_fmt_descriptor.html#abea8ed308fe00644fc066a00018afa95">log2_chroma_h</a>;</div>
<div class="line"><a name="l02995"></a><span class="lineno"> 2995</span>&#160;    <a class="code" href="struct_vulkan_device_priv.html">VulkanDevicePriv</a> *p = hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#ac9a7dbd0cbfcabc0b1529cb34cf53b6d">device_ctx</a>-&gt;<a class="code" href="struct_a_v_h_w_device_context.html#a9c3758c73b0f29925ccb2f60b5c1a803">internal</a>-&gt;<a class="code" href="struct_a_v_h_w_device_internal.html#ae7425663cca9541964518c66974a20bf">priv</a>;</div>
<div class="line"><a name="l02996"></a><span class="lineno"> 2996</span>&#160;    <span class="keywordtype">int</span> host_mapped[<a class="code" href="frame_8h.html#add80189702cf0f5ea82718576fb43201">AV_NUM_DATA_POINTERS</a>] = { 0 };</div>
<div class="line"><a name="l02997"></a><span class="lineno"> 2997</span>&#160;    <span class="keywordtype">int</span> map_host = p-&gt;<a class="code" href="struct_vulkan_device_priv.html#a895a041d77f8253cb0842c23e54593f2">extensions</a> &amp; <a class="code" href="hwcontext__vulkan_8c.html#adfa9f1974c8c5348db6b4034e3aa7b4ea2c5db237d3d2464a020222e5a328c9df">EXT_EXTERNAL_HOST_MEMORY</a>;</div>
<div class="line"><a name="l02998"></a><span class="lineno"> 2998</span>&#160; </div>
<div class="line"><a name="l02999"></a><span class="lineno"> 2999</span>&#160;    <span class="keywordflow">if</span> ((<a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>-&gt;format != <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a0e08f8a5d0fa21c3e258816a9dcce7c3">AV_PIX_FMT_NONE</a> &amp;&amp; !<a class="code" href="hwcontext__vulkan_8c.html#ac3dce3efdada0dab3fd7fca01e374871">av_vkfmt_from_pixfmt</a>(<a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>-&gt;format))) {</div>
<div class="line"><a name="l03000"></a><span class="lineno"> 3000</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(hwfc, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Unsupported source pixel format!\n&quot;</span>);</div>
<div class="line"><a name="l03001"></a><span class="lineno"> 3001</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EINVAL);</div>
<div class="line"><a name="l03002"></a><span class="lineno"> 3002</span>&#160;    }</div>
<div class="line"><a name="l03003"></a><span class="lineno"> 3003</span>&#160; </div>
<div class="line"><a name="l03004"></a><span class="lineno"> 3004</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>-&gt;width &gt; hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#a9e6f29d0f744930cdd0e8bdff8771520">width</a> || <a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>-&gt;height &gt; hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#ae61bbe1d8645a0c573085e29f1d0a58f">height</a>)</div>
<div class="line"><a name="l03005"></a><span class="lineno"> 3005</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EINVAL);</div>
<div class="line"><a name="l03006"></a><span class="lineno"> 3006</span>&#160; </div>
<div class="line"><a name="l03007"></a><span class="lineno"> 3007</span>&#160;    <span class="comment">/* For linear, host visiable images */</span></div>
<div class="line"><a name="l03008"></a><span class="lineno"> 3008</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a>-&gt;tiling == VK_IMAGE_TILING_LINEAR &amp;&amp;</div>
<div class="line"><a name="l03009"></a><span class="lineno"> 3009</span>&#160;        <a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a>-&gt;flags &amp; VK_MEMORY_PROPERTY_HOST_VISIBLE_BIT) {</div>
<div class="line"><a name="l03010"></a><span class="lineno"> 3010</span>&#160;        <a class="code" href="struct_a_v_frame.html">AVFrame</a> *<a class="code" href="hwcontext__vdpau_8c.html#a2996cc16b36e13c9010705bad768e866">map</a> = <a class="code" href="group__lavu__frame.html#gac700017c5270c79c1e1befdeeb008b2f">av_frame_alloc</a>();</div>
<div class="line"><a name="l03011"></a><span class="lineno"> 3011</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="hwcontext__vdpau_8c.html#a2996cc16b36e13c9010705bad768e866">map</a>)</div>
<div class="line"><a name="l03012"></a><span class="lineno"> 3012</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l03013"></a><span class="lineno"> 3013</span>&#160;        <a class="code" href="hwcontext__vdpau_8c.html#a2996cc16b36e13c9010705bad768e866">map</a>-&gt;format = <a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>-&gt;format;</div>
<div class="line"><a name="l03014"></a><span class="lineno"> 3014</span>&#160; </div>
<div class="line"><a name="l03015"></a><span class="lineno"> 3015</span>&#160;        err = <a class="code" href="hwcontext__vulkan_8c.html#a213d14a16ccf5f6f6e9e5ac88824e17d">vulkan_map_frame_to_mem</a>(hwfc, <a class="code" href="hwcontext__vdpau_8c.html#a2996cc16b36e13c9010705bad768e866">map</a>, dst, <a class="code" href="group__avoptions.html#gga06fc87d81c62e9abb8790b6e5713c55bab2e22cc927a3d88fe833b50bf3d71948">AV_HWFRAME_MAP_WRITE</a>);</div>
<div class="line"><a name="l03016"></a><span class="lineno"> 3016</span>&#160;        <span class="keywordflow">if</span> (err)</div>
<div class="line"><a name="l03017"></a><span class="lineno"> 3017</span>&#160;            <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l03018"></a><span class="lineno"> 3018</span>&#160; </div>
<div class="line"><a name="l03019"></a><span class="lineno"> 3019</span>&#160;        err = <a class="code" href="group__lavu__frame.html#gaec4e92f6e1e75ffaf76e07586fb0c9ed">av_frame_copy</a>(<a class="code" href="hwcontext__vdpau_8c.html#a2996cc16b36e13c9010705bad768e866">map</a>, <a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>);</div>
<div class="line"><a name="l03020"></a><span class="lineno"> 3020</span>&#160;        <a class="code" href="group__lavu__frame.html#ga979d73f3228814aee56aeca0636e37cc">av_frame_free</a>(&amp;<a class="code" href="hwcontext__vdpau_8c.html#a2996cc16b36e13c9010705bad768e866">map</a>);</div>
<div class="line"><a name="l03021"></a><span class="lineno"> 3021</span>&#160;        <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l03022"></a><span class="lineno"> 3022</span>&#160;    }</div>
<div class="line"><a name="l03023"></a><span class="lineno"> 3023</span>&#160; </div>
<div class="line"><a name="l03024"></a><span class="lineno"> 3024</span>&#160;    <span class="comment">/* Create buffers */</span></div>
<div class="line"><a name="l03025"></a><span class="lineno"> 3025</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="llviddspenc_8c.html#a39de7029a33bc3271ae437de0a38c343">planes</a>; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l03026"></a><span class="lineno"> 3026</span>&#160;        <span class="keywordtype">int</span> <a class="code" href="vp9dsp__template_8c.html#a5e36941b3d856737e81516acd45edc50">h</a> = <a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>-&gt;height;</div>
<div class="line"><a name="l03027"></a><span class="lineno"> 3027</span>&#160;        <span class="keywordtype">int</span> p_height = <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &gt; 0 ? <a class="code" href="common_8h.html#a5d13452b0fac0d41b08ea2e49ea6eaa5">AV_CEIL_RSHIFT</a>(<a class="code" href="vp9dsp__template_8c.html#a5e36941b3d856737e81516acd45edc50">h</a>, log2_chroma) : <a class="code" href="vp9dsp__template_8c.html#a5e36941b3d856737e81516acd45edc50">h</a>;</div>
<div class="line"><a name="l03028"></a><span class="lineno"> 3028</span>&#160;        <span class="keywordtype">size_t</span> p_size = <a class="code" href="macros_8h.html#acae4ba605b3a7d535b7ac058ffe96892">FFALIGN</a>(<a class="code" href="common_8h.html#ad6d88940cfc29c13a3e51ded211fc242">FFABS</a>(<a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>-&gt;linesize[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>]) * p_height,</div>
<div class="line"><a name="l03029"></a><span class="lineno"> 3029</span>&#160;                                p-&gt;<a class="code" href="struct_vulkan_device_priv.html#a7a17ab5ea90b05229be6b998d7010327">hprops</a>.minImportedHostPointerAlignment);</div>
<div class="line"><a name="l03030"></a><span class="lineno"> 3030</span>&#160; </div>
<div class="line"><a name="l03031"></a><span class="lineno"> 3031</span>&#160;        VkImportMemoryHostPointerInfoEXT import_desc = {</div>
<div class="line"><a name="l03032"></a><span class="lineno"> 3032</span>&#160;            .sType = VK_STRUCTURE_TYPE_IMPORT_MEMORY_HOST_POINTER_INFO_EXT,</div>
<div class="line"><a name="l03033"></a><span class="lineno"> 3033</span>&#160;            .handleType = VK_EXTERNAL_MEMORY_HANDLE_TYPE_HOST_ALLOCATION_BIT_EXT,</div>
<div class="line"><a name="l03034"></a><span class="lineno"> 3034</span>&#160;            .pHostPointer = <a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>-&gt;data[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>],</div>
<div class="line"><a name="l03035"></a><span class="lineno"> 3035</span>&#160;        };</div>
<div class="line"><a name="l03036"></a><span class="lineno"> 3036</span>&#160; </div>
<div class="line"><a name="l03037"></a><span class="lineno"> 3037</span>&#160;        <span class="comment">/* We can only map images with positive stride and alignment appropriate</span></div>
<div class="line"><a name="l03038"></a><span class="lineno"> 3038</span>&#160;<span class="comment">         * for the device. */</span></div>
<div class="line"><a name="l03039"></a><span class="lineno"> 3039</span>&#160;        host_mapped[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>] = map_host &amp;&amp; <a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>-&gt;linesize[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>] &gt; 0 &amp;&amp;</div>
<div class="line"><a name="l03040"></a><span class="lineno"> 3040</span>&#160;                         !(((uintptr_t)import_desc.pHostPointer) %</div>
<div class="line"><a name="l03041"></a><span class="lineno"> 3041</span>&#160;                           p-&gt;<a class="code" href="struct_vulkan_device_priv.html#a7a17ab5ea90b05229be6b998d7010327">hprops</a>.minImportedHostPointerAlignment);</div>
<div class="line"><a name="l03042"></a><span class="lineno"> 3042</span>&#160;        p_size = host_mapped[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>] ? p_size : 0;</div>
<div class="line"><a name="l03043"></a><span class="lineno"> 3043</span>&#160; </div>
<div class="line"><a name="l03044"></a><span class="lineno"> 3044</span>&#160;        tmp.<a class="code" href="struct_a_v_frame.html#aa52bfc6605f6a3059a0c3226cc0f6567">linesize</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code" href="common_8h.html#ad6d88940cfc29c13a3e51ded211fc242">FFABS</a>(<a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>-&gt;linesize[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div>
<div class="line"><a name="l03045"></a><span class="lineno"> 3045</span>&#160;        err = <a class="code" href="hwcontext__vulkan_8c.html#a6497b212ff94fbc7983213312c97ef97">create_buf</a>(dev_ctx, &amp;bufs[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>], p_size, p_height, &amp;tmp.<a class="code" href="struct_a_v_frame.html#aa52bfc6605f6a3059a0c3226cc0f6567">linesize</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>],</div>
<div class="line"><a name="l03046"></a><span class="lineno"> 3046</span>&#160;                         VK_BUFFER_USAGE_TRANSFER_SRC_BIT,</div>
<div class="line"><a name="l03047"></a><span class="lineno"> 3047</span>&#160;                         VK_MEMORY_PROPERTY_HOST_VISIBLE_BIT, <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><a name="l03048"></a><span class="lineno"> 3048</span>&#160;                         host_mapped[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>] ? &amp;import_desc : <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><a name="l03049"></a><span class="lineno"> 3049</span>&#160;        <span class="keywordflow">if</span> (err)</div>
<div class="line"><a name="l03050"></a><span class="lineno"> 3050</span>&#160;            <span class="keywordflow">goto</span> <a class="code" href="avrndec_8c.html#a13191ba45577b1d4f9b37d64df91eb55">end</a>;</div>
<div class="line"><a name="l03051"></a><span class="lineno"> 3051</span>&#160;    }</div>
<div class="line"><a name="l03052"></a><span class="lineno"> 3052</span>&#160; </div>
<div class="line"><a name="l03053"></a><span class="lineno"> 3053</span>&#160;    <span class="comment">/* Map, copy image to buffer, unmap */</span></div>
<div class="line"><a name="l03054"></a><span class="lineno"> 3054</span>&#160;    <span class="keywordflow">if</span> ((err = <a class="code" href="hwcontext__vulkan_8c.html#a9c616d5ef6c9cc6fd7d7fe30c4c13aaa">map_buffers</a>(dev_ctx, bufs, tmp.<a class="code" href="struct_a_v_frame.html#a1d0f65014a8d1bf78cec8cbed2304992">data</a>, <a class="code" href="llviddspenc_8c.html#a39de7029a33bc3271ae437de0a38c343">planes</a>, 0)))</div>
<div class="line"><a name="l03055"></a><span class="lineno"> 3055</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="avrndec_8c.html#a13191ba45577b1d4f9b37d64df91eb55">end</a>;</div>
<div class="line"><a name="l03056"></a><span class="lineno"> 3056</span>&#160; </div>
<div class="line"><a name="l03057"></a><span class="lineno"> 3057</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="llviddspenc_8c.html#a39de7029a33bc3271ae437de0a38c343">planes</a>; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l03058"></a><span class="lineno"> 3058</span>&#160;        <span class="keywordtype">int</span> <a class="code" href="vp9dsp__template_8c.html#a5e36941b3d856737e81516acd45edc50">h</a> = <a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>-&gt;height;</div>
<div class="line"><a name="l03059"></a><span class="lineno"> 3059</span>&#160;        <span class="keywordtype">int</span> p_height = <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &gt; 0 ? <a class="code" href="common_8h.html#a5d13452b0fac0d41b08ea2e49ea6eaa5">AV_CEIL_RSHIFT</a>(<a class="code" href="vp9dsp__template_8c.html#a5e36941b3d856737e81516acd45edc50">h</a>, log2_chroma) : <a class="code" href="vp9dsp__template_8c.html#a5e36941b3d856737e81516acd45edc50">h</a>;</div>
<div class="line"><a name="l03060"></a><span class="lineno"> 3060</span>&#160; </div>
<div class="line"><a name="l03061"></a><span class="lineno"> 3061</span>&#160;        <span class="keywordflow">if</span> (host_mapped[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>])</div>
<div class="line"><a name="l03062"></a><span class="lineno"> 3062</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03063"></a><span class="lineno"> 3063</span>&#160; </div>
<div class="line"><a name="l03064"></a><span class="lineno"> 3064</span>&#160;        <a class="code" href="group__lavu__picture.html#ga735cb949320867e9c2fffcb327d0ece2">av_image_copy_plane</a>(tmp.<a class="code" href="struct_a_v_frame.html#a1d0f65014a8d1bf78cec8cbed2304992">data</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>], tmp.<a class="code" href="struct_a_v_frame.html#aa52bfc6605f6a3059a0c3226cc0f6567">linesize</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>],</div>
<div class="line"><a name="l03065"></a><span class="lineno"> 3065</span>&#160;                            (<span class="keyword">const</span> <a class="code" href="audio__convert_8c.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> *)<a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>-&gt;data[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>], <a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>-&gt;linesize[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>],</div>
<div class="line"><a name="l03066"></a><span class="lineno"> 3066</span>&#160;                            <a class="code" href="common_8h.html#a0f84cbd7fd810cd678157c98cbfad4b0">FFMIN</a>(tmp.<a class="code" href="struct_a_v_frame.html#aa52bfc6605f6a3059a0c3226cc0f6567">linesize</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>], <a class="code" href="common_8h.html#ad6d88940cfc29c13a3e51ded211fc242">FFABS</a>(<a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>-&gt;linesize[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>])),</div>
<div class="line"><a name="l03067"></a><span class="lineno"> 3067</span>&#160;                            p_height);</div>
<div class="line"><a name="l03068"></a><span class="lineno"> 3068</span>&#160;    }</div>
<div class="line"><a name="l03069"></a><span class="lineno"> 3069</span>&#160; </div>
<div class="line"><a name="l03070"></a><span class="lineno"> 3070</span>&#160;    <span class="keywordflow">if</span> ((err = <a class="code" href="hwcontext__vulkan_8c.html#a49245cfc6715426a872bd949205d6f0b">unmap_buffers</a>(dev_ctx, bufs, <a class="code" href="llviddspenc_8c.html#a39de7029a33bc3271ae437de0a38c343">planes</a>, 1)))</div>
<div class="line"><a name="l03071"></a><span class="lineno"> 3071</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="avrndec_8c.html#a13191ba45577b1d4f9b37d64df91eb55">end</a>;</div>
<div class="line"><a name="l03072"></a><span class="lineno"> 3072</span>&#160; </div>
<div class="line"><a name="l03073"></a><span class="lineno"> 3073</span>&#160;    <span class="comment">/* Copy buffers to image */</span></div>
<div class="line"><a name="l03074"></a><span class="lineno"> 3074</span>&#160;    err = <a class="code" href="hwcontext__vulkan_8c.html#a5994e70261f372c6e8eef65bd9f30dd1">transfer_image_buf</a>(hwfc, dst, bufs, tmp.<a class="code" href="struct_a_v_frame.html#aa52bfc6605f6a3059a0c3226cc0f6567">linesize</a>,</div>
<div class="line"><a name="l03075"></a><span class="lineno"> 3075</span>&#160;                             <a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>-&gt;width, <a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>-&gt;height, <a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>-&gt;format, 0);</div>
<div class="line"><a name="l03076"></a><span class="lineno"> 3076</span>&#160; </div>
<div class="line"><a name="l03077"></a><span class="lineno"> 3077</span>&#160;<a class="code" href="avrndec_8c.html#a13191ba45577b1d4f9b37d64df91eb55">end</a>:</div>
<div class="line"><a name="l03078"></a><span class="lineno"> 3078</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="llviddspenc_8c.html#a39de7029a33bc3271ae437de0a38c343">planes</a>; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l03079"></a><span class="lineno"> 3079</span>&#160;        <a class="code" href="group__lavu__buffer.html#ga135e9e929b5033bb8f68322497b2effc">av_buffer_unref</a>(&amp;bufs[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div>
<div class="line"><a name="l03080"></a><span class="lineno"> 3080</span>&#160; </div>
<div class="line"><a name="l03081"></a><span class="lineno"> 3081</span>&#160;    <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l03082"></a><span class="lineno"> 3082</span>&#160;}</div>
<div class="line"><a name="l03083"></a><span class="lineno"> 3083</span>&#160; </div>
<div class="line"><a name="l03084"></a><span class="lineno"><a class="line" href="hwcontext__vulkan_8c.html#a1d4cd53db3fa0dbbb04be3310a2ee3a1"> 3084</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="hwcontext__vulkan_8c.html#a1d4cd53db3fa0dbbb04be3310a2ee3a1">vulkan_transfer_data_to</a>(<a class="code" href="struct_a_v_h_w_frames_context.html">AVHWFramesContext</a> *hwfc, <a class="code" href="struct_a_v_frame.html">AVFrame</a> *dst,</div>
<div class="line"><a name="l03085"></a><span class="lineno"> 3085</span>&#160;                                        <span class="keyword">const</span> <a class="code" href="struct_a_v_frame.html">AVFrame</a> *<a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>)</div>
<div class="line"><a name="l03086"></a><span class="lineno"> 3086</span>&#160;{</div>
<div class="line"><a name="l03087"></a><span class="lineno"> 3087</span>&#160;    <a class="code" href="attributes_8h.html#a7ca8a3900269f92fcc7b68235dea7787">av_unused</a> <a class="code" href="struct_vulkan_device_priv.html">VulkanDevicePriv</a> *p = hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#ac9a7dbd0cbfcabc0b1529cb34cf53b6d">device_ctx</a>-&gt;<a class="code" href="struct_a_v_h_w_device_context.html#a9c3758c73b0f29925ccb2f60b5c1a803">internal</a>-&gt;<a class="code" href="struct_a_v_h_w_device_internal.html#ae7425663cca9541964518c66974a20bf">priv</a>;</div>
<div class="line"><a name="l03088"></a><span class="lineno"> 3088</span>&#160; </div>
<div class="line"><a name="l03089"></a><span class="lineno"> 3089</span>&#160;    <span class="keywordflow">switch</span> (<a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>-&gt;format) {</div>
<div class="line"><a name="l03090"></a><span class="lineno"> 3090</span>&#160;<span class="preprocessor">#if CONFIG_CUDA</span></div>
<div class="line"><a name="l03091"></a><span class="lineno"> 3091</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a5ab95e18c0c9e5335f29121418eab314">AV_PIX_FMT_CUDA</a>:</div>
<div class="line"><a name="l03092"></a><span class="lineno"> 3092</span>&#160;        <span class="keywordflow">if</span> ((p-&gt;extensions &amp; <a class="code" href="hwcontext__vulkan_8c.html#adfa9f1974c8c5348db6b4034e3aa7b4ea498c8e07b8e37d27d1ce7bc1e4e9e4f7">EXT_EXTERNAL_FD_MEMORY</a>) &amp;&amp;</div>
<div class="line"><a name="l03093"></a><span class="lineno"> 3093</span>&#160;            (p-&gt;extensions &amp; <a class="code" href="hwcontext__vulkan_8c.html#adfa9f1974c8c5348db6b4034e3aa7b4eaeeeb9df365a55ef16cfca45352cf84c4">EXT_EXTERNAL_FD_SEM</a>))</div>
<div class="line"><a name="l03094"></a><span class="lineno"> 3094</span>&#160;            <span class="keywordflow">return</span> vulkan_transfer_data_from_cuda(hwfc, dst, <a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>);</div>
<div class="line"><a name="l03095"></a><span class="lineno"> 3095</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l03096"></a><span class="lineno"> 3096</span>&#160;    <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l03097"></a><span class="lineno"> 3097</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>-&gt;hw_frames_ctx)</div>
<div class="line"><a name="l03098"></a><span class="lineno"> 3098</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOSYS);</div>
<div class="line"><a name="l03099"></a><span class="lineno"> 3099</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l03100"></a><span class="lineno"> 3100</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="hwcontext__vulkan_8c.html#a93ceeb027a9c060a1790651862619fb5">vulkan_transfer_data_from_mem</a>(hwfc, dst, <a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>);</div>
<div class="line"><a name="l03101"></a><span class="lineno"> 3101</span>&#160;    }</div>
<div class="line"><a name="l03102"></a><span class="lineno"> 3102</span>&#160;}</div>
<div class="line"><a name="l03103"></a><span class="lineno"> 3103</span>&#160; </div>
<div class="line"><a name="l03104"></a><span class="lineno"> 3104</span>&#160;<span class="preprocessor">#if CONFIG_CUDA</span></div>
<div class="line"><a name="l03105"></a><span class="lineno"> 3105</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> vulkan_transfer_data_to_cuda(<a class="code" href="struct_a_v_h_w_frames_context.html">AVHWFramesContext</a> *hwfc, <a class="code" href="struct_a_v_frame.html">AVFrame</a> *dst,</div>
<div class="line"><a name="l03106"></a><span class="lineno"> 3106</span>&#160;                                      <span class="keyword">const</span> <a class="code" href="struct_a_v_frame.html">AVFrame</a> *<a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>)</div>
<div class="line"><a name="l03107"></a><span class="lineno"> 3107</span>&#160;{</div>
<div class="line"><a name="l03108"></a><span class="lineno"> 3108</span>&#160;    <span class="keywordtype">int</span> err;</div>
<div class="line"><a name="l03109"></a><span class="lineno"> 3109</span>&#160;    VkResult <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>;</div>
<div class="line"><a name="l03110"></a><span class="lineno"> 3110</span>&#160;    CUcontext <a class="code" href="motion_8c.html#a7c1d654b7b6114d7a0abc8d351dd1bcd">dummy</a>;</div>
<div class="line"><a name="l03111"></a><span class="lineno"> 3111</span>&#160;    <a class="code" href="struct_a_v_vk_frame.html">AVVkFrame</a> *dst_f;</div>
<div class="line"><a name="l03112"></a><span class="lineno"> 3112</span>&#160;    <a class="code" href="struct_a_v_vk_frame_internal.html">AVVkFrameInternal</a> *dst_int;</div>
<div class="line"><a name="l03113"></a><span class="lineno"> 3113</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="llviddspenc_8c.html#a39de7029a33bc3271ae437de0a38c343">planes</a> = <a class="code" href="pixdesc_8c.html#a118df1d607abd7484f874b3d7ea8823a">av_pix_fmt_count_planes</a>(hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#a663a9aceca97aa7b2426c9aba6543e4a">sw_format</a>);</div>
<div class="line"><a name="l03114"></a><span class="lineno"> 3114</span>&#160;    <span class="keyword">const</span> <a class="code" href="struct_a_v_pix_fmt_descriptor.html">AVPixFmtDescriptor</a> *<a class="code" href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a> = <a class="code" href="pixdesc_8c.html#afe0c3e8aef5173de28bbdaea4298f5f0">av_pix_fmt_desc_get</a>(hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#a663a9aceca97aa7b2426c9aba6543e4a">sw_format</a>);</div>
<div class="line"><a name="l03115"></a><span class="lineno"> 3115</span>&#160; </div>
<div class="line"><a name="l03116"></a><span class="lineno"> 3116</span>&#160;    <a class="code" href="struct_a_v_h_w_frames_context.html">AVHWFramesContext</a> *cuda_fc = (<a class="code" href="struct_a_v_h_w_frames_context.html">AVHWFramesContext</a>*)dst-&gt;<a class="code" href="struct_a_v_frame.html#a29493fbfabaa21432c360a090426aa8e">hw_frames_ctx</a>-&gt;<a class="code" href="struct_a_v_buffer_ref.html#acb8452e99cd75074b93800b532c6ea4b">data</a>;</div>
<div class="line"><a name="l03117"></a><span class="lineno"> 3117</span>&#160;    <a class="code" href="struct_a_v_h_w_device_context.html">AVHWDeviceContext</a> *cuda_cu = cuda_fc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#ac9a7dbd0cbfcabc0b1529cb34cf53b6d">device_ctx</a>;</div>
<div class="line"><a name="l03118"></a><span class="lineno"> 3118</span>&#160;    <a class="code" href="struct_a_v_c_u_d_a_device_context.html">AVCUDADeviceContext</a> *cuda_dev = cuda_cu-&gt;hwctx;</div>
<div class="line"><a name="l03119"></a><span class="lineno"> 3119</span>&#160;    <a class="code" href="struct_a_v_c_u_d_a_device_context_internal.html">AVCUDADeviceContextInternal</a> *cu_internal = cuda_dev-&gt;internal;</div>
<div class="line"><a name="l03120"></a><span class="lineno"> 3120</span>&#160;    CudaFunctions *cu = cu_internal-&gt;<a class="code" href="struct_a_v_c_u_d_a_device_context_internal.html#a73041ed3506f9ce333218b4728b5d737">cuda_dl</a>;</div>
<div class="line"><a name="l03121"></a><span class="lineno"> 3121</span>&#160; </div>
<div class="line"><a name="l03122"></a><span class="lineno"> 3122</span>&#160;    <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = <a class="code" href="cuviddec_8c.html#aabb147a1f2a98d37cb3ce0dd6d50b78d">CHECK_CU</a>(cu-&gt;cuCtxPushCurrent(cuda_dev-&gt;cuda_ctx));</div>
<div class="line"><a name="l03123"></a><span class="lineno"> 3123</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> &lt; 0) {</div>
<div class="line"><a name="l03124"></a><span class="lineno"> 3124</span>&#160;        err = <a class="code" href="group__lavu__error.html#ga9c520e483ba8648495620ffdb4c491f2">AVERROR_EXTERNAL</a>;</div>
<div class="line"><a name="l03125"></a><span class="lineno"> 3125</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l03126"></a><span class="lineno"> 3126</span>&#160;    }</div>
<div class="line"><a name="l03127"></a><span class="lineno"> 3127</span>&#160; </div>
<div class="line"><a name="l03128"></a><span class="lineno"> 3128</span>&#160;    dst_f = (<a class="code" href="struct_a_v_vk_frame.html">AVVkFrame</a> *)<a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>-&gt;data[0];</div>
<div class="line"><a name="l03129"></a><span class="lineno"> 3129</span>&#160; </div>
<div class="line"><a name="l03130"></a><span class="lineno"> 3130</span>&#160;    err = vulkan_export_to_cuda(hwfc, dst-&gt;<a class="code" href="struct_a_v_frame.html#a29493fbfabaa21432c360a090426aa8e">hw_frames_ctx</a>, <a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>);</div>
<div class="line"><a name="l03131"></a><span class="lineno"> 3131</span>&#160;    <span class="keywordflow">if</span> (err &lt; 0) {</div>
<div class="line"><a name="l03132"></a><span class="lineno"> 3132</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l03133"></a><span class="lineno"> 3133</span>&#160;    }</div>
<div class="line"><a name="l03134"></a><span class="lineno"> 3134</span>&#160; </div>
<div class="line"><a name="l03135"></a><span class="lineno"> 3135</span>&#160;    dst_int = dst_f-&gt;<a class="code" href="struct_a_v_vk_frame.html#a9f76026dce756dc1134df7771829a5c3">internal</a>;</div>
<div class="line"><a name="l03136"></a><span class="lineno"> 3136</span>&#160; </div>
<div class="line"><a name="l03137"></a><span class="lineno"> 3137</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="llviddspenc_8c.html#a39de7029a33bc3271ae437de0a38c343">planes</a>; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l03138"></a><span class="lineno"> 3138</span>&#160;        CUDA_MEMCPY2D cpy = {</div>
<div class="line"><a name="l03139"></a><span class="lineno"> 3139</span>&#160;            .dstMemoryType = CU_MEMORYTYPE_DEVICE,</div>
<div class="line"><a name="l03140"></a><span class="lineno"> 3140</span>&#160;            .dstDevice     = (CUdeviceptr)dst-&gt;<a class="code" href="struct_a_v_frame.html#a1d0f65014a8d1bf78cec8cbed2304992">data</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>],</div>
<div class="line"><a name="l03141"></a><span class="lineno"> 3141</span>&#160;            .dstPitch      = dst-&gt;<a class="code" href="struct_a_v_frame.html#aa52bfc6605f6a3059a0c3226cc0f6567">linesize</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>],</div>
<div class="line"><a name="l03142"></a><span class="lineno"> 3142</span>&#160;            .dstY          = 0,</div>
<div class="line"><a name="l03143"></a><span class="lineno"> 3143</span>&#160; </div>
<div class="line"><a name="l03144"></a><span class="lineno"> 3144</span>&#160;            .srcMemoryType = CU_MEMORYTYPE_ARRAY,</div>
<div class="line"><a name="l03145"></a><span class="lineno"> 3145</span>&#160;            .srcArray      = dst_int-&gt;cu_array[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>],</div>
<div class="line"><a name="l03146"></a><span class="lineno"> 3146</span>&#160;            .WidthInBytes  = (<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &gt; 0 ? <a class="code" href="common_8h.html#a5d13452b0fac0d41b08ea2e49ea6eaa5">AV_CEIL_RSHIFT</a>(hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#a9e6f29d0f744930cdd0e8bdff8771520">width</a>, <a class="code" href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a>-&gt;log2_chroma_w)</div>
<div class="line"><a name="l03147"></a><span class="lineno"> 3147</span>&#160;                                    : hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#a9e6f29d0f744930cdd0e8bdff8771520">width</a>) * <a class="code" href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a>-&gt;comp[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].step,</div>
<div class="line"><a name="l03148"></a><span class="lineno"> 3148</span>&#160;            .Height        = <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &gt; 0 ? <a class="code" href="common_8h.html#a5d13452b0fac0d41b08ea2e49ea6eaa5">AV_CEIL_RSHIFT</a>(hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#ae61bbe1d8645a0c573085e29f1d0a58f">height</a>, <a class="code" href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a>-&gt;log2_chroma_h)</div>
<div class="line"><a name="l03149"></a><span class="lineno"> 3149</span>&#160;                                   : hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#ae61bbe1d8645a0c573085e29f1d0a58f">height</a>,</div>
<div class="line"><a name="l03150"></a><span class="lineno"> 3150</span>&#160;        };</div>
<div class="line"><a name="l03151"></a><span class="lineno"> 3151</span>&#160; </div>
<div class="line"><a name="l03152"></a><span class="lineno"> 3152</span>&#160;        <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = <a class="code" href="cuviddec_8c.html#aabb147a1f2a98d37cb3ce0dd6d50b78d">CHECK_CU</a>(cu-&gt;cuMemcpy2DAsync(&amp;cpy, cuda_dev-&gt;stream));</div>
<div class="line"><a name="l03153"></a><span class="lineno"> 3153</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> &lt; 0) {</div>
<div class="line"><a name="l03154"></a><span class="lineno"> 3154</span>&#160;            err = <a class="code" href="group__lavu__error.html#ga9c520e483ba8648495620ffdb4c491f2">AVERROR_EXTERNAL</a>;</div>
<div class="line"><a name="l03155"></a><span class="lineno"> 3155</span>&#160;            <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l03156"></a><span class="lineno"> 3156</span>&#160;        }</div>
<div class="line"><a name="l03157"></a><span class="lineno"> 3157</span>&#160;    }</div>
<div class="line"><a name="l03158"></a><span class="lineno"> 3158</span>&#160; </div>
<div class="line"><a name="l03159"></a><span class="lineno"> 3159</span>&#160;    <a class="code" href="cuviddec_8c.html#aabb147a1f2a98d37cb3ce0dd6d50b78d">CHECK_CU</a>(cu-&gt;cuCtxPopCurrent(&amp;<a class="code" href="motion_8c.html#a7c1d654b7b6114d7a0abc8d351dd1bcd">dummy</a>));</div>
<div class="line"><a name="l03160"></a><span class="lineno"> 3160</span>&#160; </div>
<div class="line"><a name="l03161"></a><span class="lineno"> 3161</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(hwfc, <a class="code" href="group__lavu__log__constants.html#ga9b58b28e2d429b930b69db19877f76a8">AV_LOG_VERBOSE</a>, <span class="stringliteral">&quot;Transfered Vulkan image to CUDA!\n&quot;</span>);</div>
<div class="line"><a name="l03162"></a><span class="lineno"> 3162</span>&#160; </div>
<div class="line"><a name="l03163"></a><span class="lineno"> 3163</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l03164"></a><span class="lineno"> 3164</span>&#160; </div>
<div class="line"><a name="l03165"></a><span class="lineno"> 3165</span>&#160;<a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>:</div>
<div class="line"><a name="l03166"></a><span class="lineno"> 3166</span>&#160;    <a class="code" href="cuviddec_8c.html#aabb147a1f2a98d37cb3ce0dd6d50b78d">CHECK_CU</a>(cu-&gt;cuCtxPopCurrent(&amp;<a class="code" href="motion_8c.html#a7c1d654b7b6114d7a0abc8d351dd1bcd">dummy</a>));</div>
<div class="line"><a name="l03167"></a><span class="lineno"> 3167</span>&#160;    <a class="code" href="hwcontext__vulkan_8c.html#adcb9e9e10aa62d9ffc1ff49bf8fea423">vulkan_free_internal</a>(dst_int);</div>
<div class="line"><a name="l03168"></a><span class="lineno"> 3168</span>&#160;    dst_f-&gt;<a class="code" href="struct_a_v_vk_frame.html#a9f76026dce756dc1134df7771829a5c3">internal</a> = <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l03169"></a><span class="lineno"> 3169</span>&#160;    <a class="code" href="group__lavu__buffer.html#ga135e9e929b5033bb8f68322497b2effc">av_buffer_unref</a>(&amp;dst-&gt;<a class="code" href="struct_a_v_frame.html#a4a64d05cc676bfa8e18bf22d16c8a51f">buf</a>[0]);</div>
<div class="line"><a name="l03170"></a><span class="lineno"> 3170</span>&#160;    <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l03171"></a><span class="lineno"> 3171</span>&#160;}</div>
<div class="line"><a name="l03172"></a><span class="lineno"> 3172</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l03173"></a><span class="lineno"> 3173</span>&#160; </div>
<div class="line"><a name="l03174"></a><span class="lineno"><a class="line" href="hwcontext__vulkan_8c.html#ac784a3797179e2482599f5565c8ed933"> 3174</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="hwcontext__vulkan_8c.html#ac784a3797179e2482599f5565c8ed933">vulkan_transfer_data_to_mem</a>(<a class="code" href="struct_a_v_h_w_frames_context.html">AVHWFramesContext</a> *hwfc, <a class="code" href="struct_a_v_frame.html">AVFrame</a> *dst,</div>
<div class="line"><a name="l03175"></a><span class="lineno"> 3175</span>&#160;                                       <span class="keyword">const</span> <a class="code" href="struct_a_v_frame.html">AVFrame</a> *<a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>)</div>
<div class="line"><a name="l03176"></a><span class="lineno"> 3176</span>&#160;{</div>
<div class="line"><a name="l03177"></a><span class="lineno"> 3177</span>&#160;    <span class="keywordtype">int</span> err = 0;</div>
<div class="line"><a name="l03178"></a><span class="lineno"> 3178</span>&#160;    <a class="code" href="struct_a_v_frame.html">AVFrame</a> tmp;</div>
<div class="line"><a name="l03179"></a><span class="lineno"> 3179</span>&#160;    <a class="code" href="struct_a_v_vk_frame.html">AVVkFrame</a> *<a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a> = (<a class="code" href="struct_a_v_vk_frame.html">AVVkFrame</a> *)<a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>-&gt;data[0];</div>
<div class="line"><a name="l03180"></a><span class="lineno"> 3180</span>&#160;    <a class="code" href="struct_a_v_h_w_device_context.html">AVHWDeviceContext</a> *dev_ctx = hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#ac9a7dbd0cbfcabc0b1529cb34cf53b6d">device_ctx</a>;</div>
<div class="line"><a name="l03181"></a><span class="lineno"> 3181</span>&#160;    <a class="code" href="struct_a_v_buffer_ref.html">AVBufferRef</a> *bufs[<a class="code" href="frame_8h.html#add80189702cf0f5ea82718576fb43201">AV_NUM_DATA_POINTERS</a>] = { 0 };</div>
<div class="line"><a name="l03182"></a><span class="lineno"> 3182</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="llviddspenc_8c.html#a39de7029a33bc3271ae437de0a38c343">planes</a> = <a class="code" href="pixdesc_8c.html#a118df1d607abd7484f874b3d7ea8823a">av_pix_fmt_count_planes</a>(dst-&gt;<a class="code" href="struct_a_v_frame.html#aed14fa772ce46881020fd1545c86432c">format</a>);</div>
<div class="line"><a name="l03183"></a><span class="lineno"> 3183</span>&#160;    <span class="keywordtype">int</span> log2_chroma = <a class="code" href="pixdesc_8c.html#afe0c3e8aef5173de28bbdaea4298f5f0">av_pix_fmt_desc_get</a>(dst-&gt;<a class="code" href="struct_a_v_frame.html#aed14fa772ce46881020fd1545c86432c">format</a>)-&gt;<a class="code" href="struct_a_v_pix_fmt_descriptor.html#abea8ed308fe00644fc066a00018afa95">log2_chroma_h</a>;</div>
<div class="line"><a name="l03184"></a><span class="lineno"> 3184</span>&#160;    <a class="code" href="struct_vulkan_device_priv.html">VulkanDevicePriv</a> *p = hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#ac9a7dbd0cbfcabc0b1529cb34cf53b6d">device_ctx</a>-&gt;<a class="code" href="struct_a_v_h_w_device_context.html#a9c3758c73b0f29925ccb2f60b5c1a803">internal</a>-&gt;<a class="code" href="struct_a_v_h_w_device_internal.html#ae7425663cca9541964518c66974a20bf">priv</a>;</div>
<div class="line"><a name="l03185"></a><span class="lineno"> 3185</span>&#160;    <span class="keywordtype">int</span> host_mapped[<a class="code" href="frame_8h.html#add80189702cf0f5ea82718576fb43201">AV_NUM_DATA_POINTERS</a>] = { 0 };</div>
<div class="line"><a name="l03186"></a><span class="lineno"> 3186</span>&#160;    <span class="keywordtype">int</span> map_host = p-&gt;<a class="code" href="struct_vulkan_device_priv.html#a895a041d77f8253cb0842c23e54593f2">extensions</a> &amp; <a class="code" href="hwcontext__vulkan_8c.html#adfa9f1974c8c5348db6b4034e3aa7b4ea2c5db237d3d2464a020222e5a328c9df">EXT_EXTERNAL_HOST_MEMORY</a>;</div>
<div class="line"><a name="l03187"></a><span class="lineno"> 3187</span>&#160; </div>
<div class="line"><a name="l03188"></a><span class="lineno"> 3188</span>&#160;    <span class="keywordflow">if</span> (dst-&gt;<a class="code" href="struct_a_v_frame.html#a1e71ce60cedd5f3b6811714a9f7f9e0a">width</a> &gt; hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#a9e6f29d0f744930cdd0e8bdff8771520">width</a> || dst-&gt;<a class="code" href="struct_a_v_frame.html#a3f89733f429c98ba5bc64373fb0a3f13">height</a> &gt; hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#ae61bbe1d8645a0c573085e29f1d0a58f">height</a>)</div>
<div class="line"><a name="l03189"></a><span class="lineno"> 3189</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EINVAL);</div>
<div class="line"><a name="l03190"></a><span class="lineno"> 3190</span>&#160; </div>
<div class="line"><a name="l03191"></a><span class="lineno"> 3191</span>&#160;    <span class="comment">/* For linear, host visiable images */</span></div>
<div class="line"><a name="l03192"></a><span class="lineno"> 3192</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a>-&gt;tiling == VK_IMAGE_TILING_LINEAR &amp;&amp;</div>
<div class="line"><a name="l03193"></a><span class="lineno"> 3193</span>&#160;        <a class="code" href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a>-&gt;flags &amp; VK_MEMORY_PROPERTY_HOST_VISIBLE_BIT) {</div>
<div class="line"><a name="l03194"></a><span class="lineno"> 3194</span>&#160;        <a class="code" href="struct_a_v_frame.html">AVFrame</a> *<a class="code" href="hwcontext__vdpau_8c.html#a2996cc16b36e13c9010705bad768e866">map</a> = <a class="code" href="group__lavu__frame.html#gac700017c5270c79c1e1befdeeb008b2f">av_frame_alloc</a>();</div>
<div class="line"><a name="l03195"></a><span class="lineno"> 3195</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="hwcontext__vdpau_8c.html#a2996cc16b36e13c9010705bad768e866">map</a>)</div>
<div class="line"><a name="l03196"></a><span class="lineno"> 3196</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l03197"></a><span class="lineno"> 3197</span>&#160;        <a class="code" href="hwcontext__vdpau_8c.html#a2996cc16b36e13c9010705bad768e866">map</a>-&gt;format = dst-&gt;<a class="code" href="struct_a_v_frame.html#aed14fa772ce46881020fd1545c86432c">format</a>;</div>
<div class="line"><a name="l03198"></a><span class="lineno"> 3198</span>&#160; </div>
<div class="line"><a name="l03199"></a><span class="lineno"> 3199</span>&#160;        err = <a class="code" href="hwcontext__vulkan_8c.html#a213d14a16ccf5f6f6e9e5ac88824e17d">vulkan_map_frame_to_mem</a>(hwfc, <a class="code" href="hwcontext__vdpau_8c.html#a2996cc16b36e13c9010705bad768e866">map</a>, <a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>, <a class="code" href="group__avoptions.html#gga06fc87d81c62e9abb8790b6e5713c55ba236262031fe4c5503b2611c2c8fb520b">AV_HWFRAME_MAP_READ</a>);</div>
<div class="line"><a name="l03200"></a><span class="lineno"> 3200</span>&#160;        <span class="keywordflow">if</span> (err)</div>
<div class="line"><a name="l03201"></a><span class="lineno"> 3201</span>&#160;            <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l03202"></a><span class="lineno"> 3202</span>&#160; </div>
<div class="line"><a name="l03203"></a><span class="lineno"> 3203</span>&#160;        err = <a class="code" href="group__lavu__frame.html#gaec4e92f6e1e75ffaf76e07586fb0c9ed">av_frame_copy</a>(dst, <a class="code" href="hwcontext__vdpau_8c.html#a2996cc16b36e13c9010705bad768e866">map</a>);</div>
<div class="line"><a name="l03204"></a><span class="lineno"> 3204</span>&#160;        <a class="code" href="group__lavu__frame.html#ga979d73f3228814aee56aeca0636e37cc">av_frame_free</a>(&amp;<a class="code" href="hwcontext__vdpau_8c.html#a2996cc16b36e13c9010705bad768e866">map</a>);</div>
<div class="line"><a name="l03205"></a><span class="lineno"> 3205</span>&#160;        <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l03206"></a><span class="lineno"> 3206</span>&#160;    }</div>
<div class="line"><a name="l03207"></a><span class="lineno"> 3207</span>&#160; </div>
<div class="line"><a name="l03208"></a><span class="lineno"> 3208</span>&#160;    <span class="comment">/* Create buffers */</span></div>
<div class="line"><a name="l03209"></a><span class="lineno"> 3209</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="llviddspenc_8c.html#a39de7029a33bc3271ae437de0a38c343">planes</a>; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l03210"></a><span class="lineno"> 3210</span>&#160;        <span class="keywordtype">int</span> <a class="code" href="vp9dsp__template_8c.html#a5e36941b3d856737e81516acd45edc50">h</a> = dst-&gt;<a class="code" href="struct_a_v_frame.html#a3f89733f429c98ba5bc64373fb0a3f13">height</a>;</div>
<div class="line"><a name="l03211"></a><span class="lineno"> 3211</span>&#160;        <span class="keywordtype">int</span> p_height = <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &gt; 0 ? <a class="code" href="common_8h.html#a5d13452b0fac0d41b08ea2e49ea6eaa5">AV_CEIL_RSHIFT</a>(<a class="code" href="vp9dsp__template_8c.html#a5e36941b3d856737e81516acd45edc50">h</a>, log2_chroma) : <a class="code" href="vp9dsp__template_8c.html#a5e36941b3d856737e81516acd45edc50">h</a>;</div>
<div class="line"><a name="l03212"></a><span class="lineno"> 3212</span>&#160;        <span class="keywordtype">size_t</span> p_size = <a class="code" href="macros_8h.html#acae4ba605b3a7d535b7ac058ffe96892">FFALIGN</a>(<a class="code" href="common_8h.html#ad6d88940cfc29c13a3e51ded211fc242">FFABS</a>(dst-&gt;<a class="code" href="struct_a_v_frame.html#aa52bfc6605f6a3059a0c3226cc0f6567">linesize</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>]) * p_height,</div>
<div class="line"><a name="l03213"></a><span class="lineno"> 3213</span>&#160;                                p-&gt;<a class="code" href="struct_vulkan_device_priv.html#a7a17ab5ea90b05229be6b998d7010327">hprops</a>.minImportedHostPointerAlignment);</div>
<div class="line"><a name="l03214"></a><span class="lineno"> 3214</span>&#160; </div>
<div class="line"><a name="l03215"></a><span class="lineno"> 3215</span>&#160;        VkImportMemoryHostPointerInfoEXT import_desc = {</div>
<div class="line"><a name="l03216"></a><span class="lineno"> 3216</span>&#160;            .sType = VK_STRUCTURE_TYPE_IMPORT_MEMORY_HOST_POINTER_INFO_EXT,</div>
<div class="line"><a name="l03217"></a><span class="lineno"> 3217</span>&#160;            .handleType = VK_EXTERNAL_MEMORY_HANDLE_TYPE_HOST_ALLOCATION_BIT_EXT,</div>
<div class="line"><a name="l03218"></a><span class="lineno"> 3218</span>&#160;            .pHostPointer = dst-&gt;<a class="code" href="struct_a_v_frame.html#a1d0f65014a8d1bf78cec8cbed2304992">data</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>],</div>
<div class="line"><a name="l03219"></a><span class="lineno"> 3219</span>&#160;        };</div>
<div class="line"><a name="l03220"></a><span class="lineno"> 3220</span>&#160; </div>
<div class="line"><a name="l03221"></a><span class="lineno"> 3221</span>&#160;        <span class="comment">/* We can only map images with positive stride and alignment appropriate</span></div>
<div class="line"><a name="l03222"></a><span class="lineno"> 3222</span>&#160;<span class="comment">         * for the device. */</span></div>
<div class="line"><a name="l03223"></a><span class="lineno"> 3223</span>&#160;        host_mapped[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>] = map_host &amp;&amp; dst-&gt;<a class="code" href="struct_a_v_frame.html#aa52bfc6605f6a3059a0c3226cc0f6567">linesize</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>] &gt; 0 &amp;&amp;</div>
<div class="line"><a name="l03224"></a><span class="lineno"> 3224</span>&#160;                         !(((uintptr_t)import_desc.pHostPointer) %</div>
<div class="line"><a name="l03225"></a><span class="lineno"> 3225</span>&#160;                           p-&gt;<a class="code" href="struct_vulkan_device_priv.html#a7a17ab5ea90b05229be6b998d7010327">hprops</a>.minImportedHostPointerAlignment);</div>
<div class="line"><a name="l03226"></a><span class="lineno"> 3226</span>&#160;        p_size = host_mapped[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>] ? p_size : 0;</div>
<div class="line"><a name="l03227"></a><span class="lineno"> 3227</span>&#160; </div>
<div class="line"><a name="l03228"></a><span class="lineno"> 3228</span>&#160;        tmp.<a class="code" href="struct_a_v_frame.html#aa52bfc6605f6a3059a0c3226cc0f6567">linesize</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code" href="common_8h.html#ad6d88940cfc29c13a3e51ded211fc242">FFABS</a>(dst-&gt;<a class="code" href="struct_a_v_frame.html#aa52bfc6605f6a3059a0c3226cc0f6567">linesize</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div>
<div class="line"><a name="l03229"></a><span class="lineno"> 3229</span>&#160;        err = <a class="code" href="hwcontext__vulkan_8c.html#a6497b212ff94fbc7983213312c97ef97">create_buf</a>(dev_ctx, &amp;bufs[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>], p_size, p_height,</div>
<div class="line"><a name="l03230"></a><span class="lineno"> 3230</span>&#160;                         &amp;tmp.<a class="code" href="struct_a_v_frame.html#aa52bfc6605f6a3059a0c3226cc0f6567">linesize</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>], VK_BUFFER_USAGE_TRANSFER_DST_BIT,</div>
<div class="line"><a name="l03231"></a><span class="lineno"> 3231</span>&#160;                         VK_MEMORY_PROPERTY_HOST_VISIBLE_BIT, <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><a name="l03232"></a><span class="lineno"> 3232</span>&#160;                         host_mapped[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>] ? &amp;import_desc : <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><a name="l03233"></a><span class="lineno"> 3233</span>&#160;        <span class="keywordflow">if</span> (err)</div>
<div class="line"><a name="l03234"></a><span class="lineno"> 3234</span>&#160;            <span class="keywordflow">goto</span> <a class="code" href="avrndec_8c.html#a13191ba45577b1d4f9b37d64df91eb55">end</a>;</div>
<div class="line"><a name="l03235"></a><span class="lineno"> 3235</span>&#160;    }</div>
<div class="line"><a name="l03236"></a><span class="lineno"> 3236</span>&#160; </div>
<div class="line"><a name="l03237"></a><span class="lineno"> 3237</span>&#160;    <span class="comment">/* Copy image to buffer */</span></div>
<div class="line"><a name="l03238"></a><span class="lineno"> 3238</span>&#160;    <span class="keywordflow">if</span> ((err = <a class="code" href="hwcontext__vulkan_8c.html#a5994e70261f372c6e8eef65bd9f30dd1">transfer_image_buf</a>(hwfc, <a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>, bufs, tmp.<a class="code" href="struct_a_v_frame.html#aa52bfc6605f6a3059a0c3226cc0f6567">linesize</a>,</div>
<div class="line"><a name="l03239"></a><span class="lineno"> 3239</span>&#160;                                  dst-&gt;<a class="code" href="struct_a_v_frame.html#a1e71ce60cedd5f3b6811714a9f7f9e0a">width</a>, dst-&gt;<a class="code" href="struct_a_v_frame.html#a3f89733f429c98ba5bc64373fb0a3f13">height</a>, dst-&gt;<a class="code" href="struct_a_v_frame.html#aed14fa772ce46881020fd1545c86432c">format</a>, 1)))</div>
<div class="line"><a name="l03240"></a><span class="lineno"> 3240</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="avrndec_8c.html#a13191ba45577b1d4f9b37d64df91eb55">end</a>;</div>
<div class="line"><a name="l03241"></a><span class="lineno"> 3241</span>&#160; </div>
<div class="line"><a name="l03242"></a><span class="lineno"> 3242</span>&#160;    <span class="comment">/* Map, copy buffer to frame, unmap */</span></div>
<div class="line"><a name="l03243"></a><span class="lineno"> 3243</span>&#160;    <span class="keywordflow">if</span> ((err = <a class="code" href="hwcontext__vulkan_8c.html#a9c616d5ef6c9cc6fd7d7fe30c4c13aaa">map_buffers</a>(dev_ctx, bufs, tmp.<a class="code" href="struct_a_v_frame.html#a1d0f65014a8d1bf78cec8cbed2304992">data</a>, <a class="code" href="llviddspenc_8c.html#a39de7029a33bc3271ae437de0a38c343">planes</a>, 1)))</div>
<div class="line"><a name="l03244"></a><span class="lineno"> 3244</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="avrndec_8c.html#a13191ba45577b1d4f9b37d64df91eb55">end</a>;</div>
<div class="line"><a name="l03245"></a><span class="lineno"> 3245</span>&#160; </div>
<div class="line"><a name="l03246"></a><span class="lineno"> 3246</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="llviddspenc_8c.html#a39de7029a33bc3271ae437de0a38c343">planes</a>; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l03247"></a><span class="lineno"> 3247</span>&#160;        <span class="keywordtype">int</span> <a class="code" href="vp9dsp__template_8c.html#a5e36941b3d856737e81516acd45edc50">h</a> = dst-&gt;<a class="code" href="struct_a_v_frame.html#a3f89733f429c98ba5bc64373fb0a3f13">height</a>;</div>
<div class="line"><a name="l03248"></a><span class="lineno"> 3248</span>&#160;        <span class="keywordtype">int</span> p_height = <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &gt; 0 ? <a class="code" href="common_8h.html#a5d13452b0fac0d41b08ea2e49ea6eaa5">AV_CEIL_RSHIFT</a>(<a class="code" href="vp9dsp__template_8c.html#a5e36941b3d856737e81516acd45edc50">h</a>, log2_chroma) : <a class="code" href="vp9dsp__template_8c.html#a5e36941b3d856737e81516acd45edc50">h</a>;</div>
<div class="line"><a name="l03249"></a><span class="lineno"> 3249</span>&#160; </div>
<div class="line"><a name="l03250"></a><span class="lineno"> 3250</span>&#160;        <span class="keywordflow">if</span> (host_mapped[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>])</div>
<div class="line"><a name="l03251"></a><span class="lineno"> 3251</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03252"></a><span class="lineno"> 3252</span>&#160; </div>
<div class="line"><a name="l03253"></a><span class="lineno"> 3253</span>&#160;        <a class="code" href="group__lavu__picture.html#ga735cb949320867e9c2fffcb327d0ece2">av_image_copy_plane</a>(dst-&gt;<a class="code" href="struct_a_v_frame.html#a1d0f65014a8d1bf78cec8cbed2304992">data</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>], dst-&gt;<a class="code" href="struct_a_v_frame.html#aa52bfc6605f6a3059a0c3226cc0f6567">linesize</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>],</div>
<div class="line"><a name="l03254"></a><span class="lineno"> 3254</span>&#160;                            (<span class="keyword">const</span> <a class="code" href="audio__convert_8c.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> *)tmp.<a class="code" href="struct_a_v_frame.html#a1d0f65014a8d1bf78cec8cbed2304992">data</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>], tmp.<a class="code" href="struct_a_v_frame.html#aa52bfc6605f6a3059a0c3226cc0f6567">linesize</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>],</div>
<div class="line"><a name="l03255"></a><span class="lineno"> 3255</span>&#160;                            <a class="code" href="common_8h.html#a0f84cbd7fd810cd678157c98cbfad4b0">FFMIN</a>(tmp.<a class="code" href="struct_a_v_frame.html#aa52bfc6605f6a3059a0c3226cc0f6567">linesize</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>], <a class="code" href="common_8h.html#ad6d88940cfc29c13a3e51ded211fc242">FFABS</a>(dst-&gt;<a class="code" href="struct_a_v_frame.html#aa52bfc6605f6a3059a0c3226cc0f6567">linesize</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>])),</div>
<div class="line"><a name="l03256"></a><span class="lineno"> 3256</span>&#160;                            p_height);</div>
<div class="line"><a name="l03257"></a><span class="lineno"> 3257</span>&#160;    }</div>
<div class="line"><a name="l03258"></a><span class="lineno"> 3258</span>&#160; </div>
<div class="line"><a name="l03259"></a><span class="lineno"> 3259</span>&#160;    err = <a class="code" href="hwcontext__vulkan_8c.html#a49245cfc6715426a872bd949205d6f0b">unmap_buffers</a>(dev_ctx, bufs, <a class="code" href="llviddspenc_8c.html#a39de7029a33bc3271ae437de0a38c343">planes</a>, 0);</div>
<div class="line"><a name="l03260"></a><span class="lineno"> 3260</span>&#160; </div>
<div class="line"><a name="l03261"></a><span class="lineno"> 3261</span>&#160;<a class="code" href="avrndec_8c.html#a13191ba45577b1d4f9b37d64df91eb55">end</a>:</div>
<div class="line"><a name="l03262"></a><span class="lineno"> 3262</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="llviddspenc_8c.html#a39de7029a33bc3271ae437de0a38c343">planes</a>; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l03263"></a><span class="lineno"> 3263</span>&#160;        <a class="code" href="group__lavu__buffer.html#ga135e9e929b5033bb8f68322497b2effc">av_buffer_unref</a>(&amp;bufs[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div>
<div class="line"><a name="l03264"></a><span class="lineno"> 3264</span>&#160; </div>
<div class="line"><a name="l03265"></a><span class="lineno"> 3265</span>&#160;    <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l03266"></a><span class="lineno"> 3266</span>&#160;}</div>
<div class="line"><a name="l03267"></a><span class="lineno"> 3267</span>&#160; </div>
<div class="line"><a name="l03268"></a><span class="lineno"><a class="line" href="hwcontext__vulkan_8c.html#a8c3202d491f72174172940930dde68e6"> 3268</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="hwcontext__vulkan_8c.html#a8c3202d491f72174172940930dde68e6">vulkan_transfer_data_from</a>(<a class="code" href="struct_a_v_h_w_frames_context.html">AVHWFramesContext</a> *hwfc, <a class="code" href="struct_a_v_frame.html">AVFrame</a> *dst,</div>
<div class="line"><a name="l03269"></a><span class="lineno"> 3269</span>&#160;                                     <span class="keyword">const</span> <a class="code" href="struct_a_v_frame.html">AVFrame</a> *<a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>)</div>
<div class="line"><a name="l03270"></a><span class="lineno"> 3270</span>&#160;{</div>
<div class="line"><a name="l03271"></a><span class="lineno"> 3271</span>&#160;    <a class="code" href="attributes_8h.html#a7ca8a3900269f92fcc7b68235dea7787">av_unused</a> <a class="code" href="struct_vulkan_device_priv.html">VulkanDevicePriv</a> *p = hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#ac9a7dbd0cbfcabc0b1529cb34cf53b6d">device_ctx</a>-&gt;<a class="code" href="struct_a_v_h_w_device_context.html#a9c3758c73b0f29925ccb2f60b5c1a803">internal</a>-&gt;<a class="code" href="struct_a_v_h_w_device_internal.html#ae7425663cca9541964518c66974a20bf">priv</a>;</div>
<div class="line"><a name="l03272"></a><span class="lineno"> 3272</span>&#160; </div>
<div class="line"><a name="l03273"></a><span class="lineno"> 3273</span>&#160;    <span class="keywordflow">switch</span> (dst-&gt;<a class="code" href="struct_a_v_frame.html#aed14fa772ce46881020fd1545c86432c">format</a>) {</div>
<div class="line"><a name="l03274"></a><span class="lineno"> 3274</span>&#160;<span class="preprocessor">#if CONFIG_CUDA</span></div>
<div class="line"><a name="l03275"></a><span class="lineno"> 3275</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a5ab95e18c0c9e5335f29121418eab314">AV_PIX_FMT_CUDA</a>:</div>
<div class="line"><a name="l03276"></a><span class="lineno"> 3276</span>&#160;        <span class="keywordflow">if</span> ((p-&gt;extensions &amp; <a class="code" href="hwcontext__vulkan_8c.html#adfa9f1974c8c5348db6b4034e3aa7b4ea498c8e07b8e37d27d1ce7bc1e4e9e4f7">EXT_EXTERNAL_FD_MEMORY</a>) &amp;&amp;</div>
<div class="line"><a name="l03277"></a><span class="lineno"> 3277</span>&#160;            (p-&gt;extensions &amp; <a class="code" href="hwcontext__vulkan_8c.html#adfa9f1974c8c5348db6b4034e3aa7b4eaeeeb9df365a55ef16cfca45352cf84c4">EXT_EXTERNAL_FD_SEM</a>))</div>
<div class="line"><a name="l03278"></a><span class="lineno"> 3278</span>&#160;            <span class="keywordflow">return</span> vulkan_transfer_data_to_cuda(hwfc, dst, <a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>);</div>
<div class="line"><a name="l03279"></a><span class="lineno"> 3279</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l03280"></a><span class="lineno"> 3280</span>&#160;    <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l03281"></a><span class="lineno"> 3281</span>&#160;        <span class="keywordflow">if</span> (dst-&gt;<a class="code" href="struct_a_v_frame.html#a29493fbfabaa21432c360a090426aa8e">hw_frames_ctx</a>)</div>
<div class="line"><a name="l03282"></a><span class="lineno"> 3282</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOSYS);</div>
<div class="line"><a name="l03283"></a><span class="lineno"> 3283</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l03284"></a><span class="lineno"> 3284</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="hwcontext__vulkan_8c.html#ac784a3797179e2482599f5565c8ed933">vulkan_transfer_data_to_mem</a>(hwfc, dst, <a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>);</div>
<div class="line"><a name="l03285"></a><span class="lineno"> 3285</span>&#160;    }</div>
<div class="line"><a name="l03286"></a><span class="lineno"> 3286</span>&#160;}</div>
<div class="line"><a name="l03287"></a><span class="lineno"> 3287</span>&#160; </div>
<div class="line"><a name="l03288"></a><span class="lineno"><a class="line" href="hwcontext__vulkan_8c.html#a826230872d28567ea311fe762d23b39e"> 3288</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="hwcontext__vulkan_8c.html#a826230872d28567ea311fe762d23b39e">vulkan_frames_derive_to</a>(<a class="code" href="struct_a_v_h_w_frames_context.html">AVHWFramesContext</a> *dst_fc,</div>
<div class="line"><a name="l03289"></a><span class="lineno"> 3289</span>&#160;                                   <a class="code" href="struct_a_v_h_w_frames_context.html">AVHWFramesContext</a> *src_fc, <span class="keywordtype">int</span> <a class="code" href="cbs__av1_8c.html#a67119bce106892b6dade1dc5aa405ac9">flags</a>)</div>
<div class="line"><a name="l03290"></a><span class="lineno"> 3290</span>&#160;{</div>
<div class="line"><a name="l03291"></a><span class="lineno"> 3291</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="hwcontext__vulkan_8c.html#a149c5f31e2b5aecf1c9fd2c2f5f159fa">vulkan_frames_init</a>(dst_fc);</div>
<div class="line"><a name="l03292"></a><span class="lineno"> 3292</span>&#160;}</div>
<div class="line"><a name="l03293"></a><span class="lineno"> 3293</span>&#160; </div>
<div class="line"><a name="l03294"></a><span class="lineno"><a class="line" href="hwcontext__vulkan_8h.html#a951b6233520dcb4be94fd7d4e58a39af"> 3294</a></span>&#160;<a class="code" href="struct_a_v_vk_frame.html">AVVkFrame</a> *<a class="code" href="hwcontext__vulkan_8c.html#a951b6233520dcb4be94fd7d4e58a39af">av_vk_frame_alloc</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l03295"></a><span class="lineno"> 3295</span>&#160;{</div>
<div class="line"><a name="l03296"></a><span class="lineno"> 3296</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="group__lavu__mem__funcs.html#gaf143ecab33a3868b57345466c39de7c1">av_mallocz</a>(<span class="keyword">sizeof</span>(<a class="code" href="struct_a_v_vk_frame.html">AVVkFrame</a>));</div>
<div class="line"><a name="l03297"></a><span class="lineno"> 3297</span>&#160;}</div>
<div class="line"><a name="l03298"></a><span class="lineno"> 3298</span>&#160; </div>
<div class="line"><a name="l03299"></a><span class="lineno"><a class="line" href="hwcontext__vulkan_8c.html#ad4fde1204eab6629ad1b0953fa815bc8"> 3299</a></span>&#160;<span class="keyword">const</span> <a class="code" href="struct_h_w_context_type.html">HWContextType</a> <a class="code" href="hwcontext__vulkan_8c.html#ad4fde1204eab6629ad1b0953fa815bc8">ff_hwcontext_type_vulkan</a> = {</div>
<div class="line"><a name="l03300"></a><span class="lineno"> 3300</span>&#160;    .<a class="code" href="struct_h_w_context_type.html#a5ddb5fc39d16ce3147a5640c8d040937">type</a>                   = <a class="code" href="hwcontext_8h.html#acf25724be4b066a51ad86aa9214b0d34a72179f31ec07ece26bfec17c57491c6e">AV_HWDEVICE_TYPE_VULKAN</a>,</div>
<div class="line"><a name="l03301"></a><span class="lineno"> 3301</span>&#160;    .name                   = <span class="stringliteral">&quot;Vulkan&quot;</span>,</div>
<div class="line"><a name="l03302"></a><span class="lineno"> 3302</span>&#160; </div>
<div class="line"><a name="l03303"></a><span class="lineno"> 3303</span>&#160;    .device_hwctx_size      = <span class="keyword">sizeof</span>(<a class="code" href="hwcontext__vulkan_8h.html#a3fad9e230c8c8482919a197598dd4752">AVVulkanDeviceContext</a>),</div>
<div class="line"><a name="l03304"></a><span class="lineno"> 3304</span>&#160;    .device_priv_size       = <span class="keyword">sizeof</span>(<a class="code" href="struct_vulkan_device_priv.html">VulkanDevicePriv</a>),</div>
<div class="line"><a name="l03305"></a><span class="lineno"> 3305</span>&#160;    .frames_hwctx_size      = <span class="keyword">sizeof</span>(<a class="code" href="hwcontext__vulkan_8h.html#a6448d0c2e54d03f629609253208b872c">AVVulkanFramesContext</a>),</div>
<div class="line"><a name="l03306"></a><span class="lineno"> 3306</span>&#160;    .frames_priv_size       = <span class="keyword">sizeof</span>(<a class="code" href="struct_vulkan_frames_priv.html">VulkanFramesPriv</a>),</div>
<div class="line"><a name="l03307"></a><span class="lineno"> 3307</span>&#160; </div>
<div class="line"><a name="l03308"></a><span class="lineno"> 3308</span>&#160;    .device_init            = &amp;<a class="code" href="hwcontext__vulkan_8c.html#a81c381d28e904d708c3ba142e7656a27">vulkan_device_init</a>,</div>
<div class="line"><a name="l03309"></a><span class="lineno"> 3309</span>&#160;    .device_create          = &amp;<a class="code" href="hwcontext__vulkan_8c.html#a8c2e24eefe7b3b9a36fb8c48b1a19f26">vulkan_device_create</a>,</div>
<div class="line"><a name="l03310"></a><span class="lineno"> 3310</span>&#160;    .device_derive          = &amp;<a class="code" href="hwcontext__vulkan_8c.html#a7b7516ac11f4ce2194aba2467268534e">vulkan_device_derive</a>,</div>
<div class="line"><a name="l03311"></a><span class="lineno"> 3311</span>&#160; </div>
<div class="line"><a name="l03312"></a><span class="lineno"> 3312</span>&#160;    .frames_get_constraints = &amp;<a class="code" href="hwcontext__vulkan_8c.html#a74b57b57031e5cfdb9e471fac48ea99b">vulkan_frames_get_constraints</a>,</div>
<div class="line"><a name="l03313"></a><span class="lineno"> 3313</span>&#160;    .frames_init            = <a class="code" href="hwcontext__vulkan_8c.html#a149c5f31e2b5aecf1c9fd2c2f5f159fa">vulkan_frames_init</a>,</div>
<div class="line"><a name="l03314"></a><span class="lineno"> 3314</span>&#160;    .frames_get_buffer      = <a class="code" href="hwcontext__vulkan_8c.html#ae5894c7eff36f0e19741dab7f14964c8">vulkan_get_buffer</a>,</div>
<div class="line"><a name="l03315"></a><span class="lineno"> 3315</span>&#160;    .frames_uninit          = <a class="code" href="hwcontext__vulkan_8c.html#ace458c3b8c27631b00e72b0c8a5609ef">vulkan_frames_uninit</a>,</div>
<div class="line"><a name="l03316"></a><span class="lineno"> 3316</span>&#160; </div>
<div class="line"><a name="l03317"></a><span class="lineno"> 3317</span>&#160;    .transfer_get_formats   = <a class="code" href="hwcontext__vulkan_8c.html#a78cecfa14fbe7d736376b5147adc68cc">vulkan_transfer_get_formats</a>,</div>
<div class="line"><a name="l03318"></a><span class="lineno"> 3318</span>&#160;    .transfer_data_to       = <a class="code" href="hwcontext__vulkan_8c.html#a1d4cd53db3fa0dbbb04be3310a2ee3a1">vulkan_transfer_data_to</a>,</div>
<div class="line"><a name="l03319"></a><span class="lineno"> 3319</span>&#160;    .transfer_data_from     = <a class="code" href="hwcontext__vulkan_8c.html#a8c3202d491f72174172940930dde68e6">vulkan_transfer_data_from</a>,</div>
<div class="line"><a name="l03320"></a><span class="lineno"> 3320</span>&#160; </div>
<div class="line"><a name="l03321"></a><span class="lineno"> 3321</span>&#160;    .map_to                 = <a class="code" href="hwcontext__vulkan_8c.html#af99e98fc6db03e4a7becac050fb248dd">vulkan_map_to</a>,</div>
<div class="line"><a name="l03322"></a><span class="lineno"> 3322</span>&#160;    .map_from               = <a class="code" href="hwcontext__vulkan_8c.html#a8d06ffcc7812858be5d3ba5d4b11c3fb">vulkan_map_from</a>,</div>
<div class="line"><a name="l03323"></a><span class="lineno"> 3323</span>&#160;    .frames_derive_to       = &amp;<a class="code" href="hwcontext__vulkan_8c.html#a826230872d28567ea311fe762d23b39e">vulkan_frames_derive_to</a>,</div>
<div class="line"><a name="l03324"></a><span class="lineno"> 3324</span>&#160; </div>
<div class="line"><a name="l03325"></a><span class="lineno"> 3325</span>&#160;    .pix_fmts = (<span class="keyword">const</span> <span class="keyword">enum</span> <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5">AVPixelFormat</a> []) {</div>
<div class="line"><a name="l03326"></a><span class="lineno"> 3326</span>&#160;        <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a0f77c711dcbc9a4acdea48b6b5bc50c7">AV_PIX_FMT_VULKAN</a>,</div>
<div class="line"><a name="l03327"></a><span class="lineno"> 3327</span>&#160;        <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a0e08f8a5d0fa21c3e258816a9dcce7c3">AV_PIX_FMT_NONE</a></div>
<div class="line"><a name="l03328"></a><span class="lineno"> 3328</span>&#160;    },</div>
<div class="line"><a name="l03329"></a><span class="lineno"> 3329</span>&#160;};</div>
</div><!-- fragment --></div><!-- contents -->
<div class="ttc" id="asignature_8h_html_a12f58149bb2cdab504621ba5b390ef64"><div class="ttname"><a href="signature_8h.html#a12f58149bb2cdab504621ba5b390ef64">formats</a></div><div class="ttdeci">formats</div><div class="ttdef"><b>Definition:</b> <a href="signature_8h_source.html#l00048">signature.h:48</a></div></div>
<div class="ttc" id="ahwcontext__vulkan_8c_html_adcb9e9e10aa62d9ffc1ff49bf8fea423"><div class="ttname"><a href="hwcontext__vulkan_8c.html#adcb9e9e10aa62d9ffc1ff49bf8fea423">vulkan_free_internal</a></div><div class="ttdeci">static void vulkan_free_internal(AVVkFrameInternal *internal)</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l01307">hwcontext_vulkan.c:1307</a></div></div>
<div class="ttc" id="ahwcontext__vulkan_8c_html_a81c381d28e904d708c3ba142e7656a27"><div class="ttname"><a href="hwcontext__vulkan_8c.html#a81c381d28e904d708c3ba142e7656a27">vulkan_device_init</a></div><div class="ttdeci">static int vulkan_device_init(AVHWDeviceContext *ctx)</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l01052">hwcontext_vulkan.c:1052</a></div></div>
<div class="ttc" id="astruct_a_v_vulkan_frames_context_html_a6bf14758921612c1aad1a5d8332200bb"><div class="ttname"><a href="struct_a_v_vulkan_frames_context.html#a6bf14758921612c1aad1a5d8332200bb">AVVulkanFramesContext::usage</a></div><div class="ttdeci">VkImageUsageFlagBits usage</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8h_source.html#l00121">hwcontext_vulkan.h:121</a></div></div>
<div class="ttc" id="ahwcontext__vulkan_8c_html_a0040d6813ae4cb493e185f6ba869742c"><div class="ttname"><a href="hwcontext__vulkan_8c.html#a0040d6813ae4cb493e185f6ba869742c">submit_exec_ctx</a></div><div class="ttdeci">static int submit_exec_ctx(AVHWFramesContext *hwfc, VulkanExecCtx *cmd, VkSubmitInfo *s_info, int synchronous)</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l00908">hwcontext_vulkan.c:908</a></div></div>
<div class="ttc" id="amace_8c_html_a08f66a6870d87afcd5dc1b60d1019692"><div class="ttname"><a href="mace_8c.html#a08f66a6870d87afcd5dc1b60d1019692">stride</a></div><div class="ttdeci">int stride</div><div class="ttdef"><b>Definition:</b> <a href="mace_8c_source.html#l00144">mace.c:144</a></div></div>
<div class="ttc" id="ahwcontext__vulkan_8c_html_adfa9f1974c8c5348db6b4034e3aa7b4eac76edadb3f30757d5ba92676482f578a"><div class="ttname"><a href="hwcontext__vulkan_8c.html#adfa9f1974c8c5348db6b4034e3aa7b4eac76edadb3f30757d5ba92676482f578a">EXT_DRM_MODIFIER_FLAGS</a></div><div class="ttdeci">@ EXT_DRM_MODIFIER_FLAGS</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l00209">hwcontext_vulkan.c:209</a></div></div>
<div class="ttc" id="astruct_image_buffer_html_abd90eaa49258fc976bf1270c1ef7d87e"><div class="ttname"><a href="struct_image_buffer.html#abd90eaa49258fc976bf1270c1ef7d87e">ImageBuffer::mem</a></div><div class="ttdeci">VkDeviceMemory mem</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l02672">hwcontext_vulkan.c:2672</a></div></div>
<div class="ttc" id="agroup__lavu__log__constants_html_ga85b57516ca703cc47d9bbe5f4658c716"><div class="ttname"><a href="group__lavu__log__constants.html#ga85b57516ca703cc47d9bbe5f4658c716">AV_LOG_WARNING</a></div><div class="ttdeci">#define AV_LOG_WARNING</div><div class="ttdef"><b>Definition:</b> <a href="log_8h_source.html#l00200">log.h:200</a></div></div>
<div class="ttc" id="apixfmt_8h_html_a9a8e335cf3be472042bc9f0cf80cd4c5a5ab95e18c0c9e5335f29121418eab314"><div class="ttname"><a href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a5ab95e18c0c9e5335f29121418eab314">AV_PIX_FMT_CUDA</a></div><div class="ttdeci">@ AV_PIX_FMT_CUDA</div><div class="ttdef"><b>Definition:</b> <a href="pixfmt_8h_source.html#l00235">pixfmt.h:235</a></div></div>
<div class="ttc" id="apixfmt_8h_html_a9a8e335cf3be472042bc9f0cf80cd4c5"><div class="ttname"><a href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5">AVPixelFormat</a></div><div class="ttdeci">AVPixelFormat</div><div class="ttdef"><b>Definition:</b> <a href="pixfmt_8h_source.html#l00064">pixfmt.h:64</a></div></div>
<div class="ttc" id="ahwcontext__vulkan_8c_html_abee363c2a4179bacdf2706a5969c949a"><div class="ttname"><a href="hwcontext__vulkan_8c.html#abee363c2a4179bacdf2706a5969c949a">GET_QUEUE_COUNT</a></div><div class="ttdeci">#define GET_QUEUE_COUNT(hwctx, graph, comp, tx)</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l00107">hwcontext_vulkan.c:107</a></div></div>
<div class="ttc" id="ahwcontext__vulkan_8c_html_a93ceeb027a9c060a1790651862619fb5"><div class="ttname"><a href="hwcontext__vulkan_8c.html#a93ceeb027a9c060a1790651862619fb5">vulkan_transfer_data_from_mem</a></div><div class="ttdeci">static int vulkan_transfer_data_from_mem(AVHWFramesContext *hwfc, AVFrame *dst, const AVFrame *src)</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l02985">hwcontext_vulkan.c:2985</a></div></div>
<div class="ttc" id="ahwcontext__vulkan_8c_html_adfa9f1974c8c5348db6b4034e3aa7b4eaeeeb9df365a55ef16cfca45352cf84c4"><div class="ttname"><a href="hwcontext__vulkan_8c.html#adfa9f1974c8c5348db6b4034e3aa7b4eaeeeb9df365a55ef16cfca45352cf84c4">EXT_EXTERNAL_FD_SEM</a></div><div class="ttdeci">@ EXT_EXTERNAL_FD_SEM</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l00211">hwcontext_vulkan.c:211</a></div></div>
<div class="ttc" id="afilter__design_8txt_html_adf2fb515710d47541f7150ecd2950e76"><div class="ttname"><a href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a></div><div class="ttdeci">Filter the word frame indicates either a video frame or a group of audio as stored in an AVFrame structure Format for each input and each output the list of supported formats For video that means pixel format For audio that means channel sample they are references to shared objects When the negotiation mechanism computes the intersection of the formats supported at each end of a all references to both lists are replaced with a reference to the intersection And when a single format is eventually chosen for a link amongst the remaining all references to the list are updated That means that if a filter requires that its input and output have the same format amongst a supported all it has to do is use a reference to the same list of formats query_formats can leave some formats unset and return AVERROR(EAGAIN) to cause the negotiation mechanism toagain later. That can be used by filters with complex requirements to use the format negotiated on one link to set the formats supported on another. Frame references ownership and permissions</div></div>
<div class="ttc" id="astruct_vulkan_device_priv_html_a753f96a767abb4f8a8b92aff3cbfb5e4"><div class="ttname"><a href="struct_vulkan_device_priv.html#a753f96a767abb4f8a8b92aff3cbfb5e4">VulkanDevicePriv::qfs</a></div><div class="ttdeci">uint32_t qfs[3]</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l00070">hwcontext_vulkan.c:70</a></div></div>
<div class="ttc" id="astruct_a_v_dictionary_html"><div class="ttname"><a href="struct_a_v_dictionary.html">AVDictionary</a></div><div class="ttdef"><b>Definition:</b> <a href="dict_8c_source.html#l00030">dict.c:30</a></div></div>
<div class="ttc" id="astruct_a_v_h_w_frames_context_html_a9e6f29d0f744930cdd0e8bdff8771520"><div class="ttname"><a href="struct_a_v_h_w_frames_context.html#a9e6f29d0f744930cdd0e8bdff8771520">AVHWFramesContext::width</a></div><div class="ttdeci">int width</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext_8h_source.html#l00229">hwcontext.h:229</a></div></div>
<div class="ttc" id="ahwcontext__vulkan_8c_html_a4a588bd57da8107f10f0a0fcf623351f"><div class="ttname"><a href="hwcontext__vulkan_8c.html#a4a588bd57da8107f10f0a0fcf623351f">VulkanQueueCtx</a></div><div class="ttdeci">struct VulkanQueueCtx VulkanQueueCtx</div></div>
<div class="ttc" id="astruct_a_v_h_w_frames_constraints_html_a34e06e3397af2b83de9d78f893bf4168"><div class="ttname"><a href="struct_a_v_h_w_frames_constraints.html#a34e06e3397af2b83de9d78f893bf4168">AVHWFramesConstraints::max_width</a></div><div class="ttdeci">int max_width</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext_8h_source.html#l00478">hwcontext.h:478</a></div></div>
<div class="ttc" id="astruct_a_v_d_r_m_frame_descriptor_html"><div class="ttname"><a href="struct_a_v_d_r_m_frame_descriptor.html">AVDRMFrameDescriptor</a></div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__drm_8h_source.html#l00133">hwcontext_drm.h:133</a></div></div>
<div class="ttc" id="astruct_a_v_vulkan_frames_context_html"><div class="ttname"><a href="struct_a_v_vulkan_frames_context.html">AVVulkanFramesContext</a></div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8h_source.html#l00112">hwcontext_vulkan.h:112</a></div></div>
<div class="ttc" id="ahwcontext__cuda__internal_8h_html"><div class="ttname"><a href="hwcontext__cuda__internal_8h.html">hwcontext_cuda_internal.h</a></div></div>
<div class="ttc" id="astruct_a_v_h_w_device_context_html_abc92603a11768828ef3aea1f9d089308"><div class="ttname"><a href="struct_a_v_h_w_device_context.html#abc92603a11768828ef3aea1f9d089308">AVHWDeviceContext::type</a></div><div class="ttdeci">enum AVHWDeviceType type</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext_8h_source.html#l00071">hwcontext.h:79</a></div></div>
<div class="ttc" id="ahwcontext__vulkan_8c_html_a1d4cd53db3fa0dbbb04be3310a2ee3a1"><div class="ttname"><a href="hwcontext__vulkan_8c.html#a1d4cd53db3fa0dbbb04be3310a2ee3a1">vulkan_transfer_data_to</a></div><div class="ttdeci">static int vulkan_transfer_data_to(AVHWFramesContext *hwfc, AVFrame *dst, const AVFrame *src)</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l03084">hwcontext_vulkan.c:3084</a></div></div>
<div class="ttc" id="adnn__backend__native__layer__mathbinary_8c_html_aec238e230db0cd41b80558db403931dd"><div class="ttname"><a href="dnn__backend__native__layer__mathbinary_8c.html#aec238e230db0cd41b80558db403931dd">sub</a></div><div class="ttdeci">static float sub(float src0, float src1)</div><div class="ttdef"><b>Definition:</b> <a href="dnn__backend__native__layer__mathbinary_8c_source.html#l00033">dnn_backend_native_layer_mathbinary.c:33</a></div></div>
<div class="ttc" id="apixdesc_8c_html_afe0c3e8aef5173de28bbdaea4298f5f0"><div class="ttname"><a href="pixdesc_8c.html#afe0c3e8aef5173de28bbdaea4298f5f0">av_pix_fmt_desc_get</a></div><div class="ttdeci">const AVPixFmtDescriptor * av_pix_fmt_desc_get(enum AVPixelFormat pix_fmt)</div><div class="ttdef"><b>Definition:</b> <a href="pixdesc_8c_source.html#l02573">pixdesc.c:2573</a></div></div>
<div class="ttc" id="amem_8c_html_a254f3455439c15a2c8a75b8f0235fdbd"><div class="ttname"><a href="mem_8c.html#a254f3455439c15a2c8a75b8f0235fdbd">av_malloc_array</a></div><div class="ttdeci">void * av_malloc_array(size_t nmemb, size_t size)</div><div class="ttdef"><b>Definition:</b> <a href="mem_8c_source.html#l00182">mem.c:182</a></div></div>
<div class="ttc" id="astruct_image_buffer_html_aeda7e486d290d8e58f429bc80ec7674a"><div class="ttname"><a href="struct_image_buffer.html#aeda7e486d290d8e58f429bc80ec7674a">ImageBuffer::mapped_mem</a></div><div class="ttdeci">int mapped_mem</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l02674">hwcontext_vulkan.c:2674</a></div></div>
<div class="ttc" id="astruct_a_v_buffer_ref_html_acb8452e99cd75074b93800b532c6ea4b"><div class="ttname"><a href="struct_a_v_buffer_ref.html#acb8452e99cd75074b93800b532c6ea4b">AVBufferRef::data</a></div><div class="ttdeci">uint8_t * data</div><div class="ttdef"><b>Definition:</b> <a href="buffer_8h_source.html#l00089">buffer.h:89</a></div></div>
<div class="ttc" id="amedian__template_8c_html_a31b077f963aa01b89165bc79dadf3af4"><div class="ttname"><a href="median__template_8c.html#a31b077f963aa01b89165bc79dadf3af4">htype</a></div><div class="ttdeci">#define htype</div><div class="ttdef"><b>Definition:</b> <a href="median__template_8c_source.html#l00037">median_template.c:37</a></div></div>
<div class="ttc" id="ahwcontext__vulkan_8c_html_a74b57b57031e5cfdb9e471fac48ea99b"><div class="ttname"><a href="hwcontext__vulkan_8c.html#a74b57b57031e5cfdb9e471fac48ea99b">vulkan_frames_get_constraints</a></div><div class="ttdeci">static int vulkan_frames_get_constraints(AVHWDeviceContext *ctx, const void *hwconfig, AVHWFramesConstraints *constraints)</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l01209">hwcontext_vulkan.c:1209</a></div></div>
<div class="ttc" id="astruct_vulkan_opt_extension_html_ac74c961b27b14719ec404146433c3651"><div class="ttname"><a href="struct_vulkan_opt_extension.html#ac74c961b27b14719ec404146433c3651">VulkanOptExtension::flag</a></div><div class="ttdeci">uint64_t flag</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l00219">hwcontext_vulkan.c:219</a></div></div>
<div class="ttc" id="aattributes_8h_html_a7ca8a3900269f92fcc7b68235dea7787"><div class="ttname"><a href="attributes_8h.html#a7ca8a3900269f92fcc7b68235dea7787">av_unused</a></div><div class="ttdeci">#define av_unused</div><div class="ttdef"><b>Definition:</b> <a href="attributes_8h_source.html#l00133">attributes.h:133</a></div></div>
<div class="ttc" id="astruct_a_v_c_u_d_a_device_context_internal_html_a5ea5820f647fa81dacff438c309810ab"><div class="ttname"><a href="struct_a_v_c_u_d_a_device_context_internal.html#a5ea5820f647fa81dacff438c309810ab">AVCUDADeviceContextInternal::cuda_device</a></div><div class="ttdeci">CUdevice cuda_device</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__cuda__internal_8h_source.html#l00034">hwcontext_cuda_internal.h:34</a></div></div>
<div class="ttc" id="ahwcontext__vulkan_8c_html_a826230872d28567ea311fe762d23b39e"><div class="ttname"><a href="hwcontext__vulkan_8c.html#a826230872d28567ea311fe762d23b39e">vulkan_frames_derive_to</a></div><div class="ttdeci">static int vulkan_frames_derive_to(AVHWFramesContext *dst_fc, AVHWFramesContext *src_fc, int flags)</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l03288">hwcontext_vulkan.c:3288</a></div></div>
<div class="ttc" id="agroup__lavu__frame_html_ga979d73f3228814aee56aeca0636e37cc"><div class="ttname"><a href="group__lavu__frame.html#ga979d73f3228814aee56aeca0636e37cc">av_frame_free</a></div><div class="ttdeci">void av_frame_free(AVFrame **frame)</div><div class="ttdef"><b>Definition:</b> <a href="frame_8c_source.html#l00203">frame.c:203</a></div></div>
<div class="ttc" id="astruct_a_v_h_w_frames_context_html_a69e956e8d2d73d65d015c4ed895ec642"><div class="ttname"><a href="struct_a_v_h_w_frames_context.html#a69e956e8d2d73d65d015c4ed895ec642">AVHWFramesContext::internal</a></div><div class="ttdeci">AVHWFramesInternal * internal</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext_8h_source.html#l00134">hwcontext.h:134</a></div></div>
<div class="ttc" id="agroup__avoptions_html_gga06fc87d81c62e9abb8790b6e5713c55bac12b0a2a379fe4b4b00353aac56ed9f4"><div class="ttname"><a href="group__avoptions.html#gga06fc87d81c62e9abb8790b6e5713c55bac12b0a2a379fe4b4b00353aac56ed9f4">AV_HWFRAME_MAP_OVERWRITE</a></div><div class="ttdeci">@ AV_HWFRAME_MAP_OVERWRITE</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext_8h_source.html#l00534">hwcontext.h:534</a></div></div>
<div class="ttc" id="aavrndec_8c_html_a13191ba45577b1d4f9b37d64df91eb55"><div class="ttname"><a href="avrndec_8c.html#a13191ba45577b1d4f9b37d64df91eb55">end</a></div><div class="ttdeci">static av_cold int end(AVCodecContext *avctx)</div><div class="ttdef"><b>Definition:</b> <a href="avrndec_8c_source.html#l00092">avrndec.c:92</a></div></div>
<div class="ttc" id="astruct_vulkan_exec_ctx_html_a2947aa835fe688e37d446fb6be093b25"><div class="ttname"><a href="struct_vulkan_exec_ctx.html#a2947aa835fe688e37d446fb6be093b25">VulkanExecCtx::nb_queues</a></div><div class="ttdeci">int nb_queues</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l00059">hwcontext_vulkan.c:59</a></div></div>
<div class="ttc" id="astruct_vulkan_device_priv_html_a69a23c1466b2c96396f30ba67410f51e"><div class="ttname"><a href="struct_vulkan_device_priv.html#a69a23c1466b2c96396f30ba67410f51e">VulkanDevicePriv::mprops</a></div><div class="ttdeci">VkPhysicalDeviceMemoryProperties mprops</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l00066">hwcontext_vulkan.c:66</a></div></div>
<div class="ttc" id="astruct_h_w_map_descriptor_html_a7ecea93e498181196f2121b85c07411d"><div class="ttname"><a href="struct_h_w_map_descriptor.html#a7ecea93e498181196f2121b85c07411d">HWMapDescriptor::priv</a></div><div class="ttdeci">void * priv</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__internal_8h_source.html#l00151">hwcontext_internal.h:151</a></div></div>
<div class="ttc" id="apixdesc_8h_html"><div class="ttname"><a href="pixdesc_8h.html">pixdesc.h</a></div></div>
<div class="ttc" id="astruct_a_v_vulkan_device_context_html_a8d68b5373defea792ad340e698d9b409"><div class="ttname"><a href="struct_a_v_vulkan_device_context.html#a8d68b5373defea792ad340e698d9b409">AVVulkanDeviceContext::enabled_inst_extensions</a></div><div class="ttdeci">const char *const  * enabled_inst_extensions</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8h_source.html#l00088">hwcontext_vulkan.h:88</a></div></div>
<div class="ttc" id="ahwcontext__vulkan_8c_html_af5612db90300a41736bc6573c96e900c"><div class="ttname"><a href="hwcontext__vulkan_8c.html#af5612db90300a41736bc6573c96e900c">optional_device_exts</a></div><div class="ttdeci">static const VulkanOptExtension optional_device_exts[]</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l00226">hwcontext_vulkan.c:226</a></div></div>
<div class="ttc" id="allviddspenc_8c_html_aba9ed0487b0aa23eba534648df8384c0"><div class="ttname"><a href="llviddspenc_8c.html#aba9ed0487b0aa23eba534648df8384c0">w</a></div><div class="ttdeci">uint8_t w</div><div class="ttdef"><b>Definition:</b> <a href="llviddspenc_8c_source.html#l00038">llviddspenc.c:38</a></div></div>
<div class="ttc" id="apixfmt_8h_html_a9a8e335cf3be472042bc9f0cf80cd4c5a76a05fccc6f58f7ab655deefd794713e"><div class="ttname"><a href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a76a05fccc6f58f7ab655deefd794713e">AV_PIX_FMT_DRM_PRIME</a></div><div class="ttdeci">@ AV_PIX_FMT_DRM_PRIME</div><div class="ttdef"><b>Definition:</b> <a href="pixfmt_8h_source.html#l00328">pixfmt.h:328</a></div></div>
<div class="ttc" id="ahwcontext__vulkan_8c_html_a7ca6de581010532102af77fb6ad4cb19"><div class="ttname"><a href="hwcontext__vulkan_8c.html#a7ca6de581010532102af77fb6ad4cb19">VulkanMapping</a></div><div class="ttdeci">struct VulkanMapping VulkanMapping</div></div>
<div class="ttc" id="astruct_a_v_c_u_d_a_device_context_html"><div class="ttname"><a href="struct_a_v_c_u_d_a_device_context.html">AVCUDADeviceContext</a></div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__cuda_8h_source.html#l00042">hwcontext_cuda.h:42</a></div></div>
<div class="ttc" id="ahwcontext__vulkan_8c_html_a7d5cec728363ce6d6720b465027585c1"><div class="ttname"><a href="hwcontext__vulkan_8c.html#a7d5cec728363ce6d6720b465027585c1">ImageBuffer</a></div><div class="ttdeci">struct ImageBuffer ImageBuffer</div></div>
<div class="ttc" id="ahwcontext_8c_html_a99e028453fba7e66483c2189439219d2"><div class="ttname"><a href="hwcontext_8c.html#a99e028453fba7e66483c2189439219d2">av_hwframe_map</a></div><div class="ttdeci">int av_hwframe_map(AVFrame *dst, const AVFrame *src, int flags)</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext_8c_source.html#l00789">hwcontext.c:789</a></div></div>
<div class="ttc" id="amxf_8c_html_a084824fc871e38157790c99ae1240842"><div class="ttname"><a href="mxf_8c.html#a084824fc871e38157790c99ae1240842">data</a></div><div class="ttdeci">const char data[16]</div><div class="ttdef"><b>Definition:</b> <a href="mxf_8c_source.html#l00151">mxf.c:151</a></div></div>
<div class="ttc" id="ainterplayacm_8c_html_a552efe53b811f3855f53f59129cf34af"><div class="ttname"><a href="interplayacm_8c.html#a552efe53b811f3855f53f59129cf34af">linear</a></div><div class="ttdeci">static int linear(InterplayACMContext *s, unsigned ind, unsigned col)</div><div class="ttdef"><b>Definition:</b> <a href="interplayacm_8c_source.html#l00121">interplayacm.c:121</a></div></div>
<div class="ttc" id="ahwcontext__vulkan_8c_html_a481ad49d98f76838642e2f30dd01b8d7"><div class="ttname"><a href="hwcontext__vulkan_8c.html#a481ad49d98f76838642e2f30dd01b8d7">try_export_flags</a></div><div class="ttdeci">static void try_export_flags(AVHWFramesContext *hwfc, VkExternalMemoryHandleTypeFlags *comp_handle_types, VkExternalMemoryHandleTypeFlagBits *iexp, VkExternalMemoryHandleTypeFlagBits exp)</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l01594">hwcontext_vulkan.c:1594</a></div></div>
<div class="ttc" id="astruct_a_v_vulkan_frames_context_html_a35850b6049c9766ce28576a7b4c52c14"><div class="ttname"><a href="struct_a_v_vulkan_frames_context.html#a35850b6049c9766ce28576a7b4c52c14">AVVulkanFramesContext::alloc_pnext</a></div><div class="ttdeci">void * alloc_pnext[AV_NUM_DATA_POINTERS]</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8h_source.html#l00133">hwcontext_vulkan.h:133</a></div></div>
<div class="ttc" id="ahwcontext__vulkan_8c_html_ad0bb1569b556eddc44f41df7c1b70937"><div class="ttname"><a href="hwcontext__vulkan_8c.html#ad0bb1569b556eddc44f41df7c1b70937">pixfmt_is_supported</a></div><div class="ttdeci">static int pixfmt_is_supported(AVVulkanDeviceContext *hwctx, enum AVPixelFormat p, int linear)</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l00183">hwcontext_vulkan.c:183</a></div></div>
<div class="ttc" id="astruct_a_v_d_r_m_device_context_html"><div class="ttname"><a href="struct_a_v_d_r_m_device_context.html">AVDRMDeviceContext</a></div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__drm_8h_source.html#l00157">hwcontext_drm.h:157</a></div></div>
<div class="ttc" id="agroup__lavu__log__constants_html_ga9b58b28e2d429b930b69db19877f76a8"><div class="ttname"><a href="group__lavu__log__constants.html#ga9b58b28e2d429b930b69db19877f76a8">AV_LOG_VERBOSE</a></div><div class="ttdeci">#define AV_LOG_VERBOSE</div><div class="ttdef"><b>Definition:</b> <a href="log_8h_source.html#l00210">log.h:210</a></div></div>
<div class="ttc" id="astruct_a_v_h_w_device_context_html_a46055b48d1a40445d775b4ae24f77f20"><div class="ttname"><a href="struct_a_v_h_w_device_context.html#a46055b48d1a40445d775b4ae24f77f20">AVHWDeviceContext::hwctx</a></div><div class="ttdeci">void * hwctx</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext_8h_source.html#l00092">hwcontext.h:92</a></div></div>
<div class="ttc" id="astruct_image_buffer_html_a3a7d8a5633569cbb8fb3e794d015de14"><div class="ttname"><a href="struct_image_buffer.html#a3a7d8a5633569cbb8fb3e794d015de14">ImageBuffer::flags</a></div><div class="ttdeci">VkMemoryPropertyFlagBits flags</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l02673">hwcontext_vulkan.c:2673</a></div></div>
<div class="ttc" id="ahwcontext__vulkan_8c_html_afd623dfe84458032bb583efe3fb748e5"><div class="ttname"><a href="hwcontext__vulkan_8c.html#afd623dfe84458032bb583efe3fb748e5">free_exec_ctx</a></div><div class="ttdeci">static void free_exec_ctx(AVHWFramesContext *hwfc, VulkanExecCtx *cmd)</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l00791">hwcontext_vulkan.c:791</a></div></div>
<div class="ttc" id="astruct_a_v_dictionary_entry_html"><div class="ttname"><a href="struct_a_v_dictionary_entry.html">AVDictionaryEntry</a></div><div class="ttdef"><b>Definition:</b> <a href="dict_8h_source.html#l00081">dict.h:81</a></div></div>
<div class="ttc" id="agroup__lavu__buffer_html_ga3e7f4c92db85ccba0b2a16dd0069842a"><div class="ttname"><a href="group__lavu__buffer.html#ga3e7f4c92db85ccba0b2a16dd0069842a">av_buffer_create</a></div><div class="ttdeci">AVBufferRef * av_buffer_create(uint8_t *data, int size, void(*free)(void *opaque, uint8_t *data), void *opaque, int flags)</div><div class="ttdef"><b>Definition:</b> <a href="buffer_8c_source.html#l00029">buffer.c:29</a></div></div>
<div class="ttc" id="ahwcontext__vulkan_8c_html_a8d06ffcc7812858be5d3ba5d4b11c3fb"><div class="ttname"><a href="hwcontext__vulkan_8c.html#a8d06ffcc7812858be5d3ba5d4b11c3fb">vulkan_map_from</a></div><div class="ttdeci">static int vulkan_map_from(AVHWFramesContext *hwfc, AVFrame *dst, const AVFrame *src, int flags)</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l02649">hwcontext_vulkan.c:2649</a></div></div>
<div class="ttc" id="apixfmt_8h_html_a9a8e335cf3be472042bc9f0cf80cd4c5acc582ddd3f60d4cd3ddffb48116fb154"><div class="ttname"><a href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5acc582ddd3f60d4cd3ddffb48116fb154">AV_PIX_FMT_BGR24</a></div><div class="ttdeci">@ AV_PIX_FMT_BGR24</div><div class="ttdoc">packed RGB 8:8:8, 24bpp, BGRBGR...</div><div class="ttdef"><b>Definition:</b> <a href="pixfmt_8h_source.html#l00069">pixfmt.h:69</a></div></div>
<div class="ttc" id="apixfmt_8h_html_a9a8e335cf3be472042bc9f0cf80cd4c5a41c64e3682529dd5caca6f7d5d3c19c7"><div class="ttname"><a href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a41c64e3682529dd5caca6f7d5d3c19c7">AV_PIX_FMT_BGRA</a></div><div class="ttdeci">@ AV_PIX_FMT_BGRA</div><div class="ttdoc">packed BGRA 8:8:8:8, 32bpp, BGRABGRA...</div><div class="ttdef"><b>Definition:</b> <a href="pixfmt_8h_source.html#l00095">pixfmt.h:95</a></div></div>
<div class="ttc" id="ahwcontext_8c_html_a76e0387f519b3f1bd1b162e91b54b182"><div class="ttname"><a href="hwcontext_8c.html#a76e0387f519b3f1bd1b162e91b54b182">ff_hwframe_map_create</a></div><div class="ttdeci">int ff_hwframe_map_create(AVBufferRef *hwframe_ref, AVFrame *dst, const AVFrame *src, void(*unmap)(AVHWFramesContext *ctx, HWMapDescriptor *hwmap), void *priv)</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext_8c_source.html#l00737">hwcontext.c:737</a></div></div>
<div class="ttc" id="astruct_vulkan_frames_priv_html_a718e58f35681599327c47525888792ac"><div class="ttname"><a href="struct_vulkan_frames_priv.html#a718e58f35681599327c47525888792ac">VulkanFramesPriv::conv_ctx</a></div><div class="ttdeci">VulkanExecCtx conv_ctx</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l00088">hwcontext_vulkan.c:88</a></div></div>
<div class="ttc" id="astruct_vulkan_device_selection_html_a54ed0b03971571644c78c16d6b667378"><div class="ttname"><a href="struct_vulkan_device_selection.html#a54ed0b03971571644c78c16d6b667378">VulkanDeviceSelection::uuid</a></div><div class="ttdeci">uint8_t uuid[VK_UUID_SIZE]</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l00501">hwcontext_vulkan.c:501</a></div></div>
<div class="ttc" id="astruct_a_v_h_w_device_internal_html_ae7425663cca9541964518c66974a20bf"><div class="ttname"><a href="struct_a_v_h_w_device_internal.html#ae7425663cca9541964518c66974a20bf">AVHWDeviceInternal::priv</a></div><div class="ttdeci">void * priv</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__internal_8h_source.html#l00105">hwcontext_internal.h:105</a></div></div>
<div class="ttc" id="astruct_a_v_d_r_m_plane_descriptor_html_af1a0839b02055445257d431d946d96a7"><div class="ttname"><a href="struct_a_v_d_r_m_plane_descriptor.html#af1a0839b02055445257d431d946d96a7">AVDRMPlaneDescriptor::offset</a></div><div class="ttdeci">ptrdiff_t offset</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__drm_8h_source.html#l00083">hwcontext_drm.h:83</a></div></div>
<div class="ttc" id="ahwcontext__vulkan_8c_html_aa2579750bda1abdf414c2f3f7de6d9fc"><div class="ttname"><a href="hwcontext__vulkan_8c.html#aa2579750bda1abdf414c2f3f7de6d9fc">prepare_frame</a></div><div class="ttdeci">static int prepare_frame(AVHWFramesContext *hwfc, VulkanExecCtx *ectx, AVVkFrame *frame, enum PrepMode pmode)</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l01429">hwcontext_vulkan.c:1429</a></div></div>
<div class="ttc" id="apixfmt_8h_html_a9a8e335cf3be472042bc9f0cf80cd4c5a0f77c711dcbc9a4acdea48b6b5bc50c7"><div class="ttname"><a href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a0f77c711dcbc9a4acdea48b6b5bc50c7">AV_PIX_FMT_VULKAN</a></div><div class="ttdeci">@ AV_PIX_FMT_VULKAN</div><div class="ttdef"><b>Definition:</b> <a href="pixfmt_8h_source.html#l00356">pixfmt.h:356</a></div></div>
<div class="ttc" id="ahwcontext__vulkan_8c_html_a6497b212ff94fbc7983213312c97ef97"><div class="ttname"><a href="hwcontext__vulkan_8c.html#a6497b212ff94fbc7983213312c97ef97">create_buf</a></div><div class="ttdeci">static int create_buf(AVHWDeviceContext *ctx, AVBufferRef **buf, size_t imp_size, int height, int *stride, VkBufferUsageFlags usage, VkMemoryPropertyFlagBits flags, void *create_pnext, void *alloc_pnext)</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l02691">hwcontext_vulkan.c:2691</a></div></div>
<div class="ttc" id="agroup__lavu__picture_html_ga735cb949320867e9c2fffcb327d0ece2"><div class="ttname"><a href="group__lavu__picture.html#ga735cb949320867e9c2fffcb327d0ece2">av_image_copy_plane</a></div><div class="ttdeci">void av_image_copy_plane(uint8_t *dst, int dst_linesize, const uint8_t *src, int src_linesize, int bytewidth, int height)</div><div class="ttdef"><b>Definition:</b> <a href="imgutils_8c_source.html#l00373">imgutils.c:373</a></div></div>
<div class="ttc" id="ahwcontext__vulkan_8c_html_a1bc9deeeb2378022c6deaf235ab97fe8"><div class="ttname"><a href="hwcontext__vulkan_8c.html#a1bc9deeeb2378022c6deaf235ab97fe8">alloc_mem</a></div><div class="ttdeci">static int alloc_mem(AVHWDeviceContext *ctx, VkMemoryRequirements *req, VkMemoryPropertyFlagBits req_flags, const void *alloc_extension, VkMemoryPropertyFlagBits *mem_flags, VkDeviceMemory *mem)</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l01256">hwcontext_vulkan.c:1256</a></div></div>
<div class="ttc" id="ahwcontext_8h_html_acf25724be4b066a51ad86aa9214b0d34a72179f31ec07ece26bfec17c57491c6e"><div class="ttname"><a href="hwcontext_8h.html#acf25724be4b066a51ad86aa9214b0d34a72179f31ec07ece26bfec17c57491c6e">AV_HWDEVICE_TYPE_VULKAN</a></div><div class="ttdeci">@ AV_HWDEVICE_TYPE_VULKAN</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext_8h_source.html#l00039">hwcontext.h:39</a></div></div>
<div class="ttc" id="astruct_a_v_vulkan_device_context_html_abb0e7a4336731e84eb1b25571635d243"><div class="ttname"><a href="struct_a_v_vulkan_device_context.html#abb0e7a4336731e84eb1b25571635d243">AVVulkanDeviceContext::inst</a></div><div class="ttdeci">VkInstance inst</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8h_source.html#l00047">hwcontext_vulkan.h:47</a></div></div>
<div class="ttc" id="apixfmt_8h_html_a9a8e335cf3be472042bc9f0cf80cd4c5a28369916d5c0317168b7d1b6c22e3ba6"><div class="ttname"><a href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a28369916d5c0317168b7d1b6c22e3ba6">AV_PIX_FMT_NB</a></div><div class="ttdeci">@ AV_PIX_FMT_NB</div><div class="ttdoc">number of pixel formats, DO NOT USE THIS if you want to link with shared libav* because the number of...</div><div class="ttdef"><b>Definition:</b> <a href="pixfmt_8h_source.html#l00364">pixfmt.h:363</a></div></div>
<div class="ttc" id="ahwcontext_8h_html_acf25724be4b066a51ad86aa9214b0d34a8447d4488b0fc4113c281cbdc6e7334e"><div class="ttname"><a href="hwcontext_8h.html#acf25724be4b066a51ad86aa9214b0d34a8447d4488b0fc4113c281cbdc6e7334e">AV_HWDEVICE_TYPE_CUDA</a></div><div class="ttdeci">@ AV_HWDEVICE_TYPE_CUDA</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext_8h_source.html#l00030">hwcontext.h:30</a></div></div>
<div class="ttc" id="astruct_vulkan_device_selection_html_a9b5f385cc4254f561c938df960227a01"><div class="ttname"><a href="struct_vulkan_device_selection.html#a9b5f385cc4254f561c938df960227a01">VulkanDeviceSelection::name</a></div><div class="ttdeci">const char * name</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l00503">hwcontext_vulkan.c:503</a></div></div>
<div class="ttc" id="apixdesc_8c_html_a118df1d607abd7484f874b3d7ea8823a"><div class="ttname"><a href="pixdesc_8c.html#a118df1d607abd7484f874b3d7ea8823a">av_pix_fmt_count_planes</a></div><div class="ttdeci">int av_pix_fmt_count_planes(enum AVPixelFormat pix_fmt)</div><div class="ttdef"><b>Definition:</b> <a href="pixdesc_8c_source.html#l02613">pixdesc.c:2613</a></div></div>
<div class="ttc" id="astruct_vulkan_device_priv_html_a90b5a426b5114eca5015d387b7288e07"><div class="ttname"><a href="struct_vulkan_device_priv.html#a90b5a426b5114eca5015d387b7288e07">VulkanDevicePriv::num_qfs</a></div><div class="ttdeci">int num_qfs</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l00071">hwcontext_vulkan.c:71</a></div></div>
<div class="ttc" id="astruct_a_v_vulkan_frames_context_html_a1d59cf40209ed27b210f8b755c0250fa"><div class="ttname"><a href="struct_a_v_vulkan_frames_context.html#a1d59cf40209ed27b210f8b755c0250fa">AVVulkanFramesContext::tiling</a></div><div class="ttdeci">VkImageTiling tiling</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8h_source.html#l00116">hwcontext_vulkan.h:116</a></div></div>
<div class="ttc" id="astruct_a_v_h_w_frames_constraints_html_a3f1aec6d1c90f77837875c2a3598be46"><div class="ttname"><a href="struct_a_v_h_w_frames_constraints.html#a3f1aec6d1c90f77837875c2a3598be46">AVHWFramesConstraints::min_height</a></div><div class="ttdeci">int min_height</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext_8h_source.html#l00472">hwcontext.h:472</a></div></div>
<div class="ttc" id="ahwcontext__vulkan_8c_html_a7b7516ac11f4ce2194aba2467268534e"><div class="ttname"><a href="hwcontext__vulkan_8c.html#a7b7516ac11f4ce2194aba2467268534e">vulkan_device_derive</a></div><div class="ttdeci">static int vulkan_device_derive(AVHWDeviceContext *ctx, AVHWDeviceContext *src_ctx, AVDictionary *opts, int flags)</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l01138">hwcontext_vulkan.c:1138</a></div></div>
<div class="ttc" id="astruct_a_v_frame_html_a29493fbfabaa21432c360a090426aa8e"><div class="ttname"><a href="struct_a_v_frame.html#a29493fbfabaa21432c360a090426aa8e">AVFrame::hw_frames_ctx</a></div><div class="ttdeci">AVBufferRef * hw_frames_ctx</div><div class="ttdef"><b>Definition:</b> <a href="frame_8h_source.html#l00647">frame.h:647</a></div></div>
<div class="ttc" id="astruct_a_v_h_w_frames_constraints_html_a4258bbe81f927b76b7ca5af44ba7ef6b"><div class="ttname"><a href="struct_a_v_h_w_frames_constraints.html#a4258bbe81f927b76b7ca5af44ba7ef6b">AVHWFramesConstraints::valid_hw_formats</a></div><div class="ttdeci">enum AVPixelFormat * valid_hw_formats</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext_8h_source.html#l00458">hwcontext.h:458</a></div></div>
<div class="ttc" id="acheckasm_8h_html_a73a3b169ac8c3419cbe15327e75ffcfd"><div class="ttname"><a href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a></div><div class="ttdeci">#define fail()</div><div class="ttdef"><b>Definition:</b> <a href="checkasm_8h_source.html#l00123">checkasm.h:123</a></div></div>
<div class="ttc" id="ahwcontext__vulkan_8c_html_a213d14a16ccf5f6f6e9e5ac88824e17d"><div class="ttname"><a href="hwcontext__vulkan_8c.html#a213d14a16ccf5f6f6e9e5ac88824e17d">vulkan_map_frame_to_mem</a></div><div class="ttdeci">static int vulkan_map_frame_to_mem(AVHWFramesContext *hwfc, AVFrame *dst, const AVFrame *src, int flags)</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l01825">hwcontext_vulkan.c:1825</a></div></div>
<div class="ttc" id="astruct_a_v_vk_frame_html_a9f76026dce756dc1134df7771829a5c3"><div class="ttname"><a href="struct_a_v_vk_frame.html#a9f76026dce756dc1134df7771829a5c3">AVVkFrame::internal</a></div><div class="ttdeci">struct AVVkFrameInternal * internal</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8h_source.html#l00189">hwcontext_vulkan.h:189</a></div></div>
<div class="ttc" id="astruct_a_v_vulkan_device_context_html_a7adbed71081998a80f83e92ed72e2821"><div class="ttname"><a href="struct_a_v_vulkan_device_context.html#a7adbed71081998a80f83e92ed72e2821">AVVulkanDeviceContext::queue_family_comp_index</a></div><div class="ttdeci">int queue_family_comp_index</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8h_source.html#l00079">hwcontext_vulkan.h:79</a></div></div>
<div class="ttc" id="awriting__filters_8txt_html_a860450fba1f740387dc082792ad89517"><div class="ttname"><a href="writing__filters_8txt.html#a860450fba1f740387dc082792ad89517">type</a></div><div class="ttdeci">it s the only field you need to keep assuming you have a context There is some magic you don t need to care about around this just let it vf type</div><div class="ttdef"><b>Definition:</b> <a href="writing__filters_8txt_source.html#l00086">writing_filters.txt:86</a></div></div>
<div class="ttc" id="aaf__dynaudnorm_8c_html_a098e07c895cd144e457198846bf64a8f"><div class="ttname"><a href="af__dynaudnorm_8c.html#a098e07c895cd144e457198846bf64a8f">cqueue_create</a></div><div class="ttdeci">static cqueue * cqueue_create(int size, int max_size)</div><div class="ttdef"><b>Definition:</b> <a href="af__dynaudnorm_8c_source.html#l00166">af_dynaudnorm.c:166</a></div></div>
<div class="ttc" id="ahwcontext__vulkan_8c_html_a608f002433583fc02957e4884c9bb981"><div class="ttname"><a href="hwcontext__vulkan_8c.html#a608f002433583fc02957e4884c9bb981">vulkan_frame_free</a></div><div class="ttdeci">static void vulkan_frame_free(void *opaque, uint8_t *data)</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l01337">hwcontext_vulkan.c:1337</a></div></div>
<div class="ttc" id="apixfmt_8h_html_ace4d36d981b86af5f0dc2d6429701684"><div class="ttname"><a href="pixfmt_8h.html#ace4d36d981b86af5f0dc2d6429701684">AV_PIX_FMT_GRAY16</a></div><div class="ttdeci">#define AV_PIX_FMT_GRAY16</div><div class="ttdef"><b>Definition:</b> <a href="pixfmt_8h_source.html#l00383">pixfmt.h:383</a></div></div>
<div class="ttc" id="astruct_vulkan_queue_ctx_html_a6fc206cde8912427b37eebfa5cae659a"><div class="ttname"><a href="struct_vulkan_queue_ctx.html#a6fc206cde8912427b37eebfa5cae659a">VulkanQueueCtx::queue</a></div><div class="ttdeci">VkQueue queue</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l00046">hwcontext_vulkan.c:46</a></div></div>
<div class="ttc" id="ahwcontext__vulkan_8c_html_af94790aab5b000aa1b44ce817563076fa8d525c0ec6b8968069e12896b3658f13"><div class="ttname"><a href="hwcontext__vulkan_8c.html#af94790aab5b000aa1b44ce817563076fa8d525c0ec6b8968069e12896b3658f13">PREP_MODE_RO_SHADER</a></div><div class="ttdeci">@ PREP_MODE_RO_SHADER</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l01425">hwcontext_vulkan.c:1425</a></div></div>
<div class="ttc" id="astruct_a_v_d_r_m_plane_descriptor_html_af07fe11d604e0a3b5fd934f9626c008b"><div class="ttname"><a href="struct_a_v_d_r_m_plane_descriptor.html#af07fe11d604e0a3b5fd934f9626c008b">AVDRMPlaneDescriptor::object_index</a></div><div class="ttdeci">int object_index</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__drm_8h_source.html#l00079">hwcontext_drm.h:79</a></div></div>
<div class="ttc" id="astruct_a_v_h_w_device_context_html"><div class="ttname"><a href="struct_a_v_h_w_device_context.html">AVHWDeviceContext</a></div><div class="ttdef"><b>Definition:</b> <a href="hwcontext_8h_source.html#l00061">hwcontext.h:61</a></div></div>
<div class="ttc" id="astruct_vulkan_device_priv_html"><div class="ttname"><a href="struct_vulkan_device_priv.html">VulkanDevicePriv</a></div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l00063">hwcontext_vulkan.c:63</a></div></div>
<div class="ttc" id="astruct_a_v_vulkan_device_context_html_a160efd57925b2bf9c75c94b1aafad629"><div class="ttname"><a href="struct_a_v_vulkan_device_context.html#a160efd57925b2bf9c75c94b1aafad629">AVVulkanDeviceContext::queue_family_tx_index</a></div><div class="ttdeci">int queue_family_tx_index</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8h_source.html#l00072">hwcontext_vulkan.h:72</a></div></div>
<div class="ttc" id="agroup__lavu__frame_html_gac700017c5270c79c1e1befdeeb008b2f"><div class="ttname"><a href="group__lavu__frame.html#gac700017c5270c79c1e1befdeeb008b2f">av_frame_alloc</a></div><div class="ttdeci">AVFrame * av_frame_alloc(void)</div><div class="ttdef"><b>Definition:</b> <a href="frame_8c_source.html#l00190">frame.c:190</a></div></div>
<div class="ttc" id="astruct_a_v_h_w_frames_context_html_ae61bbe1d8645a0c573085e29f1d0a58f"><div class="ttname"><a href="struct_a_v_h_w_frames_context.html#ae61bbe1d8645a0c573085e29f1d0a58f">AVHWFramesContext::height</a></div><div class="ttdeci">int height</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext_8h_source.html#l00229">hwcontext.h:229</a></div></div>
<div class="ttc" id="ahwcontext__vulkan_8c_html_adfa9f1974c8c5348db6b4034e3aa7b4ea2c5db237d3d2464a020222e5a328c9df"><div class="ttname"><a href="hwcontext__vulkan_8c.html#adfa9f1974c8c5348db6b4034e3aa7b4ea2c5db237d3d2464a020222e5a328c9df">EXT_EXTERNAL_HOST_MEMORY</a></div><div class="ttdeci">@ EXT_EXTERNAL_HOST_MEMORY</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l00212">hwcontext_vulkan.c:212</a></div></div>
<div class="ttc" id="astruct_a_v_v_a_a_p_i_device_context_html_a89951d5ccfad53ce81444773ea9f774e"><div class="ttname"><a href="struct_a_v_v_a_a_p_i_device_context.html#a89951d5ccfad53ce81444773ea9f774e">AVVAAPIDeviceContext::display</a></div><div class="ttdeci">VADisplay display</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vaapi_8h_source.html#l00072">hwcontext_vaapi.h:72</a></div></div>
<div class="ttc" id="agroup__avoptions_html_gga06fc87d81c62e9abb8790b6e5713c55ba236262031fe4c5503b2611c2c8fb520b"><div class="ttname"><a href="group__avoptions.html#gga06fc87d81c62e9abb8790b6e5713c55ba236262031fe4c5503b2611c2c8fb520b">AV_HWFRAME_MAP_READ</a></div><div class="ttdeci">@ AV_HWFRAME_MAP_READ</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext_8h_source.html#l00524">hwcontext.h:524</a></div></div>
<div class="ttc" id="ahwcontext__vulkan_8c_html_a0c938954f0b293626efb96e7fc161e1f"><div class="ttname"><a href="hwcontext__vulkan_8c.html#a0c938954f0b293626efb96e7fc161e1f">wait_start_exec_ctx</a></div><div class="ttdeci">static int wait_start_exec_ctx(AVHWFramesContext *hwfc, VulkanExecCtx *cmd)</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l00837">hwcontext_vulkan.c:837</a></div></div>
<div class="ttc" id="ahwcontext__vulkan_8c_html_a72c7a0f881dcbb6bf1b88136ab995831"><div class="ttname"><a href="hwcontext__vulkan_8c.html#a72c7a0f881dcbb6bf1b88136ab995831">vk_pixfmt_map</a></div><div class="ttdeci">static const struct @0 vk_pixfmt_map[]</div></div>
<div class="ttc" id="agroup__lavu__log__constants_html_gaffe151ff4cd8a24b2e77ac8d9616c85c"><div class="ttname"><a href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a></div><div class="ttdeci">#define AV_LOG_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="log_8h_source.html#l00194">log.h:194</a></div></div>
<div class="ttc" id="astruct_a_v_pix_fmt_descriptor_html_abea8ed308fe00644fc066a00018afa95"><div class="ttname"><a href="struct_a_v_pix_fmt_descriptor.html#abea8ed308fe00644fc066a00018afa95">AVPixFmtDescriptor::log2_chroma_h</a></div><div class="ttdeci">uint8_t log2_chroma_h</div><div class="ttdef"><b>Definition:</b> <a href="pixdesc_8h_source.html#l00101">pixdesc.h:101</a></div></div>
<div class="ttc" id="astruct_vulkan_queue_ctx_html_a1f21f90d4f4cfd8e8b7c381258a8d88d"><div class="ttname"><a href="struct_vulkan_queue_ctx.html#a1f21f90d4f4cfd8e8b7c381258a8d88d">VulkanQueueCtx::buf_deps</a></div><div class="ttdeci">AVBufferRef ** buf_deps</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l00050">hwcontext_vulkan.c:50</a></div></div>
<div class="ttc" id="astruct_vulkan_mapping_html"><div class="ttname"><a href="struct_vulkan_mapping.html">VulkanMapping</a></div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l01788">hwcontext_vulkan.c:1788</a></div></div>
<div class="ttc" id="apixfmt_8h_html_ac9e00af924c2f96085b44642b1fbc076"><div class="ttname"><a href="pixfmt_8h.html#ac9e00af924c2f96085b44642b1fbc076">AV_PIX_FMT_YUV422P16</a></div><div class="ttdeci">#define AV_PIX_FMT_YUV422P16</div><div class="ttdef"><b>Definition:</b> <a href="pixfmt_8h_source.html#l00411">pixfmt.h:411</a></div></div>
<div class="ttc" id="astruct_vulkan_device_selection_html_af92cca9ef38a16fc40df91fe56ea1cb1"><div class="ttname"><a href="struct_vulkan_device_selection.html#af92cca9ef38a16fc40df91fe56ea1cb1">VulkanDeviceSelection::has_uuid</a></div><div class="ttdeci">int has_uuid</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l00502">hwcontext_vulkan.c:502</a></div></div>
<div class="ttc" id="astruct_a_v_vulkan_device_context_html_aa7908b8833b8c3fee7fc18fab9fcf0d0"><div class="ttname"><a href="struct_a_v_vulkan_device_context.html#aa7908b8833b8c3fee7fc18fab9fcf0d0">AVVulkanDeviceContext::nb_graphics_queues</a></div><div class="ttdeci">int nb_graphics_queues</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8h_source.html#l00065">hwcontext_vulkan.h:65</a></div></div>
<div class="ttc" id="ahwcontext__vulkan_8c_html_af99e98fc6db03e4a7becac050fb248dd"><div class="ttname"><a href="hwcontext__vulkan_8c.html#af99e98fc6db03e4a7becac050fb248dd">vulkan_map_to</a></div><div class="ttdeci">static int vulkan_map_to(AVHWFramesContext *hwfc, AVFrame *dst, const AVFrame *src, int flags)</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l02476">hwcontext_vulkan.c:2476</a></div></div>
<div class="ttc" id="agroup__lavu__dict_html_gae67f143237b2cb2936c9b147aa6dfde3"><div class="ttname"><a href="group__lavu__dict.html#gae67f143237b2cb2936c9b147aa6dfde3">av_dict_get</a></div><div class="ttdeci">AVDictionaryEntry * av_dict_get(const AVDictionary *m, const char *key, const AVDictionaryEntry *prev, int flags)</div><div class="ttdef"><b>Definition:</b> <a href="dict_8c_source.html#l00040">dict.c:40</a></div></div>
<div class="ttc" id="astruct_vulkan_queue_ctx_html_a67052152ec8f1bdfb4be3c56f07447e4"><div class="ttname"><a href="struct_vulkan_queue_ctx.html#a67052152ec8f1bdfb4be3c56f07447e4">VulkanQueueCtx::buf_deps_alloc_size</a></div><div class="ttdeci">int buf_deps_alloc_size</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l00052">hwcontext_vulkan.c:52</a></div></div>
<div class="ttc" id="agroup__lavu__bufferpool_html_ga2c745ecb4001452423e775b06b20fb7c"><div class="ttname"><a href="group__lavu__bufferpool.html#ga2c745ecb4001452423e775b06b20fb7c">av_buffer_pool_get</a></div><div class="ttdeci">AVBufferRef * av_buffer_pool_get(AVBufferPool *pool)</div><div class="ttdef"><b>Definition:</b> <a href="buffer_8c_source.html#l00364">buffer.c:364</a></div></div>
<div class="ttc" id="agroup__lavu__mem__funcs_html_ga869fd8884d8d29a7a4910d879926d94a"><div class="ttname"><a href="group__lavu__mem__funcs.html#ga869fd8884d8d29a7a4910d879926d94a">av_fast_realloc</a></div><div class="ttdeci">void * av_fast_realloc(void *ptr, unsigned int *size, size_t min_size)</div><div class="ttdef"><b>Definition:</b> <a href="mem_8c_source.html#l00478">mem.c:478</a></div></div>
<div class="ttc" id="atests_2snowenc_8c_html_a667b04d7fb6ef46db4da4af554c5b6f7"><div class="ttname"><a href="tests_2snowenc_8c.html#a667b04d7fb6ef46db4da4af554c5b6f7">width</a></div><div class="ttdeci">#define width</div></div>
<div class="ttc" id="astruct_a_v_dictionary_entry_html_aa38678f2cad36f120d42e56449c5edb4"><div class="ttname"><a href="struct_a_v_dictionary_entry.html#aa38678f2cad36f120d42e56449c5edb4">AVDictionaryEntry::value</a></div><div class="ttdeci">char * value</div><div class="ttdef"><b>Definition:</b> <a href="dict_8h_source.html#l00083">dict.h:83</a></div></div>
<div class="ttc" id="apixfmt_8h_html_ae7920607c5cf9a219cc94b5c7efc457d"><div class="ttname"><a href="pixfmt_8h.html#ae7920607c5cf9a219cc94b5c7efc457d">AV_PIX_FMT_YUV444P16</a></div><div class="ttdeci">#define AV_PIX_FMT_YUV444P16</div><div class="ttdef"><b>Definition:</b> <a href="pixfmt_8h_source.html#l00412">pixfmt.h:412</a></div></div>
<div class="ttc" id="acommon_8h_html_a5d13452b0fac0d41b08ea2e49ea6eaa5"><div class="ttname"><a href="common_8h.html#a5d13452b0fac0d41b08ea2e49ea6eaa5">AV_CEIL_RSHIFT</a></div><div class="ttdeci">#define AV_CEIL_RSHIFT(a, b)</div><div class="ttdef"><b>Definition:</b> <a href="common_8h_source.html#l00058">common.h:58</a></div></div>
<div class="ttc" id="afilter__design_8txt_html_a7d537039ea0e18164d9edb0b5ca984dd"><div class="ttname"><a href="filter__design_8txt.html#a7d537039ea0e18164d9edb0b5ca984dd">format</a></div><div class="ttdeci">Filter the word frame indicates either a video frame or a group of audio as stored in an AVFrame structure Format for each input and each output the list of supported formats For video that means pixel format For audio that means channel sample format(the sample packing is implied by the sample format) and sample rate. The lists are not just lists</div></div>
<div class="ttc" id="ahwcontext__vulkan_8c_html_a5994e70261f372c6e8eef65bd9f30dd1"><div class="ttname"><a href="hwcontext__vulkan_8c.html#a5994e70261f372c6e8eef65bd9f30dd1">transfer_image_buf</a></div><div class="ttdeci">static int transfer_image_buf(AVHWFramesContext *hwfc, const AVFrame *f, AVBufferRef **bufs, const int *buf_stride, int w, int h, enum AVPixelFormat pix_fmt, int to_buf)</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l02870">hwcontext_vulkan.c:2870</a></div></div>
<div class="ttc" id="agroup__lavu__string_html_ga3d4270f4ed651c414e2850090b9b77c4"><div class="ttname"><a href="group__lavu__string.html#ga3d4270f4ed651c414e2850090b9b77c4">av_strtok</a></div><div class="ttdeci">char * av_strtok(char *s, const char *delim, char **saveptr)</div><div class="ttdef"><b>Definition:</b> <a href="avstring_8c_source.html#l00186">avstring.c:186</a></div></div>
<div class="ttc" id="ahwcontext__vulkan_8c_html_acc25b1e67c50a452aa1965aaca0acf88"><div class="ttname"><a href="hwcontext__vulkan_8c.html#acc25b1e67c50a452aa1965aaca0acf88">VK_LOAD_PFN</a></div><div class="ttdeci">#define VK_LOAD_PFN(inst, name)</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l00117">hwcontext_vulkan.c:117</a></div></div>
<div class="ttc" id="astruct_a_v_h_w_frames_constraints_html_af220776925452091085139081d5d7251"><div class="ttname"><a href="struct_a_v_h_w_frames_constraints.html#af220776925452091085139081d5d7251">AVHWFramesConstraints::min_width</a></div><div class="ttdeci">int min_width</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext_8h_source.html#l00471">hwcontext.h:471</a></div></div>
<div class="ttc" id="ahwcontext__vulkan_8c_html_ace458c3b8c27631b00e72b0c8a5609ef"><div class="ttname"><a href="hwcontext__vulkan_8c.html#ace458c3b8c27631b00e72b0c8a5609ef">vulkan_frames_uninit</a></div><div class="ttdeci">static void vulkan_frames_uninit(AVHWFramesContext *hwfc)</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l01687">hwcontext_vulkan.c:1687</a></div></div>
<div class="ttc" id="agroup__lavu__log__constants_html_ga5b7221c3afd06848486776bd834a58a5"><div class="ttname"><a href="group__lavu__log__constants.html#ga5b7221c3afd06848486776bd834a58a5">AV_LOG_DEBUG</a></div><div class="ttdeci">#define AV_LOG_DEBUG</div><div class="ttdef"><b>Definition:</b> <a href="log_8h_source.html#l00215">log.h:215</a></div></div>
<div class="ttc" id="apixfmt_8h_html_a0a2608337c1116f843a0155e7a574a4d"><div class="ttname"><a href="pixfmt_8h.html#a0a2608337c1116f843a0155e7a574a4d">AV_PIX_FMT_YUV420P16</a></div><div class="ttdeci">#define AV_PIX_FMT_YUV420P16</div><div class="ttdef"><b>Definition:</b> <a href="pixfmt_8h_source.html#l00410">pixfmt.h:410</a></div></div>
<div class="ttc" id="atests_2movenc_8c_html_a93cc7296f13f507c1fd7abd0db36b898"><div class="ttname"><a href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a></div><div class="ttdeci">AVFormatContext * ctx</div><div class="ttdef"><b>Definition:</b> <a href="tests_2movenc_8c_source.html#l00048">movenc.c:48</a></div></div>
<div class="ttc" id="astruct_a_v_h_w_frames_constraints_html_aabea88093c6f85d6185ffb0852a2217f"><div class="ttname"><a href="struct_a_v_h_w_frames_constraints.html#aabea88093c6f85d6185ffb0852a2217f">AVHWFramesConstraints::valid_sw_formats</a></div><div class="ttdeci">enum AVPixelFormat * valid_sw_formats</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext_8h_source.html#l00465">hwcontext.h:465</a></div></div>
<div class="ttc" id="ahwcontext__vulkan_8c_html_a64891fa46e2b44b3e1667d354c9028ae"><div class="ttname"><a href="hwcontext__vulkan_8c.html#a64891fa46e2b44b3e1667d354c9028ae">check_extensions</a></div><div class="ttdeci">static int check_extensions(AVHWDeviceContext *ctx, int dev, AVDictionary *opts, const char *const **dst, uint32_t *num, int debug)</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l00298">hwcontext_vulkan.c:298</a></div></div>
<div class="ttc" id="astruct_a_v_vk_frame_html_a2879b0cac663bb604635a2bfb6d06fea"><div class="ttname"><a href="struct_a_v_vk_frame.html#a2879b0cac663bb604635a2bfb6d06fea">AVVkFrame::sem</a></div><div class="ttdeci">VkSemaphore sem[AV_NUM_DATA_POINTERS]</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8h_source.html#l00184">hwcontext_vulkan.h:184</a></div></div>
<div class="ttc" id="ademuxing__decoding_8c_html_a7331e302ea7bb48e0b605a069576e135"><div class="ttname"><a href="demuxing__decoding_8c.html#a7331e302ea7bb48e0b605a069576e135">pix_fmt</a></div><div class="ttdeci">static enum AVPixelFormat pix_fmt</div><div class="ttdef"><b>Definition:</b> <a href="demuxing__decoding_8c_source.html#l00039">demuxing_decoding.c:40</a></div></div>
<div class="ttc" id="astruct_vulkan_queue_ctx_html_a0235250212cf181a69d5a89b27e7f9b2"><div class="ttname"><a href="struct_vulkan_queue_ctx.html#a0235250212cf181a69d5a89b27e7f9b2">VulkanQueueCtx::fence</a></div><div class="ttdeci">VkFence fence</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l00045">hwcontext_vulkan.c:45</a></div></div>
<div class="ttc" id="astruct_a_v_h_w_frames_internal_html_a2858e1cd83082cc8bcbbf581283e7af2"><div class="ttname"><a href="struct_a_v_h_w_frames_internal.html#a2858e1cd83082cc8bcbbf581283e7af2">AVHWFramesInternal::pool_internal</a></div><div class="ttdeci">AVBufferPool * pool_internal</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__internal_8h_source.html#l00118">hwcontext_internal.h:118</a></div></div>
<div class="ttc" id="ahwcontext__vulkan_8c_html_adfa9f1974c8c5348db6b4034e3aa7b4ea498c8e07b8e37d27d1ce7bc1e4e9e4f7"><div class="ttname"><a href="hwcontext__vulkan_8c.html#adfa9f1974c8c5348db6b4034e3aa7b4ea498c8e07b8e37d27d1ce7bc1e4e9e4f7">EXT_EXTERNAL_FD_MEMORY</a></div><div class="ttdeci">@ EXT_EXTERNAL_FD_MEMORY</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l00210">hwcontext_vulkan.c:210</a></div></div>
<div class="ttc" id="ahwcontext__vulkan_8c_html_a78cecfa14fbe7d736376b5147adc68cc"><div class="ttname"><a href="hwcontext__vulkan_8c.html#a78cecfa14fbe7d736376b5147adc68cc">vulkan_transfer_get_formats</a></div><div class="ttdeci">static int vulkan_transfer_get_formats(AVHWFramesContext *hwfc, enum AVHWFrameTransferDirection dir, enum AVPixelFormat **formats)</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l01773">hwcontext_vulkan.c:1773</a></div></div>
<div class="ttc" id="astruct_a_v_vk_frame_html"><div class="ttname"><a href="struct_a_v_vk_frame.html">AVVkFrame</a></div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8h_source.html#l00149">hwcontext_vulkan.h:149</a></div></div>
<div class="ttc" id="apixfmt_8h_html_a9a8e335cf3be472042bc9f0cf80cd4c5a1aa7677092740d8def31655b5d7f0cc2"><div class="ttname"><a href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a1aa7677092740d8def31655b5d7f0cc2">AV_PIX_FMT_YUV420P</a></div><div class="ttdeci">@ AV_PIX_FMT_YUV420P</div><div class="ttdoc">planar YUV 4:2:0, 12bpp, (1 Cr &amp; Cb sample per 2x2 Y samples)</div><div class="ttdef"><b>Definition:</b> <a href="pixfmt_8h_source.html#l00066">pixfmt.h:66</a></div></div>
<div class="ttc" id="apixfmt_8h_html_a934b37a072574ad04c2e7dab500e860a"><div class="ttname"><a href="pixfmt_8h.html#a934b37a072574ad04c2e7dab500e860a">AV_PIX_FMT_GRAYF32</a></div><div class="ttdeci">#define AV_PIX_FMT_GRAYF32</div><div class="ttdef"><b>Definition:</b> <a href="pixfmt_8h_source.html#l00431">pixfmt.h:431</a></div></div>
<div class="ttc" id="agroup__lavu__ver_html_ga9848c90e4ea707cb0732db0de569452a"><div class="ttname"><a href="group__lavu__ver.html#ga9848c90e4ea707cb0732db0de569452a">LIBAVUTIL_VERSION_MINOR</a></div><div class="ttdeci">#define LIBAVUTIL_VERSION_MINOR</div><div class="ttdef"><b>Definition:</b> <a href="libavutil_2version_8h_source.html#l00082">version.h:82</a></div></div>
<div class="ttc" id="acbs__vp9_8c_html_a67e4f69aaf2fe15c3d298d0a2de865a3"><div class="ttname"><a href="cbs__vp9_8c.html#a67e4f69aaf2fe15c3d298d0a2de865a3">f</a></div><div class="ttdeci">#define f(width, name)</div><div class="ttdef"><b>Definition:</b> <a href="cbs__vp9_8c_source.html#l00255">cbs_vp9.c:255</a></div></div>
<div class="ttc" id="astruct_a_v_d_r_m_frame_descriptor_html_a0a757137c80a528953645ab11f31e6b7"><div class="ttname"><a href="struct_a_v_d_r_m_frame_descriptor.html#a0a757137c80a528953645ab11f31e6b7">AVDRMFrameDescriptor::objects</a></div><div class="ttdeci">AVDRMObjectDescriptor objects[AV_DRM_MAX_PLANES]</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__drm_8h_source.html#l00141">hwcontext_drm.h:141</a></div></div>
<div class="ttc" id="apixfmt_8h_html_a9a8e335cf3be472042bc9f0cf80cd4c5a7ffbd399b88a48196e3cba416eec4dac"><div class="ttname"><a href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a7ffbd399b88a48196e3cba416eec4dac">AV_PIX_FMT_RGBA</a></div><div class="ttdeci">@ AV_PIX_FMT_RGBA</div><div class="ttdoc">packed RGBA 8:8:8:8, 32bpp, RGBARGBA...</div><div class="ttdef"><b>Definition:</b> <a href="pixfmt_8h_source.html#l00093">pixfmt.h:93</a></div></div>
<div class="ttc" id="acommon_8h_html_ad6d88940cfc29c13a3e51ded211fc242"><div class="ttname"><a href="common_8h.html#ad6d88940cfc29c13a3e51ded211fc242">FFABS</a></div><div class="ttdeci">#define FFABS(a)</div><div class="ttdef"><b>Definition:</b> <a href="common_8h_source.html#l00072">common.h:72</a></div></div>
<div class="ttc" id="afilter__design_8txt_html_a0e82f1088fdc24c14bf175d2ac77523f"><div class="ttname"><a href="filter__design_8txt.html#a0e82f1088fdc24c14bf175d2ac77523f">if</a></div><div class="ttdeci">if(ret)</div><div class="ttdef"><b>Definition:</b> <a href="filter__design_8txt_source.html#l00179">filter_design.txt:179</a></div></div>
<div class="ttc" id="ahwcontext__vulkan_8c_html_ac3dce3efdada0dab3fd7fca01e374871"><div class="ttname"><a href="hwcontext__vulkan_8c.html#ac3dce3efdada0dab3fd7fca01e374871">av_vkfmt_from_pixfmt</a></div><div class="ttdeci">const VkFormat * av_vkfmt_from_pixfmt(enum AVPixelFormat p)</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l00175">hwcontext_vulkan.c:175</a></div></div>
<div class="ttc" id="atests_2movenc_8c_html_af540b728145b614e34c4e10930354b93"><div class="ttname"><a href="tests_2movenc_8c.html#af540b728145b614e34c4e10930354b93">opts</a></div><div class="ttdeci">AVDictionary * opts</div><div class="ttdef"><b>Definition:</b> <a href="tests_2movenc_8c_source.html#l00050">movenc.c:50</a></div></div>
<div class="ttc" id="ahwcontext__vulkan_8c_html_af94790aab5b000aa1b44ce817563076fa33f0896bb2828e1ee77b85224f4f658d"><div class="ttname"><a href="hwcontext__vulkan_8c.html#af94790aab5b000aa1b44ce817563076fa33f0896bb2828e1ee77b85224f4f658d">PREP_MODE_WRITE</a></div><div class="ttdeci">@ PREP_MODE_WRITE</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l01424">hwcontext_vulkan.c:1424</a></div></div>
<div class="ttc" id="apixfmt_8h_html_a79f0cce2e796a9e51f75fea1695c9160"><div class="ttname"><a href="pixfmt_8h.html#a79f0cce2e796a9e51f75fea1695c9160">AV_PIX_FMT_RGBA64</a></div><div class="ttdeci">#define AV_PIX_FMT_RGBA64</div><div class="ttdef"><b>Definition:</b> <a href="pixfmt_8h_source.html#l00389">pixfmt.h:389</a></div></div>
<div class="ttc" id="aaacdec__template_8c_html_affa0ccbe2ef7fd24bb8c61e28d1a6631"><div class="ttname"><a href="aacdec__template_8c.html#affa0ccbe2ef7fd24bb8c61e28d1a6631">flush</a></div><div class="ttdeci">static void flush(AVCodecContext *avctx)</div><div class="ttdef"><b>Definition:</b> <a href="aacdec__template_8c_source.html#l00592">aacdec_template.c:592</a></div></div>
<div class="ttc" id="acoverity_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="coverity_8c_source.html#l00032">coverity.c:32</a></div></div>
<div class="ttc" id="agroup__lavu__error_html_ga67a27567a9e5b7037fee072fbcc34dbf"><div class="ttname"><a href="group__lavu__error.html#ga67a27567a9e5b7037fee072fbcc34dbf">AVERROR_PATCHWELCOME</a></div><div class="ttdeci">#define AVERROR_PATCHWELCOME</div><div class="ttdoc">Not yet implemented in FFmpeg, patches welcome.</div><div class="ttdef"><b>Definition:</b> <a href="error_8h_source.html#l00062">error.h:62</a></div></div>
<div class="ttc" id="agroup__lavu__buffer_html_ga135e9e929b5033bb8f68322497b2effc"><div class="ttname"><a href="group__lavu__buffer.html#ga135e9e929b5033bb8f68322497b2effc">av_buffer_unref</a></div><div class="ttdeci">void av_buffer_unref(AVBufferRef **buf)</div><div class="ttdef"><b>Definition:</b> <a href="buffer_8c_source.html#l00125">buffer.c:125</a></div></div>
<div class="ttc" id="ahwcontext__vulkan_8c_html_ab4395598042453295899a91b26ad013b"><div class="ttname"><a href="hwcontext__vulkan_8c.html#ab4395598042453295899a91b26ad013b">vk_ret2str</a></div><div class="ttdeci">static const char * vk_ret2str(VkResult res)</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l00235">hwcontext_vulkan.c:235</a></div></div>
<div class="ttc" id="astruct_vulkan_device_selection_html"><div class="ttname"><a href="struct_vulkan_device_selection.html">VulkanDeviceSelection</a></div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l00500">hwcontext_vulkan.c:500</a></div></div>
<div class="ttc" id="astruct_a_v_h_w_frames_context_html"><div class="ttname"><a href="struct_a_v_h_w_frames_context.html">AVHWFramesContext</a></div><div class="ttdef"><b>Definition:</b> <a href="hwcontext_8h_source.html#l00124">hwcontext.h:124</a></div></div>
<div class="ttc" id="astruct_vulkan_opt_extension_html_a3014adf868a1bb91d76e8ca0e78506e2"><div class="ttname"><a href="struct_vulkan_opt_extension.html#a3014adf868a1bb91d76e8ca0e78506e2">VulkanOptExtension::name</a></div><div class="ttdeci">const char * name</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l00218">hwcontext_vulkan.c:218</a></div></div>
<div class="ttc" id="ahwcontext__vulkan_8c_html_a17625fb48ab3e129591594e4352a24aa"><div class="ttname"><a href="hwcontext__vulkan_8c.html#a17625fb48ab3e129591594e4352a24aa">SEARCH_FLAGS</a></div><div class="ttdeci">#define SEARCH_FLAGS(expr, out)</div></div>
<div class="ttc" id="agroup__lavu__ver_html_gaa29a3ad3376b8050d9ef4779045f745e"><div class="ttname"><a href="group__lavu__ver.html#gaa29a3ad3376b8050d9ef4779045f745e">LIBAVUTIL_VERSION_MAJOR</a></div><div class="ttdeci">#define LIBAVUTIL_VERSION_MAJOR</div><div class="ttdef"><b>Definition:</b> <a href="libavutil_2version_8h_source.html#l00081">version.h:81</a></div></div>
<div class="ttc" id="atests_2checkasm_2vp8dsp_8c_html_a858376c0918f93e656c8c0d76c63dbe8"><div class="ttname"><a href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a></div><div class="ttdeci">#define src</div><div class="ttdef"><b>Definition:</b> <a href="tests_2checkasm_2vp8dsp_8c_source.html#l00254">vp8dsp.c:254</a></div></div>
<div class="ttc" id="ahwcontext__vulkan_8c_html_a49245cfc6715426a872bd949205d6f0b"><div class="ttname"><a href="hwcontext__vulkan_8c.html#a49245cfc6715426a872bd949205d6f0b">unmap_buffers</a></div><div class="ttdeci">static int unmap_buffers(AVHWDeviceContext *ctx, AVBufferRef **bufs, int nb_buffers, int flush)</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l02827">hwcontext_vulkan.c:2827</a></div></div>
<div class="ttc" id="ahwcontext__vulkan_8c_html_ad4fde1204eab6629ad1b0953fa815bc8"><div class="ttname"><a href="hwcontext__vulkan_8c.html#ad4fde1204eab6629ad1b0953fa815bc8">ff_hwcontext_type_vulkan</a></div><div class="ttdeci">const HWContextType ff_hwcontext_type_vulkan</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l03299">hwcontext_vulkan.c:3299</a></div></div>
<div class="ttc" id="ahwcontext__vulkan_8h_html"><div class="ttname"><a href="hwcontext__vulkan_8h.html">hwcontext_vulkan.h</a></div></div>
<div class="ttc" id="astruct_a_v_d_r_m_plane_descriptor_html_aa4eaa5a37f40dd7301ce1b8194eefc0a"><div class="ttname"><a href="struct_a_v_d_r_m_plane_descriptor.html#aa4eaa5a37f40dd7301ce1b8194eefc0a">AVDRMPlaneDescriptor::pitch</a></div><div class="ttdeci">ptrdiff_t pitch</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__drm_8h_source.html#l00087">hwcontext_drm.h:87</a></div></div>
<div class="ttc" id="apixfmt_8h_html_a9a8e335cf3be472042bc9f0cf80cd4c5a258e7e59a7f956604b743c14032906b0"><div class="ttname"><a href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a258e7e59a7f956604b743c14032906b0">AV_PIX_FMT_BGR0</a></div><div class="ttdeci">@ AV_PIX_FMT_BGR0</div><div class="ttdoc">packed BGR 8:8:8, 32bpp, BGRXBGRX... X=unused/undefined</div><div class="ttdef"><b>Definition:</b> <a href="pixfmt_8h_source.html#l00240">pixfmt.h:240</a></div></div>
<div class="ttc" id="ahwcontext__vulkan_8c_html_a12d922a26bb56fefdaeb3731d7edab73"><div class="ttname"><a href="hwcontext__vulkan_8c.html#a12d922a26bb56fefdaeb3731d7edab73">CASE</a></div><div class="ttdeci">#define CASE(VAL)</div></div>
<div class="ttc" id="astruct_vulkan_device_priv_html_a895a041d77f8253cb0842c23e54593f2"><div class="ttname"><a href="struct_vulkan_device_priv.html#a895a041d77f8253cb0842c23e54593f2">VulkanDevicePriv::extensions</a></div><div class="ttdeci">uint64_t extensions</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l00077">hwcontext_vulkan.c:77</a></div></div>
<div class="ttc" id="astruct_a_v_pix_fmt_descriptor_html"><div class="ttname"><a href="struct_a_v_pix_fmt_descriptor.html">AVPixFmtDescriptor</a></div><div class="ttdef"><b>Definition:</b> <a href="pixdesc_8h_source.html#l00081">pixdesc.h:81</a></div></div>
<div class="ttc" id="ahwcontext__vulkan_8c_html_a333a3a6e9768bf43163090416c7608ad"><div class="ttname"><a href="hwcontext__vulkan_8c.html#a333a3a6e9768bf43163090416c7608ad">alloc_bind_mem</a></div><div class="ttdeci">static int alloc_bind_mem(AVHWFramesContext *hwfc, AVVkFrame *f, void *alloc_pnext, size_t alloc_pnext_stride)</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l01355">hwcontext_vulkan.c:1355</a></div></div>
<div class="ttc" id="apixfmt_8h_html_a9a8e335cf3be472042bc9f0cf80cd4c5a4616a6eaaf5419e2aa7dcb03031d500e"><div class="ttname"><a href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a4616a6eaaf5419e2aa7dcb03031d500e">AV_PIX_FMT_GRAY8</a></div><div class="ttdeci">@ AV_PIX_FMT_GRAY8</div><div class="ttdoc">Y , 8bpp.</div><div class="ttdef"><b>Definition:</b> <a href="pixfmt_8h_source.html#l00074">pixfmt.h:74</a></div></div>
<div class="ttc" id="aregdef_8h_html_ae771351dd440a8640270282362e338d0"><div class="ttname"><a href="regdef_8h.html#ae771351dd440a8640270282362e338d0">fp</a></div><div class="ttdeci">#define fp</div><div class="ttdef"><b>Definition:</b> <a href="regdef_8h_source.html#l00044">regdef.h:44</a></div></div>
<div class="ttc" id="aeval_8c_html_afc05d41e1a0fc024ac21072d11d4f263"><div class="ttname"><a href="eval_8c.html#afc05d41e1a0fc024ac21072d11d4f263">exp</a></div><div class="ttdeci">int8_t exp</div><div class="ttdef"><b>Definition:</b> <a href="eval_8c_source.html#l00072">eval.c:72</a></div></div>
<div class="ttc" id="apixfmt_8h_html_a9a8e335cf3be472042bc9f0cf80cd4c5a5110926011394bc4f6066145314a5330"><div class="ttname"><a href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a5110926011394bc4f6066145314a5330">AV_PIX_FMT_ABGR</a></div><div class="ttdeci">@ AV_PIX_FMT_ABGR</div><div class="ttdoc">packed ABGR 8:8:8:8, 32bpp, ABGRABGR...</div><div class="ttdef"><b>Definition:</b> <a href="pixfmt_8h_source.html#l00094">pixfmt.h:94</a></div></div>
<div class="ttc" id="agxfenc_8c_html_a750b5d744c39a06bfb13e6eb010e35d0"><div class="ttname"><a href="gxfenc_8c.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a></div><div class="ttdeci">int index</div><div class="ttdef"><b>Definition:</b> <a href="gxfenc_8c_source.html#l00089">gxfenc.c:89</a></div></div>
<div class="ttc" id="astruct_a_v_h_w_frames_internal_html_a503cfeb391ed69856344768fd641a489"><div class="ttname"><a href="struct_a_v_h_w_frames_internal.html#a503cfeb391ed69856344768fd641a489">AVHWFramesInternal::priv</a></div><div class="ttdeci">void * priv</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__internal_8h_source.html#l00116">hwcontext_internal.h:116</a></div></div>
<div class="ttc" id="ahwcontext__vulkan_8c_html_a7265940524076da3611c08653214e578"><div class="ttname"><a href="hwcontext__vulkan_8c.html#a7265940524076da3611c08653214e578">search_queue_families</a></div><div class="ttdeci">static int search_queue_families(AVHWDeviceContext *ctx, VkDeviceCreateInfo *cd)</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l00642">hwcontext_vulkan.c:642</a></div></div>
<div class="ttc" id="astruct_a_v_frame_html_a3f89733f429c98ba5bc64373fb0a3f13"><div class="ttname"><a href="struct_a_v_frame.html#a3f89733f429c98ba5bc64373fb0a3f13">AVFrame::height</a></div><div class="ttdeci">int height</div><div class="ttdef"><b>Definition:</b> <a href="frame_8h_source.html#l00366">frame.h:366</a></div></div>
<div class="ttc" id="astruct_vulkan_frames_priv_html_a376d8b4245677718bd2682839e2d4de1"><div class="ttname"><a href="struct_vulkan_frames_priv.html#a376d8b4245677718bd2682839e2d4de1">VulkanFramesPriv::download_ctx</a></div><div class="ttdeci">VulkanExecCtx download_ctx</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l00092">hwcontext_vulkan.c:92</a></div></div>
<div class="ttc" id="astruct_a_v_h_w_frames_constraints_html"><div class="ttname"><a href="struct_a_v_h_w_frames_constraints.html">AVHWFramesConstraints</a></div><div class="ttdef"><b>Definition:</b> <a href="hwcontext_8h_source.html#l00453">hwcontext.h:453</a></div></div>
<div class="ttc" id="afilter__design_8txt_html_a5235deffb07ad7b49c2b5fed063388e3"><div class="ttname"><a href="filter__design_8txt.html#a5235deffb07ad7b49c2b5fed063388e3">source</a></div><div class="ttdeci">these buffered frames must be flushed immediately if a new input produces new the filter must not call request_frame to get more It must just process the frame or queue it The task of requesting more frames is left to the filter s request_frame method or the application If a filter has several the filter must be ready for frames arriving randomly on any input any filter with several inputs will most likely require some kind of queuing mechanism It is perfectly acceptable to have a limited queue and to drop frames when the inputs are too unbalanced request_frame For filters that do not use the this method is called when a frame is wanted on an output For a source</div><div class="ttdef"><b>Definition:</b> <a href="filter__design_8txt_source.html#l00255">filter_design.txt:255</a></div></div>
<div class="ttc" id="allviddspenc_8c_html_a39de7029a33bc3271ae437de0a38c343"><div class="ttname"><a href="llviddspenc_8c.html#a39de7029a33bc3271ae437de0a38c343">planes</a></div><div class="ttdeci">static const struct @0 planes[]</div></div>
<div class="ttc" id="agroup__lavu__mem__funcs_html_gaf143ecab33a3868b57345466c39de7c1"><div class="ttname"><a href="group__lavu__mem__funcs.html#gaf143ecab33a3868b57345466c39de7c1">av_mallocz</a></div><div class="ttdeci">void * av_mallocz(size_t size)</div><div class="ttdef"><b>Definition:</b> <a href="mem_8c_source.html#l00237">mem.c:237</a></div></div>
<div class="ttc" id="afloatimg__cmp_8c_html_aef1bd6ad890a110b466cb0e8088507a2"><div class="ttname"><a href="floatimg__cmp_8c.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a></div><div class="ttdeci">const char * usage</div><div class="ttdef"><b>Definition:</b> <a href="floatimg__cmp_8c_source.html#l00060">floatimg_cmp.c:60</a></div></div>
<div class="ttc" id="ahwcontext__vulkan_8c_html_af9240320c6e8aa3c937ffe82c77be676"><div class="ttname"><a href="hwcontext__vulkan_8c.html#af9240320c6e8aa3c937ffe82c77be676">create_frame</a></div><div class="ttdeci">static int create_frame(AVHWFramesContext *hwfc, AVVkFrame **frame, VkImageTiling tiling, VkImageUsageFlagBits usage, void *create_pnext)</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l01502">hwcontext_vulkan.c:1502</a></div></div>
<div class="ttc" id="ahwcontext__vulkan_8c_html_afbcde1018fdc1e8bfca60ead7cf50191"><div class="ttname"><a href="hwcontext__vulkan_8c.html#afbcde1018fdc1e8bfca60ead7cf50191">DEFAULT_USAGE_FLAGS</a></div><div class="ttdeci">#define DEFAULT_USAGE_FLAGS</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l00120">hwcontext_vulkan.c:120</a></div></div>
<div class="ttc" id="ahwcontext__vulkan_8c_html_af94790aab5b000aa1b44ce817563076f"><div class="ttname"><a href="hwcontext__vulkan_8c.html#af94790aab5b000aa1b44ce817563076f">PrepMode</a></div><div class="ttdeci">PrepMode</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l01423">hwcontext_vulkan.c:1423</a></div></div>
<div class="ttc" id="astruct_a_v_h_w_frames_context_html_a54e38c3e4355321e23e0f4c7411cb8ee"><div class="ttname"><a href="struct_a_v_h_w_frames_context.html#a54e38c3e4355321e23e0f4c7411cb8ee">AVHWFramesContext::hwctx</a></div><div class="ttdeci">void * hwctx</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext_8h_source.html#l00162">hwcontext.h:162</a></div></div>
<div class="ttc" id="apixfmt_8h_html_a9a8e335cf3be472042bc9f0cf80cd4c5a107eadfcfe8c9fc751289eeb7744a6d3"><div class="ttname"><a href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a107eadfcfe8c9fc751289eeb7744a6d3">AV_PIX_FMT_RGB24</a></div><div class="ttdeci">@ AV_PIX_FMT_RGB24</div><div class="ttdoc">packed RGB 8:8:8, 24bpp, RGBRGB...</div><div class="ttdef"><b>Definition:</b> <a href="pixfmt_8h_source.html#l00068">pixfmt.h:68</a></div></div>
<div class="ttc" id="astruct_a_v_c_u_d_a_device_context_html_ae6172fe56bd91f73d50837bdf1434aa7"><div class="ttname"><a href="struct_a_v_c_u_d_a_device_context.html#ae6172fe56bd91f73d50837bdf1434aa7">AVCUDADeviceContext::internal</a></div><div class="ttdeci">AVCUDADeviceContextInternal * internal</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__cuda_8h_source.html#l00045">hwcontext_cuda.h:45</a></div></div>
<div class="ttc" id="astruct_a_v_v_a_a_p_i_device_context_html"><div class="ttname"><a href="struct_a_v_v_a_a_p_i_device_context.html">AVVAAPIDeviceContext</a></div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vaapi_8h_source.html#l00068">hwcontext_vaapi.h:68</a></div></div>
<div class="ttc" id="agroup__lavu__frame_html_gaec4e92f6e1e75ffaf76e07586fb0c9ed"><div class="ttname"><a href="group__lavu__frame.html#gaec4e92f6e1e75ffaf76e07586fb0c9ed">av_frame_copy</a></div><div class="ttdeci">int av_frame_copy(AVFrame *dst, const AVFrame *src)</div><div class="ttdef"><b>Definition:</b> <a href="frame_8c_source.html#l00799">frame.c:799</a></div></div>
<div class="ttc" id="astruct_a_v_d_r_m_layer_descriptor_html_aa71ce914f53563be8207d8bc08fbfe92"><div class="ttname"><a href="struct_a_v_d_r_m_layer_descriptor.html#aa71ce914f53563be8207d8bc08fbfe92">AVDRMLayerDescriptor::nb_planes</a></div><div class="ttdeci">int nb_planes</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__drm_8h_source.html#l00106">hwcontext_drm.h:106</a></div></div>
<div class="ttc" id="ahwcontext__vulkan_8c_html_a951b6233520dcb4be94fd7d4e58a39af"><div class="ttname"><a href="hwcontext__vulkan_8c.html#a951b6233520dcb4be94fd7d4e58a39af">av_vk_frame_alloc</a></div><div class="ttdeci">AVVkFrame * av_vk_frame_alloc(void)</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l03294">hwcontext_vulkan.c:3294</a></div></div>
<div class="ttc" id="ahwcontext__vulkan_8c_html_ab57a578da41251022426566488e0d6da"><div class="ttname"><a href="hwcontext__vulkan_8c.html#ab57a578da41251022426566488e0d6da">vulkan_device_free</a></div><div class="ttdeci">static void vulkan_device_free(AVHWDeviceContext *ctx)</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l00945">hwcontext_vulkan.c:945</a></div></div>
<div class="ttc" id="apixfmt_8h_html_a0a627303cd665a88b342c29f6bc89c8c"><div class="ttname"><a href="pixfmt_8h.html#a0a627303cd665a88b342c29f6bc89c8c">AV_PIX_FMT_GBRPF32</a></div><div class="ttdeci">#define AV_PIX_FMT_GBRPF32</div><div class="ttdef"><b>Definition:</b> <a href="pixfmt_8h_source.html#l00428">pixfmt.h:428</a></div></div>
<div class="ttc" id="ahwcontext__vulkan_8c_html_adffcfb8928e039e795cf18fa2a7ac3d6"><div class="ttname"><a href="hwcontext__vulkan_8c.html#adffcfb8928e039e795cf18fa2a7ac3d6">vulkan_unmap_frame</a></div><div class="ttdeci">static void vulkan_unmap_frame(AVHWFramesContext *hwfc, HWMapDescriptor *hwmap)</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l01793">hwcontext_vulkan.c:1793</a></div></div>
<div class="ttc" id="apixfmt_8h_html_a8aa3ddf224cba014fb9eac404498046a"><div class="ttname"><a href="pixfmt_8h.html#a8aa3ddf224cba014fb9eac404498046a">AV_PIX_FMT_RGB48</a></div><div class="ttdeci">#define AV_PIX_FMT_RGB48</div><div class="ttdef"><b>Definition:</b> <a href="pixfmt_8h_source.html#l00385">pixfmt.h:385</a></div></div>
<div class="ttc" id="ahwcontext__vulkan_8c_html_adfa9f1974c8c5348db6b4034e3aa7b4eadce24ee642ce4f5e0dcd9921d44eae64"><div class="ttname"><a href="hwcontext__vulkan_8c.html#adfa9f1974c8c5348db6b4034e3aa7b4eadce24ee642ce4f5e0dcd9921d44eae64">EXT_NO_FLAG</a></div><div class="ttdeci">@ EXT_NO_FLAG</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l00214">hwcontext_vulkan.c:214</a></div></div>
<div class="ttc" id="ahwcontext__vulkan_8c_html_a8c3202d491f72174172940930dde68e6"><div class="ttname"><a href="hwcontext__vulkan_8c.html#a8c3202d491f72174172940930dde68e6">vulkan_transfer_data_from</a></div><div class="ttdeci">static int vulkan_transfer_data_from(AVHWFramesContext *hwfc, AVFrame *dst, const AVFrame *src)</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l03268">hwcontext_vulkan.c:3268</a></div></div>
<div class="ttc" id="aframe_8h_html_add80189702cf0f5ea82718576fb43201"><div class="ttname"><a href="frame_8h.html#add80189702cf0f5ea82718576fb43201">AV_NUM_DATA_POINTERS</a></div><div class="ttdeci">#define AV_NUM_DATA_POINTERS</div><div class="ttdef"><b>Definition:</b> <a href="frame_8h_source.html#l00309">frame.h:309</a></div></div>
<div class="ttc" id="ahwcontext__vulkan_8c_html_a173b3a1190f9fb5fd5fcd4a0fb64d4c1"><div class="ttname"><a href="hwcontext__vulkan_8c.html#a173b3a1190f9fb5fd5fcd4a0fb64d4c1">VulkanOptExtension</a></div><div class="ttdeci">struct VulkanOptExtension VulkanOptExtension</div></div>
<div class="ttc" id="astruct_a_v_pix_fmt_descriptor_html_a4abca4534188ff94627e88c0d8362058"><div class="ttname"><a href="struct_a_v_pix_fmt_descriptor.html#a4abca4534188ff94627e88c0d8362058">AVPixFmtDescriptor::log2_chroma_w</a></div><div class="ttdeci">uint8_t log2_chroma_w</div><div class="ttdef"><b>Definition:</b> <a href="pixdesc_8h_source.html#l00092">pixdesc.h:92</a></div></div>
<div class="ttc" id="astruct_a_v_vulkan_device_context_html"><div class="ttname"><a href="struct_a_v_vulkan_device_context.html">AVVulkanDeviceContext</a></div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8h_source.html#l00039">hwcontext_vulkan.h:39</a></div></div>
<div class="ttc" id="astruct_a_v_buffer_ref_html"><div class="ttname"><a href="struct_a_v_buffer_ref.html">AVBufferRef</a></div><div class="ttdef"><b>Definition:</b> <a href="buffer_8h_source.html#l00081">buffer.h:81</a></div></div>
<div class="ttc" id="astruct_vulkan_exec_ctx_html_ac2a4fc7e6372cfc350905f539a37ab36"><div class="ttname"><a href="struct_vulkan_exec_ctx.html#ac2a4fc7e6372cfc350905f539a37ab36">VulkanExecCtx::cur_queue_idx</a></div><div class="ttdeci">int cur_queue_idx</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l00060">hwcontext_vulkan.c:60</a></div></div>
<div class="ttc" id="astruct_a_v_d_r_m_object_descriptor_html_a4eeb1aad28f187c3c3e4f9d547a55a3d"><div class="ttname"><a href="struct_a_v_d_r_m_object_descriptor.html#a4eeb1aad28f187c3c3e4f9d547a55a3d">AVDRMObjectDescriptor::size</a></div><div class="ttdeci">size_t size</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__drm_8h_source.html#l00058">hwcontext_drm.h:58</a></div></div>
<div class="ttc" id="astruct_h_w_context_type_html_a5ddb5fc39d16ce3147a5640c8d040937"><div class="ttname"><a href="struct_h_w_context_type.html#a5ddb5fc39d16ce3147a5640c8d040937">HWContextType::type</a></div><div class="ttdeci">enum AVHWDeviceType type</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__internal_8h_source.html#l00176">hwcontext_internal.h:30</a></div></div>
<div class="ttc" id="ahwcontext__vulkan_8h_html_a3fad9e230c8c8482919a197598dd4752"><div class="ttname"><a href="hwcontext__vulkan_8h.html#a3fad9e230c8c8482919a197598dd4752">AVVulkanDeviceContext</a></div><div class="ttdeci">struct AVVulkanDeviceContext AVVulkanDeviceContext</div></div>
<div class="ttc" id="atests_2snowenc_8c_html_a64f9f90ece96c7bab4aee3deacf170e0"><div class="ttname"><a href="tests_2snowenc_8c.html#a64f9f90ece96c7bab4aee3deacf170e0">height</a></div><div class="ttdeci">#define height</div></div>
<div class="ttc" id="acommon_8h_html_a0f84cbd7fd810cd678157c98cbfad4b0"><div class="ttname"><a href="common_8h.html#a0f84cbd7fd810cd678157c98cbfad4b0">FFMIN</a></div><div class="ttdeci">#define FFMIN(a, b)</div><div class="ttdef"><b>Definition:</b> <a href="common_8h_source.html#l00096">common.h:96</a></div></div>
<div class="ttc" id="amem_8c_html_aedc3761897b7e9ea8ae1222b3d013c94"><div class="ttname"><a href="mem_8c.html#aedc3761897b7e9ea8ae1222b3d013c94">av_mallocz_array</a></div><div class="ttdeci">void * av_mallocz_array(size_t nmemb, size_t size)</div><div class="ttdef"><b>Definition:</b> <a href="mem_8c_source.html#l00190">mem.c:190</a></div></div>
<div class="ttc" id="astruct_a_v_d_r_m_layer_descriptor_html_abe9b4585e3ad357cf058dada850c3226"><div class="ttname"><a href="struct_a_v_d_r_m_layer_descriptor.html#abe9b4585e3ad357cf058dada850c3226">AVDRMLayerDescriptor::format</a></div><div class="ttdeci">uint32_t format</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__drm_8h_source.html#l00100">hwcontext_drm.h:100</a></div></div>
<div class="ttc" id="astruct_a_v_frame_html_aa52bfc6605f6a3059a0c3226cc0f6567"><div class="ttname"><a href="struct_a_v_frame.html#aa52bfc6605f6a3059a0c3226cc0f6567">AVFrame::linesize</a></div><div class="ttdeci">int linesize[AV_NUM_DATA_POINTERS]</div><div class="ttdef"><b>Definition:</b> <a href="frame_8h_source.html#l00339">frame.h:339</a></div></div>
<div class="ttc" id="agroup__lavu__error_html_ga9c520e483ba8648495620ffdb4c491f2"><div class="ttname"><a href="group__lavu__error.html#ga9c520e483ba8648495620ffdb4c491f2">AVERROR_EXTERNAL</a></div><div class="ttdeci">#define AVERROR_EXTERNAL</div><div class="ttdoc">Generic error in an external library.</div><div class="ttdef"><b>Definition:</b> <a href="error_8h_source.html#l00057">error.h:57</a></div></div>
<div class="ttc" id="ahwcontext__vulkan_8c_html_a2c95bc38a9d106e007afb65b5fcbb230"><div class="ttname"><a href="hwcontext__vulkan_8c.html#a2c95bc38a9d106e007afb65b5fcbb230">vkfmts</a></div><div class="ttdeci">const VkFormat vkfmts[3]</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l00141">hwcontext_vulkan.c:141</a></div></div>
<div class="ttc" id="apixfmt_8h_html_a9a8e335cf3be472042bc9f0cf80cd4c5ab9fcc01ba1689d75e4bc2080a347e1d0"><div class="ttname"><a href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5ab9fcc01ba1689d75e4bc2080a347e1d0">AV_PIX_FMT_RGB0</a></div><div class="ttdeci">@ AV_PIX_FMT_RGB0</div><div class="ttdoc">packed RGB 8:8:8, 32bpp, RGBXRGBX... X=unused/undefined</div><div class="ttdef"><b>Definition:</b> <a href="pixfmt_8h_source.html#l00238">pixfmt.h:238</a></div></div>
<div class="ttc" id="acuviddec_8c_html_aabb147a1f2a98d37cb3ce0dd6d50b78d"><div class="ttname"><a href="cuviddec_8c.html#aabb147a1f2a98d37cb3ce0dd6d50b78d">CHECK_CU</a></div><div class="ttdeci">#define CHECK_CU(x)</div><div class="ttdef"><b>Definition:</b> <a href="cuviddec_8c_source.html#l00108">cuviddec.c:108</a></div></div>
<div class="ttc" id="astruct_a_v_frame_html_a1e71ce60cedd5f3b6811714a9f7f9e0a"><div class="ttname"><a href="struct_a_v_frame.html#a1e71ce60cedd5f3b6811714a9f7f9e0a">AVFrame::width</a></div><div class="ttdeci">int width</div><div class="ttdef"><b>Definition:</b> <a href="frame_8h_source.html#l00366">frame.h:366</a></div></div>
<div class="ttc" id="astruct_a_v_c_u_d_a_device_context_internal_html_a73041ed3506f9ce333218b4728b5d737"><div class="ttname"><a href="struct_a_v_c_u_d_a_device_context_internal.html#a73041ed3506f9ce333218b4728b5d737">AVCUDADeviceContextInternal::cuda_dl</a></div><div class="ttdeci">CudaFunctions * cuda_dl</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__cuda__internal_8h_source.html#l00032">hwcontext_cuda_internal.h:32</a></div></div>
<div class="ttc" id="apixfmt_8h_html_a9a8e335cf3be472042bc9f0cf80cd4c5abb09cadf3b2d6b5ce5980401bcf638a8"><div class="ttname"><a href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5abb09cadf3b2d6b5ce5980401bcf638a8">AV_PIX_FMT_VAAPI</a></div><div class="ttdeci">@ AV_PIX_FMT_VAAPI</div><div class="ttdef"><b>Definition:</b> <a href="pixfmt_8h_source.html#l00122">pixfmt.h:122</a></div></div>
<div class="ttc" id="astruct_a_v_vulkan_device_context_html_ac1d0d46b238c76cc4d66ddab7180e7ef"><div class="ttname"><a href="struct_a_v_vulkan_device_context.html#ac1d0d46b238c76cc4d66ddab7180e7ef">AVVulkanDeviceContext::device_features</a></div><div class="ttdeci">VkPhysicalDeviceFeatures2 device_features</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8h_source.html#l00106">hwcontext_vulkan.h:106</a></div></div>
<div class="ttc" id="astruct_a_v_d_r_m_frame_descriptor_html_a228800d9ce195e776833e58ee307a6ec"><div class="ttname"><a href="struct_a_v_d_r_m_frame_descriptor.html#a228800d9ce195e776833e58ee307a6ec">AVDRMFrameDescriptor::nb_layers</a></div><div class="ttdeci">int nb_layers</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__drm_8h_source.html#l00145">hwcontext_drm.h:145</a></div></div>
<div class="ttc" id="ahwcontext__vulkan_8c_html_a8ec94342a3a8351bd61eacacd1dedf4b"><div class="ttname"><a href="hwcontext__vulkan_8c.html#a8ec94342a3a8351bd61eacacd1dedf4b">create_exec_ctx</a></div><div class="ttdeci">static int create_exec_ctx(AVHWFramesContext *hwfc, VulkanExecCtx *cmd, int queue_family_index, int num_queues)</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l00736">hwcontext_vulkan.c:736</a></div></div>
<div class="ttc" id="ahwcontext__vulkan_8c_html_ac6f57bda1d022f5fc8524a051409e0da"><div class="ttname"><a href="hwcontext__vulkan_8c.html#ac6f57bda1d022f5fc8524a051409e0da">ADD_QUEUE</a></div><div class="ttdeci">#define ADD_QUEUE(fidx, graph, comp, tx)</div></div>
<div class="ttc" id="astruct_vulkan_device_priv_html_a7a17ab5ea90b05229be6b998d7010327"><div class="ttname"><a href="struct_vulkan_device_priv.html#a7a17ab5ea90b05229be6b998d7010327">VulkanDevicePriv::hprops</a></div><div class="ttdeci">VkPhysicalDeviceExternalMemoryHostPropertiesEXT hprops</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l00067">hwcontext_vulkan.c:67</a></div></div>
<div class="ttc" id="ahwcontext__vulkan_8c_html_adfa9f1974c8c5348db6b4034e3aa7b4e"><div class="ttname"><a href="hwcontext__vulkan_8c.html#adfa9f1974c8c5348db6b4034e3aa7b4e">VulkanExtensions</a></div><div class="ttdeci">VulkanExtensions</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l00207">hwcontext_vulkan.c:207</a></div></div>
<div class="ttc" id="agroup__lavu__log__constants_html_gad172eacfed8653e454c6fdcbe53baab3"><div class="ttname"><a href="group__lavu__log__constants.html#gad172eacfed8653e454c6fdcbe53baab3">AV_LOG_INFO</a></div><div class="ttdeci">#define AV_LOG_INFO</div><div class="ttdef"><b>Definition:</b> <a href="log_8h_source.html#l00205">log.h:205</a></div></div>
<div class="ttc" id="ahwcontext_8h_html_acf25724be4b066a51ad86aa9214b0d34af5dfa6181a3a6efb0f4a0c5f38d76b95"><div class="ttname"><a href="hwcontext_8h.html#acf25724be4b066a51ad86aa9214b0d34af5dfa6181a3a6efb0f4a0c5f38d76b95">AV_HWDEVICE_TYPE_VAAPI</a></div><div class="ttdeci">@ AV_HWDEVICE_TYPE_VAAPI</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext_8h_source.html#l00031">hwcontext.h:31</a></div></div>
<div class="ttc" id="ahwcontext__vulkan_8c_html_ad6e72ce85a1f47714711415d1e336a04"><div class="ttname"><a href="hwcontext__vulkan_8c.html#ad6e72ce85a1f47714711415d1e336a04">add_buf_dep_exec_ctx</a></div><div class="ttdeci">static int add_buf_dep_exec_ctx(AVHWFramesContext *hwfc, VulkanExecCtx *cmd, AVBufferRef *const *deps, int nb_deps)</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l00878">hwcontext_vulkan.c:878</a></div></div>
<div class="ttc" id="ahwcontext__vulkan_8c_html_acd70049ecb5fd2af24dd63fa06cb69ec"><div class="ttname"><a href="hwcontext__vulkan_8c.html#acd70049ecb5fd2af24dd63fa06cb69ec">COPY_FEATURE</a></div><div class="ttdeci">#define COPY_FEATURE(DST, NAME)</div></div>
<div class="ttc" id="afilter__design_8txt_html_a669858250c93520fd944ba5d6eb1884d"><div class="ttname"><a href="filter__design_8txt.html#a669858250c93520fd944ba5d6eb1884d">layout</a></div><div class="ttdeci">Filter the word frame indicates either a video frame or a group of audio as stored in an AVFrame structure Format for each input and each output the list of supported formats For video that means pixel format For audio that means channel layout</div><div class="ttdef"><b>Definition:</b> <a href="filter__design_8txt_source.html#l00018">filter_design.txt:18</a></div></div>
<div class="ttc" id="astruct_vulkan_queue_ctx_html"><div class="ttname"><a href="struct_vulkan_queue_ctx.html">VulkanQueueCtx</a></div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l00044">hwcontext_vulkan.c:44</a></div></div>
<div class="ttc" id="astruct_vulkan_device_priv_html_aa95fb956d32713a16c1874fcaad18f2e"><div class="ttname"><a href="struct_vulkan_device_priv.html#aa95fb956d32713a16c1874fcaad18f2e">VulkanDevicePriv::debug_ctx</a></div><div class="ttdeci">VkDebugUtilsMessengerEXT debug_ctx</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l00074">hwcontext_vulkan.c:74</a></div></div>
<div class="ttc" id="ainput_8c_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="input_8c_source.html#l00407">input.c:407</a></div></div>
<div class="ttc" id="ahwcontext__vulkan_8c_html_adfa9f1974c8c5348db6b4034e3aa7b4ead055cca16ae2cf28b4e1ab34de136147"><div class="ttname"><a href="hwcontext__vulkan_8c.html#adfa9f1974c8c5348db6b4034e3aa7b4ead055cca16ae2cf28b4e1ab34de136147">EXT_EXTERNAL_DMABUF_MEMORY</a></div><div class="ttdeci">@ EXT_EXTERNAL_DMABUF_MEMORY</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l00208">hwcontext_vulkan.c:208</a></div></div>
<div class="ttc" id="astruct_vulkan_exec_ctx_html_ad467710035a59f14d1c6544cd60912e2"><div class="ttname"><a href="struct_vulkan_exec_ctx.html#ad467710035a59f14d1c6544cd60912e2">VulkanExecCtx::queues</a></div><div class="ttdeci">VulkanQueueCtx * queues</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l00058">hwcontext_vulkan.c:58</a></div></div>
<div class="ttc" id="astruct_a_v_d_r_m_object_descriptor_html_ab193fb14460d5a5f90578a80608e82ae"><div class="ttname"><a href="struct_a_v_d_r_m_object_descriptor.html#ab193fb14460d5a5f90578a80608e82ae">AVDRMObjectDescriptor::format_modifier</a></div><div class="ttdeci">uint64_t format_modifier</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__drm_8h_source.html#l00065">hwcontext_drm.h:65</a></div></div>
<div class="ttc" id="astruct_a_v_vk_frame_html_a0f5b937247d6cbbda0ac9ee3e8f1ac15"><div class="ttname"><a href="struct_a_v_vk_frame.html#a0f5b937247d6cbbda0ac9ee3e8f1ac15">AVVkFrame::size</a></div><div class="ttdeci">size_t size[AV_NUM_DATA_POINTERS]</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8h_source.html#l00165">hwcontext_vulkan.h:165</a></div></div>
<div class="ttc" id="astruct_a_v_vulkan_device_context_html_a371a0b0216b2e8a56cecbc1e496c04d5"><div class="ttname"><a href="struct_a_v_vulkan_device_context.html#a371a0b0216b2e8a56cecbc1e496c04d5">AVVulkanDeviceContext::nb_enabled_inst_extensions</a></div><div class="ttdeci">int nb_enabled_inst_extensions</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8h_source.html#l00089">hwcontext_vulkan.h:89</a></div></div>
<div class="ttc" id="astruct_vulkan_frames_priv_html"><div class="ttname"><a href="struct_vulkan_frames_priv.html">VulkanFramesPriv</a></div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l00086">hwcontext_vulkan.c:86</a></div></div>
<div class="ttc" id="astruct_image_buffer_html"><div class="ttname"><a href="struct_image_buffer.html">ImageBuffer</a></div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l02670">hwcontext_vulkan.c:2670</a></div></div>
<div class="ttc" id="astruct_a_v_h_w_device_context_html_a9c3758c73b0f29925ccb2f60b5c1a803"><div class="ttname"><a href="struct_a_v_h_w_device_context.html#a9c3758c73b0f29925ccb2f60b5c1a803">AVHWDeviceContext::internal</a></div><div class="ttdeci">AVHWDeviceInternal * internal</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext_8h_source.html#l00071">hwcontext.h:71</a></div></div>
<div class="ttc" id="ahwcontext__vulkan_8c_html_ac784a3797179e2482599f5565c8ed933"><div class="ttname"><a href="hwcontext__vulkan_8c.html#ac784a3797179e2482599f5565c8ed933">vulkan_transfer_data_to_mem</a></div><div class="ttdeci">static int vulkan_transfer_data_to_mem(AVHWFramesContext *hwfc, AVFrame *dst, const AVFrame *src)</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l03174">hwcontext_vulkan.c:3174</a></div></div>
<div class="ttc" id="astruct_vulkan_exec_ctx_html"><div class="ttname"><a href="struct_vulkan_exec_ctx.html">VulkanExecCtx</a></div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l00055">hwcontext_vulkan.c:55</a></div></div>
<div class="ttc" id="astruct_vulkan_mapping_html_a0686e69e55cc173855e141d69001b4c2"><div class="ttname"><a href="struct_vulkan_mapping.html#a0686e69e55cc173855e141d69001b4c2">VulkanMapping::flags</a></div><div class="ttdeci">int flags</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l01790">hwcontext_vulkan.c:1790</a></div></div>
<div class="ttc" id="astructplane__info_html"><div class="ttname"><a href="structplane__info.html">plane_info</a></div><div class="ttdef"><b>Definition:</b> <a href="vf__edgedetect_8c_source.html#l00051">vf_edgedetect.c:51</a></div></div>
<div class="ttc" id="ahwcontext__vulkan_8c_html_a22fadc076ea559115af8b3adde63b276"><div class="ttname"><a href="hwcontext__vulkan_8c.html#a22fadc076ea559115af8b3adde63b276">VulkanFramesPriv</a></div><div class="ttdeci">struct VulkanFramesPriv VulkanFramesPriv</div></div>
<div class="ttc" id="astruct_a_v_frame_html_a4a64d05cc676bfa8e18bf22d16c8a51f"><div class="ttname"><a href="struct_a_v_frame.html#a4a64d05cc676bfa8e18bf22d16c8a51f">AVFrame::buf</a></div><div class="ttdeci">AVBufferRef * buf[AV_NUM_DATA_POINTERS]</div><div class="ttdef"><b>Definition:</b> <a href="frame_8h_source.html#l00499">frame.h:499</a></div></div>
<div class="ttc" id="ahwcontext__vulkan_8c_html_a149c5f31e2b5aecf1c9fd2c2f5f159fa"><div class="ttname"><a href="hwcontext__vulkan_8c.html#a149c5f31e2b5aecf1c9fd2c2f5f159fa">vulkan_frames_init</a></div><div class="ttdeci">static int vulkan_frames_init(AVHWFramesContext *hwfc)</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l01696">hwcontext_vulkan.c:1696</a></div></div>
<div class="ttc" id="astruct_vulkan_opt_extension_html"><div class="ttname"><a href="struct_vulkan_opt_extension.html">VulkanOptExtension</a></div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l00217">hwcontext_vulkan.c:217</a></div></div>
<div class="ttc" id="ahwcontext__vulkan_8c_html_a4b19998e390caea2fbdeb64a7313de9f"><div class="ttname"><a href="hwcontext__vulkan_8c.html#a4b19998e390caea2fbdeb64a7313de9f">get_buf_exec_ctx</a></div><div class="ttdeci">static VkCommandBuffer get_buf_exec_ctx(AVHWFramesContext *hwfc, VulkanExecCtx *cmd)</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l00823">hwcontext_vulkan.c:823</a></div></div>
<div class="ttc" id="astruct_h_w_map_descriptor_html"><div class="ttname"><a href="struct_h_w_map_descriptor.html">HWMapDescriptor</a></div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__internal_8h_source.html#l00132">hwcontext_internal.h:132</a></div></div>
<div class="ttc" id="aaudio__convert_8c_html_ae1affc9ca37cfb624959c866a73f83c2"><div class="ttname"><a href="audio__convert_8c.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a></div><div class="ttdeci">uint8_t</div><div class="ttdef"><b>Definition:</b> <a href="audio__convert_8c_source.html#l00194">audio_convert.c:194</a></div></div>
<div class="ttc" id="ahwcontext__vulkan_8c_html_a2014da36c681525c5f5565596bdb4ad3"><div class="ttname"><a href="hwcontext__vulkan_8c.html#a2014da36c681525c5f5565596bdb4ad3">free_buf</a></div><div class="ttdeci">static void free_buf(void *opaque, uint8_t *data)</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l02677">hwcontext_vulkan.c:2677</a></div></div>
<div class="ttc" id="ahwcontext__drm_8h_html"><div class="ttname"><a href="hwcontext__drm_8h.html">hwcontext_drm.h</a></div></div>
<div class="ttc" id="astruct_vulkan_device_selection_html_aa98f77aebfa3ac887f58b9a781d27848"><div class="ttname"><a href="struct_vulkan_device_selection.html#aa98f77aebfa3ac887f58b9a781d27848">VulkanDeviceSelection::pci_device</a></div><div class="ttdeci">uint32_t pci_device</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l00504">hwcontext_vulkan.c:504</a></div></div>
<div class="ttc" id="apixfmt_8h_html_ab0749a06130381634569b1cb479cab79"><div class="ttname"><a href="pixfmt_8h.html#ab0749a06130381634569b1cb479cab79">AV_PIX_FMT_BGR565</a></div><div class="ttdeci">#define AV_PIX_FMT_BGR565</div><div class="ttdef"><b>Definition:</b> <a href="pixfmt_8h_source.html#l00391">pixfmt.h:391</a></div></div>
<div class="ttc" id="agroup__lavu__bufferpool_html_ga615151c8889d5be39d17bce4d8c65117"><div class="ttname"><a href="group__lavu__bufferpool.html#ga615151c8889d5be39d17bce4d8c65117">av_buffer_pool_init2</a></div><div class="ttdeci">AVBufferPool * av_buffer_pool_init2(int size, void *opaque, AVBufferRef *(*alloc)(void *opaque, int size), void(*pool_free)(void *opaque))</div><div class="ttdef"><b>Definition:</b> <a href="buffer_8c_source.html#l00245">buffer.c:245</a></div></div>
<div class="ttc" id="ahwcontext_8c_html_af42d5b3b23a1d521e6457276e2cd0a53"><div class="ttname"><a href="hwcontext_8c.html#af42d5b3b23a1d521e6457276e2cd0a53">ff_hwframe_map_replace</a></div><div class="ttdeci">int ff_hwframe_map_replace(AVFrame *dst, const AVFrame *src)</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext_8c_source.html#l00923">hwcontext.c:923</a></div></div>
<div class="ttc" id="astruct_vulkan_device_selection_html_a00c84ad57cd25ebf2384a055d6fc5959"><div class="ttname"><a href="struct_vulkan_device_selection.html#a00c84ad57cd25ebf2384a055d6fc5959">VulkanDeviceSelection::vendor_id</a></div><div class="ttdeci">uint32_t vendor_id</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l00505">hwcontext_vulkan.c:505</a></div></div>
<div class="ttc" id="ahwcontext__vulkan_8c_html_a9d87f944e7bd755011ce1a492d2d6754"><div class="ttname"><a href="hwcontext__vulkan_8c.html#a9d87f944e7bd755011ce1a492d2d6754">vk_dbg_callback</a></div><div class="ttdeci">static VkBool32 vk_dbg_callback(VkDebugUtilsMessageSeverityFlagBitsEXT severity, VkDebugUtilsMessageTypeFlagsEXT messageType, const VkDebugUtilsMessengerCallbackDataEXT *data, void *priv)</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l00275">hwcontext_vulkan.c:275</a></div></div>
<div class="ttc" id="ahwcontext__vulkan_8c_html_a201c5c9114b6443ce63a0e7662a4b36e"><div class="ttname"><a href="hwcontext__vulkan_8c.html#a201c5c9114b6443ce63a0e7662a4b36e">VulkanExecCtx</a></div><div class="ttdeci">struct VulkanExecCtx VulkanExecCtx</div></div>
<div class="ttc" id="avf__v360_8c_html_af712be1a84bfcf29a5914cde089b4047"><div class="ttname"><a href="vf__v360_8c.html#af712be1a84bfcf29a5914cde089b4047">mod</a></div><div class="ttdeci">static int mod(int a, int b)</div><div class="ttdef"><b>Definition:</b> <a href="vf__v360_8c_source.html#l00747">vf_v360.c:747</a></div></div>
<div class="ttc" id="apixfmt_8h_html_a6506505b35c1afd66c10cd537369cdd6"><div class="ttname"><a href="pixfmt_8h.html#a6506505b35c1afd66c10cd537369cdd6">AV_PIX_FMT_P016</a></div><div class="ttdeci">#define AV_PIX_FMT_P016</div><div class="ttdef"><b>Definition:</b> <a href="pixfmt_8h_source.html#l00449">pixfmt.h:449</a></div></div>
<div class="ttc" id="apixfmt_8h_html_ac006ecccd336ce7280ef0155568ebfb6"><div class="ttname"><a href="pixfmt_8h.html#ac006ecccd336ce7280ef0155568ebfb6">AV_PIX_FMT_RGB565</a></div><div class="ttdeci">#define AV_PIX_FMT_RGB565</div><div class="ttdef"><b>Definition:</b> <a href="pixfmt_8h_source.html#l00386">pixfmt.h:386</a></div></div>
<div class="ttc" id="ahwcontext__vulkan_8c_html_a5f0c7a8e1af12cc8bf2652dc30c219bd"><div class="ttname"><a href="hwcontext__vulkan_8c.html#a5f0c7a8e1af12cc8bf2652dc30c219bd">VulkanDevicePriv</a></div><div class="ttdeci">struct VulkanDevicePriv VulkanDevicePriv</div></div>
<div class="ttc" id="ahwcontext_8h_html_aba8d70ed754b2536ca497d7d50ec7b1e"><div class="ttname"><a href="hwcontext_8h.html#aba8d70ed754b2536ca497d7d50ec7b1e">AVHWFrameTransferDirection</a></div><div class="ttdeci">AVHWFrameTransferDirection</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext_8h_source.html#l00415">hwcontext.h:415</a></div></div>
<div class="ttc" id="ahwcontext__vulkan_8c_html_a459a21f7cefa1c26fb62002a20e251b7"><div class="ttname"><a href="hwcontext__vulkan_8c.html#a459a21f7cefa1c26fb62002a20e251b7">create_instance</a></div><div class="ttdeci">static int create_instance(AVHWDeviceContext *ctx, AVDictionary *opts)</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l00429">hwcontext_vulkan.c:429</a></div></div>
<div class="ttc" id="astruct_a_v_d_r_m_layer_descriptor_html_a7fbaf03f401c451e82021487fefef159"><div class="ttname"><a href="struct_a_v_d_r_m_layer_descriptor.html#a7fbaf03f401c451e82021487fefef159">AVDRMLayerDescriptor::planes</a></div><div class="ttdeci">AVDRMPlaneDescriptor planes[AV_DRM_MAX_PLANES]</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__drm_8h_source.html#l00110">hwcontext_drm.h:110</a></div></div>
<div class="ttc" id="ahwcontext__vaapi_8h_html"><div class="ttname"><a href="hwcontext__vaapi_8h.html">hwcontext_vaapi.h</a></div></div>
<div class="ttc" id="afilter__design_8txt_html_af1ec77bdca1b30e8153fc5da88f603db"><div class="ttname"><a href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a></div><div class="ttdeci">ret</div><div class="ttdef"><b>Definition:</b> <a href="filter__design_8txt_source.html#l00187">filter_design.txt:187</a></div></div>
<div class="ttc" id="apixfmt_8h_html_a9a8e335cf3be472042bc9f0cf80cd4c5a698dbf894ce405d3775c6cf440debf65"><div class="ttname"><a href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a698dbf894ce405d3775c6cf440debf65">AV_PIX_FMT_0BGR</a></div><div class="ttdeci">@ AV_PIX_FMT_0BGR</div><div class="ttdoc">packed BGR 8:8:8, 32bpp, XBGRXBGR... X=unused/undefined</div><div class="ttdef"><b>Definition:</b> <a href="pixfmt_8h_source.html#l00239">pixfmt.h:239</a></div></div>
<div class="ttc" id="apixfmt_8h_html_a9a8e335cf3be472042bc9f0cf80cd4c5a0b271df0acd125218c1e365a0f754022"><div class="ttname"><a href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a0b271df0acd125218c1e365a0f754022">AV_PIX_FMT_NV12</a></div><div class="ttdeci">@ AV_PIX_FMT_NV12</div><div class="ttdoc">planar YUV 4:2:0, 12bpp, 1 plane for Y and 1 plane for the UV components, which are interleaved (firs...</div><div class="ttdef"><b>Definition:</b> <a href="pixfmt_8h_source.html#l00089">pixfmt.h:89</a></div></div>
<div class="ttc" id="afilter__design_8txt_html_a48ad71a5b40cdd5f23c601f33665a953"><div class="ttname"><a href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a></div><div class="ttdeci">these buffered frames must be flushed immediately if a new input produces new the filter must not call request_frame to get more It must just process the frame or queue it The task of requesting more frames is left to the filter s request_frame method or the application If a filter has several the filter must be ready for frames arriving randomly on any input any filter with several inputs will most likely require some kind of queuing mechanism It is perfectly acceptable to have a limited queue and to drop frames when the inputs are too unbalanced request_frame For filters that do not use the this method is called when a frame is wanted on an output For a it should directly call filter_frame on the corresponding output For a if there are queued frames already one of these frames should be pushed If the filter should request a frame on one of its repeatedly until at least one frame has been pushed Return or at least make progress towards producing a frame</div><div class="ttdef"><b>Definition:</b> <a href="filter__design_8txt_source.html#l00264">filter_design.txt:264</a></div></div>
<div class="ttc" id="acuda__check_8h_html"><div class="ttname"><a href="cuda__check_8h.html">cuda_check.h</a></div></div>
<div class="ttc" id="ahwcontext__vulkan_8c_html_ae5894c7eff36f0e19741dab7f14964c8"><div class="ttname"><a href="hwcontext__vulkan_8c.html#ae5894c7eff36f0e19741dab7f14964c8">vulkan_get_buffer</a></div><div class="ttdeci">static int vulkan_get_buffer(AVHWFramesContext *hwfc, AVFrame *frame)</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l01759">hwcontext_vulkan.c:1759</a></div></div>
<div class="ttc" id="ahwcontext__vulkan_8c_html_a4c405e1f7bc1a8d840e1f39c9877e1a0"><div class="ttname"><a href="hwcontext__vulkan_8c.html#a4c405e1f7bc1a8d840e1f39c9877e1a0">unref_exec_ctx_deps</a></div><div class="ttdeci">static void unref_exec_ctx_deps(AVHWFramesContext *hwfc, VulkanExecCtx *cmd)</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l00828">hwcontext_vulkan.c:828</a></div></div>
<div class="ttc" id="astruct_vulkan_device_selection_html_a55e3a84ddb9faa07c308fc4d5acd8046"><div class="ttname"><a href="struct_vulkan_device_selection.html#a55e3a84ddb9faa07c308fc4d5acd8046">VulkanDeviceSelection::index</a></div><div class="ttdeci">int index</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l00506">hwcontext_vulkan.c:506</a></div></div>
<div class="ttc" id="astruct_image_buffer_html_a299da0e5749c00f1f2d00c4f28e4e279"><div class="ttname"><a href="struct_image_buffer.html#a299da0e5749c00f1f2d00c4f28e4e279">ImageBuffer::buf</a></div><div class="ttdeci">VkBuffer buf</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l02671">hwcontext_vulkan.c:2671</a></div></div>
<div class="ttc" id="agroup__lavu__mem__funcs_html_ga34e10fdac079a9ca4512b8ccd7f20b8a"><div class="ttname"><a href="group__lavu__mem__funcs.html#ga34e10fdac079a9ca4512b8ccd7f20b8a">size</a></div><div class="ttdeci">int size</div><div class="ttdef"><b>Definition:</b> <a href="twinvq__data_8h_source.html#l11134">twinvq_data.h:11134</a></div></div>
<div class="ttc" id="astruct_vulkan_device_priv_html_a1cdadbcb5d3249c2b7873dd538c18794"><div class="ttname"><a href="struct_vulkan_device_priv.html#a1cdadbcb5d3249c2b7873dd538c18794">VulkanDevicePriv::dev_is_nvidia</a></div><div class="ttdeci">int dev_is_nvidia</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l00083">hwcontext_vulkan.c:83</a></div></div>
<div class="ttc" id="asinewin__tablegen__template_8c_html_a3508a98d3ee7e2c9a4841fe264cf70f7"><div class="ttname"><a href="sinewin__tablegen__template_8c.html#a3508a98d3ee7e2c9a4841fe264cf70f7">FF_ARRAY_ELEMS</a></div><div class="ttdeci">#define FF_ARRAY_ELEMS(a)</div><div class="ttdef"><b>Definition:</b> <a href="sinewin__tablegen__template_8c_source.html#l00038">sinewin_tablegen_template.c:38</a></div></div>
<div class="ttc" id="ahwcontext__vulkan_8c_html_a9c616d5ef6c9cc6fd7d7fe30c4c13aaa"><div class="ttname"><a href="hwcontext__vulkan_8c.html#a9c616d5ef6c9cc6fd7d7fe30c4c13aaa">map_buffers</a></div><div class="ttdeci">static int map_buffers(AVHWDeviceContext *ctx, AVBufferRef **bufs, uint8_t *mem[], int nb_buffers, int invalidate)</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l02779">hwcontext_vulkan.c:2779</a></div></div>
<div class="ttc" id="astruct_h_w_context_type_html"><div class="ttname"><a href="struct_h_w_context_type.html">HWContextType</a></div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__internal_8h_source.html#l00029">hwcontext_internal.h:29</a></div></div>
<div class="ttc" id="ahwcontext__vulkan_8c_html_a8c2e24eefe7b3b9a36fb8c48b1a19f26"><div class="ttname"><a href="hwcontext__vulkan_8c.html#a8c2e24eefe7b3b9a36fb8c48b1a19f26">vulkan_device_create</a></div><div class="ttdeci">static int vulkan_device_create(AVHWDeviceContext *ctx, const char *device, AVDictionary *opts, int flags)</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l01122">hwcontext_vulkan.c:1122</a></div></div>
<div class="ttc" id="agroup__avoptions_html_gga06fc87d81c62e9abb8790b6e5713c55bab2e22cc927a3d88fe833b50bf3d71948"><div class="ttname"><a href="group__avoptions.html#gga06fc87d81c62e9abb8790b6e5713c55bab2e22cc927a3d88fe833b50bf3d71948">AV_HWFRAME_MAP_WRITE</a></div><div class="ttdeci">@ AV_HWFRAME_MAP_WRITE</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext_8h_source.html#l00528">hwcontext.h:528</a></div></div>
<div class="ttc" id="astruct_a_v_h_w_frames_context_html_ac9a7dbd0cbfcabc0b1529cb34cf53b6d"><div class="ttname"><a href="struct_a_v_h_w_frames_context.html#ac9a7dbd0cbfcabc0b1529cb34cf53b6d">AVHWFramesContext::device_ctx</a></div><div class="ttdeci">AVHWDeviceContext * device_ctx</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext_8h_source.html#l00149">hwcontext.h:149</a></div></div>
<div class="ttc" id="astruct_a_v_frame_html_a1d0f65014a8d1bf78cec8cbed2304992"><div class="ttname"><a href="struct_a_v_frame.html#a1d0f65014a8d1bf78cec8cbed2304992">AVFrame::data</a></div><div class="ttdeci">uint8_t * data[AV_NUM_DATA_POINTERS]</div><div class="ttdef"><b>Definition:</b> <a href="frame_8h_source.html#l00322">frame.h:322</a></div></div>
<div class="ttc" id="astruct_a_v_frame_html_aed14fa772ce46881020fd1545c86432c"><div class="ttname"><a href="struct_a_v_frame.html#aed14fa772ce46881020fd1545c86432c">AVFrame::format</a></div><div class="ttdeci">int format</div><div class="ttdef"><b>Definition:</b> <a href="frame_8h_source.html#l00381">frame.h:381</a></div></div>
<div class="ttc" id="astruct_a_v_vk_frame_html_aee75c3f6f575c5d9380cfcc4b1264338"><div class="ttname"><a href="struct_a_v_vk_frame.html#aee75c3f6f575c5d9380cfcc4b1264338">AVVkFrame::mem</a></div><div class="ttdeci">VkDeviceMemory mem[AV_NUM_DATA_POINTERS]</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8h_source.html#l00164">hwcontext_vulkan.h:164</a></div></div>
<div class="ttc" id="apixfmt_8h_html_a9a8e335cf3be472042bc9f0cf80cd4c5a0e08f8a5d0fa21c3e258816a9dcce7c3"><div class="ttname"><a href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a0e08f8a5d0fa21c3e258816a9dcce7c3">AV_PIX_FMT_NONE</a></div><div class="ttdeci">@ AV_PIX_FMT_NONE</div><div class="ttdef"><b>Definition:</b> <a href="pixfmt_8h_source.html#l00065">pixfmt.h:65</a></div></div>
<div class="ttc" id="amotion_8c_html_a7c1d654b7b6114d7a0abc8d351dd1bcd"><div class="ttname"><a href="motion_8c.html#a7c1d654b7b6114d7a0abc8d351dd1bcd">dummy</a></div><div class="ttdeci">int dummy</div><div class="ttdef"><b>Definition:</b> <a href="motion_8c_source.html#l00064">motion.c:64</a></div></div>
<div class="ttc" id="astruct_a_v_format_context_html_a8a8bec51da36db65ff864f88a85805d9"><div class="ttname"><a href="struct_a_v_format_context.html#a8a8bec51da36db65ff864f88a85805d9">AVFormatContext::internal</a></div><div class="ttdeci">AVFormatInternal * internal</div><div class="ttdef"><b>Definition:</b> <a href="avformat_8h_source.html#l01688">avformat.h:1688</a></div></div>
<div class="ttc" id="ahwcontext__vulkan_8c_html_ab4c32719f720cf93422ef9685183c0f4"><div class="ttname"><a href="hwcontext__vulkan_8c.html#ab4c32719f720cf93422ef9685183c0f4">vulkan_pool_alloc</a></div><div class="ttdeci">static AVBufferRef * vulkan_pool_alloc(void *opaque, int size)</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l01631">hwcontext_vulkan.c:1631</a></div></div>
<div class="ttc" id="agroup__lavu__ver_html_gad5484c7f1208de134ba538874d2c04fd"><div class="ttname"><a href="group__lavu__ver.html#gad5484c7f1208de134ba538874d2c04fd">LIBAVUTIL_VERSION_MICRO</a></div><div class="ttdeci">#define LIBAVUTIL_VERSION_MICRO</div><div class="ttdef"><b>Definition:</b> <a href="libavutil_2version_8h_source.html#l00083">version.h:83</a></div></div>
<div class="ttc" id="astruct_a_v_vulkan_device_context_html_a1ae83abcaab148c5ad0278cacf26834e"><div class="ttname"><a href="struct_a_v_vulkan_device_context.html#a1ae83abcaab148c5ad0278cacf26834e">AVVulkanDeviceContext::queue_family_index</a></div><div class="ttdeci">int queue_family_index</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8h_source.html#l00064">hwcontext_vulkan.h:64</a></div></div>
<div class="ttc" id="ahwcontext__vulkan_8c_html_a57b768eebd26861b5e548b6b230d9f30"><div class="ttname"><a href="hwcontext__vulkan_8c.html#a57b768eebd26861b5e548b6b230d9f30">find_device</a></div><div class="ttdeci">static int find_device(AVHWDeviceContext *ctx, VulkanDeviceSelection *select)</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l00521">hwcontext_vulkan.c:521</a></div></div>
<div class="ttc" id="astruct_a_v_h_w_frames_constraints_html_af5d3a683727f7b92abca7b7114d4e15c"><div class="ttname"><a href="struct_a_v_h_w_frames_constraints.html#af5d3a683727f7b92abca7b7114d4e15c">AVHWFramesConstraints::max_height</a></div><div class="ttdeci">int max_height</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext_8h_source.html#l00479">hwcontext.h:479</a></div></div>
<div class="ttc" id="atests_2jpeg2000dwt_8c_html_a5cabdd8be5af41f675fed06498e094b7"><div class="ttname"><a href="tests_2jpeg2000dwt_8c.html#a5cabdd8be5af41f675fed06498e094b7">ref</a></div><div class="ttdeci">static int ref[MAX_W *MAX_W]</div><div class="ttdef"><b>Definition:</b> <a href="tests_2jpeg2000dwt_8c_source.html#l00107">jpeg2000dwt.c:107</a></div></div>
<div class="ttc" id="astruct_a_v_c_u_d_a_device_context_internal_html"><div class="ttname"><a href="struct_a_v_c_u_d_a_device_context_internal.html">AVCUDADeviceContextInternal</a></div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__cuda__internal_8h_source.html#l00031">hwcontext_cuda_internal.h:31</a></div></div>
<div class="ttc" id="ahwcontext__vulkan_8c_html_ad8f648073ec78aa454bb9892fdaba8fa"><div class="ttname"><a href="hwcontext__vulkan_8c.html#ad8f648073ec78aa454bb9892fdaba8fa">optional_instance_exts</a></div><div class="ttdeci">static const VulkanOptExtension optional_instance_exts[]</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l00222">hwcontext_vulkan.c:222</a></div></div>
<div class="ttc" id="ahwcontext__vulkan_8h_html_a6448d0c2e54d03f629609253208b872c"><div class="ttname"><a href="hwcontext__vulkan_8h.html#a6448d0c2e54d03f629609253208b872c">AVVulkanFramesContext</a></div><div class="ttdeci">struct AVVulkanFramesContext AVVulkanFramesContext</div></div>
<div class="ttc" id="agroup__lavu__buffer_html_gaa40ce7d3ede946a89d03323bbd7268c1"><div class="ttname"><a href="group__lavu__buffer.html#gaa40ce7d3ede946a89d03323bbd7268c1">av_buffer_ref</a></div><div class="ttdeci">AVBufferRef * av_buffer_ref(AVBufferRef *buf)</div><div class="ttdef"><b>Definition:</b> <a href="buffer_8c_source.html#l00093">buffer.c:93</a></div></div>
<div class="ttc" id="apixfmt_8h_html_a9a8e335cf3be472042bc9f0cf80cd4c5a82034006e681cddbb7b1d5cb7045626a"><div class="ttname"><a href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a82034006e681cddbb7b1d5cb7045626a">AV_PIX_FMT_YUV444P</a></div><div class="ttdeci">@ AV_PIX_FMT_YUV444P</div><div class="ttdoc">planar YUV 4:4:4, 24bpp, (1 Cr &amp; Cb sample per 1x1 Y samples)</div><div class="ttdef"><b>Definition:</b> <a href="pixfmt_8h_source.html#l00071">pixfmt.h:71</a></div></div>
<div class="ttc" id="astruct_vulkan_queue_ctx_html_ab75c31fe085f99dc7193f8c7674ea69b"><div class="ttname"><a href="struct_vulkan_queue_ctx.html#ab75c31fe085f99dc7193f8c7674ea69b">VulkanQueueCtx::was_synchronous</a></div><div class="ttdeci">int was_synchronous</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l00047">hwcontext_vulkan.c:47</a></div></div>
<div class="ttc" id="apixfmt_8h_html_a6265531cbe491ec34449e3769e545f1f"><div class="ttname"><a href="pixfmt_8h.html#a6265531cbe491ec34449e3769e545f1f">AV_PIX_FMT_P010</a></div><div class="ttdeci">#define AV_PIX_FMT_P010</div><div class="ttdef"><b>Definition:</b> <a href="pixfmt_8h_source.html#l00448">pixfmt.h:448</a></div></div>
<div class="ttc" id="astruct_a_v_vulkan_device_context_html_a154f2a1f99a153cdb9a801b2504d6637"><div class="ttname"><a href="struct_a_v_vulkan_device_context.html#a154f2a1f99a153cdb9a801b2504d6637">AVVulkanDeviceContext::phys_dev</a></div><div class="ttdeci">VkPhysicalDevice phys_dev</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8h_source.html#l00051">hwcontext_vulkan.h:51</a></div></div>
<div class="ttc" id="agroup__lavu__mem__funcs_html_ga7c352f4cff02184f005323691375fea9"><div class="ttname"><a href="group__lavu__mem__funcs.html#ga7c352f4cff02184f005323691375fea9">av_strdup</a></div><div class="ttdeci">char * av_strdup(const char *s)</div><div class="ttdef"><b>Definition:</b> <a href="mem_8c_source.html#l00253">mem.c:253</a></div></div>
<div class="ttc" id="alibsvtav1_8c_html_a710bce51374aba96ab04912897666c35"><div class="ttname"><a href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a></div><div class="ttdeci">const char * desc</div><div class="ttdef"><b>Definition:</b> <a href="libsvtav1_8c_source.html#l00079">libsvtav1.c:79</a></div></div>
<div class="ttc" id="apixfmt_8h_html_a9a8e335cf3be472042bc9f0cf80cd4c5a332444d991855c9667b786f6f7bb6051"><div class="ttname"><a href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a332444d991855c9667b786f6f7bb6051">AV_PIX_FMT_YUV422P</a></div><div class="ttdeci">@ AV_PIX_FMT_YUV422P</div><div class="ttdoc">planar YUV 4:2:2, 16bpp, (1 Cr &amp; Cb sample per 2x1 Y samples)</div><div class="ttdef"><b>Definition:</b> <a href="pixfmt_8h_source.html#l00070">pixfmt.h:70</a></div></div>
<div class="ttc" id="astruct_a_v_d_r_m_frame_descriptor_html_a5a11bc1854bb6cee2f5b0f9d514d0c4f"><div class="ttname"><a href="struct_a_v_d_r_m_frame_descriptor.html#a5a11bc1854bb6cee2f5b0f9d514d0c4f">AVDRMFrameDescriptor::nb_objects</a></div><div class="ttdeci">int nb_objects</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__drm_8h_source.html#l00137">hwcontext_drm.h:137</a></div></div>
<div class="ttc" id="ahwcontext__internal_8h_html"><div class="ttname"><a href="hwcontext__internal_8h.html">hwcontext_internal.h</a></div></div>
<div class="ttc" id="ahwcontext__vdpau_8c_html_a2996cc16b36e13c9010705bad768e866"><div class="ttname"><a href="hwcontext__vdpau_8c.html#a2996cc16b36e13c9010705bad768e866">map</a></div><div class="ttdeci">const VDPAUPixFmtMap * map</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vdpau_8c_source.html#l00071">hwcontext_vdpau.c:71</a></div></div>
<div class="ttc" id="astruct_a_v_vulkan_frames_context_html_a18537e64f52d484a81bfb258cbfe39be"><div class="ttname"><a href="struct_a_v_vulkan_frames_context.html#a18537e64f52d484a81bfb258cbfe39be">AVVulkanFramesContext::create_pnext</a></div><div class="ttdeci">void * create_pnext</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8h_source.html#l00125">hwcontext_vulkan.h:125</a></div></div>
<div class="ttc" id="atableprint__vlc_8h_html_a079eab092887563f2bef9106c6120089"><div class="ttname"><a href="tableprint__vlc_8h.html#a079eab092887563f2bef9106c6120089">av_free</a></div><div class="ttdeci">#define av_free(p)</div><div class="ttdef"><b>Definition:</b> <a href="tableprint__vlc_8h_source.html#l00034">tableprint_vlc.h:34</a></div></div>
<div class="ttc" id="ahwcontext__vulkan_8c_html_af94790aab5b000aa1b44ce817563076faa880fb96e7667415366a5b8ac8525090"><div class="ttname"><a href="hwcontext__vulkan_8c.html#af94790aab5b000aa1b44ce817563076faa880fb96e7667415366a5b8ac8525090">PREP_MODE_EXTERNAL_EXPORT</a></div><div class="ttdeci">@ PREP_MODE_EXTERNAL_EXPORT</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l01426">hwcontext_vulkan.c:1426</a></div></div>
<div class="ttc" id="amacros_8h_html_acae4ba605b3a7d535b7ac058ffe96892"><div class="ttname"><a href="macros_8h.html#acae4ba605b3a7d535b7ac058ffe96892">FFALIGN</a></div><div class="ttdeci">#define FFALIGN(x, a)</div><div class="ttdef"><b>Definition:</b> <a href="macros_8h_source.html#l00048">macros.h:48</a></div></div>
<div class="ttc" id="atableprint__vlc_8h_html_adba82e1bcd02de510a858fcbedf79ef1"><div class="ttname"><a href="tableprint__vlc_8h.html#adba82e1bcd02de510a858fcbedf79ef1">av_freep</a></div><div class="ttdeci">#define av_freep(p)</div><div class="ttdef"><b>Definition:</b> <a href="tableprint__vlc_8h_source.html#l00035">tableprint_vlc.h:35</a></div></div>
<div class="ttc" id="astruct_vulkan_exec_ctx_html_acee0bf4f2264075d3eeefedc29c58b53"><div class="ttname"><a href="struct_vulkan_exec_ctx.html#acee0bf4f2264075d3eeefedc29c58b53">VulkanExecCtx::bufs</a></div><div class="ttdeci">VkCommandBuffer * bufs</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l00057">hwcontext_vulkan.c:57</a></div></div>
<div class="ttc" id="ahwcontext__vulkan_8c_html_a2921e76e6b12d6926b08c25bd2803ced"><div class="ttname"><a href="hwcontext__vulkan_8c.html#a2921e76e6b12d6926b08c25bd2803ced">CHECK_QUEUE</a></div><div class="ttdeci">#define CHECK_QUEUE(type, n)</div></div>
<div class="ttc" id="ahwcontext__vulkan_8c_html_a632fcea203c8b3b46846667ebb33d304"><div class="ttname"><a href="hwcontext__vulkan_8c.html#a632fcea203c8b3b46846667ebb33d304">vulkan_device_create_internal</a></div><div class="ttdeci">static int vulkan_device_create_internal(AVHWDeviceContext *ctx, VulkanDeviceSelection *dev_select, AVDictionary *opts, int flags)</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l00969">hwcontext_vulkan.c:969</a></div></div>
<div class="ttc" id="ahwcontext__vulkan_8c_html_ab53825bc22709ed0fa2dde67ad0e7ffe"><div class="ttname"><a href="hwcontext__vulkan_8c.html#ab53825bc22709ed0fa2dde67ad0e7ffe">vk_dev_type</a></div><div class="ttdeci">static const char * vk_dev_type(enum VkPhysicalDeviceType type)</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l00509">hwcontext_vulkan.c:509</a></div></div>
<div class="ttc" id="astruct_a_v_d_r_m_frame_descriptor_html_ad19d258e1771ef833d7e3bd873b91906"><div class="ttname"><a href="struct_a_v_d_r_m_frame_descriptor.html#ad19d258e1771ef833d7e3bd873b91906">AVDRMFrameDescriptor::layers</a></div><div class="ttdeci">AVDRMLayerDescriptor layers[AV_DRM_MAX_PLANES]</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__drm_8h_source.html#l00149">hwcontext_drm.h:149</a></div></div>
<div class="ttc" id="astruct_a_v_h_w_frames_context_html_ad67ff3a5828a611d1b1cddd64fc1de71"><div class="ttname"><a href="struct_a_v_h_w_frames_context.html#ad67ff3a5828a611d1b1cddd64fc1de71">AVHWFramesContext::pool</a></div><div class="ttdeci">AVBufferPool * pool</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext_8h_source.html#l00190">hwcontext.h:190</a></div></div>
<div class="ttc" id="aimgutils_8h_html"><div class="ttname"><a href="imgutils_8h.html">imgutils.h</a></div></div>
<div class="ttc" id="acbs__av1_8c_html_a67119bce106892b6dade1dc5aa405ac9"><div class="ttname"><a href="cbs__av1_8c.html#a67119bce106892b6dade1dc5aa405ac9">flags</a></div><div class="ttdeci">#define flags(name, subs,...)</div><div class="ttdef"><b>Definition:</b> <a href="cbs__av1_8c_source.html#l00560">cbs_av1.c:560</a></div></div>
<div class="ttc" id="ahwcontext_8h_html"><div class="ttname"><a href="hwcontext_8h.html">hwcontext.h</a></div></div>
<div class="ttc" id="astruct_a_v_vulkan_device_context_html_adac78554fd3d354a93df1abd7943953a"><div class="ttname"><a href="struct_a_v_vulkan_device_context.html#adac78554fd3d354a93df1abd7943953a">AVVulkanDeviceContext::nb_tx_queues</a></div><div class="ttdeci">int nb_tx_queues</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8h_source.html#l00073">hwcontext_vulkan.h:73</a></div></div>
<div class="ttc" id="astruct_a_v_d_r_m_device_context_html_a22790a8cbf5681bbdee76a6bc99f02f5"><div class="ttname"><a href="struct_a_v_d_r_m_device_context.html#a22790a8cbf5681bbdee76a6bc99f02f5">AVDRMDeviceContext::fd</a></div><div class="ttdeci">int fd</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__drm_8h_source.html#l00166">hwcontext_drm.h:166</a></div></div>
<div class="ttc" id="atableprint__vlc_8h_html_af38b91523053c244564a94f1ef862c2c"><div class="ttname"><a href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a></div><div class="ttdeci">#define av_log(a,...)</div><div class="ttdef"><b>Definition:</b> <a href="tableprint__vlc_8h_source.html#l00028">tableprint_vlc.h:28</a></div></div>
<div class="ttc" id="astruct_a_v_vulkan_device_context_html_ab612ea6b23014d1c38fc99793595f7aa"><div class="ttname"><a href="struct_a_v_vulkan_device_context.html#ab612ea6b23014d1c38fc99793595f7aa">AVVulkanDeviceContext::nb_comp_queues</a></div><div class="ttdeci">int nb_comp_queues</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8h_source.html#l00080">hwcontext_vulkan.h:80</a></div></div>
<div class="ttc" id="ahwcontext__vulkan_8c_html_ac5a7d789e9a765a8575799d50a0f39e4"><div class="ttname"><a href="hwcontext__vulkan_8c.html#ac5a7d789e9a765a8575799d50a0f39e4">AVVkFrameInternal</a></div><div class="ttdeci">struct AVVkFrameInternal AVVkFrameInternal</div></div>
<div class="ttc" id="astruct_a_v_vulkan_device_context_html_ac40732ea5eeffe1b231d21d9df10e658"><div class="ttname"><a href="struct_a_v_vulkan_device_context.html#ac40732ea5eeffe1b231d21d9df10e658">AVVulkanDeviceContext::nb_enabled_dev_extensions</a></div><div class="ttdeci">int nb_enabled_dev_extensions</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8h_source.html#l00099">hwcontext_vulkan.h:99</a></div></div>
<div class="ttc" id="ahwcontext__vulkan_8c_html_a3d954a40a07e0386b08db15860a0d4fc"><div class="ttname"><a href="hwcontext__vulkan_8c.html#a3d954a40a07e0386b08db15860a0d4fc">VulkanDeviceSelection</a></div><div class="ttdeci">struct VulkanDeviceSelection VulkanDeviceSelection</div></div>
<div class="ttc" id="avp9dsp__template_8c_html_a5e36941b3d856737e81516acd45edc50"><div class="ttname"><a href="vp9dsp__template_8c.html#a5e36941b3d856737e81516acd45edc50">h</a></div><div class="ttdeci">h</div><div class="ttdef"><b>Definition:</b> <a href="vp9dsp__template_8c_source.html#l02038">vp9dsp_template.c:2038</a></div></div>
<div class="ttc" id="ahwcontext__vulkan_8c_html_ab482f514ab017799e2ac45d666537564"><div class="ttname"><a href="hwcontext__vulkan_8c.html#ab482f514ab017799e2ac45d666537564">pixfmt</a></div><div class="ttdeci">enum AVPixelFormat pixfmt</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l00092">hwcontext_vulkan.c:140</a></div></div>
<div class="ttc" id="astruct_vulkan_device_priv_html_a93919fc0c25c1a74251fc14bccc70188"><div class="ttname"><a href="struct_vulkan_device_priv.html#a93919fc0c25c1a74251fc14bccc70188">VulkanDevicePriv::props</a></div><div class="ttdeci">VkPhysicalDeviceProperties2 props</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l00065">hwcontext_vulkan.c:65</a></div></div>
<div class="ttc" id="astruct_a_v_vulkan_device_context_html_a4a617020274526c26e265781aefcd22c"><div class="ttname"><a href="struct_a_v_vulkan_device_context.html#a4a617020274526c26e265781aefcd22c">AVVulkanDeviceContext::alloc</a></div><div class="ttdeci">const VkAllocationCallbacks * alloc</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8h_source.html#l00043">hwcontext_vulkan.h:43</a></div></div>
<div class="ttc" id="astruct_vulkan_queue_ctx_html_a65ce96bd602e35abbdc0e69677e23fd3"><div class="ttname"><a href="struct_vulkan_queue_ctx.html#a65ce96bd602e35abbdc0e69677e23fd3">VulkanQueueCtx::nb_buf_deps</a></div><div class="ttdeci">int nb_buf_deps</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l00051">hwcontext_vulkan.c:51</a></div></div>
<div class="ttc" id="astruct_vulkan_exec_ctx_html_a83f8db5f77669ac659bb6569bb4eef4f"><div class="ttname"><a href="struct_vulkan_exec_ctx.html#a83f8db5f77669ac659bb6569bb4eef4f">VulkanExecCtx::pool</a></div><div class="ttdeci">VkCommandPool pool</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l00056">hwcontext_vulkan.c:56</a></div></div>
<div class="ttc" id="aavstring_8h_html"><div class="ttname"><a href="avstring_8h.html">avstring.h</a></div></div>
<div class="ttc" id="astruct_a_v_h_w_frames_context_html_a663a9aceca97aa7b2426c9aba6543e4a"><div class="ttname"><a href="struct_a_v_h_w_frames_context.html#a663a9aceca97aa7b2426c9aba6543e4a">AVHWFramesContext::sw_format</a></div><div class="ttdeci">enum AVPixelFormat sw_format</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext_8h_source.html#l00199">hwcontext.h:222</a></div></div>
<div class="ttc" id="astruct_vulkan_mapping_html_aef5c0d75c498aebde60d07f9c3caa732"><div class="ttname"><a href="struct_vulkan_mapping.html#aef5c0d75c498aebde60d07f9c3caa732">VulkanMapping::frame</a></div><div class="ttdeci">AVVkFrame * frame</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l01789">hwcontext_vulkan.c:1789</a></div></div>
<div class="ttc" id="astruct_a_v_d_r_m_object_descriptor_html_a3732e73e288f10965cae373c70e8402e"><div class="ttname"><a href="struct_a_v_d_r_m_object_descriptor.html#a3732e73e288f10965cae373c70e8402e">AVDRMObjectDescriptor::fd</a></div><div class="ttdeci">int fd</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__drm_8h_source.html#l00052">hwcontext_drm.h:52</a></div></div>
<div class="ttc" id="astruct_a_v_frame_html"><div class="ttname"><a href="struct_a_v_frame.html">AVFrame</a></div><div class="ttdef"><b>Definition:</b> <a href="frame_8h_source.html#l00308">frame.h:308</a></div></div>
<div class="ttc" id="ahwcontext__vulkan_8c_html_a5bee6da8a9536d7e905a366ca49b0abb"><div class="ttname"><a href="hwcontext__vulkan_8c.html#a5bee6da8a9536d7e905a366ca49b0abb">ADD_VAL_TO_LIST</a></div><div class="ttdeci">#define ADD_VAL_TO_LIST(list, count, val)</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l00125">hwcontext_vulkan.c:125</a></div></div>
<div class="ttc" id="astruct_a_v_vk_frame_internal_html"><div class="ttname"><a href="struct_a_v_vk_frame_internal.html">AVVkFrameInternal</a></div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l00095">hwcontext_vulkan.c:95</a></div></div>
<div class="ttc" id="astruct_vulkan_frames_priv_html_a9756b08f0899fa9fcd16ee9a57061875"><div class="ttname"><a href="struct_vulkan_frames_priv.html#a9756b08f0899fa9fcd16ee9a57061875">VulkanFramesPriv::upload_ctx</a></div><div class="ttdeci">VulkanExecCtx upload_ctx</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l00091">hwcontext_vulkan.c:91</a></div></div>
<div class="ttc" id="astruct_vulkan_device_priv_html_a456ab09798ca379b6534a172a9245dba"><div class="ttname"><a href="struct_vulkan_device_priv.html#a456ab09798ca379b6534a172a9245dba">VulkanDevicePriv::use_linear_images</a></div><div class="ttdeci">int use_linear_images</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8c_source.html#l00080">hwcontext_vulkan.c:80</a></div></div>
<div class="ttc" id="astruct_a_v_vulkan_device_context_html_a38e84a1e98b06831031e7abb915f4190"><div class="ttname"><a href="struct_a_v_vulkan_device_context.html#a38e84a1e98b06831031e7abb915f4190">AVVulkanDeviceContext::enabled_dev_extensions</a></div><div class="ttdeci">const char *const  * enabled_dev_extensions</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8h_source.html#l00098">hwcontext_vulkan.h:98</a></div></div>
<div class="ttc" id="astruct_a_v_vulkan_device_context_html_a53a07d4474261e4e14ec03c5d15f71da"><div class="ttname"><a href="struct_a_v_vulkan_device_context.html#a53a07d4474261e4e14ec03c5d15f71da">AVVulkanDeviceContext::act_dev</a></div><div class="ttdeci">VkDevice act_dev</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vulkan_8h_source.html#l00055">hwcontext_vulkan.h:55</a></div></div>
<div class="ttc" id="ahwcontext_8h_html_acf25724be4b066a51ad86aa9214b0d34aa04ac36fb964a5c191566a8e809de743"><div class="ttname"><a href="hwcontext_8h.html#acf25724be4b066a51ad86aa9214b0d34aa04ac36fb964a5c191566a8e809de743">AV_HWDEVICE_TYPE_DRM</a></div><div class="ttdeci">@ AV_HWDEVICE_TYPE_DRM</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext_8h_source.html#l00036">hwcontext.h:36</a></div></div>
<div class="ttc" id="apixdesc_8c_html_ab92e2a8a9b58c982560c49df9f01e47e"><div class="ttname"><a href="pixdesc_8c.html#ab92e2a8a9b58c982560c49df9f01e47e">av_get_pix_fmt_name</a></div><div class="ttdeci">const char * av_get_pix_fmt_name(enum AVPixelFormat pix_fmt)</div><div class="ttdef"><b>Definition:</b> <a href="pixdesc_8c_source.html#l02489">pixdesc.c:2489</a></div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.8.20
</small></address>
</body>
</html>
