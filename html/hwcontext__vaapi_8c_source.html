<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>My Project: E:/github/ffmpeg/libavutil/hwcontext_vaapi.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">My Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_737c44b861ba7ee498141742fb455fa8.html">ffmpeg</a></li><li class="navelem"><a class="el" href="dir_d766145af7397866e2c8608f9b7b90ce.html">libavutil</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">hwcontext_vaapi.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="hwcontext__vaapi_8c.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> * This file is part of FFmpeg.</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> * FFmpeg is free software; you can redistribute it and/or</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> * modify it under the terms of the GNU Lesser General Public</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> * License as published by the Free Software Foundation; either</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> * version 2.1 of the License, or (at your option) any later version.</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> * FFmpeg is distributed in the hope that it will be useful,</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> * Lesser General Public License for more details.</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"> * You should have received a copy of the GNU Lesser General Public</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"> * License along with FFmpeg; if not, write to the Free Software</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"> * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160; </div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#include &quot;config.h&quot;</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160; </div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#if HAVE_VAAPI_X11</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#   include &lt;va/va_x11.h&gt;</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor">#if HAVE_VAAPI_DRM</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#   include &lt;va/va_drm.h&gt;</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160; </div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#if CONFIG_LIBDRM</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#   include &lt;va/va_drmcommon.h&gt;</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#   include &lt;xf86drm.h&gt;</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor">#   include &lt;drm_fourcc.h&gt;</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#   ifndef DRM_FORMAT_MOD_INVALID</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor">#       define DRM_FORMAT_MOD_INVALID ((1ULL &lt;&lt; 56) - 1)</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="preprocessor">#   endif</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160; </div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="preprocessor">#include &lt;fcntl.h&gt;</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="preprocessor">#if HAVE_UNISTD_H</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="preprocessor">#   include &lt;unistd.h&gt;</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160; </div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160; </div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="avassert_8h.html">avassert.h</a>&quot;</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="buffer_8h.html">buffer.h</a>&quot;</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="common_8h.html">common.h</a>&quot;</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="hwcontext_8h.html">hwcontext.h</a>&quot;</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="hwcontext__drm_8h.html">hwcontext_drm.h</a>&quot;</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="hwcontext__internal_8h.html">hwcontext_internal.h</a>&quot;</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="hwcontext__vaapi_8h.html">hwcontext_vaapi.h</a>&quot;</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="mem_8h.html">mem.h</a>&quot;</span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="pixdesc_8h.html">pixdesc.h</a>&quot;</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="pixfmt_8h.html">pixfmt.h</a>&quot;</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160; </div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160; </div>
<div class="line"><a name="l00055"></a><span class="lineno"><a class="line" href="struct_v_a_a_p_i_device_priv.html">   55</a></span>&#160;<span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="struct_v_a_a_p_i_device_priv.html">VAAPIDevicePriv</a> {</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="preprocessor">#if HAVE_VAAPI_X11</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    Display *x11_display;</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160; </div>
<div class="line"><a name="l00060"></a><span class="lineno"><a class="line" href="struct_v_a_a_p_i_surface_format.html#ace4d04542428395359cca3d223db93d8">   60</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="struct_v_a_a_p_i_device_priv.html#aa0d7b3aa4d16e26802900a5c7c155f4b">drm_fd</a>;</div>
<div class="line"><a name="l00061"></a><span class="lineno"><a class="line" href="hwcontext__vaapi_8c.html#a39a29b36d1b1e01385fb02e389ed4381">   61</a></span>&#160;} <a class="code" href="hwcontext__vaapi_8c.html#a39a29b36d1b1e01385fb02e389ed4381">VAAPIDevicePriv</a>;</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160; </div>
<div class="line"><a name="l00063"></a><span class="lineno"><a class="line" href="struct_v_a_a_p_i_surface_format.html">   63</a></span>&#160;<span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="struct_v_a_a_p_i_surface_format.html">VAAPISurfaceFormat</a> {</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    <span class="keyword">enum</span> <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5">AVPixelFormat</a> <a class="code" href="struct_v_a_a_p_i_surface_format.html#ace4d04542428395359cca3d223db93d8">pix_fmt</a>;</div>
<div class="line"><a name="l00065"></a><span class="lineno"><a class="line" href="struct_v_a_a_p_i_surface_format.html#a7c3c72000f8dfcb6bff982554b4b72d3">   65</a></span>&#160;    VAImageFormat <a class="code" href="struct_v_a_a_p_i_surface_format.html#a7c3c72000f8dfcb6bff982554b4b72d3">image_format</a>;</div>
<div class="line"><a name="l00066"></a><span class="lineno"><a class="line" href="hwcontext__vaapi_8c.html#a6f2f4321538486f44071685acc834d27">   66</a></span>&#160;} <a class="code" href="hwcontext__vaapi_8c.html#a6f2f4321538486f44071685acc834d27">VAAPISurfaceFormat</a>;</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160; </div>
<div class="line"><a name="l00068"></a><span class="lineno"><a class="line" href="struct_v_a_a_p_i_device_context.html">   68</a></span>&#160;<span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="struct_v_a_a_p_i_device_context.html">VAAPIDeviceContext</a> {</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <span class="comment">// Surface formats which can be used with this device.</span></div>
<div class="line"><a name="l00070"></a><span class="lineno"><a class="line" href="struct_v_a_a_p_i_device_context.html#a8fb5e8fa4388fbac00599532e1035651">   70</a></span>&#160;    <a class="code" href="struct_v_a_a_p_i_surface_format.html">VAAPISurfaceFormat</a> *<a class="code" href="struct_v_a_a_p_i_device_context.html#a8fb5e8fa4388fbac00599532e1035651">formats</a>;</div>
<div class="line"><a name="l00071"></a><span class="lineno"><a class="line" href="struct_v_a_a_p_i_device_context.html#a140b32d01481bfdd777005af34ea7500">   71</a></span>&#160;    <span class="keywordtype">int</span>              <a class="code" href="struct_v_a_a_p_i_device_context.html#a140b32d01481bfdd777005af34ea7500">nb_formats</a>;</div>
<div class="line"><a name="l00072"></a><span class="lineno"><a class="line" href="hwcontext__vaapi_8c.html#a93d9371e12b4d4aaf9b825248b87740d">   72</a></span>&#160;} <a class="code" href="hwcontext__vaapi_8c.html#a93d9371e12b4d4aaf9b825248b87740d">VAAPIDeviceContext</a>;</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160; </div>
<div class="line"><a name="l00074"></a><span class="lineno"><a class="line" href="struct_v_a_a_p_i_frames_context.html">   74</a></span>&#160;<span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="struct_v_a_a_p_i_frames_context.html">VAAPIFramesContext</a> {</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    <span class="comment">// Surface attributes set at create time.</span></div>
<div class="line"><a name="l00076"></a><span class="lineno"><a class="line" href="struct_v_a_a_p_i_frames_context.html#a85819fdf67f42ea8e5bc159d8dbe2acd">   76</a></span>&#160;    VASurfaceAttrib *<a class="code" href="struct_v_a_a_p_i_frames_context.html#a85819fdf67f42ea8e5bc159d8dbe2acd">attributes</a>;</div>
<div class="line"><a name="l00077"></a><span class="lineno"><a class="line" href="struct_v_a_a_p_i_frames_context.html#af40b63e6d6e79a03d1cfff5ade12c7c4">   77</a></span>&#160;    <span class="keywordtype">int</span>           <a class="code" href="struct_v_a_a_p_i_frames_context.html#af40b63e6d6e79a03d1cfff5ade12c7c4">nb_attributes</a>;</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <span class="comment">// RT format of the underlying surface (Intel driver ignores this anyway).</span></div>
<div class="line"><a name="l00079"></a><span class="lineno"><a class="line" href="struct_v_a_a_p_i_frames_context.html#a9110b00b4870e9650dea4ee1d6281b2d">   79</a></span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="struct_v_a_a_p_i_frames_context.html#a9110b00b4870e9650dea4ee1d6281b2d">rt_format</a>;</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    <span class="comment">// Whether vaDeriveImage works.</span></div>
<div class="line"><a name="l00081"></a><span class="lineno"><a class="line" href="struct_v_a_a_p_i_frames_context.html#a6e84375c33ec71046d088f62432484d4">   81</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="struct_v_a_a_p_i_frames_context.html#a6e84375c33ec71046d088f62432484d4">derive_works</a>;</div>
<div class="line"><a name="l00082"></a><span class="lineno"><a class="line" href="hwcontext__vaapi_8c.html#a798b1d4dd7f51b5feb850407bffa4191">   82</a></span>&#160;} <a class="code" href="hwcontext__vaapi_8c.html#a798b1d4dd7f51b5feb850407bffa4191">VAAPIFramesContext</a>;</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160; </div>
<div class="line"><a name="l00084"></a><span class="lineno"><a class="line" href="struct_v_a_a_p_i_mapping.html">   84</a></span>&#160;<span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="struct_v_a_a_p_i_mapping.html">VAAPIMapping</a> {</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    <span class="comment">// Handle to the derived or copied image which is mapped.</span></div>
<div class="line"><a name="l00086"></a><span class="lineno"><a class="line" href="struct_v_a_a_p_i_mapping.html#a0b638d38aa94acaede20b6623b6c0dbc">   86</a></span>&#160;    VAImage <a class="code" href="struct_v_a_a_p_i_mapping.html#a0b638d38aa94acaede20b6623b6c0dbc">image</a>;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <span class="comment">// The mapping flags actually used.</span></div>
<div class="line"><a name="l00088"></a><span class="lineno"><a class="line" href="struct_v_a_a_p_i_mapping.html#ae51ceb9457d4249dc318a405473fdc98">   88</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="struct_v_a_a_p_i_mapping.html#ae51ceb9457d4249dc318a405473fdc98">flags</a>;</div>
<div class="line"><a name="l00089"></a><span class="lineno"><a class="line" href="hwcontext__vaapi_8c.html#a0d2e91789fec5a4d02773feb59963c16">   89</a></span>&#160;} <a class="code" href="hwcontext__vaapi_8c.html#a0d2e91789fec5a4d02773feb59963c16">VAAPIMapping</a>;</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160; </div>
<div class="line"><a name="l00091"></a><span class="lineno"><a class="line" href="struct_v_a_a_p_i_format.html">   91</a></span>&#160;<span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="struct_v_a_a_p_i_format.html">VAAPIFormat</a> {</div>
<div class="line"><a name="l00092"></a><span class="lineno"><a class="line" href="struct_v_a_a_p_i_format.html#a12690e97b0032df1e1b8420f00c6140d">   92</a></span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="struct_v_a_a_p_i_format.html#a12690e97b0032df1e1b8420f00c6140d">fourcc</a>;</div>
<div class="line"><a name="l00093"></a><span class="lineno"><a class="line" href="struct_v_a_a_p_i_format.html#ae9b2bd18e9bd46748422cc9bfe5e8dd6">   93</a></span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="struct_v_a_a_p_i_format.html#ae9b2bd18e9bd46748422cc9bfe5e8dd6">rt_format</a>;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <span class="keyword">enum</span> <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5">AVPixelFormat</a> <a class="code" href="struct_v_a_a_p_i_format.html#aaf873e6e50dabecadbb89c9eb73d55d7">pix_fmt</a>;</div>
<div class="line"><a name="l00095"></a><span class="lineno"><a class="line" href="struct_v_a_a_p_i_format.html#a67bb465b3048926828168aaa91cc3f21">   95</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="struct_v_a_a_p_i_format.html#a67bb465b3048926828168aaa91cc3f21">chroma_planes_swapped</a>;</div>
<div class="line"><a name="l00096"></a><span class="lineno"><a class="line" href="hwcontext__vaapi_8c.html#aa3b85933ac75a3fbb4cfb98a41956c00">   96</a></span>&#160;} <a class="code" href="hwcontext__vaapi_8c.html#aa3b85933ac75a3fbb4cfb98a41956c00">VAAPIFormatDescriptor</a>;</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160; </div>
<div class="line"><a name="l00098"></a><span class="lineno"><a class="line" href="hwcontext__vaapi_8c.html#a6980ef1e936a97ae1dc687fcdef09efc">   98</a></span>&#160;<span class="preprocessor">#define MAP(va, rt, av, swap_uv) { \</span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="preprocessor">        VA_FOURCC_ ## va, \</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="preprocessor">        VA_RT_FORMAT_ ## rt, \</span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="preprocessor">        AV_PIX_FMT_ ## av, \</span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="preprocessor">        swap_uv, \</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="preprocessor">    }</span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="comment">// The map fourcc &lt;-&gt; pix_fmt isn&#39;t bijective because of the annoying U/V</span></div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="comment">// plane swap cases.  The frame handling below tries to hide these.</span></div>
<div class="line"><a name="l00106"></a><span class="lineno"><a class="line" href="hwcontext__vaapi_8c.html#a33953f092368e26cc9d72e958ed962b2">  106</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="struct_v_a_a_p_i_format.html">VAAPIFormatDescriptor</a> <a class="code" href="hwcontext__vaapi_8c.html#a33953f092368e26cc9d72e958ed962b2">vaapi_format_map</a>[] = {</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    <a class="code" href="hwcontext__vaapi_8c.html#a6980ef1e936a97ae1dc687fcdef09efc">MAP</a>(NV12, YUV420,  NV12,    0),</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="preprocessor">#ifdef VA_FOURCC_I420</span></div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    <a class="code" href="hwcontext__vaapi_8c.html#a6980ef1e936a97ae1dc687fcdef09efc">MAP</a>(I420, YUV420,  YUV420P, 0),</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    <a class="code" href="hwcontext__vaapi_8c.html#a6980ef1e936a97ae1dc687fcdef09efc">MAP</a>(YV12, YUV420,  YUV420P, 1),</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    <a class="code" href="hwcontext__vaapi_8c.html#a6980ef1e936a97ae1dc687fcdef09efc">MAP</a>(IYUV, YUV420,  YUV420P, 0),</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    <a class="code" href="hwcontext__vaapi_8c.html#a6980ef1e936a97ae1dc687fcdef09efc">MAP</a>(422<a class="code" href="pixlet_8c.html#abec92cc72a096640b821b8cd56a02495">H</a>, YUV422,  YUV422P, 0),</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="preprocessor">#ifdef VA_FOURCC_YV16</span></div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    <a class="code" href="hwcontext__vaapi_8c.html#a6980ef1e936a97ae1dc687fcdef09efc">MAP</a>(YV16, YUV422,  YUV422P, 1),</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    <a class="code" href="hwcontext__vaapi_8c.html#a6980ef1e936a97ae1dc687fcdef09efc">MAP</a>(UYVY, YUV422,  UYVY422, 0),</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    <a class="code" href="hwcontext__vaapi_8c.html#a6980ef1e936a97ae1dc687fcdef09efc">MAP</a>(YUY2, YUV422,  YUYV422, 0),</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="preprocessor">#ifdef VA_FOURCC_Y210</span></div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    <a class="code" href="hwcontext__vaapi_8c.html#a6980ef1e936a97ae1dc687fcdef09efc">MAP</a>(Y210, YUV422_10,  Y210, 0),</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    <a class="code" href="hwcontext__vaapi_8c.html#a6980ef1e936a97ae1dc687fcdef09efc">MAP</a>(411<a class="code" href="mpegaudioenc__template_8c.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>, YUV411,  YUV411P, 0),</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    <a class="code" href="hwcontext__vaapi_8c.html#a6980ef1e936a97ae1dc687fcdef09efc">MAP</a>(422<a class="code" href="avdct_8c.html#af40a326b23c68a27cebe60f16634a2cb">V</a>, YUV422,  YUV440P, 0),</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    <a class="code" href="hwcontext__vaapi_8c.html#a6980ef1e936a97ae1dc687fcdef09efc">MAP</a>(444<a class="code" href="mpegaudioenc__template_8c.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>, YUV444,  YUV444P, 0),</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    <a class="code" href="hwcontext__vaapi_8c.html#a6980ef1e936a97ae1dc687fcdef09efc">MAP</a>(Y800, YUV400,  GRAY8,   0),</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="preprocessor">#ifdef VA_FOURCC_P010</span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    <a class="code" href="hwcontext__vaapi_8c.html#a6980ef1e936a97ae1dc687fcdef09efc">MAP</a>(P010, YUV420_10BPP, P010, 0),</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    <a class="code" href="hwcontext__vaapi_8c.html#a6980ef1e936a97ae1dc687fcdef09efc">MAP</a>(BGRA, RGB32,   BGRA, 0),</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    <a class="code" href="hwcontext__vaapi_8c.html#a6980ef1e936a97ae1dc687fcdef09efc">MAP</a>(BGRX, RGB32,   BGR0, 0),</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    <a class="code" href="hwcontext__vaapi_8c.html#a6980ef1e936a97ae1dc687fcdef09efc">MAP</a>(<a class="code" href="dvbsubdec_8c.html#aba32782053c6a2b01e3706d632d77895">RGBA</a>, RGB32,   <a class="code" href="dvbsubdec_8c.html#aba32782053c6a2b01e3706d632d77895">RGBA</a>, 0),</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    <a class="code" href="hwcontext__vaapi_8c.html#a6980ef1e936a97ae1dc687fcdef09efc">MAP</a>(RGBX, RGB32,   RGB0, 0),</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="preprocessor">#ifdef VA_FOURCC_ABGR</span></div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    <a class="code" href="hwcontext__vaapi_8c.html#a6980ef1e936a97ae1dc687fcdef09efc">MAP</a>(ABGR, RGB32,   ABGR, 0),</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    <a class="code" href="hwcontext__vaapi_8c.html#a6980ef1e936a97ae1dc687fcdef09efc">MAP</a>(XBGR, RGB32,   0BGR, 0),</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    <a class="code" href="hwcontext__vaapi_8c.html#a6980ef1e936a97ae1dc687fcdef09efc">MAP</a>(ARGB, RGB32,   ARGB, 0),</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    <a class="code" href="hwcontext__vaapi_8c.html#a6980ef1e936a97ae1dc687fcdef09efc">MAP</a>(XRGB, RGB32,   0RGB, 0),</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="preprocessor">#ifdef VA_FOURCC_X2R10G10B10</span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    <a class="code" href="hwcontext__vaapi_8c.html#a6980ef1e936a97ae1dc687fcdef09efc">MAP</a>(X2R10G10B10, RGB32_10, X2RGB10, 0),</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;};</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;<span class="preprocessor">#undef MAP</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160; </div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="struct_v_a_a_p_i_format.html">VAAPIFormatDescriptor</a> *</div>
<div class="line"><a name="l00146"></a><span class="lineno"><a class="line" href="hwcontext__vaapi_8c.html#a48b950ed906a38b88245800841cc954e">  146</a></span>&#160;    <a class="code" href="hwcontext__vaapi_8c.html#a48b950ed906a38b88245800841cc954e">vaapi_format_from_fourcc</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="vaapi__decode_8c.html#aa5d906425500585aa7832161b2a40e1b">fourcc</a>)</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;{</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="sinewin__tablegen__template_8c.html#a3508a98d3ee7e2c9a4841fe264cf70f7">FF_ARRAY_ELEMS</a>(<a class="code" href="hwcontext__vaapi_8c.html#a33953f092368e26cc9d72e958ed962b2">vaapi_format_map</a>); <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="hwcontext__vaapi_8c.html#a33953f092368e26cc9d72e958ed962b2">vaapi_format_map</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="vaapi__decode_8c.html#aa5d906425500585aa7832161b2a40e1b">fourcc</a> == <a class="code" href="vaapi__decode_8c.html#aa5d906425500585aa7832161b2a40e1b">fourcc</a>)</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;            <span class="keywordflow">return</span> &amp;<a class="code" href="hwcontext__vaapi_8c.html#a33953f092368e26cc9d72e958ed962b2">vaapi_format_map</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;}</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160; </div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="struct_v_a_a_p_i_format.html">VAAPIFormatDescriptor</a> *</div>
<div class="line"><a name="l00156"></a><span class="lineno"><a class="line" href="hwcontext__vaapi_8c.html#a597b2271503f0d001a42f6ed4523223a">  156</a></span>&#160;    <a class="code" href="hwcontext__vaapi_8c.html#a8f03bf69218a54531747ad192f50891f">vaapi_format_from_pix_fmt</a>(<span class="keyword">enum</span> <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5">AVPixelFormat</a> <a class="code" href="demuxing__decoding_8c.html#a7331e302ea7bb48e0b605a069576e135">pix_fmt</a>)</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;{</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="sinewin__tablegen__template_8c.html#a3508a98d3ee7e2c9a4841fe264cf70f7">FF_ARRAY_ELEMS</a>(<a class="code" href="hwcontext__vaapi_8c.html#a33953f092368e26cc9d72e958ed962b2">vaapi_format_map</a>); <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="hwcontext__vaapi_8c.html#a33953f092368e26cc9d72e958ed962b2">vaapi_format_map</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="demuxing__decoding_8c.html#a7331e302ea7bb48e0b605a069576e135">pix_fmt</a> == <a class="code" href="demuxing__decoding_8c.html#a7331e302ea7bb48e0b605a069576e135">pix_fmt</a>)</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;            <span class="keywordflow">return</span> &amp;<a class="code" href="hwcontext__vaapi_8c.html#a33953f092368e26cc9d72e958ed962b2">vaapi_format_map</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;}</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160; </div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;<span class="keyword">static</span> <span class="keyword">enum</span> <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5">AVPixelFormat</a> <a class="code" href="hwcontext__vaapi_8c.html#a597b2271503f0d001a42f6ed4523223a">vaapi_pix_fmt_from_fourcc</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="vaapi__decode_8c.html#aa5d906425500585aa7832161b2a40e1b">fourcc</a>)</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;{</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    <span class="keyword">const</span> <a class="code" href="struct_v_a_a_p_i_format.html">VAAPIFormatDescriptor</a> *<a class="code" href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a>;</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    <a class="code" href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a> = <a class="code" href="hwcontext__vaapi_8c.html#a48b950ed906a38b88245800841cc954e">vaapi_format_from_fourcc</a>(<a class="code" href="vaapi__decode_8c.html#aa5d906425500585aa7832161b2a40e1b">fourcc</a>);</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a>)</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a>-&gt;pix_fmt;</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a0e08f8a5d0fa21c3e258816a9dcce7c3">AV_PIX_FMT_NONE</a>;</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;}</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160; </div>
<div class="line"><a name="l00175"></a><span class="lineno"><a class="line" href="hwcontext__vaapi_8c.html#afa2cc8e7fd536ce24515ff6844e0c150">  175</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="hwcontext__vaapi_8c.html#afa2cc8e7fd536ce24515ff6844e0c150">vaapi_get_image_format</a>(<a class="code" href="struct_a_v_h_w_device_context.html">AVHWDeviceContext</a> *hwdev,</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;                                  <span class="keyword">enum</span> <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5">AVPixelFormat</a> <a class="code" href="demuxing__decoding_8c.html#a7331e302ea7bb48e0b605a069576e135">pix_fmt</a>,</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;                                  VAImageFormat **image_format)</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;{</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    <a class="code" href="struct_v_a_a_p_i_device_context.html">VAAPIDeviceContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a> = hwdev-&gt;<a class="code" href="struct_a_v_h_w_device_context.html#a9c3758c73b0f29925ccb2f60b5c1a803">internal</a>-&gt;<a class="code" href="struct_a_v_h_w_device_internal.html#ae7425663cca9541964518c66974a20bf">priv</a>;</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160; </div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nb_formats; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;formats[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].pix_fmt == <a class="code" href="demuxing__decoding_8c.html#a7331e302ea7bb48e0b605a069576e135">pix_fmt</a>) {</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;            <span class="keywordflow">if</span> (image_format)</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;                *image_format = &amp;<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;formats[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].image_format;</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;            <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;        }</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    }</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EINVAL);</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;}</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160; </div>
<div class="line"><a name="l00192"></a><span class="lineno"><a class="line" href="hwcontext__vaapi_8c.html#a4936608c613e9564d7ebae64b240915f">  192</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="hwcontext__vaapi_8c.html#a4936608c613e9564d7ebae64b240915f">vaapi_frames_get_constraints</a>(<a class="code" href="struct_a_v_h_w_device_context.html">AVHWDeviceContext</a> *hwdev,</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;                                        <span class="keyword">const</span> <span class="keywordtype">void</span> *hwconfig,</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;                                        <a class="code" href="struct_a_v_h_w_frames_constraints.html">AVHWFramesConstraints</a> *constraints)</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;{</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    <a class="code" href="struct_a_v_v_a_a_p_i_device_context.html">AVVAAPIDeviceContext</a> *hwctx = hwdev-&gt;<a class="code" href="struct_a_v_h_w_device_context.html#a46055b48d1a40445d775b4ae24f77f20">hwctx</a>;</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    <span class="keyword">const</span> <a class="code" href="struct_a_v_v_a_a_p_i_h_w_config.html">AVVAAPIHWConfig</a> *config = hwconfig;</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    <a class="code" href="struct_v_a_a_p_i_device_context.html">VAAPIDeviceContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a> = hwdev-&gt;<a class="code" href="struct_a_v_h_w_device_context.html#a9c3758c73b0f29925ccb2f60b5c1a803">internal</a>-&gt;<a class="code" href="struct_a_v_h_w_device_internal.html#ae7425663cca9541964518c66974a20bf">priv</a>;</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    VASurfaceAttrib *attr_list = <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    VAStatus vas;</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    <span class="keyword">enum</span> <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5">AVPixelFormat</a> <a class="code" href="demuxing__decoding_8c.html#a7331e302ea7bb48e0b605a069576e135">pix_fmt</a>;</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="vaapi__decode_8c.html#aa5d906425500585aa7832161b2a40e1b">fourcc</a>;</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    <span class="keywordtype">int</span> err, <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>, j, attr_count, pix_fmt_count;</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160; </div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    <span class="keywordflow">if</span> (config &amp;&amp;</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;        !(hwctx-&gt;<a class="code" href="struct_a_v_v_a_a_p_i_device_context.html#a7f2689d4ef32b2ee936508de03356e28">driver_quirks</a> &amp; <a class="code" href="group__avoptions.html#gga06fc87d81c62e9abb8790b6e5713c55ba5485e61dda42ec46dbab798a9c782751">AV_VAAPI_DRIVER_QUIRK_SURFACE_ATTRIBUTES</a>)) {</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;        attr_count = 0;</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;        vas = vaQuerySurfaceAttributes(hwctx-&gt;<a class="code" href="struct_a_v_v_a_a_p_i_device_context.html#a89951d5ccfad53ce81444773ea9f774e">display</a>, config-&gt;<a class="code" href="struct_a_v_v_a_a_p_i_h_w_config.html#a0ecea446600eeb1b7e93733317adbc98">config_id</a>,</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;                                       0, &amp;attr_count);</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;        <span class="keywordflow">if</span> (vas != VA_STATUS_SUCCESS) {</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(hwdev, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to query surface attributes: &quot;</span></div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;                   <span class="stringliteral">&quot;%d (%s).\n&quot;</span>, vas, vaErrorStr(vas));</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;            err = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOSYS);</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;            <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;        }</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160; </div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;        attr_list = <a class="code" href="tableprint__vlc_8h.html#ae97db1f58b6b1515ed57a83bea3dd572">av_malloc</a>(attr_count * <span class="keyword">sizeof</span>(*attr_list));</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;        <span class="keywordflow">if</span> (!attr_list) {</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;            err = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;            <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;        }</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160; </div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;        vas = vaQuerySurfaceAttributes(hwctx-&gt;<a class="code" href="struct_a_v_v_a_a_p_i_device_context.html#a89951d5ccfad53ce81444773ea9f774e">display</a>, config-&gt;<a class="code" href="struct_a_v_v_a_a_p_i_h_w_config.html#a0ecea446600eeb1b7e93733317adbc98">config_id</a>,</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;                                       attr_list, &amp;attr_count);</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;        <span class="keywordflow">if</span> (vas != VA_STATUS_SUCCESS) {</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(hwdev, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to query surface attributes: &quot;</span></div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;                   <span class="stringliteral">&quot;%d (%s).\n&quot;</span>, vas, vaErrorStr(vas));</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;            err = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOSYS);</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;            <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;        }</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160; </div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;        pix_fmt_count = 0;</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; attr_count; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;            <span class="keywordflow">switch</span> (attr_list[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="writing__filters_8txt.html#a860450fba1f740387dc082792ad89517">type</a>) {</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;            <span class="keywordflow">case</span> VASurfaceAttribPixelFormat:</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;                <a class="code" href="vaapi__decode_8c.html#aa5d906425500585aa7832161b2a40e1b">fourcc</a> = attr_list[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].value.value.i;</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;                <a class="code" href="demuxing__decoding_8c.html#a7331e302ea7bb48e0b605a069576e135">pix_fmt</a> = <a class="code" href="hwcontext__vaapi_8c.html#a597b2271503f0d001a42f6ed4523223a">vaapi_pix_fmt_from_fourcc</a>(<a class="code" href="vaapi__decode_8c.html#aa5d906425500585aa7832161b2a40e1b">fourcc</a>);</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="demuxing__decoding_8c.html#a7331e302ea7bb48e0b605a069576e135">pix_fmt</a> != <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a0e08f8a5d0fa21c3e258816a9dcce7c3">AV_PIX_FMT_NONE</a>) {</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;                    ++pix_fmt_count;</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;                    <span class="comment">// Something unsupported - ignore.</span></div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;                }</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;            <span class="keywordflow">case</span> VASurfaceAttribMinWidth:</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;                constraints-&gt;<a class="code" href="struct_a_v_h_w_frames_constraints.html#af220776925452091085139081d5d7251">min_width</a>  = attr_list[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].value.value.i;</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;            <span class="keywordflow">case</span> VASurfaceAttribMinHeight:</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;                constraints-&gt;<a class="code" href="struct_a_v_h_w_frames_constraints.html#a3f1aec6d1c90f77837875c2a3598be46">min_height</a> = attr_list[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].value.value.i;</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;            <span class="keywordflow">case</span> VASurfaceAttribMaxWidth:</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;                constraints-&gt;<a class="code" href="struct_a_v_h_w_frames_constraints.html#a34e06e3397af2b83de9d78f893bf4168">max_width</a>  = attr_list[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].value.value.i;</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;            <span class="keywordflow">case</span> VASurfaceAttribMaxHeight:</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;                constraints-&gt;<a class="code" href="struct_a_v_h_w_frames_constraints.html#af5d3a683727f7b92abca7b7114d4e15c">max_height</a> = attr_list[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].value.value.i;</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;            }</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;        }</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;        <span class="keywordflow">if</span> (pix_fmt_count == 0) {</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;            <span class="comment">// Nothing usable found.  Presumably there exists something which</span></div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;            <span class="comment">// works, so leave the set null to indicate unknown.</span></div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;            constraints-&gt;<a class="code" href="struct_a_v_h_w_frames_constraints.html#aabea88093c6f85d6185ffb0852a2217f">valid_sw_formats</a> = <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;            constraints-&gt;<a class="code" href="struct_a_v_h_w_frames_constraints.html#aabea88093c6f85d6185ffb0852a2217f">valid_sw_formats</a> = <a class="code" href="mem_8c.html#a254f3455439c15a2c8a75b8f0235fdbd">av_malloc_array</a>(pix_fmt_count + 1,</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;                                                            <span class="keyword">sizeof</span>(<a class="code" href="demuxing__decoding_8c.html#a7331e302ea7bb48e0b605a069576e135">pix_fmt</a>));</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;            <span class="keywordflow">if</span> (!constraints-&gt;<a class="code" href="struct_a_v_h_w_frames_constraints.html#aabea88093c6f85d6185ffb0852a2217f">valid_sw_formats</a>) {</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;                err = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;                <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;            }</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160; </div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;            <span class="keywordflow">for</span> (<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = j = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; attr_count; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;                <span class="keywordtype">int</span> k;</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160; </div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;                <span class="keywordflow">if</span> (attr_list[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="writing__filters_8txt.html#a860450fba1f740387dc082792ad89517">type</a> != VASurfaceAttribPixelFormat)</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;                    <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;                <a class="code" href="vaapi__decode_8c.html#aa5d906425500585aa7832161b2a40e1b">fourcc</a> = attr_list[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].value.value.i;</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;                <a class="code" href="demuxing__decoding_8c.html#a7331e302ea7bb48e0b605a069576e135">pix_fmt</a> = <a class="code" href="hwcontext__vaapi_8c.html#a597b2271503f0d001a42f6ed4523223a">vaapi_pix_fmt_from_fourcc</a>(<a class="code" href="vaapi__decode_8c.html#aa5d906425500585aa7832161b2a40e1b">fourcc</a>);</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160; </div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="demuxing__decoding_8c.html#a7331e302ea7bb48e0b605a069576e135">pix_fmt</a> == <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a0e08f8a5d0fa21c3e258816a9dcce7c3">AV_PIX_FMT_NONE</a>)</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;                    <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160; </div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;                <span class="keywordflow">for</span> (k = 0; k &lt; j; k++) {</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;                    <span class="keywordflow">if</span> (constraints-&gt;<a class="code" href="struct_a_v_h_w_frames_constraints.html#aabea88093c6f85d6185ffb0852a2217f">valid_sw_formats</a>[k] == <a class="code" href="demuxing__decoding_8c.html#a7331e302ea7bb48e0b605a069576e135">pix_fmt</a>)</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;                        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;                }</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160; </div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;                <span class="keywordflow">if</span> (k == j)</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;                    constraints-&gt;<a class="code" href="struct_a_v_h_w_frames_constraints.html#aabea88093c6f85d6185ffb0852a2217f">valid_sw_formats</a>[j++] = <a class="code" href="demuxing__decoding_8c.html#a7331e302ea7bb48e0b605a069576e135">pix_fmt</a>;</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;            }</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;            constraints-&gt;<a class="code" href="struct_a_v_h_w_frames_constraints.html#aabea88093c6f85d6185ffb0852a2217f">valid_sw_formats</a>[j] = <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a0e08f8a5d0fa21c3e258816a9dcce7c3">AV_PIX_FMT_NONE</a>;</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;        }</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;        <span class="comment">// No configuration supplied.</span></div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;        <span class="comment">// Return the full set of image formats known by the implementation.</span></div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;        constraints-&gt;<a class="code" href="struct_a_v_h_w_frames_constraints.html#aabea88093c6f85d6185ffb0852a2217f">valid_sw_formats</a> = <a class="code" href="mem_8c.html#a254f3455439c15a2c8a75b8f0235fdbd">av_malloc_array</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nb_formats + 1,</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;                                                        <span class="keyword">sizeof</span>(<a class="code" href="demuxing__decoding_8c.html#a7331e302ea7bb48e0b605a069576e135">pix_fmt</a>));</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;        <span class="keywordflow">if</span> (!constraints-&gt;<a class="code" href="struct_a_v_h_w_frames_constraints.html#aabea88093c6f85d6185ffb0852a2217f">valid_sw_formats</a>) {</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;            err = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;            <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;        }</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = j = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nb_formats; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;            <span class="keywordtype">int</span> k;</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160; </div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;            <span class="keywordflow">for</span> (k = 0; k &lt; j; k++) {</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;                <span class="keywordflow">if</span> (constraints-&gt;<a class="code" href="struct_a_v_h_w_frames_constraints.html#aabea88093c6f85d6185ffb0852a2217f">valid_sw_formats</a>[k] == <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;formats[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].pix_fmt)</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;            }</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160; </div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;            <span class="keywordflow">if</span> (k == j)</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;                constraints-&gt;<a class="code" href="struct_a_v_h_w_frames_constraints.html#aabea88093c6f85d6185ffb0852a2217f">valid_sw_formats</a>[j++] = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;formats[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].pix_fmt;</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;        }</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160; </div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;        constraints-&gt;<a class="code" href="struct_a_v_h_w_frames_constraints.html#aabea88093c6f85d6185ffb0852a2217f">valid_sw_formats</a>[j] = <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a0e08f8a5d0fa21c3e258816a9dcce7c3">AV_PIX_FMT_NONE</a>;</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    }</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160; </div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    constraints-&gt;<a class="code" href="struct_a_v_h_w_frames_constraints.html#a4258bbe81f927b76b7ca5af44ba7ef6b">valid_hw_formats</a> = <a class="code" href="mem_8c.html#a254f3455439c15a2c8a75b8f0235fdbd">av_malloc_array</a>(2, <span class="keyword">sizeof</span>(<a class="code" href="demuxing__decoding_8c.html#a7331e302ea7bb48e0b605a069576e135">pix_fmt</a>));</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    <span class="keywordflow">if</span> (!constraints-&gt;<a class="code" href="struct_a_v_h_w_frames_constraints.html#a4258bbe81f927b76b7ca5af44ba7ef6b">valid_hw_formats</a>) {</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;        err = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    }</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    constraints-&gt;<a class="code" href="struct_a_v_h_w_frames_constraints.html#a4258bbe81f927b76b7ca5af44ba7ef6b">valid_hw_formats</a>[0] = <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5abb09cadf3b2d6b5ce5980401bcf638a8">AV_PIX_FMT_VAAPI</a>;</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    constraints-&gt;<a class="code" href="struct_a_v_h_w_frames_constraints.html#a4258bbe81f927b76b7ca5af44ba7ef6b">valid_hw_formats</a>[1] = <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a0e08f8a5d0fa21c3e258816a9dcce7c3">AV_PIX_FMT_NONE</a>;</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160; </div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    err = 0;</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;<a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>:</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#adba82e1bcd02de510a858fcbedf79ef1">av_freep</a>(&amp;attr_list);</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;    <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;}</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160; </div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">struct </span>{</div>
<div class="line"><a name="l00330"></a><span class="lineno"><a class="line" href="hwcontext__vaapi_8c.html#af4f3a4e175def195bea03a54bd3e7205">  330</a></span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="hwcontext__vaapi_8c.html#af4f3a4e175def195bea03a54bd3e7205">friendly_name</a>;</div>
<div class="line"><a name="l00331"></a><span class="lineno"><a class="line" href="hwcontext__vaapi_8c.html#a33100d8fbce72445b01f88003826d41d">  331</a></span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="hwcontext__vaapi_8c.html#a33100d8fbce72445b01f88003826d41d">match_string</a>;</div>
<div class="line"><a name="l00332"></a><span class="lineno"><a class="line" href="hwcontext__vaapi_8c.html#abb72e384863d48f0c521dafc06ec0889">  332</a></span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="hwcontext__vaapi_8c.html#abb72e384863d48f0c521dafc06ec0889">quirks</a>;</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;} <a class="code" href="hwcontext__vaapi_8c.html#ae22916bf2f7b55e5815fe1d06f74bca0">vaapi_driver_quirks_table</a>[] = {</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;<span class="preprocessor">#if !VA_CHECK_VERSION(1, 0, 0)</span></div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    <span class="comment">// The i965 driver did not conform before version 2.0.</span></div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    {</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;        <span class="stringliteral">&quot;Intel i965 (Quick Sync)&quot;</span>,</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;        <span class="stringliteral">&quot;i965&quot;</span>,</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;        <a class="code" href="group__avoptions.html#gga06fc87d81c62e9abb8790b6e5713c55ba225e072f2eba3d53c29d0b5f197d49ed">AV_VAAPI_DRIVER_QUIRK_RENDER_PARAM_BUFFERS</a>,</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    },</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    {</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;        <span class="stringliteral">&quot;Intel iHD&quot;</span>,</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;        <span class="stringliteral">&quot;ubit&quot;</span>,</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;        <a class="code" href="group__avoptions.html#gga06fc87d81c62e9abb8790b6e5713c55baba97590c47b7f525df53596127c7e2ea">AV_VAAPI_DRIVER_QUIRK_ATTRIB_MEMTYPE</a>,</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    },</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    {</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;        <span class="stringliteral">&quot;VDPAU wrapper&quot;</span>,</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;        <span class="stringliteral">&quot;Splitted-Desktop Systems VDPAU backend for VA-API&quot;</span>,</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;        <a class="code" href="group__avoptions.html#gga06fc87d81c62e9abb8790b6e5713c55ba5485e61dda42ec46dbab798a9c782751">AV_VAAPI_DRIVER_QUIRK_SURFACE_ATTRIBUTES</a>,</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    },</div>
<div class="line"><a name="l00352"></a><span class="lineno"><a class="line" href="hwcontext__vaapi_8c.html#ae22916bf2f7b55e5815fe1d06f74bca0">  352</a></span>&#160;};</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160; </div>
<div class="line"><a name="l00354"></a><span class="lineno"><a class="line" href="hwcontext__vaapi_8c.html#adef9d2d364c6fe21c47ada497bf8bc9c">  354</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="hwcontext__vaapi_8c.html#adef9d2d364c6fe21c47ada497bf8bc9c">vaapi_device_init</a>(<a class="code" href="struct_a_v_h_w_device_context.html">AVHWDeviceContext</a> *hwdev)</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;{</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    <a class="code" href="struct_v_a_a_p_i_device_context.html">VAAPIDeviceContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a> = hwdev-&gt;<a class="code" href="struct_a_v_h_w_device_context.html#a9c3758c73b0f29925ccb2f60b5c1a803">internal</a>-&gt;<a class="code" href="struct_a_v_h_w_device_internal.html#ae7425663cca9541964518c66974a20bf">priv</a>;</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;    <a class="code" href="struct_a_v_v_a_a_p_i_device_context.html">AVVAAPIDeviceContext</a> *hwctx = hwdev-&gt;<a class="code" href="struct_a_v_h_w_device_context.html#a46055b48d1a40445d775b4ae24f77f20">hwctx</a>;</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    VAImageFormat *image_list = <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    VAStatus vas;</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *vendor_string;</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    <span class="keywordtype">int</span> err, <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>, image_count;</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    <span class="keyword">enum</span> <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5">AVPixelFormat</a> <a class="code" href="demuxing__decoding_8c.html#a7331e302ea7bb48e0b605a069576e135">pix_fmt</a>;</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="vaapi__decode_8c.html#aa5d906425500585aa7832161b2a40e1b">fourcc</a>;</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160; </div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;    image_count = vaMaxNumImageFormats(hwctx-&gt;<a class="code" href="struct_a_v_v_a_a_p_i_device_context.html#a89951d5ccfad53ce81444773ea9f774e">display</a>);</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;    <span class="keywordflow">if</span> (image_count &lt;= 0) {</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;        err = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EIO);</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    }</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    image_list = <a class="code" href="tableprint__vlc_8h.html#ae97db1f58b6b1515ed57a83bea3dd572">av_malloc</a>(image_count * <span class="keyword">sizeof</span>(*image_list));</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    <span class="keywordflow">if</span> (!image_list) {</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;        err = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    }</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    vas = vaQueryImageFormats(hwctx-&gt;<a class="code" href="struct_a_v_v_a_a_p_i_device_context.html#a89951d5ccfad53ce81444773ea9f774e">display</a>, image_list, &amp;image_count);</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    <span class="keywordflow">if</span> (vas != VA_STATUS_SUCCESS) {</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;        err = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EIO);</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    }</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160; </div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;formats  = <a class="code" href="tableprint__vlc_8h.html#ae97db1f58b6b1515ed57a83bea3dd572">av_malloc</a>(image_count * <span class="keyword">sizeof</span>(*<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;formats));</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;formats) {</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;        err = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;    }</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nb_formats = 0;</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; image_count; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;        <a class="code" href="vaapi__decode_8c.html#aa5d906425500585aa7832161b2a40e1b">fourcc</a>  = image_list[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].fourcc;</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;        <a class="code" href="demuxing__decoding_8c.html#a7331e302ea7bb48e0b605a069576e135">pix_fmt</a> = <a class="code" href="hwcontext__vaapi_8c.html#a597b2271503f0d001a42f6ed4523223a">vaapi_pix_fmt_from_fourcc</a>(<a class="code" href="vaapi__decode_8c.html#aa5d906425500585aa7832161b2a40e1b">fourcc</a>);</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="demuxing__decoding_8c.html#a7331e302ea7bb48e0b605a069576e135">pix_fmt</a> == <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a0e08f8a5d0fa21c3e258816a9dcce7c3">AV_PIX_FMT_NONE</a>) {</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(hwdev, <a class="code" href="group__lavu__log__constants.html#ga5b7221c3afd06848486776bd834a58a5">AV_LOG_DEBUG</a>, <span class="stringliteral">&quot;Format %#x -&gt; unknown.\n&quot;</span>,</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;                   <a class="code" href="vaapi__decode_8c.html#aa5d906425500585aa7832161b2a40e1b">fourcc</a>);</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(hwdev, <a class="code" href="group__lavu__log__constants.html#ga5b7221c3afd06848486776bd834a58a5">AV_LOG_DEBUG</a>, <span class="stringliteral">&quot;Format %#x -&gt; %s.\n&quot;</span>,</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;                   <a class="code" href="vaapi__decode_8c.html#aa5d906425500585aa7832161b2a40e1b">fourcc</a>, <a class="code" href="pixdesc_8c.html#ab92e2a8a9b58c982560c49df9f01e47e">av_get_pix_fmt_name</a>(<a class="code" href="demuxing__decoding_8c.html#a7331e302ea7bb48e0b605a069576e135">pix_fmt</a>));</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;            <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;formats[<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nb_formats].pix_fmt      = <a class="code" href="demuxing__decoding_8c.html#a7331e302ea7bb48e0b605a069576e135">pix_fmt</a>;</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;            <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;formats[<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nb_formats].image_format = image_list[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;            ++<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nb_formats;</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;        }</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    }</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160; </div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    vendor_string = vaQueryVendorString(hwctx-&gt;<a class="code" href="struct_a_v_v_a_a_p_i_device_context.html#a89951d5ccfad53ce81444773ea9f774e">display</a>);</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;    <span class="keywordflow">if</span> (vendor_string)</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(hwdev, <a class="code" href="group__lavu__log__constants.html#ga9b58b28e2d429b930b69db19877f76a8">AV_LOG_VERBOSE</a>, <span class="stringliteral">&quot;VAAPI driver: %s.\n&quot;</span>, vendor_string);</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160; </div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;    <span class="keywordflow">if</span> (hwctx-&gt;<a class="code" href="struct_a_v_v_a_a_p_i_device_context.html#a7f2689d4ef32b2ee936508de03356e28">driver_quirks</a> &amp; <a class="code" href="group__avoptions.html#gga06fc87d81c62e9abb8790b6e5713c55bab116fee0b3c46f1a654355de96249231">AV_VAAPI_DRIVER_QUIRK_USER_SET</a>) {</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(hwdev, <a class="code" href="group__lavu__log__constants.html#ga9b58b28e2d429b930b69db19877f76a8">AV_LOG_VERBOSE</a>, <span class="stringliteral">&quot;Using quirks set by user (%#x).\n&quot;</span>,</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;               hwctx-&gt;<a class="code" href="struct_a_v_v_a_a_p_i_device_context.html#a7f2689d4ef32b2ee936508de03356e28">driver_quirks</a>);</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;        <span class="comment">// Detect the driver in use and set quirk flags if necessary.</span></div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;        hwctx-&gt;<a class="code" href="struct_a_v_v_a_a_p_i_device_context.html#a7f2689d4ef32b2ee936508de03356e28">driver_quirks</a> = 0;</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;        <span class="keywordflow">if</span> (vendor_string) {</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;            <span class="keywordflow">for</span> (<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="sinewin__tablegen__template_8c.html#a3508a98d3ee7e2c9a4841fe264cf70f7">FF_ARRAY_ELEMS</a>(<a class="code" href="hwcontext__vaapi_8c.html#ae22916bf2f7b55e5815fe1d06f74bca0">vaapi_driver_quirks_table</a>); <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;                <span class="keywordflow">if</span> (strstr(vendor_string,</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;                           <a class="code" href="hwcontext__vaapi_8c.html#ae22916bf2f7b55e5815fe1d06f74bca0">vaapi_driver_quirks_table</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="hwcontext__vaapi_8c.html#a33100d8fbce72445b01f88003826d41d">match_string</a>)) {</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;                    <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(hwdev, <a class="code" href="group__lavu__log__constants.html#ga9b58b28e2d429b930b69db19877f76a8">AV_LOG_VERBOSE</a>, <span class="stringliteral">&quot;Matched driver string &quot;</span></div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;                           <span class="stringliteral">&quot;as known nonstandard driver \&quot;%s\&quot;, setting &quot;</span></div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;                           <span class="stringliteral">&quot;quirks (%#x).\n&quot;</span>,</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;                           <a class="code" href="hwcontext__vaapi_8c.html#ae22916bf2f7b55e5815fe1d06f74bca0">vaapi_driver_quirks_table</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="hwcontext__vaapi_8c.html#af4f3a4e175def195bea03a54bd3e7205">friendly_name</a>,</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;                           <a class="code" href="hwcontext__vaapi_8c.html#ae22916bf2f7b55e5815fe1d06f74bca0">vaapi_driver_quirks_table</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="hwcontext__vaapi_8c.html#abb72e384863d48f0c521dafc06ec0889">quirks</a>);</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;                    hwctx-&gt;<a class="code" href="struct_a_v_v_a_a_p_i_device_context.html#a7f2689d4ef32b2ee936508de03356e28">driver_quirks</a> |=</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;                        <a class="code" href="hwcontext__vaapi_8c.html#ae22916bf2f7b55e5815fe1d06f74bca0">vaapi_driver_quirks_table</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].quirks;</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;                }</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;            }</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;            <span class="keywordflow">if</span> (!(<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="sinewin__tablegen__template_8c.html#a3508a98d3ee7e2c9a4841fe264cf70f7">FF_ARRAY_ELEMS</a>(<a class="code" href="hwcontext__vaapi_8c.html#ae22916bf2f7b55e5815fe1d06f74bca0">vaapi_driver_quirks_table</a>))) {</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;                <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(hwdev, <a class="code" href="group__lavu__log__constants.html#ga9b58b28e2d429b930b69db19877f76a8">AV_LOG_VERBOSE</a>, <span class="stringliteral">&quot;Driver not found in known &quot;</span></div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;                       <span class="stringliteral">&quot;nonstandard list, using standard behaviour.\n&quot;</span>);</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;            }</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(hwdev, <a class="code" href="group__lavu__log__constants.html#ga9b58b28e2d429b930b69db19877f76a8">AV_LOG_VERBOSE</a>, <span class="stringliteral">&quot;Driver has no vendor string, &quot;</span></div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;                   <span class="stringliteral">&quot;assuming standard behaviour.\n&quot;</span>);</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;        }</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    }</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160; </div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#a079eab092887563f2bef9106c6120089">av_free</a>(image_list);</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;<a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>:</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#adba82e1bcd02de510a858fcbedf79ef1">av_freep</a>(&amp;<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;formats);</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#a079eab092887563f2bef9106c6120089">av_free</a>(image_list);</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;}</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160; </div>
<div class="line"><a name="l00444"></a><span class="lineno"><a class="line" href="hwcontext__vaapi_8c.html#af0d00b9a2d118b471d8d39a7c05a45f5">  444</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="hwcontext__vaapi_8c.html#af0d00b9a2d118b471d8d39a7c05a45f5">vaapi_device_uninit</a>(<a class="code" href="struct_a_v_h_w_device_context.html">AVHWDeviceContext</a> *hwdev)</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;{</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    <a class="code" href="struct_v_a_a_p_i_device_context.html">VAAPIDeviceContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a> = hwdev-&gt;<a class="code" href="struct_a_v_h_w_device_context.html#a9c3758c73b0f29925ccb2f60b5c1a803">internal</a>-&gt;<a class="code" href="struct_a_v_h_w_device_internal.html#ae7425663cca9541964518c66974a20bf">priv</a>;</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160; </div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#adba82e1bcd02de510a858fcbedf79ef1">av_freep</a>(&amp;<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;formats);</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;}</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160; </div>
<div class="line"><a name="l00451"></a><span class="lineno"><a class="line" href="hwcontext__vaapi_8c.html#a24ec8d0632aa8b38111c56afbdc4f188">  451</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="hwcontext__vaapi_8c.html#a24ec8d0632aa8b38111c56afbdc4f188">vaapi_buffer_free</a>(<span class="keywordtype">void</span> *opaque, <a class="code" href="audio__convert_8c.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> *<a class="code" href="mxf_8c.html#a084824fc871e38157790c99ae1240842">data</a>)</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;{</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    <a class="code" href="struct_a_v_h_w_frames_context.html">AVHWFramesContext</a>     *hwfc = opaque;</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;    <a class="code" href="struct_a_v_v_a_a_p_i_device_context.html">AVVAAPIDeviceContext</a> *hwctx = hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#ac9a7dbd0cbfcabc0b1529cb34cf53b6d">device_ctx</a>-&gt;<a class="code" href="struct_a_v_h_w_device_context.html#a46055b48d1a40445d775b4ae24f77f20">hwctx</a>;</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    VASurfaceID surface_id;</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;    VAStatus vas;</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160; </div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    surface_id = (VASurfaceID)(uintptr_t)<a class="code" href="mxf_8c.html#a084824fc871e38157790c99ae1240842">data</a>;</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160; </div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;    vas = vaDestroySurfaces(hwctx-&gt;<a class="code" href="struct_a_v_v_a_a_p_i_device_context.html#a89951d5ccfad53ce81444773ea9f774e">display</a>, &amp;surface_id, 1);</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;    <span class="keywordflow">if</span> (vas != VA_STATUS_SUCCESS) {</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(hwfc, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to destroy surface %#x: &quot;</span></div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;               <span class="stringliteral">&quot;%d (%s).\n&quot;</span>, surface_id, vas, vaErrorStr(vas));</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;    }</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;}</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160; </div>
<div class="line"><a name="l00467"></a><span class="lineno"><a class="line" href="hwcontext__vaapi_8c.html#af9ba84030188934a6f3ee0f2a5a2c544">  467</a></span>&#160;<span class="keyword">static</span> <a class="code" href="struct_a_v_buffer_ref.html">AVBufferRef</a> *<a class="code" href="hwcontext__vaapi_8c.html#af9ba84030188934a6f3ee0f2a5a2c544">vaapi_pool_alloc</a>(<span class="keywordtype">void</span> *opaque, <span class="keywordtype">int</span> <a class="code" href="group__lavu__mem__funcs.html#ga34e10fdac079a9ca4512b8ccd7f20b8a">size</a>)</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;{</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;    <a class="code" href="struct_a_v_h_w_frames_context.html">AVHWFramesContext</a>     *hwfc = opaque;</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    <a class="code" href="struct_v_a_a_p_i_frames_context.html">VAAPIFramesContext</a>     *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a> = hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#a69e956e8d2d73d65d015c4ed895ec642">internal</a>-&gt;<a class="code" href="struct_a_v_h_w_frames_internal.html#a503cfeb391ed69856344768fd641a489">priv</a>;</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    <a class="code" href="struct_a_v_v_a_a_p_i_device_context.html">AVVAAPIDeviceContext</a> *hwctx = hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#ac9a7dbd0cbfcabc0b1529cb34cf53b6d">device_ctx</a>-&gt;<a class="code" href="struct_a_v_h_w_device_context.html#a46055b48d1a40445d775b4ae24f77f20">hwctx</a>;</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    <a class="code" href="struct_a_v_v_a_a_p_i_frames_context.html">AVVAAPIFramesContext</a>  *avfc = hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#a54e38c3e4355321e23e0f4c7411cb8ee">hwctx</a>;</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    VASurfaceID surface_id;</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    VAStatus vas;</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    <a class="code" href="struct_a_v_buffer_ref.html">AVBufferRef</a> *<a class="code" href="tests_2jpeg2000dwt_8c.html#a5cabdd8be5af41f675fed06498e094b7">ref</a>;</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160; </div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    <span class="keywordflow">if</span> (hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#a9c3a94dcd9c96e19059b56a6bae9c764">initial_pool_size</a> &gt; 0 &amp;&amp;</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;        avfc-&gt;<a class="code" href="struct_a_v_v_a_a_p_i_frames_context.html#af574bfa0abf14b96ae667f25494a3bcf">nb_surfaces</a> &gt;= hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#a9c3a94dcd9c96e19059b56a6bae9c764">initial_pool_size</a>)</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160; </div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;    vas = vaCreateSurfaces(hwctx-&gt;<a class="code" href="struct_a_v_v_a_a_p_i_device_context.html#a89951d5ccfad53ce81444773ea9f774e">display</a>, <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;rt_format,</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;                           hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#a9e6f29d0f744930cdd0e8bdff8771520">width</a>, hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#ae61bbe1d8645a0c573085e29f1d0a58f">height</a>,</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;                           &amp;surface_id, 1,</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;                           <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;attributes, <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nb_attributes);</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;    <span class="keywordflow">if</span> (vas != VA_STATUS_SUCCESS) {</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(hwfc, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to create surface: &quot;</span></div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;               <span class="stringliteral">&quot;%d (%s).\n&quot;</span>, vas, vaErrorStr(vas));</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;    }</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(hwfc, <a class="code" href="group__lavu__log__constants.html#ga5b7221c3afd06848486776bd834a58a5">AV_LOG_DEBUG</a>, <span class="stringliteral">&quot;Created surface %#x.\n&quot;</span>, surface_id);</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160; </div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;    <a class="code" href="tests_2jpeg2000dwt_8c.html#a5cabdd8be5af41f675fed06498e094b7">ref</a> = <a class="code" href="group__lavu__buffer.html#ga3e7f4c92db85ccba0b2a16dd0069842a">av_buffer_create</a>((<a class="code" href="audio__convert_8c.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a>*)(uintptr_t)surface_id,</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;                           <span class="keyword">sizeof</span>(surface_id), &amp;<a class="code" href="hwcontext__vaapi_8c.html#a24ec8d0632aa8b38111c56afbdc4f188">vaapi_buffer_free</a>,</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;                           hwfc, <a class="code" href="group__lavu__buffer.html#gaa818f8f1011d69acc50c1f29cb85e576">AV_BUFFER_FLAG_READONLY</a>);</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="tests_2jpeg2000dwt_8c.html#a5cabdd8be5af41f675fed06498e094b7">ref</a>) {</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;        vaDestroySurfaces(hwctx-&gt;<a class="code" href="struct_a_v_v_a_a_p_i_device_context.html#a89951d5ccfad53ce81444773ea9f774e">display</a>, &amp;surface_id, 1);</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;    }</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160; </div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;    <span class="keywordflow">if</span> (hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#a9c3a94dcd9c96e19059b56a6bae9c764">initial_pool_size</a> &gt; 0) {</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;        <span class="comment">// This is a fixed-size pool, so we must still be in the initial</span></div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;        <span class="comment">// allocation sequence.</span></div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;        <a class="code" href="avassert_8h.html#aae204192396f78cc8c5cd7ad5c57c23f">av_assert0</a>(avfc-&gt;<a class="code" href="struct_a_v_v_a_a_p_i_frames_context.html#af574bfa0abf14b96ae667f25494a3bcf">nb_surfaces</a> &lt; hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#a9c3a94dcd9c96e19059b56a6bae9c764">initial_pool_size</a>);</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;        avfc-&gt;<a class="code" href="struct_a_v_v_a_a_p_i_frames_context.html#a18c4ca9956227c498679a823e14e1375">surface_ids</a>[avfc-&gt;<a class="code" href="struct_a_v_v_a_a_p_i_frames_context.html#af574bfa0abf14b96ae667f25494a3bcf">nb_surfaces</a>] = surface_id;</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;        ++avfc-&gt;<a class="code" href="struct_a_v_v_a_a_p_i_frames_context.html#af574bfa0abf14b96ae667f25494a3bcf">nb_surfaces</a>;</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;    }</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160; </div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="tests_2jpeg2000dwt_8c.html#a5cabdd8be5af41f675fed06498e094b7">ref</a>;</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;}</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160; </div>
<div class="line"><a name="l00511"></a><span class="lineno"><a class="line" href="hwcontext__vaapi_8c.html#a3051d7e401501e5313bf571c897ddef9">  511</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="hwcontext__vaapi_8c.html#a3051d7e401501e5313bf571c897ddef9">vaapi_frames_init</a>(<a class="code" href="struct_a_v_h_w_frames_context.html">AVHWFramesContext</a> *hwfc)</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;{</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;    <a class="code" href="struct_a_v_v_a_a_p_i_frames_context.html">AVVAAPIFramesContext</a>  *avfc = hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#a54e38c3e4355321e23e0f4c7411cb8ee">hwctx</a>;</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;    <a class="code" href="struct_v_a_a_p_i_frames_context.html">VAAPIFramesContext</a>     *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a> = hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#a69e956e8d2d73d65d015c4ed895ec642">internal</a>-&gt;<a class="code" href="struct_a_v_h_w_frames_internal.html#a503cfeb391ed69856344768fd641a489">priv</a>;</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;    <a class="code" href="struct_a_v_v_a_a_p_i_device_context.html">AVVAAPIDeviceContext</a> *hwctx = hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#ac9a7dbd0cbfcabc0b1529cb34cf53b6d">device_ctx</a>-&gt;<a class="code" href="struct_a_v_h_w_device_context.html#a46055b48d1a40445d775b4ae24f77f20">hwctx</a>;</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;    <span class="keyword">const</span> <a class="code" href="struct_v_a_a_p_i_format.html">VAAPIFormatDescriptor</a> *<a class="code" href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a>;</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;    VAImageFormat *expected_format;</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;    <a class="code" href="struct_a_v_buffer_ref.html">AVBufferRef</a> *test_surface = <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;    VASurfaceID test_surface_id;</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    VAImage test_image;</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;    VAStatus vas;</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;    <span class="keywordtype">int</span> err, <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160; </div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;    <a class="code" href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a> = <a class="code" href="hwcontext__vaapi_8c.html#a8f03bf69218a54531747ad192f50891f">vaapi_format_from_pix_fmt</a>(hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#a663a9aceca97aa7b2426c9aba6543e4a">sw_format</a>);</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a>) {</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(hwfc, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Unsupported format: %s.\n&quot;</span>,</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;               <a class="code" href="pixdesc_8c.html#ab92e2a8a9b58c982560c49df9f01e47e">av_get_pix_fmt_name</a>(hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#a663a9aceca97aa7b2426c9aba6543e4a">sw_format</a>));</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EINVAL);</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;    }</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160; </div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;    <span class="keywordflow">if</span> (!hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#ad67ff3a5828a611d1b1cddd64fc1de71">pool</a>) {</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;        <span class="keywordflow">if</span> (!(hwctx-&gt;<a class="code" href="struct_a_v_v_a_a_p_i_device_context.html#a7f2689d4ef32b2ee936508de03356e28">driver_quirks</a> &amp; <a class="code" href="group__avoptions.html#gga06fc87d81c62e9abb8790b6e5713c55ba5485e61dda42ec46dbab798a9c782751">AV_VAAPI_DRIVER_QUIRK_SURFACE_ATTRIBUTES</a>)) {</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;            <span class="keywordtype">int</span> need_memory_type = !(hwctx-&gt;<a class="code" href="struct_a_v_v_a_a_p_i_device_context.html#a7f2689d4ef32b2ee936508de03356e28">driver_quirks</a> &amp; <a class="code" href="group__avoptions.html#gga06fc87d81c62e9abb8790b6e5713c55baba97590c47b7f525df53596127c7e2ea">AV_VAAPI_DRIVER_QUIRK_ATTRIB_MEMTYPE</a>);</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;            <span class="keywordtype">int</span> need_pixel_format = 1;</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;            <span class="keywordflow">for</span> (<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; avfc-&gt;<a class="code" href="struct_a_v_v_a_a_p_i_frames_context.html#a50ddcf6888143c36c49f82db1c46cec9">nb_attributes</a>; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;                <span class="keywordflow">if</span> (avfc-&gt;<a class="code" href="struct_a_v_v_a_a_p_i_frames_context.html#a9fab5adf94cbd6eeee14480f603d3d51">attributes</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].type == VASurfaceAttribMemoryType)</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;                    need_memory_type  = 0;</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;                <span class="keywordflow">if</span> (avfc-&gt;<a class="code" href="struct_a_v_v_a_a_p_i_frames_context.html#a9fab5adf94cbd6eeee14480f603d3d51">attributes</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].type == VASurfaceAttribPixelFormat)</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;                    need_pixel_format = 0;</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;            }</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;            <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nb_attributes =</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;                avfc-&gt;<a class="code" href="struct_a_v_v_a_a_p_i_frames_context.html#a50ddcf6888143c36c49f82db1c46cec9">nb_attributes</a> + need_memory_type + need_pixel_format;</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160; </div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;            <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;attributes = <a class="code" href="tableprint__vlc_8h.html#ae97db1f58b6b1515ed57a83bea3dd572">av_malloc</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nb_attributes *</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;                                        <span class="keyword">sizeof</span>(*<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;attributes));</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;            <span class="keywordflow">if</span> (!<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;attributes) {</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;                err = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;                <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;            }</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160; </div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;            <span class="keywordflow">for</span> (<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; avfc-&gt;<a class="code" href="struct_a_v_v_a_a_p_i_frames_context.html#a50ddcf6888143c36c49f82db1c46cec9">nb_attributes</a>; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;                <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;attributes[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>] = avfc-&gt;<a class="code" href="struct_a_v_v_a_a_p_i_frames_context.html#a9fab5adf94cbd6eeee14480f603d3d51">attributes</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;            <a class="code" href="filter__design_8txt.html#a0e82f1088fdc24c14bf175d2ac77523f">if</a> (need_memory_type) {</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;                <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;attributes[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++] = (VASurfaceAttrib) {</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;                    .type          = VASurfaceAttribMemoryType,</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;                    .<a class="code" href="struct_a_v_format_context.html#a32379cc371463b235d54235d4af06a15">flags</a>         = VA_SURFACE_ATTRIB_SETTABLE,</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;                    .value.type    = VAGenericValueTypeInteger,</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;                    .value.value.i = VA_SURFACE_ATTRIB_MEM_TYPE_VA,</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;                };</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;            }</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;            <span class="keywordflow">if</span> (need_pixel_format) {</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;                <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;attributes[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++] = (VASurfaceAttrib) {</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;                    .type          = VASurfaceAttribPixelFormat,</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;                    .<a class="code" href="struct_a_v_format_context.html#a32379cc371463b235d54235d4af06a15">flags</a>         = VA_SURFACE_ATTRIB_SETTABLE,</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;                    .value.type    = VAGenericValueTypeInteger,</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;                    .value.value.i = <a class="code" href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a>-&gt;fourcc,</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;                };</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;            }</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;            <a class="code" href="avassert_8h.html#aae204192396f78cc8c5cd7ad5c57c23f">av_assert0</a>(<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> == <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nb_attributes);</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;            <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;attributes = <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;            <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nb_attributes = 0;</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;        }</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160; </div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;rt_format = <a class="code" href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a>-&gt;rt_format;</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160; </div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;        <span class="keywordflow">if</span> (hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#a9c3a94dcd9c96e19059b56a6bae9c764">initial_pool_size</a> &gt; 0) {</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;            <span class="comment">// This pool will be usable as a render target, so we need to store</span></div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;            <span class="comment">// all of the surface IDs somewhere that vaCreateContext() calls</span></div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;            <span class="comment">// will be able to access them.</span></div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;            avfc-&gt;<a class="code" href="struct_a_v_v_a_a_p_i_frames_context.html#af574bfa0abf14b96ae667f25494a3bcf">nb_surfaces</a> = 0;</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;            avfc-&gt;<a class="code" href="struct_a_v_v_a_a_p_i_frames_context.html#a18c4ca9956227c498679a823e14e1375">surface_ids</a> = <a class="code" href="tableprint__vlc_8h.html#ae97db1f58b6b1515ed57a83bea3dd572">av_malloc</a>(hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#a9c3a94dcd9c96e19059b56a6bae9c764">initial_pool_size</a> *</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;                                          <span class="keyword">sizeof</span>(*avfc-&gt;<a class="code" href="struct_a_v_v_a_a_p_i_frames_context.html#a18c4ca9956227c498679a823e14e1375">surface_ids</a>));</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;            <span class="keywordflow">if</span> (!avfc-&gt;<a class="code" href="struct_a_v_v_a_a_p_i_frames_context.html#a18c4ca9956227c498679a823e14e1375">surface_ids</a>) {</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;                err = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;                <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;            }</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;            <span class="comment">// This pool allows dynamic sizing, and will not be usable as a</span></div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;            <span class="comment">// render target.</span></div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;            avfc-&gt;<a class="code" href="struct_a_v_v_a_a_p_i_frames_context.html#af574bfa0abf14b96ae667f25494a3bcf">nb_surfaces</a> = 0;</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;            avfc-&gt;<a class="code" href="struct_a_v_v_a_a_p_i_frames_context.html#a18c4ca9956227c498679a823e14e1375">surface_ids</a> = <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;        }</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160; </div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;        hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#a69e956e8d2d73d65d015c4ed895ec642">internal</a>-&gt;<a class="code" href="struct_a_v_h_w_frames_internal.html#a2858e1cd83082cc8bcbbf581283e7af2">pool_internal</a> =</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;            <a class="code" href="group__lavu__bufferpool.html#ga615151c8889d5be39d17bce4d8c65117">av_buffer_pool_init2</a>(<span class="keyword">sizeof</span>(VASurfaceID), hwfc,</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;                                 &amp;<a class="code" href="hwcontext__vaapi_8c.html#af9ba84030188934a6f3ee0f2a5a2c544">vaapi_pool_alloc</a>, <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;        <span class="keywordflow">if</span> (!hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#a69e956e8d2d73d65d015c4ed895ec642">internal</a>-&gt;<a class="code" href="struct_a_v_h_w_frames_internal.html#a2858e1cd83082cc8bcbbf581283e7af2">pool_internal</a>) {</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(hwfc, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to create VAAPI surface pool.\n&quot;</span>);</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;            err = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;            <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;        }</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;    }</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160; </div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;    <span class="comment">// Allocate a single surface to test whether vaDeriveImage() is going</span></div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;    <span class="comment">// to work for the specific configuration.</span></div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;    <span class="keywordflow">if</span> (hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#ad67ff3a5828a611d1b1cddd64fc1de71">pool</a>) {</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;        test_surface = <a class="code" href="group__lavu__bufferpool.html#ga2c745ecb4001452423e775b06b20fb7c">av_buffer_pool_get</a>(hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#ad67ff3a5828a611d1b1cddd64fc1de71">pool</a>);</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;        <span class="keywordflow">if</span> (!test_surface) {</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(hwfc, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to allocate a surface from &quot;</span></div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;                   <span class="stringliteral">&quot;user-configured buffer pool.\n&quot;</span>);</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;            err = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;            <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;        }</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;        test_surface = <a class="code" href="group__lavu__bufferpool.html#ga2c745ecb4001452423e775b06b20fb7c">av_buffer_pool_get</a>(hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#a69e956e8d2d73d65d015c4ed895ec642">internal</a>-&gt;<a class="code" href="struct_a_v_h_w_frames_internal.html#a2858e1cd83082cc8bcbbf581283e7af2">pool_internal</a>);</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;        <span class="keywordflow">if</span> (!test_surface) {</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(hwfc, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to allocate a surface from &quot;</span></div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;                   <span class="stringliteral">&quot;internal buffer pool.\n&quot;</span>);</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;            err = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;            <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;        }</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;    }</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;    test_surface_id = (VASurfaceID)(uintptr_t)test_surface-&gt;<a class="code" href="struct_a_v_buffer_ref.html#acb8452e99cd75074b93800b532c6ea4b">data</a>;</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160; </div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;derive_works = 0;</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160; </div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;    err = <a class="code" href="hwcontext__vaapi_8c.html#afa2cc8e7fd536ce24515ff6844e0c150">vaapi_get_image_format</a>(hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#ac9a7dbd0cbfcabc0b1529cb34cf53b6d">device_ctx</a>,</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;                                 hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#a663a9aceca97aa7b2426c9aba6543e4a">sw_format</a>, &amp;expected_format);</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;    <span class="keywordflow">if</span> (err == 0) {</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;        vas = vaDeriveImage(hwctx-&gt;<a class="code" href="struct_a_v_v_a_a_p_i_device_context.html#a89951d5ccfad53ce81444773ea9f774e">display</a>, test_surface_id, &amp;test_image);</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;        <span class="keywordflow">if</span> (vas == VA_STATUS_SUCCESS) {</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;            <span class="keywordflow">if</span> (expected_format-&gt;fourcc == test_image.format.fourcc) {</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;                <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(hwfc, <a class="code" href="group__lavu__log__constants.html#ga5b7221c3afd06848486776bd834a58a5">AV_LOG_DEBUG</a>, <span class="stringliteral">&quot;Direct mapping possible.\n&quot;</span>);</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;                <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;derive_works = 1;</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;                <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(hwfc, <a class="code" href="group__lavu__log__constants.html#ga5b7221c3afd06848486776bd834a58a5">AV_LOG_DEBUG</a>, <span class="stringliteral">&quot;Direct mapping disabled: &quot;</span></div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;                       <span class="stringliteral">&quot;derived image format %08x does not match &quot;</span></div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;                       <span class="stringliteral">&quot;expected format %08x.\n&quot;</span>,</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;                       expected_format-&gt;fourcc, test_image.format.fourcc);</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;            }</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;            vaDestroyImage(hwctx-&gt;<a class="code" href="struct_a_v_v_a_a_p_i_device_context.html#a89951d5ccfad53ce81444773ea9f774e">display</a>, test_image.image_id);</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(hwfc, <a class="code" href="group__lavu__log__constants.html#ga5b7221c3afd06848486776bd834a58a5">AV_LOG_DEBUG</a>, <span class="stringliteral">&quot;Direct mapping disabled: &quot;</span></div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;                   <span class="stringliteral">&quot;deriving image does not work: &quot;</span></div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;                   <span class="stringliteral">&quot;%d (%s).\n&quot;</span>, vas, vaErrorStr(vas));</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;        }</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(hwfc, <a class="code" href="group__lavu__log__constants.html#ga5b7221c3afd06848486776bd834a58a5">AV_LOG_DEBUG</a>, <span class="stringliteral">&quot;Direct mapping disabled: &quot;</span></div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;               <span class="stringliteral">&quot;image format is not supported.\n&quot;</span>);</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;    }</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160; </div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;    <a class="code" href="group__lavu__buffer.html#ga135e9e929b5033bb8f68322497b2effc">av_buffer_unref</a>(&amp;test_surface);</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160; </div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;<a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>:</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;    <a class="code" href="group__lavu__buffer.html#ga135e9e929b5033bb8f68322497b2effc">av_buffer_unref</a>(&amp;test_surface);</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#adba82e1bcd02de510a858fcbedf79ef1">av_freep</a>(&amp;avfc-&gt;<a class="code" href="struct_a_v_v_a_a_p_i_frames_context.html#a18c4ca9956227c498679a823e14e1375">surface_ids</a>);</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#adba82e1bcd02de510a858fcbedf79ef1">av_freep</a>(&amp;<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;attributes);</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;    <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;}</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160; </div>
<div class="line"><a name="l00663"></a><span class="lineno"><a class="line" href="hwcontext__vaapi_8c.html#a880e906f04e5137e4a282b0e71ed99a6">  663</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="hwcontext__vaapi_8c.html#a880e906f04e5137e4a282b0e71ed99a6">vaapi_frames_uninit</a>(<a class="code" href="struct_a_v_h_w_frames_context.html">AVHWFramesContext</a> *hwfc)</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;{</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;    <a class="code" href="struct_a_v_v_a_a_p_i_frames_context.html">AVVAAPIFramesContext</a> *avfc = hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#a54e38c3e4355321e23e0f4c7411cb8ee">hwctx</a>;</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;    <a class="code" href="struct_v_a_a_p_i_frames_context.html">VAAPIFramesContext</a>    *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a> = hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#a69e956e8d2d73d65d015c4ed895ec642">internal</a>-&gt;<a class="code" href="struct_a_v_h_w_frames_internal.html#a503cfeb391ed69856344768fd641a489">priv</a>;</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160; </div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#adba82e1bcd02de510a858fcbedf79ef1">av_freep</a>(&amp;avfc-&gt;<a class="code" href="struct_a_v_v_a_a_p_i_frames_context.html#a18c4ca9956227c498679a823e14e1375">surface_ids</a>);</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#adba82e1bcd02de510a858fcbedf79ef1">av_freep</a>(&amp;<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;attributes);</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;}</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160; </div>
<div class="line"><a name="l00672"></a><span class="lineno"><a class="line" href="hwcontext__vaapi_8c.html#a81e23f5ebcce6cc52f2a1a1cb9cf08bf">  672</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="hwcontext__vaapi_8c.html#a81e23f5ebcce6cc52f2a1a1cb9cf08bf">vaapi_get_buffer</a>(<a class="code" href="struct_a_v_h_w_frames_context.html">AVHWFramesContext</a> *hwfc, <a class="code" href="struct_a_v_frame.html">AVFrame</a> *<a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>)</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;{</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;    <a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>-&gt;buf[0] = <a class="code" href="group__lavu__bufferpool.html#ga2c745ecb4001452423e775b06b20fb7c">av_buffer_pool_get</a>(hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#ad67ff3a5828a611d1b1cddd64fc1de71">pool</a>);</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>-&gt;buf[0])</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160; </div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;    <a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>-&gt;data[3] = <a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>-&gt;buf[0]-&gt;data;</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;    <a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>-&gt;format  = <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5abb09cadf3b2d6b5ce5980401bcf638a8">AV_PIX_FMT_VAAPI</a>;</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;    <a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>-&gt;width   = hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#a9e6f29d0f744930cdd0e8bdff8771520">width</a>;</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;    <a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>-&gt;height  = hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#ae61bbe1d8645a0c573085e29f1d0a58f">height</a>;</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160; </div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;}</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160; </div>
<div class="line"><a name="l00686"></a><span class="lineno"><a class="line" href="hwcontext__vaapi_8c.html#a85da78b8b9ef5dbb13266291c28e6ed7">  686</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="hwcontext__vaapi_8c.html#a85da78b8b9ef5dbb13266291c28e6ed7">vaapi_transfer_get_formats</a>(<a class="code" href="struct_a_v_h_w_frames_context.html">AVHWFramesContext</a> *hwfc,</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;                                      <span class="keyword">enum</span> <a class="code" href="hwcontext_8h.html#aba8d70ed754b2536ca497d7d50ec7b1e">AVHWFrameTransferDirection</a> dir,</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;                                      <span class="keyword">enum</span> <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5">AVPixelFormat</a> **<a class="code" href="signature_8h.html#a12f58149bb2cdab504621ba5b390ef64">formats</a>)</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;{</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;    <a class="code" href="struct_v_a_a_p_i_device_context.html">VAAPIDeviceContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a> = hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#ac9a7dbd0cbfcabc0b1529cb34cf53b6d">device_ctx</a>-&gt;<a class="code" href="struct_a_v_h_w_device_context.html#a9c3758c73b0f29925ccb2f60b5c1a803">internal</a>-&gt;<a class="code" href="struct_a_v_h_w_device_internal.html#ae7425663cca9541964518c66974a20bf">priv</a>;</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;    <span class="keyword">enum</span> <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5">AVPixelFormat</a> *<a class="code" href="libkvazaar_8c.html#aa1219ee396a270ba57fd4f2306b64c6e">pix_fmts</a>;</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>, k, sw_format_available;</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160; </div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;    sw_format_available = 0;</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nb_formats; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;formats[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].pix_fmt == hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#a663a9aceca97aa7b2426c9aba6543e4a">sw_format</a>)</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;            sw_format_available = 1;</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;    }</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160; </div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;    <a class="code" href="libkvazaar_8c.html#aa1219ee396a270ba57fd4f2306b64c6e">pix_fmts</a> = <a class="code" href="tableprint__vlc_8h.html#ae97db1f58b6b1515ed57a83bea3dd572">av_malloc</a>((<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nb_formats + 1) * <span class="keyword">sizeof</span>(*<a class="code" href="libkvazaar_8c.html#aa1219ee396a270ba57fd4f2306b64c6e">pix_fmts</a>));</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="libkvazaar_8c.html#aa1219ee396a270ba57fd4f2306b64c6e">pix_fmts</a>)</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160; </div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;    <span class="keywordflow">if</span> (sw_format_available) {</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;        <a class="code" href="libkvazaar_8c.html#aa1219ee396a270ba57fd4f2306b64c6e">pix_fmts</a>[0] = hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#a663a9aceca97aa7b2426c9aba6543e4a">sw_format</a>;</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;        k = 1;</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;        k = 0;</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;    }</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;nb_formats; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;formats[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].pix_fmt == hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#a663a9aceca97aa7b2426c9aba6543e4a">sw_format</a>)</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;        <a class="code" href="avassert_8h.html#aae204192396f78cc8c5cd7ad5c57c23f">av_assert0</a>(k &lt; ctx-&gt;nb_formats);</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;        <a class="code" href="libkvazaar_8c.html#aa1219ee396a270ba57fd4f2306b64c6e">pix_fmts</a>[k++] = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;formats[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].pix_fmt;</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;    }</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;    <a class="code" href="libkvazaar_8c.html#aa1219ee396a270ba57fd4f2306b64c6e">pix_fmts</a>[k] = <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a0e08f8a5d0fa21c3e258816a9dcce7c3">AV_PIX_FMT_NONE</a>;</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160; </div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;    *<a class="code" href="signature_8h.html#a12f58149bb2cdab504621ba5b390ef64">formats</a> = <a class="code" href="libkvazaar_8c.html#aa1219ee396a270ba57fd4f2306b64c6e">pix_fmts</a>;</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;}</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160; </div>
<div class="line"><a name="l00722"></a><span class="lineno"><a class="line" href="hwcontext__vaapi_8c.html#a94f3e1762f66fcbf7c5d77b30a419e5d">  722</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="hwcontext__vaapi_8c.html#a94f3e1762f66fcbf7c5d77b30a419e5d">vaapi_unmap_frame</a>(<a class="code" href="struct_a_v_h_w_frames_context.html">AVHWFramesContext</a> *hwfc,</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;                              <a class="code" href="struct_h_w_map_descriptor.html">HWMapDescriptor</a> *hwmap)</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;{</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;    <a class="code" href="struct_a_v_v_a_a_p_i_device_context.html">AVVAAPIDeviceContext</a> *hwctx = hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#ac9a7dbd0cbfcabc0b1529cb34cf53b6d">device_ctx</a>-&gt;<a class="code" href="struct_a_v_h_w_device_context.html#a46055b48d1a40445d775b4ae24f77f20">hwctx</a>;</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;    <a class="code" href="struct_v_a_a_p_i_mapping.html">VAAPIMapping</a>           *<a class="code" href="hwcontext__vdpau_8c.html#a2996cc16b36e13c9010705bad768e866">map</a> = hwmap-&gt;<a class="code" href="struct_h_w_map_descriptor.html#a7ecea93e498181196f2121b85c07411d">priv</a>;</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;    VASurfaceID surface_id;</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;    VAStatus vas;</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160; </div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;    surface_id = (VASurfaceID)(uintptr_t)hwmap-&gt;<a class="code" href="struct_h_w_map_descriptor.html#aac9a3c77af4a936a326770ee5973e261">source</a>-&gt;<a class="code" href="struct_a_v_frame.html#a1d0f65014a8d1bf78cec8cbed2304992">data</a>[3];</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(hwfc, <a class="code" href="group__lavu__log__constants.html#ga5b7221c3afd06848486776bd834a58a5">AV_LOG_DEBUG</a>, <span class="stringliteral">&quot;Unmap surface %#x.\n&quot;</span>, surface_id);</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160; </div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;    vas = vaUnmapBuffer(hwctx-&gt;<a class="code" href="struct_a_v_v_a_a_p_i_device_context.html#a89951d5ccfad53ce81444773ea9f774e">display</a>, <a class="code" href="hwcontext__vdpau_8c.html#a2996cc16b36e13c9010705bad768e866">map</a>-&gt;image.buf);</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;    <span class="keywordflow">if</span> (vas != VA_STATUS_SUCCESS) {</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(hwfc, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to unmap image from surface &quot;</span></div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;               <span class="stringliteral">&quot;%#x: %d (%s).\n&quot;</span>, surface_id, vas, vaErrorStr(vas));</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;    }</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160; </div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;    <span class="keywordflow">if</span> ((<a class="code" href="hwcontext__vdpau_8c.html#a2996cc16b36e13c9010705bad768e866">map</a>-&gt;flags &amp; <a class="code" href="group__avoptions.html#gga06fc87d81c62e9abb8790b6e5713c55bab2e22cc927a3d88fe833b50bf3d71948">AV_HWFRAME_MAP_WRITE</a>) &amp;&amp;</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;        !(<a class="code" href="hwcontext__vdpau_8c.html#a2996cc16b36e13c9010705bad768e866">map</a>-&gt;flags &amp; <a class="code" href="group__avoptions.html#gga06fc87d81c62e9abb8790b6e5713c55ba9f73eea942c7ed1ad5d56918bffa4ce3">AV_HWFRAME_MAP_DIRECT</a>)) {</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;        vas = vaPutImage(hwctx-&gt;<a class="code" href="struct_a_v_v_a_a_p_i_device_context.html#a89951d5ccfad53ce81444773ea9f774e">display</a>, surface_id, <a class="code" href="hwcontext__vdpau_8c.html#a2996cc16b36e13c9010705bad768e866">map</a>-&gt;image.image_id,</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;                         0, 0, hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#a9e6f29d0f744930cdd0e8bdff8771520">width</a>, hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#ae61bbe1d8645a0c573085e29f1d0a58f">height</a>,</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;                         0, 0, hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#a9e6f29d0f744930cdd0e8bdff8771520">width</a>, hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#ae61bbe1d8645a0c573085e29f1d0a58f">height</a>);</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;        <span class="keywordflow">if</span> (vas != VA_STATUS_SUCCESS) {</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(hwfc, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to write image to surface &quot;</span></div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;                   <span class="stringliteral">&quot;%#x: %d (%s).\n&quot;</span>, surface_id, vas, vaErrorStr(vas));</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;        }</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;    }</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160; </div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;    vas = vaDestroyImage(hwctx-&gt;<a class="code" href="struct_a_v_v_a_a_p_i_device_context.html#a89951d5ccfad53ce81444773ea9f774e">display</a>, <a class="code" href="hwcontext__vdpau_8c.html#a2996cc16b36e13c9010705bad768e866">map</a>-&gt;image.image_id);</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;    <span class="keywordflow">if</span> (vas != VA_STATUS_SUCCESS) {</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(hwfc, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to destroy image from surface &quot;</span></div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;               <span class="stringliteral">&quot;%#x: %d (%s).\n&quot;</span>, surface_id, vas, vaErrorStr(vas));</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;    }</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160; </div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#a079eab092887563f2bef9106c6120089">av_free</a>(<a class="code" href="hwcontext__vdpau_8c.html#a2996cc16b36e13c9010705bad768e866">map</a>);</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;}</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160; </div>
<div class="line"><a name="l00759"></a><span class="lineno"><a class="line" href="hwcontext__vaapi_8c.html#a79703b1c498f43f86346e321f7eac553">  759</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="hwcontext__vaapi_8c.html#a79703b1c498f43f86346e321f7eac553">vaapi_map_frame</a>(<a class="code" href="struct_a_v_h_w_frames_context.html">AVHWFramesContext</a> *hwfc,</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;                           <a class="code" href="struct_a_v_frame.html">AVFrame</a> *dst, <span class="keyword">const</span> <a class="code" href="struct_a_v_frame.html">AVFrame</a> *<a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>, <span class="keywordtype">int</span> <a class="code" href="cbs__av1_8c.html#a67119bce106892b6dade1dc5aa405ac9">flags</a>)</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;{</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;    <a class="code" href="struct_a_v_v_a_a_p_i_device_context.html">AVVAAPIDeviceContext</a> *hwctx = hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#ac9a7dbd0cbfcabc0b1529cb34cf53b6d">device_ctx</a>-&gt;<a class="code" href="struct_a_v_h_w_device_context.html#a46055b48d1a40445d775b4ae24f77f20">hwctx</a>;</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;    <a class="code" href="struct_v_a_a_p_i_frames_context.html">VAAPIFramesContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a> = hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#a69e956e8d2d73d65d015c4ed895ec642">internal</a>-&gt;<a class="code" href="struct_a_v_h_w_frames_internal.html#a503cfeb391ed69856344768fd641a489">priv</a>;</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;    VASurfaceID surface_id;</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;    <span class="keyword">const</span> <a class="code" href="struct_v_a_a_p_i_format.html">VAAPIFormatDescriptor</a> *<a class="code" href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a>;</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;    VAImageFormat *image_format;</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;    <a class="code" href="struct_v_a_a_p_i_mapping.html">VAAPIMapping</a> *<a class="code" href="hwcontext__vdpau_8c.html#a2996cc16b36e13c9010705bad768e866">map</a>;</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;    VAStatus vas;</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;    <span class="keywordtype">void</span> *address = <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;    <span class="keywordtype">int</span> err, <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160; </div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;    surface_id = (VASurfaceID)(uintptr_t)<a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>-&gt;data[3];</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(hwfc, <a class="code" href="group__lavu__log__constants.html#ga5b7221c3afd06848486776bd834a58a5">AV_LOG_DEBUG</a>, <span class="stringliteral">&quot;Map surface %#x.\n&quot;</span>, surface_id);</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160; </div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;derive_works &amp;&amp; (<a class="code" href="cbs__av1_8c.html#a67119bce106892b6dade1dc5aa405ac9">flags</a> &amp; <a class="code" href="group__avoptions.html#gga06fc87d81c62e9abb8790b6e5713c55ba9f73eea942c7ed1ad5d56918bffa4ce3">AV_HWFRAME_MAP_DIRECT</a>)) {</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;        <span class="comment">// Requested direct mapping but it is not possible.</span></div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EINVAL);</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;    }</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;    <span class="keywordflow">if</span> (dst-&gt;<a class="code" href="struct_a_v_frame.html#aed14fa772ce46881020fd1545c86432c">format</a> == <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a0e08f8a5d0fa21c3e258816a9dcce7c3">AV_PIX_FMT_NONE</a>)</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;        dst-&gt;<a class="code" href="struct_a_v_frame.html#aed14fa772ce46881020fd1545c86432c">format</a> = hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#a663a9aceca97aa7b2426c9aba6543e4a">sw_format</a>;</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;    <span class="keywordflow">if</span> (dst-&gt;<a class="code" href="struct_a_v_frame.html#aed14fa772ce46881020fd1545c86432c">format</a> != hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#a663a9aceca97aa7b2426c9aba6543e4a">sw_format</a> &amp;&amp; (<a class="code" href="cbs__av1_8c.html#a67119bce106892b6dade1dc5aa405ac9">flags</a> &amp; <a class="code" href="group__avoptions.html#gga06fc87d81c62e9abb8790b6e5713c55ba9f73eea942c7ed1ad5d56918bffa4ce3">AV_HWFRAME_MAP_DIRECT</a>)) {</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;        <span class="comment">// Requested direct mapping but the formats do not match.</span></div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EINVAL);</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;    }</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160; </div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;    err = <a class="code" href="hwcontext__vaapi_8c.html#afa2cc8e7fd536ce24515ff6844e0c150">vaapi_get_image_format</a>(hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#ac9a7dbd0cbfcabc0b1529cb34cf53b6d">device_ctx</a>, dst-&gt;<a class="code" href="struct_a_v_frame.html#aed14fa772ce46881020fd1545c86432c">format</a>, &amp;image_format);</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;    <span class="keywordflow">if</span> (err &lt; 0) {</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;        <span class="comment">// Requested format is not a valid output format.</span></div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EINVAL);</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;    }</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160; </div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;    <a class="code" href="hwcontext__vdpau_8c.html#a2996cc16b36e13c9010705bad768e866">map</a> = <a class="code" href="tableprint__vlc_8h.html#ae97db1f58b6b1515ed57a83bea3dd572">av_malloc</a>(<span class="keyword">sizeof</span>(*<a class="code" href="hwcontext__vdpau_8c.html#a2996cc16b36e13c9010705bad768e866">map</a>));</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="hwcontext__vdpau_8c.html#a2996cc16b36e13c9010705bad768e866">map</a>)</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;    <a class="code" href="hwcontext__vdpau_8c.html#a2996cc16b36e13c9010705bad768e866">map</a>-&gt;flags = <a class="code" href="cbs__av1_8c.html#a67119bce106892b6dade1dc5aa405ac9">flags</a>;</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;    <a class="code" href="hwcontext__vdpau_8c.html#a2996cc16b36e13c9010705bad768e866">map</a>-&gt;image.image_id = VA_INVALID_ID;</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160; </div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;    vas = vaSyncSurface(hwctx-&gt;<a class="code" href="struct_a_v_v_a_a_p_i_device_context.html#a89951d5ccfad53ce81444773ea9f774e">display</a>, surface_id);</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;    <span class="keywordflow">if</span> (vas != VA_STATUS_SUCCESS) {</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(hwfc, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to sync surface &quot;</span></div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;               <span class="stringliteral">&quot;%#x: %d (%s).\n&quot;</span>, surface_id, vas, vaErrorStr(vas));</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;        err = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EIO);</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;    }</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160; </div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;    <span class="comment">// The memory which we map using derive need not be connected to the CPU</span></div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;    <span class="comment">// in a way conducive to fast access.  On Gen7-Gen9 Intel graphics, the</span></div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;    <span class="comment">// memory is mappable but not cached, so normal memcpy()-like access is</span></div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;    <span class="comment">// very slow to read it (but writing is ok).  It is possible to read much</span></div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;    <span class="comment">// faster with a copy routine which is aware of the limitation, but we</span></div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;    <span class="comment">// assume for now that the user is not aware of that and would therefore</span></div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;    <span class="comment">// prefer not to be given direct-mapped memory if they request read access.</span></div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;derive_works &amp;&amp; dst-&gt;<a class="code" href="struct_a_v_frame.html#aed14fa772ce46881020fd1545c86432c">format</a> == hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#a663a9aceca97aa7b2426c9aba6543e4a">sw_format</a> &amp;&amp;</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;        ((<a class="code" href="cbs__av1_8c.html#a67119bce106892b6dade1dc5aa405ac9">flags</a> &amp; <a class="code" href="group__avoptions.html#gga06fc87d81c62e9abb8790b6e5713c55ba9f73eea942c7ed1ad5d56918bffa4ce3">AV_HWFRAME_MAP_DIRECT</a>) || !(<a class="code" href="cbs__av1_8c.html#a67119bce106892b6dade1dc5aa405ac9">flags</a> &amp; <a class="code" href="group__avoptions.html#gga06fc87d81c62e9abb8790b6e5713c55ba236262031fe4c5503b2611c2c8fb520b">AV_HWFRAME_MAP_READ</a>))) {</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;        vas = vaDeriveImage(hwctx-&gt;<a class="code" href="struct_a_v_v_a_a_p_i_device_context.html#a89951d5ccfad53ce81444773ea9f774e">display</a>, surface_id, &amp;<a class="code" href="hwcontext__vdpau_8c.html#a2996cc16b36e13c9010705bad768e866">map</a>-&gt;image);</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;        <span class="keywordflow">if</span> (vas != VA_STATUS_SUCCESS) {</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(hwfc, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to derive image from &quot;</span></div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;                   <span class="stringliteral">&quot;surface %#x: %d (%s).\n&quot;</span>,</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;                   surface_id, vas, vaErrorStr(vas));</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;            err = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EIO);</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;            <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;        }</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="hwcontext__vdpau_8c.html#a2996cc16b36e13c9010705bad768e866">map</a>-&gt;image.format.fourcc != image_format-&gt;fourcc) {</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(hwfc, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Derive image of surface %#x &quot;</span></div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;                   <span class="stringliteral">&quot;is in wrong format: expected %#08x, got %#08x.\n&quot;</span>,</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;                   surface_id, image_format-&gt;fourcc, <a class="code" href="hwcontext__vdpau_8c.html#a2996cc16b36e13c9010705bad768e866">map</a>-&gt;image.format.fourcc);</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;            err = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EIO);</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;            <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;        }</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;        <a class="code" href="hwcontext__vdpau_8c.html#a2996cc16b36e13c9010705bad768e866">map</a>-&gt;flags |= <a class="code" href="group__avoptions.html#gga06fc87d81c62e9abb8790b6e5713c55ba9f73eea942c7ed1ad5d56918bffa4ce3">AV_HWFRAME_MAP_DIRECT</a>;</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;        vas = vaCreateImage(hwctx-&gt;<a class="code" href="struct_a_v_v_a_a_p_i_device_context.html#a89951d5ccfad53ce81444773ea9f774e">display</a>, image_format,</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;                            hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#a9e6f29d0f744930cdd0e8bdff8771520">width</a>, hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#ae61bbe1d8645a0c573085e29f1d0a58f">height</a>, &amp;<a class="code" href="hwcontext__vdpau_8c.html#a2996cc16b36e13c9010705bad768e866">map</a>-&gt;image);</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;        <span class="keywordflow">if</span> (vas != VA_STATUS_SUCCESS) {</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(hwfc, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to create image for &quot;</span></div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;                   <span class="stringliteral">&quot;surface %#x: %d (%s).\n&quot;</span>,</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;                   surface_id, vas, vaErrorStr(vas));</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;            err = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EIO);</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;            <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;        }</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;        <span class="keywordflow">if</span> (!(<a class="code" href="cbs__av1_8c.html#a67119bce106892b6dade1dc5aa405ac9">flags</a> &amp; <a class="code" href="group__avoptions.html#gga06fc87d81c62e9abb8790b6e5713c55bac12b0a2a379fe4b4b00353aac56ed9f4">AV_HWFRAME_MAP_OVERWRITE</a>)) {</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;            vas = vaGetImage(hwctx-&gt;<a class="code" href="struct_a_v_v_a_a_p_i_device_context.html#a89951d5ccfad53ce81444773ea9f774e">display</a>, surface_id, 0, 0,</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;                             hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#a9e6f29d0f744930cdd0e8bdff8771520">width</a>, hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#ae61bbe1d8645a0c573085e29f1d0a58f">height</a>, <a class="code" href="hwcontext__vdpau_8c.html#a2996cc16b36e13c9010705bad768e866">map</a>-&gt;image.image_id);</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;            <span class="keywordflow">if</span> (vas != VA_STATUS_SUCCESS) {</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;                <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(hwfc, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to read image from &quot;</span></div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;                       <span class="stringliteral">&quot;surface %#x: %d (%s).\n&quot;</span>,</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;                       surface_id, vas, vaErrorStr(vas));</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;                err = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EIO);</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;                <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;            }</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;        }</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;    }</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160; </div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;    vas = vaMapBuffer(hwctx-&gt;<a class="code" href="struct_a_v_v_a_a_p_i_device_context.html#a89951d5ccfad53ce81444773ea9f774e">display</a>, <a class="code" href="hwcontext__vdpau_8c.html#a2996cc16b36e13c9010705bad768e866">map</a>-&gt;image.buf, &amp;address);</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;    <span class="keywordflow">if</span> (vas != VA_STATUS_SUCCESS) {</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(hwfc, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to map image from surface &quot;</span></div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;               <span class="stringliteral">&quot;%#x: %d (%s).\n&quot;</span>, surface_id, vas, vaErrorStr(vas));</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;        err = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EIO);</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;    }</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160; </div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;    err = <a class="code" href="hwcontext_8c.html#a76e0387f519b3f1bd1b162e91b54b182">ff_hwframe_map_create</a>(<a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>-&gt;hw_frames_ctx,</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;                                dst, <a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>, &amp;<a class="code" href="hwcontext__vaapi_8c.html#a94f3e1762f66fcbf7c5d77b30a419e5d">vaapi_unmap_frame</a>, <a class="code" href="hwcontext__vdpau_8c.html#a2996cc16b36e13c9010705bad768e866">map</a>);</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;    <span class="keywordflow">if</span> (err &lt; 0)</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160; </div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;    dst-&gt;<a class="code" href="struct_a_v_frame.html#a1e71ce60cedd5f3b6811714a9f7f9e0a">width</a>  = <a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>-&gt;width;</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;    dst-&gt;<a class="code" href="struct_a_v_frame.html#a3f89733f429c98ba5bc64373fb0a3f13">height</a> = <a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>-&gt;height;</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160; </div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="hwcontext__vdpau_8c.html#a2996cc16b36e13c9010705bad768e866">map</a>-&gt;image.num_planes; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;        dst-&gt;<a class="code" href="struct_a_v_frame.html#a1d0f65014a8d1bf78cec8cbed2304992">data</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>] = (<a class="code" href="audio__convert_8c.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a>*)address + <a class="code" href="hwcontext__vdpau_8c.html#a2996cc16b36e13c9010705bad768e866">map</a>-&gt;image.offsets[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;        dst-&gt;<a class="code" href="struct_a_v_frame.html#aa52bfc6605f6a3059a0c3226cc0f6567">linesize</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code" href="hwcontext__vdpau_8c.html#a2996cc16b36e13c9010705bad768e866">map</a>-&gt;image.pitches[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;    }</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160; </div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;    <a class="code" href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a> = <a class="code" href="hwcontext__vaapi_8c.html#a48b950ed906a38b88245800841cc954e">vaapi_format_from_fourcc</a>(<a class="code" href="hwcontext__vdpau_8c.html#a2996cc16b36e13c9010705bad768e866">map</a>-&gt;image.format.fourcc);</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a> &amp;&amp; <a class="code" href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a>-&gt;chroma_planes_swapped) {</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;        <span class="comment">// Chroma planes are YVU rather than YUV, so swap them.</span></div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;        <a class="code" href="common_8h.html#a09a0bb7d8fcfac416de7a5fe7fd8b0f1">FFSWAP</a>(<a class="code" href="audio__convert_8c.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a>*, dst-&gt;<a class="code" href="struct_a_v_frame.html#a1d0f65014a8d1bf78cec8cbed2304992">data</a>[1], dst-&gt;<a class="code" href="struct_a_v_frame.html#a1d0f65014a8d1bf78cec8cbed2304992">data</a>[2]);</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;    }</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160; </div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160; </div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;<a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>:</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="hwcontext__vdpau_8c.html#a2996cc16b36e13c9010705bad768e866">map</a>) {</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;        <span class="keywordflow">if</span> (address)</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;            vaUnmapBuffer(hwctx-&gt;<a class="code" href="struct_a_v_v_a_a_p_i_device_context.html#a89951d5ccfad53ce81444773ea9f774e">display</a>, <a class="code" href="hwcontext__vdpau_8c.html#a2996cc16b36e13c9010705bad768e866">map</a>-&gt;image.buf);</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="hwcontext__vdpau_8c.html#a2996cc16b36e13c9010705bad768e866">map</a>-&gt;image.image_id != VA_INVALID_ID)</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;            vaDestroyImage(hwctx-&gt;<a class="code" href="struct_a_v_v_a_a_p_i_device_context.html#a89951d5ccfad53ce81444773ea9f774e">display</a>, <a class="code" href="hwcontext__vdpau_8c.html#a2996cc16b36e13c9010705bad768e866">map</a>-&gt;image.image_id);</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#a079eab092887563f2bef9106c6120089">av_free</a>(<a class="code" href="hwcontext__vdpau_8c.html#a2996cc16b36e13c9010705bad768e866">map</a>);</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;    }</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;    <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;}</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160; </div>
<div class="line"><a name="l00894"></a><span class="lineno"><a class="line" href="hwcontext__vaapi_8c.html#a051c6a28933259bd6ede158e606521fc">  894</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="hwcontext__vaapi_8c.html#a051c6a28933259bd6ede158e606521fc">vaapi_transfer_data_from</a>(<a class="code" href="struct_a_v_h_w_frames_context.html">AVHWFramesContext</a> *hwfc,</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;                                    <a class="code" href="struct_a_v_frame.html">AVFrame</a> *dst, <span class="keyword">const</span> <a class="code" href="struct_a_v_frame.html">AVFrame</a> *<a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>)</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;{</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;    <a class="code" href="struct_a_v_frame.html">AVFrame</a> *<a class="code" href="hwcontext__vdpau_8c.html#a2996cc16b36e13c9010705bad768e866">map</a>;</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;    <span class="keywordtype">int</span> err;</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160; </div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;    <span class="keywordflow">if</span> (dst-&gt;<a class="code" href="struct_a_v_frame.html#a1e71ce60cedd5f3b6811714a9f7f9e0a">width</a> &gt; hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#a9e6f29d0f744930cdd0e8bdff8771520">width</a> || dst-&gt;<a class="code" href="struct_a_v_frame.html#a3f89733f429c98ba5bc64373fb0a3f13">height</a> &gt; hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#ae61bbe1d8645a0c573085e29f1d0a58f">height</a>)</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EINVAL);</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160; </div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;    <a class="code" href="hwcontext__vdpau_8c.html#a2996cc16b36e13c9010705bad768e866">map</a> = <a class="code" href="group__lavu__frame.html#gac700017c5270c79c1e1befdeeb008b2f">av_frame_alloc</a>();</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="hwcontext__vdpau_8c.html#a2996cc16b36e13c9010705bad768e866">map</a>)</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;    <a class="code" href="hwcontext__vdpau_8c.html#a2996cc16b36e13c9010705bad768e866">map</a>-&gt;format = dst-&gt;<a class="code" href="struct_a_v_frame.html#aed14fa772ce46881020fd1545c86432c">format</a>;</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160; </div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;    err = <a class="code" href="hwcontext__vaapi_8c.html#a79703b1c498f43f86346e321f7eac553">vaapi_map_frame</a>(hwfc, <a class="code" href="hwcontext__vdpau_8c.html#a2996cc16b36e13c9010705bad768e866">map</a>, <a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>, <a class="code" href="group__avoptions.html#gga06fc87d81c62e9abb8790b6e5713c55ba236262031fe4c5503b2611c2c8fb520b">AV_HWFRAME_MAP_READ</a>);</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;    <span class="keywordflow">if</span> (err)</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160; </div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;    <a class="code" href="hwcontext__vdpau_8c.html#a2996cc16b36e13c9010705bad768e866">map</a>-&gt;width  = dst-&gt;<a class="code" href="struct_a_v_frame.html#a1e71ce60cedd5f3b6811714a9f7f9e0a">width</a>;</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;    <a class="code" href="hwcontext__vdpau_8c.html#a2996cc16b36e13c9010705bad768e866">map</a>-&gt;height = dst-&gt;<a class="code" href="struct_a_v_frame.html#a3f89733f429c98ba5bc64373fb0a3f13">height</a>;</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160; </div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;    err = <a class="code" href="group__lavu__frame.html#gaec4e92f6e1e75ffaf76e07586fb0c9ed">av_frame_copy</a>(dst, <a class="code" href="hwcontext__vdpau_8c.html#a2996cc16b36e13c9010705bad768e866">map</a>);</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;    <span class="keywordflow">if</span> (err)</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160; </div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;    err = 0;</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;<a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>:</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;    <a class="code" href="group__lavu__frame.html#ga979d73f3228814aee56aeca0636e37cc">av_frame_free</a>(&amp;<a class="code" href="hwcontext__vdpau_8c.html#a2996cc16b36e13c9010705bad768e866">map</a>);</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;    <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;}</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160; </div>
<div class="line"><a name="l00925"></a><span class="lineno"><a class="line" href="hwcontext__vaapi_8c.html#a2d479217c74cf77279763dd3d10ea497">  925</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="hwcontext__vaapi_8c.html#a2d479217c74cf77279763dd3d10ea497">vaapi_transfer_data_to</a>(<a class="code" href="struct_a_v_h_w_frames_context.html">AVHWFramesContext</a> *hwfc,</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;                                  <a class="code" href="struct_a_v_frame.html">AVFrame</a> *dst, <span class="keyword">const</span> <a class="code" href="struct_a_v_frame.html">AVFrame</a> *<a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>)</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;{</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;    <a class="code" href="struct_a_v_frame.html">AVFrame</a> *<a class="code" href="hwcontext__vdpau_8c.html#a2996cc16b36e13c9010705bad768e866">map</a>;</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;    <span class="keywordtype">int</span> err;</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160; </div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>-&gt;width &gt; hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#a9e6f29d0f744930cdd0e8bdff8771520">width</a> || <a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>-&gt;height &gt; hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#ae61bbe1d8645a0c573085e29f1d0a58f">height</a>)</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EINVAL);</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160; </div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;    <a class="code" href="hwcontext__vdpau_8c.html#a2996cc16b36e13c9010705bad768e866">map</a> = <a class="code" href="group__lavu__frame.html#gac700017c5270c79c1e1befdeeb008b2f">av_frame_alloc</a>();</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="hwcontext__vdpau_8c.html#a2996cc16b36e13c9010705bad768e866">map</a>)</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;    <a class="code" href="hwcontext__vdpau_8c.html#a2996cc16b36e13c9010705bad768e866">map</a>-&gt;format = <a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>-&gt;format;</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160; </div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;    err = <a class="code" href="hwcontext__vaapi_8c.html#a79703b1c498f43f86346e321f7eac553">vaapi_map_frame</a>(hwfc, <a class="code" href="hwcontext__vdpau_8c.html#a2996cc16b36e13c9010705bad768e866">map</a>, dst, <a class="code" href="group__avoptions.html#gga06fc87d81c62e9abb8790b6e5713c55bab2e22cc927a3d88fe833b50bf3d71948">AV_HWFRAME_MAP_WRITE</a> | <a class="code" href="group__avoptions.html#gga06fc87d81c62e9abb8790b6e5713c55bac12b0a2a379fe4b4b00353aac56ed9f4">AV_HWFRAME_MAP_OVERWRITE</a>);</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;    <span class="keywordflow">if</span> (err)</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160; </div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;    <a class="code" href="hwcontext__vdpau_8c.html#a2996cc16b36e13c9010705bad768e866">map</a>-&gt;width  = <a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>-&gt;width;</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;    <a class="code" href="hwcontext__vdpau_8c.html#a2996cc16b36e13c9010705bad768e866">map</a>-&gt;height = <a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>-&gt;height;</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160; </div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;    err = <a class="code" href="group__lavu__frame.html#gaec4e92f6e1e75ffaf76e07586fb0c9ed">av_frame_copy</a>(<a class="code" href="hwcontext__vdpau_8c.html#a2996cc16b36e13c9010705bad768e866">map</a>, <a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>);</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;    <span class="keywordflow">if</span> (err)</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160; </div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;    err = 0;</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;<a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>:</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;    <a class="code" href="group__lavu__frame.html#ga979d73f3228814aee56aeca0636e37cc">av_frame_free</a>(&amp;<a class="code" href="hwcontext__vdpau_8c.html#a2996cc16b36e13c9010705bad768e866">map</a>);</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;    <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;}</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160; </div>
<div class="line"><a name="l00956"></a><span class="lineno"><a class="line" href="hwcontext__vaapi_8c.html#ace0f3086d25b9a5ef42e3ef3e9b4e2b2">  956</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="hwcontext__vaapi_8c.html#ace0f3086d25b9a5ef42e3ef3e9b4e2b2">vaapi_map_to_memory</a>(<a class="code" href="struct_a_v_h_w_frames_context.html">AVHWFramesContext</a> *hwfc, <a class="code" href="struct_a_v_frame.html">AVFrame</a> *dst,</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;                               <span class="keyword">const</span> <a class="code" href="struct_a_v_frame.html">AVFrame</a> *<a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>, <span class="keywordtype">int</span> <a class="code" href="cbs__av1_8c.html#a67119bce106892b6dade1dc5aa405ac9">flags</a>)</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;{</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;    <span class="keywordtype">int</span> err;</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160; </div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;    <span class="keywordflow">if</span> (dst-&gt;<a class="code" href="struct_a_v_frame.html#aed14fa772ce46881020fd1545c86432c">format</a> != <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a0e08f8a5d0fa21c3e258816a9dcce7c3">AV_PIX_FMT_NONE</a>) {</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;        err = <a class="code" href="hwcontext__vaapi_8c.html#afa2cc8e7fd536ce24515ff6844e0c150">vaapi_get_image_format</a>(hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#ac9a7dbd0cbfcabc0b1529cb34cf53b6d">device_ctx</a>, dst-&gt;<a class="code" href="struct_a_v_frame.html#aed14fa772ce46881020fd1545c86432c">format</a>, <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;        <span class="keywordflow">if</span> (err &lt; 0)</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOSYS);</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;    }</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160; </div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;    err = <a class="code" href="hwcontext__vaapi_8c.html#a79703b1c498f43f86346e321f7eac553">vaapi_map_frame</a>(hwfc, dst, <a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>, <a class="code" href="cbs__av1_8c.html#a67119bce106892b6dade1dc5aa405ac9">flags</a>);</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;    <span class="keywordflow">if</span> (err)</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;        <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160; </div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;    err = <a class="code" href="group__lavu__frame.html#gab9b275b114ace0db95c5796bc71f3012">av_frame_copy_props</a>(dst, <a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>);</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;    <span class="keywordflow">if</span> (err)</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;        <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160; </div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;}</div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160; </div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;<span class="preprocessor">#if CONFIG_LIBDRM</span></div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160; </div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;<span class="preprocessor">#define DRM_MAP(va, layers, ...) { \</span></div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;<span class="preprocessor">        VA_FOURCC_ ## va, \</span></div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;<span class="preprocessor">        layers, \</span></div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;<span class="preprocessor">        { __VA_ARGS__ } \</span></div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;<span class="preprocessor">    }</span></div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">struct </span>{</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;    uint32_t va_fourcc;</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;    <span class="keywordtype">int</span>   nb_layer_formats;</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;    uint32_t layer_formats[<a class="code" href="group__avoptions.html#gga06fc87d81c62e9abb8790b6e5713c55ba8f29c39f016d0bf9a006b180b859ba4f">AV_DRM_MAX_PLANES</a>];</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;} vaapi_drm_format_map[] = {</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;<span class="preprocessor">#ifdef DRM_FORMAT_R8</span></div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;    DRM_MAP(NV12, 2, DRM_FORMAT_R8,  DRM_FORMAT_RG88),</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;    DRM_MAP(NV12, 1, DRM_FORMAT_NV12),</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;<span class="preprocessor">#if defined(VA_FOURCC_P010) &amp;&amp; defined(DRM_FORMAT_R16)</span></div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;    DRM_MAP(P010, 2, DRM_FORMAT_R16, DRM_FORMAT_RG1616),</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;    DRM_MAP(BGRA, 1, DRM_FORMAT_ARGB8888),</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;    DRM_MAP(BGRX, 1, DRM_FORMAT_XRGB8888),</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;    DRM_MAP(<a class="code" href="dvbsubdec_8c.html#aba32782053c6a2b01e3706d632d77895">RGBA</a>, 1, DRM_FORMAT_ABGR8888),</div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;    DRM_MAP(RGBX, 1, DRM_FORMAT_XBGR8888),</div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;<span class="preprocessor">#ifdef VA_FOURCC_ABGR</span></div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;    DRM_MAP(ABGR, 1, DRM_FORMAT_RGBA8888),</div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;    DRM_MAP(XBGR, 1, DRM_FORMAT_RGBX8888),</div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;    DRM_MAP(ARGB, 1, DRM_FORMAT_BGRA8888),</div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;    DRM_MAP(XRGB, 1, DRM_FORMAT_BGRX8888),</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;};</div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;<span class="preprocessor">#undef DRM_MAP</span></div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160; </div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> vaapi_unmap_from_drm(<a class="code" href="struct_a_v_h_w_frames_context.html">AVHWFramesContext</a> *dst_fc,</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;                                 <a class="code" href="struct_h_w_map_descriptor.html">HWMapDescriptor</a> *hwmap)</div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;{</div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;    <a class="code" href="struct_a_v_v_a_a_p_i_device_context.html">AVVAAPIDeviceContext</a> *dst_dev = dst_fc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#ac9a7dbd0cbfcabc0b1529cb34cf53b6d">device_ctx</a>-&gt;<a class="code" href="struct_a_v_h_w_device_context.html#a46055b48d1a40445d775b4ae24f77f20">hwctx</a>;</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160; </div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;    VASurfaceID surface_id = (VASurfaceID)(uintptr_t)hwmap-&gt;<a class="code" href="struct_h_w_map_descriptor.html#a7ecea93e498181196f2121b85c07411d">priv</a>;</div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160; </div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(dst_fc, <a class="code" href="group__lavu__log__constants.html#ga5b7221c3afd06848486776bd834a58a5">AV_LOG_DEBUG</a>, <span class="stringliteral">&quot;Destroy surface %#x.\n&quot;</span>, surface_id);</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160; </div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;    vaDestroySurfaces(dst_dev-&gt;<a class="code" href="struct_a_v_v_a_a_p_i_device_context.html#a89951d5ccfad53ce81444773ea9f774e">display</a>, &amp;surface_id, 1);</div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;}</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160; </div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> vaapi_map_from_drm(<a class="code" href="struct_a_v_h_w_frames_context.html">AVHWFramesContext</a> *src_fc, <a class="code" href="struct_a_v_frame.html">AVFrame</a> *dst,</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;                              <span class="keyword">const</span> <a class="code" href="struct_a_v_frame.html">AVFrame</a> *<a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>, <span class="keywordtype">int</span> <a class="code" href="cbs__av1_8c.html#a67119bce106892b6dade1dc5aa405ac9">flags</a>)</div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;{</div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;    <a class="code" href="struct_a_v_h_w_frames_context.html">AVHWFramesContext</a>      *dst_fc =</div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;        (<a class="code" href="struct_a_v_h_w_frames_context.html">AVHWFramesContext</a>*)dst-&gt;<a class="code" href="struct_a_v_frame.html#a29493fbfabaa21432c360a090426aa8e">hw_frames_ctx</a>-&gt;<a class="code" href="struct_a_v_buffer_ref.html#acb8452e99cd75074b93800b532c6ea4b">data</a>;</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;    <a class="code" href="struct_a_v_v_a_a_p_i_device_context.html">AVVAAPIDeviceContext</a>  *dst_dev = dst_fc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#ac9a7dbd0cbfcabc0b1529cb34cf53b6d">device_ctx</a>-&gt;<a class="code" href="struct_a_v_h_w_device_context.html#a46055b48d1a40445d775b4ae24f77f20">hwctx</a>;</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;    <span class="keyword">const</span> <a class="code" href="struct_a_v_d_r_m_frame_descriptor.html">AVDRMFrameDescriptor</a> *<a class="code" href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a>;</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;    <span class="keyword">const</span> <a class="code" href="struct_v_a_a_p_i_format.html">VAAPIFormatDescriptor</a> *format_desc;</div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;    VASurfaceID surface_id;</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;    VAStatus vas;</div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;    uint32_t va_fourcc;</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;    <span class="keywordtype">int</span> err, <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>, j, k;</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160; </div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> buffer_handle;</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;    VASurfaceAttribExternalBuffers buffer_desc;</div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;    VASurfaceAttrib attrs[2] = {</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;        {</div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;            .type  = VASurfaceAttribMemoryType,</div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;            .flags = VA_SURFACE_ATTRIB_SETTABLE,</div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;            .value.type    = VAGenericValueTypeInteger,</div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;            .value.value.i = VA_SURFACE_ATTRIB_MEM_TYPE_DRM_PRIME,</div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;        },</div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;        {</div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;            .type  = VASurfaceAttribExternalBufferDescriptor,</div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;            .flags = VA_SURFACE_ATTRIB_SETTABLE,</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;            .value.type    = VAGenericValueTypePointer,</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;            .value.value.p = &amp;buffer_desc,</div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;        }</div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;    };</div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160; </div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;    <a class="code" href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a> = (<a class="code" href="struct_a_v_d_r_m_frame_descriptor.html">AVDRMFrameDescriptor</a>*)<a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>-&gt;data[0];</div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160; </div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;    <a class="code" href="filter__design_8txt.html#a0e82f1088fdc24c14bf175d2ac77523f">if</a> (<a class="code" href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a>-&gt;nb_objects != 1) {</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(dst_fc, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;VAAPI can only map frames &quot;</span></div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;               <span class="stringliteral">&quot;made from a single DRM object.\n&quot;</span>);</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EINVAL);</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;    }</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160; </div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;    va_fourcc = 0;</div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="sinewin__tablegen__template_8c.html#a3508a98d3ee7e2c9a4841fe264cf70f7">FF_ARRAY_ELEMS</a>(vaapi_drm_format_map); <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a>-&gt;nb_layers != vaapi_drm_format_map[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].nb_layer_formats)</div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;        <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a>-&gt;nb_layers; j++) {</div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a>-&gt;layers[j].format !=</div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;                vaapi_drm_format_map[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].layer_formats[j])</div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;        }</div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;        <span class="keywordflow">if</span> (j != <a class="code" href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a>-&gt;nb_layers)</div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;        va_fourcc = vaapi_drm_format_map[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].va_fourcc;</div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;    }</div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;    <span class="keywordflow">if</span> (!va_fourcc) {</div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(dst_fc, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;DRM format not supported &quot;</span></div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;               <span class="stringliteral">&quot;by VAAPI.\n&quot;</span>);</div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EINVAL);</div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;    }</div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160; </div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(dst_fc, <a class="code" href="group__lavu__log__constants.html#ga5b7221c3afd06848486776bd834a58a5">AV_LOG_DEBUG</a>, <span class="stringliteral">&quot;Map DRM object %d to VAAPI as &quot;</span></div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;           <span class="stringliteral">&quot;%08x.\n&quot;</span>, <a class="code" href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a>-&gt;objects[0].fd, va_fourcc);</div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160; </div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;    format_desc = <a class="code" href="hwcontext__vaapi_8c.html#a48b950ed906a38b88245800841cc954e">vaapi_format_from_fourcc</a>(va_fourcc);</div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;    <a class="code" href="avassert_8h.html#aae204192396f78cc8c5cd7ad5c57c23f">av_assert0</a>(format_desc);</div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160; </div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;    buffer_handle = <a class="code" href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a>-&gt;objects[0].fd;</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;    buffer_desc.pixel_format = va_fourcc;</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;    buffer_desc.width        = src_fc-&gt;width;</div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;    buffer_desc.height       = src_fc-&gt;height;</div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;    buffer_desc.data_size    = <a class="code" href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a>-&gt;objects[0].size;</div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;    buffer_desc.buffers      = &amp;buffer_handle;</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;    buffer_desc.num_buffers  = 1;</div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;    buffer_desc.flags        = 0;</div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160; </div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;    k = 0;</div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a>-&gt;nb_layers; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;        <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a>-&gt;layers[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].nb_planes; j++) {</div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;            buffer_desc.pitches[k] = <a class="code" href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a>-&gt;layers[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].planes[j].pitch;</div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;            buffer_desc.offsets[k] = <a class="code" href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a>-&gt;layers[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].planes[j].offset;</div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;            ++k;</div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;        }</div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;    }</div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;    buffer_desc.num_planes = k;</div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160; </div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;    <span class="keywordflow">if</span> (format_desc-&gt;chroma_planes_swapped &amp;&amp;</div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;        buffer_desc.num_planes == 3) {</div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;        <a class="code" href="common_8h.html#a09a0bb7d8fcfac416de7a5fe7fd8b0f1">FFSWAP</a>(uint32_t, buffer_desc.pitches[1], buffer_desc.pitches[2]);</div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;        <a class="code" href="common_8h.html#a09a0bb7d8fcfac416de7a5fe7fd8b0f1">FFSWAP</a>(uint32_t, buffer_desc.offsets[1], buffer_desc.offsets[2]);</div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;    }</div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160; </div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;    vas = vaCreateSurfaces(dst_dev-&gt;display, format_desc-&gt;rt_format,</div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;                           <a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>-&gt;width, <a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>-&gt;height,</div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;                           &amp;surface_id, 1,</div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;                           attrs, <a class="code" href="sinewin__tablegen__template_8c.html#a3508a98d3ee7e2c9a4841fe264cf70f7">FF_ARRAY_ELEMS</a>(attrs));</div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;    <span class="keywordflow">if</span> (vas != VA_STATUS_SUCCESS) {</div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(dst_fc, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to create surface from DRM &quot;</span></div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;               <span class="stringliteral">&quot;object: %d (%s).\n&quot;</span>, vas, vaErrorStr(vas));</div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EIO);</div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;    }</div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(dst_fc, <a class="code" href="group__lavu__log__constants.html#ga5b7221c3afd06848486776bd834a58a5">AV_LOG_DEBUG</a>, <span class="stringliteral">&quot;Create surface %#x.\n&quot;</span>, surface_id);</div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160; </div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;    err = <a class="code" href="hwcontext_8c.html#a76e0387f519b3f1bd1b162e91b54b182">ff_hwframe_map_create</a>(dst-&gt;hw_frames_ctx, dst, <a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>,</div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;                                &amp;vaapi_unmap_from_drm,</div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;                                (<span class="keywordtype">void</span>*)(uintptr_t)surface_id);</div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;    <span class="keywordflow">if</span> (err &lt; 0)</div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;        <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160; </div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;    dst-&gt;width   = <a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>-&gt;width;</div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;    dst-&gt;height  = <a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>-&gt;height;</div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;    dst-&gt;data[3] = (<a class="code" href="audio__convert_8c.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a>*)(uintptr_t)surface_id;</div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160; </div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(dst_fc, <a class="code" href="group__lavu__log__constants.html#ga5b7221c3afd06848486776bd834a58a5">AV_LOG_DEBUG</a>, <span class="stringliteral">&quot;Mapped DRM object %d to &quot;</span></div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;           <span class="stringliteral">&quot;surface %#x.\n&quot;</span>, <a class="code" href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a>-&gt;objects[0].fd, surface_id);</div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160; </div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;}</div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160; </div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;<span class="preprocessor">#if VA_CHECK_VERSION(1, 1, 0)</span></div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> vaapi_unmap_to_drm_esh(<a class="code" href="struct_a_v_h_w_frames_context.html">AVHWFramesContext</a> *hwfc,</div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;                                   <a class="code" href="struct_h_w_map_descriptor.html">HWMapDescriptor</a> *hwmap)</div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;{</div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;    <a class="code" href="struct_a_v_d_r_m_frame_descriptor.html">AVDRMFrameDescriptor</a> *drm_desc = hwmap-&gt;<a class="code" href="struct_h_w_map_descriptor.html#a7ecea93e498181196f2121b85c07411d">priv</a>;</div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160; </div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; drm_desc-&gt;<a class="code" href="struct_a_v_d_r_m_frame_descriptor.html#a5a11bc1854bb6cee2f5b0f9d514d0c4f">nb_objects</a>; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;        close(drm_desc-&gt;<a class="code" href="struct_a_v_d_r_m_frame_descriptor.html#a0a757137c80a528953645ab11f31e6b7">objects</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="struct_a_v_d_r_m_object_descriptor.html#a3732e73e288f10965cae373c70e8402e">fd</a>);</div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160; </div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#adba82e1bcd02de510a858fcbedf79ef1">av_freep</a>(&amp;drm_desc);</div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;}</div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160; </div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> vaapi_map_to_drm_esh(<a class="code" href="struct_a_v_h_w_frames_context.html">AVHWFramesContext</a> *hwfc, <a class="code" href="struct_a_v_frame.html">AVFrame</a> *dst,</div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;                                <span class="keyword">const</span> <a class="code" href="struct_a_v_frame.html">AVFrame</a> *<a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>, <span class="keywordtype">int</span> <a class="code" href="cbs__av1_8c.html#a67119bce106892b6dade1dc5aa405ac9">flags</a>)</div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;{</div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;    <a class="code" href="struct_a_v_v_a_a_p_i_device_context.html">AVVAAPIDeviceContext</a> *hwctx = hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#ac9a7dbd0cbfcabc0b1529cb34cf53b6d">device_ctx</a>-&gt;<a class="code" href="struct_a_v_h_w_device_context.html#a46055b48d1a40445d775b4ae24f77f20">hwctx</a>;</div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;    VASurfaceID surface_id;</div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;    VAStatus vas;</div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;    VADRMPRIMESurfaceDescriptor va_desc;</div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;    <a class="code" href="struct_a_v_d_r_m_frame_descriptor.html">AVDRMFrameDescriptor</a> *drm_desc = <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;    uint32_t export_flags;</div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;    <span class="keywordtype">int</span> err, <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>, j;</div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160; </div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;    surface_id = (VASurfaceID)(uintptr_t)<a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>-&gt;data[3];</div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160; </div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;    export_flags = VA_EXPORT_SURFACE_SEPARATE_LAYERS;</div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="cbs__av1_8c.html#a67119bce106892b6dade1dc5aa405ac9">flags</a> &amp; <a class="code" href="group__avoptions.html#gga06fc87d81c62e9abb8790b6e5713c55ba236262031fe4c5503b2611c2c8fb520b">AV_HWFRAME_MAP_READ</a>)</div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;        export_flags |= VA_EXPORT_SURFACE_READ_ONLY;</div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="cbs__av1_8c.html#a67119bce106892b6dade1dc5aa405ac9">flags</a> &amp; <a class="code" href="group__avoptions.html#gga06fc87d81c62e9abb8790b6e5713c55bab2e22cc927a3d88fe833b50bf3d71948">AV_HWFRAME_MAP_WRITE</a>)</div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;        export_flags |= VA_EXPORT_SURFACE_WRITE_ONLY;</div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160; </div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;    vas = vaExportSurfaceHandle(hwctx-&gt;<a class="code" href="struct_a_v_v_a_a_p_i_device_context.html#a89951d5ccfad53ce81444773ea9f774e">display</a>, surface_id,</div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;                                VA_SURFACE_ATTRIB_MEM_TYPE_DRM_PRIME_2,</div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;                                export_flags, &amp;va_desc);</div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;    <span class="keywordflow">if</span> (vas != VA_STATUS_SUCCESS) {</div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;        <span class="keywordflow">if</span> (vas == VA_STATUS_ERROR_UNIMPLEMENTED)</div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOSYS);</div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(hwfc, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to export surface %#x: &quot;</span></div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;               <span class="stringliteral">&quot;%d (%s).\n&quot;</span>, surface_id, vas, vaErrorStr(vas));</div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EIO);</div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;    }</div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160; </div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;    drm_desc = <a class="code" href="group__lavu__mem__funcs.html#gaf143ecab33a3868b57345466c39de7c1">av_mallocz</a>(<span class="keyword">sizeof</span>(*drm_desc));</div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;    <span class="keywordflow">if</span> (!drm_desc) {</div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;        err = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;    }</div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160; </div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;    <span class="comment">// By some bizarre coincidence, these structures are very similar...</span></div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;    drm_desc-&gt;<a class="code" href="struct_a_v_d_r_m_frame_descriptor.html#a5a11bc1854bb6cee2f5b0f9d514d0c4f">nb_objects</a> = va_desc.num_objects;</div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; va_desc.num_objects; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;        drm_desc-&gt;<a class="code" href="struct_a_v_d_r_m_frame_descriptor.html#a0a757137c80a528953645ab11f31e6b7">objects</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="struct_a_v_d_r_m_object_descriptor.html#a3732e73e288f10965cae373c70e8402e">fd</a>   = va_desc.objects[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].fd;</div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;        drm_desc-&gt;<a class="code" href="struct_a_v_d_r_m_frame_descriptor.html#a0a757137c80a528953645ab11f31e6b7">objects</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="struct_a_v_d_r_m_object_descriptor.html#a4eeb1aad28f187c3c3e4f9d547a55a3d">size</a> = va_desc.objects[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].size;</div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;        drm_desc-&gt;<a class="code" href="struct_a_v_d_r_m_frame_descriptor.html#a0a757137c80a528953645ab11f31e6b7">objects</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="struct_a_v_d_r_m_object_descriptor.html#ab193fb14460d5a5f90578a80608e82ae">format_modifier</a> =</div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;            va_desc.objects[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].drm_format_modifier;</div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;    }</div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;    drm_desc-&gt;<a class="code" href="struct_a_v_d_r_m_frame_descriptor.html#a228800d9ce195e776833e58ee307a6ec">nb_layers</a> = va_desc.num_layers;</div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; va_desc.num_layers; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;        drm_desc-&gt;<a class="code" href="struct_a_v_d_r_m_frame_descriptor.html#ad19d258e1771ef833d7e3bd873b91906">layers</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="struct_a_v_d_r_m_layer_descriptor.html#abe9b4585e3ad357cf058dada850c3226">format</a>    = va_desc.layers[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].drm_format;</div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;        drm_desc-&gt;<a class="code" href="struct_a_v_d_r_m_frame_descriptor.html#ad19d258e1771ef833d7e3bd873b91906">layers</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="struct_a_v_d_r_m_layer_descriptor.html#aa71ce914f53563be8207d8bc08fbfe92">nb_planes</a> = va_desc.layers[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].num_planes;</div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;        <span class="keywordflow">for</span> (j = 0; j &lt; va_desc.layers[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].num_planes; j++) {</div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;            drm_desc-&gt;<a class="code" href="struct_a_v_d_r_m_frame_descriptor.html#ad19d258e1771ef833d7e3bd873b91906">layers</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="struct_a_v_d_r_m_layer_descriptor.html#a7fbaf03f401c451e82021487fefef159">planes</a>[j].<a class="code" href="struct_a_v_d_r_m_plane_descriptor.html#af07fe11d604e0a3b5fd934f9626c008b">object_index</a> =</div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;                va_desc.layers[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].object_index[j];</div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;            drm_desc-&gt;<a class="code" href="struct_a_v_d_r_m_frame_descriptor.html#ad19d258e1771ef833d7e3bd873b91906">layers</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="struct_a_v_d_r_m_layer_descriptor.html#a7fbaf03f401c451e82021487fefef159">planes</a>[j].<a class="code" href="struct_a_v_d_r_m_plane_descriptor.html#af1a0839b02055445257d431d946d96a7">offset</a> =</div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;                va_desc.layers[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].offset[j];</div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;            drm_desc-&gt;<a class="code" href="struct_a_v_d_r_m_frame_descriptor.html#ad19d258e1771ef833d7e3bd873b91906">layers</a>[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="struct_a_v_d_r_m_layer_descriptor.html#a7fbaf03f401c451e82021487fefef159">planes</a>[j].<a class="code" href="struct_a_v_d_r_m_plane_descriptor.html#aa4eaa5a37f40dd7301ce1b8194eefc0a">pitch</a> =</div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;                va_desc.layers[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].pitch[j];</div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;        }</div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;    }</div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160; </div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;    err = <a class="code" href="hwcontext_8c.html#a76e0387f519b3f1bd1b162e91b54b182">ff_hwframe_map_create</a>(<a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>-&gt;hw_frames_ctx, dst, <a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>,</div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;                                &amp;vaapi_unmap_to_drm_esh, drm_desc);</div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;    <span class="keywordflow">if</span> (err &lt; 0)</div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160; </div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;    dst-&gt;<a class="code" href="struct_a_v_frame.html#a1e71ce60cedd5f3b6811714a9f7f9e0a">width</a>   = <a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>-&gt;width;</div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;    dst-&gt;<a class="code" href="struct_a_v_frame.html#a3f89733f429c98ba5bc64373fb0a3f13">height</a>  = <a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>-&gt;height;</div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;    dst-&gt;<a class="code" href="struct_a_v_frame.html#a1d0f65014a8d1bf78cec8cbed2304992">data</a>[0] = (<a class="code" href="audio__convert_8c.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a>*)drm_desc;</div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160; </div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160; </div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;<a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>:</div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; va_desc.num_objects; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;        close(va_desc.objects[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].fd);</div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#adba82e1bcd02de510a858fcbedf79ef1">av_freep</a>(&amp;drm_desc);</div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;    <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;}</div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160; </div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;<span class="preprocessor">#if VA_CHECK_VERSION(0, 36, 0)</span></div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;<span class="keyword">typedef</span> <span class="keyword">struct </span>VAAPIDRMImageBufferMapping {</div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;    VAImage      image;</div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;    VABufferInfo buffer_info;</div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160; </div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;    <a class="code" href="struct_a_v_d_r_m_frame_descriptor.html">AVDRMFrameDescriptor</a> drm_desc;</div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;} VAAPIDRMImageBufferMapping;</div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160; </div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> vaapi_unmap_to_drm_abh(<a class="code" href="struct_a_v_h_w_frames_context.html">AVHWFramesContext</a> *hwfc,</div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;                                  <a class="code" href="struct_h_w_map_descriptor.html">HWMapDescriptor</a> *hwmap)</div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;{</div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;    <a class="code" href="struct_a_v_v_a_a_p_i_device_context.html">AVVAAPIDeviceContext</a> *hwctx = hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#ac9a7dbd0cbfcabc0b1529cb34cf53b6d">device_ctx</a>-&gt;<a class="code" href="struct_a_v_h_w_device_context.html#a46055b48d1a40445d775b4ae24f77f20">hwctx</a>;</div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;    VAAPIDRMImageBufferMapping *mapping = hwmap-&gt;<a class="code" href="struct_h_w_map_descriptor.html#a7ecea93e498181196f2121b85c07411d">priv</a>;</div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;    VASurfaceID surface_id;</div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;    VAStatus vas;</div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160; </div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;    surface_id = (VASurfaceID)(uintptr_t)hwmap-&gt;<a class="code" href="struct_h_w_map_descriptor.html#aac9a3c77af4a936a326770ee5973e261">source</a>-&gt;<a class="code" href="struct_a_v_frame.html#a1d0f65014a8d1bf78cec8cbed2304992">data</a>[3];</div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(hwfc, <a class="code" href="group__lavu__log__constants.html#ga5b7221c3afd06848486776bd834a58a5">AV_LOG_DEBUG</a>, <span class="stringliteral">&quot;Unmap VAAPI surface %#x from DRM.\n&quot;</span>,</div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;           surface_id);</div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160; </div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;    <span class="comment">// DRM PRIME file descriptors are closed by vaReleaseBufferHandle(),</span></div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;    <span class="comment">// so we shouldn&#39;t close them separately.</span></div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160; </div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;    vas = vaReleaseBufferHandle(hwctx-&gt;<a class="code" href="struct_a_v_v_a_a_p_i_device_context.html#a89951d5ccfad53ce81444773ea9f774e">display</a>, mapping-&gt;image.buf);</div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;    <span class="keywordflow">if</span> (vas != VA_STATUS_SUCCESS) {</div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(hwfc, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to release buffer &quot;</span></div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;               <span class="stringliteral">&quot;handle of image %#x (derived from surface %#x): &quot;</span></div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;               <span class="stringliteral">&quot;%d (%s).\n&quot;</span>, mapping-&gt;image.buf, surface_id,</div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;               vas, vaErrorStr(vas));</div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;    }</div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160; </div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;    vas = vaDestroyImage(hwctx-&gt;<a class="code" href="struct_a_v_v_a_a_p_i_device_context.html#a89951d5ccfad53ce81444773ea9f774e">display</a>, mapping-&gt;image.image_id);</div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;    <span class="keywordflow">if</span> (vas != VA_STATUS_SUCCESS) {</div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(hwfc, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to destroy image &quot;</span></div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;               <span class="stringliteral">&quot;derived from surface %#x: %d (%s).\n&quot;</span>,</div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;               surface_id, vas, vaErrorStr(vas));</div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;    }</div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160; </div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#a079eab092887563f2bef9106c6120089">av_free</a>(mapping);</div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;}</div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160; </div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> vaapi_map_to_drm_abh(<a class="code" href="struct_a_v_h_w_frames_context.html">AVHWFramesContext</a> *hwfc, <a class="code" href="struct_a_v_frame.html">AVFrame</a> *dst,</div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;                                <span class="keyword">const</span> <a class="code" href="struct_a_v_frame.html">AVFrame</a> *<a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>, <span class="keywordtype">int</span> <a class="code" href="cbs__av1_8c.html#a67119bce106892b6dade1dc5aa405ac9">flags</a>)</div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;{</div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;    <a class="code" href="struct_a_v_v_a_a_p_i_device_context.html">AVVAAPIDeviceContext</a> *hwctx = hwfc-&gt;<a class="code" href="struct_a_v_h_w_frames_context.html#ac9a7dbd0cbfcabc0b1529cb34cf53b6d">device_ctx</a>-&gt;<a class="code" href="struct_a_v_h_w_device_context.html#a46055b48d1a40445d775b4ae24f77f20">hwctx</a>;</div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;    VAAPIDRMImageBufferMapping *mapping = <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;    VASurfaceID surface_id;</div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;    VAStatus vas;</div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;    <span class="keywordtype">int</span> err, <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>, p;</div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160; </div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;    surface_id = (VASurfaceID)(uintptr_t)<a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>-&gt;data[3];</div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(hwfc, <a class="code" href="group__lavu__log__constants.html#ga5b7221c3afd06848486776bd834a58a5">AV_LOG_DEBUG</a>, <span class="stringliteral">&quot;Map VAAPI surface %#x to DRM.\n&quot;</span>,</div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;           surface_id);</div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160; </div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;    mapping = <a class="code" href="group__lavu__mem__funcs.html#gaf143ecab33a3868b57345466c39de7c1">av_mallocz</a>(<span class="keyword">sizeof</span>(*mapping));</div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;    <span class="keywordflow">if</span> (!mapping)</div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160; </div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;    vas = vaDeriveImage(hwctx-&gt;<a class="code" href="struct_a_v_v_a_a_p_i_device_context.html#a89951d5ccfad53ce81444773ea9f774e">display</a>, surface_id,</div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;                        &amp;mapping-&gt;image);</div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;    <span class="keywordflow">if</span> (vas != VA_STATUS_SUCCESS) {</div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(hwfc, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to derive image from &quot;</span></div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;               <span class="stringliteral">&quot;surface %#x: %d (%s).\n&quot;</span>,</div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;               surface_id, vas, vaErrorStr(vas));</div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;        err = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EIO);</div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;    }</div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160; </div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="sinewin__tablegen__template_8c.html#a3508a98d3ee7e2c9a4841fe264cf70f7">FF_ARRAY_ELEMS</a>(vaapi_drm_format_map); <a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;        <span class="keywordflow">if</span> (vaapi_drm_format_map[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].va_fourcc ==</div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;            mapping-&gt;image.format.fourcc)</div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;    }</div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &gt;= <a class="code" href="sinewin__tablegen__template_8c.html#a3508a98d3ee7e2c9a4841fe264cf70f7">FF_ARRAY_ELEMS</a>(vaapi_drm_format_map)) {</div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(hwfc, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;No matching DRM format for &quot;</span></div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;               <span class="stringliteral">&quot;VAAPI format %#x.\n&quot;</span>, mapping-&gt;image.format.fourcc);</div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;        err = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EINVAL);</div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;        <span class="keywordflow">goto</span> fail_derived;</div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;    }</div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160; </div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;    mapping-&gt;buffer_info.mem_type =</div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;        VA_SURFACE_ATTRIB_MEM_TYPE_DRM_PRIME;</div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160; </div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;    mapping-&gt;drm_desc.nb_layers =</div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;        vaapi_drm_format_map[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].nb_layer_formats;</div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;    <span class="keywordflow">if</span> (mapping-&gt;drm_desc.nb_layers &gt; 1) {</div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;        <span class="keywordflow">if</span> (mapping-&gt;drm_desc.nb_layers != mapping-&gt;image.num_planes) {</div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(hwfc, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Image properties do not match &quot;</span></div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;                   <span class="stringliteral">&quot;expected format: got %d planes, but expected %d.\n&quot;</span>,</div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;                   mapping-&gt;image.num_planes, mapping-&gt;drm_desc.nb_layers);</div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;            err = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EINVAL);</div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;            <span class="keywordflow">goto</span> fail_derived;</div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;        }</div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160; </div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;        <span class="keywordflow">for</span>(p = 0; p &lt; mapping-&gt;drm_desc.nb_layers; p++) {</div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;            mapping-&gt;drm_desc.layers[p] = (<a class="code" href="hwcontext__drm_8h.html#a9efcf7f55bd9676757ff1914af67119b">AVDRMLayerDescriptor</a>) {</div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;                .format    = vaapi_drm_format_map[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].layer_formats[p],</div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;                .nb_planes = 1,</div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;                .planes[0] = {</div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;                    .object_index = 0,</div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;                    .offset       = mapping-&gt;image.offsets[p],</div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;                    .pitch        = mapping-&gt;image.pitches[p],</div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;                },</div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;            };</div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;        }</div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;        mapping-&gt;drm_desc.layers[0].format =</div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;            vaapi_drm_format_map[<a class="code" href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].layer_formats[0];</div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;        mapping-&gt;drm_desc.layers[0].nb_planes = mapping-&gt;image.num_planes;</div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;        <span class="keywordflow">for</span> (p = 0; p &lt; mapping-&gt;image.num_planes; p++) {</div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;            mapping-&gt;drm_desc.layers[0].planes[p] = (<a class="code" href="hwcontext__drm_8h.html#a2ca5add12c48394bda6831c14e66d502">AVDRMPlaneDescriptor</a>) {</div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;                .object_index = 0,</div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;                .offset       = mapping-&gt;image.offsets[p],</div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;                .pitch        = mapping-&gt;image.pitches[p],</div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;            };</div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;        }</div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;    }</div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160; </div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;    vas = vaAcquireBufferHandle(hwctx-&gt;<a class="code" href="struct_a_v_v_a_a_p_i_device_context.html#a89951d5ccfad53ce81444773ea9f774e">display</a>, mapping-&gt;image.buf,</div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;                                &amp;mapping-&gt;buffer_info);</div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;    <span class="keywordflow">if</span> (vas != VA_STATUS_SUCCESS) {</div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(hwfc, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to get buffer &quot;</span></div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;               <span class="stringliteral">&quot;handle from image %#x (derived from surface %#x): &quot;</span></div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;               <span class="stringliteral">&quot;%d (%s).\n&quot;</span>, mapping-&gt;image.buf, surface_id,</div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;               vas, vaErrorStr(vas));</div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;        err = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EIO);</div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;        <span class="keywordflow">goto</span> fail_derived;</div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;    }</div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160; </div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(hwfc, <a class="code" href="group__lavu__log__constants.html#ga5b7221c3afd06848486776bd834a58a5">AV_LOG_DEBUG</a>, <span class="stringliteral">&quot;DRM PRIME fd is %ld.\n&quot;</span>,</div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;           mapping-&gt;buffer_info.handle);</div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160; </div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;    mapping-&gt;drm_desc.nb_objects = 1;</div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;    mapping-&gt;drm_desc.objects[0] = (<a class="code" href="hwcontext__drm_8h.html#a2e48b6eecd6df129aad4622bce819c88">AVDRMObjectDescriptor</a>) {</div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;        .fd   = mapping-&gt;buffer_info.handle,</div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;        .size = mapping-&gt;image.data_size,</div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;        <span class="comment">// There is no way to get the format modifier with this API.</span></div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;        .format_modifier = <a class="code" href="kmsgrab_8c.html#ae7d1b8e0c4ef70d518ffc304de13032c">DRM_FORMAT_MOD_INVALID</a>,</div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;    };</div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160; </div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;    err = <a class="code" href="hwcontext_8c.html#a76e0387f519b3f1bd1b162e91b54b182">ff_hwframe_map_create</a>(<a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>-&gt;hw_frames_ctx,</div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;                                dst, <a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>, &amp;vaapi_unmap_to_drm_abh,</div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;                                mapping);</div>
<div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;    <span class="keywordflow">if</span> (err &lt; 0)</div>
<div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;        <span class="keywordflow">goto</span> fail_mapped;</div>
<div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160; </div>
<div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;    dst-&gt;<a class="code" href="struct_a_v_frame.html#a1d0f65014a8d1bf78cec8cbed2304992">data</a>[0] = (<a class="code" href="audio__convert_8c.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a>*)&amp;mapping-&gt;drm_desc;</div>
<div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;    dst-&gt;<a class="code" href="struct_a_v_frame.html#a1e71ce60cedd5f3b6811714a9f7f9e0a">width</a>   = <a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>-&gt;width;</div>
<div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;    dst-&gt;<a class="code" href="struct_a_v_frame.html#a3f89733f429c98ba5bc64373fb0a3f13">height</a>  = <a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>-&gt;height;</div>
<div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160; </div>
<div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160; </div>
<div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;fail_mapped:</div>
<div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;    vaReleaseBufferHandle(hwctx-&gt;<a class="code" href="struct_a_v_v_a_a_p_i_device_context.html#a89951d5ccfad53ce81444773ea9f774e">display</a>, mapping-&gt;image.buf);</div>
<div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;fail_derived:</div>
<div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;    vaDestroyImage(hwctx-&gt;<a class="code" href="struct_a_v_v_a_a_p_i_device_context.html#a89951d5ccfad53ce81444773ea9f774e">display</a>, mapping-&gt;image.image_id);</div>
<div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;<a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>:</div>
<div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#adba82e1bcd02de510a858fcbedf79ef1">av_freep</a>(&amp;mapping);</div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;    <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;}</div>
<div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160; </div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> vaapi_map_to_drm(<a class="code" href="struct_a_v_h_w_frames_context.html">AVHWFramesContext</a> *hwfc, <a class="code" href="struct_a_v_frame.html">AVFrame</a> *dst,</div>
<div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;                            <span class="keyword">const</span> <a class="code" href="struct_a_v_frame.html">AVFrame</a> *<a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>, <span class="keywordtype">int</span> <a class="code" href="cbs__av1_8c.html#a67119bce106892b6dade1dc5aa405ac9">flags</a>)</div>
<div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;{</div>
<div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;<span class="preprocessor">#if VA_CHECK_VERSION(1, 1, 0)</span></div>
<div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;    <span class="keywordtype">int</span> err;</div>
<div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;    err = vaapi_map_to_drm_esh(hwfc, dst, <a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>, <a class="code" href="cbs__av1_8c.html#a67119bce106892b6dade1dc5aa405ac9">flags</a>);</div>
<div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;    <span class="keywordflow">if</span> (err != <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOSYS))</div>
<div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;        <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;<span class="preprocessor">#if VA_CHECK_VERSION(0, 36, 0)</span></div>
<div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;    <span class="keywordflow">return</span> vaapi_map_to_drm_abh(hwfc, dst, <a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>, <a class="code" href="cbs__av1_8c.html#a67119bce106892b6dade1dc5aa405ac9">flags</a>);</div>
<div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOSYS);</div>
<div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;}</div>
<div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160; </div>
<div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* CONFIG_LIBDRM */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160; </div>
<div class="line"><a name="l01407"></a><span class="lineno"><a class="line" href="hwcontext__vaapi_8c.html#ae140fe67dad9241007a59ea2c82c4ab1"> 1407</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="hwcontext__vaapi_8c.html#ae140fe67dad9241007a59ea2c82c4ab1">vaapi_map_to</a>(<a class="code" href="struct_a_v_h_w_frames_context.html">AVHWFramesContext</a> *hwfc, <a class="code" href="struct_a_v_frame.html">AVFrame</a> *dst,</div>
<div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;                        <span class="keyword">const</span> <a class="code" href="struct_a_v_frame.html">AVFrame</a> *<a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>, <span class="keywordtype">int</span> <a class="code" href="cbs__av1_8c.html#a67119bce106892b6dade1dc5aa405ac9">flags</a>)</div>
<div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;{</div>
<div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;    <span class="keywordflow">switch</span> (<a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>-&gt;format) {</div>
<div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;<span class="preprocessor">#if CONFIG_LIBDRM</span></div>
<div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a76a05fccc6f58f7ab655deefd794713e">AV_PIX_FMT_DRM_PRIME</a>:</div>
<div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;        <span class="keywordflow">return</span> vaapi_map_from_drm(hwfc, dst, <a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>, <a class="code" href="cbs__av1_8c.html#a67119bce106892b6dade1dc5aa405ac9">flags</a>);</div>
<div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;    <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOSYS);</div>
<div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;    }</div>
<div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;}</div>
<div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160; </div>
<div class="line"><a name="l01420"></a><span class="lineno"><a class="line" href="hwcontext__vaapi_8c.html#a74a5679566484667a7ec44c2f968be3a"> 1420</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="hwcontext__vaapi_8c.html#a74a5679566484667a7ec44c2f968be3a">vaapi_map_from</a>(<a class="code" href="struct_a_v_h_w_frames_context.html">AVHWFramesContext</a> *hwfc, <a class="code" href="struct_a_v_frame.html">AVFrame</a> *dst,</div>
<div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;                          <span class="keyword">const</span> <a class="code" href="struct_a_v_frame.html">AVFrame</a> *<a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>, <span class="keywordtype">int</span> <a class="code" href="cbs__av1_8c.html#a67119bce106892b6dade1dc5aa405ac9">flags</a>)</div>
<div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;{</div>
<div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;    <span class="keywordflow">switch</span> (dst-&gt;<a class="code" href="struct_a_v_frame.html#aed14fa772ce46881020fd1545c86432c">format</a>) {</div>
<div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;<span class="preprocessor">#if CONFIG_LIBDRM</span></div>
<div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a76a05fccc6f58f7ab655deefd794713e">AV_PIX_FMT_DRM_PRIME</a>:</div>
<div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;        <span class="keywordflow">return</span> vaapi_map_to_drm(hwfc, dst, <a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>, <a class="code" href="cbs__av1_8c.html#a67119bce106892b6dade1dc5aa405ac9">flags</a>);</div>
<div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;    <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="hwcontext__vaapi_8c.html#ace0f3086d25b9a5ef42e3ef3e9b4e2b2">vaapi_map_to_memory</a>(hwfc, dst, <a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>, <a class="code" href="cbs__av1_8c.html#a67119bce106892b6dade1dc5aa405ac9">flags</a>);</div>
<div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;    }</div>
<div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;}</div>
<div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160; </div>
<div class="line"><a name="l01433"></a><span class="lineno"><a class="line" href="hwcontext__vaapi_8c.html#a5c28d40b7a2a444060f25438fc07bfab"> 1433</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="hwcontext__vaapi_8c.html#a5c28d40b7a2a444060f25438fc07bfab">vaapi_device_free</a>(<a class="code" href="struct_a_v_h_w_device_context.html">AVHWDeviceContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>)</div>
<div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;{</div>
<div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;    <a class="code" href="struct_a_v_v_a_a_p_i_device_context.html">AVVAAPIDeviceContext</a> *hwctx = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;hwctx;</div>
<div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;    <a class="code" href="struct_v_a_a_p_i_device_priv.html">VAAPIDevicePriv</a>      *priv  = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;user_opaque;</div>
<div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160; </div>
<div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;    <span class="keywordflow">if</span> (hwctx-&gt;<a class="code" href="struct_a_v_v_a_a_p_i_device_context.html#a89951d5ccfad53ce81444773ea9f774e">display</a>)</div>
<div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;        vaTerminate(hwctx-&gt;<a class="code" href="struct_a_v_v_a_a_p_i_device_context.html#a89951d5ccfad53ce81444773ea9f774e">display</a>);</div>
<div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160; </div>
<div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;<span class="preprocessor">#if HAVE_VAAPI_X11</span></div>
<div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;    <span class="keywordflow">if</span> (priv-&gt;x11_display)</div>
<div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;        XCloseDisplay(priv-&gt;x11_display);</div>
<div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160; </div>
<div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;    <span class="keywordflow">if</span> (priv-&gt;<a class="code" href="struct_v_a_a_p_i_device_priv.html#aa0d7b3aa4d16e26802900a5c7c155f4b">drm_fd</a> &gt;= 0)</div>
<div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;        close(priv-&gt;<a class="code" href="struct_v_a_a_p_i_device_priv.html#aa0d7b3aa4d16e26802900a5c7c155f4b">drm_fd</a>);</div>
<div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160; </div>
<div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#adba82e1bcd02de510a858fcbedf79ef1">av_freep</a>(&amp;priv);</div>
<div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;}</div>
<div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160; </div>
<div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;<span class="preprocessor">#if CONFIG_VAAPI_1</span></div>
<div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> vaapi_device_log_error(<span class="keywordtype">void</span> *<a class="code" href="writing__filters_8txt.html#a5b5446e1f47af0c85ac6b45210d45117">context</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="structmessage.html">message</a>)</div>
<div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;{</div>
<div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;    <a class="code" href="struct_a_v_h_w_device_context.html">AVHWDeviceContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a> = <a class="code" href="writing__filters_8txt.html#a5b5446e1f47af0c85ac6b45210d45117">context</a>;</div>
<div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160; </div>
<div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;libva: %s&quot;</span>, <a class="code" href="structmessage.html">message</a>);</div>
<div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;}</div>
<div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160; </div>
<div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> vaapi_device_log_info(<span class="keywordtype">void</span> *<a class="code" href="writing__filters_8txt.html#a5b5446e1f47af0c85ac6b45210d45117">context</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="structmessage.html">message</a>)</div>
<div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;{</div>
<div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;    <a class="code" href="struct_a_v_h_w_device_context.html">AVHWDeviceContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a> = <a class="code" href="writing__filters_8txt.html#a5b5446e1f47af0c85ac6b45210d45117">context</a>;</div>
<div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160; </div>
<div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, <a class="code" href="group__lavu__log__constants.html#ga9b58b28e2d429b930b69db19877f76a8">AV_LOG_VERBOSE</a>, <span class="stringliteral">&quot;libva: %s&quot;</span>, <a class="code" href="structmessage.html">message</a>);</div>
<div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;}</div>
<div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160; </div>
<div class="line"><a name="l01468"></a><span class="lineno"><a class="line" href="hwcontext__vaapi_8c.html#ab28ff5528527cb3bda2249941e94aaac"> 1468</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="hwcontext__vaapi_8c.html#ab28ff5528527cb3bda2249941e94aaac">vaapi_device_connect</a>(<a class="code" href="struct_a_v_h_w_device_context.html">AVHWDeviceContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>,</div>
<div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;                                VADisplay display)</div>
<div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;{</div>
<div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;    <a class="code" href="struct_a_v_v_a_a_p_i_device_context.html">AVVAAPIDeviceContext</a> *hwctx = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;hwctx;</div>
<div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="namespaceconvert__header.html#ac8d67a61fdde2fcdd4358f78109f4b7a">major</a>, <a class="code" href="namespaceconvert__header.html#afbbd9db93850ca44e2f56ebb00ce0e0c">minor</a>;</div>
<div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;    VAStatus vas;</div>
<div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160; </div>
<div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;<span class="preprocessor">#if CONFIG_VAAPI_1</span></div>
<div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;    vaSetErrorCallback(display, &amp;vaapi_device_log_error, <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>);</div>
<div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;    vaSetInfoCallback (display, &amp;vaapi_device_log_info,  <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>);</div>
<div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160; </div>
<div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;    hwctx-&gt;<a class="code" href="struct_a_v_v_a_a_p_i_device_context.html#a89951d5ccfad53ce81444773ea9f774e">display</a> = display;</div>
<div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160; </div>
<div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;    vas = vaInitialize(display, &amp;<a class="code" href="namespaceconvert__header.html#ac8d67a61fdde2fcdd4358f78109f4b7a">major</a>, &amp;<a class="code" href="namespaceconvert__header.html#afbbd9db93850ca44e2f56ebb00ce0e0c">minor</a>);</div>
<div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;    <span class="keywordflow">if</span> (vas != VA_STATUS_SUCCESS) {</div>
<div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to initialise VAAPI &quot;</span></div>
<div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;               <span class="stringliteral">&quot;connection: %d (%s).\n&quot;</span>, vas, vaErrorStr(vas));</div>
<div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EIO);</div>
<div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;    }</div>
<div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, <a class="code" href="group__lavu__log__constants.html#ga9b58b28e2d429b930b69db19877f76a8">AV_LOG_VERBOSE</a>, <span class="stringliteral">&quot;Initialised VAAPI connection: &quot;</span></div>
<div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;           <span class="stringliteral">&quot;version %d.%d\n&quot;</span>, <a class="code" href="namespaceconvert__header.html#ac8d67a61fdde2fcdd4358f78109f4b7a">major</a>, <a class="code" href="namespaceconvert__header.html#afbbd9db93850ca44e2f56ebb00ce0e0c">minor</a>);</div>
<div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160; </div>
<div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;}</div>
<div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160; </div>
<div class="line"><a name="l01494"></a><span class="lineno"><a class="line" href="hwcontext__vaapi_8c.html#a173122e20006f4664e23d28ea3c991c5"> 1494</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="hwcontext__vaapi_8c.html#a173122e20006f4664e23d28ea3c991c5">vaapi_device_create</a>(<a class="code" href="struct_a_v_h_w_device_context.html">AVHWDeviceContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *device,</div>
<div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;                               <a class="code" href="struct_a_v_dictionary.html">AVDictionary</a> *<a class="code" href="tests_2movenc_8c.html#af540b728145b614e34c4e10930354b93">opts</a>, <span class="keywordtype">int</span> <a class="code" href="cbs__av1_8c.html#a67119bce106892b6dade1dc5aa405ac9">flags</a>)</div>
<div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;{</div>
<div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;    <a class="code" href="struct_v_a_a_p_i_device_priv.html">VAAPIDevicePriv</a> *priv;</div>
<div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;    VADisplay display = <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;    <span class="keyword">const</span> <a class="code" href="struct_a_v_dictionary_entry.html">AVDictionaryEntry</a> *ent;</div>
<div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;    <span class="keywordtype">int</span> try_drm, try_x11, try_all;</div>
<div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160; </div>
<div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;    priv = <a class="code" href="group__lavu__mem__funcs.html#gaf143ecab33a3868b57345466c39de7c1">av_mallocz</a>(<span class="keyword">sizeof</span>(*priv));</div>
<div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;    <span class="keywordflow">if</span> (!priv)</div>
<div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160; </div>
<div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;    priv-&gt;<a class="code" href="struct_v_a_a_p_i_device_priv.html#aa0d7b3aa4d16e26802900a5c7c155f4b">drm_fd</a> = -1;</div>
<div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160; </div>
<div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;user_opaque = priv;</div>
<div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;free        = <a class="code" href="hwcontext__vaapi_8c.html#a5c28d40b7a2a444060f25438fc07bfab">vaapi_device_free</a>;</div>
<div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160; </div>
<div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;    ent = <a class="code" href="group__lavu__dict.html#gae67f143237b2cb2936c9b147aa6dfde3">av_dict_get</a>(<a class="code" href="tests_2movenc_8c.html#af540b728145b614e34c4e10930354b93">opts</a>, <span class="stringliteral">&quot;connection_type&quot;</span>, <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0);</div>
<div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;    <span class="keywordflow">if</span> (ent) {</div>
<div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;        try_all = try_drm = try_x11 = 0;</div>
<div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;        <span class="keywordflow">if</span> (!strcmp(ent-&gt;<a class="code" href="struct_a_v_dictionary_entry.html#aa38678f2cad36f120d42e56449c5edb4">value</a>, <span class="stringliteral">&quot;drm&quot;</span>)) {</div>
<div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;            try_drm = 1;</div>
<div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(ent-&gt;<a class="code" href="struct_a_v_dictionary_entry.html#aa38678f2cad36f120d42e56449c5edb4">value</a>, <span class="stringliteral">&quot;x11&quot;</span>)) {</div>
<div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;            try_x11 = 1;</div>
<div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Invalid connection type %s.\n&quot;</span>,</div>
<div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;                   ent-&gt;<a class="code" href="struct_a_v_dictionary_entry.html#aa38678f2cad36f120d42e56449c5edb4">value</a>);</div>
<div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EINVAL);</div>
<div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;        }</div>
<div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;        try_all = 1;</div>
<div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;        try_drm = HAVE_VAAPI_DRM;</div>
<div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;        try_x11 = HAVE_VAAPI_X11;</div>
<div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;    }</div>
<div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160; </div>
<div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;<span class="preprocessor">#if HAVE_VAAPI_DRM</span></div>
<div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;    <span class="keywordflow">while</span> (!display &amp;&amp; try_drm) {</div>
<div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;        <span class="comment">// If the device is specified, try to open it as a DRM device node.</span></div>
<div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;        <span class="comment">// If not, look for a usable render node, possibly restricted to those</span></div>
<div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;        <span class="comment">// using a specified kernel driver.</span></div>
<div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;        <span class="keywordtype">int</span> loglevel = try_all ? <a class="code" href="group__lavu__log__constants.html#ga9b58b28e2d429b930b69db19877f76a8">AV_LOG_VERBOSE</a> : <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>;</div>
<div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;        <span class="keywordflow">if</span> (device) {</div>
<div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;            priv-&gt;<a class="code" href="struct_v_a_a_p_i_device_priv.html#aa0d7b3aa4d16e26802900a5c7c155f4b">drm_fd</a> = open(device, O_RDWR);</div>
<div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;            <span class="keywordflow">if</span> (priv-&gt;<a class="code" href="struct_v_a_a_p_i_device_priv.html#aa0d7b3aa4d16e26802900a5c7c155f4b">drm_fd</a> &lt; 0) {</div>
<div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;                <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, loglevel, <span class="stringliteral">&quot;Failed to open %s as &quot;</span></div>
<div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;                       <span class="stringliteral">&quot;DRM device node.\n&quot;</span>, device);</div>
<div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;            }</div>
<div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;            <span class="keywordtype">char</span> path[64];</div>
<div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;            <span class="keywordtype">int</span> n, max_devices = 8;</div>
<div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;<span class="preprocessor">#if CONFIG_LIBDRM</span></div>
<div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;            <span class="keyword">const</span> <a class="code" href="struct_a_v_dictionary_entry.html">AVDictionaryEntry</a> *kernel_driver;</div>
<div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;            kernel_driver = <a class="code" href="group__lavu__dict.html#gae67f143237b2cb2936c9b147aa6dfde3">av_dict_get</a>(<a class="code" href="tests_2movenc_8c.html#af540b728145b614e34c4e10930354b93">opts</a>, <span class="stringliteral">&quot;kernel_driver&quot;</span>, <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0);</div>
<div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;            <span class="keywordflow">for</span> (n = 0; n &lt; max_devices; n++) {</div>
<div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;                <a class="code" href="snprintf_8h.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a>(path, <span class="keyword">sizeof</span>(path),</div>
<div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;                         <span class="stringliteral">&quot;/dev/dri/renderD%d&quot;</span>, 128 + n);</div>
<div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;                priv-&gt;<a class="code" href="struct_v_a_a_p_i_device_priv.html#aa0d7b3aa4d16e26802900a5c7c155f4b">drm_fd</a> = open(path, O_RDWR);</div>
<div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;                <span class="keywordflow">if</span> (priv-&gt;<a class="code" href="struct_v_a_a_p_i_device_priv.html#aa0d7b3aa4d16e26802900a5c7c155f4b">drm_fd</a> &lt; 0) {</div>
<div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;                    <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, <a class="code" href="group__lavu__log__constants.html#ga9b58b28e2d429b930b69db19877f76a8">AV_LOG_VERBOSE</a>, <span class="stringliteral">&quot;Cannot open &quot;</span></div>
<div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;                           <span class="stringliteral">&quot;DRM render node for device %d.\n&quot;</span>, n);</div>
<div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;                }</div>
<div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;<span class="preprocessor">#if CONFIG_LIBDRM</span></div>
<div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;                <span class="keywordflow">if</span> (kernel_driver) {</div>
<div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;                    drmVersion *<a class="code" href="mips_8txt.html#a1fbad9337ceb50622aa5cb6b2ff47c09">info</a>;</div>
<div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;                    <a class="code" href="mips_8txt.html#a1fbad9337ceb50622aa5cb6b2ff47c09">info</a> = drmGetVersion(priv-&gt;<a class="code" href="struct_v_a_a_p_i_device_priv.html#aa0d7b3aa4d16e26802900a5c7c155f4b">drm_fd</a>);</div>
<div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;                    <span class="keywordflow">if</span> (strcmp(kernel_driver-&gt;<a class="code" href="struct_a_v_dictionary_entry.html#aa38678f2cad36f120d42e56449c5edb4">value</a>, <a class="code" href="mips_8txt.html#a1fbad9337ceb50622aa5cb6b2ff47c09">info</a>-&gt;name)) {</div>
<div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;                        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, <a class="code" href="group__lavu__log__constants.html#ga9b58b28e2d429b930b69db19877f76a8">AV_LOG_VERBOSE</a>, <span class="stringliteral">&quot;Ignoring device %d &quot;</span></div>
<div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;                               <span class="stringliteral">&quot;with non-matching kernel driver (%s).\n&quot;</span>,</div>
<div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;                               n, <a class="code" href="mips_8txt.html#a1fbad9337ceb50622aa5cb6b2ff47c09">info</a>-&gt;name);</div>
<div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;                        drmFreeVersion(<a class="code" href="mips_8txt.html#a1fbad9337ceb50622aa5cb6b2ff47c09">info</a>);</div>
<div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;                        close(priv-&gt;<a class="code" href="struct_v_a_a_p_i_device_priv.html#aa0d7b3aa4d16e26802900a5c7c155f4b">drm_fd</a>);</div>
<div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;                        priv-&gt;<a class="code" href="struct_v_a_a_p_i_device_priv.html#aa0d7b3aa4d16e26802900a5c7c155f4b">drm_fd</a> = -1;</div>
<div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;                        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;                    }</div>
<div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;                    <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, <a class="code" href="group__lavu__log__constants.html#ga9b58b28e2d429b930b69db19877f76a8">AV_LOG_VERBOSE</a>, <span class="stringliteral">&quot;Trying to use &quot;</span></div>
<div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;                           <span class="stringliteral">&quot;DRM render node for device %d, &quot;</span></div>
<div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;                           <span class="stringliteral">&quot;with matching kernel driver (%s).\n&quot;</span>,</div>
<div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;                           n, <a class="code" href="mips_8txt.html#a1fbad9337ceb50622aa5cb6b2ff47c09">info</a>-&gt;name);</div>
<div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;                    drmFreeVersion(<a class="code" href="mips_8txt.html#a1fbad9337ceb50622aa5cb6b2ff47c09">info</a>);</div>
<div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;                } <span class="keywordflow">else</span></div>
<div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;                {</div>
<div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;                    <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, <a class="code" href="group__lavu__log__constants.html#ga9b58b28e2d429b930b69db19877f76a8">AV_LOG_VERBOSE</a>, <span class="stringliteral">&quot;Trying to use &quot;</span></div>
<div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;                           <span class="stringliteral">&quot;DRM render node for device %d.\n&quot;</span>, n);</div>
<div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;                }</div>
<div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;            }</div>
<div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;            <span class="keywordflow">if</span> (n &gt;= max_devices)</div>
<div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;        }</div>
<div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160; </div>
<div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;        display = vaGetDisplayDRM(priv-&gt;<a class="code" href="struct_v_a_a_p_i_device_priv.html#aa0d7b3aa4d16e26802900a5c7c155f4b">drm_fd</a>);</div>
<div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;        <span class="keywordflow">if</span> (!display) {</div>
<div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, <a class="code" href="group__lavu__log__constants.html#ga9b58b28e2d429b930b69db19877f76a8">AV_LOG_VERBOSE</a>, <span class="stringliteral">&quot;Cannot open a VA display &quot;</span></div>
<div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;                   <span class="stringliteral">&quot;from DRM device %s.\n&quot;</span>, device);</div>
<div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="group__lavu__error.html#ga9c520e483ba8648495620ffdb4c491f2">AVERROR_EXTERNAL</a>;</div>
<div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;        }</div>
<div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;    }</div>
<div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160; </div>
<div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;<span class="preprocessor">#if HAVE_VAAPI_X11</span></div>
<div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;    <span class="keywordflow">if</span> (!display &amp;&amp; try_x11) {</div>
<div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;        <span class="comment">// Try to open the device as an X11 display.</span></div>
<div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;        priv-&gt;x11_display = XOpenDisplay(device);</div>
<div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;        <span class="keywordflow">if</span> (!priv-&gt;x11_display) {</div>
<div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, <a class="code" href="group__lavu__log__constants.html#ga9b58b28e2d429b930b69db19877f76a8">AV_LOG_VERBOSE</a>, <span class="stringliteral">&quot;Cannot open X11 display &quot;</span></div>
<div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;                   <span class="stringliteral">&quot;%s.\n&quot;</span>, XDisplayName(device));</div>
<div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;            display = vaGetDisplay(priv-&gt;x11_display);</div>
<div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;            <span class="keywordflow">if</span> (!display) {</div>
<div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;                <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Cannot open a VA display &quot;</span></div>
<div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;                       <span class="stringliteral">&quot;from X11 display %s.\n&quot;</span>, XDisplayName(device));</div>
<div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="group__lavu__error.html#ga4ebaa288c7684a26a591c501208910e4">AVERROR_UNKNOWN</a>;</div>
<div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;            }</div>
<div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160; </div>
<div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, <a class="code" href="group__lavu__log__constants.html#ga9b58b28e2d429b930b69db19877f76a8">AV_LOG_VERBOSE</a>, <span class="stringliteral">&quot;Opened VA display via &quot;</span></div>
<div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;                   <span class="stringliteral">&quot;X11 display %s.\n&quot;</span>, XDisplayName(device));</div>
<div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;        }</div>
<div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;    }</div>
<div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160; </div>
<div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;    <span class="keywordflow">if</span> (!display) {</div>
<div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;        <span class="keywordflow">if</span> (device)</div>
<div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;No VA display found for &quot;</span></div>
<div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;                   <span class="stringliteral">&quot;device %s.\n&quot;</span>, device);</div>
<div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;No VA display found for &quot;</span></div>
<div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;                   <span class="stringliteral">&quot;any default device.\n&quot;</span>);</div>
<div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EINVAL);</div>
<div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;    }</div>
<div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160; </div>
<div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;    ent = <a class="code" href="group__lavu__dict.html#gae67f143237b2cb2936c9b147aa6dfde3">av_dict_get</a>(<a class="code" href="tests_2movenc_8c.html#af540b728145b614e34c4e10930354b93">opts</a>, <span class="stringliteral">&quot;driver&quot;</span>, <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0);</div>
<div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;    <span class="keywordflow">if</span> (ent) {</div>
<div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;<span class="preprocessor">#if VA_CHECK_VERSION(0, 38, 0)</span></div>
<div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;        VAStatus vas;</div>
<div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;        vas = vaSetDriverName(display, ent-&gt;<a class="code" href="struct_a_v_dictionary_entry.html#aa38678f2cad36f120d42e56449c5edb4">value</a>);</div>
<div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;        <span class="keywordflow">if</span> (vas != VA_STATUS_SUCCESS) {</div>
<div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to set driver name to &quot;</span></div>
<div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;                   <span class="stringliteral">&quot;%s: %d (%s).\n&quot;</span>, ent-&gt;<a class="code" href="struct_a_v_dictionary_entry.html#aa38678f2cad36f120d42e56449c5edb4">value</a>, vas, vaErrorStr(vas));</div>
<div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;            vaTerminate(display);</div>
<div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="group__lavu__error.html#ga9c520e483ba8648495620ffdb4c491f2">AVERROR_EXTERNAL</a>;</div>
<div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;        }</div>
<div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, <a class="code" href="group__lavu__log__constants.html#ga85b57516ca703cc47d9bbe5f4658c716">AV_LOG_WARNING</a>, <span class="stringliteral">&quot;Driver name setting is not &quot;</span></div>
<div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;               <span class="stringliteral">&quot;supported with this VAAPI version.\n&quot;</span>);</div>
<div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;    }</div>
<div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160; </div>
<div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="hwcontext__vaapi_8c.html#ab28ff5528527cb3bda2249941e94aaac">vaapi_device_connect</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, display);</div>
<div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;}</div>
<div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160; </div>
<div class="line"><a name="l01649"></a><span class="lineno"><a class="line" href="hwcontext__vaapi_8c.html#a1aa12e24c7e30e23d21b753c095defca"> 1649</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="hwcontext__vaapi_8c.html#a1aa12e24c7e30e23d21b753c095defca">vaapi_device_derive</a>(<a class="code" href="struct_a_v_h_w_device_context.html">AVHWDeviceContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>,</div>
<div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;                               <a class="code" href="struct_a_v_h_w_device_context.html">AVHWDeviceContext</a> *src_ctx,</div>
<div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;                               <a class="code" href="struct_a_v_dictionary.html">AVDictionary</a> *<a class="code" href="tests_2movenc_8c.html#af540b728145b614e34c4e10930354b93">opts</a>, <span class="keywordtype">int</span> <a class="code" href="cbs__av1_8c.html#a67119bce106892b6dade1dc5aa405ac9">flags</a>)</div>
<div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;{</div>
<div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;<span class="preprocessor">#if HAVE_VAAPI_DRM</span></div>
<div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;    <span class="keywordflow">if</span> (src_ctx-&gt;<a class="code" href="struct_a_v_h_w_device_context.html#abc92603a11768828ef3aea1f9d089308">type</a> == <a class="code" href="hwcontext_8h.html#acf25724be4b066a51ad86aa9214b0d34aa04ac36fb964a5c191566a8e809de743">AV_HWDEVICE_TYPE_DRM</a>) {</div>
<div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;        <a class="code" href="struct_a_v_d_r_m_device_context.html">AVDRMDeviceContext</a> *src_hwctx = src_ctx-&gt;<a class="code" href="struct_a_v_h_w_device_context.html#a46055b48d1a40445d775b4ae24f77f20">hwctx</a>;</div>
<div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;        VADisplay *display;</div>
<div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;        <a class="code" href="struct_v_a_a_p_i_device_priv.html">VAAPIDevicePriv</a> *priv;</div>
<div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;        <span class="keywordtype">int</span> fd;</div>
<div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160; </div>
<div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;        <span class="keywordflow">if</span> (src_hwctx-&gt;<a class="code" href="struct_a_v_d_r_m_device_context.html#a22790a8cbf5681bbdee76a6bc99f02f5">fd</a> &lt; 0) {</div>
<div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;DRM instance requires an associated &quot;</span></div>
<div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;                   <span class="stringliteral">&quot;device to derive a VA display from.\n&quot;</span>);</div>
<div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EINVAL);</div>
<div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;        }</div>
<div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160; </div>
<div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;<span class="preprocessor">#if CONFIG_LIBDRM</span></div>
<div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;        {</div>
<div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;            <span class="keywordtype">int</span> node_type = drmGetNodeTypeFromFd(src_hwctx-&gt;<a class="code" href="struct_a_v_d_r_m_device_context.html#a22790a8cbf5681bbdee76a6bc99f02f5">fd</a>);</div>
<div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;            <span class="keywordtype">char</span> *render_node;</div>
<div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;            <span class="keywordflow">if</span> (node_type &lt; 0) {</div>
<div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;                <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;DRM instance fd does not appear &quot;</span></div>
<div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;                       <span class="stringliteral">&quot;to refer to a DRM device.\n&quot;</span>);</div>
<div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EINVAL);</div>
<div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;            }</div>
<div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;            <span class="keywordflow">if</span> (node_type == DRM_NODE_RENDER) {</div>
<div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;                fd = src_hwctx-&gt;<a class="code" href="struct_a_v_d_r_m_device_context.html#a22790a8cbf5681bbdee76a6bc99f02f5">fd</a>;</div>
<div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;                render_node = drmGetRenderDeviceNameFromFd(src_hwctx-&gt;<a class="code" href="struct_a_v_d_r_m_device_context.html#a22790a8cbf5681bbdee76a6bc99f02f5">fd</a>);</div>
<div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;                <span class="keywordflow">if</span> (!render_node) {</div>
<div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;                    <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, <a class="code" href="group__lavu__log__constants.html#ga9b58b28e2d429b930b69db19877f76a8">AV_LOG_VERBOSE</a>, <span class="stringliteral">&quot;Using non-render node &quot;</span></div>
<div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;                           <span class="stringliteral">&quot;because the device does not have an &quot;</span></div>
<div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;                           <span class="stringliteral">&quot;associated render node.\n&quot;</span>);</div>
<div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;                    fd = src_hwctx-&gt;<a class="code" href="struct_a_v_d_r_m_device_context.html#a22790a8cbf5681bbdee76a6bc99f02f5">fd</a>;</div>
<div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;                    fd = open(render_node, O_RDWR);</div>
<div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;                    <span class="keywordflow">if</span> (fd &lt; 0) {</div>
<div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;                        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, <a class="code" href="group__lavu__log__constants.html#ga9b58b28e2d429b930b69db19877f76a8">AV_LOG_VERBOSE</a>, <span class="stringliteral">&quot;Using non-render node &quot;</span></div>
<div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;                               <span class="stringliteral">&quot;because the associated render node &quot;</span></div>
<div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;                               <span class="stringliteral">&quot;could not be opened.\n&quot;</span>);</div>
<div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;                        fd = src_hwctx-&gt;<a class="code" href="struct_a_v_d_r_m_device_context.html#a22790a8cbf5681bbdee76a6bc99f02f5">fd</a>;</div>
<div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;                    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;                        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, <a class="code" href="group__lavu__log__constants.html#ga9b58b28e2d429b930b69db19877f76a8">AV_LOG_VERBOSE</a>, <span class="stringliteral">&quot;Using render node %s &quot;</span></div>
<div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;                               <span class="stringliteral">&quot;in place of non-render DRM device.\n&quot;</span>,</div>
<div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;                               render_node);</div>
<div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;                    }</div>
<div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;                    free(render_node);</div>
<div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;                }</div>
<div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;            }</div>
<div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;        }</div>
<div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;        fd = src_hwctx-&gt;<a class="code" href="struct_a_v_d_r_m_device_context.html#a22790a8cbf5681bbdee76a6bc99f02f5">fd</a>;</div>
<div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160; </div>
<div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;        priv = <a class="code" href="group__lavu__mem__funcs.html#gaf143ecab33a3868b57345466c39de7c1">av_mallocz</a>(<span class="keyword">sizeof</span>(*priv));</div>
<div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;        <span class="keywordflow">if</span> (!priv) {</div>
<div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;            <span class="keywordflow">if</span> (fd != src_hwctx-&gt;<a class="code" href="struct_a_v_d_r_m_device_context.html#a22790a8cbf5681bbdee76a6bc99f02f5">fd</a>) {</div>
<div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;                <span class="comment">// The fd was opened in this function.</span></div>
<div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;                close(fd);</div>
<div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;            }</div>
<div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;        }</div>
<div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160; </div>
<div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;        <span class="keywordflow">if</span> (fd == src_hwctx-&gt;<a class="code" href="struct_a_v_d_r_m_device_context.html#a22790a8cbf5681bbdee76a6bc99f02f5">fd</a>) {</div>
<div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;            <span class="comment">// The fd is inherited from the source context and we are holding</span></div>
<div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;            <span class="comment">// a reference to that, we don&#39;t want to close it from here.</span></div>
<div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;            priv-&gt;<a class="code" href="struct_v_a_a_p_i_device_priv.html#aa0d7b3aa4d16e26802900a5c7c155f4b">drm_fd</a> = -1;</div>
<div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;            priv-&gt;<a class="code" href="struct_v_a_a_p_i_device_priv.html#aa0d7b3aa4d16e26802900a5c7c155f4b">drm_fd</a> = fd;</div>
<div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;        }</div>
<div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160; </div>
<div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;user_opaque = priv;</div>
<div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;free        = &amp;<a class="code" href="hwcontext__vaapi_8c.html#a5c28d40b7a2a444060f25438fc07bfab">vaapi_device_free</a>;</div>
<div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160; </div>
<div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;        display = vaGetDisplayDRM(fd);</div>
<div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;        <span class="keywordflow">if</span> (!display) {</div>
<div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to open a VA display from &quot;</span></div>
<div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;                   <span class="stringliteral">&quot;DRM device.\n&quot;</span>);</div>
<div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(EIO);</div>
<div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;        }</div>
<div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160; </div>
<div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="hwcontext__vaapi_8c.html#ab28ff5528527cb3bda2249941e94aaac">vaapi_device_connect</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, display);</div>
<div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;    }</div>
<div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOSYS);</div>
<div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;}</div>
<div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160; </div>
<div class="line"><a name="l01737"></a><span class="lineno"><a class="line" href="hwcontext__vaapi_8c.html#a22f331e5e23a3b7aa7ab00f39cbcb289"> 1737</a></span>&#160;<span class="keyword">const</span> <a class="code" href="struct_h_w_context_type.html">HWContextType</a> <a class="code" href="hwcontext__vaapi_8c.html#a22f331e5e23a3b7aa7ab00f39cbcb289">ff_hwcontext_type_vaapi</a> = {</div>
<div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;    .<a class="code" href="struct_h_w_context_type.html#a5ddb5fc39d16ce3147a5640c8d040937">type</a>                   = <a class="code" href="hwcontext_8h.html#acf25724be4b066a51ad86aa9214b0d34af5dfa6181a3a6efb0f4a0c5f38d76b95">AV_HWDEVICE_TYPE_VAAPI</a>,</div>
<div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;    .name                   = <span class="stringliteral">&quot;VAAPI&quot;</span>,</div>
<div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160; </div>
<div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;    .device_hwctx_size      = <span class="keyword">sizeof</span>(<a class="code" href="hwcontext__vaapi_8h.html#a9ab72814f289fef89199cc23ca4ce168">AVVAAPIDeviceContext</a>),</div>
<div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;    .device_priv_size       = <span class="keyword">sizeof</span>(<a class="code" href="struct_v_a_a_p_i_device_context.html">VAAPIDeviceContext</a>),</div>
<div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;    .device_hwconfig_size   = <span class="keyword">sizeof</span>(<a class="code" href="hwcontext__vaapi_8h.html#ae7fbaa64d37580b0a7c296be034c6a96">AVVAAPIHWConfig</a>),</div>
<div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;    .frames_hwctx_size      = <span class="keyword">sizeof</span>(<a class="code" href="struct_a_v_v_a_a_p_i_frames_context.html">AVVAAPIFramesContext</a>),</div>
<div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;    .frames_priv_size       = <span class="keyword">sizeof</span>(<a class="code" href="hwcontext__vaapi_8c.html#a798b1d4dd7f51b5feb850407bffa4191">VAAPIFramesContext</a>),</div>
<div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160; </div>
<div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;    .device_create          = &amp;<a class="code" href="hwcontext__vaapi_8c.html#a173122e20006f4664e23d28ea3c991c5">vaapi_device_create</a>,</div>
<div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;    .device_derive          = &amp;<a class="code" href="hwcontext__vaapi_8c.html#a1aa12e24c7e30e23d21b753c095defca">vaapi_device_derive</a>,</div>
<div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;    .<a class="code" href="v4l2_8c.html#adfa15bad3aafacfb99756a8dc059d93f">device_init</a>            = &amp;<a class="code" href="hwcontext__vaapi_8c.html#adef9d2d364c6fe21c47ada497bf8bc9c">vaapi_device_init</a>,</div>
<div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;    .device_uninit          = &amp;<a class="code" href="hwcontext__vaapi_8c.html#af0d00b9a2d118b471d8d39a7c05a45f5">vaapi_device_uninit</a>,</div>
<div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;    .frames_get_constraints = &amp;<a class="code" href="hwcontext__vaapi_8c.html#a4936608c613e9564d7ebae64b240915f">vaapi_frames_get_constraints</a>,</div>
<div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;    .frames_init            = &amp;<a class="code" href="hwcontext__vaapi_8c.html#a3051d7e401501e5313bf571c897ddef9">vaapi_frames_init</a>,</div>
<div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;    .frames_uninit          = &amp;<a class="code" href="hwcontext__vaapi_8c.html#a880e906f04e5137e4a282b0e71ed99a6">vaapi_frames_uninit</a>,</div>
<div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;    .frames_get_buffer      = &amp;<a class="code" href="hwcontext__vaapi_8c.html#a81e23f5ebcce6cc52f2a1a1cb9cf08bf">vaapi_get_buffer</a>,</div>
<div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;    .transfer_get_formats   = &amp;<a class="code" href="hwcontext__vaapi_8c.html#a85da78b8b9ef5dbb13266291c28e6ed7">vaapi_transfer_get_formats</a>,</div>
<div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;    .transfer_data_to       = &amp;<a class="code" href="hwcontext__vaapi_8c.html#a2d479217c74cf77279763dd3d10ea497">vaapi_transfer_data_to</a>,</div>
<div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;    .transfer_data_from     = &amp;<a class="code" href="hwcontext__vaapi_8c.html#a051c6a28933259bd6ede158e606521fc">vaapi_transfer_data_from</a>,</div>
<div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;    .map_to                 = &amp;<a class="code" href="hwcontext__vaapi_8c.html#ae140fe67dad9241007a59ea2c82c4ab1">vaapi_map_to</a>,</div>
<div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;    .map_from               = &amp;<a class="code" href="hwcontext__vaapi_8c.html#a74a5679566484667a7ec44c2f968be3a">vaapi_map_from</a>,</div>
<div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160; </div>
<div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;    .<a class="code" href="libkvazaar_8c.html#aa1219ee396a270ba57fd4f2306b64c6e">pix_fmts</a> = (<span class="keyword">const</span> <span class="keyword">enum</span> <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5">AVPixelFormat</a>[]) {</div>
<div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;        <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5abb09cadf3b2d6b5ce5980401bcf638a8">AV_PIX_FMT_VAAPI</a>,</div>
<div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;        <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a0e08f8a5d0fa21c3e258816a9dcce7c3">AV_PIX_FMT_NONE</a></div>
<div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;    },</div>
<div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;};</div>
</div><!-- fragment --></div><!-- contents -->
<div class="ttc" id="asignature_8h_html_a12f58149bb2cdab504621ba5b390ef64"><div class="ttname"><a href="signature_8h.html#a12f58149bb2cdab504621ba5b390ef64">formats</a></div><div class="ttdeci">formats</div><div class="ttdef"><b>Definition:</b> <a href="signature_8h_source.html#l00048">signature.h:48</a></div></div>
<div class="ttc" id="ahwcontext__vaapi_8c_html_a1aa12e24c7e30e23d21b753c095defca"><div class="ttname"><a href="hwcontext__vaapi_8c.html#a1aa12e24c7e30e23d21b753c095defca">vaapi_device_derive</a></div><div class="ttdeci">static int vaapi_device_derive(AVHWDeviceContext *ctx, AVHWDeviceContext *src_ctx, AVDictionary *opts, int flags)</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vaapi_8c_source.html#l01649">hwcontext_vaapi.c:1649</a></div></div>
<div class="ttc" id="astruct_a_v_v_a_a_p_i_frames_context_html_af574bfa0abf14b96ae667f25494a3bcf"><div class="ttname"><a href="struct_a_v_v_a_a_p_i_frames_context.html#af574bfa0abf14b96ae667f25494a3bcf">AVVAAPIFramesContext::nb_surfaces</a></div><div class="ttdeci">int nb_surfaces</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vaapi_8h_source.html#l00102">hwcontext_vaapi.h:102</a></div></div>
<div class="ttc" id="agroup__lavu__log__constants_html_ga85b57516ca703cc47d9bbe5f4658c716"><div class="ttname"><a href="group__lavu__log__constants.html#ga85b57516ca703cc47d9bbe5f4658c716">AV_LOG_WARNING</a></div><div class="ttdeci">#define AV_LOG_WARNING</div><div class="ttdef"><b>Definition:</b> <a href="log_8h_source.html#l00200">log.h:200</a></div></div>
<div class="ttc" id="apixfmt_8h_html_a9a8e335cf3be472042bc9f0cf80cd4c5"><div class="ttname"><a href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5">AVPixelFormat</a></div><div class="ttdeci">AVPixelFormat</div><div class="ttdef"><b>Definition:</b> <a href="pixfmt_8h_source.html#l00064">pixfmt.h:64</a></div></div>
<div class="ttc" id="afilter__design_8txt_html_adf2fb515710d47541f7150ecd2950e76"><div class="ttname"><a href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a></div><div class="ttdeci">Filter the word frame indicates either a video frame or a group of audio as stored in an AVFrame structure Format for each input and each output the list of supported formats For video that means pixel format For audio that means channel sample they are references to shared objects When the negotiation mechanism computes the intersection of the formats supported at each end of a all references to both lists are replaced with a reference to the intersection And when a single format is eventually chosen for a link amongst the remaining all references to the list are updated That means that if a filter requires that its input and output have the same format amongst a supported all it has to do is use a reference to the same list of formats query_formats can leave some formats unset and return AVERROR(EAGAIN) to cause the negotiation mechanism toagain later. That can be used by filters with complex requirements to use the format negotiated on one link to set the formats supported on another. Frame references ownership and permissions</div></div>
<div class="ttc" id="astruct_a_v_dictionary_html"><div class="ttname"><a href="struct_a_v_dictionary.html">AVDictionary</a></div><div class="ttdef"><b>Definition:</b> <a href="dict_8c_source.html#l00030">dict.c:30</a></div></div>
<div class="ttc" id="astruct_a_v_h_w_frames_context_html_a9e6f29d0f744930cdd0e8bdff8771520"><div class="ttname"><a href="struct_a_v_h_w_frames_context.html#a9e6f29d0f744930cdd0e8bdff8771520">AVHWFramesContext::width</a></div><div class="ttdeci">int width</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext_8h_source.html#l00229">hwcontext.h:229</a></div></div>
<div class="ttc" id="astruct_a_v_h_w_frames_constraints_html_a34e06e3397af2b83de9d78f893bf4168"><div class="ttname"><a href="struct_a_v_h_w_frames_constraints.html#a34e06e3397af2b83de9d78f893bf4168">AVHWFramesConstraints::max_width</a></div><div class="ttdeci">int max_width</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext_8h_source.html#l00478">hwcontext.h:478</a></div></div>
<div class="ttc" id="astruct_a_v_d_r_m_frame_descriptor_html"><div class="ttname"><a href="struct_a_v_d_r_m_frame_descriptor.html">AVDRMFrameDescriptor</a></div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__drm_8h_source.html#l00133">hwcontext_drm.h:133</a></div></div>
<div class="ttc" id="astruct_v_a_a_p_i_device_priv_html_aa0d7b3aa4d16e26802900a5c7c155f4b"><div class="ttname"><a href="struct_v_a_a_p_i_device_priv.html#aa0d7b3aa4d16e26802900a5c7c155f4b">VAAPIDevicePriv::drm_fd</a></div><div class="ttdeci">int drm_fd</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vaapi_8c_source.html#l00060">hwcontext_vaapi.c:60</a></div></div>
<div class="ttc" id="astruct_a_v_h_w_device_context_html_abc92603a11768828ef3aea1f9d089308"><div class="ttname"><a href="struct_a_v_h_w_device_context.html#abc92603a11768828ef3aea1f9d089308">AVHWDeviceContext::type</a></div><div class="ttdeci">enum AVHWDeviceType type</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext_8h_source.html#l00071">hwcontext.h:79</a></div></div>
<div class="ttc" id="acommon_8h_html_a09a0bb7d8fcfac416de7a5fe7fd8b0f1"><div class="ttname"><a href="common_8h.html#a09a0bb7d8fcfac416de7a5fe7fd8b0f1">FFSWAP</a></div><div class="ttdeci">#define FFSWAP(type, a, b)</div><div class="ttdef"><b>Definition:</b> <a href="common_8h_source.html#l00099">common.h:99</a></div></div>
<div class="ttc" id="astructmessage_html"><div class="ttname"><a href="structmessage.html">message</a></div><div class="ttdef"><b>Definition:</b> <a href="api-threadmessage-test_8c_source.html#l00046">api-threadmessage-test.c:46</a></div></div>
<div class="ttc" id="astruct_v_a_a_p_i_frames_context_html_a85819fdf67f42ea8e5bc159d8dbe2acd"><div class="ttname"><a href="struct_v_a_a_p_i_frames_context.html#a85819fdf67f42ea8e5bc159d8dbe2acd">VAAPIFramesContext::attributes</a></div><div class="ttdeci">VASurfaceAttrib * attributes</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vaapi_8c_source.html#l00076">hwcontext_vaapi.c:76</a></div></div>
<div class="ttc" id="amem_8c_html_a254f3455439c15a2c8a75b8f0235fdbd"><div class="ttname"><a href="mem_8c.html#a254f3455439c15a2c8a75b8f0235fdbd">av_malloc_array</a></div><div class="ttdeci">void * av_malloc_array(size_t nmemb, size_t size)</div><div class="ttdef"><b>Definition:</b> <a href="mem_8c_source.html#l00182">mem.c:182</a></div></div>
<div class="ttc" id="ahwcontext__vaapi_8c_html_ae22916bf2f7b55e5815fe1d06f74bca0"><div class="ttname"><a href="hwcontext__vaapi_8c.html#ae22916bf2f7b55e5815fe1d06f74bca0">vaapi_driver_quirks_table</a></div><div class="ttdeci">static const struct @0 vaapi_driver_quirks_table[]</div></div>
<div class="ttc" id="astruct_a_v_buffer_ref_html_acb8452e99cd75074b93800b532c6ea4b"><div class="ttname"><a href="struct_a_v_buffer_ref.html#acb8452e99cd75074b93800b532c6ea4b">AVBufferRef::data</a></div><div class="ttdeci">uint8_t * data</div><div class="ttdef"><b>Definition:</b> <a href="buffer_8h_source.html#l00089">buffer.h:89</a></div></div>
<div class="ttc" id="ahwcontext__vaapi_8h_html_a9ab72814f289fef89199cc23ca4ce168"><div class="ttname"><a href="hwcontext__vaapi_8h.html#a9ab72814f289fef89199cc23ca4ce168">AVVAAPIDeviceContext</a></div><div class="ttdeci">struct AVVAAPIDeviceContext AVVAAPIDeviceContext</div></div>
<div class="ttc" id="agroup__lavu__frame_html_ga979d73f3228814aee56aeca0636e37cc"><div class="ttname"><a href="group__lavu__frame.html#ga979d73f3228814aee56aeca0636e37cc">av_frame_free</a></div><div class="ttdeci">void av_frame_free(AVFrame **frame)</div><div class="ttdef"><b>Definition:</b> <a href="frame_8c_source.html#l00203">frame.c:203</a></div></div>
<div class="ttc" id="astruct_a_v_h_w_frames_context_html_a69e956e8d2d73d65d015c4ed895ec642"><div class="ttname"><a href="struct_a_v_h_w_frames_context.html#a69e956e8d2d73d65d015c4ed895ec642">AVHWFramesContext::internal</a></div><div class="ttdeci">AVHWFramesInternal * internal</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext_8h_source.html#l00134">hwcontext.h:134</a></div></div>
<div class="ttc" id="agroup__avoptions_html_gga06fc87d81c62e9abb8790b6e5713c55bac12b0a2a379fe4b4b00353aac56ed9f4"><div class="ttname"><a href="group__avoptions.html#gga06fc87d81c62e9abb8790b6e5713c55bac12b0a2a379fe4b4b00353aac56ed9f4">AV_HWFRAME_MAP_OVERWRITE</a></div><div class="ttdeci">@ AV_HWFRAME_MAP_OVERWRITE</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext_8h_source.html#l00534">hwcontext.h:534</a></div></div>
<div class="ttc" id="astruct_h_w_map_descriptor_html_a7ecea93e498181196f2121b85c07411d"><div class="ttname"><a href="struct_h_w_map_descriptor.html#a7ecea93e498181196f2121b85c07411d">HWMapDescriptor::priv</a></div><div class="ttdeci">void * priv</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__internal_8h_source.html#l00151">hwcontext_internal.h:151</a></div></div>
<div class="ttc" id="apixdesc_8h_html"><div class="ttname"><a href="pixdesc_8h.html">pixdesc.h</a></div></div>
<div class="ttc" id="ahwcontext__vaapi_8c_html_a48b950ed906a38b88245800841cc954e"><div class="ttname"><a href="hwcontext__vaapi_8c.html#a48b950ed906a38b88245800841cc954e">vaapi_format_from_fourcc</a></div><div class="ttdeci">static const VAAPIFormatDescriptor * vaapi_format_from_fourcc(unsigned int fourcc)</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vaapi_8c_source.html#l00146">hwcontext_vaapi.c:146</a></div></div>
<div class="ttc" id="ahwcontext__vaapi_8c_html_ae140fe67dad9241007a59ea2c82c4ab1"><div class="ttname"><a href="hwcontext__vaapi_8c.html#ae140fe67dad9241007a59ea2c82c4ab1">vaapi_map_to</a></div><div class="ttdeci">static int vaapi_map_to(AVHWFramesContext *hwfc, AVFrame *dst, const AVFrame *src, int flags)</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vaapi_8c_source.html#l01407">hwcontext_vaapi.c:1407</a></div></div>
<div class="ttc" id="apixfmt_8h_html_a9a8e335cf3be472042bc9f0cf80cd4c5a76a05fccc6f58f7ab655deefd794713e"><div class="ttname"><a href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a76a05fccc6f58f7ab655deefd794713e">AV_PIX_FMT_DRM_PRIME</a></div><div class="ttdeci">@ AV_PIX_FMT_DRM_PRIME</div><div class="ttdef"><b>Definition:</b> <a href="pixfmt_8h_source.html#l00328">pixfmt.h:328</a></div></div>
<div class="ttc" id="amxf_8c_html_a084824fc871e38157790c99ae1240842"><div class="ttname"><a href="mxf_8c.html#a084824fc871e38157790c99ae1240842">data</a></div><div class="ttdeci">const char data[16]</div><div class="ttdef"><b>Definition:</b> <a href="mxf_8c_source.html#l00151">mxf.c:151</a></div></div>
<div class="ttc" id="ahwcontext__vaapi_8h_html_ae7fbaa64d37580b0a7c296be034c6a96"><div class="ttname"><a href="hwcontext__vaapi_8h.html#ae7fbaa64d37580b0a7c296be034c6a96">AVVAAPIHWConfig</a></div><div class="ttdeci">struct AVVAAPIHWConfig AVVAAPIHWConfig</div></div>
<div class="ttc" id="astruct_a_v_d_r_m_device_context_html"><div class="ttname"><a href="struct_a_v_d_r_m_device_context.html">AVDRMDeviceContext</a></div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__drm_8h_source.html#l00157">hwcontext_drm.h:157</a></div></div>
<div class="ttc" id="ahwcontext__vaapi_8c_html_a8f03bf69218a54531747ad192f50891f"><div class="ttname"><a href="hwcontext__vaapi_8c.html#a8f03bf69218a54531747ad192f50891f">vaapi_format_from_pix_fmt</a></div><div class="ttdeci">static const VAAPIFormatDescriptor * vaapi_format_from_pix_fmt(enum AVPixelFormat pix_fmt)</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vaapi_8c_source.html#l00156">hwcontext_vaapi.c:156</a></div></div>
<div class="ttc" id="agroup__lavu__log__constants_html_ga9b58b28e2d429b930b69db19877f76a8"><div class="ttname"><a href="group__lavu__log__constants.html#ga9b58b28e2d429b930b69db19877f76a8">AV_LOG_VERBOSE</a></div><div class="ttdeci">#define AV_LOG_VERBOSE</div><div class="ttdef"><b>Definition:</b> <a href="log_8h_source.html#l00210">log.h:210</a></div></div>
<div class="ttc" id="astruct_a_v_h_w_device_context_html_a46055b48d1a40445d775b4ae24f77f20"><div class="ttname"><a href="struct_a_v_h_w_device_context.html#a46055b48d1a40445d775b4ae24f77f20">AVHWDeviceContext::hwctx</a></div><div class="ttdeci">void * hwctx</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext_8h_source.html#l00092">hwcontext.h:92</a></div></div>
<div class="ttc" id="astruct_a_v_dictionary_entry_html"><div class="ttname"><a href="struct_a_v_dictionary_entry.html">AVDictionaryEntry</a></div><div class="ttdef"><b>Definition:</b> <a href="dict_8h_source.html#l00081">dict.h:81</a></div></div>
<div class="ttc" id="agroup__lavu__buffer_html_ga3e7f4c92db85ccba0b2a16dd0069842a"><div class="ttname"><a href="group__lavu__buffer.html#ga3e7f4c92db85ccba0b2a16dd0069842a">av_buffer_create</a></div><div class="ttdeci">AVBufferRef * av_buffer_create(uint8_t *data, int size, void(*free)(void *opaque, uint8_t *data), void *opaque, int flags)</div><div class="ttdef"><b>Definition:</b> <a href="buffer_8c_source.html#l00029">buffer.c:29</a></div></div>
<div class="ttc" id="ahwcontext_8c_html_a76e0387f519b3f1bd1b162e91b54b182"><div class="ttname"><a href="hwcontext_8c.html#a76e0387f519b3f1bd1b162e91b54b182">ff_hwframe_map_create</a></div><div class="ttdeci">int ff_hwframe_map_create(AVBufferRef *hwframe_ref, AVFrame *dst, const AVFrame *src, void(*unmap)(AVHWFramesContext *ctx, HWMapDescriptor *hwmap), void *priv)</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext_8c_source.html#l00737">hwcontext.c:737</a></div></div>
<div class="ttc" id="agroup__lavu__error_html_ga4ebaa288c7684a26a591c501208910e4"><div class="ttname"><a href="group__lavu__error.html#ga4ebaa288c7684a26a591c501208910e4">AVERROR_UNKNOWN</a></div><div class="ttdeci">#define AVERROR_UNKNOWN</div><div class="ttdoc">Unknown error, typically from an external library.</div><div class="ttdef"><b>Definition:</b> <a href="error_8h_source.html#l00071">error.h:71</a></div></div>
<div class="ttc" id="astruct_a_v_h_w_device_internal_html_ae7425663cca9541964518c66974a20bf"><div class="ttname"><a href="struct_a_v_h_w_device_internal.html#ae7425663cca9541964518c66974a20bf">AVHWDeviceInternal::priv</a></div><div class="ttdeci">void * priv</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__internal_8h_source.html#l00105">hwcontext_internal.h:105</a></div></div>
<div class="ttc" id="astruct_a_v_d_r_m_plane_descriptor_html_af1a0839b02055445257d431d946d96a7"><div class="ttname"><a href="struct_a_v_d_r_m_plane_descriptor.html#af1a0839b02055445257d431d946d96a7">AVDRMPlaneDescriptor::offset</a></div><div class="ttdeci">ptrdiff_t offset</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__drm_8h_source.html#l00083">hwcontext_drm.h:83</a></div></div>
<div class="ttc" id="ahwcontext__vaapi_8c_html_a3051d7e401501e5313bf571c897ddef9"><div class="ttname"><a href="hwcontext__vaapi_8c.html#a3051d7e401501e5313bf571c897ddef9">vaapi_frames_init</a></div><div class="ttdeci">static int vaapi_frames_init(AVHWFramesContext *hwfc)</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vaapi_8c_source.html#l00511">hwcontext_vaapi.c:511</a></div></div>
<div class="ttc" id="astruct_v_a_a_p_i_mapping_html_a0b638d38aa94acaede20b6623b6c0dbc"><div class="ttname"><a href="struct_v_a_a_p_i_mapping.html#a0b638d38aa94acaede20b6623b6c0dbc">VAAPIMapping::image</a></div><div class="ttdeci">VAImage image</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vaapi_8c_source.html#l00086">hwcontext_vaapi.c:86</a></div></div>
<div class="ttc" id="atableprint__vlc_8h_html_ae97db1f58b6b1515ed57a83bea3dd572"><div class="ttname"><a href="tableprint__vlc_8h.html#ae97db1f58b6b1515ed57a83bea3dd572">av_malloc</a></div><div class="ttdeci">#define av_malloc(s)</div><div class="ttdef"><b>Definition:</b> <a href="tableprint__vlc_8h_source.html#l00031">tableprint_vlc.h:31</a></div></div>
<div class="ttc" id="ahwcontext__vaapi_8c_html_a2d479217c74cf77279763dd3d10ea497"><div class="ttname"><a href="hwcontext__vaapi_8c.html#a2d479217c74cf77279763dd3d10ea497">vaapi_transfer_data_to</a></div><div class="ttdeci">static int vaapi_transfer_data_to(AVHWFramesContext *hwfc, AVFrame *dst, const AVFrame *src)</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vaapi_8c_source.html#l00925">hwcontext_vaapi.c:925</a></div></div>
<div class="ttc" id="astruct_v_a_a_p_i_surface_format_html"><div class="ttname"><a href="struct_v_a_a_p_i_surface_format.html">VAAPISurfaceFormat</a></div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vaapi_8c_source.html#l00063">hwcontext_vaapi.c:63</a></div></div>
<div class="ttc" id="astruct_a_v_h_w_frames_constraints_html_a3f1aec6d1c90f77837875c2a3598be46"><div class="ttname"><a href="struct_a_v_h_w_frames_constraints.html#a3f1aec6d1c90f77837875c2a3598be46">AVHWFramesConstraints::min_height</a></div><div class="ttdeci">int min_height</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext_8h_source.html#l00472">hwcontext.h:472</a></div></div>
<div class="ttc" id="astruct_a_v_frame_html_a29493fbfabaa21432c360a090426aa8e"><div class="ttname"><a href="struct_a_v_frame.html#a29493fbfabaa21432c360a090426aa8e">AVFrame::hw_frames_ctx</a></div><div class="ttdeci">AVBufferRef * hw_frames_ctx</div><div class="ttdef"><b>Definition:</b> <a href="frame_8h_source.html#l00647">frame.h:647</a></div></div>
<div class="ttc" id="astruct_a_v_h_w_frames_constraints_html_a4258bbe81f927b76b7ca5af44ba7ef6b"><div class="ttname"><a href="struct_a_v_h_w_frames_constraints.html#a4258bbe81f927b76b7ca5af44ba7ef6b">AVHWFramesConstraints::valid_hw_formats</a></div><div class="ttdeci">enum AVPixelFormat * valid_hw_formats</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext_8h_source.html#l00458">hwcontext.h:458</a></div></div>
<div class="ttc" id="astruct_v_a_a_p_i_format_html"><div class="ttname"><a href="struct_v_a_a_p_i_format.html">VAAPIFormat</a></div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vaapi_8c_source.html#l00091">hwcontext_vaapi.c:91</a></div></div>
<div class="ttc" id="acheckasm_8h_html_a73a3b169ac8c3419cbe15327e75ffcfd"><div class="ttname"><a href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a></div><div class="ttdeci">#define fail()</div><div class="ttdef"><b>Definition:</b> <a href="checkasm_8h_source.html#l00123">checkasm.h:123</a></div></div>
<div class="ttc" id="astruct_a_v_format_context_html_a32379cc371463b235d54235d4af06a15"><div class="ttname"><a href="struct_a_v_format_context.html#a32379cc371463b235d54235d4af06a15">AVFormatContext::flags</a></div><div class="ttdeci">int flags</div><div class="ttdef"><b>Definition:</b> <a href="avformat_8h_source.html#l01354">avformat.h:1354</a></div></div>
<div class="ttc" id="ahwcontext__vaapi_8c_html_a81e23f5ebcce6cc52f2a1a1cb9cf08bf"><div class="ttname"><a href="hwcontext__vaapi_8c.html#a81e23f5ebcce6cc52f2a1a1cb9cf08bf">vaapi_get_buffer</a></div><div class="ttdeci">static int vaapi_get_buffer(AVHWFramesContext *hwfc, AVFrame *frame)</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vaapi_8c_source.html#l00672">hwcontext_vaapi.c:672</a></div></div>
<div class="ttc" id="awriting__filters_8txt_html_a860450fba1f740387dc082792ad89517"><div class="ttname"><a href="writing__filters_8txt.html#a860450fba1f740387dc082792ad89517">type</a></div><div class="ttdeci">it s the only field you need to keep assuming you have a context There is some magic you don t need to care about around this just let it vf type</div><div class="ttdef"><b>Definition:</b> <a href="writing__filters_8txt_source.html#l00086">writing_filters.txt:86</a></div></div>
<div class="ttc" id="astruct_v_a_a_p_i_frames_context_html"><div class="ttname"><a href="struct_v_a_a_p_i_frames_context.html">VAAPIFramesContext</a></div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vaapi_8c_source.html#l00074">hwcontext_vaapi.c:74</a></div></div>
<div class="ttc" id="ahwcontext__drm_8h_html_a2ca5add12c48394bda6831c14e66d502"><div class="ttname"><a href="hwcontext__drm_8h.html#a2ca5add12c48394bda6831c14e66d502">AVDRMPlaneDescriptor</a></div><div class="ttdeci">struct AVDRMPlaneDescriptor AVDRMPlaneDescriptor</div></div>
<div class="ttc" id="astruct_a_v_h_w_frames_context_html_a9c3a94dcd9c96e19059b56a6bae9c764"><div class="ttname"><a href="struct_a_v_h_w_frames_context.html#a9c3a94dcd9c96e19059b56a6bae9c764">AVHWFramesContext::initial_pool_size</a></div><div class="ttdeci">int initial_pool_size</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext_8h_source.html#l00199">hwcontext.h:199</a></div></div>
<div class="ttc" id="astruct_v_a_a_p_i_device_priv_html"><div class="ttname"><a href="struct_v_a_a_p_i_device_priv.html">VAAPIDevicePriv</a></div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vaapi_8c_source.html#l00055">hwcontext_vaapi.c:55</a></div></div>
<div class="ttc" id="astruct_a_v_d_r_m_plane_descriptor_html_af07fe11d604e0a3b5fd934f9626c008b"><div class="ttname"><a href="struct_a_v_d_r_m_plane_descriptor.html#af07fe11d604e0a3b5fd934f9626c008b">AVDRMPlaneDescriptor::object_index</a></div><div class="ttdeci">int object_index</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__drm_8h_source.html#l00079">hwcontext_drm.h:79</a></div></div>
<div class="ttc" id="ahwcontext__vaapi_8c_html_a85da78b8b9ef5dbb13266291c28e6ed7"><div class="ttname"><a href="hwcontext__vaapi_8c.html#a85da78b8b9ef5dbb13266291c28e6ed7">vaapi_transfer_get_formats</a></div><div class="ttdeci">static int vaapi_transfer_get_formats(AVHWFramesContext *hwfc, enum AVHWFrameTransferDirection dir, enum AVPixelFormat **formats)</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vaapi_8c_source.html#l00686">hwcontext_vaapi.c:686</a></div></div>
<div class="ttc" id="astruct_a_v_h_w_device_context_html"><div class="ttname"><a href="struct_a_v_h_w_device_context.html">AVHWDeviceContext</a></div><div class="ttdef"><b>Definition:</b> <a href="hwcontext_8h_source.html#l00061">hwcontext.h:61</a></div></div>
<div class="ttc" id="astruct_v_a_a_p_i_device_context_html_a140b32d01481bfdd777005af34ea7500"><div class="ttname"><a href="struct_v_a_a_p_i_device_context.html#a140b32d01481bfdd777005af34ea7500">VAAPIDeviceContext::nb_formats</a></div><div class="ttdeci">int nb_formats</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vaapi_8c_source.html#l00071">hwcontext_vaapi.c:71</a></div></div>
<div class="ttc" id="ahwcontext__vaapi_8c_html_a22f331e5e23a3b7aa7ab00f39cbcb289"><div class="ttname"><a href="hwcontext__vaapi_8c.html#a22f331e5e23a3b7aa7ab00f39cbcb289">ff_hwcontext_type_vaapi</a></div><div class="ttdeci">const HWContextType ff_hwcontext_type_vaapi</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vaapi_8c_source.html#l01737">hwcontext_vaapi.c:1737</a></div></div>
<div class="ttc" id="ahwcontext__vaapi_8c_html_a0d2e91789fec5a4d02773feb59963c16"><div class="ttname"><a href="hwcontext__vaapi_8c.html#a0d2e91789fec5a4d02773feb59963c16">VAAPIMapping</a></div><div class="ttdeci">struct VAAPIMapping VAAPIMapping</div></div>
<div class="ttc" id="agroup__lavu__frame_html_gac700017c5270c79c1e1befdeeb008b2f"><div class="ttname"><a href="group__lavu__frame.html#gac700017c5270c79c1e1befdeeb008b2f">av_frame_alloc</a></div><div class="ttdeci">AVFrame * av_frame_alloc(void)</div><div class="ttdef"><b>Definition:</b> <a href="frame_8c_source.html#l00190">frame.c:190</a></div></div>
<div class="ttc" id="astruct_a_v_h_w_frames_context_html_ae61bbe1d8645a0c573085e29f1d0a58f"><div class="ttname"><a href="struct_a_v_h_w_frames_context.html#ae61bbe1d8645a0c573085e29f1d0a58f">AVHWFramesContext::height</a></div><div class="ttdeci">int height</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext_8h_source.html#l00229">hwcontext.h:229</a></div></div>
<div class="ttc" id="ahwcontext__vaapi_8c_html_a79703b1c498f43f86346e321f7eac553"><div class="ttname"><a href="hwcontext__vaapi_8c.html#a79703b1c498f43f86346e321f7eac553">vaapi_map_frame</a></div><div class="ttdeci">static int vaapi_map_frame(AVHWFramesContext *hwfc, AVFrame *dst, const AVFrame *src, int flags)</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vaapi_8c_source.html#l00759">hwcontext_vaapi.c:759</a></div></div>
<div class="ttc" id="astruct_a_v_v_a_a_p_i_device_context_html_a89951d5ccfad53ce81444773ea9f774e"><div class="ttname"><a href="struct_a_v_v_a_a_p_i_device_context.html#a89951d5ccfad53ce81444773ea9f774e">AVVAAPIDeviceContext::display</a></div><div class="ttdeci">VADisplay display</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vaapi_8h_source.html#l00072">hwcontext_vaapi.h:72</a></div></div>
<div class="ttc" id="agroup__avoptions_html_gga06fc87d81c62e9abb8790b6e5713c55ba236262031fe4c5503b2611c2c8fb520b"><div class="ttname"><a href="group__avoptions.html#gga06fc87d81c62e9abb8790b6e5713c55ba236262031fe4c5503b2611c2c8fb520b">AV_HWFRAME_MAP_READ</a></div><div class="ttdeci">@ AV_HWFRAME_MAP_READ</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext_8h_source.html#l00524">hwcontext.h:524</a></div></div>
<div class="ttc" id="astruct_a_v_v_a_a_p_i_h_w_config_html"><div class="ttname"><a href="struct_a_v_v_a_a_p_i_h_w_config.html">AVVAAPIHWConfig</a></div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vaapi_8h_source.html#l00110">hwcontext_vaapi.h:110</a></div></div>
<div class="ttc" id="aavassert_8h_html"><div class="ttname"><a href="avassert_8h.html">avassert.h</a></div></div>
<div class="ttc" id="astruct_h_w_map_descriptor_html_aac9a3c77af4a936a326770ee5973e261"><div class="ttname"><a href="struct_h_w_map_descriptor.html#aac9a3c77af4a936a326770ee5973e261">HWMapDescriptor::source</a></div><div class="ttdeci">AVFrame * source</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__internal_8h_source.html#l00136">hwcontext_internal.h:136</a></div></div>
<div class="ttc" id="agroup__avoptions_html_gga06fc87d81c62e9abb8790b6e5713c55ba8f29c39f016d0bf9a006b180b859ba4f"><div class="ttname"><a href="group__avoptions.html#gga06fc87d81c62e9abb8790b6e5713c55ba8f29c39f016d0bf9a006b180b859ba4f">AV_DRM_MAX_PLANES</a></div><div class="ttdeci">@ AV_DRM_MAX_PLANES</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__drm_8h_source.html#l00040">hwcontext_drm.h:39</a></div></div>
<div class="ttc" id="agroup__lavu__log__constants_html_gaffe151ff4cd8a24b2e77ac8d9616c85c"><div class="ttname"><a href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a></div><div class="ttdeci">#define AV_LOG_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="log_8h_source.html#l00194">log.h:194</a></div></div>
<div class="ttc" id="ahwcontext__vaapi_8c_html_a33100d8fbce72445b01f88003826d41d"><div class="ttname"><a href="hwcontext__vaapi_8c.html#a33100d8fbce72445b01f88003826d41d">match_string</a></div><div class="ttdeci">const char * match_string</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vaapi_8c_source.html#l00331">hwcontext_vaapi.c:331</a></div></div>
<div class="ttc" id="av4l2_8c_html_adfa15bad3aafacfb99756a8dc059d93f"><div class="ttname"><a href="v4l2_8c.html#adfa15bad3aafacfb99756a8dc059d93f">device_init</a></div><div class="ttdeci">static int device_init(AVFormatContext *ctx, int *width, int *height, uint32_t pixelformat)</div><div class="ttdef"><b>Definition:</b> <a href="v4l2_8c_source.html#l00192">v4l2.c:192</a></div></div>
<div class="ttc" id="astruct_v_a_a_p_i_device_context_html_a8fb5e8fa4388fbac00599532e1035651"><div class="ttname"><a href="struct_v_a_a_p_i_device_context.html#a8fb5e8fa4388fbac00599532e1035651">VAAPIDeviceContext::formats</a></div><div class="ttdeci">VAAPISurfaceFormat * formats</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vaapi_8c_source.html#l00070">hwcontext_vaapi.c:70</a></div></div>
<div class="ttc" id="agroup__lavu__dict_html_gae67f143237b2cb2936c9b147aa6dfde3"><div class="ttname"><a href="group__lavu__dict.html#gae67f143237b2cb2936c9b147aa6dfde3">av_dict_get</a></div><div class="ttdeci">AVDictionaryEntry * av_dict_get(const AVDictionary *m, const char *key, const AVDictionaryEntry *prev, int flags)</div><div class="ttdef"><b>Definition:</b> <a href="dict_8c_source.html#l00040">dict.c:40</a></div></div>
<div class="ttc" id="agroup__lavu__bufferpool_html_ga2c745ecb4001452423e775b06b20fb7c"><div class="ttname"><a href="group__lavu__bufferpool.html#ga2c745ecb4001452423e775b06b20fb7c">av_buffer_pool_get</a></div><div class="ttdeci">AVBufferRef * av_buffer_pool_get(AVBufferPool *pool)</div><div class="ttdef"><b>Definition:</b> <a href="buffer_8c_source.html#l00364">buffer.c:364</a></div></div>
<div class="ttc" id="ahwcontext__vaapi_8c_html_af9ba84030188934a6f3ee0f2a5a2c544"><div class="ttname"><a href="hwcontext__vaapi_8c.html#af9ba84030188934a6f3ee0f2a5a2c544">vaapi_pool_alloc</a></div><div class="ttdeci">static AVBufferRef * vaapi_pool_alloc(void *opaque, int size)</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vaapi_8c_source.html#l00467">hwcontext_vaapi.c:467</a></div></div>
<div class="ttc" id="astruct_a_v_dictionary_entry_html_aa38678f2cad36f120d42e56449c5edb4"><div class="ttname"><a href="struct_a_v_dictionary_entry.html#aa38678f2cad36f120d42e56449c5edb4">AVDictionaryEntry::value</a></div><div class="ttdeci">char * value</div><div class="ttdef"><b>Definition:</b> <a href="dict_8h_source.html#l00083">dict.h:83</a></div></div>
<div class="ttc" id="agroup__lavu__buffer_html_gaa818f8f1011d69acc50c1f29cb85e576"><div class="ttname"><a href="group__lavu__buffer.html#gaa818f8f1011d69acc50c1f29cb85e576">AV_BUFFER_FLAG_READONLY</a></div><div class="ttdeci">#define AV_BUFFER_FLAG_READONLY</div><div class="ttdef"><b>Definition:</b> <a href="buffer_8h_source.html#l00113">buffer.h:113</a></div></div>
<div class="ttc" id="ahwcontext__vaapi_8c_html_afa2cc8e7fd536ce24515ff6844e0c150"><div class="ttname"><a href="hwcontext__vaapi_8c.html#afa2cc8e7fd536ce24515ff6844e0c150">vaapi_get_image_format</a></div><div class="ttdeci">static int vaapi_get_image_format(AVHWDeviceContext *hwdev, enum AVPixelFormat pix_fmt, VAImageFormat **image_format)</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vaapi_8c_source.html#l00175">hwcontext_vaapi.c:175</a></div></div>
<div class="ttc" id="amips_8txt_html_a1fbad9337ceb50622aa5cb6b2ff47c09"><div class="ttname"><a href="mips_8txt.html#a1fbad9337ceb50622aa5cb6b2ff47c09">info</a></div><div class="ttdeci">MIPS optimizations info</div><div class="ttdef"><b>Definition:</b> <a href="mips_8txt_source.html#l00001">mips.txt:2</a></div></div>
<div class="ttc" id="akmsgrab_8c_html_ae7d1b8e0c4ef70d518ffc304de13032c"><div class="ttname"><a href="kmsgrab_8c.html#ae7d1b8e0c4ef70d518ffc304de13032c">DRM_FORMAT_MOD_INVALID</a></div><div class="ttdeci">#define DRM_FORMAT_MOD_INVALID</div><div class="ttdef"><b>Definition:</b> <a href="kmsgrab_8c_source.html#l00032">kmsgrab.c:32</a></div></div>
<div class="ttc" id="astruct_a_v_v_a_a_p_i_device_context_html_a7f2689d4ef32b2ee936508de03356e28"><div class="ttname"><a href="struct_a_v_v_a_a_p_i_device_context.html#a7f2689d4ef32b2ee936508de03356e28">AVVAAPIDeviceContext::driver_quirks</a></div><div class="ttdeci">unsigned int driver_quirks</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vaapi_8h_source.html#l00080">hwcontext_vaapi.h:80</a></div></div>
<div class="ttc" id="aavassert_8h_html_aae204192396f78cc8c5cd7ad5c57c23f"><div class="ttname"><a href="avassert_8h.html#aae204192396f78cc8c5cd7ad5c57c23f">av_assert0</a></div><div class="ttdeci">#define av_assert0(cond)</div><div class="ttdef"><b>Definition:</b> <a href="avassert_8h_source.html#l00037">avassert.h:37</a></div></div>
<div class="ttc" id="alibkvazaar_8c_html_aa1219ee396a270ba57fd4f2306b64c6e"><div class="ttname"><a href="libkvazaar_8c.html#aa1219ee396a270ba57fd4f2306b64c6e">pix_fmts</a></div><div class="ttdeci">static enum AVPixelFormat pix_fmts[]</div><div class="ttdef"><b>Definition:</b> <a href="libkvazaar_8c_source.html#l00162">libkvazaar.c:300</a></div></div>
<div class="ttc" id="astruct_a_v_h_w_frames_constraints_html_af220776925452091085139081d5d7251"><div class="ttname"><a href="struct_a_v_h_w_frames_constraints.html#af220776925452091085139081d5d7251">AVHWFramesConstraints::min_width</a></div><div class="ttdeci">int min_width</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext_8h_source.html#l00471">hwcontext.h:471</a></div></div>
<div class="ttc" id="agroup__lavu__log__constants_html_ga5b7221c3afd06848486776bd834a58a5"><div class="ttname"><a href="group__lavu__log__constants.html#ga5b7221c3afd06848486776bd834a58a5">AV_LOG_DEBUG</a></div><div class="ttdeci">#define AV_LOG_DEBUG</div><div class="ttdef"><b>Definition:</b> <a href="log_8h_source.html#l00215">log.h:215</a></div></div>
<div class="ttc" id="atests_2movenc_8c_html_a93cc7296f13f507c1fd7abd0db36b898"><div class="ttname"><a href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a></div><div class="ttdeci">AVFormatContext * ctx</div><div class="ttdef"><b>Definition:</b> <a href="tests_2movenc_8c_source.html#l00048">movenc.c:48</a></div></div>
<div class="ttc" id="astruct_a_v_h_w_frames_constraints_html_aabea88093c6f85d6185ffb0852a2217f"><div class="ttname"><a href="struct_a_v_h_w_frames_constraints.html#aabea88093c6f85d6185ffb0852a2217f">AVHWFramesConstraints::valid_sw_formats</a></div><div class="ttdeci">enum AVPixelFormat * valid_sw_formats</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext_8h_source.html#l00465">hwcontext.h:465</a></div></div>
<div class="ttc" id="ademuxing__decoding_8c_html_a7331e302ea7bb48e0b605a069576e135"><div class="ttname"><a href="demuxing__decoding_8c.html#a7331e302ea7bb48e0b605a069576e135">pix_fmt</a></div><div class="ttdeci">static enum AVPixelFormat pix_fmt</div><div class="ttdef"><b>Definition:</b> <a href="demuxing__decoding_8c_source.html#l00039">demuxing_decoding.c:40</a></div></div>
<div class="ttc" id="astruct_a_v_h_w_frames_internal_html_a2858e1cd83082cc8bcbbf581283e7af2"><div class="ttname"><a href="struct_a_v_h_w_frames_internal.html#a2858e1cd83082cc8bcbbf581283e7af2">AVHWFramesInternal::pool_internal</a></div><div class="ttdeci">AVBufferPool * pool_internal</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__internal_8h_source.html#l00118">hwcontext_internal.h:118</a></div></div>
<div class="ttc" id="agroup__avoptions_html_gga06fc87d81c62e9abb8790b6e5713c55ba5485e61dda42ec46dbab798a9c782751"><div class="ttname"><a href="group__avoptions.html#gga06fc87d81c62e9abb8790b6e5713c55ba5485e61dda42ec46dbab798a9c782751">AV_VAAPI_DRIVER_QUIRK_SURFACE_ATTRIBUTES</a></div><div class="ttdeci">@ AV_VAAPI_DRIVER_QUIRK_SURFACE_ATTRIBUTES</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vaapi_8h_source.html#l00060">hwcontext_vaapi.h:60</a></div></div>
<div class="ttc" id="astruct_a_v_d_r_m_frame_descriptor_html_a0a757137c80a528953645ab11f31e6b7"><div class="ttname"><a href="struct_a_v_d_r_m_frame_descriptor.html#a0a757137c80a528953645ab11f31e6b7">AVDRMFrameDescriptor::objects</a></div><div class="ttdeci">AVDRMObjectDescriptor objects[AV_DRM_MAX_PLANES]</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__drm_8h_source.html#l00141">hwcontext_drm.h:141</a></div></div>
<div class="ttc" id="ahwcontext__vaapi_8c_html_a24ec8d0632aa8b38111c56afbdc4f188"><div class="ttname"><a href="hwcontext__vaapi_8c.html#a24ec8d0632aa8b38111c56afbdc4f188">vaapi_buffer_free</a></div><div class="ttdeci">static void vaapi_buffer_free(void *opaque, uint8_t *data)</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vaapi_8c_source.html#l00451">hwcontext_vaapi.c:451</a></div></div>
<div class="ttc" id="afilter__design_8txt_html_a0e82f1088fdc24c14bf175d2ac77523f"><div class="ttname"><a href="filter__design_8txt.html#a0e82f1088fdc24c14bf175d2ac77523f">if</a></div><div class="ttdeci">if(ret)</div><div class="ttdef"><b>Definition:</b> <a href="filter__design_8txt_source.html#l00179">filter_design.txt:179</a></div></div>
<div class="ttc" id="awriting__filters_8txt_html_a5b5446e1f47af0c85ac6b45210d45117"><div class="ttname"><a href="writing__filters_8txt.html#a5b5446e1f47af0c85ac6b45210d45117">context</a></div><div class="ttdeci">it s the only field you need to keep assuming you have a context There is some magic you don t need to care about around this just let it vf default minimum maximum flags name is the option keep it simple and lowercase description are in without and describe what they for example set the foo of the bar offset is the offset of the field in your context</div><div class="ttdef"><b>Definition:</b> <a href="writing__filters_8txt_source.html#l00091">writing_filters.txt:91</a></div></div>
<div class="ttc" id="atests_2movenc_8c_html_af540b728145b614e34c4e10930354b93"><div class="ttname"><a href="tests_2movenc_8c.html#af540b728145b614e34c4e10930354b93">opts</a></div><div class="ttdeci">AVDictionary * opts</div><div class="ttdef"><b>Definition:</b> <a href="tests_2movenc_8c_source.html#l00050">movenc.c:50</a></div></div>
<div class="ttc" id="acoverity_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="coverity_8c_source.html#l00032">coverity.c:32</a></div></div>
<div class="ttc" id="ahwcontext__vaapi_8c_html_adef9d2d364c6fe21c47ada497bf8bc9c"><div class="ttname"><a href="hwcontext__vaapi_8c.html#adef9d2d364c6fe21c47ada497bf8bc9c">vaapi_device_init</a></div><div class="ttdeci">static int vaapi_device_init(AVHWDeviceContext *hwdev)</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vaapi_8c_source.html#l00354">hwcontext_vaapi.c:354</a></div></div>
<div class="ttc" id="agroup__lavu__frame_html_gab9b275b114ace0db95c5796bc71f3012"><div class="ttname"><a href="group__lavu__frame.html#gab9b275b114ace0db95c5796bc71f3012">av_frame_copy_props</a></div><div class="ttdeci">int av_frame_copy_props(AVFrame *dst, const AVFrame *src)</div><div class="ttdef"><b>Definition:</b> <a href="frame_8c_source.html#l00658">frame.c:658</a></div></div>
<div class="ttc" id="agroup__lavu__buffer_html_ga135e9e929b5033bb8f68322497b2effc"><div class="ttname"><a href="group__lavu__buffer.html#ga135e9e929b5033bb8f68322497b2effc">av_buffer_unref</a></div><div class="ttdeci">void av_buffer_unref(AVBufferRef **buf)</div><div class="ttdef"><b>Definition:</b> <a href="buffer_8c_source.html#l00125">buffer.c:125</a></div></div>
<div class="ttc" id="agroup__avoptions_html_gga06fc87d81c62e9abb8790b6e5713c55bab116fee0b3c46f1a654355de96249231"><div class="ttname"><a href="group__avoptions.html#gga06fc87d81c62e9abb8790b6e5713c55bab116fee0b3c46f1a654355de96249231">AV_VAAPI_DRIVER_QUIRK_USER_SET</a></div><div class="ttdeci">@ AV_VAAPI_DRIVER_QUIRK_USER_SET</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vaapi_8h_source.html#l00041">hwcontext_vaapi.h:41</a></div></div>
<div class="ttc" id="astruct_a_v_h_w_frames_context_html"><div class="ttname"><a href="struct_a_v_h_w_frames_context.html">AVHWFramesContext</a></div><div class="ttdef"><b>Definition:</b> <a href="hwcontext_8h_source.html#l00124">hwcontext.h:124</a></div></div>
<div class="ttc" id="aavdct_8c_html_af40a326b23c68a27cebe60f16634a2cb"><div class="ttname"><a href="avdct_8c.html#af40a326b23c68a27cebe60f16634a2cb">V</a></div><div class="ttdeci">#define V</div><div class="ttdef"><b>Definition:</b> <a href="avdct_8c_source.html#l00030">avdct.c:30</a></div></div>
<div class="ttc" id="atests_2checkasm_2vp8dsp_8c_html_a858376c0918f93e656c8c0d76c63dbe8"><div class="ttname"><a href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a></div><div class="ttdeci">#define src</div><div class="ttdef"><b>Definition:</b> <a href="tests_2checkasm_2vp8dsp_8c_source.html#l00254">vp8dsp.c:254</a></div></div>
<div class="ttc" id="astruct_a_v_d_r_m_plane_descriptor_html_aa4eaa5a37f40dd7301ce1b8194eefc0a"><div class="ttname"><a href="struct_a_v_d_r_m_plane_descriptor.html#aa4eaa5a37f40dd7301ce1b8194eefc0a">AVDRMPlaneDescriptor::pitch</a></div><div class="ttdeci">ptrdiff_t pitch</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__drm_8h_source.html#l00087">hwcontext_drm.h:87</a></div></div>
<div class="ttc" id="anamespaceconvert__header_html_ac8d67a61fdde2fcdd4358f78109f4b7a"><div class="ttname"><a href="namespaceconvert__header.html#ac8d67a61fdde2fcdd4358f78109f4b7a">convert_header.major</a></div><div class="ttdeci">int major</div><div class="ttdef"><b>Definition:</b> <a href="convert__header_8py_source.html#l00023">convert_header.py:23</a></div></div>
<div class="ttc" id="astruct_a_v_h_w_frames_internal_html_a503cfeb391ed69856344768fd641a489"><div class="ttname"><a href="struct_a_v_h_w_frames_internal.html#a503cfeb391ed69856344768fd641a489">AVHWFramesInternal::priv</a></div><div class="ttdeci">void * priv</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__internal_8h_source.html#l00116">hwcontext_internal.h:116</a></div></div>
<div class="ttc" id="astruct_a_v_frame_html_a3f89733f429c98ba5bc64373fb0a3f13"><div class="ttname"><a href="struct_a_v_frame.html#a3f89733f429c98ba5bc64373fb0a3f13">AVFrame::height</a></div><div class="ttdeci">int height</div><div class="ttdef"><b>Definition:</b> <a href="frame_8h_source.html#l00366">frame.h:366</a></div></div>
<div class="ttc" id="astruct_v_a_a_p_i_format_html_a67bb465b3048926828168aaa91cc3f21"><div class="ttname"><a href="struct_v_a_a_p_i_format.html#a67bb465b3048926828168aaa91cc3f21">VAAPIFormat::chroma_planes_swapped</a></div><div class="ttdeci">int chroma_planes_swapped</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vaapi_8c_source.html#l00095">hwcontext_vaapi.c:95</a></div></div>
<div class="ttc" id="astruct_a_v_h_w_frames_constraints_html"><div class="ttname"><a href="struct_a_v_h_w_frames_constraints.html">AVHWFramesConstraints</a></div><div class="ttdef"><b>Definition:</b> <a href="hwcontext_8h_source.html#l00453">hwcontext.h:453</a></div></div>
<div class="ttc" id="astruct_v_a_a_p_i_frames_context_html_a9110b00b4870e9650dea4ee1d6281b2d"><div class="ttname"><a href="struct_v_a_a_p_i_frames_context.html#a9110b00b4870e9650dea4ee1d6281b2d">VAAPIFramesContext::rt_format</a></div><div class="ttdeci">unsigned int rt_format</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vaapi_8c_source.html#l00079">hwcontext_vaapi.c:79</a></div></div>
<div class="ttc" id="ahwcontext__vaapi_8c_html_a051c6a28933259bd6ede158e606521fc"><div class="ttname"><a href="hwcontext__vaapi_8c.html#a051c6a28933259bd6ede158e606521fc">vaapi_transfer_data_from</a></div><div class="ttdeci">static int vaapi_transfer_data_from(AVHWFramesContext *hwfc, AVFrame *dst, const AVFrame *src)</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vaapi_8c_source.html#l00894">hwcontext_vaapi.c:894</a></div></div>
<div class="ttc" id="agroup__lavu__mem__funcs_html_gaf143ecab33a3868b57345466c39de7c1"><div class="ttname"><a href="group__lavu__mem__funcs.html#gaf143ecab33a3868b57345466c39de7c1">av_mallocz</a></div><div class="ttdeci">void * av_mallocz(size_t size)</div><div class="ttdef"><b>Definition:</b> <a href="mem_8c_source.html#l00237">mem.c:237</a></div></div>
<div class="ttc" id="astruct_a_v_v_a_a_p_i_frames_context_html_a9fab5adf94cbd6eeee14480f603d3d51"><div class="ttname"><a href="struct_a_v_v_a_a_p_i_frames_context.html#a9fab5adf94cbd6eeee14480f603d3d51">AVVAAPIFramesContext::attributes</a></div><div class="ttdeci">VASurfaceAttrib * attributes</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vaapi_8h_source.html#l00093">hwcontext_vaapi.h:93</a></div></div>
<div class="ttc" id="ahwcontext__vaapi_8c_html_a173122e20006f4664e23d28ea3c991c5"><div class="ttname"><a href="hwcontext__vaapi_8c.html#a173122e20006f4664e23d28ea3c991c5">vaapi_device_create</a></div><div class="ttdeci">static int vaapi_device_create(AVHWDeviceContext *ctx, const char *device, AVDictionary *opts, int flags)</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vaapi_8c_source.html#l01494">hwcontext_vaapi.c:1494</a></div></div>
<div class="ttc" id="astruct_a_v_h_w_frames_context_html_a54e38c3e4355321e23e0f4c7411cb8ee"><div class="ttname"><a href="struct_a_v_h_w_frames_context.html#a54e38c3e4355321e23e0f4c7411cb8ee">AVHWFramesContext::hwctx</a></div><div class="ttdeci">void * hwctx</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext_8h_source.html#l00162">hwcontext.h:162</a></div></div>
<div class="ttc" id="astruct_a_v_v_a_a_p_i_device_context_html"><div class="ttname"><a href="struct_a_v_v_a_a_p_i_device_context.html">AVVAAPIDeviceContext</a></div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vaapi_8h_source.html#l00068">hwcontext_vaapi.h:68</a></div></div>
<div class="ttc" id="astruct_a_v_v_a_a_p_i_frames_context_html_a18c4ca9956227c498679a823e14e1375"><div class="ttname"><a href="struct_a_v_v_a_a_p_i_frames_context.html#a18c4ca9956227c498679a823e14e1375">AVVAAPIFramesContext::surface_ids</a></div><div class="ttdeci">VASurfaceID * surface_ids</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vaapi_8h_source.html#l00101">hwcontext_vaapi.h:101</a></div></div>
<div class="ttc" id="ampegaudioenc__template_8c_html_a2748566f4c443ee77aa831e63dbb5ebe"><div class="ttname"><a href="mpegaudioenc__template_8c.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a></div><div class="ttdeci">#define P</div></div>
<div class="ttc" id="agroup__lavu__frame_html_gaec4e92f6e1e75ffaf76e07586fb0c9ed"><div class="ttname"><a href="group__lavu__frame.html#gaec4e92f6e1e75ffaf76e07586fb0c9ed">av_frame_copy</a></div><div class="ttdeci">int av_frame_copy(AVFrame *dst, const AVFrame *src)</div><div class="ttdef"><b>Definition:</b> <a href="frame_8c_source.html#l00799">frame.c:799</a></div></div>
<div class="ttc" id="astruct_a_v_d_r_m_layer_descriptor_html_aa71ce914f53563be8207d8bc08fbfe92"><div class="ttname"><a href="struct_a_v_d_r_m_layer_descriptor.html#aa71ce914f53563be8207d8bc08fbfe92">AVDRMLayerDescriptor::nb_planes</a></div><div class="ttdeci">int nb_planes</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__drm_8h_source.html#l00106">hwcontext_drm.h:106</a></div></div>
<div class="ttc" id="astruct_v_a_a_p_i_device_context_html"><div class="ttname"><a href="struct_v_a_a_p_i_device_context.html">VAAPIDeviceContext</a></div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vaapi_8c_source.html#l00068">hwcontext_vaapi.c:68</a></div></div>
<div class="ttc" id="ahwcontext__vaapi_8c_html_a597b2271503f0d001a42f6ed4523223a"><div class="ttname"><a href="hwcontext__vaapi_8c.html#a597b2271503f0d001a42f6ed4523223a">vaapi_pix_fmt_from_fourcc</a></div><div class="ttdeci">static enum AVPixelFormat vaapi_pix_fmt_from_fourcc(unsigned int fourcc)</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vaapi_8c_source.html#l00156">hwcontext_vaapi.c:165</a></div></div>
<div class="ttc" id="agroup__avoptions_html_gga06fc87d81c62e9abb8790b6e5713c55ba225e072f2eba3d53c29d0b5f197d49ed"><div class="ttname"><a href="group__avoptions.html#gga06fc87d81c62e9abb8790b6e5713c55ba225e072f2eba3d53c29d0b5f197d49ed">AV_VAAPI_DRIVER_QUIRK_RENDER_PARAM_BUFFERS</a></div><div class="ttdeci">@ AV_VAAPI_DRIVER_QUIRK_RENDER_PARAM_BUFFERS</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vaapi_8h_source.html#l00047">hwcontext_vaapi.h:47</a></div></div>
<div class="ttc" id="ahwcontext__vaapi_8c_html_a94f3e1762f66fcbf7c5d77b30a419e5d"><div class="ttname"><a href="hwcontext__vaapi_8c.html#a94f3e1762f66fcbf7c5d77b30a419e5d">vaapi_unmap_frame</a></div><div class="ttdeci">static void vaapi_unmap_frame(AVHWFramesContext *hwfc, HWMapDescriptor *hwmap)</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vaapi_8c_source.html#l00722">hwcontext_vaapi.c:722</a></div></div>
<div class="ttc" id="astruct_a_v_buffer_ref_html"><div class="ttname"><a href="struct_a_v_buffer_ref.html">AVBufferRef</a></div><div class="ttdef"><b>Definition:</b> <a href="buffer_8h_source.html#l00081">buffer.h:81</a></div></div>
<div class="ttc" id="astruct_a_v_d_r_m_object_descriptor_html_a4eeb1aad28f187c3c3e4f9d547a55a3d"><div class="ttname"><a href="struct_a_v_d_r_m_object_descriptor.html#a4eeb1aad28f187c3c3e4f9d547a55a3d">AVDRMObjectDescriptor::size</a></div><div class="ttdeci">size_t size</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__drm_8h_source.html#l00058">hwcontext_drm.h:58</a></div></div>
<div class="ttc" id="abuffer_8h_html"><div class="ttname"><a href="buffer_8h.html">buffer.h</a></div></div>
<div class="ttc" id="astruct_h_w_context_type_html_a5ddb5fc39d16ce3147a5640c8d040937"><div class="ttname"><a href="struct_h_w_context_type.html#a5ddb5fc39d16ce3147a5640c8d040937">HWContextType::type</a></div><div class="ttdeci">enum AVHWDeviceType type</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__internal_8h_source.html#l00176">hwcontext_internal.h:30</a></div></div>
<div class="ttc" id="ahwcontext__vaapi_8c_html_af4f3a4e175def195bea03a54bd3e7205"><div class="ttname"><a href="hwcontext__vaapi_8c.html#af4f3a4e175def195bea03a54bd3e7205">friendly_name</a></div><div class="ttdeci">const char * friendly_name</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vaapi_8c_source.html#l00330">hwcontext_vaapi.c:330</a></div></div>
<div class="ttc" id="apixlet_8c_html_abec92cc72a096640b821b8cd56a02495"><div class="ttname"><a href="pixlet_8c.html#abec92cc72a096640b821b8cd56a02495">H</a></div><div class="ttdeci">#define H</div><div class="ttdef"><b>Definition:</b> <a href="pixlet_8c_source.html#l00039">pixlet.c:39</a></div></div>
<div class="ttc" id="astruct_a_v_d_r_m_layer_descriptor_html_abe9b4585e3ad357cf058dada850c3226"><div class="ttname"><a href="struct_a_v_d_r_m_layer_descriptor.html#abe9b4585e3ad357cf058dada850c3226">AVDRMLayerDescriptor::format</a></div><div class="ttdeci">uint32_t format</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__drm_8h_source.html#l00100">hwcontext_drm.h:100</a></div></div>
<div class="ttc" id="agroup__lavu__error_html_ga9c520e483ba8648495620ffdb4c491f2"><div class="ttname"><a href="group__lavu__error.html#ga9c520e483ba8648495620ffdb4c491f2">AVERROR_EXTERNAL</a></div><div class="ttdeci">#define AVERROR_EXTERNAL</div><div class="ttdoc">Generic error in an external library.</div><div class="ttdef"><b>Definition:</b> <a href="error_8h_source.html#l00057">error.h:57</a></div></div>
<div class="ttc" id="astruct_a_v_frame_html_aa52bfc6605f6a3059a0c3226cc0f6567"><div class="ttname"><a href="struct_a_v_frame.html#aa52bfc6605f6a3059a0c3226cc0f6567">AVFrame::linesize</a></div><div class="ttdeci">int linesize[AV_NUM_DATA_POINTERS]</div><div class="ttdef"><b>Definition:</b> <a href="frame_8h_source.html#l00339">frame.h:339</a></div></div>
<div class="ttc" id="astruct_v_a_a_p_i_frames_context_html_a6e84375c33ec71046d088f62432484d4"><div class="ttname"><a href="struct_v_a_a_p_i_frames_context.html#a6e84375c33ec71046d088f62432484d4">VAAPIFramesContext::derive_works</a></div><div class="ttdeci">int derive_works</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vaapi_8c_source.html#l00081">hwcontext_vaapi.c:81</a></div></div>
<div class="ttc" id="astruct_a_v_frame_html_a1e71ce60cedd5f3b6811714a9f7f9e0a"><div class="ttname"><a href="struct_a_v_frame.html#a1e71ce60cedd5f3b6811714a9f7f9e0a">AVFrame::width</a></div><div class="ttdeci">int width</div><div class="ttdef"><b>Definition:</b> <a href="frame_8h_source.html#l00366">frame.h:366</a></div></div>
<div class="ttc" id="apixfmt_8h_html_a9a8e335cf3be472042bc9f0cf80cd4c5abb09cadf3b2d6b5ce5980401bcf638a8"><div class="ttname"><a href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5abb09cadf3b2d6b5ce5980401bcf638a8">AV_PIX_FMT_VAAPI</a></div><div class="ttdeci">@ AV_PIX_FMT_VAAPI</div><div class="ttdef"><b>Definition:</b> <a href="pixfmt_8h_source.html#l00122">pixfmt.h:122</a></div></div>
<div class="ttc" id="astruct_a_v_d_r_m_frame_descriptor_html_a228800d9ce195e776833e58ee307a6ec"><div class="ttname"><a href="struct_a_v_d_r_m_frame_descriptor.html#a228800d9ce195e776833e58ee307a6ec">AVDRMFrameDescriptor::nb_layers</a></div><div class="ttdeci">int nb_layers</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__drm_8h_source.html#l00145">hwcontext_drm.h:145</a></div></div>
<div class="ttc" id="astruct_v_a_a_p_i_mapping_html_ae51ceb9457d4249dc318a405473fdc98"><div class="ttname"><a href="struct_v_a_a_p_i_mapping.html#ae51ceb9457d4249dc318a405473fdc98">VAAPIMapping::flags</a></div><div class="ttdeci">int flags</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vaapi_8c_source.html#l00088">hwcontext_vaapi.c:88</a></div></div>
<div class="ttc" id="ahwcontext__vaapi_8c_html_a798b1d4dd7f51b5feb850407bffa4191"><div class="ttname"><a href="hwcontext__vaapi_8c.html#a798b1d4dd7f51b5feb850407bffa4191">VAAPIFramesContext</a></div><div class="ttdeci">struct VAAPIFramesContext VAAPIFramesContext</div></div>
<div class="ttc" id="ahwcontext_8h_html_acf25724be4b066a51ad86aa9214b0d34af5dfa6181a3a6efb0f4a0c5f38d76b95"><div class="ttname"><a href="hwcontext_8h.html#acf25724be4b066a51ad86aa9214b0d34af5dfa6181a3a6efb0f4a0c5f38d76b95">AV_HWDEVICE_TYPE_VAAPI</a></div><div class="ttdeci">@ AV_HWDEVICE_TYPE_VAAPI</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext_8h_source.html#l00031">hwcontext.h:31</a></div></div>
<div class="ttc" id="astruct_v_a_a_p_i_surface_format_html_a7c3c72000f8dfcb6bff982554b4b72d3"><div class="ttname"><a href="struct_v_a_a_p_i_surface_format.html#a7c3c72000f8dfcb6bff982554b4b72d3">VAAPISurfaceFormat::image_format</a></div><div class="ttdeci">VAImageFormat image_format</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vaapi_8c_source.html#l00065">hwcontext_vaapi.c:65</a></div></div>
<div class="ttc" id="anamespaceconvert__header_html_afbbd9db93850ca44e2f56ebb00ce0e0c"><div class="ttname"><a href="namespaceconvert__header.html#afbbd9db93850ca44e2f56ebb00ce0e0c">convert_header.minor</a></div><div class="ttdeci">int minor</div><div class="ttdef"><b>Definition:</b> <a href="convert__header_8py_source.html#l00026">convert_header.py:26</a></div></div>
<div class="ttc" id="ahwcontext__drm_8h_html_a2e48b6eecd6df129aad4622bce819c88"><div class="ttname"><a href="hwcontext__drm_8h.html#a2e48b6eecd6df129aad4622bce819c88">AVDRMObjectDescriptor</a></div><div class="ttdeci">struct AVDRMObjectDescriptor AVDRMObjectDescriptor</div></div>
<div class="ttc" id="ahwcontext__vaapi_8c_html_a4936608c613e9564d7ebae64b240915f"><div class="ttname"><a href="hwcontext__vaapi_8c.html#a4936608c613e9564d7ebae64b240915f">vaapi_frames_get_constraints</a></div><div class="ttdeci">static int vaapi_frames_get_constraints(AVHWDeviceContext *hwdev, const void *hwconfig, AVHWFramesConstraints *constraints)</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vaapi_8c_source.html#l00192">hwcontext_vaapi.c:192</a></div></div>
<div class="ttc" id="astruct_a_v_v_a_a_p_i_h_w_config_html_a0ecea446600eeb1b7e93733317adbc98"><div class="ttname"><a href="struct_a_v_v_a_a_p_i_h_w_config.html#a0ecea446600eeb1b7e93733317adbc98">AVVAAPIHWConfig::config_id</a></div><div class="ttdeci">VAConfigID config_id</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vaapi_8h_source.html#l00114">hwcontext_vaapi.h:114</a></div></div>
<div class="ttc" id="astruct_a_v_v_a_a_p_i_frames_context_html_a50ddcf6888143c36c49f82db1c46cec9"><div class="ttname"><a href="struct_a_v_v_a_a_p_i_frames_context.html#a50ddcf6888143c36c49f82db1c46cec9">AVVAAPIFramesContext::nb_attributes</a></div><div class="ttdeci">int nb_attributes</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vaapi_8h_source.html#l00094">hwcontext_vaapi.h:94</a></div></div>
<div class="ttc" id="ainput_8c_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="input_8c.html#acb559820d9ca11295b4500f179ef6392">i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="input_8c_source.html#l00407">input.c:407</a></div></div>
<div class="ttc" id="astruct_a_v_d_r_m_object_descriptor_html_ab193fb14460d5a5f90578a80608e82ae"><div class="ttname"><a href="struct_a_v_d_r_m_object_descriptor.html#ab193fb14460d5a5f90578a80608e82ae">AVDRMObjectDescriptor::format_modifier</a></div><div class="ttdeci">uint64_t format_modifier</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__drm_8h_source.html#l00065">hwcontext_drm.h:65</a></div></div>
<div class="ttc" id="astruct_a_v_h_w_device_context_html_a9c3758c73b0f29925ccb2f60b5c1a803"><div class="ttname"><a href="struct_a_v_h_w_device_context.html#a9c3758c73b0f29925ccb2f60b5c1a803">AVHWDeviceContext::internal</a></div><div class="ttdeci">AVHWDeviceInternal * internal</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext_8h_source.html#l00071">hwcontext.h:71</a></div></div>
<div class="ttc" id="acommon_8h_html"><div class="ttname"><a href="common_8h.html">common.h</a></div></div>
<div class="ttc" id="astruct_h_w_map_descriptor_html"><div class="ttname"><a href="struct_h_w_map_descriptor.html">HWMapDescriptor</a></div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__internal_8h_source.html#l00132">hwcontext_internal.h:132</a></div></div>
<div class="ttc" id="aaudio__convert_8c_html_ae1affc9ca37cfb624959c866a73f83c2"><div class="ttname"><a href="audio__convert_8c.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a></div><div class="ttdeci">uint8_t</div><div class="ttdef"><b>Definition:</b> <a href="audio__convert_8c_source.html#l00194">audio_convert.c:194</a></div></div>
<div class="ttc" id="ahwcontext__vaapi_8c_html_af0d00b9a2d118b471d8d39a7c05a45f5"><div class="ttname"><a href="hwcontext__vaapi_8c.html#af0d00b9a2d118b471d8d39a7c05a45f5">vaapi_device_uninit</a></div><div class="ttdeci">static void vaapi_device_uninit(AVHWDeviceContext *hwdev)</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vaapi_8c_source.html#l00444">hwcontext_vaapi.c:444</a></div></div>
<div class="ttc" id="ahwcontext__drm_8h_html"><div class="ttname"><a href="hwcontext__drm_8h.html">hwcontext_drm.h</a></div></div>
<div class="ttc" id="agroup__lavu__bufferpool_html_ga615151c8889d5be39d17bce4d8c65117"><div class="ttname"><a href="group__lavu__bufferpool.html#ga615151c8889d5be39d17bce4d8c65117">av_buffer_pool_init2</a></div><div class="ttdeci">AVBufferPool * av_buffer_pool_init2(int size, void *opaque, AVBufferRef *(*alloc)(void *opaque, int size), void(*pool_free)(void *opaque))</div><div class="ttdef"><b>Definition:</b> <a href="buffer_8c_source.html#l00245">buffer.c:245</a></div></div>
<div class="ttc" id="ahwcontext__vaapi_8c_html_ab28ff5528527cb3bda2249941e94aaac"><div class="ttname"><a href="hwcontext__vaapi_8c.html#ab28ff5528527cb3bda2249941e94aaac">vaapi_device_connect</a></div><div class="ttdeci">static int vaapi_device_connect(AVHWDeviceContext *ctx, VADisplay display)</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vaapi_8c_source.html#l01468">hwcontext_vaapi.c:1468</a></div></div>
<div class="ttc" id="astruct_v_a_a_p_i_format_html_aaf873e6e50dabecadbb89c9eb73d55d7"><div class="ttname"><a href="struct_v_a_a_p_i_format.html#aaf873e6e50dabecadbb89c9eb73d55d7">VAAPIFormat::pix_fmt</a></div><div class="ttdeci">enum AVPixelFormat pix_fmt</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vaapi_8c_source.html#l00093">hwcontext_vaapi.c:94</a></div></div>
<div class="ttc" id="agroup__avoptions_html_gga06fc87d81c62e9abb8790b6e5713c55ba9f73eea942c7ed1ad5d56918bffa4ce3"><div class="ttname"><a href="group__avoptions.html#gga06fc87d81c62e9abb8790b6e5713c55ba9f73eea942c7ed1ad5d56918bffa4ce3">AV_HWFRAME_MAP_DIRECT</a></div><div class="ttdeci">@ AV_HWFRAME_MAP_DIRECT</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext_8h_source.html#l00540">hwcontext.h:540</a></div></div>
<div class="ttc" id="ahwcontext_8h_html_aba8d70ed754b2536ca497d7d50ec7b1e"><div class="ttname"><a href="hwcontext_8h.html#aba8d70ed754b2536ca497d7d50ec7b1e">AVHWFrameTransferDirection</a></div><div class="ttdeci">AVHWFrameTransferDirection</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext_8h_source.html#l00415">hwcontext.h:415</a></div></div>
<div class="ttc" id="astruct_a_v_d_r_m_layer_descriptor_html_a7fbaf03f401c451e82021487fefef159"><div class="ttname"><a href="struct_a_v_d_r_m_layer_descriptor.html#a7fbaf03f401c451e82021487fefef159">AVDRMLayerDescriptor::planes</a></div><div class="ttdeci">AVDRMPlaneDescriptor planes[AV_DRM_MAX_PLANES]</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__drm_8h_source.html#l00110">hwcontext_drm.h:110</a></div></div>
<div class="ttc" id="ahwcontext__vaapi_8h_html"><div class="ttname"><a href="hwcontext__vaapi_8h.html">hwcontext_vaapi.h</a></div></div>
<div class="ttc" id="astruct_v_a_a_p_i_format_html_ae9b2bd18e9bd46748422cc9bfe5e8dd6"><div class="ttname"><a href="struct_v_a_a_p_i_format.html#ae9b2bd18e9bd46748422cc9bfe5e8dd6">VAAPIFormat::rt_format</a></div><div class="ttdeci">unsigned int rt_format</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vaapi_8c_source.html#l00093">hwcontext_vaapi.c:93</a></div></div>
<div class="ttc" id="ahwcontext__vaapi_8c_html_abb72e384863d48f0c521dafc06ec0889"><div class="ttname"><a href="hwcontext__vaapi_8c.html#abb72e384863d48f0c521dafc06ec0889">quirks</a></div><div class="ttdeci">unsigned int quirks</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vaapi_8c_source.html#l00332">hwcontext_vaapi.c:332</a></div></div>
<div class="ttc" id="apixfmt_8h_html"><div class="ttname"><a href="pixfmt_8h.html">pixfmt.h</a></div></div>
<div class="ttc" id="afilter__design_8txt_html_a48ad71a5b40cdd5f23c601f33665a953"><div class="ttname"><a href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a></div><div class="ttdeci">these buffered frames must be flushed immediately if a new input produces new the filter must not call request_frame to get more It must just process the frame or queue it The task of requesting more frames is left to the filter s request_frame method or the application If a filter has several the filter must be ready for frames arriving randomly on any input any filter with several inputs will most likely require some kind of queuing mechanism It is perfectly acceptable to have a limited queue and to drop frames when the inputs are too unbalanced request_frame For filters that do not use the this method is called when a frame is wanted on an output For a it should directly call filter_frame on the corresponding output For a if there are queued frames already one of these frames should be pushed If the filter should request a frame on one of its repeatedly until at least one frame has been pushed Return or at least make progress towards producing a frame</div><div class="ttdef"><b>Definition:</b> <a href="filter__design_8txt_source.html#l00264">filter_design.txt:264</a></div></div>
<div class="ttc" id="astruct_a_v_v_a_a_p_i_frames_context_html"><div class="ttname"><a href="struct_a_v_v_a_a_p_i_frames_context.html">AVVAAPIFramesContext</a></div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vaapi_8h_source.html#l00088">hwcontext_vaapi.h:88</a></div></div>
<div class="ttc" id="ahwcontext__vaapi_8c_html_a39a29b36d1b1e01385fb02e389ed4381"><div class="ttname"><a href="hwcontext__vaapi_8c.html#a39a29b36d1b1e01385fb02e389ed4381">VAAPIDevicePriv</a></div><div class="ttdeci">struct VAAPIDevicePriv VAAPIDevicePriv</div></div>
<div class="ttc" id="agroup__lavu__mem__funcs_html_ga34e10fdac079a9ca4512b8ccd7f20b8a"><div class="ttname"><a href="group__lavu__mem__funcs.html#ga34e10fdac079a9ca4512b8ccd7f20b8a">size</a></div><div class="ttdeci">int size</div><div class="ttdef"><b>Definition:</b> <a href="twinvq__data_8h_source.html#l11134">twinvq_data.h:11134</a></div></div>
<div class="ttc" id="ahwcontext__vaapi_8c_html_a5c28d40b7a2a444060f25438fc07bfab"><div class="ttname"><a href="hwcontext__vaapi_8c.html#a5c28d40b7a2a444060f25438fc07bfab">vaapi_device_free</a></div><div class="ttdeci">static void vaapi_device_free(AVHWDeviceContext *ctx)</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vaapi_8c_source.html#l01433">hwcontext_vaapi.c:1433</a></div></div>
<div class="ttc" id="asinewin__tablegen__template_8c_html_a3508a98d3ee7e2c9a4841fe264cf70f7"><div class="ttname"><a href="sinewin__tablegen__template_8c.html#a3508a98d3ee7e2c9a4841fe264cf70f7">FF_ARRAY_ELEMS</a></div><div class="ttdeci">#define FF_ARRAY_ELEMS(a)</div><div class="ttdef"><b>Definition:</b> <a href="sinewin__tablegen__template_8c_source.html#l00038">sinewin_tablegen_template.c:38</a></div></div>
<div class="ttc" id="agroup__avoptions_html_gga06fc87d81c62e9abb8790b6e5713c55baba97590c47b7f525df53596127c7e2ea"><div class="ttname"><a href="group__avoptions.html#gga06fc87d81c62e9abb8790b6e5713c55baba97590c47b7f525df53596127c7e2ea">AV_VAAPI_DRIVER_QUIRK_ATTRIB_MEMTYPE</a></div><div class="ttdeci">@ AV_VAAPI_DRIVER_QUIRK_ATTRIB_MEMTYPE</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vaapi_8h_source.html#l00053">hwcontext_vaapi.h:53</a></div></div>
<div class="ttc" id="astruct_h_w_context_type_html"><div class="ttname"><a href="struct_h_w_context_type.html">HWContextType</a></div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__internal_8h_source.html#l00029">hwcontext_internal.h:29</a></div></div>
<div class="ttc" id="agroup__avoptions_html_gga06fc87d81c62e9abb8790b6e5713c55bab2e22cc927a3d88fe833b50bf3d71948"><div class="ttname"><a href="group__avoptions.html#gga06fc87d81c62e9abb8790b6e5713c55bab2e22cc927a3d88fe833b50bf3d71948">AV_HWFRAME_MAP_WRITE</a></div><div class="ttdeci">@ AV_HWFRAME_MAP_WRITE</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext_8h_source.html#l00528">hwcontext.h:528</a></div></div>
<div class="ttc" id="astruct_a_v_h_w_frames_context_html_ac9a7dbd0cbfcabc0b1529cb34cf53b6d"><div class="ttname"><a href="struct_a_v_h_w_frames_context.html#ac9a7dbd0cbfcabc0b1529cb34cf53b6d">AVHWFramesContext::device_ctx</a></div><div class="ttdeci">AVHWDeviceContext * device_ctx</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext_8h_source.html#l00149">hwcontext.h:149</a></div></div>
<div class="ttc" id="astruct_a_v_frame_html_a1d0f65014a8d1bf78cec8cbed2304992"><div class="ttname"><a href="struct_a_v_frame.html#a1d0f65014a8d1bf78cec8cbed2304992">AVFrame::data</a></div><div class="ttdeci">uint8_t * data[AV_NUM_DATA_POINTERS]</div><div class="ttdef"><b>Definition:</b> <a href="frame_8h_source.html#l00322">frame.h:322</a></div></div>
<div class="ttc" id="astruct_a_v_frame_html_aed14fa772ce46881020fd1545c86432c"><div class="ttname"><a href="struct_a_v_frame.html#aed14fa772ce46881020fd1545c86432c">AVFrame::format</a></div><div class="ttdeci">int format</div><div class="ttdef"><b>Definition:</b> <a href="frame_8h_source.html#l00381">frame.h:381</a></div></div>
<div class="ttc" id="astruct_v_a_a_p_i_format_html_a12690e97b0032df1e1b8420f00c6140d"><div class="ttname"><a href="struct_v_a_a_p_i_format.html#a12690e97b0032df1e1b8420f00c6140d">VAAPIFormat::fourcc</a></div><div class="ttdeci">unsigned int fourcc</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vaapi_8c_source.html#l00092">hwcontext_vaapi.c:92</a></div></div>
<div class="ttc" id="apixfmt_8h_html_a9a8e335cf3be472042bc9f0cf80cd4c5a0e08f8a5d0fa21c3e258816a9dcce7c3"><div class="ttname"><a href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a0e08f8a5d0fa21c3e258816a9dcce7c3">AV_PIX_FMT_NONE</a></div><div class="ttdeci">@ AV_PIX_FMT_NONE</div><div class="ttdef"><b>Definition:</b> <a href="pixfmt_8h_source.html#l00065">pixfmt.h:65</a></div></div>
<div class="ttc" id="ahwcontext__vaapi_8c_html_a6f2f4321538486f44071685acc834d27"><div class="ttname"><a href="hwcontext__vaapi_8c.html#a6f2f4321538486f44071685acc834d27">VAAPISurfaceFormat</a></div><div class="ttdeci">struct VAAPISurfaceFormat VAAPISurfaceFormat</div></div>
<div class="ttc" id="astruct_a_v_h_w_frames_constraints_html_af5d3a683727f7b92abca7b7114d4e15c"><div class="ttname"><a href="struct_a_v_h_w_frames_constraints.html#af5d3a683727f7b92abca7b7114d4e15c">AVHWFramesConstraints::max_height</a></div><div class="ttdeci">int max_height</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext_8h_source.html#l00479">hwcontext.h:479</a></div></div>
<div class="ttc" id="atests_2jpeg2000dwt_8c_html_a5cabdd8be5af41f675fed06498e094b7"><div class="ttname"><a href="tests_2jpeg2000dwt_8c.html#a5cabdd8be5af41f675fed06498e094b7">ref</a></div><div class="ttdeci">static int ref[MAX_W *MAX_W]</div><div class="ttdef"><b>Definition:</b> <a href="tests_2jpeg2000dwt_8c_source.html#l00107">jpeg2000dwt.c:107</a></div></div>
<div class="ttc" id="astruct_v_a_a_p_i_frames_context_html_af40b63e6d6e79a03d1cfff5ade12c7c4"><div class="ttname"><a href="struct_v_a_a_p_i_frames_context.html#af40b63e6d6e79a03d1cfff5ade12c7c4">VAAPIFramesContext::nb_attributes</a></div><div class="ttdeci">int nb_attributes</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vaapi_8c_source.html#l00077">hwcontext_vaapi.c:77</a></div></div>
<div class="ttc" id="alibsvtav1_8c_html_a710bce51374aba96ab04912897666c35"><div class="ttname"><a href="libsvtav1_8c.html#a710bce51374aba96ab04912897666c35">desc</a></div><div class="ttdeci">const char * desc</div><div class="ttdef"><b>Definition:</b> <a href="libsvtav1_8c_source.html#l00079">libsvtav1.c:79</a></div></div>
<div class="ttc" id="astruct_a_v_d_r_m_frame_descriptor_html_a5a11bc1854bb6cee2f5b0f9d514d0c4f"><div class="ttname"><a href="struct_a_v_d_r_m_frame_descriptor.html#a5a11bc1854bb6cee2f5b0f9d514d0c4f">AVDRMFrameDescriptor::nb_objects</a></div><div class="ttdeci">int nb_objects</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__drm_8h_source.html#l00137">hwcontext_drm.h:137</a></div></div>
<div class="ttc" id="amem_8h_html"><div class="ttname"><a href="mem_8h.html">mem.h</a></div></div>
<div class="ttc" id="ahwcontext__internal_8h_html"><div class="ttname"><a href="hwcontext__internal_8h.html">hwcontext_internal.h</a></div></div>
<div class="ttc" id="ahwcontext__vdpau_8c_html_a2996cc16b36e13c9010705bad768e866"><div class="ttname"><a href="hwcontext__vdpau_8c.html#a2996cc16b36e13c9010705bad768e866">map</a></div><div class="ttdeci">const VDPAUPixFmtMap * map</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vdpau_8c_source.html#l00071">hwcontext_vdpau.c:71</a></div></div>
<div class="ttc" id="atableprint__vlc_8h_html_a079eab092887563f2bef9106c6120089"><div class="ttname"><a href="tableprint__vlc_8h.html#a079eab092887563f2bef9106c6120089">av_free</a></div><div class="ttdeci">#define av_free(p)</div><div class="ttdef"><b>Definition:</b> <a href="tableprint__vlc_8h_source.html#l00034">tableprint_vlc.h:34</a></div></div>
<div class="ttc" id="ahwcontext__vaapi_8c_html_a93d9371e12b4d4aaf9b825248b87740d"><div class="ttname"><a href="hwcontext__vaapi_8c.html#a93d9371e12b4d4aaf9b825248b87740d">VAAPIDeviceContext</a></div><div class="ttdeci">struct VAAPIDeviceContext VAAPIDeviceContext</div></div>
<div class="ttc" id="astruct_v_a_a_p_i_mapping_html"><div class="ttname"><a href="struct_v_a_a_p_i_mapping.html">VAAPIMapping</a></div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vaapi_8c_source.html#l00084">hwcontext_vaapi.c:84</a></div></div>
<div class="ttc" id="ahwcontext__vaapi_8c_html_a74a5679566484667a7ec44c2f968be3a"><div class="ttname"><a href="hwcontext__vaapi_8c.html#a74a5679566484667a7ec44c2f968be3a">vaapi_map_from</a></div><div class="ttdeci">static int vaapi_map_from(AVHWFramesContext *hwfc, AVFrame *dst, const AVFrame *src, int flags)</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vaapi_8c_source.html#l01420">hwcontext_vaapi.c:1420</a></div></div>
<div class="ttc" id="astruct_v_a_a_p_i_surface_format_html_ace4d04542428395359cca3d223db93d8"><div class="ttname"><a href="struct_v_a_a_p_i_surface_format.html#ace4d04542428395359cca3d223db93d8">VAAPISurfaceFormat::pix_fmt</a></div><div class="ttdeci">enum AVPixelFormat pix_fmt</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vaapi_8c_source.html#l00060">hwcontext_vaapi.c:64</a></div></div>
<div class="ttc" id="atableprint__vlc_8h_html_adba82e1bcd02de510a858fcbedf79ef1"><div class="ttname"><a href="tableprint__vlc_8h.html#adba82e1bcd02de510a858fcbedf79ef1">av_freep</a></div><div class="ttdeci">#define av_freep(p)</div><div class="ttdef"><b>Definition:</b> <a href="tableprint__vlc_8h_source.html#l00035">tableprint_vlc.h:35</a></div></div>
<div class="ttc" id="astruct_a_v_d_r_m_frame_descriptor_html_ad19d258e1771ef833d7e3bd873b91906"><div class="ttname"><a href="struct_a_v_d_r_m_frame_descriptor.html#ad19d258e1771ef833d7e3bd873b91906">AVDRMFrameDescriptor::layers</a></div><div class="ttdeci">AVDRMLayerDescriptor layers[AV_DRM_MAX_PLANES]</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__drm_8h_source.html#l00149">hwcontext_drm.h:149</a></div></div>
<div class="ttc" id="astruct_a_v_h_w_frames_context_html_ad67ff3a5828a611d1b1cddd64fc1de71"><div class="ttname"><a href="struct_a_v_h_w_frames_context.html#ad67ff3a5828a611d1b1cddd64fc1de71">AVHWFramesContext::pool</a></div><div class="ttdeci">AVBufferPool * pool</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext_8h_source.html#l00190">hwcontext.h:190</a></div></div>
<div class="ttc" id="advbsubdec_8c_html_aba32782053c6a2b01e3706d632d77895"><div class="ttname"><a href="dvbsubdec_8c.html#aba32782053c6a2b01e3706d632d77895">RGBA</a></div><div class="ttdeci">#define RGBA(r, g, b, a)</div><div class="ttdef"><b>Definition:</b> <a href="dvbsubdec_8c_source.html#l00039">dvbsubdec.c:39</a></div></div>
<div class="ttc" id="acbs__av1_8c_html_a67119bce106892b6dade1dc5aa405ac9"><div class="ttname"><a href="cbs__av1_8c.html#a67119bce106892b6dade1dc5aa405ac9">flags</a></div><div class="ttdeci">#define flags(name, subs,...)</div><div class="ttdef"><b>Definition:</b> <a href="cbs__av1_8c_source.html#l00560">cbs_av1.c:560</a></div></div>
<div class="ttc" id="ahwcontext_8h_html"><div class="ttname"><a href="hwcontext_8h.html">hwcontext.h</a></div></div>
<div class="ttc" id="ahwcontext__vaapi_8c_html_ace0f3086d25b9a5ef42e3ef3e9b4e2b2"><div class="ttname"><a href="hwcontext__vaapi_8c.html#ace0f3086d25b9a5ef42e3ef3e9b4e2b2">vaapi_map_to_memory</a></div><div class="ttdeci">static int vaapi_map_to_memory(AVHWFramesContext *hwfc, AVFrame *dst, const AVFrame *src, int flags)</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vaapi_8c_source.html#l00956">hwcontext_vaapi.c:956</a></div></div>
<div class="ttc" id="astruct_a_v_d_r_m_device_context_html_a22790a8cbf5681bbdee76a6bc99f02f5"><div class="ttname"><a href="struct_a_v_d_r_m_device_context.html#a22790a8cbf5681bbdee76a6bc99f02f5">AVDRMDeviceContext::fd</a></div><div class="ttdeci">int fd</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__drm_8h_source.html#l00166">hwcontext_drm.h:166</a></div></div>
<div class="ttc" id="atableprint__vlc_8h_html_af38b91523053c244564a94f1ef862c2c"><div class="ttname"><a href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a></div><div class="ttdeci">#define av_log(a,...)</div><div class="ttdef"><b>Definition:</b> <a href="tableprint__vlc_8h_source.html#l00028">tableprint_vlc.h:28</a></div></div>
<div class="ttc" id="ahwcontext__drm_8h_html_a9efcf7f55bd9676757ff1914af67119b"><div class="ttname"><a href="hwcontext__drm_8h.html#a9efcf7f55bd9676757ff1914af67119b">AVDRMLayerDescriptor</a></div><div class="ttdeci">struct AVDRMLayerDescriptor AVDRMLayerDescriptor</div></div>
<div class="ttc" id="astruct_a_v_h_w_frames_context_html_a663a9aceca97aa7b2426c9aba6543e4a"><div class="ttname"><a href="struct_a_v_h_w_frames_context.html#a663a9aceca97aa7b2426c9aba6543e4a">AVHWFramesContext::sw_format</a></div><div class="ttdeci">enum AVPixelFormat sw_format</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext_8h_source.html#l00199">hwcontext.h:222</a></div></div>
<div class="ttc" id="ahwcontext__vaapi_8c_html_a880e906f04e5137e4a282b0e71ed99a6"><div class="ttname"><a href="hwcontext__vaapi_8c.html#a880e906f04e5137e4a282b0e71ed99a6">vaapi_frames_uninit</a></div><div class="ttdeci">static void vaapi_frames_uninit(AVHWFramesContext *hwfc)</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vaapi_8c_source.html#l00663">hwcontext_vaapi.c:663</a></div></div>
<div class="ttc" id="astruct_a_v_d_r_m_object_descriptor_html_a3732e73e288f10965cae373c70e8402e"><div class="ttname"><a href="struct_a_v_d_r_m_object_descriptor.html#a3732e73e288f10965cae373c70e8402e">AVDRMObjectDescriptor::fd</a></div><div class="ttdeci">int fd</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__drm_8h_source.html#l00052">hwcontext_drm.h:52</a></div></div>
<div class="ttc" id="astruct_a_v_frame_html"><div class="ttname"><a href="struct_a_v_frame.html">AVFrame</a></div><div class="ttdef"><b>Definition:</b> <a href="frame_8h_source.html#l00308">frame.h:308</a></div></div>
<div class="ttc" id="ahwcontext__vaapi_8c_html_aa3b85933ac75a3fbb4cfb98a41956c00"><div class="ttname"><a href="hwcontext__vaapi_8c.html#aa3b85933ac75a3fbb4cfb98a41956c00">VAAPIFormatDescriptor</a></div><div class="ttdeci">struct VAAPIFormat VAAPIFormatDescriptor</div></div>
<div class="ttc" id="avaapi__decode_8c_html_aa5d906425500585aa7832161b2a40e1b"><div class="ttname"><a href="vaapi__decode_8c.html#aa5d906425500585aa7832161b2a40e1b">fourcc</a></div><div class="ttdeci">uint32_t fourcc</div><div class="ttdef"><b>Definition:</b> <a href="vaapi__decode_8c_source.html#l00239">vaapi_decode.c:239</a></div></div>
<div class="ttc" id="asnprintf_8h_html_aa367b75c5aed883fef5befbdf04835a4"><div class="ttname"><a href="snprintf_8h.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a></div><div class="ttdeci">#define snprintf</div><div class="ttdef"><b>Definition:</b> <a href="snprintf_8h_source.html#l00034">snprintf.h:34</a></div></div>
<div class="ttc" id="ahwcontext_8h_html_acf25724be4b066a51ad86aa9214b0d34aa04ac36fb964a5c191566a8e809de743"><div class="ttname"><a href="hwcontext_8h.html#acf25724be4b066a51ad86aa9214b0d34aa04ac36fb964a5c191566a8e809de743">AV_HWDEVICE_TYPE_DRM</a></div><div class="ttdeci">@ AV_HWDEVICE_TYPE_DRM</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext_8h_source.html#l00036">hwcontext.h:36</a></div></div>
<div class="ttc" id="ahwcontext__vaapi_8c_html_a33953f092368e26cc9d72e958ed962b2"><div class="ttname"><a href="hwcontext__vaapi_8c.html#a33953f092368e26cc9d72e958ed962b2">vaapi_format_map</a></div><div class="ttdeci">static const VAAPIFormatDescriptor vaapi_format_map[]</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vaapi_8c_source.html#l00106">hwcontext_vaapi.c:106</a></div></div>
<div class="ttc" id="apixdesc_8c_html_ab92e2a8a9b58c982560c49df9f01e47e"><div class="ttname"><a href="pixdesc_8c.html#ab92e2a8a9b58c982560c49df9f01e47e">av_get_pix_fmt_name</a></div><div class="ttdeci">const char * av_get_pix_fmt_name(enum AVPixelFormat pix_fmt)</div><div class="ttdef"><b>Definition:</b> <a href="pixdesc_8c_source.html#l02489">pixdesc.c:2489</a></div></div>
<div class="ttc" id="ahwcontext__vaapi_8c_html_a6980ef1e936a97ae1dc687fcdef09efc"><div class="ttname"><a href="hwcontext__vaapi_8c.html#a6980ef1e936a97ae1dc687fcdef09efc">MAP</a></div><div class="ttdeci">#define MAP(va, rt, av, swap_uv)</div><div class="ttdef"><b>Definition:</b> <a href="hwcontext__vaapi_8c_source.html#l00098">hwcontext_vaapi.c:98</a></div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.8.20
</small></address>
</body>
</html>
