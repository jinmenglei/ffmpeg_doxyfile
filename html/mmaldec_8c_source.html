<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>My Project: E:/github/ffmpeg/libavcodec/mmaldec.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">My Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_737c44b861ba7ee498141742fb455fa8.html">ffmpeg</a></li><li class="navelem"><a class="el" href="dir_56ad1dd09ca1ce410b5ba2c46dd71e4b.html">libavcodec</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">mmaldec.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="mmaldec_8c.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> * MMAL Video Decoder</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> * Copyright (c) 2015 Rodger Combs</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> * This file is part of FFmpeg.</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> * FFmpeg is free software; you can redistribute it and/or</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> * modify it under the terms of the GNU Lesser General Public</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> * License as published by the Free Software Foundation; either</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> * version 2.1 of the License, or (at your option) any later version.</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> * FFmpeg is distributed in the hope that it will be useful,</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"> * Lesser General Public License for more details.</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"> * You should have received a copy of the GNU Lesser General Public</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"> * License along with FFmpeg; if not, write to the Free Software</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment"> * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160; </div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &lt;bcm_host.h&gt;</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#include &lt;interface/mmal/mmal.h&gt;</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#include &lt;interface/mmal/mmal_parameters_video.h&gt;</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#include &lt;interface/mmal/util/mmal_util.h&gt;</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor">#include &lt;interface/mmal/util/mmal_util_params.h&gt;</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#include &lt;interface/mmal/util/mmal_default_components.h&gt;</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor">#include &lt;interface/mmal/vc/mmal_vc_api.h&gt;</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="preprocessor">#include &lt;stdatomic.h&gt;</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160; </div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="avcodec_8h.html">avcodec.h</a>&quot;</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="decode_8h.html">decode.h</a>&quot;</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="hwconfig_8h.html">hwconfig.h</a>&quot;</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="libavutil_2internal_8h.html">internal.h</a>&quot;</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="avassert_8h.html">libavutil/avassert.h</a>&quot;</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="buffer_8h.html">libavutil/buffer.h</a>&quot;</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="common_8h.html">libavutil/common.h</a>&quot;</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="imgutils_8h.html">libavutil/imgutils.h</a>&quot;</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="opt_8h.html">libavutil/opt.h</a>&quot;</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="log_8h.html">libavutil/log.h</a>&quot;</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160; </div>
<div class="line"><a name="l00047"></a><span class="lineno"><a class="line" href="struct_f_f_buffer_entry.html">   47</a></span>&#160;<span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="struct_f_f_buffer_entry.html">FFBufferEntry</a> {</div>
<div class="line"><a name="l00048"></a><span class="lineno"><a class="line" href="struct_f_f_buffer_entry.html#a134f8dd2b4d6c936215b14fbb2b5e718">   48</a></span>&#160;    <a class="code" href="struct_a_v_buffer_ref.html">AVBufferRef</a> *<a class="code" href="struct_f_f_buffer_entry.html#a134f8dd2b4d6c936215b14fbb2b5e718">ref</a>;</div>
<div class="line"><a name="l00049"></a><span class="lineno"><a class="line" href="struct_f_f_buffer_entry.html#ab378752e33bdbd09f49b666cff37a1b6">   49</a></span>&#160;    <span class="keywordtype">void</span> *<a class="code" href="struct_f_f_buffer_entry.html#ab378752e33bdbd09f49b666cff37a1b6">data</a>;</div>
<div class="line"><a name="l00050"></a><span class="lineno"><a class="line" href="struct_f_f_buffer_entry.html#a03608ef128dbe082de5e01bd6e4401f1">   50</a></span>&#160;    <span class="keywordtype">size_t</span> <a class="code" href="struct_f_f_buffer_entry.html#a03608ef128dbe082de5e01bd6e4401f1">length</a>;</div>
<div class="line"><a name="l00051"></a><span class="lineno"><a class="line" href="struct_f_f_buffer_entry.html#a1cdad952247660ea6a2e5928c61a3b40">   51</a></span>&#160;    int64_t <a class="code" href="struct_f_f_buffer_entry.html#a1cdad952247660ea6a2e5928c61a3b40">pts</a>, <a class="code" href="struct_f_f_buffer_entry.html#ae872ff66179bb8f7b4d7f7ee503f4437">dts</a>;</div>
<div class="line"><a name="l00052"></a><span class="lineno"><a class="line" href="struct_f_f_buffer_entry.html#a9cec0ae60855480857b91d6301341831">   52</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="struct_f_f_buffer_entry.html#a9cec0ae60855480857b91d6301341831">flags</a>;</div>
<div class="line"><a name="l00053"></a><span class="lineno"><a class="line" href="struct_f_f_buffer_entry.html#a64c957d2df291fe1ae865ef854869e65">   53</a></span>&#160;    <span class="keyword">struct </span><a class="code" href="struct_f_f_buffer_entry.html">FFBufferEntry</a> *<a class="code" href="struct_f_f_buffer_entry.html#a64c957d2df291fe1ae865ef854869e65">next</a>;</div>
<div class="line"><a name="l00054"></a><span class="lineno"><a class="line" href="mmaldec_8c.html#ad37ff952feaf13ca3b3934f2344dbbf1">   54</a></span>&#160;} <a class="code" href="mmaldec_8c.html#ad37ff952feaf13ca3b3934f2344dbbf1">FFBufferEntry</a>;</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160; </div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="comment">// MMAL_POOL_T destroys all of its MMAL_BUFFER_HEADER_Ts. If we want correct</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="comment">// refcounting for AVFrames, we can free the MMAL_POOL_T only after all AVFrames</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="comment">// have been unreferenced.</span></div>
<div class="line"><a name="l00059"></a><span class="lineno"><a class="line" href="struct_f_f_pool_ref.html">   59</a></span>&#160;<span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="struct_f_f_pool_ref.html">FFPoolRef</a> {</div>
<div class="line"><a name="l00060"></a><span class="lineno"><a class="line" href="struct_f_f_pool_ref.html#af0ffa9b8690521917796dd8fa06951a1">   60</a></span>&#160;    <a class="code" href="dummy_2stdatomic_8h.html#a60b2151806275a115118e9981cc096b2">atomic_int</a> <a class="code" href="struct_f_f_pool_ref.html#af0ffa9b8690521917796dd8fa06951a1">refcount</a>;</div>
<div class="line"><a name="l00061"></a><span class="lineno"><a class="line" href="struct_f_f_pool_ref.html#ae4b6acbef67753da836c260a12392916">   61</a></span>&#160;    MMAL_POOL_T *<a class="code" href="struct_f_f_pool_ref.html#ae4b6acbef67753da836c260a12392916">pool</a>;</div>
<div class="line"><a name="l00062"></a><span class="lineno"><a class="line" href="mmaldec_8c.html#a5154886f12c05be4f70583019e966f9d">   62</a></span>&#160;} <a class="code" href="mmaldec_8c.html#a5154886f12c05be4f70583019e966f9d">FFPoolRef</a>;</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160; </div>
<div class="line"><a name="l00064"></a><span class="lineno"><a class="line" href="struct_f_f_buffer_ref.html">   64</a></span>&#160;<span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="struct_f_f_buffer_ref.html">FFBufferRef</a> {</div>
<div class="line"><a name="l00065"></a><span class="lineno"><a class="line" href="struct_f_f_buffer_ref.html#aee321326fa58b803490ba2c84fb81cd3">   65</a></span>&#160;    MMAL_BUFFER_HEADER_T *<a class="code" href="struct_f_f_buffer_ref.html#aee321326fa58b803490ba2c84fb81cd3">buffer</a>;</div>
<div class="line"><a name="l00066"></a><span class="lineno"><a class="line" href="struct_f_f_buffer_ref.html#aeceac7a2102082eee615a9230953145a">   66</a></span>&#160;    <a class="code" href="struct_f_f_pool_ref.html">FFPoolRef</a> *<a class="code" href="struct_f_f_buffer_ref.html#aeceac7a2102082eee615a9230953145a">pool</a>;</div>
<div class="line"><a name="l00067"></a><span class="lineno"><a class="line" href="mmaldec_8c.html#a84e8ba543e365ddc575b7b0f8d7d6a2d">   67</a></span>&#160;} <a class="code" href="mmaldec_8c.html#a84e8ba543e365ddc575b7b0f8d7d6a2d">FFBufferRef</a>;</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160; </div>
<div class="line"><a name="l00069"></a><span class="lineno"><a class="line" href="struct_m_m_a_l_decode_context.html">   69</a></span>&#160;<span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="struct_m_m_a_l_decode_context.html">MMALDecodeContext</a> {</div>
<div class="line"><a name="l00070"></a><span class="lineno"><a class="line" href="struct_m_m_a_l_decode_context.html#a0b53ce8dcf48bdd5facc140f8ef74f27">   70</a></span>&#160;    <a class="code" href="struct_a_v_class.html">AVClass</a> *<a class="code" href="struct_m_m_a_l_decode_context.html#a0b53ce8dcf48bdd5facc140f8ef74f27">av_class</a>;</div>
<div class="line"><a name="l00071"></a><span class="lineno"><a class="line" href="struct_m_m_a_l_decode_context.html#aa54fe3cc1bd57747087d91b85b408641">   71</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="struct_m_m_a_l_decode_context.html#aa54fe3cc1bd57747087d91b85b408641">extra_buffers</a>;</div>
<div class="line"><a name="l00072"></a><span class="lineno"><a class="line" href="struct_m_m_a_l_decode_context.html#affea6d69cea942a63f2feee3da14e93a">   72</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="struct_m_m_a_l_decode_context.html#affea6d69cea942a63f2feee3da14e93a">extra_decoder_buffers</a>;</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160; </div>
<div class="line"><a name="l00074"></a><span class="lineno"><a class="line" href="struct_m_m_a_l_decode_context.html#adf7a14379faf64c444eead617fb11d92">   74</a></span>&#160;    MMAL_COMPONENT_T *<a class="code" href="struct_m_m_a_l_decode_context.html#adf7a14379faf64c444eead617fb11d92">decoder</a>;</div>
<div class="line"><a name="l00075"></a><span class="lineno"><a class="line" href="struct_m_m_a_l_decode_context.html#a2bad9ecc641864d38ce1bcc57be3c5af">   75</a></span>&#160;    MMAL_QUEUE_T *<a class="code" href="struct_m_m_a_l_decode_context.html#a2bad9ecc641864d38ce1bcc57be3c5af">queue_decoded_frames</a>;</div>
<div class="line"><a name="l00076"></a><span class="lineno"><a class="line" href="struct_m_m_a_l_decode_context.html#a1a2ca7b4528654ea7da40f26185965ce">   76</a></span>&#160;    MMAL_POOL_T *<a class="code" href="struct_m_m_a_l_decode_context.html#a1a2ca7b4528654ea7da40f26185965ce">pool_in</a>;</div>
<div class="line"><a name="l00077"></a><span class="lineno"><a class="line" href="struct_m_m_a_l_decode_context.html#ad4e62f8904514d8c5bad4d7e193d4f6e">   77</a></span>&#160;    <a class="code" href="struct_f_f_pool_ref.html">FFPoolRef</a> *<a class="code" href="struct_m_m_a_l_decode_context.html#ad4e62f8904514d8c5bad4d7e193d4f6e">pool_out</a>;</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160; </div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    <span class="comment">// Waiting input packets. Because the libavcodec API requires decoding and</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    <span class="comment">// returning packets in lockstep, it can happen that queue_decoded_frames</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    <span class="comment">// contains almost all surfaces - then the decoder input queue can quickly</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    <span class="comment">// fill up and won&#39;t accept new input either. Without consuming input, the</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    <span class="comment">// libavcodec API can&#39;t return new frames, and we have a logical deadlock.</span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    <span class="comment">// This is avoided by queuing such buffers here.</span></div>
<div class="line"><a name="l00085"></a><span class="lineno"><a class="line" href="struct_m_m_a_l_decode_context.html#a2ba943313226522a91c1febb8fd0edb7">   85</a></span>&#160;    <a class="code" href="struct_f_f_buffer_entry.html">FFBufferEntry</a> *<a class="code" href="struct_m_m_a_l_decode_context.html#ac5879764ae4b39ebc05c7689ae42b5f3">waiting_buffers</a>, *<a class="code" href="struct_m_m_a_l_decode_context.html#a2ba943313226522a91c1febb8fd0edb7">waiting_buffers_tail</a>;</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160; </div>
<div class="line"><a name="l00087"></a><span class="lineno"><a class="line" href="struct_m_m_a_l_decode_context.html#a182dee9c5b3849bd9c031f4cc194f7c1">   87</a></span>&#160;    int64_t <a class="code" href="struct_m_m_a_l_decode_context.html#a182dee9c5b3849bd9c031f4cc194f7c1">packets_sent</a>;</div>
<div class="line"><a name="l00088"></a><span class="lineno"><a class="line" href="struct_m_m_a_l_decode_context.html#aca97a98b8385e618008e3de22a041318">   88</a></span>&#160;    <a class="code" href="dummy_2stdatomic_8h.html#a60b2151806275a115118e9981cc096b2">atomic_int</a> <a class="code" href="struct_m_m_a_l_decode_context.html#aca97a98b8385e618008e3de22a041318">packets_buffered</a>;</div>
<div class="line"><a name="l00089"></a><span class="lineno"><a class="line" href="struct_m_m_a_l_decode_context.html#a220775f17230040b3562fe2ce0525d81">   89</a></span>&#160;    int64_t <a class="code" href="struct_m_m_a_l_decode_context.html#a220775f17230040b3562fe2ce0525d81">frames_output</a>;</div>
<div class="line"><a name="l00090"></a><span class="lineno"><a class="line" href="struct_m_m_a_l_decode_context.html#a12a439f3d8b154f336c7a359c0e1a98b">   90</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="struct_m_m_a_l_decode_context.html#a12a439f3d8b154f336c7a359c0e1a98b">eos_received</a>;</div>
<div class="line"><a name="l00091"></a><span class="lineno"><a class="line" href="struct_m_m_a_l_decode_context.html#ac3ecc2b60aed27997f2ca6176b460698">   91</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="struct_m_m_a_l_decode_context.html#ac3ecc2b60aed27997f2ca6176b460698">eos_sent</a>;</div>
<div class="line"><a name="l00092"></a><span class="lineno"><a class="line" href="struct_m_m_a_l_decode_context.html#a6005d92ff46458569670142b146d4f9a">   92</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="struct_m_m_a_l_decode_context.html#a6005d92ff46458569670142b146d4f9a">extradata_sent</a>;</div>
<div class="line"><a name="l00093"></a><span class="lineno"><a class="line" href="struct_m_m_a_l_decode_context.html#a1fac4e76b20788dbbb6d68e9bc6aa866">   93</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="struct_m_m_a_l_decode_context.html#a1fac4e76b20788dbbb6d68e9bc6aa866">interlaced_frame</a>;</div>
<div class="line"><a name="l00094"></a><span class="lineno"><a class="line" href="struct_m_m_a_l_decode_context.html#a91826d8e0953fde68f4f671abe512ba4">   94</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="struct_m_m_a_l_decode_context.html#a91826d8e0953fde68f4f671abe512ba4">top_field_first</a>;</div>
<div class="line"><a name="l00095"></a><span class="lineno"><a class="line" href="mmaldec_8c.html#a148e964367f4eba01058d175d7f91acd">   95</a></span>&#160;} <a class="code" href="mmaldec_8c.html#a148e964367f4eba01058d175d7f91acd">MMALDecodeContext</a>;</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160; </div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="comment">// Assume decoder is guaranteed to produce output after at least this many</span></div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="comment">// packets (where each packet contains 1 frame).</span></div>
<div class="line"><a name="l00099"></a><span class="lineno"><a class="line" href="mmaldec_8c.html#a56be75a71b6b6abecc97433dec143493">   99</a></span>&#160;<span class="preprocessor">#define MAX_DELAYED_FRAMES 16</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160; </div>
<div class="line"><a name="l00101"></a><span class="lineno"><a class="line" href="mmaldec_8c.html#a6e86699acab77c052deafff2b575b553">  101</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="mmaldec_8c.html#a6e86699acab77c052deafff2b575b553">ffmmal_poolref_unref</a>(<a class="code" href="struct_f_f_pool_ref.html">FFPoolRef</a> *<a class="code" href="tests_2jpeg2000dwt_8c.html#a5cabdd8be5af41f675fed06498e094b7">ref</a>)</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;{</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2jpeg2000dwt_8c.html#a5cabdd8be5af41f675fed06498e094b7">ref</a> &amp;&amp;</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;        <a class="code" href="dummy_2stdatomic_8h.html#a1d2b72b5d6ad1392c4f805054be0bdd1">atomic_fetch_add_explicit</a>(&amp;<a class="code" href="tests_2jpeg2000dwt_8c.html#a5cabdd8be5af41f675fed06498e094b7">ref</a>-&gt;refcount, -1, memory_order_acq_rel) == 1) {</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;        mmal_pool_destroy(<a class="code" href="tests_2jpeg2000dwt_8c.html#a5cabdd8be5af41f675fed06498e094b7">ref</a>-&gt;pool);</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#a079eab092887563f2bef9106c6120089">av_free</a>(<a class="code" href="tests_2jpeg2000dwt_8c.html#a5cabdd8be5af41f675fed06498e094b7">ref</a>);</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    }</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;}</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160; </div>
<div class="line"><a name="l00110"></a><span class="lineno"><a class="line" href="mmaldec_8c.html#a3d0a63b052c6d73483ec8d7f821b616e">  110</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="mmaldec_8c.html#a3d0a63b052c6d73483ec8d7f821b616e">ffmmal_release_frame</a>(<span class="keywordtype">void</span> *opaque, <a class="code" href="audio__convert_8c.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> *<a class="code" href="mxf_8c.html#a084824fc871e38157790c99ae1240842">data</a>)</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;{</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    <a class="code" href="struct_f_f_buffer_ref.html">FFBufferRef</a> *<a class="code" href="tests_2jpeg2000dwt_8c.html#a5cabdd8be5af41f675fed06498e094b7">ref</a> = (<span class="keywordtype">void</span> *)<a class="code" href="mxf_8c.html#a084824fc871e38157790c99ae1240842">data</a>;</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160; </div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    mmal_buffer_header_release(<a class="code" href="tests_2jpeg2000dwt_8c.html#a5cabdd8be5af41f675fed06498e094b7">ref</a>-&gt;buffer);</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    <a class="code" href="mmaldec_8c.html#a6e86699acab77c052deafff2b575b553">ffmmal_poolref_unref</a>(<a class="code" href="tests_2jpeg2000dwt_8c.html#a5cabdd8be5af41f675fed06498e094b7">ref</a>-&gt;pool);</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160; </div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#a079eab092887563f2bef9106c6120089">av_free</a>(<a class="code" href="tests_2jpeg2000dwt_8c.html#a5cabdd8be5af41f675fed06498e094b7">ref</a>);</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;}</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160; </div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="comment">// Setup frame with a new reference to buffer. The buffer must have been</span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="comment">// allocated from the given pool.</span></div>
<div class="line"><a name="l00122"></a><span class="lineno"><a class="line" href="mmaldec_8c.html#a52311afa50d61c5b84c4ff410be1d8ad">  122</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="mmaldec_8c.html#a52311afa50d61c5b84c4ff410be1d8ad">ffmmal_set_ref</a>(<a class="code" href="struct_a_v_frame.html">AVFrame</a> *<a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>, <a class="code" href="struct_f_f_pool_ref.html">FFPoolRef</a> *pool,</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;                          MMAL_BUFFER_HEADER_T *<a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a>)</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;{</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    <a class="code" href="struct_f_f_buffer_ref.html">FFBufferRef</a> *<a class="code" href="tests_2jpeg2000dwt_8c.html#a5cabdd8be5af41f675fed06498e094b7">ref</a> = <a class="code" href="group__lavu__mem__funcs.html#gaf143ecab33a3868b57345466c39de7c1">av_mallocz</a>(<span class="keyword">sizeof</span>(*<a class="code" href="tests_2jpeg2000dwt_8c.html#a5cabdd8be5af41f675fed06498e094b7">ref</a>));</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="tests_2jpeg2000dwt_8c.html#a5cabdd8be5af41f675fed06498e094b7">ref</a>)</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160; </div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    <a class="code" href="tests_2jpeg2000dwt_8c.html#a5cabdd8be5af41f675fed06498e094b7">ref</a>-&gt;pool = pool;</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    <a class="code" href="tests_2jpeg2000dwt_8c.html#a5cabdd8be5af41f675fed06498e094b7">ref</a>-&gt;buffer = <a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a>;</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160; </div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    <a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>-&gt;buf[0] = <a class="code" href="group__lavu__buffer.html#ga3e7f4c92db85ccba0b2a16dd0069842a">av_buffer_create</a>((<span class="keywordtype">void</span> *)<a class="code" href="tests_2jpeg2000dwt_8c.html#a5cabdd8be5af41f675fed06498e094b7">ref</a>, <span class="keyword">sizeof</span>(*<a class="code" href="tests_2jpeg2000dwt_8c.html#a5cabdd8be5af41f675fed06498e094b7">ref</a>),</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;                                     <a class="code" href="mmaldec_8c.html#a3d0a63b052c6d73483ec8d7f821b616e">ffmmal_release_frame</a>, <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;                                     <a class="code" href="group__lavu__buffer.html#gaa818f8f1011d69acc50c1f29cb85e576">AV_BUFFER_FLAG_READONLY</a>);</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>-&gt;buf[0]) {</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#a079eab092887563f2bef9106c6120089">av_free</a>(<a class="code" href="tests_2jpeg2000dwt_8c.html#a5cabdd8be5af41f675fed06498e094b7">ref</a>);</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    }</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160; </div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    <a class="code" href="dummy_2stdatomic_8h.html#a1d2b72b5d6ad1392c4f805054be0bdd1">atomic_fetch_add_explicit</a>(&amp;<a class="code" href="tests_2jpeg2000dwt_8c.html#a5cabdd8be5af41f675fed06498e094b7">ref</a>-&gt;pool-&gt;refcount, 1, memory_order_relaxed);</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    mmal_buffer_header_acquire(<a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a>);</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160; </div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    <a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>-&gt;format = <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a6beaeafbe680583bb65578bbdbf0973e">AV_PIX_FMT_MMAL</a>;</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    <a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>-&gt;data[3] = (<a class="code" href="audio__convert_8c.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> *)<a class="code" href="tests_2jpeg2000dwt_8c.html#a5cabdd8be5af41f675fed06498e094b7">ref</a>-&gt;buffer;</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;}</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160; </div>
<div class="line"><a name="l00148"></a><span class="lineno"><a class="line" href="mmaldec_8c.html#a947f3567c81c3171bc8664828f9775dc">  148</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="mmaldec_8c.html#a947f3567c81c3171bc8664828f9775dc">ffmmal_stop_decoder</a>(<a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a> *avctx)</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;{</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    <a class="code" href="struct_m_m_a_l_decode_context.html">MMALDecodeContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a> = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#af3379123060ad8cc9c321c29af4f8360">priv_data</a>;</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    MMAL_COMPONENT_T *<a class="code" href="libavcodec_2dfa_8c.html#a837d39f8b74c379be96e07fe99664ca3">decoder</a> = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;decoder;</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    MMAL_BUFFER_HEADER_T *<a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a>;</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160; </div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    mmal_port_disable(<a class="code" href="libavcodec_2dfa_8c.html#a837d39f8b74c379be96e07fe99664ca3">decoder</a>-&gt;input[0]);</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    mmal_port_disable(<a class="code" href="libavcodec_2dfa_8c.html#a837d39f8b74c379be96e07fe99664ca3">decoder</a>-&gt;output[0]);</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    mmal_port_disable(<a class="code" href="libavcodec_2dfa_8c.html#a837d39f8b74c379be96e07fe99664ca3">decoder</a>-&gt;control);</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160; </div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    mmal_port_flush(<a class="code" href="libavcodec_2dfa_8c.html#a837d39f8b74c379be96e07fe99664ca3">decoder</a>-&gt;input[0]);</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    mmal_port_flush(<a class="code" href="libavcodec_2dfa_8c.html#a837d39f8b74c379be96e07fe99664ca3">decoder</a>-&gt;output[0]);</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    mmal_port_flush(<a class="code" href="libavcodec_2dfa_8c.html#a837d39f8b74c379be96e07fe99664ca3">decoder</a>-&gt;control);</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160; </div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    <span class="keywordflow">while</span> ((<a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a> = mmal_queue_get(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;queue_decoded_frames)))</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;        mmal_buffer_header_release(<a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a>);</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160; </div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    <span class="keywordflow">while</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;waiting_buffers) {</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;        <a class="code" href="struct_f_f_buffer_entry.html">FFBufferEntry</a> *<a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a> = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;waiting_buffers;</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160; </div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;waiting_buffers = <a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a>-&gt;next;</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160; </div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a>-&gt;<a class="code" href="struct_a_v_frame.html#a49020cc320b8fb1f5449167b6c97515b">flags</a> &amp; MMAL_BUFFER_HEADER_FLAG_FRAME_END)</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;            <a class="code" href="gcc_2stdatomic_8h.html#aedf6fb62e0fc9e8f8cf2e3685f0a1e88">atomic_fetch_add</a>(&amp;<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;packets_buffered, -1);</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160; </div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;        <a class="code" href="group__lavu__buffer.html#ga135e9e929b5033bb8f68322497b2effc">av_buffer_unref</a>(&amp;<a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a>-&gt;ref);</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#a079eab092887563f2bef9106c6120089">av_free</a>(<a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a>);</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    }</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;waiting_buffers_tail = <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160; </div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    <a class="code" href="avassert_8h.html#aae204192396f78cc8c5cd7ad5c57c23f">av_assert0</a>(<a class="code" href="dummy_2stdatomic_8h.html#acced2a78b2a440317feed51f3e505d1d">atomic_load</a>(&amp;<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;packets_buffered) == 0);</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160; </div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;frames_output = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;eos_received = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;eos_sent = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;packets_sent = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;extradata_sent = 0;</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;}</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160; </div>
<div class="line"><a name="l00183"></a><span class="lineno"><a class="line" href="mmaldec_8c.html#a1d740192498a2fb7b1047ba1e9d193f9">  183</a></span>&#160;<span class="keyword">static</span> <a class="code" href="attributes_8h.html#abeeb324fff79a5335d36774704e2475c">av_cold</a> <span class="keywordtype">int</span> <a class="code" href="mmaldec_8c.html#a1d740192498a2fb7b1047ba1e9d193f9">ffmmal_close_decoder</a>(<a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a> *avctx)</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;{</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    <a class="code" href="struct_m_m_a_l_decode_context.html">MMALDecodeContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a> = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#af3379123060ad8cc9c321c29af4f8360">priv_data</a>;</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160; </div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;decoder)</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;        <a class="code" href="mmaldec_8c.html#a947f3567c81c3171bc8664828f9775dc">ffmmal_stop_decoder</a>(avctx);</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160; </div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    mmal_component_destroy(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;decoder);</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;decoder = <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    mmal_queue_destroy(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;queue_decoded_frames);</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    mmal_pool_destroy(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;pool_in);</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    <a class="code" href="mmaldec_8c.html#a6e86699acab77c052deafff2b575b553">ffmmal_poolref_unref</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;pool_out);</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160; </div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    mmal_vc_deinit();</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160; </div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;}</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160; </div>
<div class="line"><a name="l00201"></a><span class="lineno"><a class="line" href="mmaldec_8c.html#a50b28ae8c033ca7cae2dd18201208586">  201</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="mmaldec_8c.html#a50b28ae8c033ca7cae2dd18201208586">input_callback</a>(MMAL_PORT_T *port, MMAL_BUFFER_HEADER_T *<a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a>)</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;{</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    <a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a> *avctx = (<a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a>*)port-&gt;userdata;</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    <a class="code" href="struct_m_m_a_l_decode_context.html">MMALDecodeContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a> = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#af3379123060ad8cc9c321c29af4f8360">priv_data</a>;</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160; </div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    <a class="code" href="filter__design_8txt.html#a0e82f1088fdc24c14bf175d2ac77523f">if</a> (!<a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a>-&gt;cmd) {</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;        <a class="code" href="struct_f_f_buffer_entry.html">FFBufferEntry</a> *entry = <a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a>-&gt;user_data;</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;        <a class="code" href="group__lavu__buffer.html#ga135e9e929b5033bb8f68322497b2effc">av_buffer_unref</a>(&amp;entry-&gt;<a class="code" href="struct_f_f_buffer_entry.html#a134f8dd2b4d6c936215b14fbb2b5e718">ref</a>);</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;        <span class="keywordflow">if</span> (entry-&gt;<a class="code" href="struct_f_f_buffer_entry.html#a9cec0ae60855480857b91d6301341831">flags</a> &amp; MMAL_BUFFER_HEADER_FLAG_FRAME_END)</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;            <a class="code" href="gcc_2stdatomic_8h.html#aedf6fb62e0fc9e8f8cf2e3685f0a1e88">atomic_fetch_add</a>(&amp;<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;packets_buffered, -1);</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#a079eab092887563f2bef9106c6120089">av_free</a>(entry);</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    }</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    mmal_buffer_header_release(<a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a>);</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;}</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160; </div>
<div class="line"><a name="l00216"></a><span class="lineno"><a class="line" href="mmaldec_8c.html#a3d5c64c42cccf38d29eedfff2b8cf977">  216</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="mmaldec_8c.html#a3d5c64c42cccf38d29eedfff2b8cf977">output_callback</a>(MMAL_PORT_T *port, MMAL_BUFFER_HEADER_T *<a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a>)</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;{</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    <a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a> *avctx = (<a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a>*)port-&gt;userdata;</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    <a class="code" href="struct_m_m_a_l_decode_context.html">MMALDecodeContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a> = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#af3379123060ad8cc9c321c29af4f8360">priv_data</a>;</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160; </div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    mmal_queue_put(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;queue_decoded_frames, <a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a>);</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;}</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160; </div>
<div class="line"><a name="l00224"></a><span class="lineno"><a class="line" href="mmaldec_8c.html#aeee0f01c1d41873152888d3b1a0e2ef2">  224</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="mmaldec_8c.html#aeee0f01c1d41873152888d3b1a0e2ef2">control_port_cb</a>(MMAL_PORT_T *port, MMAL_BUFFER_HEADER_T *<a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a>)</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;{</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    <a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a> *avctx = (<a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a>*)port-&gt;userdata;</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    MMAL_STATUS_T <a class="code" href="filter__design_8txt.html#ad6a339ae538717b3e99082a8016207df">status</a>;</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160; </div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    <a class="code" href="filter__design_8txt.html#a0e82f1088fdc24c14bf175d2ac77523f">if</a> (<a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a>-&gt;cmd == MMAL_EVENT_ERROR) {</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;        <a class="code" href="filter__design_8txt.html#ad6a339ae538717b3e99082a8016207df">status</a> = *(uint32_t *)<a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a>-&gt;<a class="code" href="struct_a_v_frame.html#a1d0f65014a8d1bf78cec8cbed2304992">data</a>;</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;MMAL error %d on control port\n&quot;</span>, (<span class="keywordtype">int</span>)<a class="code" href="filter__design_8txt.html#ad6a339ae538717b3e99082a8016207df">status</a>);</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga85b57516ca703cc47d9bbe5f4658c716">AV_LOG_WARNING</a>, <span class="stringliteral">&quot;Unknown MMAL event %s on control port\n&quot;</span>,</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;               <a class="code" href="group__lavu__misc.html#gae07d7cbf511060210152a89ad0d137ad">av_fourcc2str</a>(<a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a>-&gt;cmd));</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    }</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160; </div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    mmal_buffer_header_release(<a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a>);</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;}</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160; </div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;<span class="comment">// Feed free output buffers to the decoder.</span></div>
<div class="line"><a name="l00241"></a><span class="lineno"><a class="line" href="mmaldec_8c.html#ae04e5817dd1faa79ca3741844abc2361">  241</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="mmaldec_8c.html#ae04e5817dd1faa79ca3741844abc2361">ffmmal_fill_output_port</a>(<a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a> *avctx)</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;{</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    <a class="code" href="struct_m_m_a_l_decode_context.html">MMALDecodeContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a> = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#af3379123060ad8cc9c321c29af4f8360">priv_data</a>;</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    MMAL_BUFFER_HEADER_T *<a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a>;</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    MMAL_STATUS_T <a class="code" href="filter__design_8txt.html#ad6a339ae538717b3e99082a8016207df">status</a>;</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160; </div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;pool_out)</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="group__lavu__error.html#ga4ebaa288c7684a26a591c501208910e4">AVERROR_UNKNOWN</a>; <span class="comment">// format change code failed with OOM previously</span></div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160; </div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    <span class="keywordflow">while</span> ((<a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a> = mmal_queue_get(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;pool_out-&gt;pool-&gt;queue))) {</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;        <span class="keywordflow">if</span> ((<a class="code" href="filter__design_8txt.html#ad6a339ae538717b3e99082a8016207df">status</a> = mmal_port_send_buffer(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;decoder-&gt;output[0], <a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a>))) {</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;            mmal_buffer_header_release(<a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a>);</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;MMAL error %d when sending output buffer.\n&quot;</span>, (<span class="keywordtype">int</span>)<a class="code" href="filter__design_8txt.html#ad6a339ae538717b3e99082a8016207df">status</a>);</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="group__lavu__error.html#ga4ebaa288c7684a26a591c501208910e4">AVERROR_UNKNOWN</a>;</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;        }</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    }</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160; </div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;}</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160; </div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;<span class="keyword">static</span> <span class="keyword">enum</span> <a class="code" href="pixfmt_8h.html#aff71a069509a1ad3ff54d53a1c894c85">AVColorSpace</a> <a class="code" href="mmaldec_8c.html#aced0493c254fb6e65f022fcedf25eb90">ffmmal_csp_to_av_csp</a>(MMAL_FOURCC_T <a class="code" href="vaapi__decode_8c.html#aa5d906425500585aa7832161b2a40e1b">fourcc</a>)</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;{</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    <span class="keywordflow">switch</span> (<a class="code" href="vaapi__decode_8c.html#aa5d906425500585aa7832161b2a40e1b">fourcc</a>) {</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    <span class="keywordflow">case</span> MMAL_COLOR_SPACE_BT470_2_BG:</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    <span class="keywordflow">case</span> MMAL_COLOR_SPACE_BT470_2_M:</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    <span class="keywordflow">case</span> MMAL_COLOR_SPACE_ITUR_BT601:   <span class="keywordflow">return</span> <a class="code" href="pixfmt_8h.html#aff71a069509a1ad3ff54d53a1c894c85a32a0719616b0bb89f4be9d885341bfa4">AVCOL_SPC_BT470BG</a>;</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    <span class="keywordflow">case</span> MMAL_COLOR_SPACE_ITUR_BT709:   <span class="keywordflow">return</span> <a class="code" href="pixfmt_8h.html#aff71a069509a1ad3ff54d53a1c894c85a23e7d1012e354bbfcb62642e537d33cb">AVCOL_SPC_BT709</a>;</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    <span class="keywordflow">case</span> MMAL_COLOR_SPACE_FCC:          <span class="keywordflow">return</span> <a class="code" href="pixfmt_8h.html#aff71a069509a1ad3ff54d53a1c894c85a8f572d6acb2787e37e88088da047c492">AVCOL_SPC_FCC</a>;</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    <span class="keywordflow">case</span> MMAL_COLOR_SPACE_SMPTE240M:    <span class="keywordflow">return</span> <a class="code" href="pixfmt_8h.html#aff71a069509a1ad3ff54d53a1c894c85aa0052721bb202c5cfb68a84d69116f69">AVCOL_SPC_SMPTE240M</a>;</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    <span class="keywordflow">default</span>:                            <span class="keywordflow">return</span> <a class="code" href="pixfmt_8h.html#aff71a069509a1ad3ff54d53a1c894c85a8111716eff3b3fd95a197993d30b8ec2">AVCOL_SPC_UNSPECIFIED</a>;</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    }</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;}</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160; </div>
<div class="line"><a name="l00274"></a><span class="lineno"><a class="line" href="mmaldec_8c.html#a24f7526ac8c3e7cf127c21bcef8ffd43">  274</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="mmaldec_8c.html#a24f7526ac8c3e7cf127c21bcef8ffd43">ffmal_update_format</a>(<a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a> *avctx)</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;{</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    <a class="code" href="struct_m_m_a_l_decode_context.html">MMALDecodeContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a> = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#af3379123060ad8cc9c321c29af4f8360">priv_data</a>;</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;    MMAL_STATUS_T <a class="code" href="filter__design_8txt.html#ad6a339ae538717b3e99082a8016207df">status</a>;</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = 0;</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    MMAL_COMPONENT_T *<a class="code" href="libavcodec_2dfa_8c.html#a837d39f8b74c379be96e07fe99664ca3">decoder</a> = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;decoder;</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    MMAL_ES_FORMAT_T *format_out = <a class="code" href="libavcodec_2dfa_8c.html#a837d39f8b74c379be96e07fe99664ca3">decoder</a>-&gt;output[0]-&gt;format;</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    MMAL_PARAMETER_VIDEO_INTERLACE_TYPE_T interlace_type;</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160; </div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;    <a class="code" href="mmaldec_8c.html#a6e86699acab77c052deafff2b575b553">ffmmal_poolref_unref</a>(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;pool_out);</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    <span class="keywordflow">if</span> (!(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;pool_out = <a class="code" href="group__lavu__mem__funcs.html#gaf143ecab33a3868b57345466c39de7c1">av_mallocz</a>(<span class="keyword">sizeof</span>(*<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;pool_out)))) {</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;        <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    }</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    <a class="code" href="dummy_2stdatomic_8h.html#af8a9cbe9495fcafaa892b24b383acf96">atomic_init</a>(&amp;<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;pool_out-&gt;refcount, 1);</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160; </div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    <span class="keywordflow">if</span> (!format_out)</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160; </div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    <span class="keywordflow">if</span> ((<a class="code" href="filter__design_8txt.html#ad6a339ae538717b3e99082a8016207df">status</a> = mmal_port_parameter_set_uint32(<a class="code" href="libavcodec_2dfa_8c.html#a837d39f8b74c379be96e07fe99664ca3">decoder</a>-&gt;output[0], MMAL_PARAMETER_EXTRA_BUFFERS, <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;extra_buffers)))</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160; </div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    <span class="keywordflow">if</span> ((<a class="code" href="filter__design_8txt.html#ad6a339ae538717b3e99082a8016207df">status</a> = mmal_port_parameter_set_boolean(<a class="code" href="libavcodec_2dfa_8c.html#a837d39f8b74c379be96e07fe99664ca3">decoder</a>-&gt;output[0], MMAL_PARAMETER_VIDEO_INTERPOLATE_TIMESTAMPS, 0)))</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160; </div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    <span class="keywordflow">if</span> (avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a0425c77b3d06d71e5db88b1d7e1b37f2">pix_fmt</a> == <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a6beaeafbe680583bb65578bbdbf0973e">AV_PIX_FMT_MMAL</a>) {</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;        format_out-&gt;encoding = MMAL_ENCODING_OPAQUE;</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;        format_out-&gt;encoding_variant = format_out-&gt;encoding = MMAL_ENCODING_I420;</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    }</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160; </div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    <span class="keywordflow">if</span> ((<a class="code" href="filter__design_8txt.html#ad6a339ae538717b3e99082a8016207df">status</a> = mmal_port_format_commit(<a class="code" href="libavcodec_2dfa_8c.html#a837d39f8b74c379be96e07fe99664ca3">decoder</a>-&gt;output[0])))</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160; </div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    interlace_type.hdr.id = MMAL_PARAMETER_VIDEO_INTERLACE_TYPE;</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    interlace_type.hdr.size = <span class="keyword">sizeof</span>(MMAL_PARAMETER_VIDEO_INTERLACE_TYPE_T);</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    <a class="code" href="filter__design_8txt.html#ad6a339ae538717b3e99082a8016207df">status</a> = mmal_port_parameter_get(<a class="code" href="libavcodec_2dfa_8c.html#a837d39f8b74c379be96e07fe99664ca3">decoder</a>-&gt;output[0], &amp;interlace_type.hdr);</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="filter__design_8txt.html#ad6a339ae538717b3e99082a8016207df">status</a> != MMAL_SUCCESS) {</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Cannot read MMAL interlace information!\n&quot;</span>);</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;interlaced_frame = (interlace_type.eMode != MMAL_InterlaceProgressive);</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;top_field_first = (interlace_type.eMode == MMAL_InterlaceFieldsInterleavedUpperFirst);</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    }</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160; </div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    <span class="keywordflow">if</span> ((<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = <a class="code" href="libavcodec_2internal_8h.html#ac8b736a8223c5348ad85ffff597401ff">ff_set_dimensions</a>(avctx, format_out-&gt;es-&gt;video.crop.x + format_out-&gt;es-&gt;video.crop.<a class="code" href="struct_a_v_codec_context.html#a0d8f46461754e8abea0847dcbc41b956">width</a>,</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;                                        format_out-&gt;es-&gt;video.crop.y + format_out-&gt;es-&gt;video.crop.height)) &lt; 0)</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160; </div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    <span class="keywordflow">if</span> (format_out-&gt;es-&gt;video.par.num &amp;&amp; format_out-&gt;es-&gt;video.par.den) {</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;        avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a5252d34fbce300228d4dbda19a8c3293">sample_aspect_ratio</a>.<a class="code" href="struct_a_v_rational.html#ae9a98c10a301c5e937095105b6f0fdb9">num</a> = format_out-&gt;es-&gt;video.par.num;</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;        avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a5252d34fbce300228d4dbda19a8c3293">sample_aspect_ratio</a>.<a class="code" href="struct_a_v_rational.html#aee46bdac67d965ac0a4204e753f910c3">den</a> = format_out-&gt;es-&gt;video.par.den;</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    }</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;    <span class="keywordflow">if</span> (format_out-&gt;es-&gt;video.frame_rate.num &amp;&amp; format_out-&gt;es-&gt;video.frame_rate.den) {</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;        avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a4d08b297e97eefd66c714df4fff493c8">framerate</a>.<a class="code" href="struct_a_v_rational.html#ae9a98c10a301c5e937095105b6f0fdb9">num</a> = format_out-&gt;es-&gt;video.frame_rate.num;</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;        avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a4d08b297e97eefd66c714df4fff493c8">framerate</a>.<a class="code" href="struct_a_v_rational.html#aee46bdac67d965ac0a4204e753f910c3">den</a> = format_out-&gt;es-&gt;video.frame_rate.den;</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    }</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160; </div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a8cd8caa7d40319324ce3d879a2edbd9f">colorspace</a> = <a class="code" href="mmaldec_8c.html#aced0493c254fb6e65f022fcedf25eb90">ffmmal_csp_to_av_csp</a>(format_out-&gt;es-&gt;video.color_space);</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160; </div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    <a class="code" href="libavcodec_2dfa_8c.html#a837d39f8b74c379be96e07fe99664ca3">decoder</a>-&gt;output[0]-&gt;buffer_size =</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;        <a class="code" href="common_8h.html#a9960bd6780a9b16a216a57be1ee04359">FFMAX</a>(<a class="code" href="libavcodec_2dfa_8c.html#a837d39f8b74c379be96e07fe99664ca3">decoder</a>-&gt;output[0]-&gt;buffer_size_min, <a class="code" href="libavcodec_2dfa_8c.html#a837d39f8b74c379be96e07fe99664ca3">decoder</a>-&gt;output[0]-&gt;buffer_size_recommended);</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    <a class="code" href="libavcodec_2dfa_8c.html#a837d39f8b74c379be96e07fe99664ca3">decoder</a>-&gt;output[0]-&gt;buffer_num =</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;        <a class="code" href="common_8h.html#a9960bd6780a9b16a216a57be1ee04359">FFMAX</a>(<a class="code" href="libavcodec_2dfa_8c.html#a837d39f8b74c379be96e07fe99664ca3">decoder</a>-&gt;output[0]-&gt;buffer_num_min, <a class="code" href="libavcodec_2dfa_8c.html#a837d39f8b74c379be96e07fe99664ca3">decoder</a>-&gt;output[0]-&gt;buffer_num_recommended) + <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;extra_buffers;</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;pool_out-&gt;pool = mmal_pool_create(<a class="code" href="libavcodec_2dfa_8c.html#a837d39f8b74c379be96e07fe99664ca3">decoder</a>-&gt;output[0]-&gt;buffer_num,</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;                                           <a class="code" href="libavcodec_2dfa_8c.html#a837d39f8b74c379be96e07fe99664ca3">decoder</a>-&gt;output[0]-&gt;buffer_size);</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;pool_out-&gt;pool) {</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;        <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    }</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160; </div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160; </div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;<a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>:</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> &lt; 0 ? <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> : <a class="code" href="group__lavu__error.html#ga4ebaa288c7684a26a591c501208910e4">AVERROR_UNKNOWN</a>;</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;}</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160; </div>
<div class="line"><a name="l00350"></a><span class="lineno"><a class="line" href="mmaldec_8c.html#a3579bba1d9c59a05500a2ec005658eb9">  350</a></span>&#160;<span class="keyword">static</span> <a class="code" href="attributes_8h.html#abeeb324fff79a5335d36774704e2475c">av_cold</a> <span class="keywordtype">int</span> <a class="code" href="mmaldec_8c.html#a3579bba1d9c59a05500a2ec005658eb9">ffmmal_init_decoder</a>(<a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a> *avctx)</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;{</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    <a class="code" href="struct_m_m_a_l_decode_context.html">MMALDecodeContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a> = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#af3379123060ad8cc9c321c29af4f8360">priv_data</a>;</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    MMAL_STATUS_T <a class="code" href="filter__design_8txt.html#ad6a339ae538717b3e99082a8016207df">status</a>;</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    MMAL_ES_FORMAT_T *format_in;</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    MMAL_COMPONENT_T *<a class="code" href="libavcodec_2dfa_8c.html#a837d39f8b74c379be96e07fe99664ca3">decoder</a>;</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = 0;</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160; </div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    bcm_host_init();</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160; </div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    <span class="keywordflow">if</span> (mmal_vc_init()) {</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Cannot initialize MMAL VC driver!\n&quot;</span>);</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOSYS);</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    }</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160; </div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;    <span class="keywordflow">if</span> ((<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = <a class="code" href="decode_8c.html#a8a7eadb05d8ea6f849a146035377ad1f">ff_get_format</a>(avctx, avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a6e606effa68724cae2ef5cc05f7fd9cb">codec</a>-&gt;<a class="code" href="struct_a_v_codec.html#ac2b97bd3c19686025e1b7d577329c250">pix_fmts</a>)) &lt; 0)</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>;</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160; </div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;    avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a0425c77b3d06d71e5db88b1d7e1b37f2">pix_fmt</a> = <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>;</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160; </div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    <span class="keywordflow">if</span> ((<a class="code" href="filter__design_8txt.html#ad6a339ae538717b3e99082a8016207df">status</a> = mmal_component_create(MMAL_COMPONENT_DEFAULT_VIDEO_DECODER, &amp;<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;decoder)))</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160; </div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;    <a class="code" href="libavcodec_2dfa_8c.html#a837d39f8b74c379be96e07fe99664ca3">decoder</a> = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;decoder;</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160; </div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    format_in = <a class="code" href="libavcodec_2dfa_8c.html#a837d39f8b74c379be96e07fe99664ca3">decoder</a>-&gt;input[0]-&gt;format;</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    format_in-&gt;type = MMAL_ES_TYPE_VIDEO;</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;    <span class="keywordflow">switch</span> (avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#adc5f65d6099fd8339c1580c091777223">codec_id</a>) {</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="group__lavc__core.html#ggaadca229ad2c20e060a14fec08a5cc7ceaf614abb36f7c5d0c42ed522c1d6c99f0">AV_CODEC_ID_MPEG2VIDEO</a>:</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;        format_in-&gt;encoding = MMAL_ENCODING_MP2V;</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="group__lavc__core.html#ggaadca229ad2c20e060a14fec08a5cc7cead95dfdf68b462db508b45fb693a4c09e">AV_CODEC_ID_MPEG4</a>:</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;        format_in-&gt;encoding = MMAL_ENCODING_MP4V;</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="group__lavc__core.html#ggaadca229ad2c20e060a14fec08a5cc7cea7765c5c02c05ea1a96ef1ca35dad068f">AV_CODEC_ID_VC1</a>:</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;        format_in-&gt;encoding = MMAL_ENCODING_WVC1;</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="group__lavc__core.html#ggaadca229ad2c20e060a14fec08a5cc7cea3d4c051c8b18a3c18750676a308c10be">AV_CODEC_ID_H264</a>:</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;    <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;        format_in-&gt;encoding = MMAL_ENCODING_H264;</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;    }</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    format_in-&gt;es-&gt;video.width = <a class="code" href="macros_8h.html#acae4ba605b3a7d535b7ac058ffe96892">FFALIGN</a>(avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a0d8f46461754e8abea0847dcbc41b956">width</a>, 32);</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    format_in-&gt;es-&gt;video.height = <a class="code" href="macros_8h.html#acae4ba605b3a7d535b7ac058ffe96892">FFALIGN</a>(avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a0449afd803eb107bd4dbc8b5ea22e363">height</a>, 16);</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    format_in-&gt;es-&gt;video.crop.width = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a0d8f46461754e8abea0847dcbc41b956">width</a>;</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    format_in-&gt;es-&gt;video.crop.height = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a0449afd803eb107bd4dbc8b5ea22e363">height</a>;</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    format_in-&gt;es-&gt;video.frame_rate.num = 24000;</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    format_in-&gt;es-&gt;video.frame_rate.den = 1001;</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    format_in-&gt;es-&gt;video.par.num = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a5252d34fbce300228d4dbda19a8c3293">sample_aspect_ratio</a>.<a class="code" href="struct_a_v_rational.html#ae9a98c10a301c5e937095105b6f0fdb9">num</a>;</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    format_in-&gt;es-&gt;video.par.den = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a5252d34fbce300228d4dbda19a8c3293">sample_aspect_ratio</a>.<a class="code" href="struct_a_v_rational.html#aee46bdac67d965ac0a4204e753f910c3">den</a>;</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    format_in-&gt;flags = MMAL_ES_FORMAT_FLAG_FRAMED;</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160; </div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga5b7221c3afd06848486776bd834a58a5">AV_LOG_DEBUG</a>, <span class="stringliteral">&quot;Using MMAL %s encoding.\n&quot;</span>,</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;           <a class="code" href="group__lavu__misc.html#gae07d7cbf511060210152a89ad0d137ad">av_fourcc2str</a>(format_in-&gt;encoding));</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160; </div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;<span class="preprocessor">#if HAVE_MMAL_PARAMETER_VIDEO_MAX_NUM_CALLBACKS</span></div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;    <span class="keywordflow">if</span> (mmal_port_parameter_set_uint32(<a class="code" href="libavcodec_2dfa_8c.html#a837d39f8b74c379be96e07fe99664ca3">decoder</a>-&gt;input[0], MMAL_PARAMETER_VIDEO_MAX_NUM_CALLBACKS,</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;                                       -1 - <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;extra_decoder_buffers)) {</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;        <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga85b57516ca703cc47d9bbe5f4658c716">AV_LOG_WARNING</a>, <span class="stringliteral">&quot;Could not set input buffering limit.\n&quot;</span>);</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    }</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160; </div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;    <span class="keywordflow">if</span> ((<a class="code" href="filter__design_8txt.html#ad6a339ae538717b3e99082a8016207df">status</a> = mmal_port_format_commit(<a class="code" href="libavcodec_2dfa_8c.html#a837d39f8b74c379be96e07fe99664ca3">decoder</a>-&gt;input[0])))</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160; </div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;    <a class="code" href="libavcodec_2dfa_8c.html#a837d39f8b74c379be96e07fe99664ca3">decoder</a>-&gt;input[0]-&gt;buffer_num =</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;        <a class="code" href="common_8h.html#a9960bd6780a9b16a216a57be1ee04359">FFMAX</a>(<a class="code" href="libavcodec_2dfa_8c.html#a837d39f8b74c379be96e07fe99664ca3">decoder</a>-&gt;input[0]-&gt;buffer_num_min, 20);</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;    <a class="code" href="libavcodec_2dfa_8c.html#a837d39f8b74c379be96e07fe99664ca3">decoder</a>-&gt;input[0]-&gt;buffer_size =</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;        <a class="code" href="common_8h.html#a9960bd6780a9b16a216a57be1ee04359">FFMAX</a>(<a class="code" href="libavcodec_2dfa_8c.html#a837d39f8b74c379be96e07fe99664ca3">decoder</a>-&gt;input[0]-&gt;buffer_size_min, 512 * 1024);</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;pool_in = mmal_pool_create(<a class="code" href="libavcodec_2dfa_8c.html#a837d39f8b74c379be96e07fe99664ca3">decoder</a>-&gt;input[0]-&gt;buffer_num, 0);</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;pool_in) {</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;        <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    }</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160; </div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    <span class="keywordflow">if</span> ((<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = <a class="code" href="mmaldec_8c.html#a24f7526ac8c3e7cf127c21bcef8ffd43">ffmal_update_format</a>(avctx)) &lt; 0)</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160; </div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;queue_decoded_frames = mmal_queue_create();</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;queue_decoded_frames)</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160; </div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    <a class="code" href="libavcodec_2dfa_8c.html#a837d39f8b74c379be96e07fe99664ca3">decoder</a>-&gt;input[0]-&gt;userdata = (<span class="keywordtype">void</span>*)avctx;</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    <a class="code" href="libavcodec_2dfa_8c.html#a837d39f8b74c379be96e07fe99664ca3">decoder</a>-&gt;output[0]-&gt;userdata = (<span class="keywordtype">void</span>*)avctx;</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    <a class="code" href="libavcodec_2dfa_8c.html#a837d39f8b74c379be96e07fe99664ca3">decoder</a>-&gt;control-&gt;userdata = (<span class="keywordtype">void</span>*)avctx;</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160; </div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    <span class="keywordflow">if</span> ((<a class="code" href="filter__design_8txt.html#ad6a339ae538717b3e99082a8016207df">status</a> = mmal_port_enable(<a class="code" href="libavcodec_2dfa_8c.html#a837d39f8b74c379be96e07fe99664ca3">decoder</a>-&gt;control, <a class="code" href="mmaldec_8c.html#aeee0f01c1d41873152888d3b1a0e2ef2">control_port_cb</a>)))</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    <span class="keywordflow">if</span> ((<a class="code" href="filter__design_8txt.html#ad6a339ae538717b3e99082a8016207df">status</a> = mmal_port_enable(<a class="code" href="libavcodec_2dfa_8c.html#a837d39f8b74c379be96e07fe99664ca3">decoder</a>-&gt;input[0], <a class="code" href="mmaldec_8c.html#a50b28ae8c033ca7cae2dd18201208586">input_callback</a>)))</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    <span class="keywordflow">if</span> ((<a class="code" href="filter__design_8txt.html#ad6a339ae538717b3e99082a8016207df">status</a> = mmal_port_enable(<a class="code" href="libavcodec_2dfa_8c.html#a837d39f8b74c379be96e07fe99664ca3">decoder</a>-&gt;output[0], <a class="code" href="mmaldec_8c.html#a3d5c64c42cccf38d29eedfff2b8cf977">output_callback</a>)))</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160; </div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;    <span class="keywordflow">if</span> ((<a class="code" href="filter__design_8txt.html#ad6a339ae538717b3e99082a8016207df">status</a> = mmal_component_enable(<a class="code" href="libavcodec_2dfa_8c.html#a837d39f8b74c379be96e07fe99664ca3">decoder</a>)))</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160; </div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160; </div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;<a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>:</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    <a class="code" href="mmaldec_8c.html#a1d740192498a2fb7b1047ba1e9d193f9">ffmmal_close_decoder</a>(avctx);</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> &lt; 0 ? <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> : <a class="code" href="group__lavu__error.html#ga4ebaa288c7684a26a591c501208910e4">AVERROR_UNKNOWN</a>;</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;}</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160; </div>
<div class="line"><a name="l00453"></a><span class="lineno"><a class="line" href="mmaldec_8c.html#aa106de1b77eb2dd4a48719d0dc09d46c">  453</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="mmaldec_8c.html#aa106de1b77eb2dd4a48719d0dc09d46c">ffmmal_flush</a>(<a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a> *avctx)</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;{</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    <a class="code" href="struct_m_m_a_l_decode_context.html">MMALDecodeContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a> = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#af3379123060ad8cc9c321c29af4f8360">priv_data</a>;</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;    MMAL_COMPONENT_T *<a class="code" href="libavcodec_2dfa_8c.html#a837d39f8b74c379be96e07fe99664ca3">decoder</a> = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;decoder;</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;    MMAL_STATUS_T <a class="code" href="filter__design_8txt.html#ad6a339ae538717b3e99082a8016207df">status</a>;</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160; </div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;    <a class="code" href="mmaldec_8c.html#a947f3567c81c3171bc8664828f9775dc">ffmmal_stop_decoder</a>(avctx);</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160; </div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;    <span class="keywordflow">if</span> ((<a class="code" href="filter__design_8txt.html#ad6a339ae538717b3e99082a8016207df">status</a> = mmal_port_enable(<a class="code" href="libavcodec_2dfa_8c.html#a837d39f8b74c379be96e07fe99664ca3">decoder</a>-&gt;control, <a class="code" href="mmaldec_8c.html#aeee0f01c1d41873152888d3b1a0e2ef2">control_port_cb</a>)))</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    <span class="keywordflow">if</span> ((<a class="code" href="filter__design_8txt.html#ad6a339ae538717b3e99082a8016207df">status</a> = mmal_port_enable(<a class="code" href="libavcodec_2dfa_8c.html#a837d39f8b74c379be96e07fe99664ca3">decoder</a>-&gt;input[0], <a class="code" href="mmaldec_8c.html#a50b28ae8c033ca7cae2dd18201208586">input_callback</a>)))</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;    <span class="keywordflow">if</span> ((<a class="code" href="filter__design_8txt.html#ad6a339ae538717b3e99082a8016207df">status</a> = mmal_port_enable(<a class="code" href="libavcodec_2dfa_8c.html#a837d39f8b74c379be96e07fe99664ca3">decoder</a>-&gt;output[0], <a class="code" href="mmaldec_8c.html#a3d5c64c42cccf38d29eedfff2b8cf977">output_callback</a>)))</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>;</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160; </div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160; </div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;<a class="code" href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a>:</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;MMAL flush error: %i\n&quot;</span>, (<span class="keywordtype">int</span>)<a class="code" href="filter__design_8txt.html#ad6a339ae538717b3e99082a8016207df">status</a>);</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;}</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160; </div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;<span class="comment">// Split packets and add them to the waiting_buffers list. We don&#39;t queue them</span></div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;<span class="comment">// immediately, because it can happen that the decoder is temporarily blocked</span></div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;<span class="comment">// (due to us not reading/returning enough output buffers) and won&#39;t accept</span></div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;<span class="comment">// new input. (This wouldn&#39;t be an issue if MMAL input buffers always were</span></div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;<span class="comment">// complete frames - then the input buffer just would have to be big enough.)</span></div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;<span class="comment">// If is_extradata is set, send it as MMAL_BUFFER_HEADER_FLAG_CONFIG.</span></div>
<div class="line"><a name="l00480"></a><span class="lineno"><a class="line" href="mmaldec_8c.html#adfa31ee009f58dca258522c04385e048">  480</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="mmaldec_8c.html#adfa31ee009f58dca258522c04385e048">ffmmal_add_packet</a>(<a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a> *avctx, <a class="code" href="struct_a_v_packet.html">AVPacket</a> *avpkt,</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;                             <span class="keywordtype">int</span> is_extradata)</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;{</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;    <a class="code" href="struct_m_m_a_l_decode_context.html">MMALDecodeContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a> = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#af3379123060ad8cc9c321c29af4f8360">priv_data</a>;</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;    <a class="code" href="struct_a_v_buffer_ref.html">AVBufferRef</a> *buf = <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="group__lavu__mem__funcs.html#ga34e10fdac079a9ca4512b8ccd7f20b8a">size</a> = 0;</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;    <a class="code" href="audio__convert_8c.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> *<a class="code" href="mxf_8c.html#a084824fc871e38157790c99ae1240842">data</a> = (<a class="code" href="audio__convert_8c.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> *)<span class="stringliteral">&quot;&quot;</span>;</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;    <a class="code" href="audio__convert_8c.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> *start;</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = 0;</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160; </div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    <span class="keywordflow">if</span> (avpkt-&gt;<a class="code" href="struct_a_v_packet.html#a4d1ea19f63eb107111fd650ca514d1f4">size</a>) {</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;        <span class="keywordflow">if</span> (avpkt-&gt;<a class="code" href="struct_a_v_packet.html#a3bf81872813551fe9343dd0e09993e38">buf</a>) {</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;            buf = <a class="code" href="group__lavu__buffer.html#gaa40ce7d3ede946a89d03323bbd7268c1">av_buffer_ref</a>(avpkt-&gt;<a class="code" href="struct_a_v_packet.html#a3bf81872813551fe9343dd0e09993e38">buf</a>);</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;            <a class="code" href="group__lavu__mem__funcs.html#ga34e10fdac079a9ca4512b8ccd7f20b8a">size</a> = avpkt-&gt;<a class="code" href="struct_a_v_packet.html#a4d1ea19f63eb107111fd650ca514d1f4">size</a>;</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;            <a class="code" href="mxf_8c.html#a084824fc871e38157790c99ae1240842">data</a> = avpkt-&gt;<a class="code" href="struct_a_v_packet.html#aaf4fe58dfcc7c232c1f2268b539d8367">data</a>;</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;            buf = <a class="code" href="group__lavu__buffer.html#ga5ae84ac902283dea1a660ede06c1cdac">av_buffer_alloc</a>(avpkt-&gt;<a class="code" href="struct_a_v_packet.html#a4d1ea19f63eb107111fd650ca514d1f4">size</a>);</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;            <span class="keywordflow">if</span> (buf) {</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;                memcpy(buf-&gt;<a class="code" href="struct_a_v_buffer_ref.html#acb8452e99cd75074b93800b532c6ea4b">data</a>, avpkt-&gt;<a class="code" href="struct_a_v_packet.html#aaf4fe58dfcc7c232c1f2268b539d8367">data</a>, avpkt-&gt;<a class="code" href="struct_a_v_packet.html#a4d1ea19f63eb107111fd650ca514d1f4">size</a>);</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;                <a class="code" href="group__lavu__mem__funcs.html#ga34e10fdac079a9ca4512b8ccd7f20b8a">size</a> = buf-&gt;<a class="code" href="struct_a_v_buffer_ref.html#a55f17b82a5af97259a5e8a3fd9647a08">size</a>;</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;                <a class="code" href="mxf_8c.html#a084824fc871e38157790c99ae1240842">data</a> = buf-&gt;<a class="code" href="struct_a_v_buffer_ref.html#acb8452e99cd75074b93800b532c6ea4b">data</a>;</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;            }</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;        }</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;        <span class="keywordflow">if</span> (!buf) {</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;            <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;            <span class="keywordflow">goto</span> done;</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;        }</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;        <span class="keywordflow">if</span> (!is_extradata)</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;            <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;packets_sent++;</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;eos_sent)</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;            <span class="keywordflow">goto</span> done;</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;packets_sent) {</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;            <span class="comment">// Short-cut the flush logic to avoid upsetting MMAL.</span></div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;            <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;eos_sent = 1;</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;            <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;eos_received = 1;</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;            <span class="keywordflow">goto</span> done;</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;        }</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;    }</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160; </div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    start = <a class="code" href="mxf_8c.html#a084824fc871e38157790c99ae1240842">data</a>;</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160; </div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;    <span class="keywordflow">do</span> {</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;        <a class="code" href="struct_f_f_buffer_entry.html">FFBufferEntry</a> *<a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a> = <a class="code" href="group__lavu__mem__funcs.html#gaf143ecab33a3868b57345466c39de7c1">av_mallocz</a>(<span class="keyword">sizeof</span>(*<a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a>));</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a>) {</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;            <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;            <span class="keywordflow">goto</span> done;</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;        }</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160; </div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;        <a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a>-&gt;<a class="code" href="struct_a_v_frame.html#a1d0f65014a8d1bf78cec8cbed2304992">data</a> = <a class="code" href="mxf_8c.html#a084824fc871e38157790c99ae1240842">data</a>;</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;        <a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a>-&gt;length = <a class="code" href="common_8h.html#a0f84cbd7fd810cd678157c98cbfad4b0">FFMIN</a>(<a class="code" href="group__lavu__mem__funcs.html#ga34e10fdac079a9ca4512b8ccd7f20b8a">size</a>, <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;decoder-&gt;input[0]-&gt;buffer_size);</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160; </div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;        <span class="keywordflow">if</span> (is_extradata)</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;            <a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a>-&gt;<a class="code" href="struct_a_v_frame.html#a49020cc320b8fb1f5449167b6c97515b">flags</a> |= MMAL_BUFFER_HEADER_FLAG_CONFIG;</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160; </div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="mxf_8c.html#a084824fc871e38157790c99ae1240842">data</a> == start)</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;            <a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a>-&gt;<a class="code" href="struct_a_v_frame.html#a49020cc320b8fb1f5449167b6c97515b">flags</a> |= MMAL_BUFFER_HEADER_FLAG_FRAME_START;</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160; </div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;        <a class="code" href="mxf_8c.html#a084824fc871e38157790c99ae1240842">data</a> += <a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a>-&gt;length;</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;        <a class="code" href="group__lavu__mem__funcs.html#ga34e10fdac079a9ca4512b8ccd7f20b8a">size</a> -= <a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a>-&gt;length;</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160; </div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;        <a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a>-&gt;<a class="code" href="struct_a_v_frame.html#a0452833e3ab6ddd7acbf82817a7818a4">pts</a> = avpkt-&gt;<a class="code" href="struct_a_v_packet.html#a73bde0a37f3b1efc839f11295bfbf42a">pts</a> == <a class="code" href="group__lavu__time.html#ga2eaefe702f95f619ea6f2d08afa01be1">AV_NOPTS_VALUE</a> ? MMAL_TIME_UNKNOWN : avpkt-&gt;<a class="code" href="struct_a_v_packet.html#a73bde0a37f3b1efc839f11295bfbf42a">pts</a>;</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;        <a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a>-&gt;dts = avpkt-&gt;<a class="code" href="struct_a_v_packet.html#a85dbbd306b44b02390cd91c45e6a0f76">dts</a> == <a class="code" href="group__lavu__time.html#ga2eaefe702f95f619ea6f2d08afa01be1">AV_NOPTS_VALUE</a> ? MMAL_TIME_UNKNOWN : avpkt-&gt;<a class="code" href="struct_a_v_packet.html#a85dbbd306b44b02390cd91c45e6a0f76">dts</a>;</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160; </div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="group__lavu__mem__funcs.html#ga34e10fdac079a9ca4512b8ccd7f20b8a">size</a>) {</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;            <a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a>-&gt;<a class="code" href="struct_a_v_frame.html#a49020cc320b8fb1f5449167b6c97515b">flags</a> |= MMAL_BUFFER_HEADER_FLAG_FRAME_END;</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;            <a class="code" href="gcc_2stdatomic_8h.html#aedf6fb62e0fc9e8f8cf2e3685f0a1e88">atomic_fetch_add</a>(&amp;<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;packets_buffered, 1);</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;        }</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160; </div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a>-&gt;length) {</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;            <a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a>-&gt;<a class="code" href="struct_a_v_frame.html#a49020cc320b8fb1f5449167b6c97515b">flags</a> |= MMAL_BUFFER_HEADER_FLAG_EOS;</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;            <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;eos_sent = 1;</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;        }</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160; </div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;        <span class="keywordflow">if</span> (buf) {</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;            <a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a>-&gt;ref = <a class="code" href="group__lavu__buffer.html#gaa40ce7d3ede946a89d03323bbd7268c1">av_buffer_ref</a>(buf);</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;            <span class="keywordflow">if</span> (!<a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a>-&gt;ref) {</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;                <a class="code" href="tableprint__vlc_8h.html#a079eab092887563f2bef9106c6120089">av_free</a>(<a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a>);</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;                <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = <a class="code" href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a>(ENOMEM);</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;                <span class="keywordflow">goto</span> done;</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;            }</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;        }</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160; </div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;        <span class="comment">// Insert at end of the list</span></div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;waiting_buffers)</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;            <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;waiting_buffers = <a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a>;</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;waiting_buffers_tail)</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;            <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;waiting_buffers_tail-&gt;next = <a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a>;</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;waiting_buffers_tail = <a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a>;</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;    } <span class="keywordflow">while</span> (<a class="code" href="group__lavu__mem__funcs.html#ga34e10fdac079a9ca4512b8ccd7f20b8a">size</a>);</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160; </div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;done:</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;    <a class="code" href="group__lavu__buffer.html#ga135e9e929b5033bb8f68322497b2effc">av_buffer_unref</a>(&amp;buf);</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>;</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;}</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160; </div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;<span class="comment">// Move prepared/split packets from waiting_buffers to the MMAL decoder.</span></div>
<div class="line"><a name="l00577"></a><span class="lineno"><a class="line" href="mmaldec_8c.html#a1dcfb9e54a319b8f82b9ee6cb3b6c0cb">  577</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="mmaldec_8c.html#a1dcfb9e54a319b8f82b9ee6cb3b6c0cb">ffmmal_fill_input_port</a>(<a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a> *avctx)</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;{</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;    <a class="code" href="struct_m_m_a_l_decode_context.html">MMALDecodeContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a> = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#af3379123060ad8cc9c321c29af4f8360">priv_data</a>;</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160; </div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;    <span class="keywordflow">while</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;waiting_buffers) {</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;        MMAL_BUFFER_HEADER_T *mbuffer;</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;        <a class="code" href="struct_f_f_buffer_entry.html">FFBufferEntry</a> *<a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a>;</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;        MMAL_STATUS_T <a class="code" href="filter__design_8txt.html#ad6a339ae538717b3e99082a8016207df">status</a>;</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160; </div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;        mbuffer = mmal_queue_get(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;pool_in-&gt;queue);</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;        <span class="keywordflow">if</span> (!mbuffer)</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;            <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160; </div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;        <a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a> = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;waiting_buffers;</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160; </div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;        mmal_buffer_header_reset(mbuffer);</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;        mbuffer-&gt;cmd = 0;</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;        mbuffer-&gt;pts = <a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a>-&gt;<a class="code" href="struct_a_v_frame.html#a0452833e3ab6ddd7acbf82817a7818a4">pts</a>;</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;        mbuffer-&gt;dts = <a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a>-&gt;dts;</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;        mbuffer-&gt;<a class="code" href="struct_a_v_frame.html#a49020cc320b8fb1f5449167b6c97515b">flags</a> = <a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a>-&gt;<a class="code" href="struct_a_v_frame.html#a49020cc320b8fb1f5449167b6c97515b">flags</a>;</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;        mbuffer-&gt;data = <a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a>-&gt;<a class="code" href="struct_a_v_frame.html#a1d0f65014a8d1bf78cec8cbed2304992">data</a>;</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;        mbuffer-&gt;length = <a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a>-&gt;length;</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;        mbuffer-&gt;user_data = <a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a>;</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;        mbuffer-&gt;alloc_size = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;decoder-&gt;input[0]-&gt;buffer_size;</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160; </div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;        <span class="comment">// Remove from start of the list</span></div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;waiting_buffers = <a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a>-&gt;next;</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;waiting_buffers_tail == <a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a>)</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;            <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;waiting_buffers_tail = <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160; </div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;        <span class="keywordflow">if</span> ((<a class="code" href="filter__design_8txt.html#ad6a339ae538717b3e99082a8016207df">status</a> = mmal_port_send_buffer(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;decoder-&gt;input[0], mbuffer))) {</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;            mmal_buffer_header_release(mbuffer);</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;            <a class="code" href="group__lavu__buffer.html#ga135e9e929b5033bb8f68322497b2effc">av_buffer_unref</a>(&amp;<a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a>-&gt;ref);</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a>-&gt;<a class="code" href="struct_a_v_frame.html#a49020cc320b8fb1f5449167b6c97515b">flags</a> &amp; MMAL_BUFFER_HEADER_FLAG_FRAME_END)</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;                <a class="code" href="gcc_2stdatomic_8h.html#aedf6fb62e0fc9e8f8cf2e3685f0a1e88">atomic_fetch_add</a>(&amp;<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;packets_buffered, -1);</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#a079eab092887563f2bef9106c6120089">av_free</a>(<a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a>);</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;        }</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160; </div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="filter__design_8txt.html#ad6a339ae538717b3e99082a8016207df">status</a>) {</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;MMAL error %d when sending input\n&quot;</span>, (<span class="keywordtype">int</span>)<a class="code" href="filter__design_8txt.html#ad6a339ae538717b3e99082a8016207df">status</a>);</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="group__lavu__error.html#ga4ebaa288c7684a26a591c501208910e4">AVERROR_UNKNOWN</a>;</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;        }</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;    }</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160; </div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;}</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160; </div>
<div class="line"><a name="l00624"></a><span class="lineno"><a class="line" href="mmaldec_8c.html#a5b63948bbe5f0044b14bb186c01afe5c">  624</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="mmaldec_8c.html#a5b63948bbe5f0044b14bb186c01afe5c">ffmal_copy_frame</a>(<a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a> *avctx,  <a class="code" href="struct_a_v_frame.html">AVFrame</a> *<a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>,</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;                            MMAL_BUFFER_HEADER_T *<a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a>)</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;{</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;    <a class="code" href="struct_m_m_a_l_decode_context.html">MMALDecodeContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a> = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#af3379123060ad8cc9c321c29af4f8360">priv_data</a>;</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = 0;</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160; </div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;    <a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>-&gt;interlaced_frame = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;interlaced_frame;</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;    <a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>-&gt;top_field_first = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;top_field_first;</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160; </div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;    <span class="keywordflow">if</span> (avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a0425c77b3d06d71e5db88b1d7e1b37f2">pix_fmt</a> == <a class="code" href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a6beaeafbe680583bb65578bbdbf0973e">AV_PIX_FMT_MMAL</a>) {</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;pool_out)</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="group__lavu__error.html#ga4ebaa288c7684a26a591c501208910e4">AVERROR_UNKNOWN</a>; <span class="comment">// format change code failed with OOM previously</span></div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160; </div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;        <span class="keywordflow">if</span> ((<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = <a class="code" href="decode_8c.html#a227b4a5329003bed45b8bdf0a4e370a1">ff_decode_frame_props</a>(avctx, <a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>)) &lt; 0)</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;            <span class="keywordflow">goto</span> done;</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160; </div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;        <span class="keywordflow">if</span> ((<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = <a class="code" href="mmaldec_8c.html#a52311afa50d61c5b84c4ff410be1d8ad">ffmmal_set_ref</a>(<a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>, <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;pool_out, <a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a>)) &lt; 0)</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;            <span class="keywordflow">goto</span> done;</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;        <span class="keywordtype">int</span> <a class="code" href="llviddspenc_8c.html#aba9ed0487b0aa23eba534648df8384c0">w</a> = <a class="code" href="macros_8h.html#acae4ba605b3a7d535b7ac058ffe96892">FFALIGN</a>(avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a0d8f46461754e8abea0847dcbc41b956">width</a>, 32);</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;        <span class="keywordtype">int</span> <a class="code" href="vp9dsp__template_8c.html#a5e36941b3d856737e81516acd45edc50">h</a> = <a class="code" href="macros_8h.html#acae4ba605b3a7d535b7ac058ffe96892">FFALIGN</a>(avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a0449afd803eb107bd4dbc8b5ea22e363">height</a>, 16);</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;        <a class="code" href="audio__convert_8c.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> *<a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>[4];</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;        <span class="keywordtype">int</span> linesize[4];</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160; </div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;        <span class="keywordflow">if</span> ((<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = <a class="code" href="decode_8c.html#a0d5adb2b84051826883605b3ab4d1bab">ff_get_buffer</a>(avctx, <a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>, 0)) &lt; 0)</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;            <span class="keywordflow">goto</span> done;</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160; </div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;        <a class="code" href="group__lavu__picture.html#ga5b6ead346a70342ae8a303c16d2b3629">av_image_fill_arrays</a>(<a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>, linesize,</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;                             <a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a>-&gt;<a class="code" href="struct_a_v_frame.html#a1d0f65014a8d1bf78cec8cbed2304992">data</a> + <a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a>-&gt;type-&gt;video.offset[0],</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;                             avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a0425c77b3d06d71e5db88b1d7e1b37f2">pix_fmt</a>, <a class="code" href="llviddspenc_8c.html#aba9ed0487b0aa23eba534648df8384c0">w</a>, <a class="code" href="vp9dsp__template_8c.html#a5e36941b3d856737e81516acd45edc50">h</a>, 1);</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;        <a class="code" href="group__lavu__picture.html#ga6b5a267e202daadf81cbde6584055d1e">av_image_copy</a>(<a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>-&gt;data, <a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>-&gt;linesize, <a class="code" href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a>, linesize,</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;                      avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a0425c77b3d06d71e5db88b1d7e1b37f2">pix_fmt</a>, avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a0d8f46461754e8abea0847dcbc41b956">width</a>, avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#a0449afd803eb107bd4dbc8b5ea22e363">height</a>);</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;    }</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160; </div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;    <a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>-&gt;pts = <a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a>-&gt;<a class="code" href="struct_a_v_frame.html#a0452833e3ab6ddd7acbf82817a7818a4">pts</a> == MMAL_TIME_UNKNOWN ? <a class="code" href="group__lavu__time.html#ga2eaefe702f95f619ea6f2d08afa01be1">AV_NOPTS_VALUE</a> : <a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a>-&gt;<a class="code" href="struct_a_v_frame.html#a0452833e3ab6ddd7acbf82817a7818a4">pts</a>;</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;<span class="preprocessor">#if FF_API_PKT_PTS</span></div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;<a class="code" href="libavutil_2internal_8h.html#a5837cafc419c2b5ecdb1dfa330675d13">FF_DISABLE_DEPRECATION_WARNINGS</a></div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;    <a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>-&gt;pkt_pts = <a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>-&gt;pts;</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;<a class="code" href="libavutil_2internal_8h.html#aa6ef004d10669ab4ee062367a014ea33">FF_ENABLE_DEPRECATION_WARNINGS</a></div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;    <a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>-&gt;pkt_dts = <a class="code" href="group__lavu__time.html#ga2eaefe702f95f619ea6f2d08afa01be1">AV_NOPTS_VALUE</a>;</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160; </div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;done:</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>;</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;}</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160; </div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;<span class="comment">// Fetch a decoded buffer and place it into the frame parameter.</span></div>
<div class="line"><a name="l00671"></a><span class="lineno"><a class="line" href="mmaldec_8c.html#a9a7a9f5407a09ebced0f0222ac3e92d1">  671</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="mmaldec_8c.html#a9a7a9f5407a09ebced0f0222ac3e92d1">ffmmal_read_frame</a>(<a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a> *avctx, <a class="code" href="struct_a_v_frame.html">AVFrame</a> *<a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>, <span class="keywordtype">int</span> *got_frame)</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;{</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;    <a class="code" href="struct_m_m_a_l_decode_context.html">MMALDecodeContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a> = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#af3379123060ad8cc9c321c29af4f8360">priv_data</a>;</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;    MMAL_BUFFER_HEADER_T *<a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a> = <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;    MMAL_STATUS_T <a class="code" href="filter__design_8txt.html#ad6a339ae538717b3e99082a8016207df">status</a> = 0;</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = 0;</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160; </div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;eos_received)</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;        <span class="keywordflow">goto</span> done;</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160; </div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;    <span class="keywordflow">while</span> (1) {</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;        <span class="comment">// To ensure decoding in lockstep with a constant delay between fed packets</span></div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;        <span class="comment">// and output frames, we always wait until an output buffer is available.</span></div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;        <span class="comment">// Except during start we don&#39;t know after how many input packets the decoder</span></div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;        <span class="comment">// is going to return the first buffer, and we can&#39;t distinguish decoder</span></div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;        <span class="comment">// being busy from decoder waiting for input. So just poll at the start and</span></div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;        <span class="comment">// keep feeding new data to the buffer.</span></div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;        <span class="comment">// We are pretty sure the decoder will produce output if we sent more input</span></div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;        <span class="comment">// frames than what a H.264 decoder could logically delay. This avoids too</span></div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;        <span class="comment">// excessive buffering.</span></div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;        <span class="comment">// We also wait if we sent eos, but didn&#39;t receive it yet (think of decoding</span></div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;        <span class="comment">// stream with a very low number of frames).</span></div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="dummy_2stdatomic_8h.html#acced2a78b2a440317feed51f3e505d1d">atomic_load</a>(&amp;<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;packets_buffered) &gt; <a class="code" href="mmaldec_8c.html#a56be75a71b6b6abecc97433dec143493">MAX_DELAYED_FRAMES</a> ||</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;            (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;packets_sent &amp;&amp; <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;eos_sent)) {</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;            <span class="comment">// MMAL will ignore broken input packets, which means the frame we</span></div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;            <span class="comment">// expect here may never arrive. Dealing with this correctly is</span></div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;            <span class="comment">// complicated, so here&#39;s a hack to avoid that it freezes forever</span></div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;            <span class="comment">// in this unlikely situation.</span></div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;            <a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a> = mmal_queue_timedwait(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;queue_decoded_frames, 100);</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;            <span class="keywordflow">if</span> (!<a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a>) {</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;                <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a>, <span class="stringliteral">&quot;Did not get output frame from MMAL.\n&quot;</span>);</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;                <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = <a class="code" href="group__lavu__error.html#ga4ebaa288c7684a26a591c501208910e4">AVERROR_UNKNOWN</a>;</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;                <span class="keywordflow">goto</span> done;</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;            }</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;            <a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a> = mmal_queue_get(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;queue_decoded_frames);</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;            <span class="keywordflow">if</span> (!<a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a>)</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;                <span class="keywordflow">goto</span> done;</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;        }</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160; </div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;eos_received |= !!(<a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a>-&gt;<a class="code" href="struct_a_v_frame.html#a49020cc320b8fb1f5449167b6c97515b">flags</a> &amp; MMAL_BUFFER_HEADER_FLAG_EOS);</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;eos_received)</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;            <span class="keywordflow">goto</span> done;</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160; </div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a>-&gt;cmd == MMAL_EVENT_FORMAT_CHANGED) {</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;            MMAL_COMPONENT_T *<a class="code" href="libavcodec_2dfa_8c.html#a837d39f8b74c379be96e07fe99664ca3">decoder</a> = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;decoder;</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;            MMAL_EVENT_FORMAT_CHANGED_T *ev = mmal_event_format_changed_get(<a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a>);</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;            MMAL_BUFFER_HEADER_T *stale_buffer;</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160; </div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#gad172eacfed8653e454c6fdcbe53baab3">AV_LOG_INFO</a>, <span class="stringliteral">&quot;Changing output format.\n&quot;</span>);</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160; </div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;            <span class="keywordflow">if</span> ((<a class="code" href="filter__design_8txt.html#ad6a339ae538717b3e99082a8016207df">status</a> = mmal_port_disable(<a class="code" href="libavcodec_2dfa_8c.html#a837d39f8b74c379be96e07fe99664ca3">decoder</a>-&gt;output[0])))</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;                <span class="keywordflow">goto</span> done;</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160; </div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;            <span class="keywordflow">while</span> ((stale_buffer = mmal_queue_get(<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;queue_decoded_frames)))</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;                mmal_buffer_header_release(stale_buffer);</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160; </div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;            mmal_format_copy(<a class="code" href="libavcodec_2dfa_8c.html#a837d39f8b74c379be96e07fe99664ca3">decoder</a>-&gt;output[0]-&gt;format, ev-&gt;format);</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160; </div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;            <span class="keywordflow">if</span> ((<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = <a class="code" href="mmaldec_8c.html#a24f7526ac8c3e7cf127c21bcef8ffd43">ffmal_update_format</a>(avctx)) &lt; 0)</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;                <span class="keywordflow">goto</span> done;</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160; </div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;            <span class="keywordflow">if</span> ((<a class="code" href="filter__design_8txt.html#ad6a339ae538717b3e99082a8016207df">status</a> = mmal_port_enable(<a class="code" href="libavcodec_2dfa_8c.html#a837d39f8b74c379be96e07fe99664ca3">decoder</a>-&gt;output[0], <a class="code" href="mmaldec_8c.html#a3d5c64c42cccf38d29eedfff2b8cf977">output_callback</a>)))</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;                <span class="keywordflow">goto</span> done;</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160; </div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;            <span class="keywordflow">if</span> ((<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = <a class="code" href="mmaldec_8c.html#ae04e5817dd1faa79ca3741844abc2361">ffmmal_fill_output_port</a>(avctx)) &lt; 0)</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;                <span class="keywordflow">goto</span> done;</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160; </div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;            <span class="keywordflow">if</span> ((<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = <a class="code" href="mmaldec_8c.html#a1dcfb9e54a319b8f82b9ee6cb3b6c0cb">ffmmal_fill_input_port</a>(avctx)) &lt; 0)</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;                <span class="keywordflow">goto</span> done;</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160; </div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;            mmal_buffer_header_release(<a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a>);</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a>-&gt;cmd) {</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;            <a class="code" href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a>(avctx, <a class="code" href="group__lavu__log__constants.html#ga85b57516ca703cc47d9bbe5f4658c716">AV_LOG_WARNING</a>, <span class="stringliteral">&quot;Unknown MMAL event %s on output port\n&quot;</span>,</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;                   <a class="code" href="group__lavu__misc.html#gae07d7cbf511060210152a89ad0d137ad">av_fourcc2str</a>(<a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a>-&gt;cmd));</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;            <span class="keywordflow">goto</span> done;</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a>-&gt;length == 0) {</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;            <span class="comment">// Unused output buffer that got drained after format change.</span></div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;            mmal_buffer_header_release(<a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a>);</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;        }</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160; </div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;frames_output++;</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160; </div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;        <span class="keywordflow">if</span> ((<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = <a class="code" href="mmaldec_8c.html#a5b63948bbe5f0044b14bb186c01afe5c">ffmal_copy_frame</a>(avctx, <a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>, <a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a>)) &lt; 0)</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;            <span class="keywordflow">goto</span> done;</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160; </div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;        *got_frame = 1;</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;    }</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160; </div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;done:</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a>)</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;        mmal_buffer_header_release(<a class="code" href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a>);</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="filter__design_8txt.html#ad6a339ae538717b3e99082a8016207df">status</a> &amp;&amp; <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> &gt;= 0)</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;        <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = <a class="code" href="group__lavu__error.html#ga4ebaa288c7684a26a591c501208910e4">AVERROR_UNKNOWN</a>;</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>;</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;}</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160; </div>
<div class="line"><a name="l00771"></a><span class="lineno"><a class="line" href="mmaldec_8c.html#a6dbec04a8cb2f6262e23dd6ad18b73b8">  771</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="mmaldec_8c.html#a6dbec04a8cb2f6262e23dd6ad18b73b8">ffmmal_decode</a>(<a class="code" href="struct_a_v_codec_context.html">AVCodecContext</a> *avctx, <span class="keywordtype">void</span> *<a class="code" href="mxf_8c.html#a084824fc871e38157790c99ae1240842">data</a>, <span class="keywordtype">int</span> *got_frame,</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;                         <a class="code" href="struct_a_v_packet.html">AVPacket</a> *avpkt)</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;{</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;    <a class="code" href="struct_m_m_a_l_decode_context.html">MMALDecodeContext</a> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a> = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#af3379123060ad8cc9c321c29af4f8360">priv_data</a>;</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;    <a class="code" href="struct_a_v_frame.html">AVFrame</a> *<a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a> = <a class="code" href="mxf_8c.html#a084824fc871e38157790c99ae1240842">data</a>;</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = 0;</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160; </div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;    <span class="keywordflow">if</span> (avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#ae246ca7a1c72c151891ed0599e8dbfba">extradata_size</a> &amp;&amp; !<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;extradata_sent) {</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;        <a class="code" href="struct_a_v_packet.html">AVPacket</a> <a class="code" href="demuxing__decoding_8c.html#a3d4c6562f0b27cf0cacbbea5c038c090">pkt</a> = {0};</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;        <a class="code" href="group__lavc__packet.html#gac9cb9756175b96e7441575803757fb73">av_init_packet</a>(&amp;<a class="code" href="demuxing__decoding_8c.html#a3d4c6562f0b27cf0cacbbea5c038c090">pkt</a>);</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;        <a class="code" href="demuxing__decoding_8c.html#a3d4c6562f0b27cf0cacbbea5c038c090">pkt</a>.<a class="code" href="struct_a_v_packet.html#aaf4fe58dfcc7c232c1f2268b539d8367">data</a> = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#abe964316aaaa61967b012efdcced79c4">extradata</a>;</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;        <a class="code" href="demuxing__decoding_8c.html#a3d4c6562f0b27cf0cacbbea5c038c090">pkt</a>.<a class="code" href="struct_a_v_packet.html#a4d1ea19f63eb107111fd650ca514d1f4">size</a> = avctx-&gt;<a class="code" href="struct_a_v_codec_context.html#ae246ca7a1c72c151891ed0599e8dbfba">extradata_size</a>;</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;        <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>-&gt;extradata_sent = 1;</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;        <span class="keywordflow">if</span> ((<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = <a class="code" href="mmaldec_8c.html#adfa31ee009f58dca258522c04385e048">ffmmal_add_packet</a>(avctx, &amp;<a class="code" href="demuxing__decoding_8c.html#a3d4c6562f0b27cf0cacbbea5c038c090">pkt</a>, 1)) &lt; 0)</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>;</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;    }</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160; </div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;    <span class="keywordflow">if</span> ((<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = <a class="code" href="mmaldec_8c.html#adfa31ee009f58dca258522c04385e048">ffmmal_add_packet</a>(avctx, avpkt, 0)) &lt; 0)</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>;</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160; </div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;    <span class="keywordflow">if</span> ((<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = <a class="code" href="mmaldec_8c.html#a1dcfb9e54a319b8f82b9ee6cb3b6c0cb">ffmmal_fill_input_port</a>(avctx)) &lt; 0)</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>;</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160; </div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;    <span class="keywordflow">if</span> ((<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = <a class="code" href="mmaldec_8c.html#ae04e5817dd1faa79ca3741844abc2361">ffmmal_fill_output_port</a>(avctx)) &lt; 0)</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>;</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160; </div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;    <span class="keywordflow">if</span> ((<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = <a class="code" href="mmaldec_8c.html#a9a7a9f5407a09ebced0f0222ac3e92d1">ffmmal_read_frame</a>(avctx, <a class="code" href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a>, got_frame)) &lt; 0)</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>;</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160; </div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;    <span class="comment">// ffmmal_read_frame() can block for a while. Since the decoder is</span></div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;    <span class="comment">// asynchronous, it&#39;s a good idea to fill the ports again.</span></div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160; </div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;    <span class="keywordflow">if</span> ((<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = <a class="code" href="mmaldec_8c.html#ae04e5817dd1faa79ca3741844abc2361">ffmmal_fill_output_port</a>(avctx)) &lt; 0)</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>;</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160; </div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;    <span class="keywordflow">if</span> ((<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = <a class="code" href="mmaldec_8c.html#a1dcfb9e54a319b8f82b9ee6cb3b6c0cb">ffmmal_fill_input_port</a>(avctx)) &lt; 0)</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>;</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160; </div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>;</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;}</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160; </div>
<div class="line"><a name="l00812"></a><span class="lineno"><a class="line" href="mmaldec_8c.html#a651e4f2729bcee8fc20ed0edc86a87f0">  812</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="struct_a_v_codec_h_w_config_internal.html">AVCodecHWConfigInternal</a> *<span class="keyword">const</span> <a class="code" href="mmaldec_8c.html#a651e4f2729bcee8fc20ed0edc86a87f0">mmal_hw_configs</a>[] = {</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;    <a class="code" href="hwconfig_8h.html#a5d9f407662ecff8b278a6a90da001797">HW_CONFIG_INTERNAL</a>(MMAL),</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;    <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;};</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160; </div>
<div class="line"><a name="l00817"></a><span class="lineno"><a class="line" href="mmaldec_8c.html#a384ff94b5139f441c282c9b4c7b985e6">  817</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="struct_a_v_option.html">AVOption</a> <a class="code" href="mmaldec_8c.html#a384ff94b5139f441c282c9b4c7b985e6">options</a>[]={</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;    {<span class="stringliteral">&quot;extra_buffers&quot;</span>, <span class="stringliteral">&quot;extra buffers&quot;</span>, offsetof(<a class="code" href="struct_m_m_a_l_decode_context.html">MMALDecodeContext</a>, extra_buffers), <a class="code" href="group__avoptions.html#ggabd75aa30eb8ad6387672df9a1fa79444ac068b8f6afeeb293a13aeabb5d702411">AV_OPT_TYPE_INT</a>, {.i64 = 10}, 0, 256, 0},</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;    {<span class="stringliteral">&quot;extra_decoder_buffers&quot;</span>, <span class="stringliteral">&quot;extra MMAL internal buffered frames&quot;</span>, offsetof(<a class="code" href="struct_m_m_a_l_decode_context.html">MMALDecodeContext</a>, extra_decoder_buffers), <a class="code" href="group__avoptions.html#ggabd75aa30eb8ad6387672df9a1fa79444ac068b8f6afeeb293a13aeabb5d702411">AV_OPT_TYPE_INT</a>, {.i64 = 10}, 0, 256, 0},</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;    {<a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>}</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;};</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160; </div>
<div class="line"><a name="l00823"></a><span class="lineno"><a class="line" href="mmaldec_8c.html#aa9f0133735f5c329b72f8ef5587defb5">  823</a></span>&#160;<span class="preprocessor">#define FFMMAL_DEC_CLASS(NAME) \</span></div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;<span class="preprocessor">    static const AVClass ffmmal_##NAME##_dec_class = { \</span></div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;<span class="preprocessor">        .class_name = &quot;mmal_&quot; #NAME &quot;_dec&quot;, \</span></div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;<span class="preprocessor">        .item_name  = av_default_item_name, \</span></div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;<span class="preprocessor">        .option     = options, \</span></div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;<span class="preprocessor">        .version    = LIBAVUTIL_VERSION_INT, \</span></div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;<span class="preprocessor">    };</span></div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160; </div>
<div class="line"><a name="l00831"></a><span class="lineno"><a class="line" href="mmaldec_8c.html#a4ac09c68763faee023cad4af2861729a">  831</a></span>&#160;<span class="preprocessor">#define FFMMAL_DEC(NAME, ID) \</span></div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;<span class="preprocessor">    FFMMAL_DEC_CLASS(NAME) \</span></div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;<span class="preprocessor">    AVCodec ff_##NAME##_mmal_decoder = { \</span></div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;<span class="preprocessor">        .name           = #NAME &quot;_mmal&quot;, \</span></div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;<span class="preprocessor">        .long_name      = NULL_IF_CONFIG_SMALL(#NAME &quot; (mmal)&quot;), \</span></div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;<span class="preprocessor">        .type           = AVMEDIA_TYPE_VIDEO, \</span></div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;<span class="preprocessor">        .id             = ID, \</span></div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;<span class="preprocessor">        .priv_data_size = sizeof(MMALDecodeContext), \</span></div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;<span class="preprocessor">        .init           = ffmmal_init_decoder, \</span></div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;<span class="preprocessor">        .close          = ffmmal_close_decoder, \</span></div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;<span class="preprocessor">        .decode         = ffmmal_decode, \</span></div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;<span class="preprocessor">        .flush          = ffmmal_flush, \</span></div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;<span class="preprocessor">        .priv_class     = &amp;ffmmal_##NAME##_dec_class, \</span></div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;<span class="preprocessor">        .capabilities   = AV_CODEC_CAP_DELAY | AV_CODEC_CAP_HARDWARE, \</span></div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;<span class="preprocessor">        .caps_internal  = FF_CODEC_CAP_SETS_PKT_DTS, \</span></div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;<span class="preprocessor">        .pix_fmts       = (const enum AVPixelFormat[]) { AV_PIX_FMT_MMAL, \</span></div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;<span class="preprocessor">                                                         AV_PIX_FMT_YUV420P, \</span></div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;<span class="preprocessor">                                                         AV_PIX_FMT_NONE}, \</span></div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;<span class="preprocessor">        .hw_configs     = mmal_hw_configs, \</span></div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;<span class="preprocessor">        .wrapper_name   = &quot;mmal&quot;, \</span></div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;<span class="preprocessor">    };</span></div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160; </div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;<a class="code" href="mmaldec_8c.html#a4ac09c68763faee023cad4af2861729a">FFMMAL_DEC</a>(h264, <a class="code" href="group__lavc__core.html#ggaadca229ad2c20e060a14fec08a5cc7cea3d4c051c8b18a3c18750676a308c10be">AV_CODEC_ID_H264</a>)</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;<a class="code" href="mmaldec_8c.html#a4ac09c68763faee023cad4af2861729a">FFMMAL_DEC</a>(mpeg2, <a class="code" href="group__lavc__core.html#ggaadca229ad2c20e060a14fec08a5cc7ceaf614abb36f7c5d0c42ed522c1d6c99f0">AV_CODEC_ID_MPEG2VIDEO</a>)</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;<a class="code" href="mmaldec_8c.html#a4ac09c68763faee023cad4af2861729a">FFMMAL_DEC</a>(mpeg4, <a class="code" href="group__lavc__core.html#ggaadca229ad2c20e060a14fec08a5cc7cead95dfdf68b462db508b45fb693a4c09e">AV_CODEC_ID_MPEG4</a>)</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;<a class="code" href="mmaldec_8c.html#a4ac09c68763faee023cad4af2861729a">FFMMAL_DEC</a>(vc1, <a class="code" href="group__lavc__core.html#ggaadca229ad2c20e060a14fec08a5cc7cea7765c5c02c05ea1a96ef1ca35dad068f">AV_CODEC_ID_VC1</a>)</div>
</div><!-- fragment --></div><!-- contents -->
<div class="ttc" id="ammaldec_8c_html_a4ac09c68763faee023cad4af2861729a"><div class="ttname"><a href="mmaldec_8c.html#a4ac09c68763faee023cad4af2861729a">FFMMAL_DEC</a></div><div class="ttdeci">#define FFMMAL_DEC(NAME, ID)</div><div class="ttdef"><b>Definition:</b> <a href="mmaldec_8c_source.html#l00831">mmaldec.c:831</a></div></div>
<div class="ttc" id="ahwconfig_8h_html"><div class="ttname"><a href="hwconfig_8h.html">hwconfig.h</a></div></div>
<div class="ttc" id="alibavutil_2internal_8h_html_aa6ef004d10669ab4ee062367a014ea33"><div class="ttname"><a href="libavutil_2internal_8h.html#aa6ef004d10669ab4ee062367a014ea33">FF_ENABLE_DEPRECATION_WARNINGS</a></div><div class="ttdeci">#define FF_ENABLE_DEPRECATION_WARNINGS</div><div class="ttdef"><b>Definition:</b> <a href="libavutil_2internal_8h_source.html#l00085">internal.h:85</a></div></div>
<div class="ttc" id="ammaldec_8c_html_a1dcfb9e54a319b8f82b9ee6cb3b6c0cb"><div class="ttname"><a href="mmaldec_8c.html#a1dcfb9e54a319b8f82b9ee6cb3b6c0cb">ffmmal_fill_input_port</a></div><div class="ttdeci">static int ffmmal_fill_input_port(AVCodecContext *avctx)</div><div class="ttdef"><b>Definition:</b> <a href="mmaldec_8c_source.html#l00577">mmaldec.c:577</a></div></div>
<div class="ttc" id="ammaldec_8c_html_a6dbec04a8cb2f6262e23dd6ad18b73b8"><div class="ttname"><a href="mmaldec_8c.html#a6dbec04a8cb2f6262e23dd6ad18b73b8">ffmmal_decode</a></div><div class="ttdeci">static int ffmmal_decode(AVCodecContext *avctx, void *data, int *got_frame, AVPacket *avpkt)</div><div class="ttdef"><b>Definition:</b> <a href="mmaldec_8c_source.html#l00771">mmaldec.c:771</a></div></div>
<div class="ttc" id="agroup__lavu__log__constants_html_ga85b57516ca703cc47d9bbe5f4658c716"><div class="ttname"><a href="group__lavu__log__constants.html#ga85b57516ca703cc47d9bbe5f4658c716">AV_LOG_WARNING</a></div><div class="ttdeci">#define AV_LOG_WARNING</div><div class="ttdef"><b>Definition:</b> <a href="log_8h_source.html#l00200">log.h:200</a></div></div>
<div class="ttc" id="astruct_a_v_codec_context_html"><div class="ttname"><a href="struct_a_v_codec_context.html">AVCodecContext</a></div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l00526">avcodec.h:526</a></div></div>
<div class="ttc" id="afilter__design_8txt_html_ad6a339ae538717b3e99082a8016207df"><div class="ttname"><a href="filter__design_8txt.html#ad6a339ae538717b3e99082a8016207df">status</a></div><div class="ttdeci">they must not be accessed directly The fifo field contains the frames that are queued in the input for processing by the filter The status_in and status_out fields contains the queued status(EOF or error) of the link</div></div>
<div class="ttc" id="agroup__lavu__buffer_html_ga5ae84ac902283dea1a660ede06c1cdac"><div class="ttname"><a href="group__lavu__buffer.html#ga5ae84ac902283dea1a660ede06c1cdac">av_buffer_alloc</a></div><div class="ttdeci">AVBufferRef * av_buffer_alloc(int size)</div><div class="ttdef"><b>Definition:</b> <a href="buffer_8c_source.html#l00067">buffer.c:67</a></div></div>
<div class="ttc" id="afilter__design_8txt_html_adf2fb515710d47541f7150ecd2950e76"><div class="ttname"><a href="filter__design_8txt.html#adf2fb515710d47541f7150ecd2950e76">AVERROR</a></div><div class="ttdeci">Filter the word frame indicates either a video frame or a group of audio as stored in an AVFrame structure Format for each input and each output the list of supported formats For video that means pixel format For audio that means channel sample they are references to shared objects When the negotiation mechanism computes the intersection of the formats supported at each end of a all references to both lists are replaced with a reference to the intersection And when a single format is eventually chosen for a link amongst the remaining all references to the list are updated That means that if a filter requires that its input and output have the same format amongst a supported all it has to do is use a reference to the same list of formats query_formats can leave some formats unset and return AVERROR(EAGAIN) to cause the negotiation mechanism toagain later. That can be used by filters with complex requirements to use the format negotiated on one link to set the formats supported on another. Frame references ownership and permissions</div></div>
<div class="ttc" id="aopt_8h_html"><div class="ttname"><a href="opt_8h.html">opt.h</a></div></div>
<div class="ttc" id="astruct_m_m_a_l_decode_context_html_ad4e62f8904514d8c5bad4d7e193d4f6e"><div class="ttname"><a href="struct_m_m_a_l_decode_context.html#ad4e62f8904514d8c5bad4d7e193d4f6e">MMALDecodeContext::pool_out</a></div><div class="ttdeci">FFPoolRef * pool_out</div><div class="ttdef"><b>Definition:</b> <a href="mmaldec_8c_source.html#l00077">mmaldec.c:77</a></div></div>
<div class="ttc" id="astruct_a_v_codec_context_html_a0449afd803eb107bd4dbc8b5ea22e363"><div class="ttname"><a href="struct_a_v_codec_context.html#a0449afd803eb107bd4dbc8b5ea22e363">AVCodecContext::height</a></div><div class="ttdeci">int height</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l00699">avcodec.h:699</a></div></div>
<div class="ttc" id="astruct_a_v_codec_context_html_adc5f65d6099fd8339c1580c091777223"><div class="ttname"><a href="struct_a_v_codec_context.html#adc5f65d6099fd8339c1580c091777223">AVCodecContext::codec_id</a></div><div class="ttdeci">enum AVCodecID codec_id</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l00535">avcodec.h:536</a></div></div>
<div class="ttc" id="adecode_8c_html_a8a7eadb05d8ea6f849a146035377ad1f"><div class="ttname"><a href="decode_8c.html#a8a7eadb05d8ea6f849a146035377ad1f">ff_get_format</a></div><div class="ttdeci">int ff_get_format(AVCodecContext *avctx, const enum AVPixelFormat *fmt)</div><div class="ttdef"><b>Definition:</b> <a href="decode_8c_source.html#l01299">decode.c:1299</a></div></div>
<div class="ttc" id="astruct_a_v_codec_context_html_af3379123060ad8cc9c321c29af4f8360"><div class="ttname"><a href="struct_a_v_codec_context.html#af3379123060ad8cc9c321c29af4f8360">AVCodecContext::priv_data</a></div><div class="ttdeci">void * priv_data</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l00553">avcodec.h:553</a></div></div>
<div class="ttc" id="astruct_a_v_buffer_ref_html_acb8452e99cd75074b93800b532c6ea4b"><div class="ttname"><a href="struct_a_v_buffer_ref.html#acb8452e99cd75074b93800b532c6ea4b">AVBufferRef::data</a></div><div class="ttdeci">uint8_t * data</div><div class="ttdef"><b>Definition:</b> <a href="buffer_8h_source.html#l00089">buffer.h:89</a></div></div>
<div class="ttc" id="apixfmt_8h_html_a9a8e335cf3be472042bc9f0cf80cd4c5a6beaeafbe680583bb65578bbdbf0973e"><div class="ttname"><a href="pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a6beaeafbe680583bb65578bbdbf0973e">AV_PIX_FMT_MMAL</a></div><div class="ttdeci">@ AV_PIX_FMT_MMAL</div><div class="ttdef"><b>Definition:</b> <a href="pixfmt_8h_source.html#l00227">pixfmt.h:227</a></div></div>
<div class="ttc" id="ammaldec_8c_html_ad37ff952feaf13ca3b3934f2344dbbf1"><div class="ttname"><a href="mmaldec_8c.html#ad37ff952feaf13ca3b3934f2344dbbf1">FFBufferEntry</a></div><div class="ttdeci">struct FFBufferEntry FFBufferEntry</div></div>
<div class="ttc" id="astruct_a_v_codec_h_w_config_internal_html"><div class="ttname"><a href="struct_a_v_codec_h_w_config_internal.html">AVCodecHWConfigInternal</a></div><div class="ttdef"><b>Definition:</b> <a href="hwconfig_8h_source.html#l00029">hwconfig.h:29</a></div></div>
<div class="ttc" id="agroup__lavc__core_html_ggaadca229ad2c20e060a14fec08a5cc7cead95dfdf68b462db508b45fb693a4c09e"><div class="ttname"><a href="group__lavc__core.html#ggaadca229ad2c20e060a14fec08a5cc7cead95dfdf68b462db508b45fb693a4c09e">AV_CODEC_ID_MPEG4</a></div><div class="ttdeci">@ AV_CODEC_ID_MPEG4</div><div class="ttdef"><b>Definition:</b> <a href="codec__id_8h_source.html#l00061">codec_id.h:61</a></div></div>
<div class="ttc" id="astruct_m_m_a_l_decode_context_html_ac5879764ae4b39ebc05c7689ae42b5f3"><div class="ttname"><a href="struct_m_m_a_l_decode_context.html#ac5879764ae4b39ebc05c7689ae42b5f3">MMALDecodeContext::waiting_buffers</a></div><div class="ttdeci">FFBufferEntry * waiting_buffers</div><div class="ttdef"><b>Definition:</b> <a href="mmaldec_8c_source.html#l00085">mmaldec.c:85</a></div></div>
<div class="ttc" id="allviddspenc_8c_html_aba9ed0487b0aa23eba534648df8384c0"><div class="ttname"><a href="llviddspenc_8c.html#aba9ed0487b0aa23eba534648df8384c0">w</a></div><div class="ttdeci">uint8_t w</div><div class="ttdef"><b>Definition:</b> <a href="llviddspenc_8c_source.html#l00038">llviddspenc.c:38</a></div></div>
<div class="ttc" id="astruct_m_m_a_l_decode_context_html_a91826d8e0953fde68f4f671abe512ba4"><div class="ttname"><a href="struct_m_m_a_l_decode_context.html#a91826d8e0953fde68f4f671abe512ba4">MMALDecodeContext::top_field_first</a></div><div class="ttdeci">int top_field_first</div><div class="ttdef"><b>Definition:</b> <a href="mmaldec_8c_source.html#l00094">mmaldec.c:94</a></div></div>
<div class="ttc" id="amxf_8c_html_a084824fc871e38157790c99ae1240842"><div class="ttname"><a href="mxf_8c.html#a084824fc871e38157790c99ae1240842">data</a></div><div class="ttdeci">const char data[16]</div><div class="ttdef"><b>Definition:</b> <a href="mxf_8c_source.html#l00151">mxf.c:151</a></div></div>
<div class="ttc" id="adummy_2stdatomic_8h_html_a60b2151806275a115118e9981cc096b2"><div class="ttname"><a href="dummy_2stdatomic_8h.html#a60b2151806275a115118e9981cc096b2">atomic_int</a></div><div class="ttdeci">intptr_t atomic_int</div><div class="ttdef"><b>Definition:</b> <a href="dummy_2stdatomic_8h_source.html#l00055">stdatomic.h:55</a></div></div>
<div class="ttc" id="agroup__lavu__buffer_html_ga3e7f4c92db85ccba0b2a16dd0069842a"><div class="ttname"><a href="group__lavu__buffer.html#ga3e7f4c92db85ccba0b2a16dd0069842a">av_buffer_create</a></div><div class="ttdeci">AVBufferRef * av_buffer_create(uint8_t *data, int size, void(*free)(void *opaque, uint8_t *data), void *opaque, int flags)</div><div class="ttdef"><b>Definition:</b> <a href="buffer_8c_source.html#l00029">buffer.c:29</a></div></div>
<div class="ttc" id="agroup__lavu__error_html_ga4ebaa288c7684a26a591c501208910e4"><div class="ttname"><a href="group__lavu__error.html#ga4ebaa288c7684a26a591c501208910e4">AVERROR_UNKNOWN</a></div><div class="ttdeci">#define AVERROR_UNKNOWN</div><div class="ttdoc">Unknown error, typically from an external library.</div><div class="ttdef"><b>Definition:</b> <a href="error_8h_source.html#l00071">error.h:71</a></div></div>
<div class="ttc" id="ammaldec_8c_html_ae04e5817dd1faa79ca3741844abc2361"><div class="ttname"><a href="mmaldec_8c.html#ae04e5817dd1faa79ca3741844abc2361">ffmmal_fill_output_port</a></div><div class="ttdeci">static int ffmmal_fill_output_port(AVCodecContext *avctx)</div><div class="ttdef"><b>Definition:</b> <a href="mmaldec_8c_source.html#l00241">mmaldec.c:241</a></div></div>
<div class="ttc" id="astruct_a_v_packet_html_aaf4fe58dfcc7c232c1f2268b539d8367"><div class="ttname"><a href="struct_a_v_packet.html#aaf4fe58dfcc7c232c1f2268b539d8367">AVPacket::data</a></div><div class="ttdeci">uint8_t * data</div><div class="ttdef"><b>Definition:</b> <a href="packet_8h_source.html#l00363">packet.h:363</a></div></div>
<div class="ttc" id="ammaldec_8c_html_a148e964367f4eba01058d175d7f91acd"><div class="ttname"><a href="mmaldec_8c.html#a148e964367f4eba01058d175d7f91acd">MMALDecodeContext</a></div><div class="ttdeci">struct MMALDecodeContext MMALDecodeContext</div></div>
<div class="ttc" id="astruct_f_f_buffer_entry_html_ae872ff66179bb8f7b4d7f7ee503f4437"><div class="ttname"><a href="struct_f_f_buffer_entry.html#ae872ff66179bb8f7b4d7f7ee503f4437">FFBufferEntry::dts</a></div><div class="ttdeci">int64_t dts</div><div class="ttdef"><b>Definition:</b> <a href="mmaldec_8c_source.html#l00051">mmaldec.c:51</a></div></div>
<div class="ttc" id="astruct_a_v_codec_context_html_ae246ca7a1c72c151891ed0599e8dbfba"><div class="ttname"><a href="struct_a_v_codec_context.html#ae246ca7a1c72c151891ed0599e8dbfba">AVCodecContext::extradata_size</a></div><div class="ttdeci">int extradata_size</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l00628">avcodec.h:628</a></div></div>
<div class="ttc" id="astruct_m_m_a_l_decode_context_html_aa54fe3cc1bd57747087d91b85b408641"><div class="ttname"><a href="struct_m_m_a_l_decode_context.html#aa54fe3cc1bd57747087d91b85b408641">MMALDecodeContext::extra_buffers</a></div><div class="ttdeci">int extra_buffers</div><div class="ttdef"><b>Definition:</b> <a href="mmaldec_8c_source.html#l00071">mmaldec.c:71</a></div></div>
<div class="ttc" id="apixfmt_8h_html_aff71a069509a1ad3ff54d53a1c894c85a32a0719616b0bb89f4be9d885341bfa4"><div class="ttname"><a href="pixfmt_8h.html#aff71a069509a1ad3ff54d53a1c894c85a32a0719616b0bb89f4be9d885341bfa4">AVCOL_SPC_BT470BG</a></div><div class="ttdeci">@ AVCOL_SPC_BT470BG</div><div class="ttdoc">also ITU-R BT601-6 625 / ITU-R BT1358 625 / ITU-R BT1700 625 PAL &amp; SECAM / IEC 61966-2-4 xvYCC601</div><div class="ttdef"><b>Definition:</b> <a href="pixfmt_8h_source.html#l00518">pixfmt.h:518</a></div></div>
<div class="ttc" id="astruct_f_f_pool_ref_html"><div class="ttname"><a href="struct_f_f_pool_ref.html">FFPoolRef</a></div><div class="ttdef"><b>Definition:</b> <a href="mmaldec_8c_source.html#l00059">mmaldec.c:59</a></div></div>
<div class="ttc" id="alibavcodec_2dfa_8c_html_a837d39f8b74c379be96e07fe99664ca3"><div class="ttname"><a href="libavcodec_2dfa_8c.html#a837d39f8b74c379be96e07fe99664ca3">decoder</a></div><div class="ttdeci">static const chunk_decoder decoder[8]</div><div class="ttdef"><b>Definition:</b> <a href="libavcodec_2dfa_8c_source.html#l00330">dfa.c:330</a></div></div>
<div class="ttc" id="ammaldec_8c_html_a6e86699acab77c052deafff2b575b553"><div class="ttname"><a href="mmaldec_8c.html#a6e86699acab77c052deafff2b575b553">ffmmal_poolref_unref</a></div><div class="ttdeci">static void ffmmal_poolref_unref(FFPoolRef *ref)</div><div class="ttdef"><b>Definition:</b> <a href="mmaldec_8c_source.html#l00101">mmaldec.c:101</a></div></div>
<div class="ttc" id="astruct_m_m_a_l_decode_context_html_a2ba943313226522a91c1febb8fd0edb7"><div class="ttname"><a href="struct_m_m_a_l_decode_context.html#a2ba943313226522a91c1febb8fd0edb7">MMALDecodeContext::waiting_buffers_tail</a></div><div class="ttdeci">FFBufferEntry * waiting_buffers_tail</div><div class="ttdef"><b>Definition:</b> <a href="mmaldec_8c_source.html#l00085">mmaldec.c:85</a></div></div>
<div class="ttc" id="acheckasm_8h_html_a73a3b169ac8c3419cbe15327e75ffcfd"><div class="ttname"><a href="checkasm_8h.html#a73a3b169ac8c3419cbe15327e75ffcfd">fail</a></div><div class="ttdeci">#define fail()</div><div class="ttdef"><b>Definition:</b> <a href="checkasm_8h_source.html#l00123">checkasm.h:123</a></div></div>
<div class="ttc" id="ammaldec_8c_html_a651e4f2729bcee8fc20ed0edc86a87f0"><div class="ttname"><a href="mmaldec_8c.html#a651e4f2729bcee8fc20ed0edc86a87f0">mmal_hw_configs</a></div><div class="ttdeci">static const AVCodecHWConfigInternal *const mmal_hw_configs[]</div><div class="ttdef"><b>Definition:</b> <a href="mmaldec_8c_source.html#l00812">mmaldec.c:812</a></div></div>
<div class="ttc" id="ammaldec_8c_html_a384ff94b5139f441c282c9b4c7b985e6"><div class="ttname"><a href="mmaldec_8c.html#a384ff94b5139f441c282c9b4c7b985e6">options</a></div><div class="ttdeci">static const AVOption options[]</div><div class="ttdef"><b>Definition:</b> <a href="mmaldec_8c_source.html#l00817">mmaldec.c:817</a></div></div>
<div class="ttc" id="aavassert_8h_html"><div class="ttname"><a href="avassert_8h.html">avassert.h</a></div></div>
<div class="ttc" id="astruct_m_m_a_l_decode_context_html_affea6d69cea942a63f2feee3da14e93a"><div class="ttname"><a href="struct_m_m_a_l_decode_context.html#affea6d69cea942a63f2feee3da14e93a">MMALDecodeContext::extra_decoder_buffers</a></div><div class="ttdeci">int extra_decoder_buffers</div><div class="ttdef"><b>Definition:</b> <a href="mmaldec_8c_source.html#l00072">mmaldec.c:72</a></div></div>
<div class="ttc" id="astruct_f_f_buffer_entry_html_a9cec0ae60855480857b91d6301341831"><div class="ttname"><a href="struct_f_f_buffer_entry.html#a9cec0ae60855480857b91d6301341831">FFBufferEntry::flags</a></div><div class="ttdeci">int flags</div><div class="ttdef"><b>Definition:</b> <a href="mmaldec_8c_source.html#l00052">mmaldec.c:52</a></div></div>
<div class="ttc" id="agroup__lavu__log__constants_html_gaffe151ff4cd8a24b2e77ac8d9616c85c"><div class="ttname"><a href="group__lavu__log__constants.html#gaffe151ff4cd8a24b2e77ac8d9616c85c">AV_LOG_ERROR</a></div><div class="ttdeci">#define AV_LOG_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="log_8h_source.html#l00194">log.h:194</a></div></div>
<div class="ttc" id="astruct_f_f_pool_ref_html_ae4b6acbef67753da836c260a12392916"><div class="ttname"><a href="struct_f_f_pool_ref.html#ae4b6acbef67753da836c260a12392916">FFPoolRef::pool</a></div><div class="ttdeci">MMAL_POOL_T * pool</div><div class="ttdef"><b>Definition:</b> <a href="mmaldec_8c_source.html#l00061">mmaldec.c:61</a></div></div>
<div class="ttc" id="aattributes_8h_html_abeeb324fff79a5335d36774704e2475c"><div class="ttname"><a href="attributes_8h.html#abeeb324fff79a5335d36774704e2475c">av_cold</a></div><div class="ttdeci">#define av_cold</div><div class="ttdef"><b>Definition:</b> <a href="attributes_8h_source.html#l00090">attributes.h:90</a></div></div>
<div class="ttc" id="ammaldec_8c_html_a5154886f12c05be4f70583019e966f9d"><div class="ttname"><a href="mmaldec_8c.html#a5154886f12c05be4f70583019e966f9d">FFPoolRef</a></div><div class="ttdeci">struct FFPoolRef FFPoolRef</div></div>
<div class="ttc" id="astruct_f_f_buffer_ref_html"><div class="ttname"><a href="struct_f_f_buffer_ref.html">FFBufferRef</a></div><div class="ttdef"><b>Definition:</b> <a href="mmaldec_8c_source.html#l00064">mmaldec.c:64</a></div></div>
<div class="ttc" id="astruct_a_v_frame_html_a49020cc320b8fb1f5449167b6c97515b"><div class="ttname"><a href="struct_a_v_frame.html#a49020cc320b8fb1f5449167b6c97515b">AVFrame::flags</a></div><div class="ttdeci">int flags</div><div class="ttdef"><b>Definition:</b> <a href="frame_8h_source.html#l00545">frame.h:545</a></div></div>
<div class="ttc" id="agroup__lavu__buffer_html_gaa818f8f1011d69acc50c1f29cb85e576"><div class="ttname"><a href="group__lavu__buffer.html#gaa818f8f1011d69acc50c1f29cb85e576">AV_BUFFER_FLAG_READONLY</a></div><div class="ttdeci">#define AV_BUFFER_FLAG_READONLY</div><div class="ttdef"><b>Definition:</b> <a href="buffer_8h_source.html#l00113">buffer.h:113</a></div></div>
<div class="ttc" id="ammaldec_8c_html_aa106de1b77eb2dd4a48719d0dc09d46c"><div class="ttname"><a href="mmaldec_8c.html#aa106de1b77eb2dd4a48719d0dc09d46c">ffmmal_flush</a></div><div class="ttdeci">static void ffmmal_flush(AVCodecContext *avctx)</div><div class="ttdef"><b>Definition:</b> <a href="mmaldec_8c_source.html#l00453">mmaldec.c:453</a></div></div>
<div class="ttc" id="ammaldec_8c_html_aced0493c254fb6e65f022fcedf25eb90"><div class="ttname"><a href="mmaldec_8c.html#aced0493c254fb6e65f022fcedf25eb90">ffmmal_csp_to_av_csp</a></div><div class="ttdeci">static enum AVColorSpace ffmmal_csp_to_av_csp(MMAL_FOURCC_T fourcc)</div><div class="ttdef"><b>Definition:</b> <a href="mmaldec_8c_source.html#l00241">mmaldec.c:261</a></div></div>
<div class="ttc" id="astruct_f_f_buffer_ref_html_aeceac7a2102082eee615a9230953145a"><div class="ttname"><a href="struct_f_f_buffer_ref.html#aeceac7a2102082eee615a9230953145a">FFBufferRef::pool</a></div><div class="ttdeci">FFPoolRef * pool</div><div class="ttdef"><b>Definition:</b> <a href="mmaldec_8c_source.html#l00066">mmaldec.c:66</a></div></div>
<div class="ttc" id="astruct_m_m_a_l_decode_context_html"><div class="ttname"><a href="struct_m_m_a_l_decode_context.html">MMALDecodeContext</a></div><div class="ttdef"><b>Definition:</b> <a href="mmaldec_8c_source.html#l00069">mmaldec.c:69</a></div></div>
<div class="ttc" id="aavassert_8h_html_aae204192396f78cc8c5cd7ad5c57c23f"><div class="ttname"><a href="avassert_8h.html#aae204192396f78cc8c5cd7ad5c57c23f">av_assert0</a></div><div class="ttdeci">#define av_assert0(cond)</div><div class="ttdef"><b>Definition:</b> <a href="avassert_8h_source.html#l00037">avassert.h:37</a></div></div>
<div class="ttc" id="ammaldec_8c_html_a52311afa50d61c5b84c4ff410be1d8ad"><div class="ttname"><a href="mmaldec_8c.html#a52311afa50d61c5b84c4ff410be1d8ad">ffmmal_set_ref</a></div><div class="ttdeci">static int ffmmal_set_ref(AVFrame *frame, FFPoolRef *pool, MMAL_BUFFER_HEADER_T *buffer)</div><div class="ttdef"><b>Definition:</b> <a href="mmaldec_8c_source.html#l00122">mmaldec.c:122</a></div></div>
<div class="ttc" id="astruct_a_v_codec_context_html_a5252d34fbce300228d4dbda19a8c3293"><div class="ttname"><a href="struct_a_v_codec_context.html#a5252d34fbce300228d4dbda19a8c3293">AVCodecContext::sample_aspect_ratio</a></div><div class="ttdeci">AVRational sample_aspect_ratio</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l00905">avcodec.h:905</a></div></div>
<div class="ttc" id="agroup__lavu__log__constants_html_ga5b7221c3afd06848486776bd834a58a5"><div class="ttname"><a href="group__lavu__log__constants.html#ga5b7221c3afd06848486776bd834a58a5">AV_LOG_DEBUG</a></div><div class="ttdeci">#define AV_LOG_DEBUG</div><div class="ttdef"><b>Definition:</b> <a href="log_8h_source.html#l00215">log.h:215</a></div></div>
<div class="ttc" id="astruct_a_v_option_html"><div class="ttname"><a href="struct_a_v_option.html">AVOption</a></div><div class="ttdef"><b>Definition:</b> <a href="opt_8h_source.html#l00248">opt.h:248</a></div></div>
<div class="ttc" id="atests_2movenc_8c_html_a93cc7296f13f507c1fd7abd0db36b898"><div class="ttname"><a href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a></div><div class="ttdeci">AVFormatContext * ctx</div><div class="ttdef"><b>Definition:</b> <a href="tests_2movenc_8c_source.html#l00048">movenc.c:48</a></div></div>
<div class="ttc" id="adecode_8h_html"><div class="ttname"><a href="decode_8h.html">decode.h</a></div></div>
<div class="ttc" id="astruct_f_f_buffer_entry_html_ab378752e33bdbd09f49b666cff37a1b6"><div class="ttname"><a href="struct_f_f_buffer_entry.html#ab378752e33bdbd09f49b666cff37a1b6">FFBufferEntry::data</a></div><div class="ttdeci">void * data</div><div class="ttdef"><b>Definition:</b> <a href="mmaldec_8c_source.html#l00049">mmaldec.c:49</a></div></div>
<div class="ttc" id="astruct_a_v_packet_html_a73bde0a37f3b1efc839f11295bfbf42a"><div class="ttname"><a href="struct_a_v_packet.html#a73bde0a37f3b1efc839f11295bfbf42a">AVPacket::pts</a></div><div class="ttdeci">int64_t pts</div><div class="ttdef"><b>Definition:</b> <a href="packet_8h_source.html#l00356">packet.h:356</a></div></div>
<div class="ttc" id="adummy_2stdatomic_8h_html_acced2a78b2a440317feed51f3e505d1d"><div class="ttname"><a href="dummy_2stdatomic_8h.html#acced2a78b2a440317feed51f3e505d1d">atomic_load</a></div><div class="ttdeci">#define atomic_load(object)</div><div class="ttdef"><b>Definition:</b> <a href="dummy_2stdatomic_8h_source.html#l00093">stdatomic.h:93</a></div></div>
<div class="ttc" id="ammaldec_8c_html_a56be75a71b6b6abecc97433dec143493"><div class="ttname"><a href="mmaldec_8c.html#a56be75a71b6b6abecc97433dec143493">MAX_DELAYED_FRAMES</a></div><div class="ttdeci">#define MAX_DELAYED_FRAMES</div><div class="ttdef"><b>Definition:</b> <a href="mmaldec_8c_source.html#l00099">mmaldec.c:99</a></div></div>
<div class="ttc" id="agroup__lavc__core_html_ggaadca229ad2c20e060a14fec08a5cc7cea3d4c051c8b18a3c18750676a308c10be"><div class="ttname"><a href="group__lavc__core.html#ggaadca229ad2c20e060a14fec08a5cc7cea3d4c051c8b18a3c18750676a308c10be">AV_CODEC_ID_H264</a></div><div class="ttdeci">@ AV_CODEC_ID_H264</div><div class="ttdef"><b>Definition:</b> <a href="codec__id_8h_source.html#l00076">codec_id.h:76</a></div></div>
<div class="ttc" id="astruct_f_f_buffer_ref_html_aee321326fa58b803490ba2c84fb81cd3"><div class="ttname"><a href="struct_f_f_buffer_ref.html#aee321326fa58b803490ba2c84fb81cd3">FFBufferRef::buffer</a></div><div class="ttdeci">MMAL_BUFFER_HEADER_T * buffer</div><div class="ttdef"><b>Definition:</b> <a href="mmaldec_8c_source.html#l00065">mmaldec.c:65</a></div></div>
<div class="ttc" id="ammaldec_8c_html_aeee0f01c1d41873152888d3b1a0e2ef2"><div class="ttname"><a href="mmaldec_8c.html#aeee0f01c1d41873152888d3b1a0e2ef2">control_port_cb</a></div><div class="ttdeci">static void control_port_cb(MMAL_PORT_T *port, MMAL_BUFFER_HEADER_T *buffer)</div><div class="ttdef"><b>Definition:</b> <a href="mmaldec_8c_source.html#l00224">mmaldec.c:224</a></div></div>
<div class="ttc" id="afilter__design_8txt_html_a0e82f1088fdc24c14bf175d2ac77523f"><div class="ttname"><a href="filter__design_8txt.html#a0e82f1088fdc24c14bf175d2ac77523f">if</a></div><div class="ttdeci">if(ret)</div><div class="ttdef"><b>Definition:</b> <a href="filter__design_8txt_source.html#l00179">filter_design.txt:179</a></div></div>
<div class="ttc" id="ammaldec_8c_html_a3d5c64c42cccf38d29eedfff2b8cf977"><div class="ttname"><a href="mmaldec_8c.html#a3d5c64c42cccf38d29eedfff2b8cf977">output_callback</a></div><div class="ttdeci">static void output_callback(MMAL_PORT_T *port, MMAL_BUFFER_HEADER_T *buffer)</div><div class="ttdef"><b>Definition:</b> <a href="mmaldec_8c_source.html#l00216">mmaldec.c:216</a></div></div>
<div class="ttc" id="ammaldec_8c_html_a3579bba1d9c59a05500a2ec005658eb9"><div class="ttname"><a href="mmaldec_8c.html#a3579bba1d9c59a05500a2ec005658eb9">ffmmal_init_decoder</a></div><div class="ttdeci">static av_cold int ffmmal_init_decoder(AVCodecContext *avctx)</div><div class="ttdef"><b>Definition:</b> <a href="mmaldec_8c_source.html#l00350">mmaldec.c:350</a></div></div>
<div class="ttc" id="astruct_m_m_a_l_decode_context_html_ac3ecc2b60aed27997f2ca6176b460698"><div class="ttname"><a href="struct_m_m_a_l_decode_context.html#ac3ecc2b60aed27997f2ca6176b460698">MMALDecodeContext::eos_sent</a></div><div class="ttdeci">int eos_sent</div><div class="ttdef"><b>Definition:</b> <a href="mmaldec_8c_source.html#l00091">mmaldec.c:91</a></div></div>
<div class="ttc" id="acoverity_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="coverity_8c_source.html#l00032">coverity.c:32</a></div></div>
<div class="ttc" id="ammaldec_8c_html_a5b63948bbe5f0044b14bb186c01afe5c"><div class="ttname"><a href="mmaldec_8c.html#a5b63948bbe5f0044b14bb186c01afe5c">ffmal_copy_frame</a></div><div class="ttdeci">static int ffmal_copy_frame(AVCodecContext *avctx, AVFrame *frame, MMAL_BUFFER_HEADER_T *buffer)</div><div class="ttdef"><b>Definition:</b> <a href="mmaldec_8c_source.html#l00624">mmaldec.c:624</a></div></div>
<div class="ttc" id="agroup__lavu__buffer_html_ga135e9e929b5033bb8f68322497b2effc"><div class="ttname"><a href="group__lavu__buffer.html#ga135e9e929b5033bb8f68322497b2effc">av_buffer_unref</a></div><div class="ttdeci">void av_buffer_unref(AVBufferRef **buf)</div><div class="ttdef"><b>Definition:</b> <a href="buffer_8c_source.html#l00125">buffer.c:125</a></div></div>
<div class="ttc" id="atests_2checkasm_2vp8dsp_8c_html_a858376c0918f93e656c8c0d76c63dbe8"><div class="ttname"><a href="tests_2checkasm_2vp8dsp_8c.html#a858376c0918f93e656c8c0d76c63dbe8">src</a></div><div class="ttdeci">#define src</div><div class="ttdef"><b>Definition:</b> <a href="tests_2checkasm_2vp8dsp_8c_source.html#l00254">vp8dsp.c:254</a></div></div>
<div class="ttc" id="astruct_f_f_buffer_entry_html"><div class="ttname"><a href="struct_f_f_buffer_entry.html">FFBufferEntry</a></div><div class="ttdef"><b>Definition:</b> <a href="mmaldec_8c_source.html#l00047">mmaldec.c:47</a></div></div>
<div class="ttc" id="ammaldec_8c_html_a1d740192498a2fb7b1047ba1e9d193f9"><div class="ttname"><a href="mmaldec_8c.html#a1d740192498a2fb7b1047ba1e9d193f9">ffmmal_close_decoder</a></div><div class="ttdeci">static av_cold int ffmmal_close_decoder(AVCodecContext *avctx)</div><div class="ttdef"><b>Definition:</b> <a href="mmaldec_8c_source.html#l00183">mmaldec.c:183</a></div></div>
<div class="ttc" id="astruct_m_m_a_l_decode_context_html_a1a2ca7b4528654ea7da40f26185965ce"><div class="ttname"><a href="struct_m_m_a_l_decode_context.html#a1a2ca7b4528654ea7da40f26185965ce">MMALDecodeContext::pool_in</a></div><div class="ttdeci">MMAL_POOL_T * pool_in</div><div class="ttdef"><b>Definition:</b> <a href="mmaldec_8c_source.html#l00076">mmaldec.c:76</a></div></div>
<div class="ttc" id="ammaldec_8c_html_a947f3567c81c3171bc8664828f9775dc"><div class="ttname"><a href="mmaldec_8c.html#a947f3567c81c3171bc8664828f9775dc">ffmmal_stop_decoder</a></div><div class="ttdeci">static void ffmmal_stop_decoder(AVCodecContext *avctx)</div><div class="ttdef"><b>Definition:</b> <a href="mmaldec_8c_source.html#l00148">mmaldec.c:148</a></div></div>
<div class="ttc" id="astruct_f_f_buffer_entry_html_a03608ef128dbe082de5e01bd6e4401f1"><div class="ttname"><a href="struct_f_f_buffer_entry.html#a03608ef128dbe082de5e01bd6e4401f1">FFBufferEntry::length</a></div><div class="ttdeci">size_t length</div><div class="ttdef"><b>Definition:</b> <a href="mmaldec_8c_source.html#l00050">mmaldec.c:50</a></div></div>
<div class="ttc" id="agroup__lavu__mem__funcs_html_gaf143ecab33a3868b57345466c39de7c1"><div class="ttname"><a href="group__lavu__mem__funcs.html#gaf143ecab33a3868b57345466c39de7c1">av_mallocz</a></div><div class="ttdeci">void * av_mallocz(size_t size)</div><div class="ttdef"><b>Definition:</b> <a href="mem_8c_source.html#l00237">mem.c:237</a></div></div>
<div class="ttc" id="adecode_8c_html_a0d5adb2b84051826883605b3ab4d1bab"><div class="ttname"><a href="decode_8c.html#a0d5adb2b84051826883605b3ab4d1bab">ff_get_buffer</a></div><div class="ttdeci">int ff_get_buffer(AVCodecContext *avctx, AVFrame *frame, int flags)</div><div class="ttdef"><b>Definition:</b> <a href="decode_8c_source.html#l01879">decode.c:1879</a></div></div>
<div class="ttc" id="astruct_m_m_a_l_decode_context_html_adf7a14379faf64c444eead617fb11d92"><div class="ttname"><a href="struct_m_m_a_l_decode_context.html#adf7a14379faf64c444eead617fb11d92">MMALDecodeContext::decoder</a></div><div class="ttdeci">MMAL_COMPONENT_T * decoder</div><div class="ttdef"><b>Definition:</b> <a href="mmaldec_8c_source.html#l00074">mmaldec.c:74</a></div></div>
<div class="ttc" id="agroup__lavu__picture_html_ga5b6ead346a70342ae8a303c16d2b3629"><div class="ttname"><a href="group__lavu__picture.html#ga5b6ead346a70342ae8a303c16d2b3629">av_image_fill_arrays</a></div><div class="ttdeci">int av_image_fill_arrays(uint8_t *dst_data[4], int dst_linesize[4], const uint8_t *src, enum AVPixelFormat pix_fmt, int width, int height, int align)</div><div class="ttdef"><b>Definition:</b> <a href="imgutils_8c_source.html#l00446">imgutils.c:446</a></div></div>
<div class="ttc" id="acommon_8h_html_a9960bd6780a9b16a216a57be1ee04359"><div class="ttname"><a href="common_8h.html#a9960bd6780a9b16a216a57be1ee04359">FFMAX</a></div><div class="ttdeci">#define FFMAX(a, b)</div><div class="ttdef"><b>Definition:</b> <a href="common_8h_source.html#l00094">common.h:94</a></div></div>
<div class="ttc" id="adummy_2stdatomic_8h_html_a1d2b72b5d6ad1392c4f805054be0bdd1"><div class="ttname"><a href="dummy_2stdatomic_8h.html#a1d2b72b5d6ad1392c4f805054be0bdd1">atomic_fetch_add_explicit</a></div><div class="ttdeci">#define atomic_fetch_add_explicit(object, operand, order)</div><div class="ttdef"><b>Definition:</b> <a href="dummy_2stdatomic_8h_source.html#l00149">stdatomic.h:149</a></div></div>
<div class="ttc" id="agroup__lavu__time_html_ga2eaefe702f95f619ea6f2d08afa01be1"><div class="ttname"><a href="group__lavu__time.html#ga2eaefe702f95f619ea6f2d08afa01be1">AV_NOPTS_VALUE</a></div><div class="ttdeci">#define AV_NOPTS_VALUE</div><div class="ttdoc">Undefined timestamp value.</div><div class="ttdef"><b>Definition:</b> <a href="avutil_8h_source.html#l00248">avutil.h:248</a></div></div>
<div class="ttc" id="astruct_a_v_codec_context_html_a4d08b297e97eefd66c714df4fff493c8"><div class="ttname"><a href="struct_a_v_codec_context.html#a4d08b297e97eefd66c714df4fff493c8">AVCodecContext::framerate</a></div><div class="ttdeci">AVRational framerate</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l02069">avcodec.h:2069</a></div></div>
<div class="ttc" id="ahwconfig_8h_html_a5d9f407662ecff8b278a6a90da001797"><div class="ttname"><a href="hwconfig_8h.html#a5d9f407662ecff8b278a6a90da001797">HW_CONFIG_INTERNAL</a></div><div class="ttdeci">#define HW_CONFIG_INTERNAL(format)</div><div class="ttdef"><b>Definition:</b> <a href="hwconfig_8h_source.html#l00057">hwconfig.h:57</a></div></div>
<div class="ttc" id="ammaldec_8c_html_a9a7a9f5407a09ebced0f0222ac3e92d1"><div class="ttname"><a href="mmaldec_8c.html#a9a7a9f5407a09ebced0f0222ac3e92d1">ffmmal_read_frame</a></div><div class="ttdeci">static int ffmmal_read_frame(AVCodecContext *avctx, AVFrame *frame, int *got_frame)</div><div class="ttdef"><b>Definition:</b> <a href="mmaldec_8c_source.html#l00671">mmaldec.c:671</a></div></div>
<div class="ttc" id="astruct_a_v_codec_context_html_a0d8f46461754e8abea0847dcbc41b956"><div class="ttname"><a href="struct_a_v_codec_context.html#a0d8f46461754e8abea0847dcbc41b956">AVCodecContext::width</a></div><div class="ttdeci">int width</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l00699">avcodec.h:699</a></div></div>
<div class="ttc" id="astruct_a_v_packet_html_a85dbbd306b44b02390cd91c45e6a0f76"><div class="ttname"><a href="struct_a_v_packet.html#a85dbbd306b44b02390cd91c45e6a0f76">AVPacket::dts</a></div><div class="ttdeci">int64_t dts</div><div class="ttdef"><b>Definition:</b> <a href="packet_8h_source.html#l00362">packet.h:362</a></div></div>
<div class="ttc" id="astruct_a_v_buffer_ref_html"><div class="ttname"><a href="struct_a_v_buffer_ref.html">AVBufferRef</a></div><div class="ttdef"><b>Definition:</b> <a href="buffer_8h_source.html#l00081">buffer.h:81</a></div></div>
<div class="ttc" id="astruct_a_v_class_html"><div class="ttname"><a href="struct_a_v_class.html">AVClass</a></div><div class="ttdef"><b>Definition:</b> <a href="log_8h_source.html#l00067">log.h:67</a></div></div>
<div class="ttc" id="astruct_m_m_a_l_decode_context_html_a220775f17230040b3562fe2ce0525d81"><div class="ttname"><a href="struct_m_m_a_l_decode_context.html#a220775f17230040b3562fe2ce0525d81">MMALDecodeContext::frames_output</a></div><div class="ttdeci">int64_t frames_output</div><div class="ttdef"><b>Definition:</b> <a href="mmaldec_8c_source.html#l00089">mmaldec.c:89</a></div></div>
<div class="ttc" id="abuffer_8h_html"><div class="ttname"><a href="buffer_8h.html">buffer.h</a></div></div>
<div class="ttc" id="acommon_8h_html_a0f84cbd7fd810cd678157c98cbfad4b0"><div class="ttname"><a href="common_8h.html#a0f84cbd7fd810cd678157c98cbfad4b0">FFMIN</a></div><div class="ttdeci">#define FFMIN(a, b)</div><div class="ttdef"><b>Definition:</b> <a href="common_8h_source.html#l00096">common.h:96</a></div></div>
<div class="ttc" id="astruct_f_f_buffer_entry_html_a1cdad952247660ea6a2e5928c61a3b40"><div class="ttname"><a href="struct_f_f_buffer_entry.html#a1cdad952247660ea6a2e5928c61a3b40">FFBufferEntry::pts</a></div><div class="ttdeci">int64_t pts</div><div class="ttdef"><b>Definition:</b> <a href="mmaldec_8c_source.html#l00051">mmaldec.c:51</a></div></div>
<div class="ttc" id="agroup__lavu__log__constants_html_gad172eacfed8653e454c6fdcbe53baab3"><div class="ttname"><a href="group__lavu__log__constants.html#gad172eacfed8653e454c6fdcbe53baab3">AV_LOG_INFO</a></div><div class="ttdeci">#define AV_LOG_INFO</div><div class="ttdef"><b>Definition:</b> <a href="log_8h_source.html#l00205">log.h:205</a></div></div>
<div class="ttc" id="apixfmt_8h_html_aff71a069509a1ad3ff54d53a1c894c85aa0052721bb202c5cfb68a84d69116f69"><div class="ttname"><a href="pixfmt_8h.html#aff71a069509a1ad3ff54d53a1c894c85aa0052721bb202c5cfb68a84d69116f69">AVCOL_SPC_SMPTE240M</a></div><div class="ttdeci">@ AVCOL_SPC_SMPTE240M</div><div class="ttdoc">functionally identical to above</div><div class="ttdef"><b>Definition:</b> <a href="pixfmt_8h_source.html#l00520">pixfmt.h:520</a></div></div>
<div class="ttc" id="astruct_m_m_a_l_decode_context_html_a1fac4e76b20788dbbb6d68e9bc6aa866"><div class="ttname"><a href="struct_m_m_a_l_decode_context.html#a1fac4e76b20788dbbb6d68e9bc6aa866">MMALDecodeContext::interlaced_frame</a></div><div class="ttdeci">int interlaced_frame</div><div class="ttdef"><b>Definition:</b> <a href="mmaldec_8c_source.html#l00093">mmaldec.c:93</a></div></div>
<div class="ttc" id="alog_8h_html"><div class="ttname"><a href="log_8h.html">log.h</a></div></div>
<div class="ttc" id="alibavutil_2internal_8h_html"><div class="ttname"><a href="libavutil_2internal_8h.html">internal.h</a></div></div>
<div class="ttc" id="apixfmt_8h_html_aff71a069509a1ad3ff54d53a1c894c85"><div class="ttname"><a href="pixfmt_8h.html#aff71a069509a1ad3ff54d53a1c894c85">AVColorSpace</a></div><div class="ttdeci">AVColorSpace</div><div class="ttdef"><b>Definition:</b> <a href="pixfmt_8h_source.html#l00512">pixfmt.h:512</a></div></div>
<div class="ttc" id="acommon_8h_html"><div class="ttname"><a href="common_8h.html">common.h</a></div></div>
<div class="ttc" id="aaudio__convert_8c_html_ae1affc9ca37cfb624959c866a73f83c2"><div class="ttname"><a href="audio__convert_8c.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a></div><div class="ttdeci">uint8_t</div><div class="ttdef"><b>Definition:</b> <a href="audio__convert_8c_source.html#l00194">audio_convert.c:194</a></div></div>
<div class="ttc" id="astruct_a_v_buffer_ref_html_a55f17b82a5af97259a5e8a3fd9647a08"><div class="ttname"><a href="struct_a_v_buffer_ref.html#a55f17b82a5af97259a5e8a3fd9647a08">AVBufferRef::size</a></div><div class="ttdeci">int size</div><div class="ttdef"><b>Definition:</b> <a href="buffer_8h_source.html#l00093">buffer.h:93</a></div></div>
<div class="ttc" id="agroup__lavc__core_html_ggaadca229ad2c20e060a14fec08a5cc7cea7765c5c02c05ea1a96ef1ca35dad068f"><div class="ttname"><a href="group__lavc__core.html#ggaadca229ad2c20e060a14fec08a5cc7cea7765c5c02c05ea1a96ef1ca35dad068f">AV_CODEC_ID_VC1</a></div><div class="ttdeci">@ AV_CODEC_ID_VC1</div><div class="ttdef"><b>Definition:</b> <a href="codec__id_8h_source.html#l00119">codec_id.h:119</a></div></div>
<div class="ttc" id="apixfmt_8h_html_aff71a069509a1ad3ff54d53a1c894c85a8111716eff3b3fd95a197993d30b8ec2"><div class="ttname"><a href="pixfmt_8h.html#aff71a069509a1ad3ff54d53a1c894c85a8111716eff3b3fd95a197993d30b8ec2">AVCOL_SPC_UNSPECIFIED</a></div><div class="ttdeci">@ AVCOL_SPC_UNSPECIFIED</div><div class="ttdef"><b>Definition:</b> <a href="pixfmt_8h_source.html#l00515">pixfmt.h:515</a></div></div>
<div class="ttc" id="aavcodec_8h_html"><div class="ttname"><a href="avcodec_8h.html">avcodec.h</a></div></div>
<div class="ttc" id="astruct_f_f_buffer_entry_html_a64c957d2df291fe1ae865ef854869e65"><div class="ttname"><a href="struct_f_f_buffer_entry.html#a64c957d2df291fe1ae865ef854869e65">FFBufferEntry::next</a></div><div class="ttdeci">struct FFBufferEntry * next</div><div class="ttdef"><b>Definition:</b> <a href="mmaldec_8c_source.html#l00053">mmaldec.c:53</a></div></div>
<div class="ttc" id="afilter__design_8txt_html_af1ec77bdca1b30e8153fc5da88f603db"><div class="ttname"><a href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a></div><div class="ttdeci">ret</div><div class="ttdef"><b>Definition:</b> <a href="filter__design_8txt_source.html#l00187">filter_design.txt:187</a></div></div>
<div class="ttc" id="afilter__design_8txt_html_a48ad71a5b40cdd5f23c601f33665a953"><div class="ttname"><a href="filter__design_8txt.html#a48ad71a5b40cdd5f23c601f33665a953">frame</a></div><div class="ttdeci">these buffered frames must be flushed immediately if a new input produces new the filter must not call request_frame to get more It must just process the frame or queue it The task of requesting more frames is left to the filter s request_frame method or the application If a filter has several the filter must be ready for frames arriving randomly on any input any filter with several inputs will most likely require some kind of queuing mechanism It is perfectly acceptable to have a limited queue and to drop frames when the inputs are too unbalanced request_frame For filters that do not use the this method is called when a frame is wanted on an output For a it should directly call filter_frame on the corresponding output For a if there are queued frames already one of these frames should be pushed If the filter should request a frame on one of its repeatedly until at least one frame has been pushed Return or at least make progress towards producing a frame</div><div class="ttdef"><b>Definition:</b> <a href="filter__design_8txt_source.html#l00264">filter_design.txt:264</a></div></div>
<div class="ttc" id="astruct_a_v_codec_context_html_abe964316aaaa61967b012efdcced79c4"><div class="ttname"><a href="struct_a_v_codec_context.html#abe964316aaaa61967b012efdcced79c4">AVCodecContext::extradata</a></div><div class="ttdeci">uint8_t * extradata</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l00627">avcodec.h:627</a></div></div>
<div class="ttc" id="astruct_m_m_a_l_decode_context_html_a2bad9ecc641864d38ce1bcc57be3c5af"><div class="ttname"><a href="struct_m_m_a_l_decode_context.html#a2bad9ecc641864d38ce1bcc57be3c5af">MMALDecodeContext::queue_decoded_frames</a></div><div class="ttdeci">MMAL_QUEUE_T * queue_decoded_frames</div><div class="ttdef"><b>Definition:</b> <a href="mmaldec_8c_source.html#l00075">mmaldec.c:75</a></div></div>
<div class="ttc" id="astruct_a_v_rational_html_ae9a98c10a301c5e937095105b6f0fdb9"><div class="ttname"><a href="struct_a_v_rational.html#ae9a98c10a301c5e937095105b6f0fdb9">AVRational::num</a></div><div class="ttdeci">int num</div><div class="ttdoc">Numerator.</div><div class="ttdef"><b>Definition:</b> <a href="rational_8h_source.html#l00059">rational.h:59</a></div></div>
<div class="ttc" id="astruct_a_v_packet_html"><div class="ttname"><a href="struct_a_v_packet.html">AVPacket</a></div><div class="ttdef"><b>Definition:</b> <a href="packet_8h_source.html#l00340">packet.h:340</a></div></div>
<div class="ttc" id="ammaldec_8c_html_a24f7526ac8c3e7cf127c21bcef8ffd43"><div class="ttname"><a href="mmaldec_8c.html#a24f7526ac8c3e7cf127c21bcef8ffd43">ffmal_update_format</a></div><div class="ttdeci">static int ffmal_update_format(AVCodecContext *avctx)</div><div class="ttdef"><b>Definition:</b> <a href="mmaldec_8c_source.html#l00274">mmaldec.c:274</a></div></div>
<div class="ttc" id="astruct_m_m_a_l_decode_context_html_a12a439f3d8b154f336c7a359c0e1a98b"><div class="ttname"><a href="struct_m_m_a_l_decode_context.html#a12a439f3d8b154f336c7a359c0e1a98b">MMALDecodeContext::eos_received</a></div><div class="ttdeci">int eos_received</div><div class="ttdef"><b>Definition:</b> <a href="mmaldec_8c_source.html#l00090">mmaldec.c:90</a></div></div>
<div class="ttc" id="agroup__lavu__mem__funcs_html_ga34e10fdac079a9ca4512b8ccd7f20b8a"><div class="ttname"><a href="group__lavu__mem__funcs.html#ga34e10fdac079a9ca4512b8ccd7f20b8a">size</a></div><div class="ttdeci">int size</div><div class="ttdef"><b>Definition:</b> <a href="twinvq__data_8h_source.html#l11134">twinvq_data.h:11134</a></div></div>
<div class="ttc" id="adecode_8c_html_a227b4a5329003bed45b8bdf0a4e370a1"><div class="ttname"><a href="decode_8c.html#a227b4a5329003bed45b8bdf0a4e370a1">ff_decode_frame_props</a></div><div class="ttdeci">int ff_decode_frame_props(AVCodecContext *avctx, AVFrame *frame)</div><div class="ttdef"><b>Definition:</b> <a href="decode_8c_source.html#l01704">decode.c:1704</a></div></div>
<div class="ttc" id="astruct_a_v_frame_html_a1d0f65014a8d1bf78cec8cbed2304992"><div class="ttname"><a href="struct_a_v_frame.html#a1d0f65014a8d1bf78cec8cbed2304992">AVFrame::data</a></div><div class="ttdeci">uint8_t * data[AV_NUM_DATA_POINTERS]</div><div class="ttdef"><b>Definition:</b> <a href="frame_8h_source.html#l00322">frame.h:322</a></div></div>
<div class="ttc" id="agroup__lavu__picture_html_ga6b5a267e202daadf81cbde6584055d1e"><div class="ttname"><a href="group__lavu__picture.html#ga6b5a267e202daadf81cbde6584055d1e">av_image_copy</a></div><div class="ttdeci">void av_image_copy(uint8_t *dst_data[4], int dst_linesizes[4], const uint8_t *src_data[4], const int src_linesizes[4], enum AVPixelFormat pix_fmt, int width, int height)</div><div class="ttdef"><b>Definition:</b> <a href="imgutils_8c_source.html#l00422">imgutils.c:422</a></div></div>
<div class="ttc" id="ademuxing__decoding_8c_html_a3d4c6562f0b27cf0cacbbea5c038c090"><div class="ttname"><a href="demuxing__decoding_8c.html#a3d4c6562f0b27cf0cacbbea5c038c090">pkt</a></div><div class="ttdeci">static AVPacket pkt</div><div class="ttdef"><b>Definition:</b> <a href="demuxing__decoding_8c_source.html#l00054">demuxing_decoding.c:54</a></div></div>
<div class="ttc" id="ammaldec_8c_html_a50b28ae8c033ca7cae2dd18201208586"><div class="ttname"><a href="mmaldec_8c.html#a50b28ae8c033ca7cae2dd18201208586">input_callback</a></div><div class="ttdeci">static void input_callback(MMAL_PORT_T *port, MMAL_BUFFER_HEADER_T *buffer)</div><div class="ttdef"><b>Definition:</b> <a href="mmaldec_8c_source.html#l00201">mmaldec.c:201</a></div></div>
<div class="ttc" id="afilter__design_8txt_html_ab5bf43ceeffd5c440d539ae2ed025827"><div class="ttname"><a href="filter__design_8txt.html#ab5bf43ceeffd5c440d539ae2ed025827">buffer</a></div><div class="ttdeci">the frame and frame reference mechanism is intended to as much as expensive copies of that data while still allowing the filters to produce correct results The data is stored in buffers represented by AVFrame structures Several references can point to the same frame buffer</div><div class="ttdef"><b>Definition:</b> <a href="filter__design_8txt_source.html#l00049">filter_design.txt:49</a></div></div>
<div class="ttc" id="agcc_2stdatomic_8h_html_aedf6fb62e0fc9e8f8cf2e3685f0a1e88"><div class="ttname"><a href="gcc_2stdatomic_8h.html#aedf6fb62e0fc9e8f8cf2e3685f0a1e88">atomic_fetch_add</a></div><div class="ttdeci">#define atomic_fetch_add(object, operand)</div><div class="ttdef"><b>Definition:</b> <a href="gcc_2stdatomic_8h_source.html#l00131">stdatomic.h:131</a></div></div>
<div class="ttc" id="apixfmt_8h_html_aff71a069509a1ad3ff54d53a1c894c85a8f572d6acb2787e37e88088da047c492"><div class="ttname"><a href="pixfmt_8h.html#aff71a069509a1ad3ff54d53a1c894c85a8f572d6acb2787e37e88088da047c492">AVCOL_SPC_FCC</a></div><div class="ttdeci">@ AVCOL_SPC_FCC</div><div class="ttdoc">FCC Title 47 Code of Federal Regulations 73.682 (a)(20)</div><div class="ttdef"><b>Definition:</b> <a href="pixfmt_8h_source.html#l00517">pixfmt.h:517</a></div></div>
<div class="ttc" id="agroup__avoptions_html_ggabd75aa30eb8ad6387672df9a1fa79444ac068b8f6afeeb293a13aeabb5d702411"><div class="ttname"><a href="group__avoptions.html#ggabd75aa30eb8ad6387672df9a1fa79444ac068b8f6afeeb293a13aeabb5d702411">AV_OPT_TYPE_INT</a></div><div class="ttdeci">@ AV_OPT_TYPE_INT</div><div class="ttdef"><b>Definition:</b> <a href="opt_8h_source.html#l00225">opt.h:225</a></div></div>
<div class="ttc" id="astruct_a_v_packet_html_a4d1ea19f63eb107111fd650ca514d1f4"><div class="ttname"><a href="struct_a_v_packet.html#a4d1ea19f63eb107111fd650ca514d1f4">AVPacket::size</a></div><div class="ttdeci">int size</div><div class="ttdef"><b>Definition:</b> <a href="packet_8h_source.html#l00364">packet.h:364</a></div></div>
<div class="ttc" id="atests_2jpeg2000dwt_8c_html_a5cabdd8be5af41f675fed06498e094b7"><div class="ttname"><a href="tests_2jpeg2000dwt_8c.html#a5cabdd8be5af41f675fed06498e094b7">ref</a></div><div class="ttdeci">static int ref[MAX_W *MAX_W]</div><div class="ttdef"><b>Definition:</b> <a href="tests_2jpeg2000dwt_8c_source.html#l00107">jpeg2000dwt.c:107</a></div></div>
<div class="ttc" id="agroup__lavu__buffer_html_gaa40ce7d3ede946a89d03323bbd7268c1"><div class="ttname"><a href="group__lavu__buffer.html#gaa40ce7d3ede946a89d03323bbd7268c1">av_buffer_ref</a></div><div class="ttdeci">AVBufferRef * av_buffer_ref(AVBufferRef *buf)</div><div class="ttdef"><b>Definition:</b> <a href="buffer_8c_source.html#l00093">buffer.c:93</a></div></div>
<div class="ttc" id="astruct_f_f_pool_ref_html_af0ffa9b8690521917796dd8fa06951a1"><div class="ttname"><a href="struct_f_f_pool_ref.html#af0ffa9b8690521917796dd8fa06951a1">FFPoolRef::refcount</a></div><div class="ttdeci">atomic_int refcount</div><div class="ttdef"><b>Definition:</b> <a href="mmaldec_8c_source.html#l00060">mmaldec.c:60</a></div></div>
<div class="ttc" id="astruct_a_v_packet_html_a3bf81872813551fe9343dd0e09993e38"><div class="ttname"><a href="struct_a_v_packet.html#a3bf81872813551fe9343dd0e09993e38">AVPacket::buf</a></div><div class="ttdeci">AVBufferRef * buf</div><div class="ttdef"><b>Definition:</b> <a href="packet_8h_source.html#l00346">packet.h:346</a></div></div>
<div class="ttc" id="alibavutil_2internal_8h_html_a5837cafc419c2b5ecdb1dfa330675d13"><div class="ttname"><a href="libavutil_2internal_8h.html#a5837cafc419c2b5ecdb1dfa330675d13">FF_DISABLE_DEPRECATION_WARNINGS</a></div><div class="ttdeci">#define FF_DISABLE_DEPRECATION_WARNINGS</div><div class="ttdef"><b>Definition:</b> <a href="libavutil_2internal_8h_source.html#l00084">internal.h:84</a></div></div>
<div class="ttc" id="astruct_m_m_a_l_decode_context_html_a0b53ce8dcf48bdd5facc140f8ef74f27"><div class="ttname"><a href="struct_m_m_a_l_decode_context.html#a0b53ce8dcf48bdd5facc140f8ef74f27">MMALDecodeContext::av_class</a></div><div class="ttdeci">AVClass * av_class</div><div class="ttdef"><b>Definition:</b> <a href="mmaldec_8c_source.html#l00070">mmaldec.c:70</a></div></div>
<div class="ttc" id="astruct_m_m_a_l_decode_context_html_aca97a98b8385e618008e3de22a041318"><div class="ttname"><a href="struct_m_m_a_l_decode_context.html#aca97a98b8385e618008e3de22a041318">MMALDecodeContext::packets_buffered</a></div><div class="ttdeci">atomic_int packets_buffered</div><div class="ttdef"><b>Definition:</b> <a href="mmaldec_8c_source.html#l00088">mmaldec.c:88</a></div></div>
<div class="ttc" id="alibavcodec_2internal_8h_html_ac8b736a8223c5348ad85ffff597401ff"><div class="ttname"><a href="libavcodec_2internal_8h.html#ac8b736a8223c5348ad85ffff597401ff">ff_set_dimensions</a></div><div class="ttdeci">int ff_set_dimensions(AVCodecContext *s, int width, int height)</div><div class="ttdef"><b>Definition:</b> <a href="libavcodec_2utils_8c_source.html#l00106">utils.c:106</a></div></div>
<div class="ttc" id="astruct_a_v_frame_html_a0452833e3ab6ddd7acbf82817a7818a4"><div class="ttname"><a href="struct_a_v_frame.html#a0452833e3ab6ddd7acbf82817a7818a4">AVFrame::pts</a></div><div class="ttdeci">int64_t pts</div><div class="ttdef"><b>Definition:</b> <a href="frame_8h_source.html#l00401">frame.h:401</a></div></div>
<div class="ttc" id="astruct_a_v_codec_context_html_a0425c77b3d06d71e5db88b1d7e1b37f2"><div class="ttname"><a href="struct_a_v_codec_context.html#a0425c77b3d06d71e5db88b1d7e1b37f2">AVCodecContext::pix_fmt</a></div><div class="ttdeci">enum AVPixelFormat pix_fmt</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l00721">avcodec.h:736</a></div></div>
<div class="ttc" id="atableprint__vlc_8h_html_a079eab092887563f2bef9106c6120089"><div class="ttname"><a href="tableprint__vlc_8h.html#a079eab092887563f2bef9106c6120089">av_free</a></div><div class="ttdeci">#define av_free(p)</div><div class="ttdef"><b>Definition:</b> <a href="tableprint__vlc_8h_source.html#l00034">tableprint_vlc.h:34</a></div></div>
<div class="ttc" id="amacros_8h_html_acae4ba605b3a7d535b7ac058ffe96892"><div class="ttname"><a href="macros_8h.html#acae4ba605b3a7d535b7ac058ffe96892">FFALIGN</a></div><div class="ttdeci">#define FFALIGN(x, a)</div><div class="ttdef"><b>Definition:</b> <a href="macros_8h_source.html#l00048">macros.h:48</a></div></div>
<div class="ttc" id="ammaldec_8c_html_a84e8ba543e365ddc575b7b0f8d7d6a2d"><div class="ttname"><a href="mmaldec_8c.html#a84e8ba543e365ddc575b7b0f8d7d6a2d">FFBufferRef</a></div><div class="ttdeci">struct FFBufferRef FFBufferRef</div></div>
<div class="ttc" id="astruct_m_m_a_l_decode_context_html_a182dee9c5b3849bd9c031f4cc194f7c1"><div class="ttname"><a href="struct_m_m_a_l_decode_context.html#a182dee9c5b3849bd9c031f4cc194f7c1">MMALDecodeContext::packets_sent</a></div><div class="ttdeci">int64_t packets_sent</div><div class="ttdef"><b>Definition:</b> <a href="mmaldec_8c_source.html#l00087">mmaldec.c:87</a></div></div>
<div class="ttc" id="ammaldec_8c_html_a3d0a63b052c6d73483ec8d7f821b616e"><div class="ttname"><a href="mmaldec_8c.html#a3d0a63b052c6d73483ec8d7f821b616e">ffmmal_release_frame</a></div><div class="ttdeci">static void ffmmal_release_frame(void *opaque, uint8_t *data)</div><div class="ttdef"><b>Definition:</b> <a href="mmaldec_8c_source.html#l00110">mmaldec.c:110</a></div></div>
<div class="ttc" id="aimgutils_8h_html"><div class="ttname"><a href="imgutils_8h.html">imgutils.h</a></div></div>
<div class="ttc" id="atableprint__vlc_8h_html_af38b91523053c244564a94f1ef862c2c"><div class="ttname"><a href="tableprint__vlc_8h.html#af38b91523053c244564a94f1ef862c2c">av_log</a></div><div class="ttdeci">#define av_log(a,...)</div><div class="ttdef"><b>Definition:</b> <a href="tableprint__vlc_8h_source.html#l00028">tableprint_vlc.h:28</a></div></div>
<div class="ttc" id="avp9dsp__template_8c_html_a5e36941b3d856737e81516acd45edc50"><div class="ttname"><a href="vp9dsp__template_8c.html#a5e36941b3d856737e81516acd45edc50">h</a></div><div class="ttdeci">h</div><div class="ttdef"><b>Definition:</b> <a href="vp9dsp__template_8c_source.html#l02038">vp9dsp_template.c:2038</a></div></div>
<div class="ttc" id="ammaldec_8c_html_adfa31ee009f58dca258522c04385e048"><div class="ttname"><a href="mmaldec_8c.html#adfa31ee009f58dca258522c04385e048">ffmmal_add_packet</a></div><div class="ttdeci">static int ffmmal_add_packet(AVCodecContext *avctx, AVPacket *avpkt, int is_extradata)</div><div class="ttdef"><b>Definition:</b> <a href="mmaldec_8c_source.html#l00480">mmaldec.c:480</a></div></div>
<div class="ttc" id="adummy_2stdatomic_8h_html_af8a9cbe9495fcafaa892b24b383acf96"><div class="ttname"><a href="dummy_2stdatomic_8h.html#af8a9cbe9495fcafaa892b24b383acf96">atomic_init</a></div><div class="ttdeci">#define atomic_init(obj, value)</div><div class="ttdef"><b>Definition:</b> <a href="dummy_2stdatomic_8h_source.html#l00033">stdatomic.h:33</a></div></div>
<div class="ttc" id="astruct_a_v_codec_context_html_a6e606effa68724cae2ef5cc05f7fd9cb"><div class="ttname"><a href="struct_a_v_codec_context.html#a6e606effa68724cae2ef5cc05f7fd9cb">AVCodecContext::codec</a></div><div class="ttdeci">const struct AVCodec * codec</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l00535">avcodec.h:535</a></div></div>
<div class="ttc" id="astruct_a_v_frame_html"><div class="ttname"><a href="struct_a_v_frame.html">AVFrame</a></div><div class="ttdef"><b>Definition:</b> <a href="frame_8h_source.html#l00308">frame.h:308</a></div></div>
<div class="ttc" id="apixfmt_8h_html_aff71a069509a1ad3ff54d53a1c894c85a23e7d1012e354bbfcb62642e537d33cb"><div class="ttname"><a href="pixfmt_8h.html#aff71a069509a1ad3ff54d53a1c894c85a23e7d1012e354bbfcb62642e537d33cb">AVCOL_SPC_BT709</a></div><div class="ttdeci">@ AVCOL_SPC_BT709</div><div class="ttdoc">also ITU-R BT1361 / IEC 61966-2-4 xvYCC709 / SMPTE RP177 Annex B</div><div class="ttdef"><b>Definition:</b> <a href="pixfmt_8h_source.html#l00514">pixfmt.h:514</a></div></div>
<div class="ttc" id="astruct_m_m_a_l_decode_context_html_a6005d92ff46458569670142b146d4f9a"><div class="ttname"><a href="struct_m_m_a_l_decode_context.html#a6005d92ff46458569670142b146d4f9a">MMALDecodeContext::extradata_sent</a></div><div class="ttdeci">int extradata_sent</div><div class="ttdef"><b>Definition:</b> <a href="mmaldec_8c_source.html#l00092">mmaldec.c:92</a></div></div>
<div class="ttc" id="agroup__lavc__core_html_ggaadca229ad2c20e060a14fec08a5cc7ceaf614abb36f7c5d0c42ed522c1d6c99f0"><div class="ttname"><a href="group__lavc__core.html#ggaadca229ad2c20e060a14fec08a5cc7ceaf614abb36f7c5d0c42ed522c1d6c99f0">AV_CODEC_ID_MPEG2VIDEO</a></div><div class="ttdeci">@ AV_CODEC_ID_MPEG2VIDEO</div><div class="ttdoc">preferred ID for MPEG-1/2 video decoding</div><div class="ttdef"><b>Definition:</b> <a href="codec__id_8h_source.html#l00051">codec_id.h:51</a></div></div>
<div class="ttc" id="avaapi__decode_8c_html_aa5d906425500585aa7832161b2a40e1b"><div class="ttname"><a href="vaapi__decode_8c.html#aa5d906425500585aa7832161b2a40e1b">fourcc</a></div><div class="ttdeci">uint32_t fourcc</div><div class="ttdef"><b>Definition:</b> <a href="vaapi__decode_8c_source.html#l00239">vaapi_decode.c:239</a></div></div>
<div class="ttc" id="astruct_a_v_rational_html_aee46bdac67d965ac0a4204e753f910c3"><div class="ttname"><a href="struct_a_v_rational.html#aee46bdac67d965ac0a4204e753f910c3">AVRational::den</a></div><div class="ttdeci">int den</div><div class="ttdoc">Denominator.</div><div class="ttdef"><b>Definition:</b> <a href="rational_8h_source.html#l00060">rational.h:60</a></div></div>
<div class="ttc" id="astruct_a_v_codec_context_html_a8cd8caa7d40319324ce3d879a2edbd9f"><div class="ttname"><a href="struct_a_v_codec_context.html#a8cd8caa7d40319324ce3d879a2edbd9f">AVCodecContext::colorspace</a></div><div class="ttdeci">enum AVColorSpace colorspace</div><div class="ttdef"><b>Definition:</b> <a href="avcodec_8h_source.html#l01132">avcodec.h:1154</a></div></div>
<div class="ttc" id="astruct_a_v_codec_html_ac2b97bd3c19686025e1b7d577329c250"><div class="ttname"><a href="struct_a_v_codec.html#ac2b97bd3c19686025e1b7d577329c250">AVCodec::pix_fmts</a></div><div class="ttdeci">enum AVPixelFormat * pix_fmts</div><div class="ttdoc">array of supported pixel formats, or NULL if unknown, array is terminated by -1</div><div class="ttdef"><b>Definition:</b> <a href="codec_8h_source.html#l00211">codec.h:211</a></div></div>
<div class="ttc" id="agroup__lavu__misc_html_gae07d7cbf511060210152a89ad0d137ad"><div class="ttname"><a href="group__lavu__misc.html#gae07d7cbf511060210152a89ad0d137ad">av_fourcc2str</a></div><div class="ttdeci">#define av_fourcc2str(fourcc)</div><div class="ttdef"><b>Definition:</b> <a href="avutil_8h_source.html#l00348">avutil.h:348</a></div></div>
<div class="ttc" id="agroup__lavc__packet_html_gac9cb9756175b96e7441575803757fb73"><div class="ttname"><a href="group__lavc__packet.html#gac9cb9756175b96e7441575803757fb73">av_init_packet</a></div><div class="ttdeci">void av_init_packet(AVPacket *pkt)</div><div class="ttdef"><b>Definition:</b> <a href="avpacket_8c_source.html#l00035">avpacket.c:35</a></div></div>
<div class="ttc" id="astruct_f_f_buffer_entry_html_a134f8dd2b4d6c936215b14fbb2b5e718"><div class="ttname"><a href="struct_f_f_buffer_entry.html#a134f8dd2b4d6c936215b14fbb2b5e718">FFBufferEntry::ref</a></div><div class="ttdeci">AVBufferRef * ref</div><div class="ttdef"><b>Definition:</b> <a href="mmaldec_8c_source.html#l00048">mmaldec.c:48</a></div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.8.20
</small></address>
</body>
</html>
