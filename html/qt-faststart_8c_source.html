<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>My Project: E:/github/ffmpeg/tools/qt-faststart.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">My Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_737c44b861ba7ee498141742fb455fa8.html">ffmpeg</a></li><li class="navelem"><a class="el" href="dir_35ab9a54df7581f42e3bb98438d55297.html">tools</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">qt-faststart.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="qt-faststart_8c.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> * qt-faststart.c, v0.2</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> * by Mike Melanson (melanson@pcisys.net)</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> * This file is placed in the public domain. Use the program however you</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> * see fit.</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> * This utility rearranges a Quicktime file such that the moov atom</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> * is in front of the data, thus facilitating network streaming.</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> * To compile this program, start from the base directory from which you</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> * are building FFmpeg and type:</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> *  make tools/qt-faststart</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> * The qt-faststart program will be built in the tools/ directory. If you</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"> * do not build the program in this manner, correct results are not</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"> * guaranteed, particularly on 64-bit platforms.</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"> * Invoke the program with:</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"> *  qt-faststart &lt;infile.mov&gt; &lt;outfile.mov&gt;</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment"> * Notes: Quicktime files can come in many configurations of top-level</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment"> * atoms. This utility stipulates that the very last atom in the file needs</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment"> * to be a moov atom. When given such a file, this utility will rearrange</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment"> * the top-level atoms by shifting the moov atom from the back of the file</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment"> * to the front, and patch the chunk offsets along the way. This utility</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment"> * presently only operates on uncompressed moov atoms.</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160; </div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#include &lt;stdlib.h&gt;</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#include &lt;inttypes.h&gt;</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="limits_8h.html">limits.h</a>&gt;</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160; </div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor">#ifdef __MINGW32__</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="preprocessor">#undef fseeko</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#define fseeko(x, y, z) fseeko64(x, y, z)</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">#undef ftello</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="preprocessor">#define ftello(x)       ftello64(x)</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="preprocessor">#elif defined(_WIN32)</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="preprocessor">#undef fseeko</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="preprocessor">#define fseeko(x, y, z) _fseeki64(x, y, z)</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="preprocessor">#undef ftello</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="preprocessor">#define ftello(x)       _ftelli64(x)</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160; </div>
<div class="line"><a name="l00045"></a><span class="lineno"><a class="line" href="qt-faststart_8c.html#a3acffbd305ee72dcd4593c0d8af64a4f">   45</a></span>&#160;<span class="preprocessor">#define MIN(a,b) ((a) &gt; (b) ? (b) : (a))</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160; </div>
<div class="line"><a name="l00047"></a><span class="lineno"><a class="line" href="qt-faststart_8c.html#a7a5b192094510dd7965a713101748263">   47</a></span>&#160;<span class="preprocessor">#define BE_32(x) (((uint32_t)(((uint8_t*)(x))[0]) &lt;&lt; 24) |  \</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="preprocessor">                             (((uint8_t*)(x))[1]  &lt;&lt; 16) |  \</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="preprocessor">                             (((uint8_t*)(x))[2]  &lt;&lt;  8) |  \</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="preprocessor">                              ((uint8_t*)(x))[3])</span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160; </div>
<div class="line"><a name="l00052"></a><span class="lineno"><a class="line" href="qt-faststart_8c.html#a907890d95ca69f5c635709501dad78f8">   52</a></span>&#160;<span class="preprocessor">#define BE_64(x) (((uint64_t)(((uint8_t*)(x))[0]) &lt;&lt; 56) |  \</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="preprocessor">                  ((uint64_t)(((uint8_t*)(x))[1]) &lt;&lt; 48) |  \</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="preprocessor">                  ((uint64_t)(((uint8_t*)(x))[2]) &lt;&lt; 40) |  \</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="preprocessor">                  ((uint64_t)(((uint8_t*)(x))[3]) &lt;&lt; 32) |  \</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="preprocessor">                  ((uint64_t)(((uint8_t*)(x))[4]) &lt;&lt; 24) |  \</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="preprocessor">                  ((uint64_t)(((uint8_t*)(x))[5]) &lt;&lt; 16) |  \</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="preprocessor">                  ((uint64_t)(((uint8_t*)(x))[6]) &lt;&lt;  8) |  \</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="preprocessor">                  ((uint64_t)( (uint8_t*)(x))[7]))</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160; </div>
<div class="line"><a name="l00061"></a><span class="lineno"><a class="line" href="qt-faststart_8c.html#a36097280ddfe8ebfc825d0f98fd00621">   61</a></span>&#160;<span class="preprocessor">#define AV_WB32(p, val)    {                    \</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="preprocessor">    ((uint8_t*)(p))[0] = ((val) &gt;&gt; 24) &amp; 0xff;  \</span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="preprocessor">    ((uint8_t*)(p))[1] = ((val) &gt;&gt; 16) &amp; 0xff;  \</span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="preprocessor">    ((uint8_t*)(p))[2] = ((val) &gt;&gt; 8) &amp; 0xff;   \</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="preprocessor">    ((uint8_t*)(p))[3] = (val) &amp; 0xff;          \</span></div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="preprocessor">    }</span></div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160; </div>
<div class="line"><a name="l00068"></a><span class="lineno"><a class="line" href="qt-faststart_8c.html#afd2d38dbc4338142d73bbd42c59ac186">   68</a></span>&#160;<span class="preprocessor">#define AV_WB64(p, val)    {                    \</span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="preprocessor">    AV_WB32(p, (val) &gt;&gt; 32)                     \</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="preprocessor">    AV_WB32(p + 4, val)                         \</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="preprocessor">    }</span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160; </div>
<div class="line"><a name="l00073"></a><span class="lineno"><a class="line" href="qt-faststart_8c.html#af6b608458e916c7bffb5ac5446907a27">   73</a></span>&#160;<span class="preprocessor">#define BE_FOURCC(ch0, ch1, ch2, ch3)           \</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="preprocessor">    ( (uint32_t)(unsigned char)(ch3)        |   \</span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="preprocessor">     ((uint32_t)(unsigned char)(ch2) &lt;&lt;  8) |   \</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="preprocessor">     ((uint32_t)(unsigned char)(ch1) &lt;&lt; 16) |   \</span></div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="preprocessor">     ((uint32_t)(unsigned char)(ch0) &lt;&lt; 24) )</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160; </div>
<div class="line"><a name="l00079"></a><span class="lineno"><a class="line" href="qt-faststart_8c.html#ab7693303a7043379061d08764f735150">   79</a></span>&#160;<span class="preprocessor">#define QT_ATOM BE_FOURCC</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="comment">/* top level atoms */</span></div>
<div class="line"><a name="l00081"></a><span class="lineno"><a class="line" href="qt-faststart_8c.html#a6bf045f0c88b06dd007cdb539a9c54f1">   81</a></span>&#160;<span class="preprocessor">#define FREE_ATOM QT_ATOM(&#39;f&#39;, &#39;r&#39;, &#39;e&#39;, &#39;e&#39;)</span></div>
<div class="line"><a name="l00082"></a><span class="lineno"><a class="line" href="qt-faststart_8c.html#a3169ae1d2513ae1e7b414becc7af54f1">   82</a></span>&#160;<span class="preprocessor">#define JUNK_ATOM QT_ATOM(&#39;j&#39;, &#39;u&#39;, &#39;n&#39;, &#39;k&#39;)</span></div>
<div class="line"><a name="l00083"></a><span class="lineno"><a class="line" href="qt-faststart_8c.html#adc64660d2b0370dc42bb9d6d0e4e5c14">   83</a></span>&#160;<span class="preprocessor">#define MDAT_ATOM QT_ATOM(&#39;m&#39;, &#39;d&#39;, &#39;a&#39;, &#39;t&#39;)</span></div>
<div class="line"><a name="l00084"></a><span class="lineno"><a class="line" href="qt-faststart_8c.html#a3eec18e6a9a47ca5e1e68d85c0d75639">   84</a></span>&#160;<span class="preprocessor">#define MOOV_ATOM QT_ATOM(&#39;m&#39;, &#39;o&#39;, &#39;o&#39;, &#39;v&#39;)</span></div>
<div class="line"><a name="l00085"></a><span class="lineno"><a class="line" href="qt-faststart_8c.html#ae150bbd1d6a0617145edc3509a6d90b3">   85</a></span>&#160;<span class="preprocessor">#define PNOT_ATOM QT_ATOM(&#39;p&#39;, &#39;n&#39;, &#39;o&#39;, &#39;t&#39;)</span></div>
<div class="line"><a name="l00086"></a><span class="lineno"><a class="line" href="qt-faststart_8c.html#a1ff10592618d2e42dd3f59e411b2e828">   86</a></span>&#160;<span class="preprocessor">#define SKIP_ATOM QT_ATOM(&#39;s&#39;, &#39;k&#39;, &#39;i&#39;, &#39;p&#39;)</span></div>
<div class="line"><a name="l00087"></a><span class="lineno"><a class="line" href="qt-faststart_8c.html#a83218ba609a1bff3f0fb537b68a2aa1d">   87</a></span>&#160;<span class="preprocessor">#define WIDE_ATOM QT_ATOM(&#39;w&#39;, &#39;i&#39;, &#39;d&#39;, &#39;e&#39;)</span></div>
<div class="line"><a name="l00088"></a><span class="lineno"><a class="line" href="qt-faststart_8c.html#aa440f405a74bcff12d1f73f4c8db471a">   88</a></span>&#160;<span class="preprocessor">#define PICT_ATOM QT_ATOM(&#39;P&#39;, &#39;I&#39;, &#39;C&#39;, &#39;T&#39;)</span></div>
<div class="line"><a name="l00089"></a><span class="lineno"><a class="line" href="qt-faststart_8c.html#ae8c7f2db6658d4b53b3e89fc921683a3">   89</a></span>&#160;<span class="preprocessor">#define FTYP_ATOM QT_ATOM(&#39;f&#39;, &#39;t&#39;, &#39;y&#39;, &#39;p&#39;)</span></div>
<div class="line"><a name="l00090"></a><span class="lineno"><a class="line" href="qt-faststart_8c.html#afa669e884e3a82a166bf21d69a8dba5f">   90</a></span>&#160;<span class="preprocessor">#define UUID_ATOM QT_ATOM(&#39;u&#39;, &#39;u&#39;, &#39;i&#39;, &#39;d&#39;)</span></div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160; </div>
<div class="line"><a name="l00092"></a><span class="lineno"><a class="line" href="qt-faststart_8c.html#a06a50b69e8b9d8dc2140ef0eea43da8e">   92</a></span>&#160;<span class="preprocessor">#define CMOV_ATOM QT_ATOM(&#39;c&#39;, &#39;m&#39;, &#39;o&#39;, &#39;v&#39;)</span></div>
<div class="line"><a name="l00093"></a><span class="lineno"><a class="line" href="qt-faststart_8c.html#a167af3f605cbf3313138fb38d390251a">   93</a></span>&#160;<span class="preprocessor">#define TRAK_ATOM QT_ATOM(&#39;t&#39;, &#39;r&#39;, &#39;a&#39;, &#39;k&#39;)</span></div>
<div class="line"><a name="l00094"></a><span class="lineno"><a class="line" href="qt-faststart_8c.html#a4ee4bc38ad95c345d012662e876d7f88">   94</a></span>&#160;<span class="preprocessor">#define MDIA_ATOM QT_ATOM(&#39;m&#39;, &#39;d&#39;, &#39;i&#39;, &#39;a&#39;)</span></div>
<div class="line"><a name="l00095"></a><span class="lineno"><a class="line" href="qt-faststart_8c.html#a76e78f8113d8722f8614f7e670a5ef90">   95</a></span>&#160;<span class="preprocessor">#define MINF_ATOM QT_ATOM(&#39;m&#39;, &#39;i&#39;, &#39;n&#39;, &#39;f&#39;)</span></div>
<div class="line"><a name="l00096"></a><span class="lineno"><a class="line" href="qt-faststart_8c.html#a127d1a98c12f7fafc8856ba778551ccc">   96</a></span>&#160;<span class="preprocessor">#define STBL_ATOM QT_ATOM(&#39;s&#39;, &#39;t&#39;, &#39;b&#39;, &#39;l&#39;)</span></div>
<div class="line"><a name="l00097"></a><span class="lineno"><a class="line" href="qt-faststart_8c.html#a9405a1308c7a3468f5e418709636a3cc">   97</a></span>&#160;<span class="preprocessor">#define STCO_ATOM QT_ATOM(&#39;s&#39;, &#39;t&#39;, &#39;c&#39;, &#39;o&#39;)</span></div>
<div class="line"><a name="l00098"></a><span class="lineno"><a class="line" href="qt-faststart_8c.html#aac5ec4771d5f7fa6df35b9787c3c923e">   98</a></span>&#160;<span class="preprocessor">#define CO64_ATOM QT_ATOM(&#39;c&#39;, &#39;o&#39;, &#39;6&#39;, &#39;4&#39;)</span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160; </div>
<div class="line"><a name="l00100"></a><span class="lineno"><a class="line" href="qt-faststart_8c.html#a571b849cc58c2504cab9e14c25ede594">  100</a></span>&#160;<span class="preprocessor">#define ATOM_PREAMBLE_SIZE    8</span></div>
<div class="line"><a name="l00101"></a><span class="lineno"><a class="line" href="qt-faststart_8c.html#a5e6668951d81243b56eac18d35b16af6">  101</a></span>&#160;<span class="preprocessor">#define COPY_BUFFER_SIZE   33554432</span></div>
<div class="line"><a name="l00102"></a><span class="lineno"><a class="line" href="qt-faststart_8c.html#ac79504d3e52046bf36666e7b4fd68c70">  102</a></span>&#160;<span class="preprocessor">#define MAX_FTYP_ATOM_SIZE 1048576</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160; </div>
<div class="line"><a name="l00104"></a><span class="lineno"><a class="line" href="structatom__t.html">  104</a></span>&#160;<span class="keyword">typedef</span> <span class="keyword">struct </span>{</div>
<div class="line"><a name="l00105"></a><span class="lineno"><a class="line" href="structatom__t.html#ad3945ab6a522524a81fa82ea32cd0123">  105</a></span>&#160;    uint32_t <a class="code" href="structatom__t.html#ad3945ab6a522524a81fa82ea32cd0123">type</a>;</div>
<div class="line"><a name="l00106"></a><span class="lineno"><a class="line" href="structatom__t.html#aea013cd8b2d852f448f6342fbe9ed23f">  106</a></span>&#160;    uint32_t <a class="code" href="structatom__t.html#aea013cd8b2d852f448f6342fbe9ed23f">header_size</a>;</div>
<div class="line"><a name="l00107"></a><span class="lineno"><a class="line" href="structatom__t.html#a9bc25bc74841be26219cc35b9254b3da">  107</a></span>&#160;    uint64_t <a class="code" href="structatom__t.html#a9bc25bc74841be26219cc35b9254b3da">size</a>;</div>
<div class="line"><a name="l00108"></a><span class="lineno"><a class="line" href="structatom__t.html#a79414562bee38c919a3abaa266bddb1e">  108</a></span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *<a class="code" href="structatom__t.html#a79414562bee38c919a3abaa266bddb1e">data</a>;</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;} <a class="code" href="structatom__t.html">atom_t</a>;</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160; </div>
<div class="line"><a name="l00111"></a><span class="lineno"><a class="line" href="structupdate__chunk__offsets__context__t.html">  111</a></span>&#160;<span class="keyword">typedef</span> <span class="keyword">struct </span>{</div>
<div class="line"><a name="l00112"></a><span class="lineno"><a class="line" href="structupdate__chunk__offsets__context__t.html#a90e60526f0dca8c57e6d2525de722549">  112</a></span>&#160;    uint64_t <a class="code" href="structupdate__chunk__offsets__context__t.html#a90e60526f0dca8c57e6d2525de722549">moov_atom_size</a>;</div>
<div class="line"><a name="l00113"></a><span class="lineno"><a class="line" href="structupdate__chunk__offsets__context__t.html#ab014c2f07d149ffc3bb586abbef6b610">  113</a></span>&#160;    uint64_t <a class="code" href="structupdate__chunk__offsets__context__t.html#ab014c2f07d149ffc3bb586abbef6b610">stco_offset_count</a>;</div>
<div class="line"><a name="l00114"></a><span class="lineno"><a class="line" href="structupdate__chunk__offsets__context__t.html#a791d2f66221c42c5c848271ce9c0f6e5">  114</a></span>&#160;    uint64_t <a class="code" href="structupdate__chunk__offsets__context__t.html#a791d2f66221c42c5c848271ce9c0f6e5">stco_data_size</a>;</div>
<div class="line"><a name="l00115"></a><span class="lineno"><a class="line" href="structupdate__chunk__offsets__context__t.html#ad0d59b3d73ed18e00ca455c0b4906834">  115</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="structupdate__chunk__offsets__context__t.html#ad0d59b3d73ed18e00ca455c0b4906834">stco_overflow</a>;</div>
<div class="line"><a name="l00116"></a><span class="lineno"><a class="line" href="structupdate__chunk__offsets__context__t.html#a041a3ab829e8c7d378b532734d21aeab">  116</a></span>&#160;    uint32_t <a class="code" href="structupdate__chunk__offsets__context__t.html#a041a3ab829e8c7d378b532734d21aeab">depth</a>;</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;} <a class="code" href="structupdate__chunk__offsets__context__t.html">update_chunk_offsets_context_t</a>;</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160; </div>
<div class="line"><a name="l00119"></a><span class="lineno"><a class="line" href="structupgrade__stco__context__t.html">  119</a></span>&#160;<span class="keyword">typedef</span> <span class="keyword">struct </span>{</div>
<div class="line"><a name="l00120"></a><span class="lineno"><a class="line" href="structupgrade__stco__context__t.html#accdc087a21225bcd4c3e4d7f50a3ac6e">  120</a></span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *<a class="code" href="structupgrade__stco__context__t.html#accdc087a21225bcd4c3e4d7f50a3ac6e">dest</a>;</div>
<div class="line"><a name="l00121"></a><span class="lineno"><a class="line" href="structupgrade__stco__context__t.html#ad3db8fb52ff53e61c4004f688fe33d9f">  121</a></span>&#160;    uint64_t <a class="code" href="structupgrade__stco__context__t.html#ad3db8fb52ff53e61c4004f688fe33d9f">original_moov_size</a>;</div>
<div class="line"><a name="l00122"></a><span class="lineno"><a class="line" href="structupgrade__stco__context__t.html#a4c60b56d2da60f0e57bab054a1827145">  122</a></span>&#160;    uint64_t <a class="code" href="structupgrade__stco__context__t.html#a4c60b56d2da60f0e57bab054a1827145">new_moov_size</a>;</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;} <a class="code" href="structupgrade__stco__context__t.html">upgrade_stco_context_t</a>;</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160; </div>
<div class="line"><a name="l00125"></a><span class="lineno"><a class="line" href="qt-faststart_8c.html#aab213c1c3ebfcf29fb3790f14812f4f8">  125</a></span>&#160;<span class="keyword">typedef</span> <a class="code" href="ffmpeg__filter_8c.html#a61569f2965b7a369eb10b6d75d410d11">int</a> (*<a class="code" href="qt-faststart_8c.html#aab213c1c3ebfcf29fb3790f14812f4f8">parse_atoms_callback_t</a>)(<span class="keywordtype">void</span> *<a class="code" href="writing__filters_8txt.html#a5b5446e1f47af0c85ac6b45210d45117">context</a>, <a class="code" href="structatom__t.html">atom_t</a> *atom);</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160; </div>
<div class="line"><a name="l00127"></a><span class="lineno"><a class="line" href="qt-faststart_8c.html#afdcb72310b0c9908696708d74746a926">  127</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="qt-faststart_8c.html#afdcb72310b0c9908696708d74746a926">parse_atoms</a>(</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *buf,</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    uint64_t <a class="code" href="group__lavu__mem__funcs.html#ga34e10fdac079a9ca4512b8ccd7f20b8a">size</a>,</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    <a class="code" href="qt-faststart_8c.html#aab213c1c3ebfcf29fb3790f14812f4f8">parse_atoms_callback_t</a> <a class="code" href="dshow_8c.html#af7516efc6ebfbbc6f25e3ccbfbeec53f">callback</a>,</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    <span class="keywordtype">void</span> *<a class="code" href="writing__filters_8txt.html#a5b5446e1f47af0c85ac6b45210d45117">context</a>)</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;{</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *<a class="code" href="spdifenc_8c.html#addcb93d939ffa259ff1d9247bdd590fd">pos</a> = buf;</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *<a class="code" href="avrndec_8c.html#a13191ba45577b1d4f9b37d64df91eb55">end</a> = <a class="code" href="spdifenc_8c.html#addcb93d939ffa259ff1d9247bdd590fd">pos</a> + <a class="code" href="group__lavu__mem__funcs.html#ga34e10fdac079a9ca4512b8ccd7f20b8a">size</a>;</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    <a class="code" href="structatom__t.html">atom_t</a> atom;</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>;</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160; </div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    <span class="keywordflow">while</span> (<a class="code" href="avrndec_8c.html#a13191ba45577b1d4f9b37d64df91eb55">end</a> - <a class="code" href="spdifenc_8c.html#addcb93d939ffa259ff1d9247bdd590fd">pos</a> &gt;= <a class="code" href="qt-faststart_8c.html#a571b849cc58c2504cab9e14c25ede594">ATOM_PREAMBLE_SIZE</a>) {</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;        atom.<a class="code" href="structatom__t.html#a9bc25bc74841be26219cc35b9254b3da">size</a> = <a class="code" href="qt-faststart_8c.html#a7a5b192094510dd7965a713101748263">BE_32</a>(<a class="code" href="spdifenc_8c.html#addcb93d939ffa259ff1d9247bdd590fd">pos</a>);</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;        atom.<a class="code" href="structatom__t.html#ad3945ab6a522524a81fa82ea32cd0123">type</a> = <a class="code" href="qt-faststart_8c.html#a7a5b192094510dd7965a713101748263">BE_32</a>(<a class="code" href="spdifenc_8c.html#addcb93d939ffa259ff1d9247bdd590fd">pos</a> + 4);</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;        <a class="code" href="spdifenc_8c.html#addcb93d939ffa259ff1d9247bdd590fd">pos</a> += <a class="code" href="qt-faststart_8c.html#a571b849cc58c2504cab9e14c25ede594">ATOM_PREAMBLE_SIZE</a>;</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;        atom.<a class="code" href="structatom__t.html#aea013cd8b2d852f448f6342fbe9ed23f">header_size</a> = <a class="code" href="qt-faststart_8c.html#a571b849cc58c2504cab9e14c25ede594">ATOM_PREAMBLE_SIZE</a>;</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160; </div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;        <span class="keywordflow">switch</span> (atom.<a class="code" href="structatom__t.html#a9bc25bc74841be26219cc35b9254b3da">size</a>) {</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;        <span class="keywordflow">case</span> 1:</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="avrndec_8c.html#a13191ba45577b1d4f9b37d64df91eb55">end</a> - <a class="code" href="spdifenc_8c.html#addcb93d939ffa259ff1d9247bdd590fd">pos</a> &lt; 8) {</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;                fprintf(stderr, <span class="stringliteral">&quot;not enough room for 64 bit atom size\n&quot;</span>);</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;                <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;            }</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160; </div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;            atom.<a class="code" href="structatom__t.html#a9bc25bc74841be26219cc35b9254b3da">size</a> = <a class="code" href="qt-faststart_8c.html#a907890d95ca69f5c635709501dad78f8">BE_64</a>(<a class="code" href="spdifenc_8c.html#addcb93d939ffa259ff1d9247bdd590fd">pos</a>);</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;            <a class="code" href="spdifenc_8c.html#addcb93d939ffa259ff1d9247bdd590fd">pos</a> += 8;</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;            atom.<a class="code" href="structatom__t.html#aea013cd8b2d852f448f6342fbe9ed23f">header_size</a> = <a class="code" href="qt-faststart_8c.html#a571b849cc58c2504cab9e14c25ede594">ATOM_PREAMBLE_SIZE</a> + 8;</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160; </div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;        <span class="keywordflow">case</span> 0:</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;            atom.<a class="code" href="structatom__t.html#a9bc25bc74841be26219cc35b9254b3da">size</a> = <a class="code" href="qt-faststart_8c.html#a571b849cc58c2504cab9e14c25ede594">ATOM_PREAMBLE_SIZE</a> + <a class="code" href="avrndec_8c.html#a13191ba45577b1d4f9b37d64df91eb55">end</a> - <a class="code" href="spdifenc_8c.html#addcb93d939ffa259ff1d9247bdd590fd">pos</a>;</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;        }</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160; </div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;        <span class="keywordflow">if</span> (atom.<a class="code" href="structatom__t.html#a9bc25bc74841be26219cc35b9254b3da">size</a> &lt; atom.<a class="code" href="structatom__t.html#aea013cd8b2d852f448f6342fbe9ed23f">header_size</a>) {</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;            fprintf(stderr, <span class="stringliteral">&quot;atom size %&quot;</span>PRIu64<span class="stringliteral">&quot; too small\n&quot;</span>, atom.<a class="code" href="structatom__t.html#a9bc25bc74841be26219cc35b9254b3da">size</a>);</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;            <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;        }</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160; </div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;        atom.<a class="code" href="structatom__t.html#a9bc25bc74841be26219cc35b9254b3da">size</a> -= atom.<a class="code" href="structatom__t.html#aea013cd8b2d852f448f6342fbe9ed23f">header_size</a>;</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160; </div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;        <span class="keywordflow">if</span> (atom.<a class="code" href="structatom__t.html#a9bc25bc74841be26219cc35b9254b3da">size</a> &gt; <a class="code" href="avrndec_8c.html#a13191ba45577b1d4f9b37d64df91eb55">end</a> - <a class="code" href="spdifenc_8c.html#addcb93d939ffa259ff1d9247bdd590fd">pos</a>) {</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;            fprintf(stderr, <span class="stringliteral">&quot;atom size %&quot;</span>PRIu64<span class="stringliteral">&quot; too big\n&quot;</span>, atom.<a class="code" href="structatom__t.html#a9bc25bc74841be26219cc35b9254b3da">size</a>);</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;            <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;        }</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160; </div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;        atom.<a class="code" href="structatom__t.html#a79414562bee38c919a3abaa266bddb1e">data</a> = <a class="code" href="spdifenc_8c.html#addcb93d939ffa259ff1d9247bdd590fd">pos</a>;</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;        <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = <a class="code" href="dshow_8c.html#af7516efc6ebfbbc6f25e3ccbfbeec53f">callback</a>(<a class="code" href="writing__filters_8txt.html#a5b5446e1f47af0c85ac6b45210d45117">context</a>, &amp;atom);</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> &lt; 0) {</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>;</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;        }</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160; </div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;        <a class="code" href="spdifenc_8c.html#addcb93d939ffa259ff1d9247bdd590fd">pos</a> += atom.<a class="code" href="structatom__t.html#a9bc25bc74841be26219cc35b9254b3da">size</a>;</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    }</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160; </div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;}</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160; </div>
<div class="line"><a name="l00185"></a><span class="lineno"><a class="line" href="qt-faststart_8c.html#a65fa48f29e29e7800342d3bea951362f">  185</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="qt-faststart_8c.html#a65fa48f29e29e7800342d3bea951362f">update_stco_offsets</a>(<a class="code" href="structupdate__chunk__offsets__context__t.html">update_chunk_offsets_context_t</a> *<a class="code" href="writing__filters_8txt.html#a5b5446e1f47af0c85ac6b45210d45117">context</a>, <a class="code" href="structatom__t.html">atom_t</a> *atom)</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;{</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    uint32_t current_offset;</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    uint32_t offset_count;</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *<a class="code" href="spdifenc_8c.html#addcb93d939ffa259ff1d9247bdd590fd">pos</a>;</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *<a class="code" href="avrndec_8c.html#a13191ba45577b1d4f9b37d64df91eb55">end</a>;</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160; </div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    <a class="code" href="tablegen_8txt.html#a934618af0084fc36af687c3b11489b27">printf</a>(<span class="stringliteral">&quot; patching stco atom...\n&quot;</span>);</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    <span class="keywordflow">if</span> (atom-&gt;<a class="code" href="structatom__t.html#a9bc25bc74841be26219cc35b9254b3da">size</a> &lt; 8) {</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;        fprintf(stderr, <span class="stringliteral">&quot;stco atom size %&quot;</span>PRIu64<span class="stringliteral">&quot; too small\n&quot;</span>, atom-&gt;<a class="code" href="structatom__t.html#a9bc25bc74841be26219cc35b9254b3da">size</a>);</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;        <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    }</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160; </div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    offset_count = <a class="code" href="qt-faststart_8c.html#a7a5b192094510dd7965a713101748263">BE_32</a>(atom-&gt;<a class="code" href="structatom__t.html#a79414562bee38c919a3abaa266bddb1e">data</a> + 4);</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    <span class="keywordflow">if</span> (offset_count &gt; (atom-&gt;<a class="code" href="structatom__t.html#a9bc25bc74841be26219cc35b9254b3da">size</a> - 8) / 4) {</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;        fprintf(stderr, <span class="stringliteral">&quot;stco offset count %&quot;</span>PRIu32<span class="stringliteral">&quot; too big\n&quot;</span>, offset_count);</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;        <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    }</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160; </div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    <a class="code" href="writing__filters_8txt.html#a5b5446e1f47af0c85ac6b45210d45117">context</a>-&gt;stco_offset_count += offset_count;</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    <a class="code" href="writing__filters_8txt.html#a5b5446e1f47af0c85ac6b45210d45117">context</a>-&gt;stco_data_size += atom-&gt;<a class="code" href="structatom__t.html#a9bc25bc74841be26219cc35b9254b3da">size</a> - 8;</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160; </div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="spdifenc_8c.html#addcb93d939ffa259ff1d9247bdd590fd">pos</a> = atom-&gt;<a class="code" href="structatom__t.html#a79414562bee38c919a3abaa266bddb1e">data</a> + 8, <a class="code" href="avrndec_8c.html#a13191ba45577b1d4f9b37d64df91eb55">end</a> = <a class="code" href="spdifenc_8c.html#addcb93d939ffa259ff1d9247bdd590fd">pos</a> + offset_count * 4;</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;        <a class="code" href="spdifenc_8c.html#addcb93d939ffa259ff1d9247bdd590fd">pos</a> &lt; <a class="code" href="avrndec_8c.html#a13191ba45577b1d4f9b37d64df91eb55">end</a>;</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;        <a class="code" href="spdifenc_8c.html#addcb93d939ffa259ff1d9247bdd590fd">pos</a> += 4) {</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;        current_offset = <a class="code" href="qt-faststart_8c.html#a7a5b192094510dd7965a713101748263">BE_32</a>(<a class="code" href="spdifenc_8c.html#addcb93d939ffa259ff1d9247bdd590fd">pos</a>);</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;        <span class="keywordflow">if</span> (current_offset &gt; UINT_MAX - <a class="code" href="writing__filters_8txt.html#a5b5446e1f47af0c85ac6b45210d45117">context</a>-&gt;moov_atom_size) {</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;            <a class="code" href="writing__filters_8txt.html#a5b5446e1f47af0c85ac6b45210d45117">context</a>-&gt;stco_overflow = 1;</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;        }</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;        current_offset += <a class="code" href="writing__filters_8txt.html#a5b5446e1f47af0c85ac6b45210d45117">context</a>-&gt;moov_atom_size;</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;        <a class="code" href="qt-faststart_8c.html#a36097280ddfe8ebfc825d0f98fd00621">AV_WB32</a>(<a class="code" href="spdifenc_8c.html#addcb93d939ffa259ff1d9247bdd590fd">pos</a>, current_offset);</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    }</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160; </div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;}</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160; </div>
<div class="line"><a name="l00221"></a><span class="lineno"><a class="line" href="qt-faststart_8c.html#a8acabb6545a145767cd42e79f3cfa4a9">  221</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="qt-faststart_8c.html#a8acabb6545a145767cd42e79f3cfa4a9">update_co64_offsets</a>(<a class="code" href="structupdate__chunk__offsets__context__t.html">update_chunk_offsets_context_t</a> *<a class="code" href="writing__filters_8txt.html#a5b5446e1f47af0c85ac6b45210d45117">context</a>, <a class="code" href="structatom__t.html">atom_t</a> *atom)</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;{</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    uint64_t current_offset;</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    uint32_t offset_count;</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *<a class="code" href="spdifenc_8c.html#addcb93d939ffa259ff1d9247bdd590fd">pos</a>;</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *<a class="code" href="avrndec_8c.html#a13191ba45577b1d4f9b37d64df91eb55">end</a>;</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160; </div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    <a class="code" href="tablegen_8txt.html#a934618af0084fc36af687c3b11489b27">printf</a>(<span class="stringliteral">&quot; patching co64 atom...\n&quot;</span>);</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    <span class="keywordflow">if</span> (atom-&gt;<a class="code" href="structatom__t.html#a9bc25bc74841be26219cc35b9254b3da">size</a> &lt; 8) {</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;        fprintf(stderr, <span class="stringliteral">&quot;co64 atom size %&quot;</span>PRIu64<span class="stringliteral">&quot; too small\n&quot;</span>, atom-&gt;<a class="code" href="structatom__t.html#a9bc25bc74841be26219cc35b9254b3da">size</a>);</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;        <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    }</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160; </div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    offset_count = <a class="code" href="qt-faststart_8c.html#a7a5b192094510dd7965a713101748263">BE_32</a>(atom-&gt;<a class="code" href="structatom__t.html#a79414562bee38c919a3abaa266bddb1e">data</a> + 4);</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    <span class="keywordflow">if</span> (offset_count &gt; (atom-&gt;<a class="code" href="structatom__t.html#a9bc25bc74841be26219cc35b9254b3da">size</a> - 8) / 8) {</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;        fprintf(stderr, <span class="stringliteral">&quot;co64 offset count %&quot;</span>PRIu32<span class="stringliteral">&quot; too big\n&quot;</span>, offset_count);</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;        <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    }</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160; </div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="spdifenc_8c.html#addcb93d939ffa259ff1d9247bdd590fd">pos</a> = atom-&gt;<a class="code" href="structatom__t.html#a79414562bee38c919a3abaa266bddb1e">data</a> + 8, <a class="code" href="avrndec_8c.html#a13191ba45577b1d4f9b37d64df91eb55">end</a> = <a class="code" href="spdifenc_8c.html#addcb93d939ffa259ff1d9247bdd590fd">pos</a> + offset_count * 8;</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;        <a class="code" href="spdifenc_8c.html#addcb93d939ffa259ff1d9247bdd590fd">pos</a> &lt; <a class="code" href="avrndec_8c.html#a13191ba45577b1d4f9b37d64df91eb55">end</a>;</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;        <a class="code" href="spdifenc_8c.html#addcb93d939ffa259ff1d9247bdd590fd">pos</a> += 8) {</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;        current_offset = <a class="code" href="qt-faststart_8c.html#a907890d95ca69f5c635709501dad78f8">BE_64</a>(<a class="code" href="spdifenc_8c.html#addcb93d939ffa259ff1d9247bdd590fd">pos</a>);</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;        current_offset += <a class="code" href="writing__filters_8txt.html#a5b5446e1f47af0c85ac6b45210d45117">context</a>-&gt;moov_atom_size;</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;        <a class="code" href="qt-faststart_8c.html#afd2d38dbc4338142d73bbd42c59ac186">AV_WB64</a>(<a class="code" href="spdifenc_8c.html#addcb93d939ffa259ff1d9247bdd590fd">pos</a>, current_offset);</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    }</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160; </div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;}</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160; </div>
<div class="line"><a name="l00251"></a><span class="lineno"><a class="line" href="qt-faststart_8c.html#a06ce0375a17b52e0c381ab39e48be637">  251</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="qt-faststart_8c.html#a06ce0375a17b52e0c381ab39e48be637">update_chunk_offsets_callback</a>(<span class="keywordtype">void</span> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, <a class="code" href="structatom__t.html">atom_t</a> *atom)</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;{</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    <a class="code" href="structupdate__chunk__offsets__context__t.html">update_chunk_offsets_context_t</a> *<a class="code" href="writing__filters_8txt.html#a5b5446e1f47af0c85ac6b45210d45117">context</a> = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>;</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>;</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160; </div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    <span class="keywordflow">switch</span> (atom-&gt;<a class="code" href="structatom__t.html#ad3945ab6a522524a81fa82ea32cd0123">type</a>) {</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="qt-faststart_8c.html#a9405a1308c7a3468f5e418709636a3cc">STCO_ATOM</a>:</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="qt-faststart_8c.html#a65fa48f29e29e7800342d3bea951362f">update_stco_offsets</a>(<a class="code" href="writing__filters_8txt.html#a5b5446e1f47af0c85ac6b45210d45117">context</a>, atom);</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160; </div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="qt-faststart_8c.html#aac5ec4771d5f7fa6df35b9787c3c923e">CO64_ATOM</a>:</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="qt-faststart_8c.html#a8acabb6545a145767cd42e79f3cfa4a9">update_co64_offsets</a>(<a class="code" href="writing__filters_8txt.html#a5b5446e1f47af0c85ac6b45210d45117">context</a>, atom);</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160; </div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="qt-faststart_8c.html#a3eec18e6a9a47ca5e1e68d85c0d75639">MOOV_ATOM</a>:</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="qt-faststart_8c.html#a167af3f605cbf3313138fb38d390251a">TRAK_ATOM</a>:</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="qt-faststart_8c.html#a4ee4bc38ad95c345d012662e876d7f88">MDIA_ATOM</a>:</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="qt-faststart_8c.html#a76e78f8113d8722f8614f7e670a5ef90">MINF_ATOM</a>:</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="qt-faststart_8c.html#a127d1a98c12f7fafc8856ba778551ccc">STBL_ATOM</a>:</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;        <a class="code" href="writing__filters_8txt.html#a5b5446e1f47af0c85ac6b45210d45117">context</a>-&gt;depth++;</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="writing__filters_8txt.html#a5b5446e1f47af0c85ac6b45210d45117">context</a>-&gt;depth &gt; 10) {</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;            fprintf(stderr, <span class="stringliteral">&quot;atoms too deeply nested\n&quot;</span>);</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;            <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;        }</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160; </div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;        <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = <a class="code" href="qt-faststart_8c.html#afdcb72310b0c9908696708d74746a926">parse_atoms</a>(</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;            atom-&gt;<a class="code" href="structatom__t.html#a79414562bee38c919a3abaa266bddb1e">data</a>,</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;            atom-&gt;<a class="code" href="structatom__t.html#a9bc25bc74841be26219cc35b9254b3da">size</a>,</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;            <a class="code" href="qt-faststart_8c.html#a06ce0375a17b52e0c381ab39e48be637">update_chunk_offsets_callback</a>,</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;            <a class="code" href="writing__filters_8txt.html#a5b5446e1f47af0c85ac6b45210d45117">context</a>);</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;        <a class="code" href="writing__filters_8txt.html#a5b5446e1f47af0c85ac6b45210d45117">context</a>-&gt;depth--;</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>;</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    }</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160; </div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;}</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160; </div>
<div class="line"><a name="l00286"></a><span class="lineno"><a class="line" href="qt-faststart_8c.html#ae038a0da9bf061cb16ba4ee89b6debbc">  286</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="qt-faststart_8c.html#ae038a0da9bf061cb16ba4ee89b6debbc">set_atom_size</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *<a class="code" href="sdr2_8c.html#abd18f6ed7dc5da8824a97bc504e4280e">header</a>, uint32_t header_size, uint64_t <a class="code" href="group__lavu__mem__funcs.html#ga34e10fdac079a9ca4512b8ccd7f20b8a">size</a>)</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;{</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    <span class="keywordflow">switch</span> (header_size) {</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    <span class="keywordflow">case</span> 8:</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;        <a class="code" href="qt-faststart_8c.html#a36097280ddfe8ebfc825d0f98fd00621">AV_WB32</a>(<a class="code" href="sdr2_8c.html#abd18f6ed7dc5da8824a97bc504e4280e">header</a>, <a class="code" href="group__lavu__mem__funcs.html#ga34e10fdac079a9ca4512b8ccd7f20b8a">size</a>);</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160; </div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    <span class="keywordflow">case</span> 16:</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;        <a class="code" href="qt-faststart_8c.html#afd2d38dbc4338142d73bbd42c59ac186">AV_WB64</a>(<a class="code" href="sdr2_8c.html#abd18f6ed7dc5da8824a97bc504e4280e">header</a> + 8, <a class="code" href="group__lavu__mem__funcs.html#ga34e10fdac079a9ca4512b8ccd7f20b8a">size</a>);</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    }</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;}</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160; </div>
<div class="line"><a name="l00299"></a><span class="lineno"><a class="line" href="qt-faststart_8c.html#ac8e0a0bbd4f419793e06b8ac170a4259">  299</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="qt-faststart_8c.html#ac8e0a0bbd4f419793e06b8ac170a4259">upgrade_stco_atom</a>(<a class="code" href="structupgrade__stco__context__t.html">upgrade_stco_context_t</a> *<a class="code" href="writing__filters_8txt.html#a5b5446e1f47af0c85ac6b45210d45117">context</a>, <a class="code" href="structatom__t.html">atom_t</a> *atom)</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;{</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *<a class="code" href="spdifenc_8c.html#addcb93d939ffa259ff1d9247bdd590fd">pos</a>;</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *<a class="code" href="avrndec_8c.html#a13191ba45577b1d4f9b37d64df91eb55">end</a>;</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    uint64_t new_offset;</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    uint32_t offset_count;</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    uint32_t original_offset;</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160; </div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    <span class="comment">/* Note: not performing validations since they were performed on the first pass */</span></div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160; </div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    offset_count = <a class="code" href="qt-faststart_8c.html#a7a5b192094510dd7965a713101748263">BE_32</a>(atom-&gt;<a class="code" href="structatom__t.html#a79414562bee38c919a3abaa266bddb1e">data</a> + 4);</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160; </div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    <span class="comment">/* write the header */</span></div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    memcpy(<a class="code" href="writing__filters_8txt.html#a5b5446e1f47af0c85ac6b45210d45117">context</a>-&gt;dest, atom-&gt;<a class="code" href="structatom__t.html#a79414562bee38c919a3abaa266bddb1e">data</a> - atom-&gt;<a class="code" href="structatom__t.html#aea013cd8b2d852f448f6342fbe9ed23f">header_size</a>, atom-&gt;<a class="code" href="structatom__t.html#aea013cd8b2d852f448f6342fbe9ed23f">header_size</a> + 8);</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    <a class="code" href="qt-faststart_8c.html#a36097280ddfe8ebfc825d0f98fd00621">AV_WB32</a>(<a class="code" href="writing__filters_8txt.html#a5b5446e1f47af0c85ac6b45210d45117">context</a>-&gt;dest + 4, <a class="code" href="qt-faststart_8c.html#aac5ec4771d5f7fa6df35b9787c3c923e">CO64_ATOM</a>);</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    <a class="code" href="qt-faststart_8c.html#ae038a0da9bf061cb16ba4ee89b6debbc">set_atom_size</a>(<a class="code" href="writing__filters_8txt.html#a5b5446e1f47af0c85ac6b45210d45117">context</a>-&gt;dest, atom-&gt;<a class="code" href="structatom__t.html#aea013cd8b2d852f448f6342fbe9ed23f">header_size</a>, atom-&gt;<a class="code" href="structatom__t.html#aea013cd8b2d852f448f6342fbe9ed23f">header_size</a> + 8 + offset_count * 8);</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    <a class="code" href="writing__filters_8txt.html#a5b5446e1f47af0c85ac6b45210d45117">context</a>-&gt;dest += atom-&gt;<a class="code" href="structatom__t.html#aea013cd8b2d852f448f6342fbe9ed23f">header_size</a> + 8;</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160; </div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    <span class="comment">/* write the data */</span></div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="spdifenc_8c.html#addcb93d939ffa259ff1d9247bdd590fd">pos</a> = atom-&gt;<a class="code" href="structatom__t.html#a79414562bee38c919a3abaa266bddb1e">data</a> + 8, <a class="code" href="avrndec_8c.html#a13191ba45577b1d4f9b37d64df91eb55">end</a> = <a class="code" href="spdifenc_8c.html#addcb93d939ffa259ff1d9247bdd590fd">pos</a> + offset_count * 4;</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;        <a class="code" href="spdifenc_8c.html#addcb93d939ffa259ff1d9247bdd590fd">pos</a> &lt; <a class="code" href="avrndec_8c.html#a13191ba45577b1d4f9b37d64df91eb55">end</a>;</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;        <a class="code" href="spdifenc_8c.html#addcb93d939ffa259ff1d9247bdd590fd">pos</a> += 4) {</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;        original_offset = <a class="code" href="qt-faststart_8c.html#a7a5b192094510dd7965a713101748263">BE_32</a>(<a class="code" href="spdifenc_8c.html#addcb93d939ffa259ff1d9247bdd590fd">pos</a>) - <a class="code" href="writing__filters_8txt.html#a5b5446e1f47af0c85ac6b45210d45117">context</a>-&gt;original_moov_size;</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;        new_offset = (uint64_t)original_offset + <a class="code" href="writing__filters_8txt.html#a5b5446e1f47af0c85ac6b45210d45117">context</a>-&gt;new_moov_size;</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;        <a class="code" href="qt-faststart_8c.html#afd2d38dbc4338142d73bbd42c59ac186">AV_WB64</a>(<a class="code" href="writing__filters_8txt.html#a5b5446e1f47af0c85ac6b45210d45117">context</a>-&gt;dest, new_offset);</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;        <a class="code" href="writing__filters_8txt.html#a5b5446e1f47af0c85ac6b45210d45117">context</a>-&gt;dest += 8;</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    }</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;}</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160; </div>
<div class="line"><a name="l00328"></a><span class="lineno"><a class="line" href="qt-faststart_8c.html#ae2ac4eb72808699f9ee3f76fc3e5efcf">  328</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="qt-faststart_8c.html#ae2ac4eb72808699f9ee3f76fc3e5efcf">upgrade_stco_callback</a>(<span class="keywordtype">void</span> *<a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>, <a class="code" href="structatom__t.html">atom_t</a> *atom)</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;{</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    <a class="code" href="structupgrade__stco__context__t.html">upgrade_stco_context_t</a> *<a class="code" href="writing__filters_8txt.html#a5b5446e1f47af0c85ac6b45210d45117">context</a> = <a class="code" href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a>;</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *start_pos;</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    uint64_t copy_size;</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160; </div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    <span class="keywordflow">switch</span> (atom-&gt;<a class="code" href="structatom__t.html#ad3945ab6a522524a81fa82ea32cd0123">type</a>) {</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="qt-faststart_8c.html#a9405a1308c7a3468f5e418709636a3cc">STCO_ATOM</a>:</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;        <a class="code" href="qt-faststart_8c.html#ac8e0a0bbd4f419793e06b8ac170a4259">upgrade_stco_atom</a>(<a class="code" href="writing__filters_8txt.html#a5b5446e1f47af0c85ac6b45210d45117">context</a>, atom);</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160; </div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="qt-faststart_8c.html#a3eec18e6a9a47ca5e1e68d85c0d75639">MOOV_ATOM</a>:</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="qt-faststart_8c.html#a167af3f605cbf3313138fb38d390251a">TRAK_ATOM</a>:</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="qt-faststart_8c.html#a4ee4bc38ad95c345d012662e876d7f88">MDIA_ATOM</a>:</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="qt-faststart_8c.html#a76e78f8113d8722f8614f7e670a5ef90">MINF_ATOM</a>:</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="qt-faststart_8c.html#a127d1a98c12f7fafc8856ba778551ccc">STBL_ATOM</a>:</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;        <span class="comment">/* write the atom header */</span></div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;        memcpy(<a class="code" href="writing__filters_8txt.html#a5b5446e1f47af0c85ac6b45210d45117">context</a>-&gt;dest, atom-&gt;<a class="code" href="structatom__t.html#a79414562bee38c919a3abaa266bddb1e">data</a> - atom-&gt;<a class="code" href="structatom__t.html#aea013cd8b2d852f448f6342fbe9ed23f">header_size</a>, atom-&gt;<a class="code" href="structatom__t.html#aea013cd8b2d852f448f6342fbe9ed23f">header_size</a>);</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;        start_pos = <a class="code" href="writing__filters_8txt.html#a5b5446e1f47af0c85ac6b45210d45117">context</a>-&gt;dest;</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;        <a class="code" href="writing__filters_8txt.html#a5b5446e1f47af0c85ac6b45210d45117">context</a>-&gt;dest += atom-&gt;<a class="code" href="structatom__t.html#aea013cd8b2d852f448f6342fbe9ed23f">header_size</a>;</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160; </div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;        <span class="comment">/* parse internal atoms*/</span></div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="qt-faststart_8c.html#afdcb72310b0c9908696708d74746a926">parse_atoms</a>(</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;            atom-&gt;<a class="code" href="structatom__t.html#a79414562bee38c919a3abaa266bddb1e">data</a>,</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;            atom-&gt;<a class="code" href="structatom__t.html#a9bc25bc74841be26219cc35b9254b3da">size</a>,</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;            <a class="code" href="qt-faststart_8c.html#ae2ac4eb72808699f9ee3f76fc3e5efcf">upgrade_stco_callback</a>,</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;            <a class="code" href="writing__filters_8txt.html#a5b5446e1f47af0c85ac6b45210d45117">context</a>) &lt; 0) {</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;            <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;        }</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160; </div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;        <span class="comment">/* update the atom size */</span></div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;        <a class="code" href="qt-faststart_8c.html#ae038a0da9bf061cb16ba4ee89b6debbc">set_atom_size</a>(start_pos, atom-&gt;<a class="code" href="structatom__t.html#aea013cd8b2d852f448f6342fbe9ed23f">header_size</a>, <a class="code" href="writing__filters_8txt.html#a5b5446e1f47af0c85ac6b45210d45117">context</a>-&gt;dest - start_pos);</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160; </div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;        copy_size = atom-&gt;<a class="code" href="structatom__t.html#aea013cd8b2d852f448f6342fbe9ed23f">header_size</a> + atom-&gt;<a class="code" href="structatom__t.html#a9bc25bc74841be26219cc35b9254b3da">size</a>;</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;        memcpy(<a class="code" href="writing__filters_8txt.html#a5b5446e1f47af0c85ac6b45210d45117">context</a>-&gt;dest, atom-&gt;<a class="code" href="structatom__t.html#a79414562bee38c919a3abaa266bddb1e">data</a> - atom-&gt;<a class="code" href="structatom__t.html#aea013cd8b2d852f448f6342fbe9ed23f">header_size</a>, copy_size);</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;        <a class="code" href="writing__filters_8txt.html#a5b5446e1f47af0c85ac6b45210d45117">context</a>-&gt;dest += copy_size;</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    }</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160; </div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;}</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160; </div>
<div class="line"><a name="l00372"></a><span class="lineno"><a class="line" href="qt-faststart_8c.html#ab0882ba7cea059e7147c6e30dd5cd3bd">  372</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="qt-faststart_8c.html#ab0882ba7cea059e7147c6e30dd5cd3bd">update_moov_atom</a>(</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> **moov_atom,</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    uint64_t *moov_atom_size)</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;{</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    <a class="code" href="structupdate__chunk__offsets__context__t.html">update_chunk_offsets_context_t</a> <a class="code" href="vf__vignette_8c.html#a8605729a6adf50f5a6da18c77b36f1b6">update_context</a> = { 0 };</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;    <a class="code" href="structupgrade__stco__context__t.html">upgrade_stco_context_t</a> upgrade_context;</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *new_moov_atom;</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160; </div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    <a class="code" href="vf__vignette_8c.html#a8605729a6adf50f5a6da18c77b36f1b6">update_context</a>.moov_atom_size = *moov_atom_size;</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160; </div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="qt-faststart_8c.html#afdcb72310b0c9908696708d74746a926">parse_atoms</a>(</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;        *moov_atom,</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;        *moov_atom_size,</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;        <a class="code" href="qt-faststart_8c.html#a06ce0375a17b52e0c381ab39e48be637">update_chunk_offsets_callback</a>,</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;        &amp;<a class="code" href="vf__vignette_8c.html#a8605729a6adf50f5a6da18c77b36f1b6">update_context</a>) &lt; 0) {</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;        <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;    }</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160; </div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="vf__vignette_8c.html#a8605729a6adf50f5a6da18c77b36f1b6">update_context</a>.stco_overflow) {</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    }</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160; </div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    <a class="code" href="tablegen_8txt.html#a934618af0084fc36af687c3b11489b27">printf</a>(<span class="stringliteral">&quot; upgrading stco atoms to co64...\n&quot;</span>);</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    upgrade_context.<a class="code" href="structupgrade__stco__context__t.html#a4c60b56d2da60f0e57bab054a1827145">new_moov_size</a> = *moov_atom_size +</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;        <a class="code" href="vf__vignette_8c.html#a8605729a6adf50f5a6da18c77b36f1b6">update_context</a>.stco_offset_count * 8 -</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;        <a class="code" href="vf__vignette_8c.html#a8605729a6adf50f5a6da18c77b36f1b6">update_context</a>.stco_data_size;</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160; </div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    new_moov_atom = malloc(upgrade_context.<a class="code" href="structupgrade__stco__context__t.html#a4c60b56d2da60f0e57bab054a1827145">new_moov_size</a>);</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    <span class="keywordflow">if</span> (new_moov_atom == <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;        fprintf(stderr, <span class="stringliteral">&quot;could not allocate %&quot;</span>PRIu64<span class="stringliteral">&quot; bytes for updated moov atom\n&quot;</span>,</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;            upgrade_context.<a class="code" href="structupgrade__stco__context__t.html#a4c60b56d2da60f0e57bab054a1827145">new_moov_size</a>);</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;        <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    }</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160; </div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;    upgrade_context.<a class="code" href="structupgrade__stco__context__t.html#ad3db8fb52ff53e61c4004f688fe33d9f">original_moov_size</a> = *moov_atom_size;</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;    upgrade_context.<a class="code" href="structupgrade__stco__context__t.html#accdc087a21225bcd4c3e4d7f50a3ac6e">dest</a> = new_moov_atom;</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160; </div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="qt-faststart_8c.html#afdcb72310b0c9908696708d74746a926">parse_atoms</a>(</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;        *moov_atom,</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;        *moov_atom_size,</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;        <a class="code" href="qt-faststart_8c.html#ae2ac4eb72808699f9ee3f76fc3e5efcf">upgrade_stco_callback</a>,</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;        &amp;upgrade_context) &lt; 0) {</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;        free(new_moov_atom);</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;        <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    }</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160; </div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;    free(*moov_atom);</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;    *moov_atom = new_moov_atom;</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;    *moov_atom_size = upgrade_context.<a class="code" href="structupgrade__stco__context__t.html#a4c60b56d2da60f0e57bab054a1827145">new_moov_size</a>;</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160; </div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;    <span class="keywordflow">if</span> (upgrade_context.<a class="code" href="structupgrade__stco__context__t.html#accdc087a21225bcd4c3e4d7f50a3ac6e">dest</a> != *moov_atom + *moov_atom_size) {</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;        fprintf(stderr, <span class="stringliteral">&quot;unexpected - wrong number of moov bytes written\n&quot;</span>);</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;        <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    }</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160; </div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;}</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160; </div>
<div class="line"><a name="l00430"></a><span class="lineno"><a class="line" href="qt-faststart_8c.html#a0ddf1224851353fc92bfbff6f499fa97">  430</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="qt-faststart_8c.html#a0ddf1224851353fc92bfbff6f499fa97">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;{</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    FILE *infile  = <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    FILE *<a class="code" href="audiogen_8c.html#ae581849c67336453bd5b81e6518019a9">outfile</a> = <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> atom_bytes[<a class="code" href="qt-faststart_8c.html#a571b849cc58c2504cab9e14c25ede594">ATOM_PREAMBLE_SIZE</a>];</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;    uint32_t atom_type   = 0;</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    uint64_t atom_size   = 0;</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;    uint64_t atom_offset = 0;</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    int64_t last_offset;</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *moov_atom = <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *ftyp_atom = <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    uint64_t moov_atom_size;</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;    uint64_t ftyp_atom_size = 0;</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;    int64_t start_offset = 0;</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *copy_buffer = <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    <span class="keywordtype">int</span> bytes_to_copy;</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    uint64_t free_size = 0;</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    uint64_t moov_size = 0;</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160; </div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    <span class="keywordflow">if</span> (argc != 3) {</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;        <a class="code" href="tablegen_8txt.html#a934618af0084fc36af687c3b11489b27">printf</a>(<span class="stringliteral">&quot;Usage: qt-faststart &lt;infile.mov&gt; &lt;outfile.mov&gt;\n&quot;</span></div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;               <span class="stringliteral">&quot;Note: alternatively you can use -movflags +faststart in ffmpeg\n&quot;</span>);</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    }</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160; </div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    <span class="keywordflow">if</span> (!strcmp(argv[1], argv[2])) {</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;        fprintf(stderr, <span class="stringliteral">&quot;input and output files need to be different\n&quot;</span>);</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;        <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    }</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160; </div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;    infile = fopen(argv[1], <span class="stringliteral">&quot;rb&quot;</span>);</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;    <span class="keywordflow">if</span> (!infile) {</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;        perror(argv[1]);</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;        <span class="keywordflow">goto</span> error_out;</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;    }</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160; </div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;    <span class="comment">/* traverse through the atoms in the file to make sure that &#39;moov&#39; is</span></div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;<span class="comment">     * at the end */</span></div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    <span class="keywordflow">while</span> (!feof(infile)) {</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;        <span class="keywordflow">if</span> (fread(atom_bytes, <a class="code" href="qt-faststart_8c.html#a571b849cc58c2504cab9e14c25ede594">ATOM_PREAMBLE_SIZE</a>, 1, infile) != 1) {</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;        }</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;        atom_size = <a class="code" href="qt-faststart_8c.html#a7a5b192094510dd7965a713101748263">BE_32</a>(&amp;atom_bytes[0]);</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;        atom_type = <a class="code" href="qt-faststart_8c.html#a7a5b192094510dd7965a713101748263">BE_32</a>(&amp;atom_bytes[4]);</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160; </div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;        <span class="comment">/* keep ftyp atom */</span></div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;        <span class="keywordflow">if</span> (atom_type == <a class="code" href="qt-faststart_8c.html#ae8c7f2db6658d4b53b3e89fc921683a3">FTYP_ATOM</a>) {</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;            <span class="keywordflow">if</span> (atom_size &gt; <a class="code" href="qt-faststart_8c.html#ac79504d3e52046bf36666e7b4fd68c70">MAX_FTYP_ATOM_SIZE</a>) {</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;                fprintf(stderr, <span class="stringliteral">&quot;ftyp atom size %&quot;</span>PRIu64<span class="stringliteral">&quot; too big\n&quot;</span>,</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;                       atom_size);</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;                <span class="keywordflow">goto</span> error_out;</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;            }</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;            ftyp_atom_size = atom_size;</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;            free(ftyp_atom);</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;            ftyp_atom = malloc(ftyp_atom_size);</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;            <span class="keywordflow">if</span> (!ftyp_atom) {</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;                fprintf(stderr, <span class="stringliteral">&quot;could not allocate %&quot;</span>PRIu64<span class="stringliteral">&quot; bytes for ftyp atom\n&quot;</span>,</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;                       atom_size);</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;                <span class="keywordflow">goto</span> error_out;</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;            }</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;            <span class="keywordflow">if</span> (fseeko(infile, -<a class="code" href="qt-faststart_8c.html#a571b849cc58c2504cab9e14c25ede594">ATOM_PREAMBLE_SIZE</a>, SEEK_CUR) ||</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;                fread(ftyp_atom, atom_size, 1, infile) != 1 ||</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;                (start_offset = ftello(infile)) &lt; 0) {</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;                perror(argv[1]);</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;                <span class="keywordflow">goto</span> error_out;</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;            }</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;            <span class="keywordtype">int</span> <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>;</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;            <span class="comment">/* 64-bit special case */</span></div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;            <span class="keywordflow">if</span> (atom_size == 1) {</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;                <span class="keywordflow">if</span> (fread(atom_bytes, <a class="code" href="qt-faststart_8c.html#a571b849cc58c2504cab9e14c25ede594">ATOM_PREAMBLE_SIZE</a>, 1, infile) != 1) {</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;                }</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;                atom_size = <a class="code" href="qt-faststart_8c.html#a907890d95ca69f5c635709501dad78f8">BE_64</a>(&amp;atom_bytes[0]);</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;                <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = fseeko(infile, atom_size - <a class="code" href="qt-faststart_8c.html#a571b849cc58c2504cab9e14c25ede594">ATOM_PREAMBLE_SIZE</a> * 2, SEEK_CUR);</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;                <a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a> = fseeko(infile, atom_size - <a class="code" href="qt-faststart_8c.html#a571b849cc58c2504cab9e14c25ede594">ATOM_PREAMBLE_SIZE</a>, SEEK_CUR);</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;            }</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a>) {</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;                perror(argv[1]);</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;                <span class="keywordflow">goto</span> error_out;</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;            }</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;        }</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;        <a class="code" href="tablegen_8txt.html#a934618af0084fc36af687c3b11489b27">printf</a>(<span class="stringliteral">&quot;%c%c%c%c %10&quot;</span>PRIu64<span class="stringliteral">&quot; %&quot;</span>PRIu64<span class="stringliteral">&quot;\n&quot;</span>,</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;               (atom_type &gt;&gt; 24) &amp; 255,</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;               (atom_type &gt;&gt; 16) &amp; 255,</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;               (atom_type &gt;&gt;  8) &amp; 255,</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;               (atom_type &gt;&gt;  0) &amp; 255,</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;               atom_offset,</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;               atom_size);</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;        <span class="keywordflow">if</span> ((atom_type != <a class="code" href="qt-faststart_8c.html#a6bf045f0c88b06dd007cdb539a9c54f1">FREE_ATOM</a>) &amp;&amp;</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;            (atom_type != <a class="code" href="qt-faststart_8c.html#a3169ae1d2513ae1e7b414becc7af54f1">JUNK_ATOM</a>) &amp;&amp;</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;            (atom_type != <a class="code" href="qt-faststart_8c.html#adc64660d2b0370dc42bb9d6d0e4e5c14">MDAT_ATOM</a>) &amp;&amp;</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;            (atom_type != <a class="code" href="qt-faststart_8c.html#a3eec18e6a9a47ca5e1e68d85c0d75639">MOOV_ATOM</a>) &amp;&amp;</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;            (atom_type != <a class="code" href="qt-faststart_8c.html#ae150bbd1d6a0617145edc3509a6d90b3">PNOT_ATOM</a>) &amp;&amp;</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;            (atom_type != <a class="code" href="qt-faststart_8c.html#a1ff10592618d2e42dd3f59e411b2e828">SKIP_ATOM</a>) &amp;&amp;</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;            (atom_type != <a class="code" href="qt-faststart_8c.html#a83218ba609a1bff3f0fb537b68a2aa1d">WIDE_ATOM</a>) &amp;&amp;</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;            (atom_type != <a class="code" href="qt-faststart_8c.html#aa440f405a74bcff12d1f73f4c8db471a">PICT_ATOM</a>) &amp;&amp;</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;            (atom_type != <a class="code" href="qt-faststart_8c.html#afa669e884e3a82a166bf21d69a8dba5f">UUID_ATOM</a>) &amp;&amp;</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;            (atom_type != <a class="code" href="qt-faststart_8c.html#ae8c7f2db6658d4b53b3e89fc921683a3">FTYP_ATOM</a>)) {</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;            fprintf(stderr, <span class="stringliteral">&quot;encountered non-QT top-level atom (is this a QuickTime file?)\n&quot;</span>);</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;        }</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;        atom_offset += atom_size;</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160; </div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;        <span class="comment">/* The atom header is 8 (or 16 bytes), if the atom size (which</span></div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;<span class="comment">         * includes these 8 or 16 bytes) is less than that, we won&#39;t be</span></div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;<span class="comment">         * able to continue scanning sensibly after this atom, so break. */</span></div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;        <span class="keywordflow">if</span> (atom_size &lt; 8)</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160; </div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;        <span class="keywordflow">if</span> (atom_type == <a class="code" href="qt-faststart_8c.html#a3eec18e6a9a47ca5e1e68d85c0d75639">MOOV_ATOM</a>)</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;            moov_size = atom_size;</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160; </div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;        <span class="keywordflow">if</span> (moov_size &amp;&amp; atom_type == <a class="code" href="qt-faststart_8c.html#a6bf045f0c88b06dd007cdb539a9c54f1">FREE_ATOM</a>) {</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;            free_size += atom_size;</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;            atom_type = <a class="code" href="qt-faststart_8c.html#a3eec18e6a9a47ca5e1e68d85c0d75639">MOOV_ATOM</a>;</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;            atom_size = moov_size;</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;        }</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;    }</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160; </div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;    <span class="keywordflow">if</span> (atom_type != <a class="code" href="qt-faststart_8c.html#a3eec18e6a9a47ca5e1e68d85c0d75639">MOOV_ATOM</a>) {</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;        <a class="code" href="tablegen_8txt.html#a934618af0084fc36af687c3b11489b27">printf</a>(<span class="stringliteral">&quot;last atom in file was not a moov atom\n&quot;</span>);</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;        free(ftyp_atom);</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;        fclose(infile);</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;    }</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160; </div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;    <span class="keywordflow">if</span> (atom_size &lt; 16) {</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;        fprintf(stderr, <span class="stringliteral">&quot;bad moov atom size\n&quot;</span>);</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;        <span class="keywordflow">goto</span> error_out;</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;    }</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160; </div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;    <span class="comment">/* moov atom was, in fact, the last atom in the chunk; load the whole</span></div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;<span class="comment">     * moov atom */</span></div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;    <span class="keywordflow">if</span> (fseeko(infile, -(atom_size + free_size), SEEK_END)) {</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;        perror(argv[1]);</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;        <span class="keywordflow">goto</span> error_out;</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;    }</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;    last_offset    = ftello(infile);</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;    <span class="keywordflow">if</span> (last_offset &lt; 0) {</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;        perror(argv[1]);</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;        <span class="keywordflow">goto</span> error_out;</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;    }</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;    moov_atom_size = atom_size;</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;    moov_atom      = malloc(moov_atom_size);</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;    <span class="keywordflow">if</span> (!moov_atom) {</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;        fprintf(stderr, <span class="stringliteral">&quot;could not allocate %&quot;</span>PRIu64<span class="stringliteral">&quot; bytes for moov atom\n&quot;</span>, atom_size);</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;        <span class="keywordflow">goto</span> error_out;</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;    }</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;    <span class="keywordflow">if</span> (fread(moov_atom, atom_size, 1, infile) != 1) {</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;        perror(argv[1]);</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;        <span class="keywordflow">goto</span> error_out;</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;    }</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160; </div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;    <span class="comment">/* this utility does not support compressed atoms yet, so disqualify</span></div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;<span class="comment">     * files with compressed QT atoms */</span></div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="qt-faststart_8c.html#a7a5b192094510dd7965a713101748263">BE_32</a>(&amp;moov_atom[12]) == <a class="code" href="qt-faststart_8c.html#a06a50b69e8b9d8dc2140ef0eea43da8e">CMOV_ATOM</a>) {</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;        fprintf(stderr, <span class="stringliteral">&quot;this utility does not support compressed moov atoms yet\n&quot;</span>);</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;        <span class="keywordflow">goto</span> error_out;</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;    }</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160; </div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;    <span class="comment">/* close; will be re-opened later */</span></div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;    fclose(infile);</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;    infile = <a class="code" href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160; </div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="qt-faststart_8c.html#ab0882ba7cea059e7147c6e30dd5cd3bd">update_moov_atom</a>(&amp;moov_atom, &amp;moov_atom_size) &lt; 0) {</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;        <span class="keywordflow">goto</span> error_out;</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;    }</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160; </div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;    <span class="comment">/* re-open the input file and open the output file */</span></div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;    infile = fopen(argv[1], <span class="stringliteral">&quot;rb&quot;</span>);</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;    <span class="keywordflow">if</span> (!infile) {</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;        perror(argv[1]);</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;        <span class="keywordflow">goto</span> error_out;</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;    }</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160; </div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;    <span class="keywordflow">if</span> (start_offset &gt; 0) { <span class="comment">/* seek after ftyp atom */</span></div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;        <span class="keywordflow">if</span> (fseeko(infile, start_offset, SEEK_SET)) {</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;            perror(argv[1]);</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;            <span class="keywordflow">goto</span> error_out;</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;        }</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160; </div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;        last_offset -= start_offset;</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;    }</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160; </div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;    <a class="code" href="audiogen_8c.html#ae581849c67336453bd5b81e6518019a9">outfile</a> = fopen(argv[2], <span class="stringliteral">&quot;wb&quot;</span>);</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="audiogen_8c.html#ae581849c67336453bd5b81e6518019a9">outfile</a>) {</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;        perror(argv[2]);</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;        <span class="keywordflow">goto</span> error_out;</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;    }</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160; </div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;    <span class="comment">/* dump the same ftyp atom */</span></div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;    <span class="keywordflow">if</span> (ftyp_atom_size &gt; 0) {</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;        <a class="code" href="tablegen_8txt.html#a934618af0084fc36af687c3b11489b27">printf</a>(<span class="stringliteral">&quot; writing ftyp atom...\n&quot;</span>);</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;        <span class="keywordflow">if</span> (fwrite(ftyp_atom, ftyp_atom_size, 1, <a class="code" href="audiogen_8c.html#ae581849c67336453bd5b81e6518019a9">outfile</a>) != 1) {</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;            perror(argv[2]);</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;            <span class="keywordflow">goto</span> error_out;</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;        }</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;    }</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160; </div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;    <span class="comment">/* dump the new moov atom */</span></div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;    <a class="code" href="tablegen_8txt.html#a934618af0084fc36af687c3b11489b27">printf</a>(<span class="stringliteral">&quot; writing moov atom...\n&quot;</span>);</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;    <span class="keywordflow">if</span> (fwrite(moov_atom, moov_atom_size, 1, <a class="code" href="audiogen_8c.html#ae581849c67336453bd5b81e6518019a9">outfile</a>) != 1) {</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;        perror(argv[2]);</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;        <span class="keywordflow">goto</span> error_out;</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;    }</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160; </div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;    <span class="comment">/* copy the remainder of the infile, from offset 0 -&gt; last_offset - 1 */</span></div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;    bytes_to_copy = <a class="code" href="qt-faststart_8c.html#a3acffbd305ee72dcd4593c0d8af64a4f">MIN</a>(<a class="code" href="qt-faststart_8c.html#a5e6668951d81243b56eac18d35b16af6">COPY_BUFFER_SIZE</a>, last_offset);</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;    copy_buffer = malloc(bytes_to_copy);</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;    <span class="keywordflow">if</span> (!copy_buffer) {</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;        fprintf(stderr, <span class="stringliteral">&quot;could not allocate %d bytes for copy_buffer\n&quot;</span>, bytes_to_copy);</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;        <span class="keywordflow">goto</span> error_out;</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;    }</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;    <a class="code" href="tablegen_8txt.html#a934618af0084fc36af687c3b11489b27">printf</a>(<span class="stringliteral">&quot; copying rest of file...\n&quot;</span>);</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;    <span class="keywordflow">while</span> (last_offset) {</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;        bytes_to_copy = <a class="code" href="qt-faststart_8c.html#a3acffbd305ee72dcd4593c0d8af64a4f">MIN</a>(bytes_to_copy, last_offset);</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160; </div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;        <span class="keywordflow">if</span> (fread(copy_buffer, bytes_to_copy, 1, infile) != 1) {</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;            perror(argv[1]);</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;            <span class="keywordflow">goto</span> error_out;</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;        }</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;        <span class="keywordflow">if</span> (fwrite(copy_buffer, bytes_to_copy, 1, <a class="code" href="audiogen_8c.html#ae581849c67336453bd5b81e6518019a9">outfile</a>) != 1) {</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;            perror(argv[2]);</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;            <span class="keywordflow">goto</span> error_out;</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;        }</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;        last_offset -= bytes_to_copy;</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;    }</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160; </div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;    fclose(infile);</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;    fclose(<a class="code" href="audiogen_8c.html#ae581849c67336453bd5b81e6518019a9">outfile</a>);</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;    free(moov_atom);</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;    free(ftyp_atom);</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;    free(copy_buffer);</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160; </div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160; </div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;error_out:</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;    <span class="keywordflow">if</span> (infile)</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;        fclose(infile);</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="audiogen_8c.html#ae581849c67336453bd5b81e6518019a9">outfile</a>)</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;        fclose(<a class="code" href="audiogen_8c.html#ae581849c67336453bd5b81e6518019a9">outfile</a>);</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;    free(moov_atom);</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;    free(ftyp_atom);</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;    free(copy_buffer);</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;    <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;}</div>
</div><!-- fragment --></div><!-- contents -->
<div class="ttc" id="aqt-faststart_8c_html_a907890d95ca69f5c635709501dad78f8"><div class="ttname"><a href="qt-faststart_8c.html#a907890d95ca69f5c635709501dad78f8">BE_64</a></div><div class="ttdeci">#define BE_64(x)</div><div class="ttdef"><b>Definition:</b> <a href="qt-faststart_8c_source.html#l00052">qt-faststart.c:52</a></div></div>
<div class="ttc" id="aqt-faststart_8c_html_adc64660d2b0370dc42bb9d6d0e4e5c14"><div class="ttname"><a href="qt-faststart_8c.html#adc64660d2b0370dc42bb9d6d0e4e5c14">MDAT_ATOM</a></div><div class="ttdeci">#define MDAT_ATOM</div><div class="ttdef"><b>Definition:</b> <a href="qt-faststart_8c_source.html#l00083">qt-faststart.c:83</a></div></div>
<div class="ttc" id="aqt-faststart_8c_html_a9405a1308c7a3468f5e418709636a3cc"><div class="ttname"><a href="qt-faststart_8c.html#a9405a1308c7a3468f5e418709636a3cc">STCO_ATOM</a></div><div class="ttdeci">#define STCO_ATOM</div><div class="ttdef"><b>Definition:</b> <a href="qt-faststart_8c_source.html#l00097">qt-faststart.c:97</a></div></div>
<div class="ttc" id="aqt-faststart_8c_html_ae150bbd1d6a0617145edc3509a6d90b3"><div class="ttname"><a href="qt-faststart_8c.html#ae150bbd1d6a0617145edc3509a6d90b3">PNOT_ATOM</a></div><div class="ttdeci">#define PNOT_ATOM</div><div class="ttdef"><b>Definition:</b> <a href="qt-faststart_8c_source.html#l00085">qt-faststart.c:85</a></div></div>
<div class="ttc" id="aqt-faststart_8c_html_a1ff10592618d2e42dd3f59e411b2e828"><div class="ttname"><a href="qt-faststart_8c.html#a1ff10592618d2e42dd3f59e411b2e828">SKIP_ATOM</a></div><div class="ttdeci">#define SKIP_ATOM</div><div class="ttdef"><b>Definition:</b> <a href="qt-faststart_8c_source.html#l00086">qt-faststart.c:86</a></div></div>
<div class="ttc" id="aqt-faststart_8c_html_ac79504d3e52046bf36666e7b4fd68c70"><div class="ttname"><a href="qt-faststart_8c.html#ac79504d3e52046bf36666e7b4fd68c70">MAX_FTYP_ATOM_SIZE</a></div><div class="ttdeci">#define MAX_FTYP_ATOM_SIZE</div><div class="ttdef"><b>Definition:</b> <a href="qt-faststart_8c_source.html#l00102">qt-faststart.c:102</a></div></div>
<div class="ttc" id="aqt-faststart_8c_html_aa440f405a74bcff12d1f73f4c8db471a"><div class="ttname"><a href="qt-faststart_8c.html#aa440f405a74bcff12d1f73f4c8db471a">PICT_ATOM</a></div><div class="ttdeci">#define PICT_ATOM</div><div class="ttdef"><b>Definition:</b> <a href="qt-faststart_8c_source.html#l00088">qt-faststart.c:88</a></div></div>
<div class="ttc" id="aqt-faststart_8c_html_afa669e884e3a82a166bf21d69a8dba5f"><div class="ttname"><a href="qt-faststart_8c.html#afa669e884e3a82a166bf21d69a8dba5f">UUID_ATOM</a></div><div class="ttdeci">#define UUID_ATOM</div><div class="ttdef"><b>Definition:</b> <a href="qt-faststart_8c_source.html#l00090">qt-faststart.c:90</a></div></div>
<div class="ttc" id="aqt-faststart_8c_html_ab0882ba7cea059e7147c6e30dd5cd3bd"><div class="ttname"><a href="qt-faststart_8c.html#ab0882ba7cea059e7147c6e30dd5cd3bd">update_moov_atom</a></div><div class="ttdeci">static int update_moov_atom(unsigned char **moov_atom, uint64_t *moov_atom_size)</div><div class="ttdef"><b>Definition:</b> <a href="qt-faststart_8c_source.html#l00372">qt-faststart.c:372</a></div></div>
<div class="ttc" id="aavrndec_8c_html_a13191ba45577b1d4f9b37d64df91eb55"><div class="ttname"><a href="avrndec_8c.html#a13191ba45577b1d4f9b37d64df91eb55">end</a></div><div class="ttdeci">static av_cold int end(AVCodecContext *avctx)</div><div class="ttdef"><b>Definition:</b> <a href="avrndec_8c_source.html#l00092">avrndec.c:92</a></div></div>
<div class="ttc" id="astructatom__t_html_aea013cd8b2d852f448f6342fbe9ed23f"><div class="ttname"><a href="structatom__t.html#aea013cd8b2d852f448f6342fbe9ed23f">atom_t::header_size</a></div><div class="ttdeci">uint32_t header_size</div><div class="ttdef"><b>Definition:</b> <a href="qt-faststart_8c_source.html#l00106">qt-faststart.c:106</a></div></div>
<div class="ttc" id="aaudiogen_8c_html_ae581849c67336453bd5b81e6518019a9"><div class="ttname"><a href="audiogen_8c.html#ae581849c67336453bd5b81e6518019a9">outfile</a></div><div class="ttdeci">FILE * outfile</div><div class="ttdef"><b>Definition:</b> <a href="audiogen_8c_source.html#l00096">audiogen.c:96</a></div></div>
<div class="ttc" id="astructupgrade__stco__context__t_html_accdc087a21225bcd4c3e4d7f50a3ac6e"><div class="ttname"><a href="structupgrade__stco__context__t.html#accdc087a21225bcd4c3e4d7f50a3ac6e">upgrade_stco_context_t::dest</a></div><div class="ttdeci">unsigned char * dest</div><div class="ttdef"><b>Definition:</b> <a href="qt-faststart_8c_source.html#l00120">qt-faststart.c:120</a></div></div>
<div class="ttc" id="aqt-faststart_8c_html_a76e78f8113d8722f8614f7e670a5ef90"><div class="ttname"><a href="qt-faststart_8c.html#a76e78f8113d8722f8614f7e670a5ef90">MINF_ATOM</a></div><div class="ttdeci">#define MINF_ATOM</div><div class="ttdef"><b>Definition:</b> <a href="qt-faststart_8c_source.html#l00095">qt-faststart.c:95</a></div></div>
<div class="ttc" id="aqt-faststart_8c_html_a127d1a98c12f7fafc8856ba778551ccc"><div class="ttname"><a href="qt-faststart_8c.html#a127d1a98c12f7fafc8856ba778551ccc">STBL_ATOM</a></div><div class="ttdeci">#define STBL_ATOM</div><div class="ttdef"><b>Definition:</b> <a href="qt-faststart_8c_source.html#l00096">qt-faststart.c:96</a></div></div>
<div class="ttc" id="aqt-faststart_8c_html_ae8c7f2db6658d4b53b3e89fc921683a3"><div class="ttname"><a href="qt-faststart_8c.html#ae8c7f2db6658d4b53b3e89fc921683a3">FTYP_ATOM</a></div><div class="ttdeci">#define FTYP_ATOM</div><div class="ttdef"><b>Definition:</b> <a href="qt-faststart_8c_source.html#l00089">qt-faststart.c:89</a></div></div>
<div class="ttc" id="astructatom__t_html"><div class="ttname"><a href="structatom__t.html">atom_t</a></div><div class="ttdef"><b>Definition:</b> <a href="qt-faststart_8c_source.html#l00104">qt-faststart.c:104</a></div></div>
<div class="ttc" id="astructupdate__chunk__offsets__context__t_html_ad0d59b3d73ed18e00ca455c0b4906834"><div class="ttname"><a href="structupdate__chunk__offsets__context__t.html#ad0d59b3d73ed18e00ca455c0b4906834">update_chunk_offsets_context_t::stco_overflow</a></div><div class="ttdeci">int stco_overflow</div><div class="ttdef"><b>Definition:</b> <a href="qt-faststart_8c_source.html#l00115">qt-faststart.c:115</a></div></div>
<div class="ttc" id="astructupdate__chunk__offsets__context__t_html_a791d2f66221c42c5c848271ce9c0f6e5"><div class="ttname"><a href="structupdate__chunk__offsets__context__t.html#a791d2f66221c42c5c848271ce9c0f6e5">update_chunk_offsets_context_t::stco_data_size</a></div><div class="ttdeci">uint64_t stco_data_size</div><div class="ttdef"><b>Definition:</b> <a href="qt-faststart_8c_source.html#l00114">qt-faststart.c:114</a></div></div>
<div class="ttc" id="astructupdate__chunk__offsets__context__t_html_a90e60526f0dca8c57e6d2525de722549"><div class="ttname"><a href="structupdate__chunk__offsets__context__t.html#a90e60526f0dca8c57e6d2525de722549">update_chunk_offsets_context_t::moov_atom_size</a></div><div class="ttdeci">uint64_t moov_atom_size</div><div class="ttdef"><b>Definition:</b> <a href="qt-faststart_8c_source.html#l00112">qt-faststart.c:112</a></div></div>
<div class="ttc" id="atests_2movenc_8c_html_a93cc7296f13f507c1fd7abd0db36b898"><div class="ttname"><a href="tests_2movenc_8c.html#a93cc7296f13f507c1fd7abd0db36b898">ctx</a></div><div class="ttdeci">AVFormatContext * ctx</div><div class="ttdef"><b>Definition:</b> <a href="tests_2movenc_8c_source.html#l00048">movenc.c:48</a></div></div>
<div class="ttc" id="alimits_8h_html"><div class="ttname"><a href="limits_8h.html">limits.h</a></div></div>
<div class="ttc" id="aqt-faststart_8c_html_a6bf045f0c88b06dd007cdb539a9c54f1"><div class="ttname"><a href="qt-faststart_8c.html#a6bf045f0c88b06dd007cdb539a9c54f1">FREE_ATOM</a></div><div class="ttdeci">#define FREE_ATOM</div><div class="ttdef"><b>Definition:</b> <a href="qt-faststart_8c_source.html#l00081">qt-faststart.c:81</a></div></div>
<div class="ttc" id="aqt-faststart_8c_html_ae038a0da9bf061cb16ba4ee89b6debbc"><div class="ttname"><a href="qt-faststart_8c.html#ae038a0da9bf061cb16ba4ee89b6debbc">set_atom_size</a></div><div class="ttdeci">static void set_atom_size(unsigned char *header, uint32_t header_size, uint64_t size)</div><div class="ttdef"><b>Definition:</b> <a href="qt-faststart_8c_source.html#l00286">qt-faststart.c:286</a></div></div>
<div class="ttc" id="adshow_8c_html_af7516efc6ebfbbc6f25e3ccbfbeec53f"><div class="ttname"><a href="dshow_8c.html#af7516efc6ebfbbc6f25e3ccbfbeec53f">callback</a></div><div class="ttdeci">static void callback(void *priv_data, int index, uint8_t *buf, int buf_size, int64_t time, enum dshowDeviceType devtype)</div><div class="ttdef"><b>Definition:</b> <a href="dshow_8c_source.html#l00161">dshow.c:161</a></div></div>
<div class="ttc" id="aqt-faststart_8c_html_afd2d38dbc4338142d73bbd42c59ac186"><div class="ttname"><a href="qt-faststart_8c.html#afd2d38dbc4338142d73bbd42c59ac186">AV_WB64</a></div><div class="ttdeci">#define AV_WB64(p, val)</div><div class="ttdef"><b>Definition:</b> <a href="qt-faststart_8c_source.html#l00068">qt-faststart.c:68</a></div></div>
<div class="ttc" id="awriting__filters_8txt_html_a5b5446e1f47af0c85ac6b45210d45117"><div class="ttname"><a href="writing__filters_8txt.html#a5b5446e1f47af0c85ac6b45210d45117">context</a></div><div class="ttdeci">it s the only field you need to keep assuming you have a context There is some magic you don t need to care about around this just let it vf default minimum maximum flags name is the option keep it simple and lowercase description are in without and describe what they for example set the foo of the bar offset is the offset of the field in your context</div><div class="ttdef"><b>Definition:</b> <a href="writing__filters_8txt_source.html#l00091">writing_filters.txt:91</a></div></div>
<div class="ttc" id="acoverity_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="coverity_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="coverity_8c_source.html#l00032">coverity.c:32</a></div></div>
<div class="ttc" id="aqt-faststart_8c_html_ac8e0a0bbd4f419793e06b8ac170a4259"><div class="ttname"><a href="qt-faststart_8c.html#ac8e0a0bbd4f419793e06b8ac170a4259">upgrade_stco_atom</a></div><div class="ttdeci">static void upgrade_stco_atom(upgrade_stco_context_t *context, atom_t *atom)</div><div class="ttdef"><b>Definition:</b> <a href="qt-faststart_8c_source.html#l00299">qt-faststart.c:299</a></div></div>
<div class="ttc" id="aqt-faststart_8c_html_a7a5b192094510dd7965a713101748263"><div class="ttname"><a href="qt-faststart_8c.html#a7a5b192094510dd7965a713101748263">BE_32</a></div><div class="ttdeci">#define BE_32(x)</div><div class="ttdef"><b>Definition:</b> <a href="qt-faststart_8c_source.html#l00047">qt-faststart.c:47</a></div></div>
<div class="ttc" id="aqt-faststart_8c_html_a571b849cc58c2504cab9e14c25ede594"><div class="ttname"><a href="qt-faststart_8c.html#a571b849cc58c2504cab9e14c25ede594">ATOM_PREAMBLE_SIZE</a></div><div class="ttdeci">#define ATOM_PREAMBLE_SIZE</div><div class="ttdef"><b>Definition:</b> <a href="qt-faststart_8c_source.html#l00100">qt-faststart.c:100</a></div></div>
<div class="ttc" id="aqt-faststart_8c_html_a06a50b69e8b9d8dc2140ef0eea43da8e"><div class="ttname"><a href="qt-faststart_8c.html#a06a50b69e8b9d8dc2140ef0eea43da8e">CMOV_ATOM</a></div><div class="ttdeci">#define CMOV_ATOM</div><div class="ttdef"><b>Definition:</b> <a href="qt-faststart_8c_source.html#l00092">qt-faststart.c:92</a></div></div>
<div class="ttc" id="astructupdate__chunk__offsets__context__t_html_a041a3ab829e8c7d378b532734d21aeab"><div class="ttname"><a href="structupdate__chunk__offsets__context__t.html#a041a3ab829e8c7d378b532734d21aeab">update_chunk_offsets_context_t::depth</a></div><div class="ttdeci">uint32_t depth</div><div class="ttdef"><b>Definition:</b> <a href="qt-faststart_8c_source.html#l00116">qt-faststart.c:116</a></div></div>
<div class="ttc" id="aqt-faststart_8c_html_a83218ba609a1bff3f0fb537b68a2aa1d"><div class="ttname"><a href="qt-faststart_8c.html#a83218ba609a1bff3f0fb537b68a2aa1d">WIDE_ATOM</a></div><div class="ttdeci">#define WIDE_ATOM</div><div class="ttdef"><b>Definition:</b> <a href="qt-faststart_8c_source.html#l00087">qt-faststart.c:87</a></div></div>
<div class="ttc" id="aqt-faststart_8c_html_aab213c1c3ebfcf29fb3790f14812f4f8"><div class="ttname"><a href="qt-faststart_8c.html#aab213c1c3ebfcf29fb3790f14812f4f8">parse_atoms_callback_t</a></div><div class="ttdeci">int(* parse_atoms_callback_t)(void *context, atom_t *atom)</div><div class="ttdef"><b>Definition:</b> <a href="qt-faststart_8c_source.html#l00125">qt-faststart.c:125</a></div></div>
<div class="ttc" id="astructupgrade__stco__context__t_html_ad3db8fb52ff53e61c4004f688fe33d9f"><div class="ttname"><a href="structupgrade__stco__context__t.html#ad3db8fb52ff53e61c4004f688fe33d9f">upgrade_stco_context_t::original_moov_size</a></div><div class="ttdeci">uint64_t original_moov_size</div><div class="ttdef"><b>Definition:</b> <a href="qt-faststart_8c_source.html#l00121">qt-faststart.c:121</a></div></div>
<div class="ttc" id="astructatom__t_html_ad3945ab6a522524a81fa82ea32cd0123"><div class="ttname"><a href="structatom__t.html#ad3945ab6a522524a81fa82ea32cd0123">atom_t::type</a></div><div class="ttdeci">uint32_t type</div><div class="ttdef"><b>Definition:</b> <a href="qt-faststart_8c_source.html#l00105">qt-faststart.c:105</a></div></div>
<div class="ttc" id="astructatom__t_html_a9bc25bc74841be26219cc35b9254b3da"><div class="ttname"><a href="structatom__t.html#a9bc25bc74841be26219cc35b9254b3da">atom_t::size</a></div><div class="ttdeci">uint64_t size</div><div class="ttdef"><b>Definition:</b> <a href="qt-faststart_8c_source.html#l00107">qt-faststart.c:107</a></div></div>
<div class="ttc" id="atablegen_8txt_html_a934618af0084fc36af687c3b11489b27"><div class="ttname"><a href="tablegen_8txt.html#a934618af0084fc36af687c3b11489b27">printf</a></div><div class="ttdeci">printf(&quot;static const uint8_t my_array[100] = {\n&quot;)</div></div>
<div class="ttc" id="asdr2_8c_html_abd18f6ed7dc5da8824a97bc504e4280e"><div class="ttname"><a href="sdr2_8c.html#abd18f6ed7dc5da8824a97bc504e4280e">header</a></div><div class="ttdeci">static const uint8_t header[24]</div><div class="ttdef"><b>Definition:</b> <a href="sdr2_8c_source.html#l00067">sdr2.c:67</a></div></div>
<div class="ttc" id="aqt-faststart_8c_html_afdcb72310b0c9908696708d74746a926"><div class="ttname"><a href="qt-faststart_8c.html#afdcb72310b0c9908696708d74746a926">parse_atoms</a></div><div class="ttdeci">static int parse_atoms(unsigned char *buf, uint64_t size, parse_atoms_callback_t callback, void *context)</div><div class="ttdef"><b>Definition:</b> <a href="qt-faststart_8c_source.html#l00127">qt-faststart.c:127</a></div></div>
<div class="ttc" id="aqt-faststart_8c_html_a167af3f605cbf3313138fb38d390251a"><div class="ttname"><a href="qt-faststart_8c.html#a167af3f605cbf3313138fb38d390251a">TRAK_ATOM</a></div><div class="ttdeci">#define TRAK_ATOM</div><div class="ttdef"><b>Definition:</b> <a href="qt-faststart_8c_source.html#l00093">qt-faststart.c:93</a></div></div>
<div class="ttc" id="aqt-faststart_8c_html_a3acffbd305ee72dcd4593c0d8af64a4f"><div class="ttname"><a href="qt-faststart_8c.html#a3acffbd305ee72dcd4593c0d8af64a4f">MIN</a></div><div class="ttdeci">#define MIN(a, b)</div><div class="ttdef"><b>Definition:</b> <a href="qt-faststart_8c_source.html#l00045">qt-faststart.c:45</a></div></div>
<div class="ttc" id="aqt-faststart_8c_html_a4ee4bc38ad95c345d012662e876d7f88"><div class="ttname"><a href="qt-faststart_8c.html#a4ee4bc38ad95c345d012662e876d7f88">MDIA_ATOM</a></div><div class="ttdeci">#define MDIA_ATOM</div><div class="ttdef"><b>Definition:</b> <a href="qt-faststart_8c_source.html#l00094">qt-faststart.c:94</a></div></div>
<div class="ttc" id="astructupdate__chunk__offsets__context__t_html"><div class="ttname"><a href="structupdate__chunk__offsets__context__t.html">update_chunk_offsets_context_t</a></div><div class="ttdef"><b>Definition:</b> <a href="qt-faststart_8c_source.html#l00111">qt-faststart.c:111</a></div></div>
<div class="ttc" id="afilter__design_8txt_html_af1ec77bdca1b30e8153fc5da88f603db"><div class="ttname"><a href="filter__design_8txt.html#af1ec77bdca1b30e8153fc5da88f603db">ret</a></div><div class="ttdeci">ret</div><div class="ttdef"><b>Definition:</b> <a href="filter__design_8txt_source.html#l00187">filter_design.txt:187</a></div></div>
<div class="ttc" id="astructatom__t_html_a79414562bee38c919a3abaa266bddb1e"><div class="ttname"><a href="structatom__t.html#a79414562bee38c919a3abaa266bddb1e">atom_t::data</a></div><div class="ttdeci">unsigned char * data</div><div class="ttdef"><b>Definition:</b> <a href="qt-faststart_8c_source.html#l00108">qt-faststart.c:108</a></div></div>
<div class="ttc" id="aqt-faststart_8c_html_aac5ec4771d5f7fa6df35b9787c3c923e"><div class="ttname"><a href="qt-faststart_8c.html#aac5ec4771d5f7fa6df35b9787c3c923e">CO64_ATOM</a></div><div class="ttdeci">#define CO64_ATOM</div><div class="ttdef"><b>Definition:</b> <a href="qt-faststart_8c_source.html#l00098">qt-faststart.c:98</a></div></div>
<div class="ttc" id="aqt-faststart_8c_html_a5e6668951d81243b56eac18d35b16af6"><div class="ttname"><a href="qt-faststart_8c.html#a5e6668951d81243b56eac18d35b16af6">COPY_BUFFER_SIZE</a></div><div class="ttdeci">#define COPY_BUFFER_SIZE</div><div class="ttdef"><b>Definition:</b> <a href="qt-faststart_8c_source.html#l00101">qt-faststart.c:101</a></div></div>
<div class="ttc" id="aspdifenc_8c_html_addcb93d939ffa259ff1d9247bdd590fd"><div class="ttname"><a href="spdifenc_8c.html#addcb93d939ffa259ff1d9247bdd590fd">pos</a></div><div class="ttdeci">unsigned int pos</div><div class="ttdef"><b>Definition:</b> <a href="spdifenc_8c_source.html#l00410">spdifenc.c:410</a></div></div>
<div class="ttc" id="agroup__lavu__mem__funcs_html_ga34e10fdac079a9ca4512b8ccd7f20b8a"><div class="ttname"><a href="group__lavu__mem__funcs.html#ga34e10fdac079a9ca4512b8ccd7f20b8a">size</a></div><div class="ttdeci">int size</div><div class="ttdef"><b>Definition:</b> <a href="twinvq__data_8h_source.html#l11134">twinvq_data.h:11134</a></div></div>
<div class="ttc" id="astructupdate__chunk__offsets__context__t_html_ab014c2f07d149ffc3bb586abbef6b610"><div class="ttname"><a href="structupdate__chunk__offsets__context__t.html#ab014c2f07d149ffc3bb586abbef6b610">update_chunk_offsets_context_t::stco_offset_count</a></div><div class="ttdeci">uint64_t stco_offset_count</div><div class="ttdef"><b>Definition:</b> <a href="qt-faststart_8c_source.html#l00113">qt-faststart.c:113</a></div></div>
<div class="ttc" id="aqt-faststart_8c_html_ae2ac4eb72808699f9ee3f76fc3e5efcf"><div class="ttname"><a href="qt-faststart_8c.html#ae2ac4eb72808699f9ee3f76fc3e5efcf">upgrade_stco_callback</a></div><div class="ttdeci">static int upgrade_stco_callback(void *ctx, atom_t *atom)</div><div class="ttdef"><b>Definition:</b> <a href="qt-faststart_8c_source.html#l00328">qt-faststart.c:328</a></div></div>
<div class="ttc" id="astructupgrade__stco__context__t_html_a4c60b56d2da60f0e57bab054a1827145"><div class="ttname"><a href="structupgrade__stco__context__t.html#a4c60b56d2da60f0e57bab054a1827145">upgrade_stco_context_t::new_moov_size</a></div><div class="ttdeci">uint64_t new_moov_size</div><div class="ttdef"><b>Definition:</b> <a href="qt-faststart_8c_source.html#l00122">qt-faststart.c:122</a></div></div>
<div class="ttc" id="aqt-faststart_8c_html_a65fa48f29e29e7800342d3bea951362f"><div class="ttname"><a href="qt-faststart_8c.html#a65fa48f29e29e7800342d3bea951362f">update_stco_offsets</a></div><div class="ttdeci">static int update_stco_offsets(update_chunk_offsets_context_t *context, atom_t *atom)</div><div class="ttdef"><b>Definition:</b> <a href="qt-faststart_8c_source.html#l00185">qt-faststart.c:185</a></div></div>
<div class="ttc" id="aqt-faststart_8c_html_a3eec18e6a9a47ca5e1e68d85c0d75639"><div class="ttname"><a href="qt-faststart_8c.html#a3eec18e6a9a47ca5e1e68d85c0d75639">MOOV_ATOM</a></div><div class="ttdeci">#define MOOV_ATOM</div><div class="ttdef"><b>Definition:</b> <a href="qt-faststart_8c_source.html#l00084">qt-faststart.c:84</a></div></div>
<div class="ttc" id="aqt-faststart_8c_html_a36097280ddfe8ebfc825d0f98fd00621"><div class="ttname"><a href="qt-faststart_8c.html#a36097280ddfe8ebfc825d0f98fd00621">AV_WB32</a></div><div class="ttdeci">#define AV_WB32(p, val)</div><div class="ttdef"><b>Definition:</b> <a href="qt-faststart_8c_source.html#l00061">qt-faststart.c:61</a></div></div>
<div class="ttc" id="avf__vignette_8c_html_a8605729a6adf50f5a6da18c77b36f1b6"><div class="ttname"><a href="vf__vignette_8c.html#a8605729a6adf50f5a6da18c77b36f1b6">update_context</a></div><div class="ttdeci">static void update_context(VignetteContext *s, AVFilterLink *inlink, AVFrame *frame)</div><div class="ttdef"><b>Definition:</b> <a href="vf__vignette_8c_source.html#l00158">vf_vignette.c:158</a></div></div>
<div class="ttc" id="aqt-faststart_8c_html_a06ce0375a17b52e0c381ab39e48be637"><div class="ttname"><a href="qt-faststart_8c.html#a06ce0375a17b52e0c381ab39e48be637">update_chunk_offsets_callback</a></div><div class="ttdeci">static int update_chunk_offsets_callback(void *ctx, atom_t *atom)</div><div class="ttdef"><b>Definition:</b> <a href="qt-faststart_8c_source.html#l00251">qt-faststart.c:251</a></div></div>
<div class="ttc" id="aqt-faststart_8c_html_a3169ae1d2513ae1e7b414becc7af54f1"><div class="ttname"><a href="qt-faststart_8c.html#a3169ae1d2513ae1e7b414becc7af54f1">JUNK_ATOM</a></div><div class="ttdeci">#define JUNK_ATOM</div><div class="ttdef"><b>Definition:</b> <a href="qt-faststart_8c_source.html#l00082">qt-faststart.c:82</a></div></div>
<div class="ttc" id="affmpeg__filter_8c_html_a61569f2965b7a369eb10b6d75d410d11"><div class="ttname"><a href="ffmpeg__filter_8c.html#a61569f2965b7a369eb10b6d75d410d11">int</a></div><div class="ttdeci">int</div><div class="ttdef"><b>Definition:</b> <a href="ffmpeg__filter_8c_source.html#l00193">ffmpeg_filter.c:193</a></div></div>
<div class="ttc" id="aqt-faststart_8c_html_a8acabb6545a145767cd42e79f3cfa4a9"><div class="ttname"><a href="qt-faststart_8c.html#a8acabb6545a145767cd42e79f3cfa4a9">update_co64_offsets</a></div><div class="ttdeci">static int update_co64_offsets(update_chunk_offsets_context_t *context, atom_t *atom)</div><div class="ttdef"><b>Definition:</b> <a href="qt-faststart_8c_source.html#l00221">qt-faststart.c:221</a></div></div>
<div class="ttc" id="astructupgrade__stco__context__t_html"><div class="ttname"><a href="structupgrade__stco__context__t.html">upgrade_stco_context_t</a></div><div class="ttdef"><b>Definition:</b> <a href="qt-faststart_8c_source.html#l00119">qt-faststart.c:119</a></div></div>
<div class="ttc" id="aqt-faststart_8c_html_a0ddf1224851353fc92bfbff6f499fa97"><div class="ttname"><a href="qt-faststart_8c.html#a0ddf1224851353fc92bfbff6f499fa97">main</a></div><div class="ttdeci">int main(int argc, char *argv[])</div><div class="ttdef"><b>Definition:</b> <a href="qt-faststart_8c_source.html#l00430">qt-faststart.c:430</a></div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.8.20
</small></address>
</body>
</html>
